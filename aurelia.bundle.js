webpackJsonp([1],{

/***/ 1:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "_emptyParameters", function() { return _emptyParameters; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InvocationHandler", function() { return InvocationHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Container", function() { return Container; });
/* harmony export (binding) */ __webpack_require__.d(exports, "autoinject", function() { return autoinject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "inject", function() { return inject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "invoker", function() { return invoker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "invokeAsFactory", function() { return invokeAsFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FactoryInvoker", function() { return FactoryInvoker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "registration", function() { return registration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "transient", function() { return transient; });
/* harmony export (binding) */ __webpack_require__.d(exports, "singleton", function() { return singleton; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TransientRegistration", function() { return TransientRegistration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SingletonRegistration", function() { return SingletonRegistration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "resolver", function() { return resolver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Strategy", function() { return Strategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StrategyResolver", function() { return StrategyResolver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Lazy", function() { return Lazy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "All", function() { return All; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Optional", function() { return Optional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Parent", function() { return Parent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Factory", function() { return Factory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NewInstance", function() { return NewInstance; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getDecoratorDependencies", function() { return getDecoratorDependencies; });
/* harmony export (binding) */ __webpack_require__.d(exports, "lazy", function() { return lazy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "all", function() { return all; });
/* harmony export (binding) */ __webpack_require__.d(exports, "optional", function() { return optional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "parent", function() { return parent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "factory", function() { return factory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "newInstance", function() { return newInstance; });



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function isInjectable(potentialTarget) {
    return !!potentialTarget;
}
function autoinject(potentialTarget) {
    var deco = function (target) {
        if (!target.hasOwnProperty('inject')) {
            target.inject = (__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].paramTypes, target) ||
                _emptyParameters).slice();
            if (target.inject && target.inject.length > 0) {
                if (target.inject[target.inject.length - 1] === Object) {
                    target.inject.splice(-1, 1);
                }
            }
        }
    };
    if (isInjectable(potentialTarget)) {
        return deco(potentialTarget);
    }
    return deco;
}
function inject() {
    var rest = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        rest[_i] = arguments[_i];
    }
    return function (target, _key, descriptor) {
        if (typeof descriptor === 'number') {
            autoinject(target);
            if (rest.length === 1) {
                target.inject[descriptor] = rest[0];
            }
            return;
        }
        if (descriptor) {
            var fn = descriptor.value;
            fn.inject = rest;
        }
        else {
            target.inject = rest;
        }
    };
}

var resolver = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["protocol"].create('aurelia:resolver', function (target) {
    if (!(typeof target.get === 'function')) {
        return 'Resolvers must implement: get(container: Container, key: any): any';
    }
    return true;
});
var Strategy;
(function (Strategy) {
    Strategy[Strategy["instance"] = 0] = "instance";
    Strategy[Strategy["singleton"] = 1] = "singleton";
    Strategy[Strategy["transient"] = 2] = "transient";
    Strategy[Strategy["function"] = 3] = "function";
    Strategy[Strategy["array"] = 4] = "array";
    Strategy[Strategy["alias"] = 5] = "alias";
})(Strategy || (Strategy = {}));
function isStrategy(actual, expected, state) {
    return actual === expected;
}
var StrategyResolver = (function () {
    function StrategyResolver(strategy, state) {
        this.strategy = strategy;
        this.state = state;
    }
    StrategyResolver.prototype.get = function (container, key) {
        if (isStrategy(this.strategy, Strategy.instance, this.state)) {
            return this.state;
        }
        if (isStrategy(this.strategy, Strategy.singleton, this.state)) {
            var singleton = container.invoke(this.state);
            this.state = singleton;
            this.strategy = 0;
            return singleton;
        }
        if (isStrategy(this.strategy, Strategy.transient, this.state)) {
            return container.invoke(this.state);
        }
        if (isStrategy(this.strategy, Strategy.function, this.state)) {
            return this.state(container, key, this);
        }
        if (isStrategy(this.strategy, Strategy.array, this.state)) {
            return this.state[0].get(container, key);
        }
        if (isStrategy(this.strategy, Strategy.alias, this.state)) {
            return container.get(this.state);
        }
        throw new Error('Invalid strategy: ' + this.strategy);
    };
    StrategyResolver = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Number, Object])
    ], StrategyResolver);
    return StrategyResolver;
}());
var Lazy = (function () {
    function Lazy(key) {
        this._key = key;
    }
    Lazy_1 = Lazy;
    Lazy.prototype.get = function (container) {
        var _this = this;
        return function () { return container.get(_this._key); };
    };
    Lazy.of = function (key) {
        return new Lazy_1(key);
    };
    var Lazy_1;
    Lazy = Lazy_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Lazy);
    return Lazy;
}());
var All = (function () {
    function All(key) {
        this._key = key;
    }
    All_1 = All;
    All.prototype.get = function (container) {
        return container.getAll(this._key);
    };
    All.of = function (key) {
        return new All_1(key);
    };
    var All_1;
    All = All_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], All);
    return All;
}());
var Optional = (function () {
    function Optional(key, checkParent) {
        if (checkParent === void 0) { checkParent = true; }
        this._key = key;
        this._checkParent = checkParent;
    }
    Optional_1 = Optional;
    Optional.prototype.get = function (container) {
        if (container.hasResolver(this._key, this._checkParent)) {
            return container.get(this._key);
        }
        return null;
    };
    Optional.of = function (key, checkParent) {
        if (checkParent === void 0) { checkParent = true; }
        return new Optional_1(key, checkParent);
    };
    var Optional_1;
    Optional = Optional_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object, Boolean])
    ], Optional);
    return Optional;
}());
var Parent = (function () {
    function Parent(key) {
        this._key = key;
    }
    Parent_1 = Parent;
    Parent.prototype.get = function (container) {
        return container.parent ? container.parent.get(this._key) : null;
    };
    Parent.of = function (key) {
        return new Parent_1(key);
    };
    var Parent_1;
    Parent = Parent_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Parent);
    return Parent;
}());
var Factory = (function () {
    function Factory(key) {
        this._key = key;
    }
    Factory_1 = Factory;
    Factory.prototype.get = function (container) {
        var fn = this._key;
        var resolver = container.getResolver(fn);
        if (resolver && resolver.strategy === Strategy.function) {
            fn = resolver.state;
        }
        return function () {
            var rest = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                rest[_i] = arguments[_i];
            }
            return container.invoke(fn, rest);
        };
    };
    Factory.of = function (key) {
        return new Factory_1(key);
    };
    var Factory_1;
    Factory = Factory_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object])
    ], Factory);
    return Factory;
}());
var NewInstance = (function () {
    function NewInstance(key) {
        var dynamicDependencies = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            dynamicDependencies[_i - 1] = arguments[_i];
        }
        this.key = key;
        this.asKey = key;
        this.dynamicDependencies = dynamicDependencies;
    }
    NewInstance_1 = NewInstance;
    NewInstance.prototype.get = function (container) {
        var dynamicDependencies = this.dynamicDependencies.length > 0
            ? this.dynamicDependencies.map(function (dependency) {
                return dependency['protocol:aurelia:resolver']
                    ? dependency.get(container)
                    : container.get(dependency);
            })
            : undefined;
        var fn = this.key;
        var resolver = container.getResolver(fn);
        if (resolver && resolver.strategy === 3) {
            fn = resolver.state;
        }
        var instance = container.invoke(fn, dynamicDependencies);
        container.registerInstance(this.asKey, instance);
        return instance;
    };
    NewInstance.prototype.as = function (key) {
        this.asKey = key;
        return this;
    };
    NewInstance.of = function (key) {
        var dynamicDependencies = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            dynamicDependencies[_i - 1] = arguments[_i];
        }
        return new (NewInstance_1.bind.apply(NewInstance_1, [void 0, key].concat(dynamicDependencies)))();
    };
    var NewInstance_1;
    NewInstance = NewInstance_1 = __decorate([
        resolver(),
        __metadata("design:paramtypes", [Object, Object])
    ], NewInstance);
    return NewInstance;
}());
function getDecoratorDependencies(target) {
    autoinject(target);
    return target.inject;
}
function lazy(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = Lazy.of(keyValue);
    };
}
function all(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = All.of(keyValue);
    };
}
function optional(checkParentOrTarget) {
    if (checkParentOrTarget === void 0) { checkParentOrTarget = true; }
    var deco = function (checkParent) {
        return function (target, _key, index) {
            var inject$$1 = getDecoratorDependencies(target);
            inject$$1[index] = Optional.of(inject$$1[index], checkParent);
        };
    };
    if (typeof checkParentOrTarget === 'boolean') {
        return deco(checkParentOrTarget);
    }
    return deco(true);
}
function parent(target, _key, index) {
    var inject$$1 = getDecoratorDependencies(target);
    inject$$1[index] = Parent.of(inject$$1[index]);
}
function factory(keyValue) {
    return function (target, _key, index) {
        var inject$$1 = getDecoratorDependencies(target);
        inject$$1[index] = Factory.of(keyValue);
    };
}
function newInstance(asKeyOrTarget) {
    var dynamicDependencies = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        dynamicDependencies[_i - 1] = arguments[_i];
    }
    var deco = function (asKey) {
        return function (target, _key, index) {
            var inject$$1 = getDecoratorDependencies(target);
            inject$$1[index] = NewInstance.of.apply(NewInstance, [inject$$1[index]].concat(dynamicDependencies));
            if (!!asKey) {
                inject$$1[index].as(asKey);
            }
        };
    };
    if (arguments.length >= 1) {
        return deco(asKeyOrTarget);
    }
    return deco();
}

function validateKey(key) {
    if (key === null || key === undefined) {
        throw new Error('key/value cannot be null or undefined. Are you trying to inject/register something that doesn\'t exist with DI?');
    }
}
var _emptyParameters = Object.freeze([]);
__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration = 'aurelia:registration';
__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker = 'aurelia:invoker';
var resolverDecorates = resolver.decorates;
var InvocationHandler = (function () {
    function InvocationHandler(fn, invoker, dependencies) {
        this.fn = fn;
        this.invoker = invoker;
        this.dependencies = dependencies;
    }
    InvocationHandler.prototype.invoke = function (container, dynamicDependencies) {
        return dynamicDependencies !== undefined
            ? this.invoker.invokeWithDynamicDependencies(container, this.fn, this.dependencies, dynamicDependencies)
            : this.invoker.invoke(container, this.fn, this.dependencies);
    };
    return InvocationHandler;
}());
function invokeWithDynamicDependencies(container, fn, staticDependencies, dynamicDependencies) {
    var i = staticDependencies.length;
    var args = new Array(i);
    var lookup;
    while (i--) {
        lookup = staticDependencies[i];
        if (lookup === null || lookup === undefined) {
            throw new Error('Constructor Parameter with index ' +
                i +
                ' cannot be null or undefined. Are you trying to inject/register something that doesn\'t exist with DI?');
        }
        else {
            args[i] = container.get(lookup);
        }
    }
    if (dynamicDependencies !== undefined) {
        args = args.concat(dynamicDependencies);
    }
    return Reflect.construct(fn, args);
}
var classInvoker = {
    invoke: function (container, Type, deps) {
        var instances = deps.map(function (dep) { return container.get(dep); });
        return Reflect.construct(Type, instances);
    },
    invokeWithDynamicDependencies: invokeWithDynamicDependencies
};
function getDependencies(f) {
    if (!f.hasOwnProperty('inject')) {
        return [];
    }
    if (typeof f.inject === 'function') {
        return f.inject();
    }
    return f.inject;
}
var Container = (function () {
    function Container(configuration) {
        if (configuration === undefined) {
            configuration = {};
        }
        this._configuration = configuration;
        this._onHandlerCreated = configuration.onHandlerCreated;
        this._handlers =
            configuration.handlers || (configuration.handlers = new Map());
        this._resolvers = new Map();
        this.root = this;
        this.parent = null;
    }
    Container.prototype.makeGlobal = function () {
        Container.instance = this;
        return this;
    };
    Container.prototype.setHandlerCreatedCallback = function (onHandlerCreated) {
        this._onHandlerCreated = onHandlerCreated;
        this._configuration.onHandlerCreated = onHandlerCreated;
    };
    Container.prototype.registerInstance = function (key, instance) {
        return this.registerResolver(key, new StrategyResolver(0, instance === undefined ? key : instance));
    };
    Container.prototype.registerSingleton = function (key, fn) {
        return this.registerResolver(key, new StrategyResolver(1, fn === undefined ? key : fn));
    };
    Container.prototype.registerTransient = function (key, fn) {
        return this.registerResolver(key, new StrategyResolver(2, fn === undefined ? key : fn));
    };
    Container.prototype.registerHandler = function (key, handler) {
        return this.registerResolver(key, new StrategyResolver(3, handler));
    };
    Container.prototype.registerAlias = function (originalKey, aliasKey) {
        return this.registerResolver(aliasKey, new StrategyResolver(5, originalKey));
    };
    Container.prototype.registerResolver = function (key, resolver$$1) {
        validateKey(key);
        var allResolvers = this._resolvers;
        var result = allResolvers.get(key);
        if (result === undefined) {
            allResolvers.set(key, resolver$$1);
        }
        else if (result.strategy === 4) {
            result.state.push(resolver$$1);
        }
        else {
            allResolvers.set(key, new StrategyResolver(4, [result, resolver$$1]));
        }
        return resolver$$1;
    };
    Container.prototype.autoRegister = function (key, fn) {
        fn = fn === undefined ? key : fn;
        if (typeof fn === 'function') {
            var registration = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, fn);
            if (registration === undefined) {
                return this.registerResolver(key, new StrategyResolver(1, fn));
            }
            return registration.registerResolver(this, key, fn);
        }
        return this.registerResolver(key, new StrategyResolver(0, fn));
    };
    Container.prototype.autoRegisterAll = function (fns) {
        var i = fns.length;
        while (i--) {
            this.autoRegister(fns[i]);
        }
    };
    Container.prototype.unregister = function (key) {
        this._resolvers.delete(key);
    };
    Container.prototype.hasResolver = function (key, checkParent) {
        if (checkParent === void 0) { checkParent = false; }
        validateKey(key);
        return (this._resolvers.has(key) ||
            (checkParent &&
                this.parent !== null &&
                this.parent.hasResolver(key, checkParent)));
    };
    Container.prototype.getResolver = function (key) {
        return this._resolvers.get(key);
    };
    Container.prototype.get = function (key) {
        validateKey(key);
        if (key === Container) {
            return this;
        }
        if (resolverDecorates(key)) {
            return key.get(this, key);
        }
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return this.autoRegister(key).get(this, key);
            }
            var registration = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, key);
            if (registration === undefined) {
                return this.parent._get(key);
            }
            return registration.registerResolver(this, key, key).get(this, key);
        }
        return resolver$$1.get(this, key);
    };
    Container.prototype._get = function (key) {
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return this.autoRegister(key).get(this, key);
            }
            return this.parent._get(key);
        }
        return resolver$$1.get(this, key);
    };
    Container.prototype.getAll = function (key) {
        validateKey(key);
        var resolver$$1 = this._resolvers.get(key);
        if (resolver$$1 === undefined) {
            if (this.parent === null) {
                return _emptyParameters;
            }
            return this.parent.getAll(key);
        }
        if (resolver$$1.strategy === 4) {
            var state = resolver$$1.state;
            var i = state.length;
            var results = new Array(i);
            while (i--) {
                results[i] = state[i].get(this, key);
            }
            return results;
        }
        return [resolver$$1.get(this, key)];
    };
    Container.prototype.createChild = function () {
        var child = new Container(this._configuration);
        child.root = this.root;
        child.parent = this;
        return child;
    };
    Container.prototype.invoke = function (fn, dynamicDependencies) {
        try {
            var handler = this._handlers.get(fn);
            if (handler === undefined) {
                handler = this._createInvocationHandler(fn);
                this._handlers.set(fn, handler);
            }
            return handler.invoke(this, dynamicDependencies);
        }
        catch (e) {
            throw new __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["AggregateError"]("Error invoking " + fn.name + ". Check the inner error for details.", e, true);
        }
    };
    Container.prototype._createInvocationHandler = function (fn) {
        var dependencies;
        if (fn.inject === undefined) {
            dependencies =
                __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].paramTypes, fn) || _emptyParameters;
        }
        else {
            dependencies = [];
            var ctor = fn;
            while (typeof ctor === 'function') {
                dependencies.push.apply(dependencies, getDependencies(ctor));
                ctor = Object.getPrototypeOf(ctor);
            }
        }
        var invoker = __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, fn) || classInvoker;
        var handler = new InvocationHandler(fn, invoker, dependencies);
        return this._onHandlerCreated !== undefined
            ? this._onHandlerCreated(handler)
            : handler;
    };
    return Container;
}());

function invoker(value) {
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, value, target);
    };
}
function invokeAsFactory(potentialTarget) {
    var deco = function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].invoker, FactoryInvoker.instance, target);
    };
    return potentialTarget ? deco(potentialTarget) : deco;
}
var FactoryInvoker = (function () {
    function FactoryInvoker() {
    }
    FactoryInvoker.prototype.invoke = function (container, fn, dependencies) {
        var i = dependencies.length;
        var args = new Array(i);
        while (i--) {
            args[i] = container.get(dependencies[i]);
        }
        return fn.apply(undefined, args);
    };
    FactoryInvoker.prototype.invokeWithDynamicDependencies = function (container, fn, staticDependencies, dynamicDependencies) {
        var i = staticDependencies.length;
        var args = new Array(i);
        while (i--) {
            args[i] = container.get(staticDependencies[i]);
        }
        if (dynamicDependencies !== undefined) {
            args = args.concat(dynamicDependencies);
        }
        return fn.apply(undefined, args);
    };
    return FactoryInvoker;
}());
FactoryInvoker.instance = new FactoryInvoker();

function registration(value) {
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_0_aurelia_metadata__["metadata"].registration, value, target);
    };
}
function transient(key) {
    return registration(new TransientRegistration(key));
}
function singleton(keyOrRegisterInChild, registerInChild) {
    if (registerInChild === void 0) { registerInChild = false; }
    return registration(new SingletonRegistration(keyOrRegisterInChild, registerInChild));
}
var TransientRegistration = (function () {
    function TransientRegistration(key) {
        this._key = key;
    }
    TransientRegistration.prototype.registerResolver = function (container, key, fn) {
        var existingResolver = container.getResolver(this._key || key);
        return existingResolver === undefined
            ? container.registerTransient((this._key || key), fn)
            : existingResolver;
    };
    return TransientRegistration;
}());
var SingletonRegistration = (function () {
    function SingletonRegistration(keyOrRegisterInChild, registerInChild) {
        if (registerInChild === void 0) { registerInChild = false; }
        if (typeof keyOrRegisterInChild === 'boolean') {
            this._registerInChild = keyOrRegisterInChild;
        }
        else {
            this._key = keyOrRegisterInChild;
            this._registerInChild = registerInChild;
        }
    }
    SingletonRegistration.prototype.registerResolver = function (container, key, fn) {
        var targetContainer = this._registerInChild ? container : container.root;
        var existingResolver = targetContainer.getResolver(this._key || key);
        return existingResolver === undefined
            ? targetContainer.registerSingleton(this._key || key, fn)
            : existingResolver;
    };
    return SingletonRegistration;
}());




/***/ },

/***/ 1354:
/***/ function(module, exports, __webpack_require__) {

__webpack_require__("aurelia-binding");
__webpack_require__(1);
__webpack_require__("aurelia-event-aggregator");
__webpack_require__("aurelia-framework");
__webpack_require__(213);
__webpack_require__("aurelia-history-browser");
__webpack_require__("aurelia-loader");
__webpack_require__("aurelia-loader-webpack");
__webpack_require__(70);
__webpack_require__("aurelia-logging-console");
__webpack_require__(58);
__webpack_require__(23);
__webpack_require__("aurelia-route-recognizer");
__webpack_require__("aurelia-router");
__webpack_require__(138);
__webpack_require__(44);
__webpack_require__("aurelia-templating-binding");
__webpack_require__("aurelia-templating-router");
module.exports = __webpack_require__("aurelia-templating-resources");


/***/ },

/***/ 138:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "TaskQueue", function() { return TaskQueue; });
var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };





var stackSeparator = '\nEnqueued in TaskQueue by:\n';
var microStackSeparator = '\nEnqueued in MicroTaskQueue by:\n';

function makeRequestFlushFromMutationObserver(flush) {
  var observer = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createMutationObserver(flush);
  var val = 'a';
  var node = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createTextNode('a');
  var values = Object.create(null);
  values.a = 'b';
  values.b = 'a';
  observer.observe(node, { characterData: true });
  return function requestFlush() {
    node.data = val = values[val];
  };
}

function makeRequestFlushFromTimer(flush) {
  return function requestFlush() {
    var timeoutHandle = setTimeout(handleFlushTimer, 0);

    var intervalHandle = setInterval(handleFlushTimer, 50);
    function handleFlushTimer() {
      clearTimeout(timeoutHandle);
      clearInterval(intervalHandle);
      flush();
    }
  };
}

function onError(error, task, longStacks) {
  if (longStacks && task.stack && (typeof error === 'undefined' ? 'undefined' : _typeof(error)) === 'object' && error !== null) {
    error.stack = filterFlushStack(error.stack) + task.stack;
  }

  if ('onError' in task) {
    task.onError(error);
  } else {
    setTimeout(function () {
      throw error;
    }, 0);
  }
}

var TaskQueue = function () {
  function TaskQueue() {
    var _this = this;

    

    this.flushing = false;
    this.longStacks = false;

    this.microTaskQueue = [];
    this.microTaskQueueCapacity = 1024;
    this.taskQueue = [];

    if (__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["FEATURE"].mutationObserver) {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromMutationObserver(function () {
        return _this.flushMicroTaskQueue();
      });
    } else {
      this.requestFlushMicroTaskQueue = makeRequestFlushFromTimer(function () {
        return _this.flushMicroTaskQueue();
      });
    }

    this.requestFlushTaskQueue = makeRequestFlushFromTimer(function () {
      return _this.flushTaskQueue();
    });
  }

  TaskQueue.prototype._flushQueue = function _flushQueue(queue, capacity) {
    var index = 0;
    var task = void 0;

    try {
      this.flushing = true;
      while (index < queue.length) {
        task = queue[index];
        if (this.longStacks) {
          this.stack = typeof task.stack === 'string' ? task.stack : undefined;
        }
        task.call();
        index++;

        if (index > capacity) {
          for (var scan = 0, newLength = queue.length - index; scan < newLength; scan++) {
            queue[scan] = queue[scan + index];
          }

          queue.length -= index;
          index = 0;
        }
      }
    } catch (error) {
      onError(error, task, this.longStacks);
    } finally {
      this.flushing = false;
    }
  };

  TaskQueue.prototype.queueMicroTask = function queueMicroTask(task) {
    if (this.microTaskQueue.length < 1) {
      this.requestFlushMicroTaskQueue();
    }

    if (this.longStacks) {
      task.stack = this.prepareQueueStack(microStackSeparator);
    }

    this.microTaskQueue.push(task);
  };

  TaskQueue.prototype.queueTask = function queueTask(task) {
    if (this.taskQueue.length < 1) {
      this.requestFlushTaskQueue();
    }

    if (this.longStacks) {
      task.stack = this.prepareQueueStack(stackSeparator);
    }

    this.taskQueue.push(task);
  };

  TaskQueue.prototype.flushTaskQueue = function flushTaskQueue() {
    var queue = this.taskQueue;
    this.taskQueue = [];
    this._flushQueue(queue, Number.MAX_VALUE);
  };

  TaskQueue.prototype.flushMicroTaskQueue = function flushMicroTaskQueue() {
    var queue = this.microTaskQueue;
    this._flushQueue(queue, this.microTaskQueueCapacity);
    queue.length = 0;
  };

  TaskQueue.prototype.prepareQueueStack = function prepareQueueStack(separator) {
    var stack = separator + filterQueueStack(captureStack());

    if (typeof this.stack === 'string') {
      stack = filterFlushStack(stack) + this.stack;
    }

    return stack;
  };

  return TaskQueue;
}();

function captureStack() {
  var error = new Error();

  if (error.stack) {
    return error.stack;
  }

  try {
    throw error;
  } catch (e) {
    return e.stack;
  }
}

function filterQueueStack(stack) {
  return stack.replace(/^[\s\S]*?\bqueue(Micro)?Task\b[^\n]*\n/, '');
}

function filterFlushStack(stack) {
  var index = stack.lastIndexOf('flushMicroTaskQueue');

  if (index < 0) {
    index = stack.lastIndexOf('flushTaskQueue');
    if (index < 0) {
      return stack;
    }
  }

  index = stack.lastIndexOf('\n', index);

  return index < 0 ? stack : stack.substr(0, index);
}

/***/ },

/***/ 213:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "History", function() { return History; });


function mi(name) {
  throw new Error('History must implement ' + name + '().');
}

var History = function () {
  function History() {
    
  }

  History.prototype.activate = function activate(options) {
    mi('activate');
  };

  History.prototype.deactivate = function deactivate() {
    mi('deactivate');
  };

  History.prototype.getAbsoluteRoot = function getAbsoluteRoot() {
    mi('getAbsoluteRoot');
  };

  History.prototype.navigate = function navigate(fragment, options) {
    mi('navigate');
  };

  History.prototype.navigateBack = function navigateBack() {
    mi('navigateBack');
  };

  History.prototype.setTitle = function setTitle(title) {
    mi('setTitle');
  };

  History.prototype.setState = function setState(key, value) {
    mi('setState');
  };

  History.prototype.getState = function getState(key) {
    mi('getState');
  };

  History.prototype.getHistoryIndex = function getHistoryIndex() {
    mi('getHistoryIndex');
  };

  History.prototype.go = function go(movement) {
    mi('go');
  };

  return History;
}();

/***/ },

/***/ 44:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_task_queue__ = __webpack_require__(138);
/* harmony export (binding) */ __webpack_require__.d(exports, "Animator", function() { return Animator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BehaviorInstruction", function() { return BehaviorInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BehaviorPropertyObserver", function() { return BehaviorPropertyObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindableProperty", function() { return BindableProperty; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingLanguage", function() { return BindingLanguage; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BoundViewFactory", function() { return BoundViewFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionEngine", function() { return CompositionEngine; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransaction", function() { return CompositionTransaction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransactionNotifier", function() { return CompositionTransactionNotifier; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CompositionTransactionOwnershipToken", function() { return CompositionTransactionOwnershipToken; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Controller", function() { return Controller; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ConventionalViewStrategy", function() { return ConventionalViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ElementConfigResource", function() { return ElementConfigResource; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ElementEvents", function() { return ElementEvents; });
/* harmony export (binding) */ __webpack_require__.d(exports, "HtmlBehaviorResource", function() { return HtmlBehaviorResource; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InlineViewStrategy", function() { return InlineViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ModuleAnalyzer", function() { return ModuleAnalyzer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NoViewStrategy", function() { return NoViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PassThroughSlot", function() { return PassThroughSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RelativeViewStrategy", function() { return RelativeViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceDescription", function() { return ResourceDescription; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceLoadContext", function() { return ResourceLoadContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ResourceModule", function() { return ResourceModule; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ShadowDOM", function() { return ShadowDOM; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ShadowSlot", function() { return ShadowSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SlotCustomAttribute", function() { return SlotCustomAttribute; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StaticViewStrategy", function() { return StaticViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SwapStrategies", function() { return SwapStrategies; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TargetInstruction", function() { return TargetInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplateRegistryViewStrategy", function() { return TemplateRegistryViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingEngine", function() { return TemplatingEngine; });
/* harmony export (binding) */ __webpack_require__.d(exports, "View", function() { return View; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewCompileInstruction", function() { return ViewCompileInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewCompiler", function() { return ViewCompiler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewEngine", function() { return ViewEngine; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewEngineHooksResource", function() { return ViewEngineHooksResource; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewFactory", function() { return ViewFactory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewLocator", function() { return ViewLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewResources", function() { return ViewResources; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ViewSlot", function() { return ViewSlot; });
/* harmony export (binding) */ __webpack_require__.d(exports, "_hyphenate", function() { return _hyphenate; });
/* harmony export (binding) */ __webpack_require__.d(exports, "_isAllWhitespace", function() { return _isAllWhitespace; });
/* harmony export (binding) */ __webpack_require__.d(exports, "animationEvent", function() { return animationEvent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "behavior", function() { return behavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "bindable", function() { return bindable; });
/* harmony export (binding) */ __webpack_require__.d(exports, "child", function() { return child; });
/* harmony export (binding) */ __webpack_require__.d(exports, "children", function() { return children; });
/* harmony export (binding) */ __webpack_require__.d(exports, "containerless", function() { return containerless; });
/* harmony export (binding) */ __webpack_require__.d(exports, "customAttribute", function() { return customAttribute; });
/* harmony export (binding) */ __webpack_require__.d(exports, "customElement", function() { return customElement; });
/* harmony export (binding) */ __webpack_require__.d(exports, "dynamicOptions", function() { return dynamicOptions; });
/* harmony export (binding) */ __webpack_require__.d(exports, "elementConfig", function() { return elementConfig; });
/* harmony export (binding) */ __webpack_require__.d(exports, "inlineView", function() { return inlineView; });
/* harmony export (binding) */ __webpack_require__.d(exports, "noView", function() { return noView; });
/* harmony export (binding) */ __webpack_require__.d(exports, "processAttributes", function() { return processAttributes; });
/* harmony export (binding) */ __webpack_require__.d(exports, "processContent", function() { return processContent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "resource", function() { return resource; });
/* harmony export (binding) */ __webpack_require__.d(exports, "templateController", function() { return templateController; });
/* harmony export (binding) */ __webpack_require__.d(exports, "useShadowDOM", function() { return useShadowDOM; });
/* harmony export (binding) */ __webpack_require__.d(exports, "useView", function() { return useView; });
/* harmony export (binding) */ __webpack_require__.d(exports, "useViewStrategy", function() { return useViewStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "validateBehaviorName", function() { return validateBehaviorName; });
/* harmony export (binding) */ __webpack_require__.d(exports, "view", function() { return view; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewEngineHooks", function() { return viewEngineHooks; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewResources", function() { return viewResources; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewStrategy", function() { return viewStrategy; });









var ElementEvents = (function () {
    function ElementEvents(element) {
        this.element = element;
        this.subscriptions = {};
    }
    ElementEvents.prototype._enqueueHandler = function (handler) {
        this.subscriptions[handler.eventName] = this.subscriptions[handler.eventName] || [];
        this.subscriptions[handler.eventName].push(handler);
    };
    ElementEvents.prototype._dequeueHandler = function (handler) {
        var index;
        var subscriptions = this.subscriptions[handler.eventName];
        if (subscriptions) {
            index = subscriptions.indexOf(handler);
            if (index > -1) {
                subscriptions.splice(index, 1);
            }
        }
        return handler;
    };
    ElementEvents.prototype.publish = function (eventName, detail, bubbles, cancelable) {
        if (detail === void 0) { detail = {}; }
        if (bubbles === void 0) { bubbles = true; }
        if (cancelable === void 0) { cancelable = true; }
        var event = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createCustomEvent(eventName, { cancelable: cancelable, bubbles: bubbles, detail: detail });
        this.element.dispatchEvent(event);
    };
    ElementEvents.prototype.subscribe = function (eventName, handler, captureOrOptions) {
        if (typeof handler === 'function') {
            if (captureOrOptions === undefined) {
                captureOrOptions = ElementEvents.defaultListenerOptions;
            }
            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, false);
            return eventHandler;
        }
        return undefined;
    };
    ElementEvents.prototype.subscribeOnce = function (eventName, handler, captureOrOptions) {
        if (typeof handler === 'function') {
            if (captureOrOptions === undefined) {
                captureOrOptions = ElementEvents.defaultListenerOptions;
            }
            var eventHandler = new EventHandlerImpl(this, eventName, handler, captureOrOptions, true);
            return eventHandler;
        }
        return undefined;
    };
    ElementEvents.prototype.dispose = function (eventName) {
        if (eventName && typeof eventName === 'string') {
            var subscriptions = this.subscriptions[eventName];
            if (subscriptions) {
                while (subscriptions.length) {
                    var subscription = subscriptions.pop();
                    if (subscription) {
                        subscription.dispose();
                    }
                }
            }
        }
        else {
            this.disposeAll();
        }
    };
    ElementEvents.prototype.disposeAll = function () {
        for (var key in this.subscriptions) {
            this.dispose(key);
        }
    };
    ElementEvents.defaultListenerOptions = true;
    return ElementEvents;
}());
var EventHandlerImpl = (function () {
    function EventHandlerImpl(owner, eventName, handler, captureOrOptions, once) {
        this.owner = owner;
        this.eventName = eventName;
        this.handler = handler;
        this.capture = typeof captureOrOptions === 'boolean' ? captureOrOptions : captureOrOptions.capture;
        this.bubbles = !this.capture;
        this.captureOrOptions = captureOrOptions;
        this.once = once;
        owner.element.addEventListener(eventName, this, captureOrOptions);
        owner._enqueueHandler(this);
    }
    EventHandlerImpl.prototype.handleEvent = function (e) {
        var fn = this.handler;
        fn(e);
        if (this.once) {
            this.dispose();
        }
    };
    EventHandlerImpl.prototype.dispose = function () {
        this.owner.element.removeEventListener(this.eventName, this, this.captureOrOptions);
        this.owner._dequeueHandler(this);
        this.owner = this.handler = null;
    };
    return EventHandlerImpl;
}());

var ResourceLoadContext = (function () {
    function ResourceLoadContext() {
        this.dependencies = {};
    }
    ResourceLoadContext.prototype.addDependency = function (url) {
        this.dependencies[url] = true;
    };
    ResourceLoadContext.prototype.hasDependency = function (url) {
        return url in this.dependencies;
    };
    return ResourceLoadContext;
}());
var ViewCompileInstruction = (function () {
    function ViewCompileInstruction(targetShadowDOM, compileSurrogate) {
        if (targetShadowDOM === void 0) { targetShadowDOM = false; }
        if (compileSurrogate === void 0) { compileSurrogate = false; }
        this.targetShadowDOM = targetShadowDOM;
        this.compileSurrogate = compileSurrogate;
        this.associatedModuleId = null;
    }
    ViewCompileInstruction.normal = new ViewCompileInstruction();
    return ViewCompileInstruction;
}());
var BehaviorInstruction = (function () {
    function BehaviorInstruction() {
    }
    BehaviorInstruction.enhance = function () {
        var instruction = new BehaviorInstruction();
        instruction.enhance = true;
        return instruction;
    };
    BehaviorInstruction.unitTest = function (type, attributes) {
        var instruction = new BehaviorInstruction();
        instruction.type = type;
        instruction.attributes = attributes || {};
        return instruction;
    };
    BehaviorInstruction.element = function (node, type) {
        var instruction = new BehaviorInstruction();
        instruction.type = type;
        instruction.attributes = {};
        instruction.anchorIsContainer = !(node.hasAttribute('containerless') || type.containerless);
        instruction.initiatedByBehavior = true;
        return instruction;
    };
    BehaviorInstruction.attribute = function (attrName, type) {
        var instruction = new BehaviorInstruction();
        instruction.attrName = attrName;
        instruction.type = type || null;
        instruction.attributes = {};
        return instruction;
    };
    BehaviorInstruction.dynamic = function (host, viewModel, viewFactory) {
        var instruction = new BehaviorInstruction();
        instruction.host = host;
        instruction.viewModel = viewModel;
        instruction.viewFactory = viewFactory;
        instruction.inheritBindingContext = true;
        return instruction;
    };
    BehaviorInstruction.normal = new BehaviorInstruction();
    return BehaviorInstruction;
}());
var biProto = BehaviorInstruction.prototype;
biProto.initiatedByBehavior = false;
biProto.enhance = false;
biProto.partReplacements = null;
biProto.viewFactory = null;
biProto.originalAttrName = null;
biProto.skipContentProcessing = false;
biProto.contentFactory = null;
biProto.viewModel = null;
biProto.anchorIsContainer = false;
biProto.host = null;
biProto.attributes = null;
biProto.type = null;
biProto.attrName = null;
biProto.inheritBindingContext = false;
var TargetInstruction = (function () {
    function TargetInstruction() {
    }
    TargetInstruction.shadowSlot = function (parentInjectorId) {
        var instruction = new TargetInstruction();
        instruction.parentInjectorId = parentInjectorId;
        instruction.shadowSlot = true;
        return instruction;
    };
    TargetInstruction.contentExpression = function (expression) {
        var instruction = new TargetInstruction();
        instruction.contentExpression = expression;
        return instruction;
    };
    TargetInstruction.letElement = function (expressions) {
        var instruction = new TargetInstruction();
        instruction.expressions = expressions;
        instruction.letElement = true;
        return instruction;
    };
    TargetInstruction.lifting = function (parentInjectorId, liftingInstruction) {
        var instruction = new TargetInstruction();
        instruction.parentInjectorId = parentInjectorId;
        instruction.expressions = TargetInstruction.noExpressions;
        instruction.behaviorInstructions = [liftingInstruction];
        instruction.viewFactory = liftingInstruction.viewFactory;
        instruction.providers = [liftingInstruction.type.target];
        instruction.lifting = true;
        return instruction;
    };
    TargetInstruction.normal = function (injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction) {
        var instruction = new TargetInstruction();
        instruction.injectorId = injectorId;
        instruction.parentInjectorId = parentInjectorId;
        instruction.providers = providers;
        instruction.behaviorInstructions = behaviorInstructions;
        instruction.expressions = expressions;
        instruction.anchorIsContainer = elementInstruction ? elementInstruction.anchorIsContainer : true;
        instruction.elementInstruction = elementInstruction;
        return instruction;
    };
    TargetInstruction.surrogate = function (providers, behaviorInstructions, expressions, values) {
        var instruction = new TargetInstruction();
        instruction.expressions = expressions;
        instruction.behaviorInstructions = behaviorInstructions;
        instruction.providers = providers;
        instruction.values = values;
        return instruction;
    };
    TargetInstruction.noExpressions = Object.freeze([]);
    return TargetInstruction;
}());
var tiProto = TargetInstruction.prototype;
tiProto.injectorId = null;
tiProto.parentInjectorId = null;
tiProto.shadowSlot = false;
tiProto.slotName = null;
tiProto.slotFallbackFactory = null;
tiProto.contentExpression = null;
tiProto.letElement = false;
tiProto.expressions = null;
tiProto.expressions = null;
tiProto.providers = null;
tiProto.viewFactory = null;
tiProto.anchorIsContainer = false;
tiProto.elementInstruction = null;
tiProto.lifting = false;
tiProto.values = null;

/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

var capitalMatcher = /([A-Z])/g;
function addHyphenAndLower(char) {
    return '-' + char.toLowerCase();
}
function _hyphenate(name) {
    return (name.charAt(0).toLowerCase() + name.slice(1)).replace(capitalMatcher, addHyphenAndLower);
}
function _isAllWhitespace(node) {
    return !(node.auInterpolationTarget || (/[^\t\n\r ]/.test(node.textContent)));
}

var BehaviorPropertyObserver = (function () {
    function BehaviorPropertyObserver(taskQueue, obj, propertyName, selfSubscriber, initialValue) {
        this.taskQueue = taskQueue;
        this.obj = obj;
        this.propertyName = propertyName;
        this.notqueued = true;
        this.publishing = false;
        this.selfSubscriber = selfSubscriber;
        this.currentValue = this.oldValue = initialValue;
    }
    BehaviorPropertyObserver.prototype.getValue = function () {
        return this.currentValue;
    };
    BehaviorPropertyObserver.prototype.setValue = function (newValue) {
        var oldValue = this.currentValue;
        if (!Object.is(newValue, oldValue)) {
            this.oldValue = oldValue;
            this.currentValue = newValue;
            if (this.publishing && this.notqueued) {
                if (this.taskQueue.flushing) {
                    this.call();
                }
                else {
                    this.notqueued = false;
                    this.taskQueue.queueMicroTask(this);
                }
            }
        }
    };
    BehaviorPropertyObserver.prototype.call = function () {
        var oldValue = this.oldValue;
        var newValue = this.currentValue;
        this.notqueued = true;
        if (Object.is(newValue, oldValue)) {
            return;
        }
        if (this.selfSubscriber) {
            this.selfSubscriber(newValue, oldValue);
        }
        this.callSubscribers(newValue, oldValue);
        this.oldValue = newValue;
    };
    BehaviorPropertyObserver.prototype.callSubscribers = function (newValue, oldValue) {
        throw new Error('Method not implemented.');
    };
    BehaviorPropertyObserver.prototype.subscribe = function (context, callable) {
        this.addSubscriber(context, callable);
    };
    BehaviorPropertyObserver.prototype.addSubscriber = function (context, callable) {
        throw new Error('Method not implemented.');
    };
    BehaviorPropertyObserver.prototype.unsubscribe = function (context, callable) {
        this.removeSubscriber(context, callable);
    };
    BehaviorPropertyObserver.prototype.removeSubscriber = function (context, callable) {
        throw new Error('Method not implemented.');
    };
    BehaviorPropertyObserver = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["subscriberCollection"])()
    ], BehaviorPropertyObserver);
    return BehaviorPropertyObserver;
}());

function getObserver(instance, name) {
    var lookup = instance.__observers__;
    if (lookup === undefined) {
        var ctor = Object.getPrototypeOf(instance).constructor;
        var behavior = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, ctor);
        if (!behavior.isInitialized) {
            behavior.initialize(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"].instance || new __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"](), instance.constructor);
        }
        lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);
        behavior._ensurePropertiesDefined(instance, lookup);
    }
    return lookup[name];
}
var BindableProperty = (function () {
    function BindableProperty(nameOrConfig) {
        if (typeof nameOrConfig === 'string') {
            this.name = nameOrConfig;
        }
        else {
            Object.assign(this, nameOrConfig);
        }
        this.attribute = this.attribute || _hyphenate(this.name);
        var defaultBindingMode = this.defaultBindingMode;
        if (defaultBindingMode === null || defaultBindingMode === undefined) {
            this.defaultBindingMode = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"].oneWay;
        }
        else if (typeof defaultBindingMode === 'string') {
            this.defaultBindingMode = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"][defaultBindingMode] || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["bindingMode"].oneWay;
        }
        this.changeHandler = this.changeHandler || null;
        this.owner = null;
        this.descriptor = null;
    }
    BindableProperty.prototype.registerWith = function (target, behavior, descriptor) {
        behavior.properties.push(this);
        behavior.attributes[this.attribute] = this;
        this.owner = behavior;
        if (descriptor) {
            this.descriptor = descriptor;
            return this._configureDescriptor(descriptor);
        }
        return undefined;
    };
    BindableProperty.prototype._configureDescriptor = function (descriptor) {
        var name = this.name;
        descriptor.configurable = true;
        descriptor.enumerable = true;
        if ('initializer' in descriptor) {
            this.defaultValue = descriptor.initializer;
            delete descriptor.initializer;
            delete descriptor.writable;
        }
        if ('value' in descriptor) {
            this.defaultValue = descriptor.value;
            delete descriptor.value;
            delete descriptor.writable;
        }
        descriptor.get = function () {
            return getObserver(this, name).getValue();
        };
        descriptor.set = function (value) {
            getObserver(this, name).setValue(value);
        };
        descriptor.get.getObserver = function (obj) {
            return getObserver(obj, name);
        };
        return descriptor;
    };
    BindableProperty.prototype.defineOn = function (target, behavior) {
        var name = this.name;
        var handlerName;
        if (this.changeHandler === null) {
            handlerName = name + 'Changed';
            if (handlerName in target.prototype) {
                this.changeHandler = handlerName;
            }
        }
        if (this.descriptor === null) {
            Object.defineProperty(target.prototype, name, this._configureDescriptor({}));
        }
    };
    BindableProperty.prototype.createObserver = function (viewModel) {
        var selfSubscriber = null;
        var defaultValue = this.defaultValue;
        var changeHandlerName = this.changeHandler;
        var name = this.name;
        var initialValue;
        if (this.hasOptions) {
            return undefined;
        }
        if (changeHandlerName in viewModel) {
            if ('propertyChanged' in viewModel) {
                selfSubscriber = function (newValue, oldValue) {
                    viewModel[changeHandlerName](newValue, oldValue);
                    viewModel.propertyChanged(name, newValue, oldValue);
                };
            }
            else {
                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };
            }
        }
        else if ('propertyChanged' in viewModel) {
            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };
        }
        else if (changeHandlerName !== null) {
            throw new Error("Change handler ".concat(changeHandlerName, " was specified but not declared on the class."));
        }
        if (defaultValue !== undefined) {
            initialValue = typeof defaultValue === 'function' ? defaultValue.call(viewModel) : defaultValue;
        }
        return new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, this.name, selfSubscriber, initialValue);
    };
    BindableProperty.prototype._initialize = function (viewModel, observerLookup, attributes, behaviorHandlesBind, boundProperties) {
        var selfSubscriber;
        var observer;
        var attribute;
        var defaultValue = this.defaultValue;
        if (this.isDynamic) {
            for (var key in attributes) {
                this._createDynamicProperty(viewModel, observerLookup, behaviorHandlesBind, key, attributes[key], boundProperties);
            }
        }
        else if (!this.hasOptions) {
            observer = observerLookup[this.name];
            if (attributes !== null) {
                selfSubscriber = observer.selfSubscriber;
                attribute = attributes[this.attribute];
                if (behaviorHandlesBind) {
                    observer.selfSubscriber = null;
                }
                if (typeof attribute === 'string') {
                    viewModel[this.name] = attribute;
                    observer.call();
                }
                else if (attribute) {
                    boundProperties.push({ observer: observer, binding: attribute.createBinding(viewModel) });
                }
                else if (defaultValue !== undefined) {
                    observer.call();
                }
                observer.selfSubscriber = selfSubscriber;
            }
            observer.publishing = true;
        }
    };
    BindableProperty.prototype._createDynamicProperty = function (viewModel, observerLookup, behaviorHandlesBind, name, attribute, boundProperties) {
        var changeHandlerName = name + 'Changed';
        var selfSubscriber = null;
        var observer;
        var info;
        if (changeHandlerName in viewModel) {
            if ('propertyChanged' in viewModel) {
                selfSubscriber = function (newValue, oldValue) {
                    viewModel[changeHandlerName](newValue, oldValue);
                    viewModel.propertyChanged(name, newValue, oldValue);
                };
            }
            else {
                selfSubscriber = function (newValue, oldValue) { return viewModel[changeHandlerName](newValue, oldValue); };
            }
        }
        else if ('propertyChanged' in viewModel) {
            selfSubscriber = function (newValue, oldValue) { return viewModel.propertyChanged(name, newValue, oldValue); };
        }
        observer = observerLookup[name] = new BehaviorPropertyObserver(this.owner.taskQueue, viewModel, name, selfSubscriber);
        Object.defineProperty(viewModel, name, {
            configurable: true,
            enumerable: true,
            get: observer.getValue.bind(observer),
            set: observer.setValue.bind(observer)
        });
        if (behaviorHandlesBind) {
            observer.selfSubscriber = null;
        }
        if (typeof attribute === 'string') {
            viewModel[name] = attribute;
            observer.call();
        }
        else if (attribute) {
            info = { observer: observer, binding: attribute.createBinding(viewModel) };
            boundProperties.push(info);
        }
        observer.publishing = true;
        observer.selfSubscriber = selfSubscriber;
    };
    return BindableProperty;
}());

var ViewLocator = (function () {
    function ViewLocator() {
    }
    ViewLocator.prototype.getViewStrategy = function (value) {
        if (!value) {
            return null;
        }
        if (typeof value === 'object' && 'getViewStrategy' in value) {
            var origin_1 = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(value.constructor);
            value = value.getViewStrategy();
            if (typeof value === 'string') {
                value = new RelativeViewStrategy(value);
            }
            viewStrategy.assert(value);
            if (origin_1.moduleId) {
                value.makeRelativeTo(origin_1.moduleId);
            }
            return value;
        }
        if (typeof value === 'string') {
            value = new RelativeViewStrategy(value);
        }
        if (viewStrategy.validate(value)) {
            return value;
        }
        if (typeof value !== 'function') {
            value = value.constructor;
        }
        if ('$view' in value) {
            var c = value.$view;
            var view = void 0;
            c = typeof c === 'function' ? c.call(value) : c;
            if (c === null) {
                view = new NoViewStrategy();
            }
            else {
                view = c instanceof StaticViewStrategy ? c : new StaticViewStrategy(c);
            }
            __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, view, value);
            return view;
        }
        var origin = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(value);
        var strategy = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].get(ViewLocator.viewStrategyMetadataKey, value);
        if (!strategy) {
            if (!origin.moduleId) {
                throw new Error('Cannot determine default view strategy for object.\n' + value);
            }
            strategy = this.createFallbackViewStrategy(origin);
        }
        else if (origin.moduleId) {
            strategy.moduleId = origin.moduleId;
        }
        return strategy;
    };
    ViewLocator.prototype.createFallbackViewStrategy = function (origin) {
        return new ConventionalViewStrategy(this, origin);
    };
    ViewLocator.prototype.convertOriginToViewUrl = function (origin) {
        var moduleId = origin.moduleId;
        var id = (moduleId.endsWith('.js') || moduleId.endsWith('.ts')) ? moduleId.substring(0, moduleId.length - 3) : moduleId;
        return id + '.html';
    };
    ViewLocator.viewStrategyMetadataKey = 'aurelia:view-strategy';
    return ViewLocator;
}());

function mi(name) {
    throw new Error("BindingLanguage must implement ".concat(name, "()."));
}
var BindingLanguage = (function () {
    function BindingLanguage() {
    }
    BindingLanguage.prototype.inspectAttribute = function (resources, elementName, attrName, attrValue) {
        mi('inspectAttribute');
    };
    BindingLanguage.prototype.createAttributeInstruction = function (resources, element, info, existingInstruction, context) {
        mi('createAttributeInstruction');
    };
    BindingLanguage.prototype.createLetExpressions = function (resources, element) {
        mi('createLetExpressions');
    };
    BindingLanguage.prototype.inspectTextContent = function (resources, value) {
        mi('inspectTextContent');
    };
    return BindingLanguage;
}());

var noNodes = Object.freeze([]);
var SlotCustomAttribute = (function () {
    function SlotCustomAttribute(element) {
        this.element = element;
        this.element.auSlotAttribute = this;
    }
    SlotCustomAttribute.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element];
    };
    SlotCustomAttribute.prototype.valueChanged = function (newValue, oldValue) { };
    return SlotCustomAttribute;
}());
var PassThroughSlot = (function () {
    function PassThroughSlot(anchor, name, destinationName, fallbackFactory) {
        this.anchor = anchor;
        this.anchor.viewSlot = this;
        this.name = name;
        this.destinationName = destinationName;
        this.fallbackFactory = fallbackFactory;
        this.destinationSlot = null;
        this.projections = 0;
        this.contentView = null;
        var attr = new SlotCustomAttribute(this.anchor);
        attr.value = this.destinationName;
    }
    Object.defineProperty(PassThroughSlot.prototype, "needsFallbackRendering", {
        get: function () {
            return this.fallbackFactory && this.projections === 0;
        },
        enumerable: false,
        configurable: true
    });
    PassThroughSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {
        if (this.contentView === null) {
            this.contentView = this.fallbackFactory.create(this.ownerView.container);
            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);
            var slots = Object.create(null);
            slots[this.destinationSlot.name] = this.destinationSlot;
            ShadowDOM.distributeView(this.contentView, slots, projectionSource, index, this.destinationSlot.name);
        }
    };
    PassThroughSlot.prototype.passThroughTo = function (destinationSlot) {
        this.destinationSlot = destinationSlot;
    };
    PassThroughSlot.prototype.addNode = function (view, node, projectionSource, index) {
        if (this.contentView !== null) {
            this.contentView.removeNodes();
            this.contentView.detached();
            this.contentView.unbind();
            this.contentView = null;
        }
        if (node.viewSlot instanceof PassThroughSlot) {
            node.viewSlot.passThroughTo(this);
            return;
        }
        this.projections++;
        this.destinationSlot.addNode(view, node, projectionSource, index);
    };
    PassThroughSlot.prototype.removeView = function (view, projectionSource) {
        this.projections--;
        this.destinationSlot.removeView(view, projectionSource);
        if (this.needsFallbackRendering) {
            this.renderFallbackContent(null, noNodes, projectionSource);
        }
    };
    PassThroughSlot.prototype.removeAll = function (projectionSource) {
        this.projections = 0;
        this.destinationSlot.removeAll(projectionSource);
        if (this.needsFallbackRendering) {
            this.renderFallbackContent(null, noNodes, projectionSource);
        }
    };
    PassThroughSlot.prototype.projectFrom = function (view, projectionSource) {
        this.destinationSlot.projectFrom(view, projectionSource);
    };
    PassThroughSlot.prototype.created = function (ownerView) {
        this.ownerView = ownerView;
    };
    PassThroughSlot.prototype.bind = function (view) {
        if (this.contentView) {
            this.contentView.bind(view.bindingContext, view.overrideContext);
        }
    };
    PassThroughSlot.prototype.attached = function () {
        if (this.contentView) {
            this.contentView.attached();
        }
    };
    PassThroughSlot.prototype.detached = function () {
        if (this.contentView) {
            this.contentView.detached();
        }
    };
    PassThroughSlot.prototype.unbind = function () {
        if (this.contentView) {
            this.contentView.unbind();
        }
    };
    return PassThroughSlot;
}());
var ShadowSlot = (function () {
    function ShadowSlot(anchor, name, fallbackFactory) {
        this.anchor = anchor;
        this.anchor.isContentProjectionSource = true;
        this.anchor.viewSlot = this;
        this.name = name;
        this.fallbackFactory = fallbackFactory;
        this.contentView = null;
        this.projections = 0;
        this.children = [];
        this.projectFromAnchors = null;
        this.destinationSlots = null;
    }
    Object.defineProperty(ShadowSlot.prototype, "needsFallbackRendering", {
        get: function () {
            return this.fallbackFactory && this.projections === 0;
        },
        enumerable: false,
        configurable: true
    });
    ShadowSlot.prototype.addNode = function (view, node, projectionSource, index, destination) {
        var $node = node;
        if (this.contentView !== null) {
            this.contentView.removeNodes();
            this.contentView.detached();
            this.contentView.unbind();
            this.contentView = null;
        }
        if ($node.viewSlot instanceof PassThroughSlot) {
            $node.viewSlot.passThroughTo(this);
            return;
        }
        if (this.destinationSlots !== null) {
            ShadowDOM.distributeNodes(view, [$node], this.destinationSlots, this, index);
        }
        else {
            $node.auOwnerView = view;
            $node.auProjectionSource = projectionSource;
            $node.auAssignedSlot = this;
            var anchor = this._findAnchor(view, $node, projectionSource, index);
            var parent_1 = anchor.parentNode;
            parent_1.insertBefore($node, anchor);
            this.children.push($node);
            this.projections++;
        }
    };
    ShadowSlot.prototype.removeView = function (view, projectionSource) {
        if (this.destinationSlots !== null) {
            ShadowDOM.undistributeView(view, this.destinationSlots, this);
        }
        else if (this.contentView && this.contentView.hasSlots) {
            ShadowDOM.undistributeView(view, this.contentView.slots, projectionSource);
        }
        else {
            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });
            if (found) {
                var children = found.auProjectionChildren;
                var ownChildren = this.children;
                for (var i = 0, ii = children.length; i < ii; ++i) {
                    var child = children[i];
                    if (child.auOwnerView === view) {
                        children.splice(i, 1);
                        view.fragment.appendChild(child);
                        i--;
                        ii--;
                        this.projections--;
                        var idx = ownChildren.indexOf(child);
                        if (idx > -1) {
                            ownChildren.splice(idx, 1);
                        }
                    }
                }
                if (this.needsFallbackRendering) {
                    this.renderFallbackContent(view, noNodes, projectionSource);
                }
            }
        }
    };
    ShadowSlot.prototype.removeAll = function (projectionSource) {
        if (this.destinationSlots !== null) {
            ShadowDOM.undistributeAll(this.destinationSlots, this);
        }
        else if (this.contentView && this.contentView.hasSlots) {
            ShadowDOM.undistributeAll(this.contentView.slots, projectionSource);
        }
        else {
            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });
            if (found) {
                var children = found.auProjectionChildren;
                var ownChildren = this.children;
                for (var i = 0, ii = children.length; i < ii; ++i) {
                    var child = children[i];
                    child.auOwnerView.fragment.appendChild(child);
                    this.projections--;
                    var idx = ownChildren.indexOf(child);
                    if (idx > -1) {
                        ownChildren.splice(idx, 1);
                    }
                }
                found.auProjectionChildren = [];
                if (this.needsFallbackRendering) {
                    this.renderFallbackContent(null, noNodes, projectionSource);
                }
            }
        }
    };
    ShadowSlot.prototype._findAnchor = function (view, node, projectionSource, index) {
        if (projectionSource) {
            var found = this.children.find(function (x) { return x.auSlotProjectFrom === projectionSource; });
            if (found) {
                if (index !== undefined) {
                    var children = found.auProjectionChildren;
                    var viewIndex = -1;
                    var lastView = void 0;
                    for (var i = 0, ii = children.length; i < ii; ++i) {
                        var current = children[i];
                        if (current.auOwnerView !== lastView) {
                            viewIndex++;
                            lastView = current.auOwnerView;
                            if (viewIndex >= index && lastView !== view) {
                                children.splice(i, 0, node);
                                return current;
                            }
                        }
                    }
                }
                found.auProjectionChildren.push(node);
                return found;
            }
        }
        return this.anchor;
    };
    ShadowSlot.prototype.projectTo = function (slots) {
        this.destinationSlots = slots;
    };
    ShadowSlot.prototype.projectFrom = function (view, projectionSource) {
        var anchor = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createComment('anchor');
        var parent = this.anchor.parentNode;
        anchor.auSlotProjectFrom = projectionSource;
        anchor.auOwnerView = view;
        anchor.auProjectionChildren = [];
        parent.insertBefore(anchor, this.anchor);
        this.children.push(anchor);
        if (this.projectFromAnchors === null) {
            this.projectFromAnchors = [];
        }
        this.projectFromAnchors.push(anchor);
    };
    ShadowSlot.prototype.renderFallbackContent = function (view, nodes, projectionSource, index) {
        if (this.contentView === null) {
            this.contentView = this.fallbackFactory.create(this.ownerView.container);
            this.contentView.bind(this.ownerView.bindingContext, this.ownerView.overrideContext);
            this.contentView.insertNodesBefore(this.anchor);
        }
        if (this.contentView.hasSlots) {
            var slots = this.contentView.slots;
            var projectFromAnchors = this.projectFromAnchors;
            if (projectFromAnchors !== null) {
                for (var slotName in slots) {
                    var slot = slots[slotName];
                    for (var i = 0, ii = projectFromAnchors.length; i < ii; ++i) {
                        var anchor = projectFromAnchors[i];
                        slot.projectFrom(anchor.auOwnerView, anchor.auSlotProjectFrom);
                    }
                }
            }
            this.fallbackSlots = slots;
            ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index);
        }
    };
    ShadowSlot.prototype.created = function (ownerView) {
        this.ownerView = ownerView;
    };
    ShadowSlot.prototype.bind = function (view) {
        if (this.contentView) {
            this.contentView.bind(view.bindingContext, view.overrideContext);
        }
    };
    ShadowSlot.prototype.attached = function () {
        if (this.contentView) {
            this.contentView.attached();
        }
    };
    ShadowSlot.prototype.detached = function () {
        if (this.contentView) {
            this.contentView.detached();
        }
    };
    ShadowSlot.prototype.unbind = function () {
        if (this.contentView) {
            this.contentView.unbind();
        }
    };
    return ShadowSlot;
}());
var ShadowDOM = (function () {
    function ShadowDOM() {
    }
    ShadowDOM.getSlotName = function (node) {
        if (node.auSlotAttribute === undefined) {
            return ShadowDOM.defaultSlotKey;
        }
        return node.auSlotAttribute.value;
    };
    ShadowDOM.distributeView = function (view, slots, projectionSource, index, destinationOverride) {
        var nodes;
        if (view === null) {
            nodes = noNodes;
        }
        else {
            var childNodes = view.fragment.childNodes;
            var ii = childNodes.length;
            nodes = new Array(ii);
            for (var i = 0; i < ii; ++i) {
                nodes[i] = childNodes[i];
            }
        }
        ShadowDOM.distributeNodes(view, nodes, slots, projectionSource, index, destinationOverride);
    };
    ShadowDOM.undistributeView = function (view, slots, projectionSource) {
        for (var slotName in slots) {
            slots[slotName].removeView(view, projectionSource);
        }
    };
    ShadowDOM.undistributeAll = function (slots, projectionSource) {
        for (var slotName in slots) {
            slots[slotName].removeAll(projectionSource);
        }
    };
    ShadowDOM.distributeNodes = function (view, nodes, slots, projectionSource, index, destinationOverride) {
        for (var i = 0, ii = nodes.length; i < ii; ++i) {
            var currentNode = nodes[i];
            var nodeType = currentNode.nodeType;
            if (currentNode.isContentProjectionSource) {
                currentNode.viewSlot.projectTo(slots);
                for (var slotName in slots) {
                    slots[slotName].projectFrom(view, currentNode.viewSlot);
                }
                nodes.splice(i, 1);
                ii--;
                i--;
            }
            else if (nodeType === 1 || nodeType === 3 || currentNode.viewSlot instanceof PassThroughSlot) {
                if (nodeType === 3 && _isAllWhitespace(currentNode)) {
                    nodes.splice(i, 1);
                    ii--;
                    i--;
                }
                else {
                    var found = slots[destinationOverride || ShadowDOM.getSlotName(currentNode)];
                    if (found) {
                        found.addNode(view, currentNode, projectionSource, index);
                        nodes.splice(i, 1);
                        ii--;
                        i--;
                    }
                }
            }
            else {
                nodes.splice(i, 1);
                ii--;
                i--;
            }
        }
        for (var slotName in slots) {
            var slot = slots[slotName];
            if (slot.needsFallbackRendering) {
                slot.renderFallbackContent(view, nodes, projectionSource, index);
            }
        }
    };
    ShadowDOM.defaultSlotKey = '__au-default-slot-key__';
    return ShadowDOM;
}());

var CompositionTransactionNotifier = (function () {
    function CompositionTransactionNotifier(owner) {
        this.owner = owner;
        this.owner._compositionCount++;
    }
    CompositionTransactionNotifier.prototype.done = function () {
        this.owner._compositionCount--;
        this.owner._tryCompleteTransaction();
    };
    return CompositionTransactionNotifier;
}());
var CompositionTransactionOwnershipToken = (function () {
    function CompositionTransactionOwnershipToken(owner) {
        this.owner = owner;
        this.owner._ownershipToken = this;
        this.thenable = this._createThenable();
    }
    CompositionTransactionOwnershipToken.prototype.waitForCompositionComplete = function () {
        this.owner._tryCompleteTransaction();
        return this.thenable;
    };
    CompositionTransactionOwnershipToken.prototype.resolve = function () {
        this._resolveCallback();
    };
    CompositionTransactionOwnershipToken.prototype._resolveCallback = function () {
        throw new Error("Method not implemented.");
    };
    CompositionTransactionOwnershipToken.prototype._createThenable = function () {
        var _this = this;
        return new Promise(function (resolve) {
            _this._resolveCallback = resolve;
        });
    };
    return CompositionTransactionOwnershipToken;
}());
var CompositionTransaction = (function () {
    function CompositionTransaction() {
        this._ownershipToken = null;
        this._compositionCount = 0;
    }
    CompositionTransaction.prototype.tryCapture = function () {
        return this._ownershipToken === null
            ? new CompositionTransactionOwnershipToken(this)
            : null;
    };
    CompositionTransaction.prototype.enlist = function () {
        return new CompositionTransactionNotifier(this);
    };
    CompositionTransaction.prototype._tryCompleteTransaction = function () {
        if (this._compositionCount <= 0) {
            this._compositionCount = 0;
            if (this._ownershipToken !== null) {
                var token = this._ownershipToken;
                this._ownershipToken = null;
                token.resolve();
            }
        }
    };
    return CompositionTransaction;
}());

var View = (function () {
    function View(container, viewFactory, fragment, controllers, bindings, children, slots) {
        this.container = container;
        this.viewFactory = viewFactory;
        this.resources = viewFactory.resources;
        this.fragment = fragment;
        this.firstChild = fragment.firstChild;
        this.lastChild = fragment.lastChild;
        this.controllers = controllers;
        this.bindings = bindings;
        this.children = children;
        this.slots = slots;
        this.hasSlots = false;
        this.fromCache = false;
        this.isBound = false;
        this.isAttached = false;
        this.bindingContext = null;
        this.overrideContext = null;
        this.controller = null;
        this.viewModelScope = null;
        this.animatableElement = undefined;
        this._isUserControlled = false;
        this.contentView = null;
        for (var _ in slots) {
            this.hasSlots = true;
            break;
        }
    }
    View.prototype.returnToCache = function () {
        this.viewFactory.returnViewToCache(this);
    };
    View.prototype.created = function () {
        var i;
        var ii;
        var controllers = this.controllers;
        for (i = 0, ii = controllers.length; i < ii; ++i) {
            controllers[i].created(this);
        }
    };
    View.prototype.bind = function (bindingContext, overrideContext, _systemUpdate) {
        var controllers;
        var bindings;
        var children;
        var i;
        var ii;
        if (_systemUpdate && this._isUserControlled) {
            return;
        }
        if (this.isBound) {
            if (this.bindingContext === bindingContext) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.bindingContext = bindingContext;
        this.overrideContext = overrideContext || __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(bindingContext);
        this.resources._invokeHook('beforeBind', this);
        bindings = this.bindings;
        for (i = 0, ii = bindings.length; i < ii; ++i) {
            bindings[i].bind(this);
        }
        if (this.viewModelScope !== null) {
            bindingContext.bind(this.viewModelScope.bindingContext, this.viewModelScope.overrideContext);
            this.viewModelScope = null;
        }
        controllers = this.controllers;
        for (i = 0, ii = controllers.length; i < ii; ++i) {
            controllers[i].bind(this);
        }
        children = this.children;
        for (i = 0, ii = children.length; i < ii; ++i) {
            children[i].bind(bindingContext, overrideContext, true);
        }
        if (this.hasSlots) {
            ShadowDOM.distributeView(this.contentView, this.slots);
        }
    };
    View.prototype.addBinding = function (binding) {
        this.bindings.push(binding);
        if (this.isBound) {
            binding.bind(this);
        }
    };
    View.prototype.unbind = function () {
        var controllers;
        var bindings;
        var children;
        var i;
        var ii;
        if (this.isBound) {
            this.isBound = false;
            this.resources._invokeHook('beforeUnbind', this);
            if (this.controller !== null) {
                this.controller.unbind();
            }
            bindings = this.bindings;
            for (i = 0, ii = bindings.length; i < ii; ++i) {
                bindings[i].unbind();
            }
            controllers = this.controllers;
            for (i = 0, ii = controllers.length; i < ii; ++i) {
                controllers[i].unbind();
            }
            children = this.children;
            for (i = 0, ii = children.length; i < ii; ++i) {
                children[i].unbind();
            }
            this.bindingContext = null;
            this.overrideContext = null;
        }
    };
    View.prototype.insertNodesBefore = function (refNode) {
        refNode.parentNode.insertBefore(this.fragment, refNode);
    };
    View.prototype.appendNodesTo = function (parent) {
        parent.appendChild(this.fragment);
    };
    View.prototype.removeNodes = function () {
        var fragment = this.fragment;
        var current = this.firstChild;
        var end = this.lastChild;
        var next;
        while (current) {
            next = current.nextSibling;
            fragment.appendChild(current);
            if (current === end) {
                break;
            }
            current = next;
        }
    };
    View.prototype.attached = function () {
        var controllers;
        var children;
        var i;
        var ii;
        if (this.isAttached) {
            return;
        }
        this.isAttached = true;
        if (this.controller !== null) {
            this.controller.attached();
        }
        controllers = this.controllers;
        for (i = 0, ii = controllers.length; i < ii; ++i) {
            controllers[i].attached();
        }
        children = this.children;
        for (i = 0, ii = children.length; i < ii; ++i) {
            children[i].attached();
        }
    };
    View.prototype.detached = function () {
        var controllers;
        var children;
        var i;
        var ii;
        if (this.isAttached) {
            this.isAttached = false;
            if (this.controller !== null) {
                this.controller.detached();
            }
            controllers = this.controllers;
            for (i = 0, ii = controllers.length; i < ii; ++i) {
                controllers[i].detached();
            }
            children = this.children;
            for (i = 0, ii = children.length; i < ii; ++i) {
                children[i].detached();
            }
        }
    };
    return View;
}());

var Animator = (function () {
    function Animator() {
    }
    Animator.prototype.enter = function (element) {
        return Promise.resolve(false);
    };
    Animator.prototype.leave = function (element) {
        return Promise.resolve(false);
    };
    Animator.prototype.removeClass = function (element, className) {
        element.classList.remove(className);
        return Promise.resolve(false);
    };
    Animator.prototype.addClass = function (element, className) {
        element.classList.add(className);
        return Promise.resolve(false);
    };
    Animator.prototype.animate = function (element, className) {
        return Promise.resolve(false);
    };
    Animator.prototype.runSequence = function (animations) {
        return Promise.resolve(false);
    };
    Animator.prototype.registerEffect = function (effectName, properties) { };
    Animator.prototype.unregisterEffect = function (effectName) { };
    return Animator;
}());

function getAnimatableElement(view) {
    if (view.animatableElement !== undefined) {
        return view.animatableElement;
    }
    var current = view.firstChild;
    while (current && current.nodeType !== 1) {
        current = current.nextSibling;
    }
    if (current && current.nodeType === 1) {
        return (view.animatableElement = current.classList.contains('au-animate') ? current : null);
    }
    return (view.animatableElement = null);
}
var ViewSlot = (function () {
    function ViewSlot(anchor, anchorIsContainer, animator) {
        if (animator === void 0) { animator = Animator.instance; }
        this.anchor = anchor;
        this.anchorIsContainer = anchorIsContainer;
        this.bindingContext = null;
        this.overrideContext = null;
        this.animator = animator;
        this.children = [];
        this.isBound = false;
        this.isAttached = false;
        this.contentSelectors = null;
        anchor.viewSlot = this;
        anchor.isContentProjectionSource = false;
    }
    ViewSlot.prototype.animateView = function (view, direction) {
        if (direction === void 0) { direction = 'enter'; }
        var animatableElement = getAnimatableElement(view);
        if (animatableElement !== null) {
            switch (direction) {
                case 'enter':
                    return this.animator.enter(animatableElement);
                case 'leave':
                    return this.animator.leave(animatableElement);
                default:
                    throw new Error('Invalid animation direction: ' + direction);
            }
        }
    };
    ViewSlot.prototype.transformChildNodesIntoView = function () {
        var parent = this.anchor;
        this.children.push({
            fragment: parent,
            firstChild: parent.firstChild,
            lastChild: parent.lastChild,
            returnToCache: function () { },
            removeNodes: function () {
                var last;
                while (last = parent.lastChild) {
                    parent.removeChild(last);
                }
            },
            created: function () { },
            bind: function () { },
            unbind: function () { },
            attached: function () { },
            detached: function () { }
        });
    };
    ViewSlot.prototype.bind = function (bindingContext, overrideContext) {
        var i;
        var ii;
        var children;
        if (this.isBound) {
            if (this.bindingContext === bindingContext) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.bindingContext = bindingContext = bindingContext || this.bindingContext;
        this.overrideContext = overrideContext = overrideContext || this.overrideContext;
        children = this.children;
        for (i = 0, ii = children.length; i < ii; ++i) {
            children[i].bind(bindingContext, overrideContext, true);
        }
    };
    ViewSlot.prototype.unbind = function () {
        if (this.isBound) {
            var i = void 0;
            var ii = void 0;
            var children = this.children;
            this.isBound = false;
            this.bindingContext = null;
            this.overrideContext = null;
            for (i = 0, ii = children.length; i < ii; ++i) {
                children[i].unbind();
            }
        }
    };
    ViewSlot.prototype.add = function (view) {
        if (this.anchorIsContainer) {
            view.appendNodesTo(this.anchor);
        }
        else {
            view.insertNodesBefore(this.anchor);
        }
        this.children.push(view);
        if (this.isAttached) {
            view.attached();
            return this.animateView(view, 'enter');
        }
    };
    ViewSlot.prototype.insert = function (index, view) {
        var children = this.children;
        var length = children.length;
        if ((index === 0 && length === 0) || index >= length) {
            return this.add(view);
        }
        view.insertNodesBefore(children[index].firstChild);
        children.splice(index, 0, view);
        if (this.isAttached) {
            view.attached();
            return this.animateView(view, 'enter');
        }
    };
    ViewSlot.prototype.move = function (sourceIndex, targetIndex) {
        if (sourceIndex === targetIndex) {
            return;
        }
        var children = this.children;
        var view = children[sourceIndex];
        view.removeNodes();
        view.insertNodesBefore(children[targetIndex].firstChild);
        children.splice(sourceIndex, 1);
        children.splice(targetIndex, 0, view);
    };
    ViewSlot.prototype.remove = function (view, returnToCache, skipAnimation) {
        return this.removeAt(this.children.indexOf(view), returnToCache, skipAnimation);
    };
    ViewSlot.prototype.removeMany = function (viewsToRemove, returnToCache, skipAnimation) {
        var _this = this;
        var children = this.children;
        var ii = viewsToRemove.length;
        var i;
        var rmPromises = [];
        viewsToRemove.forEach(function (child) {
            if (skipAnimation) {
                child.removeNodes();
                return;
            }
            var animation = _this.animateView(child, 'leave');
            if (animation) {
                rmPromises.push(animation.then(function () { return child.removeNodes(); }));
            }
            else {
                child.removeNodes();
            }
        });
        var removeAction = function () {
            if (_this.isAttached) {
                for (i = 0; i < ii; ++i) {
                    viewsToRemove[i].detached();
                }
            }
            if (returnToCache) {
                for (i = 0; i < ii; ++i) {
                    viewsToRemove[i].returnToCache();
                }
            }
            for (i = 0; i < ii; ++i) {
                var index = children.indexOf(viewsToRemove[i]);
                if (index >= 0) {
                    children.splice(index, 1);
                }
            }
        };
        if (rmPromises.length > 0) {
            return Promise.all(rmPromises).then(function () { return removeAction(); });
        }
        return removeAction();
    };
    ViewSlot.prototype.removeAt = function (index, returnToCache, skipAnimation) {
        var _this = this;
        var view = this.children[index];
        var removeAction = function () {
            index = _this.children.indexOf(view);
            view.removeNodes();
            _this.children.splice(index, 1);
            if (_this.isAttached) {
                view.detached();
            }
            if (returnToCache) {
                view.returnToCache();
            }
            return view;
        };
        if (!skipAnimation) {
            var animation = this.animateView(view, 'leave');
            if (animation) {
                return animation.then(function () { return removeAction(); });
            }
        }
        return removeAction();
    };
    ViewSlot.prototype.removeAll = function (returnToCache, skipAnimation) {
        var _this = this;
        var children = this.children;
        var ii = children.length;
        var i;
        var rmPromises = [];
        children.forEach(function (child) {
            if (skipAnimation) {
                child.removeNodes();
                return;
            }
            var animation = _this.animateView(child, 'leave');
            if (animation) {
                rmPromises.push(animation.then(function () { return child.removeNodes(); }));
            }
            else {
                child.removeNodes();
            }
        });
        var removeAction = function () {
            if (_this.isAttached) {
                for (i = 0; i < ii; ++i) {
                    children[i].detached();
                }
            }
            if (returnToCache) {
                for (i = 0; i < ii; ++i) {
                    var child = children[i];
                    if (child) {
                        child.returnToCache();
                    }
                }
            }
            _this.children = [];
        };
        if (rmPromises.length > 0) {
            return Promise.all(rmPromises).then(function () { return removeAction(); });
        }
        return removeAction();
    };
    ViewSlot.prototype.attached = function () {
        var i;
        var ii;
        var children;
        var child;
        if (this.isAttached) {
            return;
        }
        this.isAttached = true;
        children = this.children;
        for (i = 0, ii = children.length; i < ii; ++i) {
            child = children[i];
            child.attached();
            this.animateView(child, 'enter');
        }
    };
    ViewSlot.prototype.detached = function () {
        var i;
        var ii;
        var children;
        if (this.isAttached) {
            this.isAttached = false;
            children = this.children;
            for (i = 0, ii = children.length; i < ii; ++i) {
                children[i].detached();
            }
        }
    };
    ViewSlot.prototype.projectTo = function (slots) {
        var _this = this;
        this.projectToSlots = slots;
        this.add = this._projectionAdd;
        this.insert = this._projectionInsert;
        this.move = this._projectionMove;
        this.remove = this._projectionRemove;
        this.removeAt = this._projectionRemoveAt;
        this.removeMany = this._projectionRemoveMany;
        this.removeAll = this._projectionRemoveAll;
        this.children.forEach(function (view) { return ShadowDOM.distributeView(view, slots, _this); });
    };
    ViewSlot.prototype._projectionAdd = function (view) {
        ShadowDOM.distributeView(view, this.projectToSlots, this);
        this.children.push(view);
        if (this.isAttached) {
            view.attached();
        }
    };
    ViewSlot.prototype._projectionInsert = function (index, view) {
        if ((index === 0 && !this.children.length) || index >= this.children.length) {
            this.add(view);
        }
        else {
            ShadowDOM.distributeView(view, this.projectToSlots, this, index);
            this.children.splice(index, 0, view);
            if (this.isAttached) {
                view.attached();
            }
        }
    };
    ViewSlot.prototype._projectionMove = function (sourceIndex, targetIndex) {
        if (sourceIndex === targetIndex) {
            return;
        }
        var children = this.children;
        var view = children[sourceIndex];
        ShadowDOM.undistributeView(view, this.projectToSlots, this);
        ShadowDOM.distributeView(view, this.projectToSlots, this, targetIndex);
        children.splice(sourceIndex, 1);
        children.splice(targetIndex, 0, view);
    };
    ViewSlot.prototype._projectionRemove = function (view, returnToCache) {
        ShadowDOM.undistributeView(view, this.projectToSlots, this);
        this.children.splice(this.children.indexOf(view), 1);
        if (this.isAttached) {
            view.detached();
        }
        if (returnToCache) {
            view.returnToCache();
        }
    };
    ViewSlot.prototype._projectionRemoveAt = function (index, returnToCache) {
        var view = this.children[index];
        ShadowDOM.undistributeView(view, this.projectToSlots, this);
        this.children.splice(index, 1);
        if (this.isAttached) {
            view.detached();
        }
        if (returnToCache) {
            view.returnToCache();
        }
    };
    ViewSlot.prototype._projectionRemoveMany = function (viewsToRemove, returnToCache) {
        var _this = this;
        viewsToRemove.forEach(function (view) { return _this.remove(view, returnToCache); });
    };
    ViewSlot.prototype._projectionRemoveAll = function (returnToCache) {
        ShadowDOM.undistributeAll(this.projectToSlots, this);
        var children = this.children;
        var ii = children.length;
        for (var i = 0; i < ii; ++i) {
            if (returnToCache) {
                children[i].returnToCache();
            }
            else if (this.isAttached) {
                children[i].detached();
            }
        }
        this.children = [];
    };
    return ViewSlot;
}());

var $resolver = __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["resolver"];
var ProviderResolver = (function () {
    function ProviderResolver() {
    }
    ProviderResolver.prototype.get = function (container, key) {
        var id = key.__providerId__;
        return id in container ? container[id] : (container[id] = container.invoke(key));
    };
    ProviderResolver = __decorate([
        $resolver
    ], ProviderResolver);
    return ProviderResolver;
}());
var providerResolverInstance = new ProviderResolver();
function elementContainerGet(key) {
    if (key === __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element) {
        return this.element;
    }
    if (key === BoundViewFactory) {
        if (this.boundViewFactory) {
            return this.boundViewFactory;
        }
        var factory = this.instruction.viewFactory;
        var partReplacements = this.partReplacements;
        if (partReplacements) {
            factory = partReplacements[factory.part] || factory;
        }
        this.boundViewFactory = new BoundViewFactory(this, factory, partReplacements);
        return this.boundViewFactory;
    }
    if (key === ViewSlot) {
        if (this.viewSlot === undefined) {
            this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);
            this.element.isContentProjectionSource = this.instruction.lifting;
            this.children.push(this.viewSlot);
        }
        return this.viewSlot;
    }
    if (key === ElementEvents) {
        return this.elementEvents || (this.elementEvents = new ElementEvents(this.element));
    }
    if (key === CompositionTransaction) {
        return this.compositionTransaction || (this.compositionTransaction = this.parent.get(key));
    }
    if (key === ViewResources) {
        return this.viewResources;
    }
    if (key === TargetInstruction) {
        return this.instruction;
    }
    return this.superGet(key);
}
function createElementContainer(parent, element, instruction, children, partReplacements, resources) {
    var container = parent.createChild();
    var providers;
    var i;
    container.element = element;
    container.instruction = instruction;
    container.children = children;
    container.viewResources = resources;
    container.partReplacements = partReplacements;
    providers = instruction.providers;
    i = providers.length;
    while (i--) {
        container._resolvers.set(providers[i], providerResolverInstance);
    }
    container.superGet = container.get;
    container.get = elementContainerGet;
    return container;
}
function hasAttribute(name) {
    return this._element.hasAttribute(name);
}
function getAttribute(name) {
    return this._element.getAttribute(name);
}
function setAttribute(name, value) {
    this._element.setAttribute(name, value);
}
function makeElementIntoAnchor(element, elementInstruction) {
    var anchor = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createComment('anchor');
    if (elementInstruction) {
        var firstChild = element.firstChild;
        if (firstChild && firstChild.tagName === 'AU-CONTENT') {
            anchor.contentElement = firstChild;
        }
        anchor._element = element;
        anchor.hasAttribute = hasAttribute;
        anchor.getAttribute = getAttribute;
        anchor.setAttribute = setAttribute;
    }
    __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].replaceNode(anchor, element);
    return anchor;
}
function applyInstructions(containers, element, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources) {
    var behaviorInstructions = instruction.behaviorInstructions;
    var expressions = instruction.expressions;
    var elementContainer;
    var i;
    var ii;
    var current;
    var instance;
    if (instruction.contentExpression) {
        bindings.push(instruction.contentExpression.createBinding(element.nextSibling));
        element.nextSibling.auInterpolationTarget = true;
        element.parentNode.removeChild(element);
        return;
    }
    if (instruction.shadowSlot) {
        var commentAnchor = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createComment('slot');
        var slot = void 0;
        if (instruction.slotDestination) {
            slot = new PassThroughSlot(commentAnchor, instruction.slotName, instruction.slotDestination, instruction.slotFallbackFactory);
        }
        else {
            slot = new ShadowSlot(commentAnchor, instruction.slotName, instruction.slotFallbackFactory);
        }
        __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].replaceNode(commentAnchor, element);
        shadowSlots[instruction.slotName] = slot;
        controllers.push(slot);
        return;
    }
    if (instruction.letElement) {
        for (i = 0, ii = expressions.length; i < ii; ++i) {
            bindings.push(expressions[i].createBinding());
        }
        element.parentNode.removeChild(element);
        return;
    }
    if (behaviorInstructions.length) {
        if (!instruction.anchorIsContainer) {
            element = makeElementIntoAnchor(element, instruction.elementInstruction);
        }
        containers[instruction.injectorId] = elementContainer =
            createElementContainer(containers[instruction.parentInjectorId], element, instruction, children, partReplacements, resources);
        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
            current = behaviorInstructions[i];
            instance = current.type.create(elementContainer, current, element, bindings);
            controllers.push(instance);
        }
    }
    for (i = 0, ii = expressions.length; i < ii; ++i) {
        bindings.push(expressions[i].createBinding(element));
    }
}
function styleStringToObject(style, target) {
    var attributes = style.split(';');
    var firstIndexOfColon;
    var i;
    var current;
    var key;
    var value;
    target = target || {};
    for (i = 0; i < attributes.length; i++) {
        current = attributes[i];
        firstIndexOfColon = current.indexOf(':');
        key = current.substring(0, firstIndexOfColon).trim();
        value = current.substring(firstIndexOfColon + 1).trim();
        target[key] = value;
    }
    return target;
}
function styleObjectToString(obj) {
    var result = '';
    for (var key in obj) {
        result += key + ':' + obj[key] + ';';
    }
    return result;
}
function applySurrogateInstruction(container, element, instruction, controllers, bindings, children) {
    var behaviorInstructions = instruction.behaviorInstructions;
    var expressions = instruction.expressions;
    var providers = instruction.providers;
    var values = instruction.values;
    var i;
    var ii;
    var current;
    var instance;
    var currentAttributeValue;
    i = providers.length;
    while (i--) {
        container._resolvers.set(providers[i], providerResolverInstance);
    }
    for (var key in values) {
        currentAttributeValue = element.getAttribute(key);
        if (currentAttributeValue) {
            if (key === 'class') {
                element.setAttribute('class', currentAttributeValue + ' ' + values[key]);
            }
            else if (key === 'style') {
                var styleObject = styleStringToObject(values[key]);
                styleStringToObject(currentAttributeValue, styleObject);
                element.setAttribute('style', styleObjectToString(styleObject));
            }
        }
        else {
            element.setAttribute(key, values[key]);
        }
    }
    if (behaviorInstructions.length) {
        for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
            current = behaviorInstructions[i];
            instance = current.type.create(container, current, element, bindings);
            if (instance.contentView) {
                children.push(instance.contentView);
            }
            controllers.push(instance);
        }
    }
    for (i = 0, ii = expressions.length; i < ii; ++i) {
        bindings.push(expressions[i].createBinding(element));
    }
}
var BoundViewFactory = (function () {
    function BoundViewFactory(parentContainer, viewFactory, partReplacements) {
        this.parentContainer = parentContainer;
        this.viewFactory = viewFactory;
        this.factoryCreateInstruction = { partReplacements: partReplacements };
    }
    BoundViewFactory.prototype.create = function () {
        var view = this.viewFactory.create(this.parentContainer.createChild(), this.factoryCreateInstruction);
        view._isUserControlled = true;
        return view;
    };
    Object.defineProperty(BoundViewFactory.prototype, "isCaching", {
        get: function () {
            return this.viewFactory.isCaching;
        },
        enumerable: false,
        configurable: true
    });
    BoundViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {
        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
    };
    BoundViewFactory.prototype.getCachedView = function () {
        return this.viewFactory.getCachedView();
    };
    BoundViewFactory.prototype.returnViewToCache = function (view) {
        this.viewFactory.returnViewToCache(view);
    };
    return BoundViewFactory;
}());
var ViewFactory = (function () {
    function ViewFactory(template, instructions, resources) {
        this.isCaching = false;
        this.template = template;
        this.instructions = instructions;
        this.resources = resources;
        this.cacheSize = -1;
        this.cache = null;
    }
    ViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {
        if (size) {
            if (size === '*') {
                size = Number.MAX_VALUE;
            }
            else if (typeof size === 'string') {
                size = parseInt(size, 10);
            }
        }
        if (this.cacheSize === -1 || !doNotOverrideIfAlreadySet) {
            this.cacheSize = Number(size);
        }
        if (this.cacheSize > 0) {
            this.cache = [];
        }
        else {
            this.cache = null;
        }
        this.isCaching = this.cacheSize > 0;
    };
    ViewFactory.prototype.getCachedView = function () {
        return this.cache !== null ? (this.cache.pop() || null) : null;
    };
    ViewFactory.prototype.returnViewToCache = function (view) {
        if (view.isAttached) {
            view.detached();
        }
        if (view.isBound) {
            view.unbind();
        }
        if (this.cache !== null && this.cache.length < this.cacheSize) {
            view.fromCache = true;
            this.cache.push(view);
        }
    };
    ViewFactory.prototype.create = function (container, createInstruction, element) {
        createInstruction = createInstruction || BehaviorInstruction.normal;
        var cachedView = this.getCachedView();
        if (cachedView !== null) {
            return cachedView;
        }
        var fragment = createInstruction.enhance ? this.template : this.template.cloneNode(true);
        var instructables = fragment.querySelectorAll('.au-target');
        var instructions = this.instructions;
        var resources = this.resources;
        var controllers = [];
        var bindings = [];
        var children = [];
        var shadowSlots = Object.create(null);
        var containers = { root: container };
        var partReplacements = createInstruction.partReplacements;
        var i;
        var ii;
        var view;
        var instructable;
        var instruction;
        this.resources._invokeHook('beforeCreate', this, container, fragment, createInstruction);
        if (element && this.surrogateInstruction !== null) {
            applySurrogateInstruction(container, element, this.surrogateInstruction, controllers, bindings, children);
        }
        if (createInstruction.enhance && fragment.hasAttribute('au-target-id')) {
            instructable = fragment;
            instruction = instructions[instructable.getAttribute('au-target-id')];
            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
        }
        for (i = 0, ii = instructables.length; i < ii; ++i) {
            instructable = instructables[i];
            instruction = instructions[instructable.getAttribute('au-target-id')];
            applyInstructions(containers, instructable, instruction, controllers, bindings, children, shadowSlots, partReplacements, resources);
        }
        view = new View(container, this, fragment, controllers, bindings, children, shadowSlots);
        if (!createInstruction.initiatedByBehavior) {
            view.created();
        }
        this.resources._invokeHook('afterCreate', view);
        return view;
    };
    return ViewFactory;
}());

var nextInjectorId = 0;
function getNextInjectorId() {
    return ++nextInjectorId;
}
var lastAUTargetID = 0;
function getNextAUTargetID() {
    return (++lastAUTargetID).toString();
}
function makeIntoInstructionTarget(element) {
    var value = element.getAttribute('class');
    var auTargetID = getNextAUTargetID();
    element.setAttribute('class', (value ? value + ' au-target' : 'au-target'));
    element.setAttribute('au-target-id', auTargetID);
    return auTargetID;
}
function makeShadowSlot(compiler, resources, node, instructions, parentInjectorId) {
    var auShadowSlot = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createElement('au-shadow-slot');
    __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].replaceNode(auShadowSlot, node);
    var auTargetID = makeIntoInstructionTarget(auShadowSlot);
    var instruction = TargetInstruction.shadowSlot(parentInjectorId);
    instruction.slotName = node.getAttribute('name') || ShadowDOM.defaultSlotKey;
    instruction.slotDestination = node.getAttribute('slot');
    if (node.innerHTML.trim()) {
        var fragment = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createDocumentFragment();
        var child = void 0;
        while (child = node.firstChild) {
            fragment.appendChild(child);
        }
        instruction.slotFallbackFactory = compiler.compile(fragment, resources);
    }
    instructions[auTargetID] = instruction;
    return auShadowSlot;
}
var defaultLetHandler = BindingLanguage.prototype.createLetExpressions;
var ViewCompiler = (function () {
    function ViewCompiler(bindingLanguage, resources) {
        this.bindingLanguage = bindingLanguage;
        this.resources = resources;
    }
    ViewCompiler.inject = function () {
        return [BindingLanguage, ViewResources];
    };
    ViewCompiler.prototype.compile = function (source, resources, compileInstruction) {
        resources = resources || this.resources;
        compileInstruction = compileInstruction || ViewCompileInstruction.normal;
        source = typeof source === 'string' ? __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createTemplateFromMarkup(source) : source;
        var content;
        var part;
        var cacheSize;
        if (source.content) {
            part = source.getAttribute('part');
            cacheSize = source.getAttribute('view-cache');
            content = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].adoptNode(source.content);
        }
        else {
            content = source;
        }
        compileInstruction.targetShadowDOM = compileInstruction.targetShadowDOM && __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["FEATURE"].shadowDOM;
        resources._invokeHook('beforeCompile', content, resources, compileInstruction);
        var instructions = {};
        this._compileNode(content, resources, instructions, source, 'root', !compileInstruction.targetShadowDOM);
        var firstChild = content.firstChild;
        if (firstChild && firstChild.nodeType === 1) {
            var targetId = firstChild.getAttribute('au-target-id');
            if (targetId) {
                var ins = instructions[targetId];
                if (ins.shadowSlot || ins.lifting || (ins.elementInstruction && !ins.elementInstruction.anchorIsContainer)) {
                    content.insertBefore(__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createComment('view'), firstChild);
                }
            }
        }
        var factory = new ViewFactory(content, instructions, resources);
        factory.surrogateInstruction = compileInstruction.compileSurrogate ? this._compileSurrogate(source, resources) : null;
        factory.part = part;
        if (cacheSize) {
            factory.setCacheSize(cacheSize);
        }
        resources._invokeHook('afterCompile', factory);
        return factory;
    };
    ViewCompiler.prototype._compileNode = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
        switch (node.nodeType) {
            case 1:
                return this._compileElement(node, resources, instructions, parentNode, parentInjectorId, targetLightDOM);
            case 3:
                var expression = resources.getBindingLanguage(this.bindingLanguage).inspectTextContent(resources, node.wholeText);
                if (expression) {
                    var marker = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createElement('au-marker');
                    var auTargetID = makeIntoInstructionTarget(marker);
                    (node.parentNode || parentNode).insertBefore(marker, node);
                    node.textContent = ' ';
                    instructions[auTargetID] = TargetInstruction.contentExpression(expression);
                    while (node.nextSibling && node.nextSibling.nodeType === 3) {
                        (node.parentNode || parentNode).removeChild(node.nextSibling);
                    }
                }
                else {
                    while (node.nextSibling && node.nextSibling.nodeType === 3) {
                        node = node.nextSibling;
                    }
                }
                return node.nextSibling;
            case 11:
                var currentChild = node.firstChild;
                while (currentChild) {
                    currentChild = this._compileNode(currentChild, resources, instructions, node, parentInjectorId, targetLightDOM);
                }
                break;
        }
        return node.nextSibling;
    };
    ViewCompiler.prototype._compileSurrogate = function (node, resources) {
        var tagName = node.tagName.toLowerCase();
        var attributes = node.attributes;
        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
        var knownAttribute;
        var property;
        var instruction;
        var i;
        var ii;
        var attr;
        var attrName;
        var attrValue;
        var info;
        var type;
        var expressions = [];
        var expression;
        var behaviorInstructions = [];
        var values = {};
        var hasValues = false;
        var providers = [];
        for (i = 0, ii = attributes.length; i < ii; ++i) {
            attr = attributes[i];
            attrName = attr.name;
            attrValue = attr.value;
            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);
            type = resources.getAttribute(info.attrName);
            if (type) {
                knownAttribute = resources.mapAttribute(info.attrName);
                if (knownAttribute) {
                    property = type.attributes[knownAttribute];
                    if (property) {
                        info.defaultBindingMode = property.defaultBindingMode;
                        if (!info.command && !info.expression) {
                            info.command = property.hasOptions ? 'options' : null;
                        }
                        if (info.command && (info.command !== 'options') && type.primaryProperty) {
                            var primaryProperty = type.primaryProperty;
                            attrName = info.attrName = primaryProperty.attribute;
                            info.defaultBindingMode = primaryProperty.defaultBindingMode;
                        }
                    }
                }
            }
            instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);
            if (instruction) {
                if (instruction.alteredAttr) {
                    type = resources.getAttribute(instruction.attrName);
                }
                if (instruction.discrete) {
                    expressions.push(instruction);
                }
                else {
                    if (type) {
                        instruction.type = type;
                        this._configureProperties(instruction, resources);
                        if (type.liftsContent) {
                            throw new Error('You cannot place a template controller on a surrogate element.');
                        }
                        else {
                            behaviorInstructions.push(instruction);
                        }
                    }
                    else {
                        expressions.push(instruction.attributes[instruction.attrName]);
                    }
                }
            }
            else {
                if (type) {
                    instruction = BehaviorInstruction.attribute(attrName, type);
                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;
                    if (type.liftsContent) {
                        throw new Error('You cannot place a template controller on a surrogate element.');
                    }
                    else {
                        behaviorInstructions.push(instruction);
                    }
                }
                else if (attrName !== 'id' && attrName !== 'part' && attrName !== 'replace-part') {
                    hasValues = true;
                    values[attrName] = attrValue;
                }
            }
        }
        if (expressions.length || behaviorInstructions.length || hasValues) {
            for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
                instruction = behaviorInstructions[i];
                instruction.type.compile(this, resources, node, instruction);
                providers.push(instruction.type.target);
            }
            for (i = 0, ii = expressions.length; i < ii; ++i) {
                expression = expressions[i];
                if (expression.attrToRemove !== undefined) {
                    node.removeAttribute(expression.attrToRemove);
                }
            }
            return TargetInstruction.surrogate(providers, behaviorInstructions, expressions, values);
        }
        return null;
    };
    ViewCompiler.prototype._compileElement = function (node, resources, instructions, parentNode, parentInjectorId, targetLightDOM) {
        var tagName = node.tagName.toLowerCase();
        var attributes = node.attributes;
        var expressions = [];
        var expression;
        var behaviorInstructions = [];
        var providers = [];
        var bindingLanguage = resources.getBindingLanguage(this.bindingLanguage);
        var liftingInstruction;
        var viewFactory;
        var type;
        var elementInstruction;
        var elementProperty;
        var i;
        var ii;
        var attr;
        var attrName;
        var attrValue;
        var originalAttrName;
        var instruction;
        var info;
        var property;
        var knownAttribute;
        var auTargetID;
        var injectorId;
        if (tagName === 'slot') {
            if (targetLightDOM) {
                node = makeShadowSlot(this, resources, node, instructions, parentInjectorId);
            }
            return node.nextSibling;
        }
        else if (tagName === 'template') {
            if (!('content' in node)) {
                throw new Error('You cannot place a template element within ' + node.namespaceURI + ' namespace');
            }
            viewFactory = this.compile(node, resources);
            viewFactory.part = node.getAttribute('part');
        }
        else {
            type = resources.getElement(node.getAttribute('as-element') || tagName);
            if (tagName === 'let' && !type && bindingLanguage.createLetExpressions !== defaultLetHandler) {
                expressions = bindingLanguage.createLetExpressions(resources, node);
                auTargetID = makeIntoInstructionTarget(node);
                instructions[auTargetID] = TargetInstruction.letElement(expressions);
                return node.nextSibling;
            }
            if (type) {
                elementInstruction = BehaviorInstruction.element(node, type);
                type.processAttributes(this, resources, node, attributes, elementInstruction);
                behaviorInstructions.push(elementInstruction);
            }
        }
        for (i = 0, ii = attributes.length; i < ii; ++i) {
            attr = attributes[i];
            originalAttrName = attrName = attr.name;
            attrValue = attr.value;
            info = bindingLanguage.inspectAttribute(resources, tagName, attrName, attrValue);
            if (targetLightDOM && info.attrName === 'slot') {
                info.attrName = attrName = 'au-slot';
            }
            type = resources.getAttribute(info.attrName);
            elementProperty = null;
            if (type) {
                knownAttribute = resources.mapAttribute(info.attrName);
                if (knownAttribute) {
                    property = type.attributes[knownAttribute];
                    if (property) {
                        info.defaultBindingMode = property.defaultBindingMode;
                        if (!info.command && !info.expression) {
                            info.command = property.hasOptions ? 'options' : null;
                        }
                        if (info.command && (info.command !== 'options') && type.primaryProperty) {
                            var primaryProperty = type.primaryProperty;
                            attrName = info.attrName = primaryProperty.attribute;
                            info.defaultBindingMode = primaryProperty.defaultBindingMode;
                        }
                    }
                }
            }
            else if (elementInstruction) {
                elementProperty = elementInstruction.type.attributes[info.attrName];
                if (elementProperty) {
                    info.defaultBindingMode = elementProperty.defaultBindingMode;
                }
            }
            if (elementProperty) {
                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, elementInstruction);
            }
            else {
                instruction = bindingLanguage.createAttributeInstruction(resources, node, info, undefined, type);
            }
            if (instruction) {
                if (instruction.alteredAttr) {
                    type = resources.getAttribute(instruction.attrName);
                }
                if (instruction.discrete) {
                    expressions.push(instruction);
                }
                else {
                    if (type) {
                        instruction.type = type;
                        this._configureProperties(instruction, resources);
                        if (type.liftsContent) {
                            instruction.originalAttrName = originalAttrName;
                            liftingInstruction = instruction;
                            break;
                        }
                        else {
                            behaviorInstructions.push(instruction);
                        }
                    }
                    else if (elementProperty) {
                        elementInstruction.attributes[info.attrName].targetProperty = elementProperty.name;
                    }
                    else {
                        expressions.push(instruction.attributes[instruction.attrName]);
                    }
                }
            }
            else {
                if (type) {
                    instruction = BehaviorInstruction.attribute(attrName, type);
                    instruction.attributes[resources.mapAttribute(attrName)] = attrValue;
                    if (type.liftsContent) {
                        instruction.originalAttrName = originalAttrName;
                        liftingInstruction = instruction;
                        break;
                    }
                    else {
                        behaviorInstructions.push(instruction);
                    }
                }
                else if (elementProperty) {
                    elementInstruction.attributes[attrName] = attrValue;
                }
            }
        }
        if (liftingInstruction) {
            liftingInstruction.viewFactory = viewFactory;
            node = liftingInstruction.type.compile(this, resources, node, liftingInstruction, parentNode);
            auTargetID = makeIntoInstructionTarget(node);
            instructions[auTargetID] = TargetInstruction.lifting(parentInjectorId, liftingInstruction);
        }
        else {
            var skipContentProcessing = false;
            if (expressions.length || behaviorInstructions.length) {
                injectorId = behaviorInstructions.length ? getNextInjectorId() : false;
                for (i = 0, ii = behaviorInstructions.length; i < ii; ++i) {
                    instruction = behaviorInstructions[i];
                    instruction.type.compile(this, resources, node, instruction, parentNode);
                    providers.push(instruction.type.target);
                    skipContentProcessing = skipContentProcessing || instruction.skipContentProcessing;
                }
                for (i = 0, ii = expressions.length; i < ii; ++i) {
                    expression = expressions[i];
                    if (expression.attrToRemove !== undefined) {
                        node.removeAttribute(expression.attrToRemove);
                    }
                }
                auTargetID = makeIntoInstructionTarget(node);
                instructions[auTargetID] = TargetInstruction.normal(injectorId, parentInjectorId, providers, behaviorInstructions, expressions, elementInstruction);
            }
            if (skipContentProcessing) {
                return node.nextSibling;
            }
            var currentChild = node.firstChild;
            while (currentChild) {
                currentChild = this._compileNode(currentChild, resources, instructions, node, injectorId || parentInjectorId, targetLightDOM);
            }
        }
        return node.nextSibling;
    };
    ViewCompiler.prototype._configureProperties = function (instruction, resources) {
        var type = instruction.type;
        var attrName = instruction.attrName;
        var attributes = instruction.attributes;
        var property;
        var key;
        var value;
        var knownAttribute = resources.mapAttribute(attrName);
        if (knownAttribute && attrName in attributes && knownAttribute !== attrName) {
            attributes[knownAttribute] = attributes[attrName];
            delete attributes[attrName];
        }
        for (key in attributes) {
            value = attributes[key];
            if (value !== null && typeof value === 'object') {
                property = type.attributes[key];
                if (property !== undefined) {
                    value.targetProperty = property.name;
                }
                else {
                    value.targetProperty = key;
                }
            }
        }
    };
    return ViewCompiler;
}());

var ViewEngineHooksResource = (function () {
    function ViewEngineHooksResource() {
    }
    ViewEngineHooksResource.prototype.initialize = function (container, target) {
        this.instance = container.get(target);
    };
    ViewEngineHooksResource.prototype.register = function (registry, name) {
        registry.registerViewEngineHooks(this.instance);
    };
    ViewEngineHooksResource.prototype.load = function (container, target) { };
    ViewEngineHooksResource.convention = function (name) {
        if (name.endsWith('ViewEngineHooks')) {
            return new ViewEngineHooksResource();
        }
    };
    return ViewEngineHooksResource;
}());
function viewEngineHooks(target) {
    var deco = function (t) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, new ViewEngineHooksResource(), t);
    };
    return target ? deco(target) : deco;
}

var ResourceModule = (function () {
    function ResourceModule(moduleId) {
        this.id = moduleId;
        this.moduleInstance = null;
        this.mainResource = null;
        this.resources = null;
        this.viewStrategy = null;
        this.isInitialized = false;
        this.onLoaded = null;
        this.loadContext = null;
    }
    ResourceModule.prototype.initialize = function (container) {
        var current = this.mainResource;
        var resources = this.resources;
        var vs = this.viewStrategy;
        if (this.isInitialized) {
            return;
        }
        this.isInitialized = true;
        if (current !== undefined) {
            current.metadata.viewStrategy = vs;
            current.initialize(container);
        }
        for (var i = 0, ii = resources.length; i < ii; ++i) {
            current = resources[i];
            current.metadata.viewStrategy = vs;
            current.initialize(container);
        }
    };
    ResourceModule.prototype.register = function (registry, name) {
        var main = this.mainResource;
        var resources = this.resources;
        if (main !== undefined) {
            main.register(registry, name);
            name = null;
        }
        for (var i = 0, ii = resources.length; i < ii; ++i) {
            resources[i].register(registry, name);
            name = null;
        }
    };
    ResourceModule.prototype.load = function (container, loadContext) {
        if (this.onLoaded !== null) {
            return this.loadContext === loadContext ? Promise.resolve() : this.onLoaded;
        }
        var main = this.mainResource;
        var resources = this.resources;
        var loads;
        if (main !== undefined) {
            loads = new Array(resources.length + 1);
            loads[0] = main.load(container, loadContext);
            for (var i = 0, ii = resources.length; i < ii; ++i) {
                loads[i + 1] = resources[i].load(container, loadContext);
            }
        }
        else {
            loads = new Array(resources.length);
            for (var i = 0, ii = resources.length; i < ii; ++i) {
                loads[i] = resources[i].load(container, loadContext);
            }
        }
        this.loadContext = loadContext;
        this.onLoaded = Promise.all(loads);
        return this.onLoaded;
    };
    return ResourceModule;
}());
var ResourceDescription = (function () {
    function ResourceDescription(key, exportedValue, resourceTypeMeta) {
        if (!resourceTypeMeta) {
            resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, exportedValue);
            if (!resourceTypeMeta) {
                resourceTypeMeta = new HtmlBehaviorResource();
                resourceTypeMeta.elementName = _hyphenate(key);
                __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, resourceTypeMeta, exportedValue);
            }
        }
        if (resourceTypeMeta instanceof HtmlBehaviorResource) {
            if (resourceTypeMeta.elementName === undefined) {
                resourceTypeMeta.elementName = _hyphenate(key);
            }
            else if (resourceTypeMeta.attributeName === undefined) {
                resourceTypeMeta.attributeName = _hyphenate(key);
            }
            else if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
                HtmlBehaviorResource.convention(key, resourceTypeMeta);
            }
        }
        else if (!resourceTypeMeta.name) {
            resourceTypeMeta.name = _hyphenate(key);
        }
        this.metadata = resourceTypeMeta;
        this.value = exportedValue;
    }
    ResourceDescription.prototype.initialize = function (container) {
        this.metadata.initialize(container, this.value);
    };
    ResourceDescription.prototype.register = function (registry, name) {
        this.metadata.register(registry, name);
    };
    ResourceDescription.prototype.load = function (container, loadContext) {
        return this.metadata.load(container, this.value, loadContext);
    };
    return ResourceDescription;
}());
var ModuleAnalyzer = (function () {
    function ModuleAnalyzer() {
        this.cache = Object.create(null);
    }
    ModuleAnalyzer.prototype.getAnalysis = function (moduleId) {
        return this.cache[moduleId];
    };
    ModuleAnalyzer.prototype.analyze = function (moduleId, moduleInstance, mainResourceKey) {
        var mainResource;
        var fallbackValue;
        var fallbackKey;
        var resourceTypeMeta;
        var key;
        var exportedValue;
        var resources = [];
        var conventional;
        var vs;
        var resourceModule;
        resourceModule = this.cache[moduleId];
        if (resourceModule) {
            return resourceModule;
        }
        resourceModule = new ResourceModule(moduleId);
        this.cache[moduleId] = resourceModule;
        if (typeof moduleInstance === 'function') {
            moduleInstance = { 'default': moduleInstance };
        }
        if (mainResourceKey) {
            mainResource = new ResourceDescription(mainResourceKey, moduleInstance[mainResourceKey]);
        }
        for (key in moduleInstance) {
            exportedValue = moduleInstance[key];
            if (key === mainResourceKey || typeof exportedValue !== 'function') {
                continue;
            }
            resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].get(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, exportedValue);
            if (resourceTypeMeta) {
                if (resourceTypeMeta instanceof HtmlBehaviorResource) {
                    ViewResources.convention(exportedValue, resourceTypeMeta);
                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
                        HtmlBehaviorResource.convention(key, resourceTypeMeta);
                    }
                    if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
                        resourceTypeMeta.elementName = _hyphenate(key);
                    }
                }
                if (!mainResource && resourceTypeMeta instanceof HtmlBehaviorResource && resourceTypeMeta.elementName !== null) {
                    mainResource = new ResourceDescription(key, exportedValue, resourceTypeMeta);
                }
                else {
                    resources.push(new ResourceDescription(key, exportedValue, resourceTypeMeta));
                }
            }
            else if (viewStrategy.decorates(exportedValue)) {
                vs = exportedValue;
            }
            else if (exportedValue instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_loader__["TemplateRegistryEntry"]) {
                vs = new TemplateRegistryViewStrategy(moduleId, exportedValue);
            }
            else {
                if (conventional = ViewResources.convention(exportedValue)) {
                    if (conventional.elementName !== null && !mainResource) {
                        mainResource = new ResourceDescription(key, exportedValue, conventional);
                    }
                    else {
                        resources.push(new ResourceDescription(key, exportedValue, conventional));
                    }
                    __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
                }
                else if (conventional = HtmlBehaviorResource.convention(key)) {
                    if (conventional.elementName !== null && !mainResource) {
                        mainResource = new ResourceDescription(key, exportedValue, conventional);
                    }
                    else {
                        resources.push(new ResourceDescription(key, exportedValue, conventional));
                    }
                    __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
                }
                else if (conventional = __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"].convention(key)
                    || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"].convention(key)
                    || ViewEngineHooksResource.convention(key)) {
                    resources.push(new ResourceDescription(key, exportedValue, conventional));
                    __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, conventional, exportedValue);
                }
                else if (!fallbackValue) {
                    fallbackValue = exportedValue;
                    fallbackKey = key;
                }
            }
        }
        if (!mainResource && fallbackValue) {
            mainResource = new ResourceDescription(fallbackKey, fallbackValue);
        }
        resourceModule.moduleInstance = moduleInstance;
        resourceModule.mainResource = mainResource;
        resourceModule.resources = resources;
        resourceModule.viewStrategy = vs;
        return resourceModule;
    };
    return ModuleAnalyzer;
}());

var logger = __WEBPACK_IMPORTED_MODULE_4_aurelia_logging__["getLogger"]('templating');
function ensureRegistryEntry(loader, urlOrRegistryEntry) {
    if (urlOrRegistryEntry instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_loader__["TemplateRegistryEntry"]) {
        return Promise.resolve(urlOrRegistryEntry);
    }
    return loader.loadTemplate(urlOrRegistryEntry);
}
var ProxyViewFactory = (function () {
    function ProxyViewFactory(promise) {
        var _this = this;
        promise.then(function (x) { return _this.viewFactory = x; });
    }
    ProxyViewFactory.prototype.create = function (container, bindingContext, createInstruction, element) {
        return this.viewFactory.create(container, bindingContext, createInstruction, element);
    };
    Object.defineProperty(ProxyViewFactory.prototype, "isCaching", {
        get: function () {
            return this.viewFactory.isCaching;
        },
        enumerable: false,
        configurable: true
    });
    ProxyViewFactory.prototype.setCacheSize = function (size, doNotOverrideIfAlreadySet) {
        this.viewFactory.setCacheSize(size, doNotOverrideIfAlreadySet);
    };
    ProxyViewFactory.prototype.getCachedView = function () {
        return this.viewFactory.getCachedView();
    };
    ProxyViewFactory.prototype.returnViewToCache = function (view) {
        this.viewFactory.returnViewToCache(view);
    };
    return ProxyViewFactory;
}());
var auSlotBehavior = null;
var ViewEngine = (function () {
    function ViewEngine(loader, container, viewCompiler, moduleAnalyzer, appResources) {
        this.loader = loader;
        this.container = container;
        this.viewCompiler = viewCompiler;
        this.moduleAnalyzer = moduleAnalyzer;
        this.appResources = appResources;
        this._pluginMap = {};
        if (auSlotBehavior === null) {
            auSlotBehavior = new HtmlBehaviorResource();
            auSlotBehavior.attributeName = 'au-slot';
            __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, auSlotBehavior, SlotCustomAttribute);
        }
        auSlotBehavior.initialize(container, SlotCustomAttribute);
        auSlotBehavior.register(appResources);
    }
    ViewEngine.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_loader__["Loader"], __WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"], ViewCompiler, ModuleAnalyzer, ViewResources];
    };
    ViewEngine.prototype.addResourcePlugin = function (extension, implementation) {
        var name = extension.replace('.', '') + '-resource-plugin';
        this._pluginMap[extension] = name;
        this.loader.addPlugin(name, implementation);
    };
    ViewEngine.prototype.loadViewFactory = function (urlOrRegistryEntry, compileInstruction, loadContext, target) {
        var _this = this;
        loadContext = loadContext || new ResourceLoadContext();
        return ensureRegistryEntry(this.loader, urlOrRegistryEntry).then(function (registryEntry) {
            var url = registryEntry.address;
            if (registryEntry.onReady) {
                if (!loadContext.hasDependency(url)) {
                    loadContext.addDependency(url);
                    return registryEntry.onReady;
                }
                if (registryEntry.template === null) {
                    return registryEntry.onReady;
                }
                return Promise.resolve(new ProxyViewFactory(registryEntry.onReady));
            }
            loadContext.addDependency(url);
            registryEntry.onReady = _this.loadTemplateResources(registryEntry, compileInstruction, loadContext, target).then(function (resources) {
                registryEntry.resources = resources;
                if (registryEntry.template === null) {
                    return registryEntry.factory = null;
                }
                var viewFactory = _this.viewCompiler.compile(registryEntry.template, resources, compileInstruction);
                return registryEntry.factory = viewFactory;
            });
            return registryEntry.onReady;
        });
    };
    ViewEngine.prototype.loadTemplateResources = function (registryEntry, compileInstruction, loadContext, target) {
        var resources = new ViewResources(this.appResources, registryEntry.address);
        var dependencies = registryEntry.dependencies;
        var importIds;
        var names;
        compileInstruction = compileInstruction || ViewCompileInstruction.normal;
        if (dependencies.length === 0 && !compileInstruction.associatedModuleId) {
            return Promise.resolve(resources);
        }
        importIds = dependencies.map(function (x) { return x.src; });
        names = dependencies.map(function (x) { return x.name; });
        logger.debug("importing resources for ".concat(registryEntry.address), importIds);
        if (target) {
            var viewModelRequires = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].get(ViewEngine.viewModelRequireMetadataKey, target);
            if (viewModelRequires) {
                var templateImportCount = importIds.length;
                for (var i = 0, ii = viewModelRequires.length; i < ii; ++i) {
                    var req = viewModelRequires[i];
                    var importId = typeof req === 'function'
                        ? __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(req).moduleId
                        : __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"])(req.src || req, registryEntry.address);
                    if (importIds.indexOf(importId) === -1) {
                        importIds.push(importId);
                        names.push(req.as);
                    }
                }
                logger.debug("importing ViewModel resources for ".concat(compileInstruction.associatedModuleId), importIds.slice(templateImportCount));
            }
        }
        return this.importViewResources(importIds, names, resources, compileInstruction, loadContext);
    };
    ViewEngine.prototype.importViewModelResource = function (moduleImport, moduleMember) {
        var _this = this;
        return this.loader.loadModule(moduleImport).then(function (viewModelModule) {
            var normalizedId = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(viewModelModule).moduleId;
            var resourceModule = _this.moduleAnalyzer.analyze(normalizedId, viewModelModule, moduleMember);
            if (!resourceModule.mainResource) {
                throw new Error("No view model found in module \"".concat(moduleImport, "\"."));
            }
            resourceModule.initialize(_this.container);
            return resourceModule.mainResource;
        });
    };
    ViewEngine.prototype.importViewResources = function (moduleIds, names, resources, compileInstruction, loadContext) {
        var _this = this;
        loadContext = loadContext || new ResourceLoadContext();
        compileInstruction = compileInstruction || ViewCompileInstruction.normal;
        moduleIds = moduleIds.map(function (x) { return _this._applyLoaderPlugin(x); });
        return this.loader.loadAllModules(moduleIds).then(function (imports) {
            var i;
            var ii;
            var analysis;
            var normalizedId;
            var current;
            var associatedModule;
            var container = _this.container;
            var moduleAnalyzer = _this.moduleAnalyzer;
            var allAnalysis = new Array(imports.length);
            for (i = 0, ii = imports.length; i < ii; ++i) {
                current = imports[i];
                normalizedId = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(current).moduleId;
                analysis = moduleAnalyzer.analyze(normalizedId, current);
                analysis.initialize(container);
                analysis.register(resources, names[i]);
                allAnalysis[i] = analysis;
            }
            if (compileInstruction.associatedModuleId) {
                associatedModule = moduleAnalyzer.getAnalysis(compileInstruction.associatedModuleId);
                if (associatedModule) {
                    associatedModule.register(resources);
                }
            }
            for (i = 0, ii = allAnalysis.length; i < ii; ++i) {
                allAnalysis[i] = allAnalysis[i].load(container, loadContext);
            }
            return Promise.all(allAnalysis).then(function () { return resources; });
        });
    };
    ViewEngine.prototype._applyLoaderPlugin = function (id) {
        var index = id.lastIndexOf('.');
        if (index !== -1) {
            var ext = id.substring(index);
            var pluginName = this._pluginMap[ext];
            if (pluginName === undefined) {
                return id;
            }
            return this.loader.applyPluginToUrl(id, pluginName);
        }
        return id;
    };
    ViewEngine.viewModelRequireMetadataKey = 'aurelia:view-model-require';
    return ViewEngine;
}());

var Controller = (function () {
    function Controller(behavior, instruction, viewModel, container) {
        this.behavior = behavior;
        this.instruction = instruction;
        this.viewModel = viewModel;
        this.isAttached = false;
        this.view = null;
        this.isBound = false;
        this.scope = null;
        this.container = container;
        this.elementEvents = container.elementEvents || null;
        var observerLookup = behavior.observerLocator.getOrCreateObserversLookup(viewModel);
        var handlesBind = behavior.handlesBind;
        var attributes = instruction.attributes;
        var boundProperties = this.boundProperties = [];
        var properties = behavior.properties;
        var i;
        var ii;
        behavior._ensurePropertiesDefined(viewModel, observerLookup);
        for (i = 0, ii = properties.length; i < ii; ++i) {
            properties[i]._initialize(viewModel, observerLookup, attributes, handlesBind, boundProperties);
        }
    }
    Controller.prototype.created = function (owningView) {
        if (this.behavior.handlesCreated) {
            this.viewModel.created(owningView, this.view);
        }
    };
    Controller.prototype.automate = function (overrideContext, owningView) {
        this.view.bindingContext = this.viewModel;
        this.view.overrideContext = overrideContext || __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel);
        this.view._isUserControlled = true;
        if (this.behavior.handlesCreated) {
            this.viewModel.created(owningView || null, this.view);
        }
        this.bind(this.view);
    };
    Controller.prototype.bind = function (scope) {
        var skipSelfSubscriber = this.behavior.handlesBind;
        var boundProperties = this.boundProperties;
        var i;
        var ii;
        var x;
        var observer;
        var selfSubscriber;
        if (this.isBound) {
            if (this.scope === scope) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.scope = scope;
        for (i = 0, ii = boundProperties.length; i < ii; ++i) {
            x = boundProperties[i];
            observer = x.observer;
            selfSubscriber = observer.selfSubscriber;
            observer.publishing = false;
            if (skipSelfSubscriber) {
                observer.selfSubscriber = null;
            }
            x.binding.bind(scope);
            observer.call();
            observer.publishing = true;
            observer.selfSubscriber = selfSubscriber;
        }
        var overrideContext;
        if (this.view !== null) {
            if (skipSelfSubscriber) {
                this.view.viewModelScope = scope;
            }
            if (this.viewModel === scope.overrideContext.bindingContext) {
                overrideContext = scope.overrideContext;
            }
            else if (this.instruction.inheritBindingContext) {
                overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel, scope.overrideContext);
            }
            else {
                overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(this.viewModel);
                overrideContext.__parentOverrideContext = scope.overrideContext;
            }
            this.view.bind(this.viewModel, overrideContext);
        }
        else if (skipSelfSubscriber) {
            overrideContext = scope.overrideContext;
            if (scope.overrideContext.__parentOverrideContext !== undefined
                && this.viewModel.viewFactory && this.viewModel.viewFactory.factoryCreateInstruction.partReplacements) {
                overrideContext = Object.assign({}, scope.overrideContext);
                overrideContext.parentOverrideContext = scope.overrideContext.__parentOverrideContext;
            }
            this.viewModel.bind(scope.bindingContext, overrideContext);
        }
    };
    Controller.prototype.unbind = function () {
        if (this.isBound) {
            var boundProperties = this.boundProperties;
            var i = void 0;
            var ii = void 0;
            this.isBound = false;
            this.scope = null;
            if (this.view !== null) {
                this.view.unbind();
            }
            if (this.behavior.handlesUnbind) {
                this.viewModel.unbind();
            }
            if (this.elementEvents !== null) {
                this.elementEvents.disposeAll();
            }
            for (i = 0, ii = boundProperties.length; i < ii; ++i) {
                boundProperties[i].binding.unbind();
            }
        }
    };
    Controller.prototype.attached = function () {
        if (this.isAttached) {
            return;
        }
        this.isAttached = true;
        if (this.behavior.handlesAttached) {
            this.viewModel.attached();
        }
        if (this.view !== null) {
            this.view.attached();
        }
    };
    Controller.prototype.detached = function () {
        if (this.isAttached) {
            this.isAttached = false;
            if (this.view !== null) {
                this.view.detached();
            }
            if (this.behavior.handlesDetached) {
                this.viewModel.detached();
            }
        }
    };
    return Controller;
}());

var lastProviderId = 0;
function nextProviderId() {
    return ++lastProviderId;
}
function doProcessContent() { return true; }
function doProcessAttributes() { }
var HtmlBehaviorResource = (function () {
    function HtmlBehaviorResource() {
        this.elementName = null;
        this.attributeName = null;
        this.attributeDefaultBindingMode = undefined;
        this.liftsContent = false;
        this.targetShadowDOM = false;
        this.shadowDOMOptions = null;
        this.processAttributes = doProcessAttributes;
        this.processContent = doProcessContent;
        this.usesShadowDOM = false;
        this.childBindings = null;
        this.hasDynamicOptions = false;
        this.containerless = false;
        this.properties = [];
        this.attributes = {};
        this.isInitialized = false;
        this.primaryProperty = null;
    }
    HtmlBehaviorResource.convention = function (name, existing) {
        var behavior;
        if (name.endsWith('CustomAttribute')) {
            behavior = existing || new HtmlBehaviorResource();
            behavior.attributeName = _hyphenate(name.substring(0, name.length - 15));
        }
        if (name.endsWith('CustomElement')) {
            behavior = existing || new HtmlBehaviorResource();
            behavior.elementName = _hyphenate(name.substring(0, name.length - 13));
        }
        return behavior;
    };
    HtmlBehaviorResource.prototype.addChildBinding = function (behavior) {
        if (this.childBindings === null) {
            this.childBindings = [];
        }
        this.childBindings.push(behavior);
    };
    HtmlBehaviorResource.prototype.initialize = function (container, target) {
        var proto = target.prototype;
        var properties = this.properties;
        var attributeName = this.attributeName;
        var attributeDefaultBindingMode = this.attributeDefaultBindingMode;
        var i;
        var ii;
        var current;
        if (this.isInitialized) {
            return;
        }
        this.isInitialized = true;
        target.__providerId__ = nextProviderId();
        this.observerLocator = container.get(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ObserverLocator"]);
        this.taskQueue = container.get(__WEBPACK_IMPORTED_MODULE_7_aurelia_task_queue__["TaskQueue"]);
        this.target = target;
        this.usesShadowDOM = this.targetShadowDOM && __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["FEATURE"].shadowDOM;
        this.handlesCreated = ('created' in proto);
        this.handlesBind = ('bind' in proto);
        this.handlesUnbind = ('unbind' in proto);
        this.handlesAttached = ('attached' in proto);
        this.handlesDetached = ('detached' in proto);
        this.htmlName = this.elementName || this.attributeName;
        if (attributeName !== null) {
            if (properties.length === 0) {
                new BindableProperty({
                    name: 'value',
                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
                    attribute: attributeName,
                    defaultBindingMode: attributeDefaultBindingMode
                }).registerWith(target, this);
            }
            current = properties[0];
            if (properties.length === 1 && current.name === 'value') {
                current.isDynamic = current.hasOptions = this.hasDynamicOptions;
                current.defineOn(target, this);
            }
            else {
                for (i = 0, ii = properties.length; i < ii; ++i) {
                    properties[i].defineOn(target, this);
                    if (properties[i].primaryProperty) {
                        if (this.primaryProperty) {
                            throw new Error('Only one bindable property on a custom element can be defined as the default');
                        }
                        this.primaryProperty = properties[i];
                    }
                }
                current = new BindableProperty({
                    name: 'value',
                    changeHandler: 'valueChanged' in proto ? 'valueChanged' : null,
                    attribute: attributeName,
                    defaultBindingMode: attributeDefaultBindingMode
                });
                current.hasOptions = true;
                current.registerWith(target, this);
            }
        }
        else {
            for (i = 0, ii = properties.length; i < ii; ++i) {
                properties[i].defineOn(target, this);
            }
            this._copyInheritedProperties(container, target);
        }
    };
    HtmlBehaviorResource.prototype.register = function (registry, name) {
        var _this = this;
        if (this.attributeName !== null) {
            registry.registerAttribute(name || this.attributeName, this, this.attributeName);
            if (Array.isArray(this.aliases)) {
                this.aliases
                    .forEach(function (alias) {
                    registry.registerAttribute(alias, _this, _this.attributeName);
                });
            }
        }
        if (this.elementName !== null) {
            registry.registerElement(name || this.elementName, this);
        }
    };
    HtmlBehaviorResource.prototype.aliases = function (aliases) {
        throw new Error('Method not implemented.');
    };
    HtmlBehaviorResource.prototype.load = function (container, target, loadContext, viewStrategy, transientView) {
        var _this = this;
        var options;
        if (this.elementName !== null) {
            viewStrategy = container.get(ViewLocator).getViewStrategy(viewStrategy || this.viewStrategy || target);
            options = new ViewCompileInstruction(this.targetShadowDOM, true);
            if (!viewStrategy.moduleId) {
                viewStrategy.moduleId = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["Origin"].get(target).moduleId;
            }
            return viewStrategy
                .loadViewFactory(container.get(ViewEngine), options, loadContext, target)
                .then(function (viewFactory) {
                if (!transientView || !_this.viewFactory) {
                    _this.viewFactory = viewFactory;
                }
                return viewFactory;
            });
        }
        return Promise.resolve(this);
    };
    HtmlBehaviorResource.prototype.compile = function (compiler, resources, node, instruction, parentNode) {
        if (this.liftsContent) {
            if (!instruction.viewFactory) {
                var template = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createElement('template');
                var fragment = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createDocumentFragment();
                var cacheSize = node.getAttribute('view-cache');
                var part = node.getAttribute('part');
                node.removeAttribute(instruction.originalAttrName);
                __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].replaceNode(template, node, parentNode);
                fragment.appendChild(node);
                instruction.viewFactory = compiler.compile(fragment, resources);
                if (part) {
                    instruction.viewFactory.part = part;
                    node.removeAttribute('part');
                }
                if (cacheSize) {
                    instruction.viewFactory.setCacheSize(cacheSize);
                    node.removeAttribute('view-cache');
                }
                node = template;
            }
        }
        else if (this.elementName !== null) {
            var partReplacements = {};
            if (this.processContent(compiler, resources, node, instruction) && node.hasChildNodes()) {
                var currentChild = node.firstChild;
                var contentElement = this.usesShadowDOM ? null : __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createElement('au-content');
                var nextSibling = void 0;
                var toReplace = void 0;
                while (currentChild) {
                    nextSibling = currentChild.nextSibling;
                    if (currentChild.tagName === 'TEMPLATE' && (toReplace = currentChild.getAttribute('replace-part'))) {
                        partReplacements[toReplace] = compiler.compile(currentChild, resources);
                        __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].removeNode(currentChild, parentNode);
                        instruction.partReplacements = partReplacements;
                    }
                    else if (contentElement !== null) {
                        if (currentChild.nodeType === 3 && _isAllWhitespace(currentChild)) {
                            __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].removeNode(currentChild, parentNode);
                        }
                        else {
                            contentElement.appendChild(currentChild);
                        }
                    }
                    currentChild = nextSibling;
                }
                if (contentElement !== null && contentElement.hasChildNodes()) {
                    node.appendChild(contentElement);
                }
                instruction.skipContentProcessing = false;
            }
            else {
                instruction.skipContentProcessing = true;
            }
        }
        else if (!this.processContent(compiler, resources, node, instruction)) {
            instruction.skipContentProcessing = true;
        }
        return node;
    };
    HtmlBehaviorResource.prototype.create = function (container, instruction, element, bindings) {
        var viewHost;
        var au = null;
        instruction = instruction || BehaviorInstruction.normal;
        element = element || null;
        bindings = bindings || null;
        if (this.elementName !== null && element) {
            if (this.usesShadowDOM) {
                viewHost = element.attachShadow(this.shadowDOMOptions);
                container.registerInstance(__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].boundary, viewHost);
            }
            else {
                viewHost = element;
                if (this.targetShadowDOM) {
                    container.registerInstance(__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].boundary, viewHost);
                }
            }
        }
        if (element !== null) {
            element.au = au = element.au || {};
        }
        var viewModel = instruction.viewModel || container.get(this.target);
        var controller = new Controller(this, instruction, viewModel, container);
        var childBindings = this.childBindings;
        var viewFactory;
        if (this.liftsContent) {
            au.controller = controller;
        }
        else if (this.elementName !== null) {
            viewFactory = instruction.viewFactory || this.viewFactory;
            container.viewModel = viewModel;
            if (viewFactory) {
                controller.view = viewFactory.create(container, instruction, element);
            }
            if (element !== null) {
                au.controller = controller;
                if (controller.view) {
                    if (!this.usesShadowDOM && (element.childNodes.length === 1 || element.contentElement)) {
                        var contentElement = element.childNodes[0] || element.contentElement;
                        controller.view.contentView = { fragment: contentElement };
                        contentElement.parentNode && __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].removeNode(contentElement);
                    }
                    if (instruction.anchorIsContainer) {
                        if (childBindings !== null) {
                            for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                                controller.view.addBinding(childBindings[i].create(element, viewModel, controller));
                            }
                        }
                        controller.view.appendNodesTo(viewHost);
                    }
                    else {
                        controller.view.insertNodesBefore(viewHost);
                    }
                }
                else if (childBindings !== null) {
                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                        bindings.push(childBindings[i].create(element, viewModel, controller));
                    }
                }
            }
            else if (controller.view) {
                controller.view.controller = controller;
                if (childBindings !== null) {
                    for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                        controller.view.addBinding(childBindings[i].create(instruction.host, viewModel, controller));
                    }
                }
            }
            else if (childBindings !== null) {
                for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                    bindings.push(childBindings[i].create(instruction.host, viewModel, controller));
                }
            }
        }
        else if (childBindings !== null) {
            for (var i = 0, ii = childBindings.length; i < ii; ++i) {
                bindings.push(childBindings[i].create(element, viewModel, controller));
            }
        }
        if (au !== null) {
            au[this.htmlName] = controller;
        }
        if (instruction.initiatedByBehavior && viewFactory) {
            controller.view.created();
        }
        return controller;
    };
    HtmlBehaviorResource.prototype._ensurePropertiesDefined = function (instance, lookup) {
        var properties;
        var i;
        var ii;
        var observer;
        if ('__propertiesDefined__' in lookup) {
            return;
        }
        lookup.__propertiesDefined__ = true;
        properties = this.properties;
        for (i = 0, ii = properties.length; i < ii; ++i) {
            observer = properties[i].createObserver(instance);
            if (observer !== undefined) {
                lookup[observer.propertyName] = observer;
            }
        }
    };
    HtmlBehaviorResource.prototype._copyInheritedProperties = function (container, target) {
        var behavior;
        var derived = target;
        while (true) {
            var proto = Object.getPrototypeOf(target.prototype);
            target = proto && proto.constructor;
            if (!target) {
                return;
            }
            behavior = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, target);
            if (behavior) {
                break;
            }
        }
        behavior.initialize(container, target);
        var _loop_1 = function (i, ii) {
            var prop = behavior.properties[i];
            if (this_1.properties.some(function (p) { return p.name === prop.name; })) {
                return "continue";
            }
            new BindableProperty(prop).registerWith(derived, this_1);
        };
        var this_1 = this;
        for (var i = 0, ii = behavior.properties.length; i < ii; ++i) {
            _loop_1(i);
        }
    };
    return HtmlBehaviorResource;
}());

function register(lookup, name, resource, type) {
    if (!name) {
        return;
    }
    var existing = lookup[name];
    if (existing) {
        if (existing !== resource) {
            throw new Error("Attempted to register ".concat(type, " when one with the same name already exists. Name: ").concat(name, "."));
        }
        return;
    }
    lookup[name] = resource;
}
function validateBehaviorName(name, type) {
    if (/[A-Z]/.test(name)) {
        var newName = _hyphenate(name);
        __WEBPACK_IMPORTED_MODULE_4_aurelia_logging__["getLogger"]('templating')
            .warn("'".concat(name, "' is not a valid ").concat(type, " name and has been converted to '").concat(newName, "'. Upper-case letters are not allowed because the DOM is not case-sensitive."));
        return newName;
    }
    return name;
}
var conventionMark = '__au_resource__';
var ViewResources = (function () {
    function ViewResources(parent, viewUrl) {
        this.bindingLanguage = null;
        this.parent = parent || null;
        this.hasParent = this.parent !== null;
        this.viewUrl = viewUrl || '';
        this.lookupFunctions = {
            valueConverters: this.getValueConverter.bind(this),
            bindingBehaviors: this.getBindingBehavior.bind(this)
        };
        this.attributes = Object.create(null);
        this.elements = Object.create(null);
        this.valueConverters = Object.create(null);
        this.bindingBehaviors = Object.create(null);
        this.attributeMap = Object.create(null);
        this.values = Object.create(null);
        this.beforeCompile = this.afterCompile = this.beforeCreate = this.afterCreate = this.beforeBind = this.beforeUnbind = false;
    }
    ViewResources.convention = function (target, existing) {
        var resource;
        if (existing && conventionMark in existing) {
            return existing;
        }
        if ('$resource' in target) {
            var config = target.$resource;
            if (typeof config === 'string') {
                resource = existing || new HtmlBehaviorResource();
                resource[conventionMark] = true;
                if (!resource.elementName) {
                    resource.elementName = validateBehaviorName(config, 'custom element');
                }
            }
            else {
                if (typeof config === 'function') {
                    config = config.call(target);
                }
                if (typeof config === 'string') {
                    config = { name: config };
                }
                config = Object.assign({}, config);
                var resourceType = config.type || 'element';
                var name_1 = config.name;
                switch (resourceType) {
                    case 'element':
                    case 'attribute':
                        resource = existing || new HtmlBehaviorResource();
                        resource[conventionMark] = true;
                        if (resourceType === 'element') {
                            if (!resource.elementName) {
                                resource.elementName = name_1
                                    ? validateBehaviorName(name_1, 'custom element')
                                    : _hyphenate(target.name);
                            }
                        }
                        else {
                            if (!resource.attributeName) {
                                resource.attributeName = name_1
                                    ? validateBehaviorName(name_1, 'custom attribute')
                                    : _hyphenate(target.name);
                            }
                        }
                        if ('templateController' in config) {
                            config.liftsContent = config.templateController;
                            delete config.templateController;
                        }
                        if ('defaultBindingMode' in config && resource.attributeDefaultBindingMode !== undefined) {
                            config.attributeDefaultBindingMode = config.defaultBindingMode;
                            delete config.defaultBindingMode;
                        }
                        delete config.name;
                        Object.assign(resource, config);
                        break;
                    case 'valueConverter':
                        resource = new __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"](__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["camelCase"])(name_1 || target.name));
                        break;
                    case 'bindingBehavior':
                        resource = new __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"](__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["camelCase"])(name_1 || target.name));
                        break;
                    case 'viewEngineHooks':
                        resource = new ViewEngineHooksResource();
                        break;
                }
            }
            if (resource instanceof HtmlBehaviorResource) {
                var bindables = typeof config === 'string' ? undefined : config.bindables;
                var currentProps = resource.properties;
                if (Array.isArray(bindables)) {
                    for (var i = 0, ii = bindables.length; ii > i; ++i) {
                        var prop = bindables[i];
                        if (!prop || (typeof prop !== 'string' && !prop.name)) {
                            throw new Error("Invalid bindable property at \"".concat(i, "\" for class \"").concat(target.name, "\". Expected either a string or an object with \"name\" property."));
                        }
                        var newProp = new BindableProperty(prop);
                        var existed = false;
                        for (var j = 0, jj = currentProps.length; jj > j; ++j) {
                            if (currentProps[j].name === newProp.name) {
                                existed = true;
                                break;
                            }
                        }
                        if (existed) {
                            continue;
                        }
                        newProp.registerWith(target, resource);
                    }
                }
            }
        }
        return resource;
    };
    ViewResources.prototype._tryAddHook = function (obj, name) {
        if (typeof obj[name] === 'function') {
            var func = obj[name].bind(obj);
            var counter = 1;
            var callbackName = void 0;
            while (this[callbackName = name + counter.toString()] !== undefined) {
                counter++;
            }
            this[name] = true;
            this[callbackName] = func;
        }
    };
    ViewResources.prototype._invokeHook = function (name, one, two, three, four) {
        if (this.hasParent) {
            this.parent._invokeHook(name, one, two, three, four);
        }
        if (this[name]) {
            this[name + '1'](one, two, three, four);
            var callbackName = name + '2';
            if (this[callbackName]) {
                this[callbackName](one, two, three, four);
                callbackName = name + '3';
                if (this[callbackName]) {
                    this[callbackName](one, two, three, four);
                    var counter = 4;
                    while (this[callbackName = name + counter.toString()] !== undefined) {
                        this[callbackName](one, two, three, four);
                        counter++;
                    }
                }
            }
        }
    };
    ViewResources.prototype.registerViewEngineHooks = function (hooks) {
        this._tryAddHook(hooks, 'beforeCompile');
        this._tryAddHook(hooks, 'afterCompile');
        this._tryAddHook(hooks, 'beforeCreate');
        this._tryAddHook(hooks, 'afterCreate');
        this._tryAddHook(hooks, 'beforeBind');
        this._tryAddHook(hooks, 'beforeUnbind');
    };
    ViewResources.prototype.getBindingLanguage = function (bindingLanguageFallback) {
        return this.bindingLanguage || (this.bindingLanguage = bindingLanguageFallback);
    };
    ViewResources.prototype.patchInParent = function (newParent) {
        var originalParent = this.parent;
        this.parent = newParent || null;
        this.hasParent = this.parent !== null;
        if (newParent.parent === null) {
            newParent.parent = originalParent;
            newParent.hasParent = originalParent !== null;
        }
    };
    ViewResources.prototype.relativeToView = function (path) {
        return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"])(path, this.viewUrl);
    };
    ViewResources.prototype.registerElement = function (tagName, behavior) {
        register(this.elements, tagName, behavior, 'an Element');
    };
    ViewResources.prototype.getElement = function (tagName) {
        return this.elements[tagName] || (this.hasParent ? this.parent.getElement(tagName) : null);
    };
    ViewResources.prototype.mapAttribute = function (attribute) {
        return this.attributeMap[attribute] || (this.hasParent ? this.parent.mapAttribute(attribute) : null);
    };
    ViewResources.prototype.registerAttribute = function (attribute, behavior, knownAttribute) {
        this.attributeMap[attribute] = knownAttribute;
        register(this.attributes, attribute, behavior, 'an Attribute');
    };
    ViewResources.prototype.getAttribute = function (attribute) {
        return this.attributes[attribute] || (this.hasParent ? this.parent.getAttribute(attribute) : null);
    };
    ViewResources.prototype.registerValueConverter = function (name, valueConverter) {
        register(this.valueConverters, name, valueConverter, 'a ValueConverter');
    };
    ViewResources.prototype.getValueConverter = function (name) {
        return this.valueConverters[name] || (this.hasParent ? this.parent.getValueConverter(name) : null);
    };
    ViewResources.prototype.registerBindingBehavior = function (name, bindingBehavior) {
        register(this.bindingBehaviors, name, bindingBehavior, 'a BindingBehavior');
    };
    ViewResources.prototype.getBindingBehavior = function (name) {
        return this.bindingBehaviors[name] || (this.hasParent ? this.parent.getBindingBehavior(name) : null);
    };
    ViewResources.prototype.registerValue = function (name, value) {
        register(this.values, name, value, 'a value');
    };
    ViewResources.prototype.getValue = function (name) {
        return this.values[name] || (this.hasParent ? this.parent.getValue(name) : null);
    };
    ViewResources.prototype.autoRegister = function (container, impl) {
        var resourceTypeMeta = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, impl);
        if (resourceTypeMeta) {
            if (resourceTypeMeta instanceof HtmlBehaviorResource) {
                ViewResources.convention(impl, resourceTypeMeta);
                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
                    HtmlBehaviorResource.convention(impl.name, resourceTypeMeta);
                }
                if (resourceTypeMeta.attributeName === null && resourceTypeMeta.elementName === null) {
                    resourceTypeMeta.elementName = _hyphenate(impl.name);
                }
            }
        }
        else {
            resourceTypeMeta = ViewResources.convention(impl)
                || HtmlBehaviorResource.convention(impl.name)
                || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["ValueConverterResource"].convention(impl.name)
                || __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["BindingBehaviorResource"].convention(impl.name)
                || ViewEngineHooksResource.convention(impl.name);
            if (!resourceTypeMeta) {
                resourceTypeMeta = new HtmlBehaviorResource();
                resourceTypeMeta.elementName = _hyphenate(impl.name);
            }
            __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, resourceTypeMeta, impl);
        }
        resourceTypeMeta.initialize(container, impl);
        resourceTypeMeta.register(this, undefined);
        return resourceTypeMeta;
    };
    return ViewResources;
}());

var viewStrategy = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["protocol"].create('aurelia:view-strategy', {
    validate: function (target) {
        if (!(typeof target.loadViewFactory === 'function')) {
            return 'View strategies must implement: loadViewFactory(viewEngine: ViewEngine, compileInstruction: ViewCompileInstruction, loadContext?: ResourceLoadContext): Promise<ViewFactory>';
        }
        return true;
    },
    compose: function (target) {
        if (!(typeof target.makeRelativeTo === 'function')) {
            target.makeRelativeTo = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["PLATFORM"].noop;
        }
    }
});
var RelativeViewStrategy = (function () {
    function RelativeViewStrategy(path) {
        this.path = path;
        this.absolutePath = null;
    }
    RelativeViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        if (this.absolutePath === null && this.moduleId) {
            this.absolutePath = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"])(this.path, this.moduleId);
        }
        compileInstruction.associatedModuleId = this.moduleId;
        return viewEngine.loadViewFactory(this.absolutePath || this.path, compileInstruction, loadContext, target);
    };
    RelativeViewStrategy.prototype.makeRelativeTo = function (file) {
        if (this.absolutePath === null) {
            this.absolutePath = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"])(this.path, file);
        }
    };
    RelativeViewStrategy = __decorate([
        viewStrategy()
    ], RelativeViewStrategy);
    return RelativeViewStrategy;
}());
var ConventionalViewStrategy = (function () {
    function ConventionalViewStrategy(viewLocator, origin) {
        this.moduleId = origin.moduleId;
        this.viewUrl = viewLocator.convertOriginToViewUrl(origin);
    }
    ConventionalViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        compileInstruction.associatedModuleId = this.moduleId;
        return viewEngine.loadViewFactory(this.viewUrl, compileInstruction, loadContext, target);
    };
    ConventionalViewStrategy = __decorate([
        viewStrategy()
    ], ConventionalViewStrategy);
    return ConventionalViewStrategy;
}());
var NoViewStrategy = (function () {
    function NoViewStrategy(dependencies, dependencyBaseUrl) {
        this.dependencies = dependencies || null;
        this.dependencyBaseUrl = dependencyBaseUrl || '';
    }
    NoViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        var entry = this.entry;
        var dependencies = this.dependencies;
        if (entry && entry.factoryIsReady) {
            return Promise.resolve(null);
        }
        this.entry = entry = new __WEBPACK_IMPORTED_MODULE_1_aurelia_loader__["TemplateRegistryEntry"](this.moduleId || this.dependencyBaseUrl);
        entry.dependencies = [];
        entry.templateIsLoaded = true;
        if (dependencies !== null) {
            for (var i = 0, ii = dependencies.length; i < ii; ++i) {
                var current = dependencies[i];
                if (typeof current === 'string' || typeof current === 'function') {
                    entry.addDependency(current);
                }
                else {
                    entry.addDependency(current.from, current.as);
                }
            }
        }
        compileInstruction.associatedModuleId = this.moduleId;
        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
    };
    NoViewStrategy = __decorate([
        viewStrategy()
    ], NoViewStrategy);
    return NoViewStrategy;
}());
var TemplateRegistryViewStrategy = (function () {
    function TemplateRegistryViewStrategy(moduleId, entry) {
        this.moduleId = moduleId;
        this.entry = entry;
    }
    TemplateRegistryViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        var entry = this.entry;
        if (entry.factoryIsReady) {
            return Promise.resolve(entry.factory);
        }
        compileInstruction.associatedModuleId = this.moduleId;
        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
    };
    TemplateRegistryViewStrategy = __decorate([
        viewStrategy()
    ], TemplateRegistryViewStrategy);
    return TemplateRegistryViewStrategy;
}());
var InlineViewStrategy = (function () {
    function InlineViewStrategy(markup, dependencies, dependencyBaseUrl) {
        this.markup = markup;
        this.dependencies = dependencies || null;
        this.dependencyBaseUrl = dependencyBaseUrl || '';
    }
    InlineViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        var entry = this.entry;
        var dependencies = this.dependencies;
        if (entry && entry.factoryIsReady) {
            return Promise.resolve(entry.factory);
        }
        this.entry = entry = new __WEBPACK_IMPORTED_MODULE_1_aurelia_loader__["TemplateRegistryEntry"](this.moduleId || this.dependencyBaseUrl);
        entry.template = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createTemplateFromMarkup(this.markup);
        if (dependencies !== null) {
            for (var i = 0, ii = dependencies.length; i < ii; ++i) {
                var current = dependencies[i];
                if (typeof current === 'string' || typeof current === 'function') {
                    entry.addDependency(current);
                }
                else {
                    entry.addDependency(current.from, current.as);
                }
            }
        }
        compileInstruction.associatedModuleId = this.moduleId;
        return viewEngine.loadViewFactory(entry, compileInstruction, loadContext, target);
    };
    InlineViewStrategy = __decorate([
        viewStrategy()
    ], InlineViewStrategy);
    return InlineViewStrategy;
}());
var StaticViewStrategy = (function () {
    function StaticViewStrategy(config) {
        if (typeof config === 'string' || (config instanceof __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element && config.tagName === 'TEMPLATE')) {
            config = {
                template: config
            };
        }
        this.template = config.template;
        this.dependencies = config.dependencies || [];
        this.factoryIsReady = false;
        this.onReady = null;
        this.moduleId = 'undefined';
    }
    StaticViewStrategy.prototype.loadViewFactory = function (viewEngine, compileInstruction, loadContext, target) {
        var _this = this;
        if (this.factoryIsReady) {
            return Promise.resolve(this.factory);
        }
        var $deps = this.dependencies;
        var deps = typeof $deps === 'function' ? $deps() : $deps;
        deps = deps ? deps : [];
        deps = Array.isArray(deps) ? deps : [deps];
        return Promise.all(deps).then(function (dependencies) {
            var container = viewEngine.container;
            var appResources = viewEngine.appResources;
            var viewCompiler = viewEngine.viewCompiler;
            var viewResources = new ViewResources(appResources);
            var resource;
            var elDeps = [];
            if (target) {
                viewResources.autoRegister(container, target);
            }
            for (var _i = 0, dependencies_1 = dependencies; _i < dependencies_1.length; _i++) {
                var dep = dependencies_1[_i];
                if (typeof dep === 'function') {
                    resource = viewResources.autoRegister(container, dep);
                    if (resource.elementName !== null) {
                        elDeps.push(resource);
                    }
                }
                else if (dep && typeof dep === 'object') {
                    for (var key in dep) {
                        var exported = dep[key];
                        if (typeof exported === 'function') {
                            resource = viewResources.autoRegister(container, exported);
                            if (resource.elementName !== null) {
                                elDeps.push(resource);
                            }
                        }
                    }
                }
                else {
                    throw new Error("dependency neither function nor object. Received: \"".concat(typeof dep, "\""));
                }
            }
            return Promise.all(elDeps.map(function (el) { return el.load(container, el.target); })).then(function () {
                var factory = _this.template !== null
                    ? viewCompiler.compile(_this.template, viewResources, compileInstruction)
                    : null;
                _this.factoryIsReady = true;
                _this.factory = factory;
                return factory;
            });
        });
    };
    StaticViewStrategy = __decorate([
        viewStrategy()
    ], StaticViewStrategy);
    return StaticViewStrategy;
}());

function remove(viewSlot, previous) {
    return Array.isArray(previous)
        ? viewSlot.removeMany(previous, true)
        : viewSlot.remove(previous, true);
}
var SwapStrategies = {
    before: function (viewSlot, previous, callback) {
        return (previous === undefined)
            ? callback()
            : callback().then(function () { return remove(viewSlot, previous); });
    },
    with: function (viewSlot, previous, callback) {
        return (previous === undefined)
            ? callback()
            : Promise.all([remove(viewSlot, previous), callback()]);
    },
    after: function (viewSlot, previous, callback) {
        return Promise.resolve(viewSlot.removeAll(true)).then(callback);
    }
};

function tryActivateViewModel(context) {
    if (context.skipActivation || typeof context.viewModel.activate !== 'function') {
        return Promise.resolve();
    }
    return context.viewModel.activate(context.model) || Promise.resolve();
}
var CompositionEngine = (function () {
    function CompositionEngine(viewEngine, viewLocator) {
        this.viewEngine = viewEngine;
        this.viewLocator = viewLocator;
    }
    CompositionEngine.prototype._swap = function (context, view) {
        var swapStrategy = SwapStrategies[context.swapOrder] || SwapStrategies.after;
        var previousViews = context.viewSlot.children.slice();
        return swapStrategy(context.viewSlot, previousViews, function () {
            return Promise.resolve(context.viewSlot.add(view)).then(function () {
                if (context.currentController) {
                    context.currentController.unbind();
                }
            });
        }).then(function () {
            if (context.compositionTransactionNotifier) {
                context.compositionTransactionNotifier.done();
            }
        });
    };
    CompositionEngine.prototype._createControllerAndSwap = function (context) {
        var _this = this;
        return this.createController(context).then(function (controller) {
            if (context.compositionTransactionOwnershipToken) {
                return context.compositionTransactionOwnershipToken
                    .waitForCompositionComplete()
                    .then(function () {
                    controller.automate(context.overrideContext, context.owningView);
                    return _this._swap(context, controller.view);
                })
                    .then(function () { return controller; });
            }
            controller.automate(context.overrideContext, context.owningView);
            return _this._swap(context, controller.view).then(function () { return controller; });
        });
    };
    CompositionEngine.prototype.createController = function (context) {
        var _this = this;
        var childContainer;
        var viewModel;
        var viewModelResource;
        var m;
        return this
            .ensureViewModel(context)
            .then(tryActivateViewModel)
            .then(function () {
            childContainer = context.childContainer;
            viewModel = context.viewModel;
            viewModelResource = context.viewModelResource;
            m = viewModelResource.metadata;
            var viewStrategy = _this.viewLocator.getViewStrategy(context.view || viewModel);
            if (context.viewResources) {
                viewStrategy.makeRelativeTo(context.viewResources.viewUrl);
            }
            return m.load(childContainer, viewModelResource.value, null, viewStrategy, true);
        }).then(function (viewFactory) { return m.create(childContainer, BehaviorInstruction.dynamic(context.host, viewModel, viewFactory)); });
    };
    CompositionEngine.prototype.ensureViewModel = function (context) {
        var childContainer = context.childContainer = (context.childContainer || context.container.createChild());
        if (typeof context.viewModel === 'string') {
            context.viewModel = context.viewResources
                ? context.viewResources.relativeToView(context.viewModel)
                : context.viewModel;
            return this.viewEngine.importViewModelResource(context.viewModel).then(function (viewModelResource) {
                childContainer.autoRegister(viewModelResource.value);
                if (context.host) {
                    childContainer.registerInstance(__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element, context.host);
                }
                context.viewModel = childContainer.viewModel = childContainer.get(viewModelResource.value);
                context.viewModelResource = viewModelResource;
                return context;
            });
        }
        var ctor = context.viewModel.constructor;
        var isClass = typeof context.viewModel === 'function';
        if (isClass) {
            ctor = context.viewModel;
            childContainer.autoRegister(ctor);
        }
        var m = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, ctor);
        m.elementName = m.elementName || 'dynamic-element';
        m.initialize(isClass ? childContainer : (context.container || childContainer), ctor);
        context.viewModelResource = { metadata: m, value: ctor };
        if (context.host) {
            childContainer.registerInstance(__WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element, context.host);
        }
        childContainer.viewModel = context.viewModel = isClass ? childContainer.get(ctor) : context.viewModel;
        return Promise.resolve(context);
    };
    CompositionEngine.prototype.compose = function (context) {
        var _this = this;
        context.childContainer = context.childContainer || context.container.createChild();
        context.view = this.viewLocator.getViewStrategy(context.view);
        var transaction = context.childContainer.get(CompositionTransaction);
        var compositionTransactionOwnershipToken = transaction.tryCapture();
        if (compositionTransactionOwnershipToken) {
            context.compositionTransactionOwnershipToken = compositionTransactionOwnershipToken;
        }
        else {
            context.compositionTransactionNotifier = transaction.enlist();
        }
        if (context.viewModel) {
            return this._createControllerAndSwap(context);
        }
        else if (context.view) {
            if (context.viewResources) {
                context.view.makeRelativeTo(context.viewResources.viewUrl);
            }
            return context.view.loadViewFactory(this.viewEngine, new ViewCompileInstruction()).then(function (viewFactory) {
                var result = viewFactory.create(context.childContainer);
                result.bind(context.bindingContext, context.overrideContext);
                if (context.compositionTransactionOwnershipToken) {
                    return context.compositionTransactionOwnershipToken.waitForCompositionComplete()
                        .then(function () { return _this._swap(context, result); })
                        .then(function () { return result; });
                }
                return _this._swap(context, result).then(function () { return result; });
            });
        }
        else if (context.viewSlot) {
            context.viewSlot.removeAll();
            if (context.compositionTransactionNotifier) {
                context.compositionTransactionNotifier.done();
            }
            return Promise.resolve(null);
        }
        return Promise.resolve(null);
    };
    CompositionEngine = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["inject"])(ViewEngine, ViewLocator)
    ], CompositionEngine);
    return CompositionEngine;
}());

var animationEvent = {
    enterBegin: 'animation:enter:begin',
    enterActive: 'animation:enter:active',
    enterDone: 'animation:enter:done',
    enterTimeout: 'animation:enter:timeout',
    leaveBegin: 'animation:leave:begin',
    leaveActive: 'animation:leave:active',
    leaveDone: 'animation:leave:done',
    leaveTimeout: 'animation:leave:timeout',
    staggerNext: 'animation:stagger:next',
    removeClassBegin: 'animation:remove-class:begin',
    removeClassActive: 'animation:remove-class:active',
    removeClassDone: 'animation:remove-class:done',
    removeClassTimeout: 'animation:remove-class:timeout',
    addClassBegin: 'animation:add-class:begin',
    addClassActive: 'animation:add-class:active',
    addClassDone: 'animation:add-class:done',
    addClassTimeout: 'animation:add-class:timeout',
    animateBegin: 'animation:animate:begin',
    animateActive: 'animation:animate:active',
    animateDone: 'animation:animate:done',
    animateTimeout: 'animation:animate:timeout',
    sequenceBegin: 'animation:sequence:begin',
    sequenceDone: 'animation:sequence:done'
};

function createChildObserverDecorator(selectorOrConfig, all) {
    return function (target, key, descriptor) {
        var actualTarget = typeof key === 'string' ? target.constructor : target;
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, actualTarget);
        if (typeof selectorOrConfig === 'string') {
            selectorOrConfig = {
                selector: selectorOrConfig,
                name: key
            };
        }
        if (descriptor) {
            descriptor.writable = true;
            descriptor.configurable = true;
        }
        selectorOrConfig.all = all;
        r.addChildBinding(new ChildObserver(selectorOrConfig));
    };
}
function children(selectorOrConfig) {
    return createChildObserverDecorator(selectorOrConfig, true);
}
function child(selectorOrConfig) {
    return createChildObserverDecorator(selectorOrConfig, false);
}
var ChildObserver = (function () {
    function ChildObserver(config) {
        this.name = config.name;
        this.changeHandler = config.changeHandler || this.name + 'Changed';
        this.selector = config.selector;
        this.all = config.all;
    }
    ChildObserver.prototype.create = function (viewHost, viewModel, controller) {
        return new ChildObserverBinder(this.selector, viewHost, this.name, viewModel, controller, this.changeHandler, this.all);
    };
    return ChildObserver;
}());
var noMutations = [];
function trackMutation(groupedMutations, binder, record) {
    var mutations = groupedMutations.get(binder);
    if (!mutations) {
        mutations = [];
        groupedMutations.set(binder, mutations);
    }
    mutations.push(record);
}
function onChildChange(mutations, observer) {
    var binders = observer.binders;
    var bindersLength = binders.length;
    var groupedMutations = new Map();
    for (var i = 0, ii = mutations.length; i < ii; ++i) {
        var record = mutations[i];
        var added = record.addedNodes;
        var removed = record.removedNodes;
        for (var j = 0, jj = removed.length; j < jj; ++j) {
            var node = removed[j];
            if (node.nodeType === 1) {
                for (var k = 0; k < bindersLength; ++k) {
                    var binder = binders[k];
                    if (binder.onRemove(node)) {
                        trackMutation(groupedMutations, binder, record);
                    }
                }
            }
        }
        for (var j = 0, jj = added.length; j < jj; ++j) {
            var node = added[j];
            if (node.nodeType === 1) {
                for (var k = 0; k < bindersLength; ++k) {
                    var binder = binders[k];
                    if (binder.onAdd(node)) {
                        trackMutation(groupedMutations, binder, record);
                    }
                }
            }
        }
    }
    groupedMutations.forEach(function (mutationRecords, binder) {
        if (binder.isBound && binder.changeHandler !== null) {
            binder.viewModel[binder.changeHandler](mutationRecords);
        }
    });
}
var ChildObserverBinder = (function () {
    function ChildObserverBinder(selector, viewHost, property, viewModel, controller, changeHandler, all) {
        this.selector = selector;
        this.viewHost = viewHost;
        this.property = property;
        this.viewModel = viewModel;
        this.controller = controller;
        this.changeHandler = changeHandler in viewModel ? changeHandler : null;
        this.usesShadowDOM = controller.behavior.usesShadowDOM;
        this.all = all;
        if (!this.usesShadowDOM && controller.view && controller.view.contentView) {
            this.contentView = controller.view.contentView;
        }
        else {
            this.contentView = null;
        }
        this.source = null;
        this.isBound = false;
    }
    ChildObserverBinder.prototype.matches = function (element) {
        if (element.matches(this.selector)) {
            if (this.contentView === null) {
                return true;
            }
            var contentView = this.contentView;
            var assignedSlot = element.auAssignedSlot;
            if (assignedSlot && assignedSlot.projectFromAnchors) {
                var anchors = assignedSlot.projectFromAnchors;
                for (var i = 0, ii = anchors.length; i < ii; ++i) {
                    if (anchors[i].auOwnerView === contentView) {
                        return true;
                    }
                }
                return false;
            }
            return element.auOwnerView === contentView;
        }
        return false;
    };
    ChildObserverBinder.prototype.bind = function (source) {
        if (this.isBound) {
            if (this.source === source) {
                return;
            }
            this.source = source;
        }
        this.isBound = true;
        var viewHost = this.viewHost;
        var viewModel = this.viewModel;
        var observer = viewHost.__childObserver__;
        if (!observer) {
            observer = viewHost.__childObserver__ = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createMutationObserver(onChildChange);
            var options = {
                childList: true,
                subtree: !this.usesShadowDOM
            };
            observer.observe(viewHost, options);
            observer.binders = [];
        }
        observer.binders.push(this);
        if (this.usesShadowDOM) {
            var current = viewHost.firstElementChild;
            if (this.all) {
                var items = viewModel[this.property];
                if (!items) {
                    items = viewModel[this.property] = [];
                }
                else {
                    items.splice(0);
                }
                while (current) {
                    if (this.matches(current)) {
                        items.push(current.au && current.au.controller ? current.au.controller.viewModel : current);
                    }
                    current = current.nextElementSibling;
                }
                if (this.changeHandler !== null) {
                    this.viewModel[this.changeHandler](noMutations);
                }
            }
            else {
                while (current) {
                    if (this.matches(current)) {
                        var value = current.au && current.au.controller ? current.au.controller.viewModel : current;
                        this.viewModel[this.property] = value;
                        if (this.changeHandler !== null) {
                            this.viewModel[this.changeHandler](value);
                        }
                        break;
                    }
                    current = current.nextElementSibling;
                }
            }
        }
    };
    ChildObserverBinder.prototype.onRemove = function (element) {
        if (this.matches(element)) {
            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;
            if (this.all) {
                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));
                var index = items.indexOf(value);
                if (index !== -1) {
                    items.splice(index, 1);
                }
                return true;
            }
            var currentValue = this.viewModel[this.property];
            if (currentValue === value) {
                this.viewModel[this.property] = null;
                if (this.isBound && this.changeHandler !== null) {
                    this.viewModel[this.changeHandler](value);
                }
            }
        }
        return false;
    };
    ChildObserverBinder.prototype.onAdd = function (element) {
        if (this.matches(element)) {
            var value = element.au && element.au.controller ? element.au.controller.viewModel : element;
            if (this.all) {
                var items = (this.viewModel[this.property] || (this.viewModel[this.property] = []));
                if (this.selector === '*') {
                    items.push(value);
                    return true;
                }
                var index = 0;
                var prev = element.previousElementSibling;
                while (prev) {
                    if (this.matches(prev)) {
                        index++;
                    }
                    prev = prev.previousElementSibling;
                }
                items.splice(index, 0, value);
                return true;
            }
            this.viewModel[this.property] = value;
            if (this.isBound && this.changeHandler !== null) {
                this.viewModel[this.changeHandler](value);
            }
        }
        return false;
    };
    ChildObserverBinder.prototype.unbind = function () {
        if (!this.isBound) {
            return;
        }
        this.isBound = false;
        this.source = null;
        var childObserver = this.viewHost.__childObserver__;
        if (childObserver) {
            var binders = childObserver.binders;
            if (binders && binders.length) {
                var idx = binders.indexOf(this);
                if (idx !== -1) {
                    binders.splice(idx, 1);
                }
                if (binders.length === 0) {
                    childObserver.disconnect();
                    this.viewHost.__childObserver__ = null;
                }
            }
            if (this.usesShadowDOM) {
                this.viewModel[this.property] = null;
            }
        }
    };
    return ChildObserverBinder;
}());

var ElementConfigResource = (function () {
    function ElementConfigResource() {
    }
    ElementConfigResource.prototype.initialize = function (container, target) { };
    ElementConfigResource.prototype.register = function (registry, name) { };
    ElementConfigResource.prototype.load = function (container, target) {
        var config = new target();
        var eventManager = container.get(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["EventManager"]);
        eventManager.registerElementConfig(config);
    };
    return ElementConfigResource;
}());

function resource(instanceOrConfig) {
    return function (target) {
        var isConfig = typeof instanceOrConfig === 'string' || Object.getPrototypeOf(instanceOrConfig) === Object.prototype;
        if (isConfig) {
            target.$resource = instanceOrConfig;
        }
        else {
            __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, instanceOrConfig, target);
        }
    };
}
function behavior(override) {
    return function (target) {
        if (override instanceof HtmlBehaviorResource) {
            __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, override, target);
        }
        else {
            var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
            Object.assign(r, override);
        }
    };
}
function customElement(name) {
    return function (target) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
        r.elementName = validateBehaviorName(name, 'custom element');
    };
}
function customAttribute(name, defaultBindingMode, aliases) {
    return function (target) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, target);
        r.attributeName = validateBehaviorName(name, 'custom attribute');
        r.attributeDefaultBindingMode = defaultBindingMode;
        r.aliases = aliases;
    };
}
function templateController(target) {
    var deco = function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.liftsContent = true;
    };
    return target ? deco(target) : deco;
}
function bindable(nameOrConfigOrTarget, key, descriptor) {
    var deco = function (target, key2, descriptor2) {
        var actualTarget = key2 ? target.constructor : target;
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, actualTarget);
        var prop;
        if (key2) {
            nameOrConfigOrTarget = nameOrConfigOrTarget || {};
            nameOrConfigOrTarget.name = key2;
        }
        prop = new BindableProperty(nameOrConfigOrTarget);
        return prop.registerWith(actualTarget, r, descriptor2);
    };
    if (!nameOrConfigOrTarget) {
        return deco;
    }
    if (key) {
        var target = nameOrConfigOrTarget;
        nameOrConfigOrTarget = null;
        return deco(target, key, descriptor);
    }
    return deco;
}
function dynamicOptions(target) {
    var deco = function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.hasDynamicOptions = true;
    };
    return target ? deco(target) : deco;
}
var defaultShadowDOMOptions = { mode: 'open' };
function useShadowDOM(targetOrOptions) {
    var options = typeof targetOrOptions === 'function' || !targetOrOptions
        ? defaultShadowDOMOptions
        : targetOrOptions;
    var deco = function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.targetShadowDOM = true;
        r.shadowDOMOptions = options;
    };
    return typeof targetOrOptions === 'function' ? deco(targetOrOptions) : deco;
}
function processAttributes(processor) {
    return function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.processAttributes = function (compiler, resources, node, attributes, elementInstruction) {
            try {
                processor(compiler, resources, node, attributes, elementInstruction);
            }
            catch (error) {
                __WEBPACK_IMPORTED_MODULE_4_aurelia_logging__["getLogger"]('templating').error(error);
            }
        };
    };
}
function doNotProcessContent() { return false; }
function processContent(processor) {
    return function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.processContent = processor ? function (compiler, resources, node, instruction) {
            try {
                return processor(compiler, resources, node, instruction);
            }
            catch (error) {
                __WEBPACK_IMPORTED_MODULE_4_aurelia_logging__["getLogger"]('templating').error(error);
                return false;
            }
        } : doNotProcessContent;
    };
}
function containerless(target) {
    var deco = function (t) {
        var r = __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].getOrCreateOwn(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, HtmlBehaviorResource, t);
        r.containerless = true;
    };
    return target ? deco(target) : deco;
}
function useViewStrategy(strategy) {
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, strategy, target);
    };
}
function useView(path) {
    return useViewStrategy(new RelativeViewStrategy(path));
}
function inlineView(markup, dependencies, dependencyBaseUrl) {
    return useViewStrategy(new InlineViewStrategy(markup, dependencies, dependencyBaseUrl));
}
function noView(targetOrDependencies, dependencyBaseUrl) {
    var target;
    var dependencies;
    if (typeof targetOrDependencies === 'function') {
        target = targetOrDependencies;
    }
    else {
        dependencies = targetOrDependencies;
        target = undefined;
    }
    var deco = function (t) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(ViewLocator.viewStrategyMetadataKey, new NoViewStrategy(dependencies, dependencyBaseUrl), t);
    };
    return target ? deco(target) : deco;
}
function view(templateOrConfig) {
    return function (target) {
        target.$view = templateOrConfig;
    };
}
function elementConfig(target) {
    var deco = function (t) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].resource, new ElementConfigResource(), t);
    };
    return target ? deco(target) : deco;
}
function viewResources() {
    var resources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        resources[_i] = arguments[_i];
    }
    return function (target) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_metadata__["metadata"].define(ViewEngine.viewModelRequireMetadataKey, resources, target);
    };
}

var TemplatingEngine = (function () {
    function TemplatingEngine(container, moduleAnalyzer, viewCompiler, compositionEngine) {
        this._container = container;
        this._moduleAnalyzer = moduleAnalyzer;
        this._viewCompiler = viewCompiler;
        this._compositionEngine = compositionEngine;
        container.registerInstance(Animator, Animator.instance = new Animator());
    }
    TemplatingEngine.prototype.configureAnimator = function (animator) {
        this._container.unregister(Animator);
        this._container.registerInstance(Animator, Animator.instance = animator);
    };
    TemplatingEngine.prototype.compose = function (context) {
        return this._compositionEngine.compose(context);
    };
    TemplatingEngine.prototype.enhance = function (instruction) {
        if (instruction instanceof __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].Element) {
            instruction = { element: instruction };
        }
        var compilerInstructions = { letExpressions: [] };
        var resources = instruction.resources || this._container.get(ViewResources);
        this._viewCompiler._compileNode(instruction.element, resources, compilerInstructions, instruction.element.parentNode, 'root', true);
        var factory = new ViewFactory(instruction.element, compilerInstructions, resources);
        var container = instruction.container || this._container.createChild();
        var view = factory.create(container, BehaviorInstruction.enhance());
        view.bind(instruction.bindingContext || {}, instruction.overrideContext);
        view.firstChild = view.lastChild = view.fragment;
        view.fragment = __WEBPACK_IMPORTED_MODULE_0_aurelia_pal__["DOM"].createDocumentFragment();
        view.attached();
        return view;
    };
    TemplatingEngine.inject = [__WEBPACK_IMPORTED_MODULE_6_aurelia_dependency_injection__["Container"], ModuleAnalyzer, ViewCompiler, CompositionEngine];
    return TemplatingEngine;
}());


//# sourceMappingURL=aurelia-templating.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ 70:
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "logLevel", function() { return logLevel; });
/* harmony export (immutable) */ exports["getLogger"] = getLogger;
/* harmony export (immutable) */ exports["addAppender"] = addAppender;
/* harmony export (immutable) */ exports["removeAppender"] = removeAppender;
/* harmony export (immutable) */ exports["getAppenders"] = getAppenders;
/* harmony export (immutable) */ exports["clearAppenders"] = clearAppenders;
/* harmony export (immutable) */ exports["addCustomLevel"] = addCustomLevel;
/* harmony export (immutable) */ exports["removeCustomLevel"] = removeCustomLevel;
/* harmony export (immutable) */ exports["setLevel"] = setLevel;
/* harmony export (immutable) */ exports["getLevel"] = getLevel;
/* harmony export (binding) */ __webpack_require__.d(exports, "Logger", function() { return Logger; });


var logLevel = {
  none: 0,
  error: 10,
  warn: 20,
  info: 30,
  debug: 40
};

var loggers = {};
var appenders = [];
var globalDefaultLevel = logLevel.none;

var standardLevels = ['none', 'error', 'warn', 'info', 'debug'];
function isStandardLevel(level) {
  return standardLevels.filter(function (l) {
    return l === level;
  }).length > 0;
}

function appendArgs() {
  return [this].concat(Array.prototype.slice.call(arguments));
}

function logFactory(level) {
  var threshold = logLevel[level];
  return function () {
    if (this.level < threshold) {
      return;
    }

    var args = appendArgs.apply(this, arguments);
    var i = appenders.length;
    while (i--) {
      var _appenders$i;

      (_appenders$i = appenders[i])[level].apply(_appenders$i, args);
    }
  };
}

function logFactoryCustom(level) {
  var threshold = logLevel[level];
  return function () {
    if (this.level < threshold) {
      return;
    }

    var args = appendArgs.apply(this, arguments);
    var i = appenders.length;
    while (i--) {
      var appender = appenders[i];
      if (appender[level] !== undefined) {
        appender[level].apply(appender, args);
      }
    }
  };
}

function connectLoggers() {
  var proto = Logger.prototype;
  for (var _level in logLevel) {
    if (isStandardLevel(_level)) {
      if (_level !== 'none') {
        proto[_level] = logFactory(_level);
      }
    } else {
      proto[_level] = logFactoryCustom(_level);
    }
  }
}

function disconnectLoggers() {
  var proto = Logger.prototype;
  for (var _level2 in logLevel) {
    if (_level2 !== 'none') {
      proto[_level2] = function () {};
    }
  }
}

function getLogger(id) {
  return loggers[id] || new Logger(id);
}

function addAppender(appender) {
  if (appenders.push(appender) === 1) {
    connectLoggers();
  }
}

function removeAppender(appender) {
  appenders = appenders.filter(function (a) {
    return a !== appender;
  });
}

function getAppenders() {
  return [].concat(appenders);
}

function clearAppenders() {
  appenders = [];
  disconnectLoggers();
}

function addCustomLevel(name, value) {
  if (logLevel[name] !== undefined) {
    throw Error('Log level "' + name + '" already exists.');
  }

  if (isNaN(value)) {
    throw Error('Value must be a number.');
  }

  logLevel[name] = value;

  if (appenders.length > 0) {
    connectLoggers();
  } else {
    Logger.prototype[name] = function () {};
  }
}

function removeCustomLevel(name) {
  if (logLevel[name] === undefined) {
    return;
  }

  if (isStandardLevel(name)) {
    throw Error('Built-in log level "' + name + '" cannot be removed.');
  }

  delete logLevel[name];
  delete Logger.prototype[name];
}

function setLevel(level) {
  globalDefaultLevel = level;
  for (var key in loggers) {
    loggers[key].setLevel(level);
  }
}

function getLevel() {
  return globalDefaultLevel;
}

var Logger = function () {
  function Logger(id) {
    

    var cached = loggers[id];
    if (cached) {
      return cached;
    }

    loggers[id] = this;
    this.id = id;
    this.level = globalDefaultLevel;
  }

  Logger.prototype.debug = function debug(message) {};

  Logger.prototype.info = function info(message) {};

  Logger.prototype.warn = function warn(message) {};

  Logger.prototype.error = function error(message) {};

  Logger.prototype.setLevel = function setLevel(level) {
    this.level = level;
  };

  Logger.prototype.isDebugEnabled = function isDebugEnabled() {
    return this.level === logLevel.debug;
  };

  return Logger;
}();

/***/ },

/***/ "aurelia-binding":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__ = __webpack_require__(58);
/* harmony export (binding) */ __webpack_require__.d(exports, "getArrayObserver", function() { return _getArrayObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getMapObserver", function() { return _getMapObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getSetObserver", function() { return _getSetObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "targetContext", function() { return targetContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "sourceContext", function() { return sourceContext; });
/* harmony export (immutable) */ exports["camelCase"] = camelCase;
/* harmony export (immutable) */ exports["createOverrideContext"] = createOverrideContext;
/* harmony export (immutable) */ exports["getContextFor"] = getContextFor;
/* harmony export (immutable) */ exports["createScopeForTest"] = createScopeForTest;
/* harmony export (immutable) */ exports["connectable"] = connectable;
/* harmony export (immutable) */ exports["enqueueBindingConnect"] = enqueueBindingConnect;
/* harmony export (immutable) */ exports["setConnectQueueThreshold"] = setConnectQueueThreshold;
/* harmony export (immutable) */ exports["enableConnectQueue"] = enableConnectQueue;
/* harmony export (immutable) */ exports["disableConnectQueue"] = disableConnectQueue;
/* harmony export (immutable) */ exports["getConnectQueueSize"] = getConnectQueueSize;
/* harmony export (immutable) */ exports["subscriberCollection"] = subscriberCollection;
/* harmony export (binding) */ __webpack_require__.d(exports, "ExpressionObserver", function() { return ExpressionObserver; });
/* harmony export (immutable) */ exports["calcSplices"] = calcSplices;
/* harmony export (immutable) */ exports["mergeSplice"] = mergeSplice;
/* harmony export (immutable) */ exports["projectArraySplices"] = projectArraySplices;
/* harmony export (immutable) */ exports["getChangeRecords"] = getChangeRecords;
/* harmony export (binding) */ __webpack_require__.d(exports, "ModifyCollectionObserver", function() { return ModifyCollectionObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CollectionLengthObserver", function() { return CollectionLengthObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Expression", function() { return Expression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingBehavior", function() { return BindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueConverter", function() { return ValueConverter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Assign", function() { return Assign; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Conditional", function() { return Conditional; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessThis", function() { return AccessThis; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessScope", function() { return AccessScope; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessMember", function() { return AccessMember; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AccessKeyed", function() { return AccessKeyed; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallScope", function() { return CallScope; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallMember", function() { return CallMember; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallFunction", function() { return CallFunction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Binary", function() { return Binary; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Unary", function() { return Unary; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralPrimitive", function() { return LiteralPrimitive; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralString", function() { return LiteralString; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralTemplate", function() { return LiteralTemplate; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralArray", function() { return LiteralArray; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LiteralObject", function() { return LiteralObject; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Unparser", function() { return _Unparser; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ExpressionCloner", function() { return ExpressionCloner; });
/* harmony export (immutable) */ exports["cloneExpression"] = cloneExpression;
/* harmony export (binding) */ __webpack_require__.d(exports, "bindingMode", function() { return bindingMode; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Parser", function() { return Parser; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ParserImplementation", function() { return ParserImplementation; });
/* harmony export (binding) */ __webpack_require__.d(exports, "delegationStrategy", function() { return delegationStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EventManager", function() { return EventManager; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EventSubscriber", function() { return EventSubscriber; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DirtyChecker", function() { return DirtyChecker; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DirtyCheckProperty", function() { return DirtyCheckProperty; });
/* harmony export (binding) */ __webpack_require__.d(exports, "propertyAccessor", function() { return propertyAccessor; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PrimitiveObserver", function() { return PrimitiveObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SetterObserver", function() { return SetterObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "XLinkAttributeObserver", function() { return XLinkAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "dataAttributeAccessor", function() { return dataAttributeAccessor; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DataAttributeObserver", function() { return DataAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StyleObserver", function() { return StyleObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueAttributeObserver", function() { return ValueAttributeObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CheckedObserver", function() { return CheckedObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SelectValueObserver", function() { return SelectValueObserver; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ClassObserver", function() { return ClassObserver; });
/* harmony export (immutable) */ exports["hasDeclaredDependencies"] = hasDeclaredDependencies;
/* harmony export (immutable) */ exports["declarePropertyDependencies"] = declarePropertyDependencies;
/* harmony export (immutable) */ exports["computedFrom"] = computedFrom;
/* harmony export (binding) */ __webpack_require__.d(exports, "ComputedExpression", function() { return ComputedExpression; });
/* harmony export (immutable) */ exports["createComputedObserver"] = createComputedObserver;
/* harmony export (binding) */ __webpack_require__.d(exports, "elements", function() { return elements; });
/* harmony export (binding) */ __webpack_require__.d(exports, "presentationElements", function() { return presentationElements; });
/* harmony export (binding) */ __webpack_require__.d(exports, "presentationAttributes", function() { return presentationAttributes; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SVGAnalyzer", function() { return SVGAnalyzer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ObserverLocator", function() { return ObserverLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ObjectObservationAdapter", function() { return ObjectObservationAdapter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingExpression", function() { return BindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Binding", function() { return Binding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CallExpression", function() { return CallExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Call", function() { return Call; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ValueConverterResource", function() { return ValueConverterResource; });
/* harmony export (immutable) */ exports["valueConverter"] = valueConverter;
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingBehaviorResource", function() { return BindingBehaviorResource; });
/* harmony export (immutable) */ exports["bindingBehavior"] = bindingBehavior;
/* harmony export (binding) */ __webpack_require__.d(exports, "ListenerExpression", function() { return ListenerExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Listener", function() { return Listener; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NameExpression", function() { return NameExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingEngine", function() { return BindingEngine; });
/* harmony export (immutable) */ exports["observable"] = observable;
/* harmony export (immutable) */ exports["connectBindingToSignal"] = connectBindingToSignal;
/* harmony export (immutable) */ exports["signalBindings"] = signalBindings;




var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var _dec, _dec2, _class, _dec3, _class2, _dec4, _class3, _dec5, _class5, _dec6, _class7, _dec7, _class8, _dec8, _class9, _dec9, _class10, _class12, _temp, _dec10, _class13, _class14, _temp2;

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }








var targetContext = 'Binding:target';
var sourceContext = 'Binding:source';

var map = Object.create(null);

function camelCase(name) {
  if (name in map) {
    return map[name];
  }
  var result = name.charAt(0).toLowerCase() + name.slice(1).replace(/[_.-](\w|$)/g, function (_, x) {
    return x.toUpperCase();
  });
  map[name] = result;
  return result;
}

function createOverrideContext(bindingContext, parentOverrideContext) {
  return {
    bindingContext: bindingContext,
    parentOverrideContext: parentOverrideContext || null
  };
}

function getContextFor(name, scope, ancestor) {
  var oc = scope.overrideContext;

  if (ancestor) {
    while (ancestor && oc) {
      ancestor--;
      oc = oc.parentOverrideContext;
    }
    if (ancestor || !oc) {
      return undefined;
    }
    return name in oc ? oc : oc.bindingContext;
  }

  while (oc && !(name in oc) && !(oc.bindingContext && name in oc.bindingContext)) {
    oc = oc.parentOverrideContext;
  }
  if (oc) {
    return name in oc ? oc : oc.bindingContext;
  }

  return scope.bindingContext || scope.overrideContext;
}

function createScopeForTest(bindingContext, parentBindingContext) {
  if (parentBindingContext) {
    return {
      bindingContext: bindingContext,
      overrideContext: createOverrideContext(bindingContext, createOverrideContext(parentBindingContext))
    };
  }
  return {
    bindingContext: bindingContext,
    overrideContext: createOverrideContext(bindingContext)
  };
}

var slotNames = [];
var versionSlotNames = [];
var lastSlot = -1;
function ensureEnoughSlotNames(currentSlot) {
  if (currentSlot === lastSlot) {
    lastSlot += 5;
    var ii = slotNames.length = versionSlotNames.length = lastSlot + 1;
    for (var i = currentSlot + 1; i < ii; ++i) {
      slotNames[i] = '_observer' + i;
      versionSlotNames[i] = '_observerVersion' + i;
    }
  }
}
ensureEnoughSlotNames(-1);

function addObserver(observer) {
  var observerSlots = this._observerSlots === undefined ? 0 : this._observerSlots;
  var i = observerSlots;
  while (i-- && this[slotNames[i]] !== observer) {}

  if (i === -1) {
    i = 0;
    while (this[slotNames[i]]) {
      i++;
    }
    this[slotNames[i]] = observer;
    observer.subscribe(sourceContext, this);

    if (i === observerSlots) {
      this._observerSlots = i + 1;
    }
  }

  if (this._version === undefined) {
    this._version = 0;
  }
  this[versionSlotNames[i]] = this._version;
  ensureEnoughSlotNames(i);
}

function observeProperty(obj, propertyName) {
  var observer = this.observerLocator.getObserver(obj, propertyName);
  addObserver.call(this, observer);
}

function observeArray(array) {
  var observer = this.observerLocator.getArrayObserver(array);
  addObserver.call(this, observer);
}

function unobserve(all) {
  var i = this._observerSlots;
  while (i--) {
    if (all || this[versionSlotNames[i]] !== this._version) {
      var observer = this[slotNames[i]];
      this[slotNames[i]] = null;
      if (observer) {
        observer.unsubscribe(sourceContext, this);
      }
    }
  }
}

function connectable() {
  return function (target) {
    target.prototype.observeProperty = observeProperty;
    target.prototype.observeArray = observeArray;
    target.prototype.unobserve = unobserve;
    target.prototype.addObserver = addObserver;
  };
}

var queue = [];
var queued = {};
var nextId = 0;
var minimumImmediate = 100;
var frameBudget = 15;

var isFlushRequested = false;
var immediate = 0;

function flush(animationFrameStart) {
  var length = queue.length;
  var i = 0;
  while (i < length) {
    var binding = queue[i];
    queued[binding.__connectQueueId] = false;
    binding.connect(true);
    i++;

    if (i % 100 === 0 && __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].performance.now() - animationFrameStart > frameBudget) {
      break;
    }
  }
  queue.splice(0, i);

  if (queue.length) {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].requestAnimationFrame(flush);
  } else {
    isFlushRequested = false;
    immediate = 0;
  }
}

function enqueueBindingConnect(binding) {
  if (immediate < minimumImmediate) {
    immediate++;
    binding.connect(false);
  } else {
    var id = binding.__connectQueueId;
    if (id === undefined) {
      id = nextId;
      nextId++;
      binding.__connectQueueId = id;
    }

    if (!queued[id]) {
      queue.push(binding);
      queued[id] = true;
    }
  }
  if (!isFlushRequested) {
    isFlushRequested = true;
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].requestAnimationFrame(flush);
  }
}

function setConnectQueueThreshold(value) {
  minimumImmediate = value;
}

function enableConnectQueue() {
  setConnectQueueThreshold(100);
}

function disableConnectQueue() {
  setConnectQueueThreshold(Number.MAX_SAFE_INTEGER);
}

function getConnectQueueSize() {
  return queue.length;
}

function addSubscriber(context, callable) {
  if (this.hasSubscriber(context, callable)) {
    return false;
  }
  if (!this._context0) {
    this._context0 = context;
    this._callable0 = callable;
    return true;
  }
  if (!this._context1) {
    this._context1 = context;
    this._callable1 = callable;
    return true;
  }
  if (!this._context2) {
    this._context2 = context;
    this._callable2 = callable;
    return true;
  }
  if (!this._contextsRest) {
    this._contextsRest = [context];
    this._callablesRest = [callable];
    return true;
  }
  this._contextsRest.push(context);
  this._callablesRest.push(callable);
  return true;
}

function removeSubscriber(context, callable) {
  if (this._context0 === context && this._callable0 === callable) {
    this._context0 = null;
    this._callable0 = null;
    return true;
  }
  if (this._context1 === context && this._callable1 === callable) {
    this._context1 = null;
    this._callable1 = null;
    return true;
  }
  if (this._context2 === context && this._callable2 === callable) {
    this._context2 = null;
    this._callable2 = null;
    return true;
  }
  var callables = this._callablesRest;
  if (callables === undefined || callables.length === 0) {
    return false;
  }
  var contexts = this._contextsRest;
  var i = 0;
  while (!(callables[i] === callable && contexts[i] === context) && callables.length > i) {
    i++;
  }
  if (i >= callables.length) {
    return false;
  }
  contexts.splice(i, 1);
  callables.splice(i, 1);
  return true;
}

var arrayPool1 = [];
var arrayPool2 = [];
var poolUtilization = [];

function callSubscribers(newValue, oldValue) {
  var context0 = this._context0;
  var callable0 = this._callable0;
  var context1 = this._context1;
  var callable1 = this._callable1;
  var context2 = this._context2;
  var callable2 = this._callable2;
  var length = this._contextsRest ? this._contextsRest.length : 0;
  var contextsRest = void 0;
  var callablesRest = void 0;
  var poolIndex = void 0;
  var i = void 0;
  if (length) {
    poolIndex = poolUtilization.length;
    while (poolIndex-- && poolUtilization[poolIndex]) {}
    if (poolIndex < 0) {
      poolIndex = poolUtilization.length;
      contextsRest = [];
      callablesRest = [];
      poolUtilization.push(true);
      arrayPool1.push(contextsRest);
      arrayPool2.push(callablesRest);
    } else {
      poolUtilization[poolIndex] = true;
      contextsRest = arrayPool1[poolIndex];
      callablesRest = arrayPool2[poolIndex];
    }

    i = length;
    while (i--) {
      contextsRest[i] = this._contextsRest[i];
      callablesRest[i] = this._callablesRest[i];
    }
  }

  if (context0) {
    if (callable0) {
      callable0.call(context0, newValue, oldValue);
    } else {
      context0(newValue, oldValue);
    }
  }
  if (context1) {
    if (callable1) {
      callable1.call(context1, newValue, oldValue);
    } else {
      context1(newValue, oldValue);
    }
  }
  if (context2) {
    if (callable2) {
      callable2.call(context2, newValue, oldValue);
    } else {
      context2(newValue, oldValue);
    }
  }
  if (length) {
    for (i = 0; i < length; i++) {
      var callable = callablesRest[i];
      var context = contextsRest[i];
      if (callable) {
        callable.call(context, newValue, oldValue);
      } else {
        context(newValue, oldValue);
      }
      contextsRest[i] = null;
      callablesRest[i] = null;
    }
    poolUtilization[poolIndex] = false;
  }
}

function hasSubscribers() {
  return !!(this._context0 || this._context1 || this._context2 || this._contextsRest && this._contextsRest.length);
}

function hasSubscriber(context, callable) {
  var has = this._context0 === context && this._callable0 === callable || this._context1 === context && this._callable1 === callable || this._context2 === context && this._callable2 === callable;
  if (has) {
    return true;
  }
  var index = void 0;
  var contexts = this._contextsRest;
  if (!contexts || (index = contexts.length) === 0) {
    return false;
  }
  var callables = this._callablesRest;
  while (index--) {
    if (contexts[index] === context && callables[index] === callable) {
      return true;
    }
  }
  return false;
}

function subscriberCollection() {
  return function (target) {
    target.prototype.addSubscriber = addSubscriber;
    target.prototype.removeSubscriber = removeSubscriber;
    target.prototype.callSubscribers = callSubscribers;
    target.prototype.hasSubscribers = hasSubscribers;
    target.prototype.hasSubscriber = hasSubscriber;
  };
}

var ExpressionObserver = (_dec = connectable(), _dec2 = subscriberCollection(), _dec(_class = _dec2(_class = function () {
  function ExpressionObserver(scope, expression, observerLocator, lookupFunctions) {
    

    this.scope = scope;
    this.expression = expression;
    this.observerLocator = observerLocator;
    this.lookupFunctions = lookupFunctions;
  }

  ExpressionObserver.prototype.getValue = function getValue() {
    return this.expression.evaluate(this.scope, this.lookupFunctions);
  };

  ExpressionObserver.prototype.setValue = function setValue(newValue) {
    this.expression.assign(this.scope, newValue);
  };

  ExpressionObserver.prototype.subscribe = function subscribe(context, callable) {
    var _this = this;

    if (!this.hasSubscribers()) {
      this.oldValue = this.expression.evaluate(this.scope, this.lookupFunctions);
      this.expression.connect(this, this.scope);
    }
    this.addSubscriber(context, callable);
    if (arguments.length === 1 && context instanceof Function) {
      return {
        dispose: function dispose() {
          _this.unsubscribe(context, callable);
        }
      };
    }
  };

  ExpressionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.unobserve(true);
      this.oldValue = undefined;
    }
  };

  ExpressionObserver.prototype.call = function call() {
    var newValue = this.expression.evaluate(this.scope, this.lookupFunctions);
    var oldValue = this.oldValue;
    if (newValue !== oldValue) {
      this.oldValue = newValue;
      this.callSubscribers(newValue, oldValue);
    }
    this._version++;
    this.expression.connect(this, this.scope);
    this.unobserve(false);
  };

  return ExpressionObserver;
}()) || _class) || _class);

function isIndex(s) {
  return +s === s >>> 0;
}

function toNumber(s) {
  return +s;
}

function newSplice(index, removed, addedCount) {
  return {
    index: index,
    removed: removed,
    addedCount: addedCount
  };
}

var EDIT_LEAVE = 0;
var EDIT_UPDATE = 1;
var EDIT_ADD = 2;
var EDIT_DELETE = 3;

function ArraySplice() {}

ArraySplice.prototype = {
  calcEditDistances: function calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var rowCount = oldEnd - oldStart + 1;
    var columnCount = currentEnd - currentStart + 1;
    var distances = new Array(rowCount);
    var north = void 0;
    var west = void 0;

    for (var i = 0; i < rowCount; ++i) {
      distances[i] = new Array(columnCount);
      distances[i][0] = i;
    }

    for (var j = 0; j < columnCount; ++j) {
      distances[0][j] = j;
    }

    for (var _i = 1; _i < rowCount; ++_i) {
      for (var _j = 1; _j < columnCount; ++_j) {
        if (this.equals(current[currentStart + _j - 1], old[oldStart + _i - 1])) {
          distances[_i][_j] = distances[_i - 1][_j - 1];
        } else {
          north = distances[_i - 1][_j] + 1;
          west = distances[_i][_j - 1] + 1;
          distances[_i][_j] = north < west ? north : west;
        }
      }
    }

    return distances;
  },

  spliceOperationsFromEditDistances: function spliceOperationsFromEditDistances(distances) {
    var i = distances.length - 1;
    var j = distances[0].length - 1;
    var current = distances[i][j];
    var edits = [];
    while (i > 0 || j > 0) {
      if (i === 0) {
        edits.push(EDIT_ADD);
        j--;
        continue;
      }
      if (j === 0) {
        edits.push(EDIT_DELETE);
        i--;
        continue;
      }
      var northWest = distances[i - 1][j - 1];
      var west = distances[i - 1][j];
      var north = distances[i][j - 1];

      var min = void 0;
      if (west < north) {
        min = west < northWest ? west : northWest;
      } else {
        min = north < northWest ? north : northWest;
      }

      if (min === northWest) {
        if (northWest === current) {
          edits.push(EDIT_LEAVE);
        } else {
          edits.push(EDIT_UPDATE);
          current = northWest;
        }
        i--;
        j--;
      } else if (min === west) {
        edits.push(EDIT_DELETE);
        i--;
        current = west;
      } else {
        edits.push(EDIT_ADD);
        j--;
        current = north;
      }
    }

    edits.reverse();
    return edits;
  },

  calcSplices: function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
    var prefixCount = 0;
    var suffixCount = 0;

    var minLength = Math.min(currentEnd - currentStart, oldEnd - oldStart);
    if (currentStart === 0 && oldStart === 0) {
      prefixCount = this.sharedPrefix(current, old, minLength);
    }

    if (currentEnd === current.length && oldEnd === old.length) {
      suffixCount = this.sharedSuffix(current, old, minLength - prefixCount);
    }

    currentStart += prefixCount;
    oldStart += prefixCount;
    currentEnd -= suffixCount;
    oldEnd -= suffixCount;

    if (currentEnd - currentStart === 0 && oldEnd - oldStart === 0) {
      return [];
    }

    if (currentStart === currentEnd) {
      var _splice = newSplice(currentStart, [], 0);
      while (oldStart < oldEnd) {
        _splice.removed.push(old[oldStart++]);
      }

      return [_splice];
    } else if (oldStart === oldEnd) {
      return [newSplice(currentStart, [], currentEnd - currentStart)];
    }

    var ops = this.spliceOperationsFromEditDistances(this.calcEditDistances(current, currentStart, currentEnd, old, oldStart, oldEnd));

    var splice = undefined;
    var splices = [];
    var index = currentStart;
    var oldIndex = oldStart;
    for (var i = 0; i < ops.length; ++i) {
      switch (ops[i]) {
        case EDIT_LEAVE:
          if (splice) {
            splices.push(splice);
            splice = undefined;
          }

          index++;
          oldIndex++;
          break;
        case EDIT_UPDATE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
        case EDIT_ADD:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.addedCount++;
          index++;
          break;
        case EDIT_DELETE:
          if (!splice) {
            splice = newSplice(index, [], 0);
          }

          splice.removed.push(old[oldIndex]);
          oldIndex++;
          break;
      }
    }

    if (splice) {
      splices.push(splice);
    }
    return splices;
  },

  sharedPrefix: function sharedPrefix(current, old, searchLength) {
    for (var i = 0; i < searchLength; ++i) {
      if (!this.equals(current[i], old[i])) {
        return i;
      }
    }

    return searchLength;
  },

  sharedSuffix: function sharedSuffix(current, old, searchLength) {
    var index1 = current.length;
    var index2 = old.length;
    var count = 0;
    while (count < searchLength && this.equals(current[--index1], old[--index2])) {
      count++;
    }

    return count;
  },

  calculateSplices: function calculateSplices(current, previous) {
    return this.calcSplices(current, 0, current.length, previous, 0, previous.length);
  },

  equals: function equals(currentValue, previousValue) {
    return currentValue === previousValue;
  }
};

var arraySplice = new ArraySplice();

function calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd) {
  return arraySplice.calcSplices(current, currentStart, currentEnd, old, oldStart, oldEnd);
}

function intersect(start1, end1, start2, end2) {
  if (end1 < start2 || end2 < start1) {
    return -1;
  }

  if (end1 === start2 || end2 === start1) {
    return 0;
  }

  if (start1 < start2) {
    if (end1 < end2) {
      return end1 - start2;
    }

    return end2 - start2;
  }

  if (end2 < end1) {
    return end2 - start1;
  }

  return end1 - start1;
}

function mergeSplice(splices, index, removed, addedCount) {
  var splice = newSplice(index, removed, addedCount);

  var inserted = false;
  var insertionOffset = 0;

  for (var i = 0; i < splices.length; i++) {
    var current = splices[i];
    current.index += insertionOffset;

    if (inserted) {
      continue;
    }

    var intersectCount = intersect(splice.index, splice.index + splice.removed.length, current.index, current.index + current.addedCount);

    if (intersectCount >= 0) {

      splices.splice(i, 1);
      i--;

      insertionOffset -= current.addedCount - current.removed.length;

      splice.addedCount += current.addedCount - intersectCount;
      var deleteCount = splice.removed.length + current.removed.length - intersectCount;

      if (!splice.addedCount && !deleteCount) {
        inserted = true;
      } else {
        var currentRemoved = current.removed;

        if (splice.index < current.index) {
          var prepend = splice.removed.slice(0, current.index - splice.index);
          Array.prototype.push.apply(prepend, currentRemoved);
          currentRemoved = prepend;
        }

        if (splice.index + splice.removed.length > current.index + current.addedCount) {
          var append = splice.removed.slice(current.index + current.addedCount - splice.index);
          Array.prototype.push.apply(currentRemoved, append);
        }

        splice.removed = currentRemoved;
        if (current.index < splice.index) {
          splice.index = current.index;
        }
      }
    } else if (splice.index < current.index) {

      inserted = true;

      splices.splice(i, 0, splice);
      i++;

      var offset = splice.addedCount - splice.removed.length;
      current.index += offset;
      insertionOffset += offset;
    }
  }

  if (!inserted) {
    splices.push(splice);
  }
}

function createInitialSplices(array, changeRecords) {
  var splices = [];

  for (var i = 0; i < changeRecords.length; i++) {
    var record = changeRecords[i];
    switch (record.type) {
      case 'splice':
        mergeSplice(splices, record.index, record.removed.slice(), record.addedCount);
        break;
      case 'add':
      case 'update':
      case 'delete':
        if (!isIndex(record.name)) {
          continue;
        }

        var index = toNumber(record.name);
        if (index < 0) {
          continue;
        }

        mergeSplice(splices, index, [record.oldValue], record.type === 'delete' ? 0 : 1);
        break;
      default:
        console.error('Unexpected record type: ' + JSON.stringify(record));
        break;
    }
  }

  return splices;
}

function projectArraySplices(array, changeRecords) {
  var splices = [];

  createInitialSplices(array, changeRecords).forEach(function (splice) {
    if (splice.addedCount === 1 && splice.removed.length === 1) {
      if (splice.removed[0] !== array[splice.index]) {
        splices.push(splice);
      }

      return;
    }

    splices = splices.concat(calcSplices(array, splice.index, splice.index + splice.addedCount, splice.removed, 0, splice.removed.length));
  });

  return splices;
}

function newRecord(type, object, key, oldValue) {
  return {
    type: type,
    object: object,
    key: key,
    oldValue: oldValue
  };
}

function getChangeRecords(map) {
  var entries = new Array(map.size);
  var keys = map.keys();
  var i = 0;
  var item = void 0;

  while (item = keys.next()) {
    if (item.done) {
      break;
    }

    entries[i] = newRecord('added', map, item.value);
    i++;
  }

  return entries;
}

var ModifyCollectionObserver = (_dec3 = subscriberCollection(), _dec3(_class2 = function () {
  function ModifyCollectionObserver(taskQueue, collection) {
    

    this.taskQueue = taskQueue;
    this.queued = false;
    this.changeRecords = null;
    this.oldCollection = null;
    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
  }

  ModifyCollectionObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  ModifyCollectionObserver.prototype.addChangeRecord = function addChangeRecord(changeRecord) {
    if (!this.hasSubscribers() && !this.lengthObserver) {
      return;
    }

    if (changeRecord.type === 'splice') {
      var index = changeRecord.index;
      var arrayLength = changeRecord.object.length;
      if (index > arrayLength) {
        index = arrayLength - changeRecord.addedCount;
      } else if (index < 0) {
        index = arrayLength + changeRecord.removed.length + index - changeRecord.addedCount;
      }
      if (index < 0) {
        index = 0;
      }
      changeRecord.index = index;
    }

    if (this.changeRecords === null) {
      this.changeRecords = [changeRecord];
    } else {
      this.changeRecords.push(changeRecord);
    }

    if (!this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.flushChangeRecords = function flushChangeRecords() {
    if (this.changeRecords && this.changeRecords.length || this.oldCollection) {
      this.call();
    }
  };

  ModifyCollectionObserver.prototype.reset = function reset(oldCollection) {
    this.oldCollection = oldCollection;

    if (this.hasSubscribers() && !this.queued) {
      this.queued = true;
      this.taskQueue.queueMicroTask(this);
    }
  };

  ModifyCollectionObserver.prototype.getLengthObserver = function getLengthObserver() {
    return this.lengthObserver || (this.lengthObserver = new CollectionLengthObserver(this.collection));
  };

  ModifyCollectionObserver.prototype.call = function call() {
    var changeRecords = this.changeRecords;
    var oldCollection = this.oldCollection;
    var records = void 0;

    this.queued = false;
    this.changeRecords = [];
    this.oldCollection = null;

    if (this.hasSubscribers()) {
      if (oldCollection) {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = getChangeRecords(oldCollection);
        } else {
          records = calcSplices(this.collection, 0, this.collection.length, oldCollection, 0, oldCollection.length);
        }
      } else {
        if (this.collection instanceof Map || this.collection instanceof Set) {
          records = changeRecords;
        } else {
          records = projectArraySplices(this.collection, changeRecords);
        }
      }

      this.callSubscribers(records);
    }

    if (this.lengthObserver) {
      this.lengthObserver.call(this.collection[this.lengthPropertyName]);
    }
  };

  return ModifyCollectionObserver;
}()) || _class2);

var CollectionLengthObserver = (_dec4 = subscriberCollection(), _dec4(_class3 = function () {
  function CollectionLengthObserver(collection) {
    

    this.collection = collection;
    this.lengthPropertyName = collection instanceof Map || collection instanceof Set ? 'size' : 'length';
    this.currentValue = collection[this.lengthPropertyName];
  }

  CollectionLengthObserver.prototype.getValue = function getValue() {
    return this.collection[this.lengthPropertyName];
  };

  CollectionLengthObserver.prototype.setValue = function setValue(newValue) {
    this.collection[this.lengthPropertyName] = newValue;
  };

  CollectionLengthObserver.prototype.subscribe = function subscribe(context, callable) {
    this.addSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  CollectionLengthObserver.prototype.call = function call(newValue) {
    var oldValue = this.currentValue;
    this.callSubscribers(newValue, oldValue);
    this.currentValue = newValue;
  };

  return CollectionLengthObserver;
}()) || _class3);

var arrayProto = Array.prototype;
var pop = arrayProto.pop;
var push = arrayProto.push;
var reverse = arrayProto.reverse;
var shift = arrayProto.shift;
var sort = arrayProto.sort;
var splice = arrayProto.splice;
var unshift = arrayProto.unshift;

if (arrayProto.__au_patched__) {
  __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('array-observation').warn('Detected 2nd attempt of patching array from Aurelia binding.' + ' This is probably caused by dependency mismatch between core modules and a 3rd party plugin.' + ' Please see https://github.com/aurelia/cli/pull/906 if you are using webpack.');
} else {
  Reflect.defineProperty(arrayProto, '__au_patched__', { value: 1 });
  arrayProto.pop = function () {
    var notEmpty = this.length > 0;
    var methodCallResult = pop.apply(this, arguments);
    if (notEmpty && this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'delete',
        object: this,
        name: this.length,
        oldValue: methodCallResult
      });
    }
    return methodCallResult;
  };

  arrayProto.push = function () {
    var methodCallResult = push.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: this.length - arguments.length,
        removed: [],
        addedCount: arguments.length
      });
    }
    return methodCallResult;
  };

  arrayProto.reverse = function () {
    var oldArray = void 0;
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.flushChangeRecords();
      oldArray = this.slice();
    }
    var methodCallResult = reverse.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.reset(oldArray);
    }
    return methodCallResult;
  };

  arrayProto.shift = function () {
    var notEmpty = this.length > 0;
    var methodCallResult = shift.apply(this, arguments);
    if (notEmpty && this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'delete',
        object: this,
        name: 0,
        oldValue: methodCallResult
      });
    }
    return methodCallResult;
  };

  arrayProto.sort = function () {
    var oldArray = void 0;
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.flushChangeRecords();
      oldArray = this.slice();
    }
    var methodCallResult = sort.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.reset(oldArray);
    }
    return methodCallResult;
  };

  arrayProto.splice = function () {
    var methodCallResult = splice.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: +arguments[0],
        removed: methodCallResult,
        addedCount: arguments.length > 2 ? arguments.length - 2 : 0
      });
    }
    return methodCallResult;
  };

  arrayProto.unshift = function () {
    var methodCallResult = unshift.apply(this, arguments);
    if (this.__array_observer__ !== undefined) {
      this.__array_observer__.addChangeRecord({
        type: 'splice',
        object: this,
        index: 0,
        removed: [],
        addedCount: arguments.length
      });
    }
    return methodCallResult;
  };
}

function _getArrayObserver(taskQueue, array) {
  return ModifyArrayObserver.for(taskQueue, array);
}

var ModifyArrayObserver = function (_ModifyCollectionObse) {
  _inherits(ModifyArrayObserver, _ModifyCollectionObse);

  function ModifyArrayObserver(taskQueue, array) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse.call(this, taskQueue, array));
  }

  ModifyArrayObserver.for = function _for(taskQueue, array) {
    if (!('__array_observer__' in array)) {
      Reflect.defineProperty(array, '__array_observer__', {
        value: ModifyArrayObserver.create(taskQueue, array),
        enumerable: false, configurable: false
      });
    }
    return array.__array_observer__;
  };

  ModifyArrayObserver.create = function create(taskQueue, array) {
    return new ModifyArrayObserver(taskQueue, array);
  };

  return ModifyArrayObserver;
}(ModifyCollectionObserver);

var Expression = function () {
  function Expression() {
    

    this.isAssignable = false;
  }

  Expression.prototype.evaluate = function evaluate(scope, lookupFunctions, args) {
    throw new Error('Binding expression "' + this + '" cannot be evaluated.');
  };

  Expression.prototype.assign = function assign(scope, value, lookupFunctions) {
    throw new Error('Binding expression "' + this + '" cannot be assigned to.');
  };

  Expression.prototype.toString = function toString() {
    return typeof FEATURE_NO_UNPARSER === 'undefined' ? _Unparser.unparse(this) : Function.prototype.toString.call(this);
  };

  return Expression;
}();

var BindingBehavior = function (_Expression) {
  _inherits(BindingBehavior, _Expression);

  function BindingBehavior(expression, name, args) {
    

    var _this3 = _possibleConstructorReturn(this, _Expression.call(this));

    _this3.expression = expression;
    _this3.name = name;
    _this3.args = args;
    return _this3;
  }

  BindingBehavior.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.expression.evaluate(scope, lookupFunctions);
  };

  BindingBehavior.prototype.assign = function assign(scope, value, lookupFunctions) {
    return this.expression.assign(scope, value, lookupFunctions);
  };

  BindingBehavior.prototype.accept = function accept(visitor) {
    return visitor.visitBindingBehavior(this);
  };

  BindingBehavior.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  BindingBehavior.prototype.bind = function bind(binding, scope, lookupFunctions) {
    if (this.expression.expression && this.expression.bind) {
      this.expression.bind(binding, scope, lookupFunctions);
    }
    var behavior = lookupFunctions.bindingBehaviors(this.name);
    if (!behavior) {
      throw new Error('No BindingBehavior named "' + this.name + '" was found!');
    }
    var behaviorKey = 'behavior-' + this.name;
    if (binding[behaviorKey]) {
      throw new Error('A binding behavior named "' + this.name + '" has already been applied to "' + this.expression + '"');
    }
    binding[behaviorKey] = behavior;
    behavior.bind.apply(behavior, [binding, scope].concat(evalList(scope, this.args, binding.lookupFunctions)));
  };

  BindingBehavior.prototype.unbind = function unbind(binding, scope) {
    var behaviorKey = 'behavior-' + this.name;
    binding[behaviorKey].unbind(binding, scope);
    binding[behaviorKey] = null;
    if (this.expression.expression && this.expression.unbind) {
      this.expression.unbind(binding, scope);
    }
  };

  return BindingBehavior;
}(Expression);

var ValueConverter = function (_Expression2) {
  _inherits(ValueConverter, _Expression2);

  function ValueConverter(expression, name, args) {
    

    var _this4 = _possibleConstructorReturn(this, _Expression2.call(this));

    _this4.expression = expression;
    _this4.name = name;
    _this4.args = args;
    _this4.allArgs = [expression].concat(args);
    return _this4;
  }

  ValueConverter.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('toView' in converter) {
      return converter.toView.apply(converter, evalList(scope, this.allArgs, lookupFunctions));
    }

    return this.allArgs[0].evaluate(scope, lookupFunctions);
  };

  ValueConverter.prototype.assign = function assign(scope, value, lookupFunctions) {
    var converter = lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }

    if ('fromView' in converter) {
      value = converter.fromView.apply(converter, [value].concat(evalList(scope, this.args, lookupFunctions)));
    }

    return this.allArgs[0].assign(scope, value, lookupFunctions);
  };

  ValueConverter.prototype.accept = function accept(visitor) {
    return visitor.visitValueConverter(this);
  };

  ValueConverter.prototype.connect = function connect(binding, scope) {
    var expressions = this.allArgs;
    var i = expressions.length;
    while (i--) {
      expressions[i].connect(binding, scope);
    }
    var converter = binding.lookupFunctions.valueConverters(this.name);
    if (!converter) {
      throw new Error('No ValueConverter named "' + this.name + '" was found!');
    }
    var signals = converter.signals;
    if (signals === undefined) {
      return;
    }
    i = signals.length;
    while (i--) {
      connectBindingToSignal(binding, signals[i]);
    }
  };

  return ValueConverter;
}(Expression);

var Assign = function (_Expression3) {
  _inherits(Assign, _Expression3);

  function Assign(target, value) {
    

    var _this5 = _possibleConstructorReturn(this, _Expression3.call(this));

    _this5.target = target;
    _this5.value = value;
    _this5.isAssignable = true;
    return _this5;
  }

  Assign.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.target.assign(scope, this.value.evaluate(scope, lookupFunctions));
  };

  Assign.prototype.accept = function accept(vistor) {
    vistor.visitAssign(this);
  };

  Assign.prototype.connect = function connect(binding, scope) {};

  Assign.prototype.assign = function assign(scope, value) {
    this.value.assign(scope, value);
    this.target.assign(scope, value);
  };

  return Assign;
}(Expression);

var Conditional = function (_Expression4) {
  _inherits(Conditional, _Expression4);

  function Conditional(condition, yes, no) {
    

    var _this6 = _possibleConstructorReturn(this, _Expression4.call(this));

    _this6.condition = condition;
    _this6.yes = yes;
    _this6.no = no;
    return _this6;
  }

  Conditional.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return !!this.condition.evaluate(scope, lookupFunctions) ? this.yes.evaluate(scope, lookupFunctions) : this.no.evaluate(scope, lookupFunctions);
  };

  Conditional.prototype.accept = function accept(visitor) {
    return visitor.visitConditional(this);
  };

  Conditional.prototype.connect = function connect(binding, scope) {
    this.condition.connect(binding, scope);
    if (this.condition.evaluate(scope)) {
      this.yes.connect(binding, scope);
    } else {
      this.no.connect(binding, scope);
    }
  };

  return Conditional;
}(Expression);

var AccessThis = function (_Expression5) {
  _inherits(AccessThis, _Expression5);

  function AccessThis(ancestor) {
    

    var _this7 = _possibleConstructorReturn(this, _Expression5.call(this));

    _this7.ancestor = ancestor;
    return _this7;
  }

  AccessThis.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var oc = scope.overrideContext;
    var i = this.ancestor;
    while (i-- && oc) {
      oc = oc.parentOverrideContext;
    }
    return i < 1 && oc ? oc.bindingContext : undefined;
  };

  AccessThis.prototype.accept = function accept(visitor) {
    return visitor.visitAccessThis(this);
  };

  AccessThis.prototype.connect = function connect(binding, scope) {};

  return AccessThis;
}(Expression);

var AccessScope = function (_Expression6) {
  _inherits(AccessScope, _Expression6);

  function AccessScope(name, ancestor) {
    

    var _this8 = _possibleConstructorReturn(this, _Expression6.call(this));

    _this8.name = name;
    _this8.ancestor = ancestor;
    _this8.isAssignable = true;
    return _this8;
  }

  AccessScope.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context[this.name];
  };

  AccessScope.prototype.assign = function assign(scope, value) {
    var context = getContextFor(this.name, scope, this.ancestor);
    return context ? context[this.name] = value : undefined;
  };

  AccessScope.prototype.accept = function accept(visitor) {
    return visitor.visitAccessScope(this);
  };

  AccessScope.prototype.connect = function connect(binding, scope) {
    var context = getContextFor(this.name, scope, this.ancestor);
    binding.observeProperty(context, this.name);
  };

  return AccessScope;
}(Expression);

var AccessMember = function (_Expression7) {
  _inherits(AccessMember, _Expression7);

  function AccessMember(object, name) {
    

    var _this9 = _possibleConstructorReturn(this, _Expression7.call(this));

    _this9.object = object;
    _this9.name = name;
    _this9.isAssignable = true;
    return _this9;
  }

  AccessMember.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    return instance === null || instance === undefined ? instance : instance[this.name];
  };

  AccessMember.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);

    if (instance === null || instance === undefined) {
      instance = {};
      this.object.assign(scope, instance);
    }

    instance[this.name] = value;
    return value;
  };

  AccessMember.prototype.accept = function accept(visitor) {
    return visitor.visitAccessMember(this);
  };

  AccessMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj) {
      binding.observeProperty(obj, this.name);
    }
  };

  return AccessMember;
}(Expression);

var AccessKeyed = function (_Expression8) {
  _inherits(AccessKeyed, _Expression8);

  function AccessKeyed(object, key) {
    

    var _this10 = _possibleConstructorReturn(this, _Expression8.call(this));

    _this10.object = object;
    _this10.key = key;
    _this10.isAssignable = true;
    return _this10;
  }

  AccessKeyed.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var lookup = this.key.evaluate(scope, lookupFunctions);
    return getKeyed(instance, lookup);
  };

  AccessKeyed.prototype.assign = function assign(scope, value) {
    var instance = this.object.evaluate(scope);
    var lookup = this.key.evaluate(scope);
    return setKeyed(instance, lookup, value);
  };

  AccessKeyed.prototype.accept = function accept(visitor) {
    return visitor.visitAccessKeyed(this);
  };

  AccessKeyed.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (obj instanceof Object) {
      this.key.connect(binding, scope);
      var key = this.key.evaluate(scope);

      if (key !== null && key !== undefined && !(Array.isArray(obj) && typeof key === 'number')) {
        binding.observeProperty(obj, key);
      }
    }
  };

  return AccessKeyed;
}(Expression);

var CallScope = function (_Expression9) {
  _inherits(CallScope, _Expression9);

  function CallScope(name, args, ancestor) {
    

    var _this11 = _possibleConstructorReturn(this, _Expression9.call(this));

    _this11.name = name;
    _this11.args = args;
    _this11.ancestor = ancestor;
    return _this11;
  }

  CallScope.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var args = evalList(scope, this.args, lookupFunctions);
    var context = getContextFor(this.name, scope, this.ancestor);
    var func = getFunction(context, this.name, mustEvaluate);
    if (func) {
      return func.apply(context, args);
    }
    return undefined;
  };

  CallScope.prototype.accept = function accept(visitor) {
    return visitor.visitCallScope(this);
  };

  CallScope.prototype.connect = function connect(binding, scope) {
    var args = this.args;
    var i = args.length;
    while (i--) {
      args[i].connect(binding, scope);
    }
  };

  return CallScope;
}(Expression);

var CallMember = function (_Expression10) {
  _inherits(CallMember, _Expression10);

  function CallMember(object, name, args) {
    

    var _this12 = _possibleConstructorReturn(this, _Expression10.call(this));

    _this12.object = object;
    _this12.name = name;
    _this12.args = args;
    return _this12;
  }

  CallMember.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var instance = this.object.evaluate(scope, lookupFunctions);
    var args = evalList(scope, this.args, lookupFunctions);
    var func = getFunction(instance, this.name, mustEvaluate);
    if (func) {
      return func.apply(instance, args);
    }
    return undefined;
  };

  CallMember.prototype.accept = function accept(visitor) {
    return visitor.visitCallMember(this);
  };

  CallMember.prototype.connect = function connect(binding, scope) {
    this.object.connect(binding, scope);
    var obj = this.object.evaluate(scope);
    if (getFunction(obj, this.name, false)) {
      var args = this.args;
      var i = args.length;
      while (i--) {
        args[i].connect(binding, scope);
      }
    }
  };

  return CallMember;
}(Expression);

var CallFunction = function (_Expression11) {
  _inherits(CallFunction, _Expression11);

  function CallFunction(func, args) {
    

    var _this13 = _possibleConstructorReturn(this, _Expression11.call(this));

    _this13.func = func;
    _this13.args = args;
    return _this13;
  }

  CallFunction.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var func = this.func.evaluate(scope, lookupFunctions);
    if (typeof func === 'function') {
      return func.apply(null, evalList(scope, this.args, lookupFunctions));
    }
    if (!mustEvaluate && (func === null || func === undefined)) {
      return undefined;
    }
    throw new Error(this.func + ' is not a function');
  };

  CallFunction.prototype.accept = function accept(visitor) {
    return visitor.visitCallFunction(this);
  };

  CallFunction.prototype.connect = function connect(binding, scope) {
    this.func.connect(binding, scope);
    var func = this.func.evaluate(scope);
    if (typeof func === 'function') {
      var args = this.args;
      var i = args.length;
      while (i--) {
        args[i].connect(binding, scope);
      }
    }
  };

  return CallFunction;
}(Expression);

var Binary = function (_Expression12) {
  _inherits(Binary, _Expression12);

  function Binary(operation, left, right) {
    

    var _this14 = _possibleConstructorReturn(this, _Expression12.call(this));

    _this14.operation = operation;
    _this14.left = left;
    _this14.right = right;
    return _this14;
  }

  Binary.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var left = this.left.evaluate(scope, lookupFunctions);

    switch (this.operation) {
      case '&&':
        return left && this.right.evaluate(scope, lookupFunctions);
      case '||':
        return left || this.right.evaluate(scope, lookupFunctions);
    }

    var right = this.right.evaluate(scope, lookupFunctions);

    switch (this.operation) {
      case '==':
        return left == right;
      case '===':
        return left === right;
      case '!=':
        return left != right;
      case '!==':
        return left !== right;
      case 'instanceof':
        return typeof right === 'function' && left instanceof right;
      case 'in':
        return (typeof right === 'undefined' ? 'undefined' : _typeof(right)) === 'object' && right !== null && left in right;
    }

    if (left === null || right === null || left === undefined || right === undefined) {
      switch (this.operation) {
        case '+':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return right;
          return 0;
        case '-':
          if (left !== null && left !== undefined) return left;
          if (right !== null && right !== undefined) return 0 - right;
          return 0;
      }

      return null;
    }

    switch (this.operation) {
      case '+':
        return autoConvertAdd(left, right);
      case '-':
        return left - right;
      case '*':
        return left * right;
      case '/':
        return left / right;
      case '%':
        return left % right;
      case '<':
        return left < right;
      case '>':
        return left > right;
      case '<=':
        return left <= right;
      case '>=':
        return left >= right;
      case '^':
        return left ^ right;
    }

    throw new Error('Internal error [' + this.operation + '] not handled');
  };

  Binary.prototype.accept = function accept(visitor) {
    return visitor.visitBinary(this);
  };

  Binary.prototype.connect = function connect(binding, scope) {
    this.left.connect(binding, scope);
    var left = this.left.evaluate(scope);
    if (this.operation === '&&' && !left || this.operation === '||' && left) {
      return;
    }
    this.right.connect(binding, scope);
  };

  return Binary;
}(Expression);

var Unary = function (_Expression13) {
  _inherits(Unary, _Expression13);

  function Unary(operation, expression) {
    

    var _this15 = _possibleConstructorReturn(this, _Expression13.call(this));

    _this15.operation = operation;
    _this15.expression = expression;
    return _this15;
  }

  Unary.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    switch (this.operation) {
      case '!':
        return !this.expression.evaluate(scope, lookupFunctions);
      case 'typeof':
        return _typeof(this.expression.evaluate(scope, lookupFunctions));
      case 'void':
        return void this.expression.evaluate(scope, lookupFunctions);
    }

    throw new Error('Internal error [' + this.operation + '] not handled');
  };

  Unary.prototype.accept = function accept(visitor) {
    return visitor.visitPrefix(this);
  };

  Unary.prototype.connect = function connect(binding, scope) {
    this.expression.connect(binding, scope);
  };

  return Unary;
}(Expression);

var LiteralPrimitive = function (_Expression14) {
  _inherits(LiteralPrimitive, _Expression14);

  function LiteralPrimitive(value) {
    

    var _this16 = _possibleConstructorReturn(this, _Expression14.call(this));

    _this16.value = value;
    return _this16;
  }

  LiteralPrimitive.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralPrimitive.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralPrimitive(this);
  };

  LiteralPrimitive.prototype.connect = function connect(binding, scope) {};

  return LiteralPrimitive;
}(Expression);

var LiteralString = function (_Expression15) {
  _inherits(LiteralString, _Expression15);

  function LiteralString(value) {
    

    var _this17 = _possibleConstructorReturn(this, _Expression15.call(this));

    _this17.value = value;
    return _this17;
  }

  LiteralString.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return this.value;
  };

  LiteralString.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralString(this);
  };

  LiteralString.prototype.connect = function connect(binding, scope) {};

  return LiteralString;
}(Expression);

var LiteralTemplate = function (_Expression16) {
  _inherits(LiteralTemplate, _Expression16);

  function LiteralTemplate(cooked, expressions, raw, tag) {
    

    var _this18 = _possibleConstructorReturn(this, _Expression16.call(this));

    _this18.cooked = cooked;
    _this18.expressions = expressions || [];
    _this18.length = _this18.expressions.length;
    _this18.tagged = tag !== undefined;
    if (_this18.tagged) {
      _this18.cooked.raw = raw;
      _this18.tag = tag;
      if (tag instanceof AccessScope) {
        _this18.contextType = 'Scope';
      } else if (tag instanceof AccessMember || tag instanceof AccessKeyed) {
        _this18.contextType = 'Object';
      } else {
        throw new Error(_this18.tag + ' is not a valid template tag');
      }
    }
    return _this18;
  }

  LiteralTemplate.prototype.getScopeContext = function getScopeContext(scope, lookupFunctions) {
    return getContextFor(this.tag.name, scope, this.tag.ancestor);
  };

  LiteralTemplate.prototype.getObjectContext = function getObjectContext(scope, lookupFunctions) {
    return this.tag.object.evaluate(scope, lookupFunctions);
  };

  LiteralTemplate.prototype.evaluate = function evaluate(scope, lookupFunctions, mustEvaluate) {
    var results = new Array(this.length);
    for (var i = 0; i < this.length; i++) {
      results[i] = this.expressions[i].evaluate(scope, lookupFunctions);
    }
    if (this.tagged) {
      var func = this.tag.evaluate(scope, lookupFunctions);
      if (typeof func === 'function') {
        var context = this['get' + this.contextType + 'Context'](scope, lookupFunctions);
        return func.call.apply(func, [context, this.cooked].concat(results));
      }
      if (!mustEvaluate) {
        return null;
      }
      throw new Error(this.tag + ' is not a function');
    }
    var result = this.cooked[0];
    for (var _i2 = 0; _i2 < this.length; _i2++) {
      result = String.prototype.concat(result, results[_i2], this.cooked[_i2 + 1]);
    }
    return result;
  };

  LiteralTemplate.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralTemplate(this);
  };

  LiteralTemplate.prototype.connect = function connect(binding, scope) {
    for (var i = 0; i < this.length; i++) {
      this.expressions[i].connect(binding, scope);
    }
    if (this.tagged) {
      this.tag.connect(binding, scope);
    }
  };

  return LiteralTemplate;
}(Expression);

var LiteralArray = function (_Expression17) {
  _inherits(LiteralArray, _Expression17);

  function LiteralArray(elements) {
    

    var _this19 = _possibleConstructorReturn(this, _Expression17.call(this));

    _this19.elements = elements;
    return _this19;
  }

  LiteralArray.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var elements = this.elements;
    var result = [];

    for (var i = 0, length = elements.length; i < length; ++i) {
      result[i] = elements[i].evaluate(scope, lookupFunctions);
    }

    return result;
  };

  LiteralArray.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralArray(this);
  };

  LiteralArray.prototype.connect = function connect(binding, scope) {
    var length = this.elements.length;
    for (var i = 0; i < length; i++) {
      this.elements[i].connect(binding, scope);
    }
  };

  return LiteralArray;
}(Expression);

var LiteralObject = function (_Expression18) {
  _inherits(LiteralObject, _Expression18);

  function LiteralObject(keys, values) {
    

    var _this20 = _possibleConstructorReturn(this, _Expression18.call(this));

    _this20.keys = keys;
    _this20.values = values;
    return _this20;
  }

  LiteralObject.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    var instance = {};
    var keys = this.keys;
    var values = this.values;

    for (var i = 0, length = keys.length; i < length; ++i) {
      instance[keys[i]] = values[i].evaluate(scope, lookupFunctions);
    }

    return instance;
  };

  LiteralObject.prototype.accept = function accept(visitor) {
    return visitor.visitLiteralObject(this);
  };

  LiteralObject.prototype.connect = function connect(binding, scope) {
    var length = this.keys.length;
    for (var i = 0; i < length; i++) {
      this.values[i].connect(binding, scope);
    }
  };

  return LiteralObject;
}(Expression);

function evalList(scope, list, lookupFunctions) {
  var length = list.length;
  var result = [];
  for (var i = 0; i < length; i++) {
    result[i] = list[i].evaluate(scope, lookupFunctions);
  }
  return result;
}

function autoConvertAdd(a, b) {
  if (a !== null && b !== null) {
    if (typeof a === 'string' && typeof b !== 'string') {
      return a + b.toString();
    }

    if (typeof a !== 'string' && typeof b === 'string') {
      return a.toString() + b;
    }

    return a + b;
  }

  if (a !== null) {
    return a;
  }

  if (b !== null) {
    return b;
  }

  return 0;
}

function getFunction(obj, name, mustExist) {
  var func = obj === null || obj === undefined ? null : obj[name];
  if (typeof func === 'function') {
    return func;
  }
  if (!mustExist && (func === null || func === undefined)) {
    return null;
  }
  throw new Error(name + ' is not a function');
}

function getKeyed(obj, key) {
  if (Array.isArray(obj)) {
    return obj[parseInt(key, 10)];
  } else if (obj) {
    return obj[key];
  } else if (obj === null || obj === undefined) {
    return undefined;
  }

  return obj[key];
}

function setKeyed(obj, key, value) {
  if (Array.isArray(obj)) {
    var index = parseInt(key, 10);

    if (obj.length <= index) {
      obj.length = index + 1;
    }

    obj[index] = value;
  } else {
    obj[key] = value;
  }

  return value;
}

var _Unparser = null;


if (typeof FEATURE_NO_UNPARSER === 'undefined') {
  _Unparser = function () {
    function Unparser(buffer) {
      

      this.buffer = buffer;
    }

    Unparser.unparse = function unparse(expression) {
      var buffer = [];
      var visitor = new _Unparser(buffer);

      expression.accept(visitor);

      return buffer.join('');
    };

    Unparser.prototype.write = function write(text) {
      this.buffer.push(text);
    };

    Unparser.prototype.writeArgs = function writeArgs(args) {
      this.write('(');

      for (var i = 0, length = args.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        args[i].accept(this);
      }

      this.write(')');
    };

    Unparser.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
      var args = behavior.args;

      behavior.expression.accept(this);
      this.write('&' + behavior.name);

      for (var i = 0, length = args.length; i < length; ++i) {
        this.write(':');
        args[i].accept(this);
      }
    };

    Unparser.prototype.visitValueConverter = function visitValueConverter(converter) {
      var args = converter.args;

      converter.expression.accept(this);
      this.write('|' + converter.name);

      for (var i = 0, length = args.length; i < length; ++i) {
        this.write(':');
        args[i].accept(this);
      }
    };

    Unparser.prototype.visitAssign = function visitAssign(assign) {
      assign.target.accept(this);
      this.write('=');
      assign.value.accept(this);
    };

    Unparser.prototype.visitConditional = function visitConditional(conditional) {
      conditional.condition.accept(this);
      this.write('?');
      conditional.yes.accept(this);
      this.write(':');
      conditional.no.accept(this);
    };

    Unparser.prototype.visitAccessThis = function visitAccessThis(access) {
      if (access.ancestor === 0) {
        this.write('$this');
        return;
      }
      this.write('$parent');
      var i = access.ancestor - 1;
      while (i--) {
        this.write('.$parent');
      }
    };

    Unparser.prototype.visitAccessScope = function visitAccessScope(access) {
      var i = access.ancestor;
      while (i--) {
        this.write('$parent.');
      }
      this.write(access.name);
    };

    Unparser.prototype.visitAccessMember = function visitAccessMember(access) {
      access.object.accept(this);
      this.write('.' + access.name);
    };

    Unparser.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
      access.object.accept(this);
      this.write('[');
      access.key.accept(this);
      this.write(']');
    };

    Unparser.prototype.visitCallScope = function visitCallScope(call) {
      var i = call.ancestor;
      while (i--) {
        this.write('$parent.');
      }
      this.write(call.name);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitCallFunction = function visitCallFunction(call) {
      call.func.accept(this);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitCallMember = function visitCallMember(call) {
      call.object.accept(this);
      this.write('.' + call.name);
      this.writeArgs(call.args);
    };

    Unparser.prototype.visitPrefix = function visitPrefix(prefix) {
      this.write('(' + prefix.operation);
      if (prefix.operation.charCodeAt(0) >= 97) {
        this.write(' ');
      }
      prefix.expression.accept(this);
      this.write(')');
    };

    Unparser.prototype.visitBinary = function visitBinary(binary) {
      binary.left.accept(this);
      if (binary.operation.charCodeAt(0) === 105) {
        this.write(' ' + binary.operation + ' ');
      } else {
        this.write(binary.operation);
      }
      binary.right.accept(this);
    };

    Unparser.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
      this.write('' + literal.value);
    };

    Unparser.prototype.visitLiteralArray = function visitLiteralArray(literal) {
      var elements = literal.elements;

      this.write('[');

      for (var i = 0, length = elements.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        elements[i].accept(this);
      }

      this.write(']');
    };

    Unparser.prototype.visitLiteralObject = function visitLiteralObject(literal) {
      var keys = literal.keys;
      var values = literal.values;

      this.write('{');

      for (var i = 0, length = keys.length; i < length; ++i) {
        if (i !== 0) {
          this.write(',');
        }

        this.write('\'' + keys[i] + '\':');
        values[i].accept(this);
      }

      this.write('}');
    };

    Unparser.prototype.visitLiteralString = function visitLiteralString(literal) {
      var escaped = literal.value.replace(/'/g, "\'");
      this.write('\'' + escaped + '\'');
    };

    Unparser.prototype.visitLiteralTemplate = function visitLiteralTemplate(literal) {
      var cooked = literal.cooked,
          expressions = literal.expressions;

      var length = expressions.length;
      this.write('`');
      this.write(cooked[0]);
      for (var i = 0; i < length; i++) {
        expressions[i].accept(this);
        this.write(cooked[i + 1]);
      }
      this.write('`');
    };

    return Unparser;
  }();
}

var ExpressionCloner = function () {
  function ExpressionCloner() {
    
  }

  ExpressionCloner.prototype.cloneExpressionArray = function cloneExpressionArray(array) {
    var clonedArray = [];
    var i = array.length;
    while (i--) {
      clonedArray[i] = array[i].accept(this);
    }
    return clonedArray;
  };

  ExpressionCloner.prototype.visitBindingBehavior = function visitBindingBehavior(behavior) {
    return new BindingBehavior(behavior.expression.accept(this), behavior.name, this.cloneExpressionArray(behavior.args));
  };

  ExpressionCloner.prototype.visitValueConverter = function visitValueConverter(converter) {
    return new ValueConverter(converter.expression.accept(this), converter.name, this.cloneExpressionArray(converter.args));
  };

  ExpressionCloner.prototype.visitAssign = function visitAssign(assign) {
    return new Assign(assign.target.accept(this), assign.value.accept(this));
  };

  ExpressionCloner.prototype.visitConditional = function visitConditional(conditional) {
    return new Conditional(conditional.condition.accept(this), conditional.yes.accept(this), conditional.no.accept(this));
  };

  ExpressionCloner.prototype.visitAccessThis = function visitAccessThis(access) {
    return new AccessThis(access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessScope = function visitAccessScope(access) {
    return new AccessScope(access.name, access.ancestor);
  };

  ExpressionCloner.prototype.visitAccessMember = function visitAccessMember(access) {
    return new AccessMember(access.object.accept(this), access.name);
  };

  ExpressionCloner.prototype.visitAccessKeyed = function visitAccessKeyed(access) {
    return new AccessKeyed(access.object.accept(this), access.key.accept(this));
  };

  ExpressionCloner.prototype.visitCallScope = function visitCallScope(call) {
    return new CallScope(call.name, this.cloneExpressionArray(call.args), call.ancestor);
  };

  ExpressionCloner.prototype.visitCallFunction = function visitCallFunction(call) {
    return new CallFunction(call.func.accept(this), this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitCallMember = function visitCallMember(call) {
    return new CallMember(call.object.accept(this), call.name, this.cloneExpressionArray(call.args));
  };

  ExpressionCloner.prototype.visitUnary = function visitUnary(unary) {
    return new Unary(prefix.operation, prefix.expression.accept(this));
  };

  ExpressionCloner.prototype.visitBinary = function visitBinary(binary) {
    return new Binary(binary.operation, binary.left.accept(this), binary.right.accept(this));
  };

  ExpressionCloner.prototype.visitLiteralPrimitive = function visitLiteralPrimitive(literal) {
    return new LiteralPrimitive(literal);
  };

  ExpressionCloner.prototype.visitLiteralArray = function visitLiteralArray(literal) {
    return new LiteralArray(this.cloneExpressionArray(literal.elements));
  };

  ExpressionCloner.prototype.visitLiteralObject = function visitLiteralObject(literal) {
    return new LiteralObject(literal.keys, this.cloneExpressionArray(literal.values));
  };

  ExpressionCloner.prototype.visitLiteralString = function visitLiteralString(literal) {
    return new LiteralString(literal.value);
  };

  ExpressionCloner.prototype.visitLiteralTemplate = function visitLiteralTemplate(literal) {
    return new LiteralTemplate(literal.cooked, this.cloneExpressionArray(literal.expressions), literal.raw, literal.tag && literal.tag.accept(this));
  };

  return ExpressionCloner;
}();

function cloneExpression(expression) {
  var visitor = new ExpressionCloner();
  return expression.accept(visitor);
}

var bindingMode = {
  oneTime: 0,
  toView: 1,
  oneWay: 1,
  twoWay: 2,
  fromView: 3
};

var Parser = function () {
  function Parser() {
    

    this.cache = Object.create(null);
  }

  Parser.prototype.parse = function parse(src) {
    src = src || '';

    return this.cache[src] || (this.cache[src] = new ParserImplementation(src).parseBindingBehavior());
  };

  return Parser;
}();

var fromCharCode = String.fromCharCode;

var ParserImplementation = function () {
  _createClass(ParserImplementation, [{
    key: 'raw',
    get: function get() {
      return this.src.slice(this.start, this.idx);
    }
  }]);

  function ParserImplementation(src) {
    

    this.idx = 0;

    this.start = 0;

    this.src = src;
    this.len = src.length;

    this.tkn = T$EOF;

    this.val = undefined;

    this.ch = src.charCodeAt(0);
  }

  ParserImplementation.prototype.parseBindingBehavior = function parseBindingBehavior() {
    this.nextToken();
    if (this.tkn & T$ExpressionTerminal) {
      this.err('Invalid start of expression');
    }
    var result = this.parseValueConverter();
    while (this.opt(T$Ampersand)) {
      result = new BindingBehavior(result, this.val, this.parseVariadicArgs());
    }
    if (this.tkn !== T$EOF) {
      this.err('Unconsumed token ' + this.raw);
    }
    return result;
  };

  ParserImplementation.prototype.parseValueConverter = function parseValueConverter() {
    var result = this.parseExpression();
    while (this.opt(T$Bar)) {
      result = new ValueConverter(result, this.val, this.parseVariadicArgs());
    }
    return result;
  };

  ParserImplementation.prototype.parseVariadicArgs = function parseVariadicArgs() {
    this.nextToken();
    var result = [];
    while (this.opt(T$Colon)) {
      result.push(this.parseExpression());
    }
    return result;
  };

  ParserImplementation.prototype.parseExpression = function parseExpression() {
    var exprStart = this.idx;
    var result = this.parseConditional();

    while (this.tkn === T$Eq) {
      if (!result.isAssignable) {
        this.err('Expression ' + this.src.slice(exprStart, this.start) + ' is not assignable');
      }
      this.nextToken();
      exprStart = this.idx;
      result = new Assign(result, this.parseConditional());
    }
    return result;
  };

  ParserImplementation.prototype.parseConditional = function parseConditional() {
    var result = this.parseBinary(0);

    if (this.opt(T$Question)) {
      var yes = this.parseExpression();
      this.expect(T$Colon);
      result = new Conditional(result, yes, this.parseExpression());
    }
    return result;
  };

  ParserImplementation.prototype.parseBinary = function parseBinary(minPrecedence) {
    var left = this.parseLeftHandSide(0);

    while (this.tkn & T$BinaryOp) {
      var opToken = this.tkn;
      if ((opToken & T$Precedence) <= minPrecedence) {
        break;
      }
      this.nextToken();
      left = new Binary(TokenValues[opToken & T$TokenMask], left, this.parseBinary(opToken & T$Precedence));
    }
    return left;
  };

  ParserImplementation.prototype.parseLeftHandSide = function parseLeftHandSide(context) {
    var result = void 0;

    primary: switch (this.tkn) {
      case T$Plus:
        this.nextToken();
        return this.parseLeftHandSide(0);
      case T$Minus:
        this.nextToken();
        return new Binary('-', new LiteralPrimitive(0), this.parseLeftHandSide(0));
      case T$Bang:
      case T$TypeofKeyword:
      case T$VoidKeyword:
        var op = TokenValues[this.tkn & T$TokenMask];
        this.nextToken();
        return new Unary(op, this.parseLeftHandSide(0));
      case T$ParentScope:
        {
          do {
            this.nextToken();
            context++;
            if (this.opt(T$Period)) {
              if (this.tkn === T$Period) {
                this.err();
              }
              continue;
            } else if (this.tkn & T$AccessScopeTerminal) {
              result = new AccessThis(context & C$Ancestor);

              context = context & C$ShorthandProp | C$This;
              break primary;
            } else {
              this.err();
            }
          } while (this.tkn === T$ParentScope);
        }

      case T$Identifier:
        {
          result = new AccessScope(this.val, context & C$Ancestor);
          this.nextToken();
          context = context & C$ShorthandProp | C$Scope;
          break;
        }
      case T$ThisScope:
        this.nextToken();
        result = new AccessThis(0);
        context = context & C$ShorthandProp | C$This;
        break;
      case T$LParen:
        this.nextToken();
        result = this.parseExpression();
        this.expect(T$RParen);
        context = C$Primary;
        break;
      case T$LBracket:
        {
          this.nextToken();
          var _elements = [];
          if (this.tkn !== T$RBracket) {
            do {
              _elements.push(this.parseExpression());
            } while (this.opt(T$Comma));
          }
          this.expect(T$RBracket);
          result = new LiteralArray(_elements);
          context = C$Primary;
          break;
        }
      case T$LBrace:
        {
          var keys = [];
          var values = [];
          this.nextToken();
          while (this.tkn !== T$RBrace) {
            if (this.tkn & T$IdentifierOrKeyword) {
              var ch = this.ch,
                  tkn = this.tkn,
                  idx = this.idx;

              keys.push(this.val);
              this.nextToken();
              if (this.opt(T$Colon)) {
                values.push(this.parseExpression());
              } else {
                this.ch = ch;
                this.tkn = tkn;
                this.idx = idx;
                values.push(this.parseLeftHandSide(C$ShorthandProp));
              }
            } else if (this.tkn & T$Literal) {
              keys.push(this.val);
              this.nextToken();
              this.expect(T$Colon);
              values.push(this.parseExpression());
            } else {
              this.err();
            }
            if (this.tkn !== T$RBrace) {
              this.expect(T$Comma);
            }
          }
          this.expect(T$RBrace);
          result = new LiteralObject(keys, values);
          context = C$Primary;
          break;
        }
      case T$StringLiteral:
        result = new LiteralString(this.val);
        this.nextToken();
        context = C$Primary;
        break;
      case T$TemplateTail:
        result = new LiteralTemplate([this.val]);
        this.nextToken();
        context = C$Primary;
        break;
      case T$TemplateContinuation:
        result = this.parseTemplate(0);
        context = C$Primary;
        break;
      case T$NumericLiteral:
        {
          result = new LiteralPrimitive(this.val);
          this.nextToken();

          break;
        }
      case T$NullKeyword:
      case T$UndefinedKeyword:
      case T$TrueKeyword:
      case T$FalseKeyword:
        result = new LiteralPrimitive(TokenValues[this.tkn & T$TokenMask]);
        this.nextToken();
        context = C$Primary;
        break;
      default:
        if (this.idx >= this.len) {
          this.err('Unexpected end of expression');
        } else {
          this.err();
        }
    }

    if (context & C$ShorthandProp) {
      return result;
    }

    var name = this.val;
    while (this.tkn & T$MemberOrCallExpression) {
      switch (this.tkn) {
        case T$Period:
          this.nextToken();
          if (!(this.tkn & T$IdentifierOrKeyword)) {
            this.err();
          }
          name = this.val;
          this.nextToken();

          context = context & C$Primary | (context & (C$This | C$Scope)) << 1 | context & C$Member | (context & C$Keyed) >> 1 | (context & C$Call) >> 2;
          if (this.tkn === T$LParen) {
            continue;
          }
          if (context & C$Scope) {
            result = new AccessScope(name, result.ancestor);
          } else {
            result = new AccessMember(result, name);
          }
          continue;
        case T$LBracket:
          this.nextToken();
          context = C$Keyed;
          result = new AccessKeyed(result, this.parseExpression());
          this.expect(T$RBracket);
          break;
        case T$LParen:
          this.nextToken();
          var args = [];
          while (this.tkn !== T$RParen) {
            args.push(this.parseExpression());
            if (!this.opt(T$Comma)) {
              break;
            }
          }
          this.expect(T$RParen);
          if (context & C$Scope) {
            result = new CallScope(name, args, result.ancestor);
          } else if (context & (C$Member | C$Primary)) {
            result = new CallMember(result, name, args);
          } else {
            result = new CallFunction(result, args);
          }
          context = C$Call;
          break;
        case T$TemplateTail:
          result = new LiteralTemplate([this.val], [], [this.raw], result);
          this.nextToken();
          break;
        case T$TemplateContinuation:
          result = this.parseTemplate(context | C$Tagged, result);
      }
    }

    return result;
  };

  ParserImplementation.prototype.parseTemplate = function parseTemplate(context, func) {
    var cooked = [this.val];
    var raw = context & C$Tagged ? [this.raw] : undefined;
    this.expect(T$TemplateContinuation);
    var expressions = [this.parseExpression()];

    while ((this.tkn = this.scanTemplateTail()) !== T$TemplateTail) {
      cooked.push(this.val);
      if (context & C$Tagged) {
        raw.push(this.raw);
      }
      this.expect(T$TemplateContinuation);
      expressions.push(this.parseExpression());
    }

    cooked.push(this.val);
    if (context & C$Tagged) {
      raw.push(this.raw);
    }
    this.nextToken();
    return new LiteralTemplate(cooked, expressions, raw, func);
  };

  ParserImplementation.prototype.nextToken = function nextToken() {
    while (this.idx < this.len) {
      if (this.ch <= 0x20) {
        this.next();
        continue;
      }
      this.start = this.idx;
      if (this.ch === 0x24 || this.ch >= 0x61 && this.ch <= 0x7A) {
        this.tkn = this.scanIdentifier();
        return;
      }

      if ((this.tkn = CharScanners[this.ch](this)) !== null) {
        return;
      }
    }
    this.tkn = T$EOF;
  };

  ParserImplementation.prototype.next = function next() {
    return this.ch = this.src.charCodeAt(++this.idx);
  };

  ParserImplementation.prototype.scanIdentifier = function scanIdentifier() {
    while (AsciiIdParts.has(this.next()) || this.ch > 0x7F && IdParts[this.ch]) {}

    return KeywordLookup[this.val = this.raw] || T$Identifier;
  };

  ParserImplementation.prototype.scanNumber = function scanNumber(isFloat) {
    if (isFloat) {
      this.val = 0;
    } else {
      this.val = this.ch - 0x30;
      while (this.next() <= 0x39 && this.ch >= 0x30) {
        this.val = this.val * 10 + this.ch - 0x30;
      }
    }

    if (isFloat || this.ch === 0x2E) {
      if (!isFloat) {
        this.next();
      }
      var start = this.idx;
      var value = this.ch - 0x30;
      while (this.next() <= 0x39 && this.ch >= 0x30) {
        value = value * 10 + this.ch - 0x30;
      }
      this.val = this.val + value / Math.pow(10, this.idx - start);
    }

    if (this.ch === 0x65 || this.ch === 0x45) {
      var _start = this.idx;

      this.next();
      if (this.ch === 0x2D || this.ch === 0x2B) {
        this.next();
      }

      if (!(this.ch >= 0x30 && this.ch <= 0x39)) {
        this.idx = _start;
        this.err('Invalid exponent');
      }
      while (this.next() <= 0x39 && this.ch >= 0x30) {}
      this.val = parseFloat(this.src.slice(this.start, this.idx));
    }

    return T$NumericLiteral;
  };

  ParserImplementation.prototype.scanString = function scanString() {
    var quote = this.ch;
    this.next();

    var buffer = void 0;
    var marker = this.idx;

    while (this.ch !== quote) {
      if (this.ch === 0x5C) {
        if (!buffer) {
          buffer = [];
        }

        buffer.push(this.src.slice(marker, this.idx));

        this.next();

        var _unescaped = void 0;

        if (this.ch === 0x75) {
          this.next();

          if (this.idx + 4 < this.len) {
            var hex = this.src.slice(this.idx, this.idx + 4);

            if (!/[A-Z0-9]{4}/i.test(hex)) {
              this.err('Invalid unicode escape [\\u' + hex + ']');
            }

            _unescaped = parseInt(hex, 16);
            this.idx += 4;
            this.ch = this.src.charCodeAt(this.idx);
          } else {
            this.err();
          }
        } else {
          _unescaped = unescape(this.ch);
          this.next();
        }

        buffer.push(fromCharCode(_unescaped));
        marker = this.idx;
      } else if (this.ch === 0 || this.idx >= this.len) {
        this.err('Unterminated quote');
      } else {
        this.next();
      }
    }

    var last = this.src.slice(marker, this.idx);
    this.next();
    var unescaped = last;

    if (buffer !== null && buffer !== undefined) {
      buffer.push(last);
      unescaped = buffer.join('');
    }

    this.val = unescaped;
    return T$StringLiteral;
  };

  ParserImplementation.prototype.scanTemplate = function scanTemplate() {
    var tail = true;
    var result = '';

    while (this.next() !== 0x60) {
      if (this.ch === 0x24) {
        if (this.idx + 1 < this.len && this.src.charCodeAt(this.idx + 1) === 0x7B) {
          this.idx++;
          tail = false;
          break;
        } else {
          result += '$';
        }
      } else if (this.ch === 0x5C) {
        result += fromCharCode(unescape(this.next()));
      } else if (this.ch === 0 || this.idx >= this.len) {
        this.err('Unterminated template literal');
      } else {
        result += fromCharCode(this.ch);
      }
    }

    this.next();
    this.val = result;
    if (tail) {
      return T$TemplateTail;
    }
    return T$TemplateContinuation;
  };

  ParserImplementation.prototype.scanTemplateTail = function scanTemplateTail() {
    if (this.idx >= this.len) {
      this.err('Unterminated template');
    }
    this.idx--;
    return this.scanTemplate();
  };

  ParserImplementation.prototype.err = function err() {
    var message = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'Unexpected token ' + this.raw;
    var column = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : this.start;

    throw new Error('Parser Error: ' + message + ' at column ' + column + ' in expression [' + this.src + ']');
  };

  ParserImplementation.prototype.opt = function opt(token) {
    if (this.tkn === token) {
      this.nextToken();
      return true;
    }

    return false;
  };

  ParserImplementation.prototype.expect = function expect(token) {
    if (this.tkn === token) {
      this.nextToken();
    } else {
      this.err('Missing expected token ' + TokenValues[token & T$TokenMask], this.idx);
    }
  };

  return ParserImplementation;
}();

function unescape(code) {
  switch (code) {
    case 0x66:
      return 0xC;
    case 0x6E:
      return 0xA;
    case 0x72:
      return 0xD;
    case 0x74:
      return 0x9;
    case 0x76:
      return 0xB;
    default:
      return code;
  }
}

var C$This = 1 << 10;
var C$Scope = 1 << 11;
var C$Member = 1 << 12;
var C$Keyed = 1 << 13;
var C$Call = 1 << 14;
var C$Primary = 1 << 15;
var C$ShorthandProp = 1 << 16;
var C$Tagged = 1 << 17;

var C$Ancestor = (1 << 9) - 1;

var T$TokenMask = (1 << 6) - 1;

var T$PrecShift = 6;

var T$Precedence = 7 << T$PrecShift;

var T$ExpressionTerminal = 1 << 11;

var T$ClosingToken = 1 << 12;

var T$OpeningToken = 1 << 13;

var T$AccessScopeTerminal = 1 << 14;
var T$Keyword = 1 << 15;
var T$EOF = 1 << 16 | T$AccessScopeTerminal | T$ExpressionTerminal;
var T$Identifier = 1 << 17;
var T$IdentifierOrKeyword = T$Identifier | T$Keyword;
var T$Literal = 1 << 18;
var T$NumericLiteral = 1 << 19 | T$Literal;
var T$StringLiteral = 1 << 20 | T$Literal;
var T$BinaryOp = 1 << 21;

var T$UnaryOp = 1 << 22;

var T$MemberExpression = 1 << 23;

var T$MemberOrCallExpression = 1 << 24;
var T$TemplateTail = 1 << 25 | T$MemberOrCallExpression;
var T$TemplateContinuation = 1 << 26 | T$MemberOrCallExpression;

var T$FalseKeyword = 0 | T$Keyword | T$Literal;
var T$TrueKeyword = 1 | T$Keyword | T$Literal;
var T$NullKeyword = 2 | T$Keyword | T$Literal;
var T$UndefinedKeyword = 3 | T$Keyword | T$Literal;
var T$ThisScope = 4 | T$IdentifierOrKeyword;
var T$ParentScope = 5 | T$IdentifierOrKeyword;

var T$LParen = 6 | T$OpeningToken | T$AccessScopeTerminal | T$MemberOrCallExpression;
var T$LBrace = 7 | T$OpeningToken;
var T$Period = 8 | T$MemberExpression | T$MemberOrCallExpression;
var T$RBrace = 9 | T$AccessScopeTerminal | T$ClosingToken | T$ExpressionTerminal;
var T$RParen = 10 | T$AccessScopeTerminal | T$ClosingToken | T$ExpressionTerminal;
var T$Comma = 11 | T$AccessScopeTerminal;
var T$LBracket = 12 | T$OpeningToken | T$AccessScopeTerminal | T$MemberExpression | T$MemberOrCallExpression;
var T$RBracket = 13 | T$ClosingToken | T$ExpressionTerminal;
var T$Colon = 14 | T$AccessScopeTerminal;
var T$Question = 15;

var T$Ampersand = 18 | T$AccessScopeTerminal;
var T$Bar = 19 | T$AccessScopeTerminal;
var T$BarBar = 20 | 1 << T$PrecShift | T$BinaryOp;
var T$AmpersandAmpersand = 21 | 2 << T$PrecShift | T$BinaryOp;
var T$Caret = 22 | 3 << T$PrecShift | T$BinaryOp;
var T$EqEq = 23 | 4 << T$PrecShift | T$BinaryOp;
var T$BangEq = 24 | 4 << T$PrecShift | T$BinaryOp;
var T$EqEqEq = 25 | 4 << T$PrecShift | T$BinaryOp;
var T$BangEqEq = 26 | 4 << T$PrecShift | T$BinaryOp;
var T$Lt = 27 | 5 << T$PrecShift | T$BinaryOp;
var T$Gt = 28 | 5 << T$PrecShift | T$BinaryOp;
var T$LtEq = 29 | 5 << T$PrecShift | T$BinaryOp;
var T$GtEq = 30 | 5 << T$PrecShift | T$BinaryOp;
var T$InKeyword = 31 | 5 << T$PrecShift | T$BinaryOp | T$Keyword;
var T$InstanceOfKeyword = 32 | 5 << T$PrecShift | T$BinaryOp | T$Keyword;
var T$Plus = 33 | 6 << T$PrecShift | T$BinaryOp | T$UnaryOp;
var T$Minus = 34 | 6 << T$PrecShift | T$BinaryOp | T$UnaryOp;
var T$TypeofKeyword = 35 | T$UnaryOp | T$Keyword;
var T$VoidKeyword = 36 | T$UnaryOp | T$Keyword;
var T$Star = 37 | 7 << T$PrecShift | T$BinaryOp;
var T$Percent = 38 | 7 << T$PrecShift | T$BinaryOp;
var T$Slash = 39 | 7 << T$PrecShift | T$BinaryOp;
var T$Eq = 40;
var T$Bang = 41 | T$UnaryOp;

var KeywordLookup = Object.create(null);
KeywordLookup.true = T$TrueKeyword;
KeywordLookup.null = T$NullKeyword;
KeywordLookup.false = T$FalseKeyword;
KeywordLookup.undefined = T$UndefinedKeyword;
KeywordLookup.$this = T$ThisScope;
KeywordLookup.$parent = T$ParentScope;
KeywordLookup.in = T$InKeyword;
KeywordLookup.instanceof = T$InstanceOfKeyword;
KeywordLookup.typeof = T$TypeofKeyword;
KeywordLookup.void = T$VoidKeyword;

var TokenValues = [false, true, null, undefined, '$this', '$parent', '(', '{', '.', '}', ')', ',', '[', ']', ':', '?', '\'', '"', '&', '|', '||', '&&', '^', '==', '!=', '===', '!==', '<', '>', '<=', '>=', 'in', 'instanceof', '+', '-', 'typeof', 'void', '*', '%', '/', '=', '!'];

var codes = {
  AsciiIdPart: [0x24, 0, 0x30, 0x3A, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B],
  IdStart: [0x24, 0, 0x41, 0x5B, 0x5F, 0, 0x61, 0x7B, 0xAA, 0, 0xBA, 0, 0xC0, 0xD7, 0xD8, 0xF7, 0xF8, 0x2B9, 0x2E0, 0x2E5, 0x1D00, 0x1D26, 0x1D2C, 0x1D5D, 0x1D62, 0x1D66, 0x1D6B, 0x1D78, 0x1D79, 0x1DBF, 0x1E00, 0x1F00, 0x2071, 0, 0x207F, 0, 0x2090, 0x209D, 0x212A, 0x212C, 0x2132, 0, 0x214E, 0, 0x2160, 0x2189, 0x2C60, 0x2C80, 0xA722, 0xA788, 0xA78B, 0xA7AF, 0xA7B0, 0xA7B8, 0xA7F7, 0xA800, 0xAB30, 0xAB5B, 0xAB5C, 0xAB65, 0xFB00, 0xFB07, 0xFF21, 0xFF3B, 0xFF41, 0xFF5B],
  Digit: [0x30, 0x3A],
  Skip: [0, 0x21, 0x7F, 0xA1]
};

function decompress(lookup, set, compressed, value) {
  var rangeCount = compressed.length;
  for (var i = 0; i < rangeCount; i += 2) {
    var start = compressed[i];
    var end = compressed[i + 1];
    end = end > 0 ? end : start + 1;
    if (lookup) {
      var j = start;
      while (j < end) {
        lookup[j] = value;
        j++;
      }
    }
    if (set) {
      for (var ch = start; ch < end; ch++) {
        set.add(ch);
      }
    }
  }
}

function returnToken(token) {
  return function (p) {
    p.next();
    return token;
  };
}
function unexpectedCharacter(p) {
  p.err('Unexpected character [' + fromCharCode(p.ch) + ']');
  return null;
}

var AsciiIdParts = new Set();
decompress(null, AsciiIdParts, codes.AsciiIdPart, true);

var IdParts = new Uint8Array(0xFFFF);
decompress(IdParts, null, codes.IdStart, 1);
decompress(IdParts, null, codes.Digit, 1);

var CharScanners = new Array(0xFFFF);
var ci = 0;
while (ci < 0xFFFF) {
  CharScanners[ci] = unexpectedCharacter;
  ci++;
}

decompress(CharScanners, null, codes.Skip, function (p) {
  p.next();
  return null;
});
decompress(CharScanners, null, codes.IdStart, function (p) {
  return p.scanIdentifier();
});
decompress(CharScanners, null, codes.Digit, function (p) {
  return p.scanNumber(false);
});

CharScanners[0x22] = CharScanners[0x27] = function (p) {
  return p.scanString();
};
CharScanners[0x60] = function (p) {
  return p.scanTemplate();
};

CharScanners[0x21] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Bang;
  }
  if (p.next() !== 0x3D) {
    return T$BangEq;
  }
  p.next();
  return T$BangEqEq;
};

CharScanners[0x3D] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Eq;
  }
  if (p.next() !== 0x3D) {
    return T$EqEq;
  }
  p.next();
  return T$EqEqEq;
};

CharScanners[0x26] = function (p) {
  if (p.next() !== 0x26) {
    return T$Ampersand;
  }
  p.next();
  return T$AmpersandAmpersand;
};

CharScanners[0x7C] = function (p) {
  if (p.next() !== 0x7C) {
    return T$Bar;
  }
  p.next();
  return T$BarBar;
};

CharScanners[0x2E] = function (p) {
  if (p.next() <= 0x39 && p.ch >= 0x30) {
    return p.scanNumber(true);
  }
  return T$Period;
};

CharScanners[0x3C] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Lt;
  }
  p.next();
  return T$LtEq;
};

CharScanners[0x3E] = function (p) {
  if (p.next() !== 0x3D) {
    return T$Gt;
  }
  p.next();
  return T$GtEq;
};

CharScanners[0x25] = returnToken(T$Percent);
CharScanners[0x28] = returnToken(T$LParen);
CharScanners[0x29] = returnToken(T$RParen);
CharScanners[0x2A] = returnToken(T$Star);
CharScanners[0x2B] = returnToken(T$Plus);
CharScanners[0x2C] = returnToken(T$Comma);
CharScanners[0x2D] = returnToken(T$Minus);
CharScanners[0x2F] = returnToken(T$Slash);
CharScanners[0x3A] = returnToken(T$Colon);
CharScanners[0x3F] = returnToken(T$Question);
CharScanners[0x5B] = returnToken(T$LBracket);
CharScanners[0x5D] = returnToken(T$RBracket);
CharScanners[0x5E] = returnToken(T$Caret);
CharScanners[0x7B] = returnToken(T$LBrace);
CharScanners[0x7D] = returnToken(T$RBrace);

var mapProto = Map.prototype;

function _getMapObserver(taskQueue, map) {
  return ModifyMapObserver.for(taskQueue, map);
}

var ModifyMapObserver = function (_ModifyCollectionObse2) {
  _inherits(ModifyMapObserver, _ModifyCollectionObse2);

  function ModifyMapObserver(taskQueue, map) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse2.call(this, taskQueue, map));
  }

  ModifyMapObserver.for = function _for(taskQueue, map) {
    if (!('__map_observer__' in map)) {
      Reflect.defineProperty(map, '__map_observer__', {
        value: ModifyMapObserver.create(taskQueue, map),
        enumerable: false, configurable: false
      });
    }
    return map.__map_observer__;
  };

  ModifyMapObserver.create = function create(taskQueue, map) {
    var observer = new ModifyMapObserver(taskQueue, map);

    var proto = mapProto;
    if (proto.set !== map.set || proto.delete !== map.delete || proto.clear !== map.clear) {
      proto = {
        set: map.set,
        delete: map.delete,
        clear: map.clear
      };
    }

    map.set = function () {
      var hasValue = map.has(arguments[0]);
      var type = hasValue ? 'update' : 'add';
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.set.apply(map, arguments);
      if (!hasValue || oldValue !== map.get(arguments[0])) {
        observer.addChangeRecord({
          type: type,
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.delete = function () {
      var hasValue = map.has(arguments[0]);
      var oldValue = map.get(arguments[0]);
      var methodCallResult = proto.delete.apply(map, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: map,
          key: arguments[0],
          oldValue: oldValue
        });
      }
      return methodCallResult;
    };

    map.clear = function () {
      var methodCallResult = proto.clear.apply(map, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: map
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifyMapObserver;
}(ModifyCollectionObserver);

var emLogger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('event-manager');

function findOriginalEventTarget(event) {
  return event.composedPath && event.composedPath()[0] || event.deepPath && event.deepPath()[0] || event.path && event.path[0] || event.target;
}

function stopPropagation() {
  this.standardStopPropagation();
  this.propagationStopped = true;
}

function handleCapturedEvent(event) {
  event.propagationStopped = false;
  var target = findOriginalEventTarget(event);

  var orderedCallbacks = [];

  while (target) {
    if (target.capturedCallbacks) {
      var callback = target.capturedCallbacks[event.type];
      if (callback) {
        if (event.stopPropagation !== stopPropagation) {
          event.standardStopPropagation = event.stopPropagation;
          event.stopPropagation = stopPropagation;
        }
        orderedCallbacks.push(callback);
      }
    }
    target = target.parentNode;
  }
  for (var i = orderedCallbacks.length - 1; i >= 0 && !event.propagationStopped; i--) {
    var orderedCallback = orderedCallbacks[i];
    if ('handleEvent' in orderedCallback) {
      orderedCallback.handleEvent(event);
    } else {
      orderedCallback(event);
    }
  }
}

var CapturedHandlerEntry = function () {
  function CapturedHandlerEntry(eventName) {
    

    this.eventName = eventName;
    this.count = 0;
  }

  CapturedHandlerEntry.prototype.increment = function increment() {
    this.count++;

    if (this.count === 1) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener(this.eventName, handleCapturedEvent, true);
    }
  };

  CapturedHandlerEntry.prototype.decrement = function decrement() {
    if (this.count === 0) {
      emLogger.warn('The same EventListener was disposed multiple times.');
    } else if (--this.count === 0) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener(this.eventName, handleCapturedEvent, true);
    }
  };

  return CapturedHandlerEntry;
}();

var DelegateHandlerEntry = function () {
  function DelegateHandlerEntry(eventName, eventManager) {
    

    this.eventName = eventName;
    this.count = 0;
    this.eventManager = eventManager;
  }

  DelegateHandlerEntry.prototype.handleEvent = function handleEvent(event) {
    event.propagationStopped = false;
    var target = findOriginalEventTarget(event);

    while (target && !event.propagationStopped) {
      if (target.delegatedCallbacks) {
        var callback = target.delegatedCallbacks[event.type];
        if (callback) {
          if (event.stopPropagation !== stopPropagation) {
            event.standardStopPropagation = event.stopPropagation;
            event.stopPropagation = stopPropagation;
          }
          if ('handleEvent' in callback) {
            callback.handleEvent(event);
          } else {
            callback(event);
          }
        }
      }

      var parent = target.parentNode;
      var shouldEscapeShadowRoot = this.eventManager.escapeShadowRoot && parent instanceof ShadowRoot;

      target = shouldEscapeShadowRoot ? parent.host : parent;
    }
  };

  DelegateHandlerEntry.prototype.increment = function increment() {
    this.count++;

    if (this.count === 1) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener(this.eventName, this, false);
    }
  };

  DelegateHandlerEntry.prototype.decrement = function decrement() {
    if (this.count === 0) {
      emLogger.warn('The same EventListener was disposed multiple times.');
    } else if (--this.count === 0) {
      __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener(this.eventName, this, false);
    }
  };

  return DelegateHandlerEntry;
}();

var DelegationEntryHandler = function () {
  function DelegationEntryHandler(entry, lookup, targetEvent) {
    

    this.entry = entry;
    this.lookup = lookup;
    this.targetEvent = targetEvent;
  }

  DelegationEntryHandler.prototype.dispose = function dispose() {
    if (this.lookup[this.targetEvent]) {
      this.entry.decrement();
      this.lookup[this.targetEvent] = null;
    } else {
      emLogger.warn('Calling .dispose() on already disposed eventListener');
    }
  };

  return DelegationEntryHandler;
}();

var EventHandler = function () {
  function EventHandler(target, targetEvent, callback) {
    

    this.target = target;
    this.targetEvent = targetEvent;
    this.callback = callback;
  }

  EventHandler.prototype.dispose = function dispose() {
    this.target.removeEventListener(this.targetEvent, this.callback);
  };

  return EventHandler;
}();

var DefaultEventStrategy = function () {
  function DefaultEventStrategy(eventManager) {
    

    this.delegatedHandlers = {};
    this.capturedHandlers = {};

    this.eventManager = eventManager;
  }

  DefaultEventStrategy.prototype.subscribe = function subscribe(target, targetEvent, callback, strategy, disposable) {
    var delegatedHandlers = void 0;
    var capturedHandlers = void 0;
    var handlerEntry = void 0;

    if (strategy === delegationStrategy.bubbling) {
      delegatedHandlers = this.delegatedHandlers;
      handlerEntry = delegatedHandlers[targetEvent] || (delegatedHandlers[targetEvent] = new DelegateHandlerEntry(targetEvent, this.eventManager));
      var delegatedCallbacks = target.delegatedCallbacks || (target.delegatedCallbacks = {});
      if (!delegatedCallbacks[targetEvent]) {
        handlerEntry.increment();
      } else {
        emLogger.warn('Overriding previous callback for event listener', { event: targetEvent, callback: callback, previousCallback: delegatedCallbacks[targetEvent] });
      }
      delegatedCallbacks[targetEvent] = callback;

      if (disposable === true) {
        return new DelegationEntryHandler(handlerEntry, delegatedCallbacks, targetEvent);
      }

      return function () {
        handlerEntry.decrement();
        delegatedCallbacks[targetEvent] = null;
      };
    }
    if (strategy === delegationStrategy.capturing) {
      capturedHandlers = this.capturedHandlers;
      handlerEntry = capturedHandlers[targetEvent] || (capturedHandlers[targetEvent] = new CapturedHandlerEntry(targetEvent));
      var capturedCallbacks = target.capturedCallbacks || (target.capturedCallbacks = {});
      if (!capturedCallbacks[targetEvent]) {
        handlerEntry.increment();
      } else {
        emLogger.error('already have a callback for event', { event: targetEvent, callback: callback });
      }
      capturedCallbacks[targetEvent] = callback;

      if (disposable === true) {
        return new DelegationEntryHandler(handlerEntry, capturedCallbacks, targetEvent);
      }

      return function () {
        handlerEntry.decrement();
        capturedCallbacks[targetEvent] = null;
      };
    }

    target.addEventListener(targetEvent, callback);

    if (disposable === true) {
      return new EventHandler(target, targetEvent, callback);
    }

    return function () {
      target.removeEventListener(targetEvent, callback);
    };
  };

  return DefaultEventStrategy;
}();

var delegationStrategy = {
  none: 0,
  capturing: 1,
  bubbling: 2
};

var EventManager = function () {
  function EventManager() {
    var escapeShadowRoot = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : false;

    

    this.elementHandlerLookup = {};
    this.eventStrategyLookup = {};
    this.escapeShadowRoot = escapeShadowRoot;

    this.registerElementConfig({
      tagName: 'input',
      properties: {
        value: ['change', 'input'],
        checked: ['change', 'input'],
        files: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'textarea',
      properties: {
        value: ['change', 'input']
      }
    });

    this.registerElementConfig({
      tagName: 'select',
      properties: {
        value: ['change']
      }
    });

    this.registerElementConfig({
      tagName: 'content editable',
      properties: {
        value: ['change', 'input', 'blur', 'keyup', 'paste']
      }
    });

    this.registerElementConfig({
      tagName: 'scrollable element',
      properties: {
        scrollTop: ['scroll'],
        scrollLeft: ['scroll']
      }
    });

    this.defaultEventStrategy = new DefaultEventStrategy(this);
  }

  EventManager.prototype.registerElementConfig = function registerElementConfig(config) {
    var tagName = config.tagName.toLowerCase();
    var properties = config.properties;
    var propertyName = void 0;

    var lookup = this.elementHandlerLookup[tagName] = {};

    for (propertyName in properties) {
      if (properties.hasOwnProperty(propertyName)) {
        lookup[propertyName] = properties[propertyName];
      }
    }
  };

  EventManager.prototype.registerEventStrategy = function registerEventStrategy(eventName, strategy) {
    this.eventStrategyLookup[eventName] = strategy;
  };

  EventManager.prototype.getElementHandler = function getElementHandler(target, propertyName) {
    var tagName = void 0;
    var lookup = this.elementHandlerLookup;

    if (target.tagName) {
      tagName = target.tagName.toLowerCase();

      if (lookup[tagName] && lookup[tagName][propertyName]) {
        return new EventSubscriber(lookup[tagName][propertyName]);
      }

      if (propertyName === 'textContent' || propertyName === 'innerHTML') {
        return new EventSubscriber(lookup['content editable'].value);
      }

      if (propertyName === 'scrollTop' || propertyName === 'scrollLeft') {
        return new EventSubscriber(lookup['scrollable element'][propertyName]);
      }
    }

    return null;
  };

  EventManager.prototype.addEventListener = function addEventListener(target, targetEvent, callbackOrListener, delegate, disposable) {
    return (this.eventStrategyLookup[targetEvent] || this.defaultEventStrategy).subscribe(target, targetEvent, callbackOrListener, delegate, disposable);
  };

  return EventManager;
}();

var EventSubscriber = function () {
  function EventSubscriber(events) {
    

    this.events = events;
    this.element = null;
    this.handler = null;
  }

  EventSubscriber.prototype.subscribe = function subscribe(element, callbackOrListener) {
    this.element = element;
    this.handler = callbackOrListener;

    var events = this.events;
    for (var i = 0, ii = events.length; ii > i; ++i) {
      element.addEventListener(events[i], callbackOrListener);
    }
  };

  EventSubscriber.prototype.dispose = function dispose() {
    if (this.element === null) {
      return;
    }
    var element = this.element;
    var callbackOrListener = this.handler;
    var events = this.events;
    for (var i = 0, ii = events.length; ii > i; ++i) {
      element.removeEventListener(events[i], callbackOrListener);
    }
    this.element = this.handler = null;
  };

  return EventSubscriber;
}();

var DirtyChecker = function () {
  function DirtyChecker() {
    

    this.tracked = [];
    this.checkDelay = 120;
  }

  DirtyChecker.prototype.addProperty = function addProperty(property) {
    var tracked = this.tracked;

    tracked.push(property);

    if (tracked.length === 1) {
      this.scheduleDirtyCheck();
    }
  };

  DirtyChecker.prototype.removeProperty = function removeProperty(property) {
    var tracked = this.tracked;
    tracked.splice(tracked.indexOf(property), 1);
  };

  DirtyChecker.prototype.scheduleDirtyCheck = function scheduleDirtyCheck() {
    var _this22 = this;

    setTimeout(function () {
      return _this22.check();
    }, this.checkDelay);
  };

  DirtyChecker.prototype.check = function check() {
    var tracked = this.tracked;
    var i = tracked.length;

    while (i--) {
      var current = tracked[i];

      if (current.isDirty()) {
        current.call();
      }
    }

    if (tracked.length) {
      this.scheduleDirtyCheck();
    }
  };

  return DirtyChecker;
}();

var DirtyCheckProperty = (_dec5 = subscriberCollection(), _dec5(_class5 = function () {
  function DirtyCheckProperty(dirtyChecker, obj, propertyName) {
    

    this.dirtyChecker = dirtyChecker;
    this.obj = obj;
    this.propertyName = propertyName;
  }

  DirtyCheckProperty.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  DirtyCheckProperty.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  DirtyCheckProperty.prototype.isDirty = function isDirty() {
    return this.oldValue !== this.obj[this.propertyName];
  };

  DirtyCheckProperty.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.dirtyChecker.addProperty(this);
    }
    this.addSubscriber(context, callable);
  };

  DirtyCheckProperty.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.dirtyChecker.removeProperty(this);
    }
  };

  return DirtyCheckProperty;
}()) || _class5);

var logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('property-observation');

var propertyAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj[propertyName];
  },
  setValue: function setValue(value, obj, propertyName) {
    obj[propertyName] = value;
  }
};

var PrimitiveObserver = function () {
  function PrimitiveObserver(primitive, propertyName) {
    

    this.doNotCache = true;

    this.primitive = primitive;
    this.propertyName = propertyName;
  }

  PrimitiveObserver.prototype.getValue = function getValue() {
    return this.primitive[this.propertyName];
  };

  PrimitiveObserver.prototype.setValue = function setValue() {
    var type = _typeof(this.primitive);
    throw new Error('The ' + this.propertyName + ' property of a ' + type + ' (' + this.primitive + ') cannot be assigned.');
  };

  PrimitiveObserver.prototype.subscribe = function subscribe() {};

  PrimitiveObserver.prototype.unsubscribe = function unsubscribe() {};

  return PrimitiveObserver;
}();

var SetterObserver = (_dec6 = subscriberCollection(), _dec6(_class7 = function () {
  function SetterObserver(taskQueue, obj, propertyName) {
    

    this.taskQueue = taskQueue;
    this.obj = obj;
    this.propertyName = propertyName;
    this.queued = false;
    this.observing = false;
  }

  SetterObserver.prototype.getValue = function getValue() {
    return this.obj[this.propertyName];
  };

  SetterObserver.prototype.setValue = function setValue(newValue) {
    this.obj[this.propertyName] = newValue;
  };

  SetterObserver.prototype.getterValue = function getterValue() {
    return this.currentValue;
  };

  SetterObserver.prototype.setterValue = function setterValue(newValue) {
    var oldValue = this.currentValue;

    if (oldValue !== newValue) {
      if (!this.queued) {
        this.oldValue = oldValue;
        this.queued = true;
        this.taskQueue.queueMicroTask(this);
      }

      this.currentValue = newValue;
    }
  };

  SetterObserver.prototype.call = function call() {
    var oldValue = this.oldValue;
    var newValue = this.oldValue = this.currentValue;

    this.queued = false;

    this.callSubscribers(newValue, oldValue);
  };

  SetterObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.observing) {
      this.convertProperty();
    }
    this.addSubscriber(context, callable);
  };

  SetterObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    this.removeSubscriber(context, callable);
  };

  SetterObserver.prototype.convertProperty = function convertProperty() {
    this.observing = true;
    this.currentValue = this.obj[this.propertyName];
    this.setValue = this.setterValue;
    this.getValue = this.getterValue;

    if (!Reflect.defineProperty(this.obj, this.propertyName, {
      configurable: true,
      enumerable: this.propertyName in this.obj ? this.obj.propertyIsEnumerable(this.propertyName) : true,
      get: this.getValue.bind(this),
      set: this.setValue.bind(this)
    })) {
      logger.warn('Cannot observe property \'' + this.propertyName + '\' of object', this.obj);
    }
  };

  return SetterObserver;
}()) || _class7);

var XLinkAttributeObserver = function () {
  function XLinkAttributeObserver(element, propertyName, attributeName) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.attributeName = attributeName;
  }

  XLinkAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttributeNS('http://www.w3.org/1999/xlink', this.attributeName);
  };

  XLinkAttributeObserver.prototype.setValue = function setValue(newValue) {
    return this.element.setAttributeNS('http://www.w3.org/1999/xlink', this.attributeName, newValue);
  };

  XLinkAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return XLinkAttributeObserver;
}();

var dataAttributeAccessor = {
  getValue: function getValue(obj, propertyName) {
    return obj.getAttribute(propertyName);
  },
  setValue: function setValue(value, obj, propertyName) {
    if (value === null || value === undefined) {
      obj.removeAttribute(propertyName);
    } else {
      obj.setAttribute(propertyName, value);
    }
  }
};

var DataAttributeObserver = function () {
  function DataAttributeObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;
  }

  DataAttributeObserver.prototype.getValue = function getValue() {
    return this.element.getAttribute(this.propertyName);
  };

  DataAttributeObserver.prototype.setValue = function setValue(newValue) {
    if (newValue === null || newValue === undefined) {
      return this.element.removeAttribute(this.propertyName);
    }
    return this.element.setAttribute(this.propertyName, newValue);
  };

  DataAttributeObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return DataAttributeObserver;
}();

var StyleObserver = function () {
  function StyleObserver(element, propertyName) {
    

    this.element = element;
    this.propertyName = propertyName;

    this.styles = null;
    this.version = 0;
  }

  StyleObserver.prototype.getValue = function getValue() {
    return this.element.style.cssText;
  };

  StyleObserver.prototype._setProperty = function _setProperty(style, value) {
    var priority = '';

    if (value !== null && value !== undefined && typeof value.indexOf === 'function' && value.indexOf('!important') !== -1) {
      priority = 'important';
      value = value.replace('!important', '');
    }
    this.element.style.setProperty(style, value, priority);
  };

  StyleObserver.prototype.setValue = function setValue(newValue) {
    var styles = this.styles || {};
    var style = void 0;
    var version = this.version;

    if (newValue !== null && newValue !== undefined) {
      if (newValue instanceof Object) {
        var value = void 0;
        for (style in newValue) {
          if (newValue.hasOwnProperty(style)) {
            value = newValue[style];
            style = style.replace(/([A-Z])/g, function (m) {
              return '-' + m.toLowerCase();
            });
            styles[style] = version;
            this._setProperty(style, value);
          }
        }
      } else if (newValue.length) {
        var rx = /\s*([\w\-]+)\s*:\s*((?:(?:[\w\-]+\(\s*(?:"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[\w\-]+\(\s*(?:^"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^\)]*)\),?|[^\)]*)\),?|"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^;]*),?\s*)+);?/g;
        var pair = void 0;
        while ((pair = rx.exec(newValue)) !== null) {
          style = pair[1];
          if (!style) {
            continue;
          }

          styles[style] = version;
          this._setProperty(style, pair[2]);
        }
      }
    }

    this.styles = styles;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (style in styles) {
      if (!styles.hasOwnProperty(style) || styles[style] !== version) {
        continue;
      }

      this.element.style.removeProperty(style);
    }
  };

  StyleObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "' + this.propertyName + '" property is not supported.');
  };

  return StyleObserver;
}();

var ValueAttributeObserver = (_dec7 = subscriberCollection(), _dec7(_class8 = function () {
  function ValueAttributeObserver(element, propertyName, handler) {
    

    this.element = element;
    this.propertyName = propertyName;
    this.handler = handler;
    if (propertyName === 'files') {
      this.setValue = function () {};
    }
  }

  ValueAttributeObserver.prototype.getValue = function getValue() {
    return this.element[this.propertyName];
  };

  ValueAttributeObserver.prototype.setValue = function setValue(newValue) {
    newValue = newValue === undefined || newValue === null ? '' : newValue;
    if (this.element[this.propertyName] !== newValue) {
      this.element[this.propertyName] = newValue;
      this.notify();
    }
  };

  ValueAttributeObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.getValue();

    this.callSubscribers(newValue, oldValue);

    this.oldValue = newValue;
  };

  ValueAttributeObserver.prototype.handleEvent = function handleEvent() {
    this.notify();
  };

  ValueAttributeObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.oldValue = this.getValue();
      this.handler.subscribe(this.element, this);
    }

    this.addSubscriber(context, callable);
  };

  ValueAttributeObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  return ValueAttributeObserver;
}()) || _class8);

var checkedArrayContext = 'CheckedObserver:array';
var checkedValueContext = 'CheckedObserver:value';

var CheckedObserver = (_dec8 = subscriberCollection(), _dec8(_class9 = function () {
  function CheckedObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  CheckedObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  CheckedObserver.prototype.setValue = function setValue(newValue) {
    if (this.initialSync && this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }

    if (this.element.type === 'checkbox' && Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(checkedArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeElement();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  CheckedObserver.prototype.call = function call(context, splices) {
    this.synchronizeElement();

    if (!this.valueObserver) {
      this.valueObserver = this.element.__observers__.model || this.element.__observers__.value;
      if (this.valueObserver) {
        this.valueObserver.subscribe(checkedValueContext, this);
      }
    }
  };

  CheckedObserver.prototype.synchronizeElement = function synchronizeElement() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var isRadio = element.type === 'radio';
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    element.checked = isRadio && !!matcher(value, elementValue) || !isRadio && value === true || !isRadio && Array.isArray(value) && value.findIndex(function (item) {
      return !!matcher(item, elementValue);
    }) !== -1;
  };

  CheckedObserver.prototype.synchronizeValue = function synchronizeValue() {
    var value = this.value;
    var element = this.element;
    var elementValue = element.hasOwnProperty('model') ? element.model : element.value;
    var index = void 0;
    var matcher = element.matcher || function (a, b) {
      return a === b;
    };

    if (element.type === 'checkbox') {
      if (Array.isArray(value)) {
        index = value.findIndex(function (item) {
          return !!matcher(item, elementValue);
        });
        if (element.checked && index === -1) {
          value.push(elementValue);
        } else if (!element.checked && index !== -1) {
          value.splice(index, 1);
        }

        return;
      }

      value = element.checked;
    } else if (element.checked) {
      value = elementValue;
    } else {
      return;
    }

    this.oldValue = this.value;
    this.value = value;
    this.notify();
  };

  CheckedObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    if (newValue === oldValue) {
      return;
    }

    this.callSubscribers(newValue, oldValue);
  };

  CheckedObserver.prototype.handleEvent = function handleEvent() {
    this.synchronizeValue();
  };

  CheckedObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.handler.subscribe(this.element, this);
    }
    this.addSubscriber(context, callable);
  };

  CheckedObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  CheckedObserver.prototype.unbind = function unbind() {
    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(checkedArrayContext, this);
      this.arrayObserver = null;
    }
    if (this.valueObserver) {
      this.valueObserver.unsubscribe(checkedValueContext, this);
    }
  };

  return CheckedObserver;
}()) || _class9);

var selectArrayContext = 'SelectValueObserver:array';

var SelectValueObserver = (_dec9 = subscriberCollection(), _dec9(_class10 = function () {
  function SelectValueObserver(element, handler, observerLocator) {
    

    this.element = element;
    this.handler = handler;
    this.observerLocator = observerLocator;
  }

  SelectValueObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  SelectValueObserver.prototype.setValue = function setValue(newValue) {
    if (newValue !== null && newValue !== undefined && this.element.multiple && !Array.isArray(newValue)) {
      throw new Error('Only null or Array instances can be bound to a multi-select.');
    }
    if (this.value === newValue) {
      return;
    }

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }

    if (Array.isArray(newValue)) {
      this.arrayObserver = this.observerLocator.getArrayObserver(newValue);
      this.arrayObserver.subscribe(selectArrayContext, this);
    }

    this.oldValue = this.value;
    this.value = newValue;
    this.synchronizeOptions();
    this.notify();

    if (!this.initialSync) {
      this.initialSync = true;
      this.observerLocator.taskQueue.queueMicroTask(this);
    }
  };

  SelectValueObserver.prototype.call = function call(context, splices) {
    this.synchronizeOptions();
  };

  SelectValueObserver.prototype.synchronizeOptions = function synchronizeOptions() {
    var value = this.value;
    var isArray = void 0;

    if (Array.isArray(value)) {
      isArray = true;
    }

    var options = this.element.options;
    var i = options.length;
    var matcher = this.element.matcher || function (a, b) {
      return a === b;
    };

    var _loop = function _loop() {
      var option = options.item(i);
      var optionValue = option.hasOwnProperty('model') ? option.model : option.value;
      if (isArray) {
        option.selected = value.findIndex(function (item) {
          return !!matcher(optionValue, item);
        }) !== -1;
        return 'continue';
      }
      option.selected = !!matcher(optionValue, value);
    };

    while (i--) {
      var _ret = _loop();

      if (_ret === 'continue') continue;
    }
  };

  SelectValueObserver.prototype.synchronizeValue = function synchronizeValue() {
    var _this23 = this;

    var options = this.element.options;
    var count = 0;
    var value = [];

    for (var i = 0, ii = options.length; i < ii; i++) {
      var _option = options.item(i);
      if (!_option.selected) {
        continue;
      }
      value.push(_option.hasOwnProperty('model') ? _option.model : _option.value);
      count++;
    }

    if (this.element.multiple) {
      if (Array.isArray(this.value)) {
        var _ret2 = function () {
          var matcher = _this23.element.matcher || function (a, b) {
            return a === b;
          };

          var i = 0;

          var _loop2 = function _loop2() {
            var a = _this23.value[i];
            if (value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this23.value.splice(i, 1);
            } else {
              i++;
            }
          };

          while (i < _this23.value.length) {
            _loop2();
          }

          i = 0;

          var _loop3 = function _loop3() {
            var a = value[i];
            if (_this23.value.findIndex(function (b) {
              return matcher(a, b);
            }) === -1) {
              _this23.value.push(a);
            }
            i++;
          };

          while (i < value.length) {
            _loop3();
          }
          return {
            v: void 0
          };
        }();

        if ((typeof _ret2 === 'undefined' ? 'undefined' : _typeof(_ret2)) === "object") return _ret2.v;
      }
    } else {
      if (count === 0) {
        value = null;
      } else {
        value = value[0];
      }
    }

    if (value !== this.value) {
      this.oldValue = this.value;
      this.value = value;
      this.notify();
    }
  };

  SelectValueObserver.prototype.notify = function notify() {
    var oldValue = this.oldValue;
    var newValue = this.value;

    this.callSubscribers(newValue, oldValue);
  };

  SelectValueObserver.prototype.handleEvent = function handleEvent() {
    this.synchronizeValue();
  };

  SelectValueObserver.prototype.subscribe = function subscribe(context, callable) {
    if (!this.hasSubscribers()) {
      this.handler.subscribe(this.element, this);
    }
    this.addSubscriber(context, callable);
  };

  SelectValueObserver.prototype.unsubscribe = function unsubscribe(context, callable) {
    if (this.removeSubscriber(context, callable) && !this.hasSubscribers()) {
      this.handler.dispose();
    }
  };

  SelectValueObserver.prototype.bind = function bind() {
    var _this24 = this;

    this.domObserver = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].createMutationObserver(function () {
      _this24.synchronizeOptions();
      _this24.synchronizeValue();
    });
    this.domObserver.observe(this.element, { childList: true, subtree: true, characterData: true });
  };

  SelectValueObserver.prototype.unbind = function unbind() {
    this.domObserver.disconnect();
    this.domObserver = null;

    if (this.arrayObserver) {
      this.arrayObserver.unsubscribe(selectArrayContext, this);
      this.arrayObserver = null;
    }
  };

  return SelectValueObserver;
}()) || _class10);

var ClassObserver = function () {
  function ClassObserver(element) {
    

    this.element = element;
    this.doNotCache = true;
    this.value = '';
    this.version = 0;
  }

  ClassObserver.prototype.getValue = function getValue() {
    return this.value;
  };

  ClassObserver.prototype.setValue = function setValue(newValue) {
    var nameIndex = this.nameIndex || {};
    var version = this.version;
    var names = void 0;
    var name = void 0;

    if (newValue !== null && newValue !== undefined && newValue.length) {
      names = newValue.split(/\s+/);
      for (var i = 0, length = names.length; i < length; i++) {
        name = names[i];
        if (name === '') {
          continue;
        }
        nameIndex[name] = version;
        this.element.classList.add(name);
      }
    }

    this.value = newValue;
    this.nameIndex = nameIndex;
    this.version += 1;

    if (version === 0) {
      return;
    }

    version -= 1;
    for (name in nameIndex) {
      if (!nameIndex.hasOwnProperty(name) || nameIndex[name] !== version) {
        continue;
      }
      this.element.classList.remove(name);
    }
  };

  ClassObserver.prototype.subscribe = function subscribe() {
    throw new Error('Observation of a "' + this.element.nodeName + '" element\'s "class" property is not supported.');
  };

  return ClassObserver;
}();

function hasDeclaredDependencies(descriptor) {
  return !!(descriptor && descriptor.get && descriptor.get.dependencies);
}

function declarePropertyDependencies(ctor, propertyName, dependencies) {
  var descriptor = Object.getOwnPropertyDescriptor(ctor.prototype, propertyName);
  descriptor.get.dependencies = dependencies;
}

function computedFrom() {
  for (var _len = arguments.length, rest = Array(_len), _key = 0; _key < _len; _key++) {
    rest[_key] = arguments[_key];
  }

  return function (target, key, descriptor) {
    descriptor.get.dependencies = rest;
    return descriptor;
  };
}

var ComputedExpression = function (_Expression19) {
  _inherits(ComputedExpression, _Expression19);

  function ComputedExpression(name, dependencies) {
    

    var _this25 = _possibleConstructorReturn(this, _Expression19.call(this));

    _this25.name = name;
    _this25.dependencies = dependencies;
    _this25.isAssignable = true;
    return _this25;
  }

  ComputedExpression.prototype.evaluate = function evaluate(scope, lookupFunctions) {
    return scope.bindingContext[this.name];
  };

  ComputedExpression.prototype.assign = function assign(scope, value) {
    scope.bindingContext[this.name] = value;
  };

  ComputedExpression.prototype.accept = function accept(visitor) {
    throw new Error('not implemented');
  };

  ComputedExpression.prototype.connect = function connect(binding, scope) {
    var dependencies = this.dependencies;
    var i = dependencies.length;
    while (i--) {
      dependencies[i].connect(binding, scope);
    }
  };

  return ComputedExpression;
}(Expression);

function createComputedObserver(obj, propertyName, descriptor, observerLocator) {
  var dependencies = descriptor.get.dependencies;
  if (!(dependencies instanceof ComputedExpression)) {
    var i = dependencies.length;
    while (i--) {
      dependencies[i] = observerLocator.parser.parse(dependencies[i]);
    }
    dependencies = descriptor.get.dependencies = new ComputedExpression(propertyName, dependencies);
  }

  var scope = { bindingContext: obj, overrideContext: createOverrideContext(obj) };
  return new ExpressionObserver(scope, dependencies, observerLocator);
}

var svgElements = void 0;
var svgPresentationElements = void 0;
var svgPresentationAttributes = void 0;
var svgAnalyzer = void 0;

if (typeof FEATURE_NO_SVG === 'undefined') {
  svgElements = {
    a: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'target', 'transform', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    altGlyph: ['class', 'dx', 'dy', 'externalResourcesRequired', 'format', 'glyphRef', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    altGlyphDef: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    altGlyphItem: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    animate: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateColor: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateMotion: ['accumulate', 'additive', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keyPoints', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'origin', 'path', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'rotate', 'systemLanguage', 'to', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    animateTransform: ['accumulate', 'additive', 'attributeName', 'attributeType', 'begin', 'by', 'calcMode', 'dur', 'end', 'externalResourcesRequired', 'fill', 'from', 'id', 'keySplines', 'keyTimes', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'type', 'values', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    circle: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'r', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    clipPath: ['class', 'clipPathUnits', 'externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    'color-profile': ['id', 'local', 'name', 'rendering-intent', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    cursor: ['externalResourcesRequired', 'id', 'requiredExtensions', 'requiredFeatures', 'systemLanguage', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    defs: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    desc: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    ellipse: ['class', 'cx', 'cy', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    feBlend: ['class', 'height', 'id', 'in', 'in2', 'mode', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feColorMatrix: ['class', 'height', 'id', 'in', 'result', 'style', 'type', 'values', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feComponentTransfer: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feComposite: ['class', 'height', 'id', 'in', 'in2', 'k1', 'k2', 'k3', 'k4', 'operator', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feConvolveMatrix: ['bias', 'class', 'divisor', 'edgeMode', 'height', 'id', 'in', 'kernelMatrix', 'kernelUnitLength', 'order', 'preserveAlpha', 'result', 'style', 'targetX', 'targetY', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feDiffuseLighting: ['class', 'diffuseConstant', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feDisplacementMap: ['class', 'height', 'id', 'in', 'in2', 'result', 'scale', 'style', 'width', 'x', 'xChannelSelector', 'xml:base', 'xml:lang', 'xml:space', 'y', 'yChannelSelector'],
    feDistantLight: ['azimuth', 'elevation', 'id', 'xml:base', 'xml:lang', 'xml:space'],
    feFlood: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feFuncA: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncB: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncG: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feFuncR: ['amplitude', 'exponent', 'id', 'intercept', 'offset', 'slope', 'tableValues', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    feGaussianBlur: ['class', 'height', 'id', 'in', 'result', 'stdDeviation', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feImage: ['class', 'externalResourcesRequired', 'height', 'id', 'preserveAspectRatio', 'result', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feMerge: ['class', 'height', 'id', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feMergeNode: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    feMorphology: ['class', 'height', 'id', 'in', 'operator', 'radius', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feOffset: ['class', 'dx', 'dy', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    fePointLight: ['id', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
    feSpecularLighting: ['class', 'height', 'id', 'in', 'kernelUnitLength', 'result', 'specularConstant', 'specularExponent', 'style', 'surfaceScale', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feSpotLight: ['id', 'limitingConeAngle', 'pointsAtX', 'pointsAtY', 'pointsAtZ', 'specularExponent', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'z'],
    feTile: ['class', 'height', 'id', 'in', 'result', 'style', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    feTurbulence: ['baseFrequency', 'class', 'height', 'id', 'numOctaves', 'result', 'seed', 'stitchTiles', 'style', 'type', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    filter: ['class', 'externalResourcesRequired', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'style', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    font: ['class', 'externalResourcesRequired', 'horiz-adv-x', 'horiz-origin-x', 'horiz-origin-y', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face': ['accent-height', 'alphabetic', 'ascent', 'bbox', 'cap-height', 'descent', 'font-family', 'font-size', 'font-stretch', 'font-style', 'font-variant', 'font-weight', 'hanging', 'id', 'ideographic', 'mathematical', 'overline-position', 'overline-thickness', 'panose-1', 'slope', 'stemh', 'stemv', 'strikethrough-position', 'strikethrough-thickness', 'underline-position', 'underline-thickness', 'unicode-range', 'units-per-em', 'v-alphabetic', 'v-hanging', 'v-ideographic', 'v-mathematical', 'widths', 'x-height', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-format': ['id', 'string', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-name': ['id', 'name', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-src': ['id', 'xml:base', 'xml:lang', 'xml:space'],
    'font-face-uri': ['id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    foreignObject: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    g: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    glyph: ['arabic-form', 'class', 'd', 'glyph-name', 'horiz-adv-x', 'id', 'lang', 'orientation', 'style', 'unicode', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    glyphRef: ['class', 'dx', 'dy', 'format', 'glyphRef', 'id', 'style', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    hkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space'],
    image: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    line: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
    linearGradient: ['class', 'externalResourcesRequired', 'gradientTransform', 'gradientUnits', 'id', 'spreadMethod', 'style', 'x1', 'x2', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y1', 'y2'],
    marker: ['class', 'externalResourcesRequired', 'id', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
    mask: ['class', 'externalResourcesRequired', 'height', 'id', 'maskContentUnits', 'maskUnits', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    metadata: ['id', 'xml:base', 'xml:lang', 'xml:space'],
    'missing-glyph': ['class', 'd', 'horiz-adv-x', 'id', 'style', 'vert-adv-y', 'vert-origin-x', 'vert-origin-y', 'xml:base', 'xml:lang', 'xml:space'],
    mpath: ['externalResourcesRequired', 'id', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    path: ['class', 'd', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'pathLength', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    pattern: ['class', 'externalResourcesRequired', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    polygon: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    polyline: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'points', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    radialGradient: ['class', 'cx', 'cy', 'externalResourcesRequired', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'spreadMethod', 'style', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    rect: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rx', 'ry', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    script: ['externalResourcesRequired', 'id', 'type', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    set: ['attributeName', 'attributeType', 'begin', 'dur', 'end', 'externalResourcesRequired', 'fill', 'id', 'max', 'min', 'onbegin', 'onend', 'onload', 'onrepeat', 'repeatCount', 'repeatDur', 'requiredExtensions', 'requiredFeatures', 'restart', 'systemLanguage', 'to', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    stop: ['class', 'id', 'offset', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    style: ['id', 'media', 'title', 'type', 'xml:base', 'xml:lang', 'xml:space'],
    svg: ['baseProfile', 'class', 'contentScriptType', 'contentStyleType', 'externalResourcesRequired', 'height', 'id', 'onabort', 'onactivate', 'onclick', 'onerror', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'onresize', 'onscroll', 'onunload', 'onzoom', 'preserveAspectRatio', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'version', 'viewBox', 'width', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y', 'zoomAndPan'],
    switch: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'xml:base', 'xml:lang', 'xml:space'],
    symbol: ['class', 'externalResourcesRequired', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'preserveAspectRatio', 'style', 'viewBox', 'xml:base', 'xml:lang', 'xml:space'],
    text: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'transform', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    textPath: ['class', 'externalResourcesRequired', 'id', 'lengthAdjust', 'method', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'textLength', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space'],
    title: ['class', 'id', 'style', 'xml:base', 'xml:lang', 'xml:space'],
    tref: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    tspan: ['class', 'dx', 'dy', 'externalResourcesRequired', 'id', 'lengthAdjust', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'rotate', 'style', 'systemLanguage', 'textLength', 'x', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    use: ['class', 'externalResourcesRequired', 'height', 'id', 'onactivate', 'onclick', 'onfocusin', 'onfocusout', 'onload', 'onmousedown', 'onmousemove', 'onmouseout', 'onmouseover', 'onmouseup', 'requiredExtensions', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:actuate', 'xlink:arcrole', 'xlink:href', 'xlink:role', 'xlink:show', 'xlink:title', 'xlink:type', 'xml:base', 'xml:lang', 'xml:space', 'y'],
    view: ['externalResourcesRequired', 'id', 'preserveAspectRatio', 'viewBox', 'viewTarget', 'xml:base', 'xml:lang', 'xml:space', 'zoomAndPan'],
    vkern: ['g1', 'g2', 'id', 'k', 'u1', 'u2', 'xml:base', 'xml:lang', 'xml:space']
  };


  svgPresentationElements = {
    'a': true,
    'altGlyph': true,
    'animate': true,
    'animateColor': true,
    'circle': true,
    'clipPath': true,
    'defs': true,
    'ellipse': true,
    'feBlend': true,
    'feColorMatrix': true,
    'feComponentTransfer': true,
    'feComposite': true,
    'feConvolveMatrix': true,
    'feDiffuseLighting': true,
    'feDisplacementMap': true,
    'feFlood': true,
    'feGaussianBlur': true,
    'feImage': true,
    'feMerge': true,
    'feMorphology': true,
    'feOffset': true,
    'feSpecularLighting': true,
    'feTile': true,
    'feTurbulence': true,
    'filter': true,
    'font': true,
    'foreignObject': true,
    'g': true,
    'glyph': true,
    'glyphRef': true,
    'image': true,
    'line': true,
    'linearGradient': true,
    'marker': true,
    'mask': true,
    'missing-glyph': true,
    'path': true,
    'pattern': true,
    'polygon': true,
    'polyline': true,
    'radialGradient': true,
    'rect': true,
    'stop': true,
    'svg': true,
    'switch': true,
    'symbol': true,
    'text': true,
    'textPath': true,
    'tref': true,
    'tspan': true,
    'use': true
  };

  svgPresentationAttributes = {
    'alignment-baseline': true,
    'baseline-shift': true,
    'clip-path': true,
    'clip-rule': true,
    'clip': true,
    'color-interpolation-filters': true,
    'color-interpolation': true,
    'color-profile': true,
    'color-rendering': true,
    'color': true,
    'cursor': true,
    'direction': true,
    'display': true,
    'dominant-baseline': true,
    'enable-background': true,
    'fill-opacity': true,
    'fill-rule': true,
    'fill': true,
    'filter': true,
    'flood-color': true,
    'flood-opacity': true,
    'font-family': true,
    'font-size-adjust': true,
    'font-size': true,
    'font-stretch': true,
    'font-style': true,
    'font-variant': true,
    'font-weight': true,
    'glyph-orientation-horizontal': true,
    'glyph-orientation-vertical': true,
    'image-rendering': true,
    'kerning': true,
    'letter-spacing': true,
    'lighting-color': true,
    'marker-end': true,
    'marker-mid': true,
    'marker-start': true,
    'mask': true,
    'opacity': true,
    'overflow': true,
    'pointer-events': true,
    'shape-rendering': true,
    'stop-color': true,
    'stop-opacity': true,
    'stroke-dasharray': true,
    'stroke-dashoffset': true,
    'stroke-linecap': true,
    'stroke-linejoin': true,
    'stroke-miterlimit': true,
    'stroke-opacity': true,
    'stroke-width': true,
    'stroke': true,
    'text-anchor': true,
    'text-decoration': true,
    'text-rendering': true,
    'unicode-bidi': true,
    'visibility': true,
    'word-spacing': true,
    'writing-mode': true
  };

  var createElement = function createElement(html) {
    var div = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].createElement('div');
    div.innerHTML = html;
    return div.firstChild;
  };

  svgAnalyzer = function () {
    function SVGAnalyzer() {
      

      if (createElement('<svg><altGlyph /></svg>').firstElementChild.nodeName === 'altglyph' && elements.altGlyph) {
        elements.altglyph = elements.altGlyph;
        delete elements.altGlyph;
        elements.altglyphdef = elements.altGlyphDef;
        delete elements.altGlyphDef;
        elements.altglyphitem = elements.altGlyphItem;
        delete elements.altGlyphItem;
        elements.glyphref = elements.glyphRef;
        delete elements.glyphRef;
      }
    }

    SVGAnalyzer.prototype.isStandardSvgAttribute = function isStandardSvgAttribute(nodeName, attributeName) {
      return presentationElements[nodeName] && presentationAttributes[attributeName] || elements[nodeName] && elements[nodeName].indexOf(attributeName) !== -1;
    };

    return SVGAnalyzer;
  }();
}

var elements = svgElements;
var presentationElements = svgPresentationElements;
var presentationAttributes = svgPresentationAttributes;
var SVGAnalyzer = svgAnalyzer || function () {
  function _class11() {
    
  }

  _class11.prototype.isStandardSvgAttribute = function isStandardSvgAttribute() {
    return false;
  };

  return _class11;
}();

var ObserverLocator = (_temp = _class12 = function () {
  function ObserverLocator(taskQueue, eventManager, dirtyChecker, svgAnalyzer, parser) {
    

    this.taskQueue = taskQueue;
    this.eventManager = eventManager;
    this.dirtyChecker = dirtyChecker;
    this.svgAnalyzer = svgAnalyzer;
    this.parser = parser;

    this.adapters = [];
    this.logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('observer-locator');
  }

  ObserverLocator.prototype.getObserver = function getObserver(obj, propertyName) {
    var observersLookup = obj.__observers__;
    var observer = void 0;

    if (observersLookup && propertyName in observersLookup) {
      return observersLookup[propertyName];
    }

    observer = this.createPropertyObserver(obj, propertyName);

    if (!observer.doNotCache) {
      if (observersLookup === undefined) {
        observersLookup = this.getOrCreateObserversLookup(obj);
      }

      observersLookup[propertyName] = observer;
    }

    return observer;
  };

  ObserverLocator.prototype.getOrCreateObserversLookup = function getOrCreateObserversLookup(obj) {
    return obj.__observers__ || this.createObserversLookup(obj);
  };

  ObserverLocator.prototype.createObserversLookup = function createObserversLookup(obj) {
    var value = {};

    if (!Reflect.defineProperty(obj, '__observers__', {
      enumerable: false,
      configurable: false,
      writable: false,
      value: value
    })) {
      this.logger.warn('Cannot add observers to object', obj);
    }

    return value;
  };

  ObserverLocator.prototype.addAdapter = function addAdapter(adapter) {
    this.adapters.push(adapter);
  };

  ObserverLocator.prototype.getAdapterObserver = function getAdapterObserver(obj, propertyName, descriptor) {
    for (var i = 0, ii = this.adapters.length; i < ii; i++) {
      var adapter = this.adapters[i];
      var observer = adapter.getObserver(obj, propertyName, descriptor);
      if (observer) {
        return observer;
      }
    }
    return null;
  };

  ObserverLocator.prototype.createPropertyObserver = function createPropertyObserver(obj, propertyName) {
    var descriptor = void 0;
    var handler = void 0;
    var xlinkResult = void 0;

    if (!(obj instanceof Object)) {
      return new PrimitiveObserver(obj, propertyName);
    }

    if (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element) {
      if (propertyName === 'class') {
        return new ClassObserver(obj);
      }
      if (propertyName === 'style' || propertyName === 'css') {
        return new StyleObserver(obj, propertyName);
      }
      handler = this.eventManager.getElementHandler(obj, propertyName);
      if (propertyName === 'value' && obj.tagName.toLowerCase() === 'select') {
        return new SelectValueObserver(obj, handler, this);
      }
      if (propertyName === 'checked' && obj.tagName.toLowerCase() === 'input') {
        return new CheckedObserver(obj, handler, this);
      }
      if (handler) {
        return new ValueAttributeObserver(obj, propertyName, handler);
      }
      xlinkResult = /^xlink:(.+)$/.exec(propertyName);
      if (xlinkResult) {
        return new XLinkAttributeObserver(obj, propertyName, xlinkResult[1]);
      }
      if (propertyName === 'role' && (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement) || /^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName)) {
        return new DataAttributeObserver(obj, propertyName);
      }
    }

    descriptor = Object.getPropertyDescriptor(obj, propertyName);

    if (hasDeclaredDependencies(descriptor)) {
      return createComputedObserver(obj, propertyName, descriptor, this);
    }

    if (descriptor) {
      var existingGetterOrSetter = descriptor.get || descriptor.set;
      if (existingGetterOrSetter) {
        if (existingGetterOrSetter.getObserver) {
          return existingGetterOrSetter.getObserver(obj);
        }

        var adapterObserver = this.getAdapterObserver(obj, propertyName, descriptor);
        if (adapterObserver) {
          return adapterObserver;
        }
        return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
      }
    }

    if (obj instanceof Array) {
      if (propertyName === 'length') {
        return this.getArrayObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Map) {
      if (propertyName === 'size') {
        return this.getMapObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    } else if (obj instanceof Set) {
      if (propertyName === 'size') {
        return this.getSetObserver(obj).getLengthObserver();
      }

      return new DirtyCheckProperty(this.dirtyChecker, obj, propertyName);
    }

    return new SetterObserver(this.taskQueue, obj, propertyName);
  };

  ObserverLocator.prototype.getAccessor = function getAccessor(obj, propertyName) {
    if (obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element) {
      if (propertyName === 'class' || propertyName === 'style' || propertyName === 'css' || propertyName === 'value' && (obj.tagName.toLowerCase() === 'input' || obj.tagName.toLowerCase() === 'select') || propertyName === 'checked' && obj.tagName.toLowerCase() === 'input' || propertyName === 'model' && obj.tagName.toLowerCase() === 'input' || /^xlink:.+$/.exec(propertyName)) {
        return this.getObserver(obj, propertyName);
      }
      if (/^\w+:|^data-|^aria-/.test(propertyName) || obj instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].SVGElement && this.svgAnalyzer.isStandardSvgAttribute(obj.nodeName, propertyName) || obj.tagName.toLowerCase() === 'img' && propertyName === 'src' || obj.tagName.toLowerCase() === 'a' && propertyName === 'href') {
        return dataAttributeAccessor;
      }
    }
    return propertyAccessor;
  };

  ObserverLocator.prototype.getArrayObserver = function getArrayObserver(array) {
    return _getArrayObserver(this.taskQueue, array);
  };

  ObserverLocator.prototype.getMapObserver = function getMapObserver(map) {
    return _getMapObserver(this.taskQueue, map);
  };

  ObserverLocator.prototype.getSetObserver = function getSetObserver(set) {
    return _getSetObserver(this.taskQueue, set);
  };

  return ObserverLocator;
}(), _class12.inject = [__WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"], EventManager, DirtyChecker, SVGAnalyzer, Parser], _temp);

var ObjectObservationAdapter = function () {
  function ObjectObservationAdapter() {
    
  }

  ObjectObservationAdapter.prototype.getObserver = function getObserver(object, propertyName, descriptor) {
    throw new Error('BindingAdapters must implement getObserver(object, propertyName).');
  };

  return ObjectObservationAdapter;
}();

var BindingExpression = function () {
  function BindingExpression(observerLocator, targetProperty, sourceExpression, mode, lookupFunctions, attribute) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
    this.attribute = attribute;
    this.discrete = false;
  }

  BindingExpression.prototype.createBinding = function createBinding(target) {
    return new Binding(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.mode, this.lookupFunctions);
  };

  return BindingExpression;
}();

var Binding = (_dec10 = connectable(), _dec10(_class13 = function () {
  function Binding(observerLocator, sourceExpression, target, targetProperty, mode, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = targetProperty;
    this.mode = mode;
    this.lookupFunctions = lookupFunctions;
  }

  Binding.prototype.updateTarget = function updateTarget(value) {
    this.targetObserver.setValue(value, this.target, this.targetProperty);
  };

  Binding.prototype.updateSource = function updateSource(value) {
    this.sourceExpression.assign(this.source, value, this.lookupFunctions);
  };

  Binding.prototype.call = function call(context, newValue, oldValue) {
    if (!this.isBound) {
      return;
    }
    if (context === sourceContext) {
      oldValue = this.targetObserver.getValue(this.target, this.targetProperty);
      newValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      if (newValue !== oldValue) {
        this.updateTarget(newValue);
      }
      if (this.mode !== bindingMode.oneTime) {
        this._version++;
        this.sourceExpression.connect(this, this.source);
        this.unobserve(false);
      }
      return;
    }
    if (context === targetContext) {
      if (newValue !== this.sourceExpression.evaluate(this.source, this.lookupFunctions)) {
        this.updateSource(newValue);
      }
      return;
    }
    throw new Error('Unexpected call context ' + context);
  };

  Binding.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }

    var mode = this.mode;
    if (!this.targetObserver) {
      var method = mode === bindingMode.twoWay || mode === bindingMode.fromView ? 'getObserver' : 'getAccessor';
      this.targetObserver = this.observerLocator[method](this.target, this.targetProperty);
    }

    if ('bind' in this.targetObserver) {
      this.targetObserver.bind();
    }
    if (this.mode !== bindingMode.fromView) {
      var value = this.sourceExpression.evaluate(source, this.lookupFunctions);
      this.updateTarget(value);
    }

    if (mode === bindingMode.oneTime) {
      return;
    } else if (mode === bindingMode.toView) {
      enqueueBindingConnect(this);
    } else if (mode === bindingMode.twoWay) {
      this.sourceExpression.connect(this, source);
      this.targetObserver.subscribe(targetContext, this);
    } else if (mode === bindingMode.fromView) {
      this.targetObserver.subscribe(targetContext, this);
    }
  };

  Binding.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    if ('unbind' in this.targetObserver) {
      this.targetObserver.unbind();
    }
    if (this.targetObserver.unsubscribe) {
      this.targetObserver.unsubscribe(targetContext, this);
    }
    this.unobserve(true);
  };

  Binding.prototype.connect = function connect(evaluate) {
    if (!this.isBound) {
      return;
    }
    if (evaluate) {
      var value = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
      this.updateTarget(value);
    }
    this.sourceExpression.connect(this, this.source);
  };

  return Binding;
}()) || _class13);

var CallExpression = function () {
  function CallExpression(observerLocator, targetProperty, sourceExpression, lookupFunctions) {
    

    this.observerLocator = observerLocator;
    this.targetProperty = targetProperty;
    this.sourceExpression = sourceExpression;
    this.lookupFunctions = lookupFunctions;
  }

  CallExpression.prototype.createBinding = function createBinding(target) {
    return new Call(this.observerLocator, this.sourceExpression, target, this.targetProperty, this.lookupFunctions);
  };

  return CallExpression;
}();

var Call = function () {
  function Call(observerLocator, sourceExpression, target, targetProperty, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.targetProperty = observerLocator.getObserver(target, targetProperty);
    this.lookupFunctions = lookupFunctions;
  }

  Call.prototype.callSource = function callSource($event) {
    var overrideContext = this.source.overrideContext;
    Object.assign(overrideContext, $event);
    overrideContext.$event = $event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    for (var prop in $event) {
      delete overrideContext[prop];
    }
    return result;
  };

  Call.prototype.bind = function bind(source) {
    var _this26 = this;

    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.targetProperty.setValue(function ($event) {
      return _this26.callSource($event);
    });
  };

  Call.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this.targetProperty.setValue(null);
  };

  return Call;
}();

var ValueConverterResource = function () {
  function ValueConverterResource(name) {
    

    this.name = name;
  }

  ValueConverterResource.convention = function convention(name) {
    if (name.endsWith('ValueConverter')) {
      return new ValueConverterResource(camelCase(name.substring(0, name.length - 14)));
    }
  };

  ValueConverterResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  ValueConverterResource.prototype.register = function register(registry, name) {
    registry.registerValueConverter(name || this.name, this.instance);
  };

  ValueConverterResource.prototype.load = function load(container, target) {};

  return ValueConverterResource;
}();

function valueConverter(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new ValueConverterResource(nameOrTarget), target);
    };
  }

  __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new ValueConverterResource(), nameOrTarget);
}

var BindingBehaviorResource = function () {
  function BindingBehaviorResource(name) {
    

    this.name = name;
  }

  BindingBehaviorResource.convention = function convention(name) {
    if (name.endsWith('BindingBehavior')) {
      return new BindingBehaviorResource(camelCase(name.substring(0, name.length - 15)));
    }
  };

  BindingBehaviorResource.prototype.initialize = function initialize(container, target) {
    this.instance = container.get(target);
  };

  BindingBehaviorResource.prototype.register = function register(registry, name) {
    registry.registerBindingBehavior(name || this.name, this.instance);
  };

  BindingBehaviorResource.prototype.load = function load(container, target) {};

  return BindingBehaviorResource;
}();

function bindingBehavior(nameOrTarget) {
  if (nameOrTarget === undefined || typeof nameOrTarget === 'string') {
    return function (target) {
      __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new BindingBehaviorResource(nameOrTarget), target);
    };
  }

  __WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].define(__WEBPACK_IMPORTED_MODULE_3_aurelia_metadata__["metadata"].resource, new BindingBehaviorResource(), nameOrTarget);
}

var ListenerExpression = function () {
  function ListenerExpression(eventManager, targetEvent, sourceExpression, delegationStrategy, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.sourceExpression = sourceExpression;
    this.delegationStrategy = delegationStrategy;
    this.discrete = true;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  ListenerExpression.prototype.createBinding = function createBinding(target) {
    return new Listener(this.eventManager, this.targetEvent, this.delegationStrategy, this.sourceExpression, target, this.preventDefault, this.lookupFunctions);
  };

  return ListenerExpression;
}();

var Listener = function () {
  function Listener(eventManager, targetEvent, delegationStrategy, sourceExpression, target, preventDefault, lookupFunctions) {
    

    this.eventManager = eventManager;
    this.targetEvent = targetEvent;
    this.delegationStrategy = delegationStrategy;
    this.sourceExpression = sourceExpression;
    this.target = target;
    this.preventDefault = preventDefault;
    this.lookupFunctions = lookupFunctions;
  }

  Listener.prototype.callSource = function callSource(event) {
    var overrideContext = this.source.overrideContext;
    overrideContext.$event = event;
    var mustEvaluate = true;
    var result = this.sourceExpression.evaluate(this.source, this.lookupFunctions, mustEvaluate);
    delete overrideContext.$event;
    if (result !== true && this.preventDefault) {
      event.preventDefault();
    }
    return result;
  };

  Listener.prototype.handleEvent = function handleEvent(event) {
    this.callSource(event);
  };

  Listener.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;

    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this._handler = this.eventManager.addEventListener(this.target, this.targetEvent, this, this.delegationStrategy, true);
  };

  Listener.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
    this._handler.dispose();
    this._handler = null;
  };

  return Listener;
}();

function getAU(element) {
  var au = element.au;

  if (au === undefined) {
    throw new Error('No Aurelia APIs are defined for the element: "' + element.tagName + '".');
  }

  return au;
}

var NameExpression = function () {
  function NameExpression(sourceExpression, apiName, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.apiName = apiName;
    this.lookupFunctions = lookupFunctions;
    this.discrete = true;
  }

  NameExpression.prototype.createBinding = function createBinding(target) {
    return new NameBinder(this.sourceExpression, NameExpression.locateAPI(target, this.apiName), this.lookupFunctions);
  };

  NameExpression.locateAPI = function locateAPI(element, apiName) {
    switch (apiName) {
      case 'element':
        return element;
      case 'controller':
        return getAU(element).controller;
      case 'view-model':
        return getAU(element).controller.viewModel;
      case 'view':
        return getAU(element).controller.view;
      default:
        var target = getAU(element)[apiName];

        if (target === undefined) {
          throw new Error('Attempted to reference "' + apiName + '", but it was not found amongst the target\'s API.');
        }

        return target.viewModel;
    }
  };

  return NameExpression;
}();

var NameBinder = function () {
  function NameBinder(sourceExpression, target, lookupFunctions) {
    

    this.sourceExpression = sourceExpression;
    this.target = target;
    this.lookupFunctions = lookupFunctions;
  }

  NameBinder.prototype.bind = function bind(source) {
    if (this.isBound) {
      if (this.source === source) {
        return;
      }
      this.unbind();
    }
    this.isBound = true;
    this.source = source;
    if (this.sourceExpression.bind) {
      this.sourceExpression.bind(this, source, this.lookupFunctions);
    }
    this.sourceExpression.assign(this.source, this.target, this.lookupFunctions);
  };

  NameBinder.prototype.unbind = function unbind() {
    if (!this.isBound) {
      return;
    }
    this.isBound = false;
    if (this.sourceExpression.evaluate(this.source, this.lookupFunctions) === this.target) {
      this.sourceExpression.assign(this.source, null, this.lookupFunctions);
    }
    if (this.sourceExpression.unbind) {
      this.sourceExpression.unbind(this, this.source);
    }
    this.source = null;
  };

  return NameBinder;
}();

var LookupFunctions = {
  bindingBehaviors: function bindingBehaviors(name) {
    return null;
  },
  valueConverters: function valueConverters(name) {
    return null;
  }
};

var BindingEngine = (_temp2 = _class14 = function () {
  function BindingEngine(observerLocator, parser) {
    

    this.observerLocator = observerLocator;
    this.parser = parser;
  }

  BindingEngine.prototype.createBindingExpression = function createBindingExpression(targetProperty, sourceExpression) {
    var mode = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : bindingMode.toView;
    var lookupFunctions = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : LookupFunctions;

    return new BindingExpression(this.observerLocator, targetProperty, this.parser.parse(sourceExpression), mode, lookupFunctions);
  };

  BindingEngine.prototype.propertyObserver = function propertyObserver(obj, propertyName) {
    var _this27 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = _this27.observerLocator.getObserver(obj, propertyName);
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.collectionObserver = function collectionObserver(collection) {
    var _this28 = this;

    return {
      subscribe: function subscribe(callback) {
        var observer = void 0;
        if (collection instanceof Array) {
          observer = _this28.observerLocator.getArrayObserver(collection);
        } else if (collection instanceof Map) {
          observer = _this28.observerLocator.getMapObserver(collection);
        } else if (collection instanceof Set) {
          observer = _this28.observerLocator.getSetObserver(collection);
        } else {
          throw new Error('collection must be an instance of Array, Map or Set.');
        }
        observer.subscribe(callback);
        return {
          dispose: function dispose() {
            return observer.unsubscribe(callback);
          }
        };
      }
    };
  };

  BindingEngine.prototype.expressionObserver = function expressionObserver(bindingContext, expression) {
    var scope = { bindingContext: bindingContext, overrideContext: createOverrideContext(bindingContext) };
    return new ExpressionObserver(scope, this.parser.parse(expression), this.observerLocator, LookupFunctions);
  };

  BindingEngine.prototype.parseExpression = function parseExpression(expression) {
    return this.parser.parse(expression);
  };

  BindingEngine.prototype.registerAdapter = function registerAdapter(adapter) {
    this.observerLocator.addAdapter(adapter);
  };

  return BindingEngine;
}(), _class14.inject = [ObserverLocator, Parser], _temp2);

var setProto = Set.prototype;

function _getSetObserver(taskQueue, set) {
  return ModifySetObserver.for(taskQueue, set);
}

var ModifySetObserver = function (_ModifyCollectionObse3) {
  _inherits(ModifySetObserver, _ModifyCollectionObse3);

  function ModifySetObserver(taskQueue, set) {
    

    return _possibleConstructorReturn(this, _ModifyCollectionObse3.call(this, taskQueue, set));
  }

  ModifySetObserver.for = function _for(taskQueue, set) {
    if (!('__set_observer__' in set)) {
      Reflect.defineProperty(set, '__set_observer__', {
        value: ModifySetObserver.create(taskQueue, set),
        enumerable: false, configurable: false
      });
    }
    return set.__set_observer__;
  };

  ModifySetObserver.create = function create(taskQueue, set) {
    var observer = new ModifySetObserver(taskQueue, set);

    var proto = setProto;
    if (proto.add !== set.add || proto.delete !== set.delete || proto.clear !== set.clear) {
      proto = {
        add: set.add,
        delete: set.delete,
        clear: set.clear
      };
    }

    set.add = function () {
      var type = 'add';
      var oldSize = set.size;
      var methodCallResult = proto.add.apply(set, arguments);
      var hasValue = set.size === oldSize;
      if (!hasValue) {
        observer.addChangeRecord({
          type: type,
          object: set,
          value: Array.from(set).pop()
        });
      }
      return methodCallResult;
    };

    set.delete = function () {
      var hasValue = set.has(arguments[0]);
      var methodCallResult = proto.delete.apply(set, arguments);
      if (hasValue) {
        observer.addChangeRecord({
          type: 'delete',
          object: set,
          value: arguments[0]
        });
      }
      return methodCallResult;
    };

    set.clear = function () {
      var methodCallResult = proto.clear.apply(set, arguments);
      observer.addChangeRecord({
        type: 'clear',
        object: set
      });
      return methodCallResult;
    };

    return observer;
  };

  return ModifySetObserver;
}(ModifyCollectionObserver);

function observable(targetOrConfig, key, descriptor) {
  function deco(target, key, descriptor, config) {
    var isClassDecorator = key === undefined;
    if (isClassDecorator) {
      target = target.prototype;
      key = typeof config === 'string' ? config : config.name;
    }

    var innerPropertyName = '_' + key;
    var innerPropertyDescriptor = {
      configurable: true,
      enumerable: false,
      writable: true
    };

    var callbackName = config && config.changeHandler || key + 'Changed';

    if (descriptor) {
      if (typeof descriptor.initializer === 'function') {
        innerPropertyDescriptor.value = descriptor.initializer();
      }
    } else {
      descriptor = {};
    }

    if (!('enumerable' in descriptor)) {
      descriptor.enumerable = true;
    }

    delete descriptor.value;
    delete descriptor.writable;
    delete descriptor.initializer;

    Reflect.defineProperty(target, innerPropertyName, innerPropertyDescriptor);

    descriptor.get = function () {
      return this[innerPropertyName];
    };
    descriptor.set = function (newValue) {
      var oldValue = this[innerPropertyName];
      if (newValue === oldValue) {
        return;
      }

      this[innerPropertyName] = newValue;
      Reflect.defineProperty(this, innerPropertyName, { enumerable: false });

      if (this[callbackName]) {
        this[callbackName](newValue, oldValue, key);
      }
    };

    descriptor.get.dependencies = [innerPropertyName];

    if (isClassDecorator) {
      Reflect.defineProperty(target, key, descriptor);
    } else {
      return descriptor;
    }
  }

  if (key === undefined) {
    return function (t, k, d) {
      return deco(t, k, d, targetOrConfig);
    };
  }
  return deco(targetOrConfig, key, descriptor);
}

var signals = {};

function connectBindingToSignal(binding, name) {
  if (!signals.hasOwnProperty(name)) {
    signals[name] = 0;
  }
  binding.observeProperty(signals, name);
}

function signalBindings(name) {
  if (signals.hasOwnProperty(name)) {
    signals[name]++;
  }
}

/***/ },

/***/ "aurelia-event-aggregator":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "EventAggregator", function() { return EventAggregator; });
/* harmony export (immutable) */ exports["includeEventsIn"] = includeEventsIn;
/* harmony export (immutable) */ exports["configure"] = configure;




var logger = __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"]('event-aggregator');

var Handler = function () {
  function Handler(messageType, callback) {
    

    this.messageType = messageType;
    this.callback = callback;
  }

  Handler.prototype.handle = function handle(message) {
    if (message instanceof this.messageType) {
      this.callback.call(null, message);
    }
  };

  return Handler;
}();

function invokeCallback(callback, data, event) {
  try {
    callback(data, event);
  } catch (e) {
    logger.error(e);
  }
}

function invokeHandler(handler, data) {
  try {
    handler.handle(data);
  } catch (e) {
    logger.error(e);
  }
}

var EventAggregator = function () {
  function EventAggregator() {
    

    this.eventLookup = {};
    this.messageHandlers = [];
  }

  EventAggregator.prototype.publish = function publish(event, data) {
    var subscribers = void 0;
    var i = void 0;

    if (!event) {
      throw new Error('Event was invalid.');
    }

    if (typeof event === 'string') {
      subscribers = this.eventLookup[event];
      if (subscribers) {
        subscribers = subscribers.slice();
        i = subscribers.length;

        while (i--) {
          invokeCallback(subscribers[i], data, event);
        }
      }
    } else {
      subscribers = this.messageHandlers.slice();
      i = subscribers.length;

      while (i--) {
        invokeHandler(subscribers[i], event);
      }
    }
  };

  EventAggregator.prototype.subscribe = function subscribe(event, callback) {
    var handler = void 0;
    var subscribers = void 0;

    if (!event) {
      throw new Error('Event channel/type was invalid.');
    }

    if (typeof event === 'string') {
      handler = callback;
      subscribers = this.eventLookup[event] || (this.eventLookup[event] = []);
    } else {
      handler = new Handler(event, callback);
      subscribers = this.messageHandlers;
    }

    subscribers.push(handler);

    return {
      dispose: function dispose() {
        var idx = subscribers.indexOf(handler);
        if (idx !== -1) {
          subscribers.splice(idx, 1);
        }
      }
    };
  };

  EventAggregator.prototype.subscribeOnce = function subscribeOnce(event, callback) {
    var sub = this.subscribe(event, function (a, b) {
      sub.dispose();
      return callback(a, b);
    });

    return sub;
  };

  return EventAggregator;
}();

function includeEventsIn(obj) {
  var ea = new EventAggregator();

  obj.subscribeOnce = function (event, callback) {
    return ea.subscribeOnce(event, callback);
  };

  obj.subscribe = function (event, callback) {
    return ea.subscribe(event, callback);
  };

  obj.publish = function (event, data) {
    ea.publish(event, data);
  };

  return ea;
}

function configure(config) {
  config.instance(EventAggregator, includeEventsIn(config.aurelia));
}

/***/ },

/***/ "aurelia-framework":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_aurelia_task_queue__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "Aurelia", function() { return Aurelia; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FrameworkConfiguration", function() { return FrameworkConfiguration; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_emptyParameters", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["_emptyParameters"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "InvocationHandler", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["InvocationHandler"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Container", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Container"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "autoinject", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["autoinject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "inject", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "invoker", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["invoker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "invokeAsFactory", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["invokeAsFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "FactoryInvoker", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["FactoryInvoker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "registration", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["registration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "transient", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["transient"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "singleton", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["singleton"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TransientRegistration", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["TransientRegistration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SingletonRegistration", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["SingletonRegistration"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "resolver", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["resolver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Strategy", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Strategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StrategyResolver", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["StrategyResolver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Lazy", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Lazy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "All", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["All"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Optional", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Optional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Parent", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Parent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Factory", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Factory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NewInstance", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["NewInstance"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getDecoratorDependencies", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["getDecoratorDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "lazy", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["lazy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "all", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["all"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "optional", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["optional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "parent", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["parent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "factory", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["factory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "newInstance", function() { return __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["newInstance"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getArrayObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getArrayObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getMapObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getMapObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getSetObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getSetObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "targetContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["targetContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "sourceContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["sourceContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "camelCase", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["camelCase"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createOverrideContext", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createOverrideContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getContextFor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getContextFor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createScopeForTest", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createScopeForTest"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "connectable", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["connectable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "enqueueBindingConnect", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["enqueueBindingConnect"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "setConnectQueueThreshold", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["setConnectQueueThreshold"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "enableConnectQueue", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["enableConnectQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "disableConnectQueue", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["disableConnectQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getConnectQueueSize", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getConnectQueueSize"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "subscriberCollection", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["subscriberCollection"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ExpressionObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ExpressionObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "calcSplices", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["calcSplices"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "mergeSplice", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["mergeSplice"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "projectArraySplices", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["projectArraySplices"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "getChangeRecords", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["getChangeRecords"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ModifyCollectionObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ModifyCollectionObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CollectionLengthObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CollectionLengthObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Expression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Expression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingBehavior", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingBehavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueConverter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueConverter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Assign", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Assign"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Conditional", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Conditional"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessThis", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessThis"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessScope", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessScope"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessMember", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessMember"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AccessKeyed", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["AccessKeyed"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallScope", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallScope"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallMember", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallMember"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallFunction", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallFunction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Binary", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Binary"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Unary", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Unary"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralPrimitive", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralPrimitive"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralString", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralTemplate", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralTemplate"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralArray", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralArray"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "LiteralObject", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["LiteralObject"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Unparser", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Unparser"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ExpressionCloner", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ExpressionCloner"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "cloneExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["cloneExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindingMode", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["bindingMode"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Parser", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Parser"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ParserImplementation", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ParserImplementation"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "delegationStrategy", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["delegationStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "EventManager", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["EventManager"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "EventSubscriber", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["EventSubscriber"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DirtyChecker", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DirtyChecker"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DirtyCheckProperty", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DirtyCheckProperty"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "propertyAccessor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["propertyAccessor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PrimitiveObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["PrimitiveObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SetterObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SetterObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "XLinkAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["XLinkAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "dataAttributeAccessor", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["dataAttributeAccessor"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DataAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["DataAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StyleObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["StyleObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueAttributeObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueAttributeObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CheckedObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CheckedObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SelectValueObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SelectValueObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ClassObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ClassObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "hasDeclaredDependencies", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["hasDeclaredDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "declarePropertyDependencies", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["declarePropertyDependencies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "computedFrom", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["computedFrom"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ComputedExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ComputedExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "createComputedObserver", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["createComputedObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "elements", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["elements"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "presentationElements", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["presentationElements"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "presentationAttributes", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["presentationAttributes"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SVGAnalyzer", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["SVGAnalyzer"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ObserverLocator", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ObserverLocator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ObjectObservationAdapter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ObjectObservationAdapter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Binding", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Binding"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CallExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["CallExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Call", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Call"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ValueConverterResource", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ValueConverterResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "valueConverter", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["valueConverter"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingBehaviorResource", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingBehaviorResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindingBehavior", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["bindingBehavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ListenerExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["ListenerExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Listener", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["Listener"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NameExpression", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["NameExpression"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingEngine", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["BindingEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "observable", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["observable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "connectBindingToSignal", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["connectBindingToSignal"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "signalBindings", function() { return __WEBPACK_IMPORTED_MODULE_6_aurelia_binding__["signalBindings"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "metadata", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["metadata"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Origin", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["Origin"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "decorators", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["decorators"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "deprecated", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["deprecated"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "mixin", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "protocol", function() { return __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["protocol"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Animator", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["Animator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BehaviorInstruction", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BehaviorInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BehaviorPropertyObserver", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BehaviorPropertyObserver"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindableProperty", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BindableProperty"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BindingLanguage", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BindingLanguage"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "BoundViewFactory", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BoundViewFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionEngine", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["CompositionEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransaction", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["CompositionTransaction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransactionNotifier", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["CompositionTransactionNotifier"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "CompositionTransactionOwnershipToken", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["CompositionTransactionOwnershipToken"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "Controller", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["Controller"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ConventionalViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ConventionalViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ElementConfigResource", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ElementConfigResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ElementEvents", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ElementEvents"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "HtmlBehaviorResource", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["HtmlBehaviorResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "InlineViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["InlineViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ModuleAnalyzer", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ModuleAnalyzer"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "NoViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["NoViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PassThroughSlot", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["PassThroughSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "RelativeViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["RelativeViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceDescription", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ResourceDescription"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceLoadContext", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ResourceLoadContext"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ResourceModule", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ResourceModule"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ShadowDOM", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ShadowDOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ShadowSlot", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ShadowSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SlotCustomAttribute", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["SlotCustomAttribute"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "StaticViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["StaticViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "SwapStrategies", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["SwapStrategies"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TargetInstruction", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["TargetInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TemplateRegistryViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["TemplateRegistryViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TemplatingEngine", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["TemplatingEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "View", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["View"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewCompileInstruction", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewCompileInstruction"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewCompiler", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewCompiler"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewEngine", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewEngine"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewEngineHooksResource", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewEngineHooksResource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewFactory", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewFactory"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewLocator", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewLocator"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewResources", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewResources"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "ViewSlot", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewSlot"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_hyphenate", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["_hyphenate"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "_isAllWhitespace", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["_isAllWhitespace"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "animationEvent", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["animationEvent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "behavior", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["behavior"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "bindable", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["bindable"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "child", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["child"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "children", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["children"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "containerless", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["containerless"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "customAttribute", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["customAttribute"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "customElement", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["customElement"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "dynamicOptions", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["dynamicOptions"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "elementConfig", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["elementConfig"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "inlineView", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["inlineView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "noView", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["noView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "processAttributes", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["processAttributes"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "processContent", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["processContent"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "resource", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["resource"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "templateController", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["templateController"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useShadowDOM", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["useShadowDOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useView", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["useView"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "useViewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["useViewStrategy"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "validateBehaviorName", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["validateBehaviorName"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "view", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["view"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewEngineHooks", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["viewEngineHooks"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewResources", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["viewResources"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "viewStrategy", function() { return __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["viewStrategy"]; });
/* harmony namespace reexport (unknown) */ for(var __WEBPACK_IMPORT_KEY__ in __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__) if(["LogManager","Aurelia","FrameworkConfiguration","default"].indexOf(__WEBPACK_IMPORT_KEY__) < 0) (function(key) { __webpack_require__.d(exports, key, function() { return __WEBPACK_IMPORTED_MODULE_2_aurelia_loader__[key]; }) }(__WEBPACK_IMPORT_KEY__));
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "TaskQueue", function() { return __WEBPACK_IMPORTED_MODULE_8_aurelia_task_queue__["TaskQueue"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "buildQueryString", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_path__["buildQueryString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "join", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_path__["join"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "parseQueryString", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_path__["parseQueryString"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "relativeToFile", function() { return __WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "AggregateError", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["AggregateError"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "FEATURE", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["FEATURE"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "PLATFORM", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["PLATFORM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "DOM", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "isInitialized", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["isInitialized"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "initializePAL", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["initializePAL"]; });
/* harmony namespace reexport (by provided) */ __webpack_require__.d(exports, "reset", function() { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["reset"]; });














/* harmony reexport (module object) */ __webpack_require__.d(exports, "LogManager", function() { return __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__; });


var logger = __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["getLogger"]('aurelia');
var extPattern = /\.[^/.]+$/;
function runTasks(config, tasks) {
    var current;
    var next = function () {
        current = tasks.shift();
        if (current) {
            return Promise.resolve(current(config)).then(next);
        }
        return Promise.resolve();
    };
    return next();
}
function loadPlugin(fwConfig, loader, info) {
    logger.debug("Loading plugin ".concat(info.moduleId, "."));
    if (typeof info.moduleId === 'string') {
        fwConfig.resourcesRelativeTo = info.resourcesRelativeTo;
        var id = info.moduleId;
        if (info.resourcesRelativeTo.length > 1) {
            return loader.normalize(info.moduleId, info.resourcesRelativeTo[1])
                .then(function (normalizedId) { return _loadPlugin(normalizedId); });
        }
        return _loadPlugin(id);
    }
    else if (typeof info.configure === 'function') {
        if (fwConfig.configuredPlugins.indexOf(info.configure) !== -1) {
            return Promise.resolve();
        }
        fwConfig.configuredPlugins.push(info.configure);
        return Promise.resolve(info.configure.call(null, fwConfig, info.config || {}));
    }
    throw new Error(invalidConfigMsg(info.moduleId || info.configure, 'plugin'));
    function _loadPlugin(moduleId) {
        return loader.loadModule(moduleId).then(function (m) {
            if ('configure' in m) {
                if (fwConfig.configuredPlugins.indexOf(m.configure) !== -1) {
                    return Promise.resolve();
                }
                return Promise.resolve(m.configure(fwConfig, info.config || {})).then(function () {
                    fwConfig.configuredPlugins.push(m.configure);
                    fwConfig.resourcesRelativeTo = null;
                    logger.debug("Configured plugin ".concat(info.moduleId, "."));
                });
            }
            fwConfig.resourcesRelativeTo = null;
            logger.debug("Loaded plugin ".concat(info.moduleId, "."));
        });
    }
}
function loadResources(aurelia, resourcesToLoad, appResources) {
    if (Object.keys(resourcesToLoad).length === 0) {
        return Promise.resolve();
    }
    var viewEngine = aurelia.container.get(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewEngine"]);
    return Promise.all(Object.keys(resourcesToLoad).map(function (n) { return _normalize(resourcesToLoad[n]); }))
        .then(function (loads) {
        var names = [];
        var importIds = [];
        loads.forEach(function (l) {
            names.push(undefined);
            importIds.push(l.importId);
        });
        return viewEngine.importViewResources(importIds, names, appResources);
    });
    function _normalize(load) {
        var moduleId = load.moduleId;
        var ext = getExt(moduleId);
        if (isOtherResource(moduleId)) {
            moduleId = removeExt(moduleId);
        }
        return aurelia.loader.normalize(moduleId, load.relativeTo)
            .then(function (normalized) {
            return {
                name: load.moduleId,
                importId: isOtherResource(load.moduleId) ? addOriginalExt(normalized, ext) : normalized
            };
        });
    }
    function isOtherResource(name) {
        var ext = getExt(name);
        if (!ext)
            return false;
        if (ext === '')
            return false;
        if (ext === '.js' || ext === '.ts')
            return false;
        return true;
    }
    function removeExt(name) {
        return name.replace(extPattern, '');
    }
    function addOriginalExt(normalized, ext) {
        return removeExt(normalized) + '.' + ext;
    }
}
function getExt(name) {
    var match = name.match(extPattern);
    if (match && match.length > 0) {
        return (match[0].split('.'))[1];
    }
}
function loadBehaviors(config) {
    return Promise.all(config.behaviorsToLoad.map(function (m) { return m.load(config.container, m.target); })).then(function () {
        config.behaviorsToLoad = null;
    });
}
function assertProcessed(plugins) {
    if (plugins.processed) {
        throw new Error('This config instance has already been applied. To load more plugins or global resources, create a new FrameworkConfiguration instance.');
    }
}
function invalidConfigMsg(cfg, type) {
    return "Invalid ".concat(type, " [").concat(cfg, "], ").concat(type, " must be specified as functions or relative module IDs.");
}
var FrameworkConfiguration = (function () {
    function FrameworkConfiguration(aurelia) {
        var _this = this;
        this.aurelia = aurelia;
        this.container = aurelia.container;
        this.info = [];
        this.processed = false;
        this.preTasks = [];
        this.postTasks = [];
        this.behaviorsToLoad = [];
        this.configuredPlugins = [];
        this.resourcesToLoad = {};
        this.preTask(function () { return aurelia.loader.normalize('aurelia-bootstrapper', undefined)
            .then(function (name) { return _this.bootstrapperName = name; }); });
        this.postTask(function () { return loadResources(aurelia, _this.resourcesToLoad, aurelia.resources); });
    }
    FrameworkConfiguration.prototype.instance = function (type, instance) {
        this.container.registerInstance(type, instance);
        return this;
    };
    FrameworkConfiguration.prototype.singleton = function (type, implementation) {
        this.container.registerSingleton(type, implementation);
        return this;
    };
    FrameworkConfiguration.prototype.transient = function (type, implementation) {
        this.container.registerTransient(type, implementation);
        return this;
    };
    FrameworkConfiguration.prototype.preTask = function (task) {
        assertProcessed(this);
        this.preTasks.push(task);
        return this;
    };
    FrameworkConfiguration.prototype.postTask = function (task) {
        assertProcessed(this);
        this.postTasks.push(task);
        return this;
    };
    FrameworkConfiguration.prototype.feature = function (plugin, config) {
        if (config === void 0) { config = {}; }
        switch (typeof plugin) {
            case 'string':
                var hasIndex = /\/index$/i.test(plugin);
                var moduleId = hasIndex || getExt(plugin) ? plugin : plugin + '/index';
                var root = hasIndex ? plugin.slice(0, -6) : plugin;
                this.info.push({ moduleId: moduleId, resourcesRelativeTo: [root, ''], config: config });
                break;
            case 'function':
                this.info.push({ configure: plugin, config: config || {} });
                break;
            default:
                throw new Error(invalidConfigMsg(plugin, 'feature'));
        }
        return this;
    };
    FrameworkConfiguration.prototype.globalResources = function (resources) {
        var _this = this;
        assertProcessed(this);
        var toAdd = Array.isArray(resources) ? resources : arguments;
        var resource;
        var resourcesRelativeTo = this.resourcesRelativeTo || ['', ''];
        for (var i = 0, ii = toAdd.length; i < ii; ++i) {
            resource = toAdd[i];
            switch (typeof resource) {
                case 'string':
                    var parent_1 = resourcesRelativeTo[0];
                    var grandParent = resourcesRelativeTo[1];
                    var name_1 = resource;
                    if ((resource.startsWith('./') || resource.startsWith('../')) && parent_1 !== '') {
                        name_1 = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["join"])(parent_1, resource);
                    }
                    this.resourcesToLoad[name_1] = { moduleId: name_1, relativeTo: grandParent };
                    break;
                case 'function':
                    var meta = this.aurelia.resources.autoRegister(this.container, resource);
                    if (meta instanceof __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["HtmlBehaviorResource"] && meta.elementName !== null) {
                        if (this.behaviorsToLoad.push(meta) === 1) {
                            this.postTask(function () { return loadBehaviors(_this); });
                        }
                    }
                    break;
                default:
                    throw new Error(invalidConfigMsg(resource, 'resource'));
            }
        }
        return this;
    };
    FrameworkConfiguration.prototype.globalName = function (resourcePath, newName) {
        assertProcessed(this);
        this.resourcesToLoad[resourcePath] = { moduleId: newName, relativeTo: '' };
        return this;
    };
    FrameworkConfiguration.prototype.plugin = function (plugin, pluginConfig) {
        assertProcessed(this);
        var info;
        switch (typeof plugin) {
            case 'string':
                info = { moduleId: plugin, resourcesRelativeTo: [plugin, ''], config: pluginConfig || {} };
                break;
            case 'function':
                info = { configure: plugin, config: pluginConfig || {} };
                break;
            default:
                throw new Error(invalidConfigMsg(plugin, 'plugin'));
        }
        this.info.push(info);
        return this;
    };
    FrameworkConfiguration.prototype._addNormalizedPlugin = function (name, config) {
        var _this = this;
        var plugin = { moduleId: name, resourcesRelativeTo: [name, ''], config: config || {} };
        this.info.push(plugin);
        this.preTask(function () {
            var relativeTo = [name, _this.bootstrapperName];
            plugin.moduleId = name;
            plugin.resourcesRelativeTo = relativeTo;
            return Promise.resolve();
        });
        return this;
    };
    FrameworkConfiguration.prototype.defaultBindingLanguage = function () {
        return this._addNormalizedPlugin('aurelia-templating-binding');
    };
    FrameworkConfiguration.prototype.router = function () {
        return this._addNormalizedPlugin('aurelia-templating-router');
    };
    FrameworkConfiguration.prototype.history = function () {
        return this._addNormalizedPlugin('aurelia-history-browser');
    };
    FrameworkConfiguration.prototype.defaultResources = function () {
        return this._addNormalizedPlugin('aurelia-templating-resources');
    };
    FrameworkConfiguration.prototype.eventAggregator = function () {
        return this._addNormalizedPlugin('aurelia-event-aggregator');
    };
    FrameworkConfiguration.prototype.basicConfiguration = function () {
        return this.defaultBindingLanguage().defaultResources().eventAggregator();
    };
    FrameworkConfiguration.prototype.standardConfiguration = function () {
        return this.basicConfiguration().history().router();
    };
    FrameworkConfiguration.prototype.developmentLogging = function (level) {
        var _this = this;
        var logLevel = level ? __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["logLevel"][level] : undefined;
        if (logLevel === undefined) {
            logLevel = __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["logLevel"].debug;
        }
        this.preTask(function () {
            return _this.aurelia.loader.normalize('aurelia-logging-console', _this.bootstrapperName).then(function (name) {
                return _this.aurelia.loader.loadModule(name).then(function (m) {
                    __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["addAppender"](new m.ConsoleAppender());
                    __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["setLevel"](logLevel);
                });
            });
        });
        return this;
    };
    FrameworkConfiguration.prototype.apply = function () {
        var _this = this;
        if (this.processed) {
            return Promise.resolve();
        }
        return runTasks(this, this.preTasks).then(function () {
            var loader = _this.aurelia.loader;
            var info = _this.info;
            var current;
            var next = function () {
                current = info.shift();
                if (current) {
                    return loadPlugin(_this, loader, current).then(next);
                }
                _this.processed = true;
                _this.configuredPlugins = null;
                return Promise.resolve();
            };
            return next().then(function () { return runTasks(_this, _this.postTasks); });
        });
    };
    return FrameworkConfiguration;
}());

function preventActionlessFormSubmit() {
    __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].addEventListener('submit', function (evt) {
        var target = evt.target;
        var action = target.action;
        if (target.tagName.toLowerCase() === 'form' && !action) {
            evt.preventDefault();
        }
    }, false);
}
var Aurelia = (function () {
    function Aurelia(loader, container, resources) {
        this.loader = loader || new __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["PLATFORM"].Loader();
        this.container = container || (new __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Container"]()).makeGlobal();
        this.resources = resources || new __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewResources"]();
        this.use = new FrameworkConfiguration(this);
        this.logger = __WEBPACK_IMPORTED_MODULE_5_aurelia_logging__["getLogger"]('aurelia');
        this.hostConfigured = false;
        this.host = null;
        this.use.instance(Aurelia, this);
        this.use.instance(__WEBPACK_IMPORTED_MODULE_2_aurelia_loader__["Loader"], this.loader);
        this.use.instance(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewResources"], this.resources);
    }
    Aurelia.prototype.start = function () {
        var _this = this;
        if (this._started) {
            return this._started;
        }
        this.logger.info('Aurelia Starting');
        return this._started = this.use.apply().then(function () {
            preventActionlessFormSubmit();
            if (!_this.container.hasResolver(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["BindingLanguage"])) {
                var message = 'You must configure Aurelia with a BindingLanguage implementation.';
                _this.logger.error(message);
                throw new Error(message);
            }
            _this.logger.info('Aurelia Started');
            var evt = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].createCustomEvent('aurelia-started', { bubbles: true, cancelable: true });
            __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].dispatchEvent(evt);
            return _this;
        });
    };
    Aurelia.prototype.enhance = function (bindingContext, applicationHost) {
        var _this = this;
        if (bindingContext === void 0) { bindingContext = {}; }
        if (applicationHost === void 0) { applicationHost = null; }
        this._configureHost(applicationHost || __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].querySelectorAll('body')[0]);
        return new Promise(function (resolve) {
            var engine = _this.container.get(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["TemplatingEngine"]);
            _this.root = engine.enhance({ container: _this.container, element: _this.host, resources: _this.resources, bindingContext: bindingContext });
            _this.root.attached();
            _this._onAureliaComposed();
            resolve(_this);
        });
    };
    Aurelia.prototype.setRoot = function (root, applicationHost) {
        var _this = this;
        if (root === void 0) { root = null; }
        if (applicationHost === void 0) { applicationHost = null; }
        var instruction = {};
        if (this.root && this.root.viewModel && this.root.viewModel.router) {
            this.root.viewModel.router.deactivate();
            this.root.viewModel.router.reset();
        }
        this._configureHost(applicationHost);
        var engine = this.container.get(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["TemplatingEngine"]);
        var transaction = this.container.get(__WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["CompositionTransaction"]);
        delete transaction.initialComposition;
        if (!root) {
            if (this.configModuleId) {
                root = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_path__["relativeToFile"])('./app', this.configModuleId);
            }
            else {
                root = 'app';
            }
        }
        instruction.viewModel = root;
        instruction.container = instruction.childContainer = this.container;
        instruction.viewSlot = this.hostSlot;
        instruction.host = this.host;
        return engine.compose(instruction).then(function (r) {
            _this.root = r;
            instruction.viewSlot.attached();
            _this._onAureliaComposed();
            return _this;
        });
    };
    Aurelia.prototype._configureHost = function (applicationHost) {
        if (this.hostConfigured) {
            return;
        }
        applicationHost = applicationHost || this.host;
        if (!applicationHost || typeof applicationHost === 'string') {
            this.host = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].getElementById(applicationHost || 'applicationHost');
        }
        else {
            this.host = applicationHost;
        }
        if (!this.host) {
            throw new Error('No applicationHost was specified.');
        }
        this.hostConfigured = true;
        this.host.aurelia = this;
        this.hostSlot = new __WEBPACK_IMPORTED_MODULE_1_aurelia_templating__["ViewSlot"](this.host, true);
        this.hostSlot.transformChildNodesIntoView();
        this.container.registerInstance(__WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].boundary, this.host);
    };
    Aurelia.prototype._onAureliaComposed = function () {
        var evt = __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].createCustomEvent('aurelia-composed', { bubbles: true, cancelable: true });
        setTimeout(function () { return __WEBPACK_IMPORTED_MODULE_4_aurelia_pal__["DOM"].dispatchEvent(evt); }, 1);
    };
    return Aurelia;
}());


//# sourceMappingURL=aurelia-framework.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-history-browser":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_history__ = __webpack_require__(213);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony export (binding) */ __webpack_require__.d(exports, "BrowserHistory", function() { return BrowserHistory; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DefaultLinkHandler", function() { return DefaultLinkHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LinkHandler", function() { return LinkHandler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });



/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var LinkHandler = (function () {
    function LinkHandler() {
    }
    LinkHandler.prototype.activate = function (history) { };
    LinkHandler.prototype.deactivate = function () { };
    return LinkHandler;
}());
var DefaultLinkHandler = (function (_super) {
    __extends(DefaultLinkHandler, _super);
    function DefaultLinkHandler() {
        var _this = _super.call(this) || this;
        _this.handler = function (e) {
            var _a = DefaultLinkHandler.getEventInfo(e), shouldHandleEvent = _a.shouldHandleEvent, href = _a.href;
            if (shouldHandleEvent) {
                e.preventDefault();
                _this.history.navigate(href);
            }
        };
        return _this;
    }
    DefaultLinkHandler.prototype.activate = function (history) {
        if (history._hasPushState) {
            this.history = history;
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].addEventListener('click', this.handler, true);
        }
    };
    DefaultLinkHandler.prototype.deactivate = function () {
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].removeEventListener('click', this.handler, true);
    };
    DefaultLinkHandler.getEventInfo = function (event) {
        var $event = event;
        var info = {
            shouldHandleEvent: false,
            href: null,
            anchor: null
        };
        var target = DefaultLinkHandler.findClosestAnchor($event.target);
        if (!target || !DefaultLinkHandler.targetIsThisWindow(target)) {
            return info;
        }
        if (hasAttribute(target, 'download')
            || hasAttribute(target, 'router-ignore')
            || hasAttribute(target, 'data-router-ignore')) {
            return info;
        }
        if ($event.altKey || $event.ctrlKey || $event.metaKey || $event.shiftKey) {
            return info;
        }
        var href = target.getAttribute('href');
        info.anchor = target;
        info.href = href;
        var leftButtonClicked = $event.which === 1;
        var isRelative = href && !(href.charAt(0) === '#' || (/^[a-z]+:/i).test(href));
        info.shouldHandleEvent = leftButtonClicked && isRelative;
        return info;
    };
    DefaultLinkHandler.findClosestAnchor = function (el) {
        while (el) {
            if (el.tagName === 'A') {
                return el;
            }
            el = el.parentNode;
        }
    };
    DefaultLinkHandler.targetIsThisWindow = function (target) {
        var targetWindow = target.getAttribute('target');
        var win = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].global;
        return !targetWindow ||
            targetWindow === win.name ||
            targetWindow === '_self';
    };
    return DefaultLinkHandler;
}(LinkHandler));
var hasAttribute = function (el, attr) { return el.hasAttribute(attr); };

var BrowserHistory = (function (_super) {
    __extends(BrowserHistory, _super);
    function BrowserHistory(linkHandler) {
        var _this = _super.call(this) || this;
        _this._isActive = false;
        _this._checkUrlCallback = _this._checkUrl.bind(_this);
        _this.location = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].location;
        _this.history = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].history;
        _this.linkHandler = linkHandler;
        return _this;
    }
    BrowserHistory.prototype.activate = function (options) {
        if (this._isActive) {
            throw new Error('History has already been activated.');
        }
        var $history = this.history;
        var wantsPushState = !!options.pushState;
        this._isActive = true;
        var normalizedOptions = this.options = Object.assign({}, { root: '/' }, this.options, options);
        var rootUrl = this.root = ('/' + normalizedOptions.root + '/').replace(rootStripper, '/');
        var wantsHashChange = this._wantsHashChange = normalizedOptions.hashChange !== false;
        var hasPushState = this._hasPushState = !!(normalizedOptions.pushState && $history && $history.pushState);
        var eventName;
        if (hasPushState) {
            eventName = 'popstate';
        }
        else if (wantsHashChange) {
            eventName = 'hashchange';
        }
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].addEventListener(eventName, this._checkUrlCallback);
        if (wantsHashChange && wantsPushState) {
            var $location = this.location;
            var atRoot = $location.pathname.replace(/[^\/]$/, '$&/') === rootUrl;
            if (!hasPushState && !atRoot) {
                var fragment = this.fragment = this._getFragment(null, true);
                $location.replace(rootUrl + $location.search + '#' + fragment);
                return true;
            }
            else if (hasPushState && atRoot && $location.hash) {
                var fragment = this.fragment = this._getHash().replace(routeStripper, '');
                $history.replaceState({}, __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title, rootUrl + fragment + $location.search);
            }
        }
        if (!this.fragment) {
            this.fragment = this._getFragment('');
        }
        this.linkHandler.activate(this);
        if (!normalizedOptions.silent) {
            return this._loadUrl('');
        }
    };
    BrowserHistory.prototype.deactivate = function () {
        var handler = this._checkUrlCallback;
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].removeEventListener('popstate', handler);
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["PLATFORM"].removeEventListener('hashchange', handler);
        this._isActive = false;
        this.linkHandler.deactivate();
    };
    BrowserHistory.prototype.getAbsoluteRoot = function () {
        var $location = this.location;
        var origin = createOrigin($location.protocol, $location.hostname, $location.port);
        return "" + origin + this.root;
    };
    BrowserHistory.prototype.navigate = function (fragment, _a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.trigger, trigger = _c === void 0 ? true : _c, _d = _b.replace, replace = _d === void 0 ? false : _d;
        var location = this.location;
        if (fragment && absoluteUrl.test(fragment)) {
            location.href = fragment;
            return true;
        }
        if (!this._isActive) {
            return false;
        }
        fragment = this._getFragment(fragment || '');
        if (this.fragment === fragment && !replace) {
            return false;
        }
        this.fragment = fragment;
        var url = this.root + fragment;
        if (fragment === '' && url !== '/') {
            url = url.slice(0, -1);
        }
        if (this._hasPushState) {
            url = url.replace('//', '/');
            this.history[replace ? 'replaceState' : 'pushState']({}, __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title, url);
        }
        else if (this._wantsHashChange) {
            updateHash(location, fragment, replace);
        }
        else {
            location.assign(url);
        }
        if (trigger) {
            return this._loadUrl(fragment);
        }
        return true;
    };
    BrowserHistory.prototype.navigateBack = function () {
        this.history.back();
    };
    BrowserHistory.prototype.setTitle = function (title) {
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].title = title;
    };
    BrowserHistory.prototype.setState = function (key, value) {
        var $history = this.history;
        var state = Object.assign({}, $history.state);
        var _a = this.location, pathname = _a.pathname, search = _a.search, hash = _a.hash;
        state[key] = value;
        $history.replaceState(state, null, "" + pathname + search + hash);
    };
    BrowserHistory.prototype.getState = function (key) {
        var state = Object.assign({}, this.history.state);
        return state[key];
    };
    BrowserHistory.prototype.getHistoryIndex = function () {
        var historyIndex = this.getState('HistoryIndex');
        if (historyIndex === undefined) {
            historyIndex = this.history.length - 1;
            this.setState('HistoryIndex', historyIndex);
        }
        return historyIndex;
    };
    BrowserHistory.prototype.go = function (movement) {
        this.history.go(movement);
    };
    BrowserHistory.prototype._getHash = function () {
        return this.location.hash.substr(1);
    };
    BrowserHistory.prototype._getFragment = function (fragment, forcePushState) {
        var rootUrl;
        if (!fragment) {
            if (this._hasPushState || !this._wantsHashChange || forcePushState) {
                var location_1 = this.location;
                fragment = location_1.pathname + location_1.search;
                rootUrl = this.root.replace(trailingSlash, '');
                if (!fragment.indexOf(rootUrl)) {
                    fragment = fragment.substr(rootUrl.length);
                }
            }
            else {
                fragment = this._getHash();
            }
        }
        return '/' + fragment.replace(routeStripper, '');
    };
    BrowserHistory.prototype._checkUrl = function () {
        var current = this._getFragment('');
        if (current !== this.fragment) {
            this._loadUrl('');
        }
    };
    BrowserHistory.prototype._loadUrl = function (fragmentOverride) {
        var fragment = this.fragment = this._getFragment(fragmentOverride);
        return this.options.routeHandler ?
            this.options.routeHandler(fragment) :
            false;
    };
    BrowserHistory.inject = [LinkHandler];
    return BrowserHistory;
}(__WEBPACK_IMPORTED_MODULE_0_aurelia_history__["History"]));
var routeStripper = /^#?\/*|\s+$/g;
var rootStripper = /^\/+|\/+$/g;
var trailingSlash = /\/$/;
var absoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;
function updateHash($location, fragment, replace) {
    if (replace) {
        var href = $location.href.replace(/(javascript:|#).*$/, '');
        $location.replace(href + '#' + fragment);
    }
    else {
        $location.hash = '#' + fragment;
    }
}
function createOrigin(protocol, hostname, port) {
    return protocol + "//" + hostname + (port ? ':' + port : '');
}

function configure(config) {
    var $config = config;
    $config.singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_history__["History"], BrowserHistory);
    $config.transient(LinkHandler, DefaultLinkHandler);
}


//# sourceMappingURL=aurelia-history-browser.js.map


/***/ },

/***/ "aurelia-logging-console":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(exports, "ConsoleAppender", function() { return ConsoleAppender; });


var ConsoleAppender = function () {
  function ConsoleAppender() {
    
  }

  ConsoleAppender.prototype.debug = function debug(logger) {
    var _console;

    for (var _len = arguments.length, rest = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
      rest[_key - 1] = arguments[_key];
    }

    (_console = console).debug.apply(_console, ["DEBUG [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.info = function info(logger) {
    var _console2;

    for (var _len2 = arguments.length, rest = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {
      rest[_key2 - 1] = arguments[_key2];
    }

    (_console2 = console).info.apply(_console2, ["INFO [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.warn = function warn(logger) {
    var _console3;

    for (var _len3 = arguments.length, rest = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {
      rest[_key3 - 1] = arguments[_key3];
    }

    (_console3 = console).warn.apply(_console3, ["WARN [" + logger.id + "]"].concat(rest));
  };

  ConsoleAppender.prototype.error = function error(logger) {
    var _console4;

    for (var _len4 = arguments.length, rest = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {
      rest[_key4 - 1] = arguments[_key4];
    }

    (_console4 = console).error.apply(_console4, ["ERROR [" + logger.id + "]"].concat(rest));
  };

  return ConsoleAppender;
}();

/***/ },

/***/ "aurelia-route-recognizer":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_path__ = __webpack_require__(23);
/* harmony export (binding) */ __webpack_require__.d(exports, "State", function() { return State; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StaticSegment", function() { return StaticSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DynamicSegment", function() { return DynamicSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "StarSegment", function() { return StarSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "EpsilonSegment", function() { return EpsilonSegment; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteRecognizer", function() { return RouteRecognizer; });




var State = function () {
  function State(charSpec) {
    

    this.charSpec = charSpec;
    this.nextStates = [];
  }

  State.prototype.get = function get(charSpec) {
    for (var _iterator = this.nextStates, _isArray = Array.isArray(_iterator), _i = 0, _iterator = _isArray ? _iterator : _iterator[Symbol.iterator]();;) {
      var _ref;

      if (_isArray) {
        if (_i >= _iterator.length) break;
        _ref = _iterator[_i++];
      } else {
        _i = _iterator.next();
        if (_i.done) break;
        _ref = _i.value;
      }

      var child = _ref;

      var isEqual = child.charSpec.validChars === charSpec.validChars && child.charSpec.invalidChars === charSpec.invalidChars;

      if (isEqual) {
        return child;
      }
    }

    return undefined;
  };

  State.prototype.put = function put(charSpec) {
    var state = this.get(charSpec);

    if (state) {
      return state;
    }

    state = new State(charSpec);

    this.nextStates.push(state);

    if (charSpec.repeat) {
      state.nextStates.push(state);
    }

    return state;
  };

  State.prototype.match = function match(ch) {
    var nextStates = this.nextStates;
    var results = [];

    for (var i = 0, l = nextStates.length; i < l; i++) {
      var child = nextStates[i];
      var charSpec = child.charSpec;

      if (charSpec.validChars !== undefined) {
        if (charSpec.validChars.indexOf(ch) !== -1) {
          results.push(child);
        }
      } else if (charSpec.invalidChars !== undefined) {
        if (charSpec.invalidChars.indexOf(ch) === -1) {
          results.push(child);
        }
      }
    }

    return results;
  };

  return State;
}();

var specials = ['/', '.', '*', '+', '?', '|', '(', ')', '[', ']', '{', '}', '\\'];

var escapeRegex = new RegExp('(\\' + specials.join('|\\') + ')', 'g');

var StaticSegment = function () {
  function StaticSegment(string, caseSensitive) {
    

    this.string = string;
    this.caseSensitive = caseSensitive;
  }

  StaticSegment.prototype.eachChar = function eachChar(callback) {
    var s = this.string;
    for (var i = 0, ii = s.length; i < ii; ++i) {
      var ch = s[i];
      callback({ validChars: this.caseSensitive ? ch : ch.toUpperCase() + ch.toLowerCase() });
    }
  };

  StaticSegment.prototype.regex = function regex() {
    return this.string.replace(escapeRegex, '\\$1');
  };

  StaticSegment.prototype.generate = function generate() {
    return this.string;
  };

  return StaticSegment;
}();

var DynamicSegment = function () {
  function DynamicSegment(name, optional) {
    

    this.name = name;
    this.optional = optional;
  }

  DynamicSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '/', repeat: true });
  };

  DynamicSegment.prototype.regex = function regex() {
    return '([^/]+)';
  };

  DynamicSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return DynamicSegment;
}();

var StarSegment = function () {
  function StarSegment(name) {
    

    this.name = name;
  }

  StarSegment.prototype.eachChar = function eachChar(callback) {
    callback({ invalidChars: '', repeat: true });
  };

  StarSegment.prototype.regex = function regex() {
    return '(.+)';
  };

  StarSegment.prototype.generate = function generate(params, consumed) {
    consumed[this.name] = true;
    return params[this.name];
  };

  return StarSegment;
}();

var EpsilonSegment = function () {
  function EpsilonSegment() {
    
  }

  EpsilonSegment.prototype.eachChar = function eachChar() {};

  EpsilonSegment.prototype.regex = function regex() {
    return '';
  };

  EpsilonSegment.prototype.generate = function generate() {
    return '';
  };

  return EpsilonSegment;
}();

var RouteRecognizer = function () {
  function RouteRecognizer() {
    

    this.rootState = new State();
    this.names = {};
    this.routes = new Map();
  }

  RouteRecognizer.prototype.add = function add(route) {
    var _this = this;

    if (Array.isArray(route)) {
      route.forEach(function (r) {
        return _this.add(r);
      });
      return undefined;
    }

    var currentState = this.rootState;
    var skippableStates = [];
    var regex = '^';
    var types = { statics: 0, dynamics: 0, stars: 0 };
    var names = [];
    var routeName = route.handler.name;
    var isEmpty = true;
    var segments = parse(route.path, names, types, route.caseSensitive);

    for (var i = 0, ii = segments.length; i < ii; i++) {
      var segment = segments[i];
      if (segment instanceof EpsilonSegment) {
        continue;
      }

      var _addSegment = addSegment(currentState, segment),
          firstState = _addSegment[0],
          nextState = _addSegment[1];

      for (var j = 0, jj = skippableStates.length; j < jj; j++) {
        skippableStates[j].nextStates.push(firstState);
      }

      if (segment.optional) {
        skippableStates.push(nextState);
        regex += '(?:/' + segment.regex() + ')?';
      } else {
        currentState = nextState;
        regex += '/' + segment.regex();
        skippableStates.length = 0;
        isEmpty = false;
      }
    }

    if (isEmpty) {
      currentState = currentState.put({ validChars: '/' });
      regex += '/?';
    }

    var handlers = [{ handler: route.handler, names: names }];

    this.routes.set(route.handler, { segments: segments, handlers: handlers });
    if (routeName) {
      var routeNames = Array.isArray(routeName) ? routeName : [routeName];
      for (var _i2 = 0; _i2 < routeNames.length; _i2++) {
        if (!(routeNames[_i2] in this.names)) {
          this.names[routeNames[_i2]] = { segments: segments, handlers: handlers };
        }
      }
    }

    for (var _i3 = 0; _i3 < skippableStates.length; _i3++) {
      var state = skippableStates[_i3];
      state.handlers = handlers;
      state.regex = new RegExp(regex + '$', route.caseSensitive ? '' : 'i');
      state.types = types;
    }

    currentState.handlers = handlers;
    currentState.regex = new RegExp(regex + '$', route.caseSensitive ? '' : 'i');
    currentState.types = types;

    return currentState;
  };

  RouteRecognizer.prototype.getRoute = function getRoute(nameOrRoute) {
    return typeof nameOrRoute === 'string' ? this.names[nameOrRoute] : this.routes.get(nameOrRoute);
  };

  RouteRecognizer.prototype.handlersFor = function handlersFor(nameOrRoute) {
    var route = this.getRoute(nameOrRoute);
    if (!route) {
      throw new Error('There is no route named ' + nameOrRoute);
    }

    return [].concat(route.handlers);
  };

  RouteRecognizer.prototype.hasRoute = function hasRoute(nameOrRoute) {
    return !!this.getRoute(nameOrRoute);
  };

  RouteRecognizer.prototype.generate = function generate(nameOrRoute, params) {
    var route = this.getRoute(nameOrRoute);
    if (!route) {
      throw new Error('There is no route named ' + nameOrRoute);
    }

    var handler = route.handlers[0].handler;
    if (handler.generationUsesHref) {
      return handler.href;
    }

    var routeParams = Object.assign({}, params);
    var segments = route.segments;
    var consumed = {};
    var output = '';

    for (var i = 0, l = segments.length; i < l; i++) {
      var segment = segments[i];

      if (segment instanceof EpsilonSegment) {
        continue;
      }

      var segmentValue = segment.generate(routeParams, consumed);
      if (segmentValue === null || segmentValue === undefined) {
        if (!segment.optional) {
          throw new Error('A value is required for route parameter \'' + segment.name + '\' in route \'' + nameOrRoute + '\'.');
        }
      } else {
        output += '/';
        output += segmentValue;
      }
    }

    if (output.charAt(0) !== '/') {
      output = '/' + output;
    }

    for (var param in consumed) {
      delete routeParams[param];
    }

    var queryString = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_path__["buildQueryString"])(routeParams);
    output += queryString ? '?' + queryString : '';

    return output;
  };

  RouteRecognizer.prototype.recognize = function recognize(path) {
    var states = [this.rootState];
    var queryParams = {};
    var isSlashDropped = false;
    var normalizedPath = path;

    var queryStart = normalizedPath.indexOf('?');
    if (queryStart !== -1) {
      var queryString = normalizedPath.substr(queryStart + 1, normalizedPath.length);
      normalizedPath = normalizedPath.substr(0, queryStart);
      queryParams = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_path__["parseQueryString"])(queryString);
    }

    normalizedPath = decodeURI(normalizedPath);

    if (normalizedPath.charAt(0) !== '/') {
      normalizedPath = '/' + normalizedPath;
    }

    var pathLen = normalizedPath.length;
    if (pathLen > 1 && normalizedPath.charAt(pathLen - 1) === '/') {
      normalizedPath = normalizedPath.substr(0, pathLen - 1);
      isSlashDropped = true;
    }

    for (var i = 0, l = normalizedPath.length; i < l; i++) {
      states = recognizeChar(states, normalizedPath.charAt(i));
      if (!states.length) {
        break;
      }
    }

    var solutions = [];
    for (var _i4 = 0, _l = states.length; _i4 < _l; _i4++) {
      if (states[_i4].handlers) {
        solutions.push(states[_i4]);
      }
    }

    states = sortSolutions(solutions);

    var state = solutions[0];
    if (state && state.handlers) {
      if (isSlashDropped && state.regex.source.slice(-5) === '(.+)$') {
        normalizedPath = normalizedPath + '/';
      }

      return findHandler(state, normalizedPath, queryParams);
    }
  };

  return RouteRecognizer;
}();

var RecognizeResults = function RecognizeResults(queryParams) {
  

  this.splice = Array.prototype.splice;
  this.slice = Array.prototype.slice;
  this.push = Array.prototype.push;
  this.length = 0;
  this.queryParams = queryParams || {};
};

function parse(route, names, types, caseSensitive) {
  var normalizedRoute = route;
  if (route.charAt(0) === '/') {
    normalizedRoute = route.substr(1);
  }

  var results = [];

  var splitRoute = normalizedRoute.split('/');
  for (var i = 0, ii = splitRoute.length; i < ii; ++i) {
    var segment = splitRoute[i];

    var match = segment.match(/^:([^?]+)(\?)?$/);
    if (match) {
      var _match = match,
          _name = _match[1],
          optional = _match[2];

      if (_name.indexOf('=') !== -1) {
        throw new Error('Parameter ' + _name + ' in route ' + route + ' has a default value, which is not supported.');
      }
      results.push(new DynamicSegment(_name, !!optional));
      names.push(_name);
      types.dynamics++;
      continue;
    }

    match = segment.match(/^\*(.+)$/);
    if (match) {
      results.push(new StarSegment(match[1]));
      names.push(match[1]);
      types.stars++;
    } else if (segment === '') {
      results.push(new EpsilonSegment());
    } else {
      results.push(new StaticSegment(segment, caseSensitive));
      types.statics++;
    }
  }

  return results;
}

function sortSolutions(states) {
  return states.sort(function (a, b) {
    if (a.types.stars !== b.types.stars) {
      return a.types.stars - b.types.stars;
    }

    if (a.types.stars) {
      if (a.types.statics !== b.types.statics) {
        return b.types.statics - a.types.statics;
      }
      if (a.types.dynamics !== b.types.dynamics) {
        return b.types.dynamics - a.types.dynamics;
      }
    }

    if (a.types.dynamics !== b.types.dynamics) {
      return a.types.dynamics - b.types.dynamics;
    }

    if (a.types.statics !== b.types.statics) {
      return b.types.statics - a.types.statics;
    }

    return 0;
  });
}

function recognizeChar(states, ch) {
  var nextStates = [];

  for (var i = 0, l = states.length; i < l; i++) {
    var state = states[i];
    nextStates.push.apply(nextStates, state.match(ch));
  }

  return nextStates;
}

function findHandler(state, path, queryParams) {
  var handlers = state.handlers;
  var regex = state.regex;
  var captures = path.match(regex);
  var currentCapture = 1;
  var result = new RecognizeResults(queryParams);

  for (var i = 0, l = handlers.length; i < l; i++) {
    var _handler = handlers[i];
    var _names = _handler.names;
    var _params = {};

    for (var j = 0, m = _names.length; j < m; j++) {
      _params[_names[j]] = captures[currentCapture++];
    }

    result.push({ handler: _handler.handler, params: _params, isDynamic: !!_names.length });
  }

  return result;
}

function addSegment(currentState, segment) {
  var firstState = currentState.put({ validChars: '/' });
  var nextState = firstState;
  segment.eachChar(function (ch) {
    nextState = nextState.put(ch);
  });

  return [firstState, nextState];
}

/***/ },

/***/ "aurelia-router":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_logging__ = __webpack_require__(70);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_history__ = __webpack_require__(213);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__ = __webpack_require__("aurelia-route-recognizer");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_event_aggregator__ = __webpack_require__("aurelia-event-aggregator");
/* harmony export (binding) */ __webpack_require__.d(exports, "ActivateNextStep", function() { return ActivateNextStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AppRouter", function() { return AppRouter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BuildNavigationPlanStep", function() { return BuildNavigationPlanStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CanActivateNextStep", function() { return CanActivateNextStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CanDeactivatePreviousStep", function() { return CanDeactivatePreviousStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "CommitChangesStep", function() { return CommitChangesStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DeactivatePreviousStep", function() { return DeactivatePreviousStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LoadRouteStep", function() { return LoadRouteStep; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NavModel", function() { return NavModel; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NavigationInstruction", function() { return NavigationInstruction; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Pipeline", function() { return Pipeline; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineProvider", function() { return PipelineProvider; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineSlotName", function() { return PipelineSlotName; });
/* harmony export (binding) */ __webpack_require__.d(exports, "PipelineStatus", function() { return PipelineStatus; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Redirect", function() { return Redirect; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RedirectToRoute", function() { return RedirectToRoute; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteLoader", function() { return RouteLoader; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Router", function() { return Router; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterConfiguration", function() { return RouterConfiguration; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterEvent", function() { return RouterEvent; });
/* harmony export (binding) */ __webpack_require__.d(exports, "activationStrategy", function() { return activationStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "isNavigationCommand", function() { return isNavigationCommand; });






/**
 * Class used to represent an instruction during a navigation.
 */
class NavigationInstruction {
    constructor(init) {
        /**
         * Current built viewport plan of this nav instruction
         */
        this.plan = null;
        this.options = {};
        Object.assign(this, init);
        this.params = this.params || {};
        this.viewPortInstructions = {};
        let ancestorParams = [];
        let current = this;
        do {
            let currentParams = Object.assign({}, current.params);
            if (current.config && current.config.hasChildRouter) {
                // remove the param for the injected child route segment
                delete currentParams[current.getWildCardName()];
            }
            ancestorParams.unshift(currentParams);
            current = current.parentInstruction;
        } while (current);
        let allParams = Object.assign({}, this.queryParams, ...ancestorParams);
        this.lifecycleArgs = [allParams, this.config, this];
    }
    /**
     * Gets an array containing this instruction and all child instructions for the current navigation.
     */
    getAllInstructions() {
        let instructions = [this];
        let viewPortInstructions = this.viewPortInstructions;
        for (let key in viewPortInstructions) {
            let childInstruction = viewPortInstructions[key].childNavigationInstruction;
            if (childInstruction) {
                instructions.push(...childInstruction.getAllInstructions());
            }
        }
        return instructions;
    }
    /**
     * Gets an array containing the instruction and all child instructions for the previous navigation.
     * Previous instructions are no longer available after navigation completes.
     */
    getAllPreviousInstructions() {
        return this.getAllInstructions().map(c => c.previousInstruction).filter(c => c);
    }
    addViewPortInstruction(nameOrInitOptions, strategy, moduleId, component) {
        let viewPortInstruction;
        let viewPortName = typeof nameOrInitOptions === 'string' ? nameOrInitOptions : nameOrInitOptions.name;
        const lifecycleArgs = this.lifecycleArgs;
        const config = Object.assign({}, lifecycleArgs[1], { currentViewPort: viewPortName });
        if (typeof nameOrInitOptions === 'string') {
            viewPortInstruction = {
                name: nameOrInitOptions,
                strategy: strategy,
                moduleId: moduleId,
                component: component,
                childRouter: component.childRouter,
                lifecycleArgs: [lifecycleArgs[0], config, lifecycleArgs[2]]
            };
        }
        else {
            viewPortInstruction = {
                name: viewPortName,
                strategy: nameOrInitOptions.strategy,
                component: nameOrInitOptions.component,
                moduleId: nameOrInitOptions.moduleId,
                childRouter: nameOrInitOptions.component.childRouter,
                lifecycleArgs: [lifecycleArgs[0], config, lifecycleArgs[2]]
            };
        }
        return this.viewPortInstructions[viewPortName] = viewPortInstruction;
    }
    /**
     * Gets the name of the route pattern's wildcard parameter, if applicable.
     */
    getWildCardName() {
        // todo: potential issue, or at least unsafe typings
        let configRoute = this.config.route;
        let wildcardIndex = configRoute.lastIndexOf('*');
        return configRoute.substr(wildcardIndex + 1);
    }
    /**
     * Gets the path and query string created by filling the route
     * pattern's wildcard parameter with the matching param.
     */
    getWildcardPath() {
        let wildcardName = this.getWildCardName();
        let path = this.params[wildcardName] || '';
        let queryString = this.queryString;
        if (queryString) {
            path += '?' + queryString;
        }
        return path;
    }
    /**
     * Gets the instruction's base URL, accounting for wildcard route parameters.
     */
    getBaseUrl() {
        let $encodeURI = encodeURI;
        let fragment = decodeURI(this.fragment);
        if (fragment === '') {
            let nonEmptyRoute = this.router.routes.find(route => {
                return route.name === this.config.name &&
                    route.route !== '';
            });
            if (nonEmptyRoute) {
                fragment = nonEmptyRoute.route;
            }
        }
        if (!this.params) {
            return $encodeURI(fragment);
        }
        let wildcardName = this.getWildCardName();
        let path = this.params[wildcardName] || '';
        if (!path) {
            return $encodeURI(fragment);
        }
        return $encodeURI(fragment.substr(0, fragment.lastIndexOf(path)));
    }
    /**
     * Finalize a viewport instruction
     * @internal
     */
    _commitChanges(waitToSwap) {
        let router = this.router;
        router.currentInstruction = this;
        const previousInstruction = this.previousInstruction;
        if (previousInstruction) {
            previousInstruction.config.navModel.isActive = false;
        }
        this.config.navModel.isActive = true;
        router.refreshNavigation();
        let loads = [];
        let delaySwaps = [];
        let viewPortInstructions = this.viewPortInstructions;
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let viewPort = router.viewPorts[viewPortName];
            if (!viewPort) {
                throw new Error(`There was no router-view found in the view for ${viewPortInstruction.moduleId}.`);
            }
            let childNavInstruction = viewPortInstruction.childNavigationInstruction;
            if (viewPortInstruction.strategy === "replace" /* Replace */) {
                if (childNavInstruction && childNavInstruction.parentCatchHandler) {
                    loads.push(childNavInstruction._commitChanges(waitToSwap));
                }
                else {
                    if (waitToSwap) {
                        delaySwaps.push({ viewPort, viewPortInstruction });
                    }
                    loads.push(viewPort
                        .process(viewPortInstruction, waitToSwap)
                        .then(() => childNavInstruction
                        ? childNavInstruction._commitChanges(waitToSwap)
                        : Promise.resolve()));
                }
            }
            else {
                if (childNavInstruction) {
                    loads.push(childNavInstruction._commitChanges(waitToSwap));
                }
            }
        }
        return Promise
            .all(loads)
            .then(() => {
            delaySwaps.forEach(x => x.viewPort.swap(x.viewPortInstruction));
            return null;
        })
            .then(() => prune(this));
    }
    /**@internal */
    _updateTitle() {
        let router = this.router;
        let title = this._buildTitle(router.titleSeparator);
        if (title) {
            router.history.setTitle(title);
        }
    }
    /**@internal */
    _buildTitle(separator = ' | ') {
        let title = '';
        let childTitles = [];
        let navModelTitle = this.config.navModel.title;
        let instructionRouter = this.router;
        let viewPortInstructions = this.viewPortInstructions;
        if (navModelTitle) {
            title = instructionRouter.transformTitle(navModelTitle);
        }
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let child_nav_instruction = viewPortInstruction.childNavigationInstruction;
            if (child_nav_instruction) {
                let childTitle = child_nav_instruction._buildTitle(separator);
                if (childTitle) {
                    childTitles.push(childTitle);
                }
            }
        }
        if (childTitles.length) {
            title = childTitles.join(separator) + (title ? separator : '') + title;
        }
        if (instructionRouter.title) {
            title += (title ? separator : '') + instructionRouter.transformTitle(instructionRouter.title);
        }
        return title;
    }
}
const prune = (instruction) => {
    instruction.previousInstruction = null;
    instruction.plan = null;
};

/**
* Class for storing and interacting with a route's navigation settings.
*/
class NavModel {
    constructor(router, relativeHref) {
        /**
        * True if this nav item is currently active.
        */
        this.isActive = false;
        /**
        * The title.
        */
        this.title = null;
        /**
        * This nav item's absolute href.
        */
        this.href = null;
        /**
        * This nav item's relative href.
        */
        this.relativeHref = null;
        /**
        * Data attached to the route at configuration time.
        */
        this.settings = {};
        /**
        * The route config.
        */
        this.config = null;
        this.router = router;
        this.relativeHref = relativeHref;
    }
    /**
    * Sets the route's title and updates document.title.
    *  If the a navigation is in progress, the change will be applied
    *  to document.title when the navigation completes.
    *
    * @param title The new title.
    */
    setTitle(title) {
        this.title = title;
        if (this.isActive) {
            this.router.updateTitle();
        }
    }
}

function _normalizeAbsolutePath(path, hasPushState, absolute = false) {
    if (!hasPushState && path[0] !== '#') {
        path = '#' + path;
    }
    if (hasPushState && absolute) {
        path = path.substring(1, path.length);
    }
    return path;
}
function _createRootedPath(fragment, baseUrl, hasPushState, absolute) {
    if (isAbsoluteUrl.test(fragment)) {
        return fragment;
    }
    let path = '';
    if (baseUrl.length && baseUrl[0] !== '/') {
        path += '/';
    }
    path += baseUrl;
    if ((!path.length || path[path.length - 1] !== '/') && fragment[0] !== '/') {
        path += '/';
    }
    if (path.length && path[path.length - 1] === '/' && fragment[0] === '/') {
        path = path.substring(0, path.length - 1);
    }
    return _normalizeAbsolutePath(path + fragment, hasPushState, absolute);
}
function _resolveUrl(fragment, baseUrl, hasPushState) {
    if (isRootedPath.test(fragment)) {
        return _normalizeAbsolutePath(fragment, hasPushState);
    }
    return _createRootedPath(fragment, baseUrl, hasPushState);
}
function _ensureArrayWithSingleRoutePerConfig(config) {
    let routeConfigs = [];
    if (Array.isArray(config.route)) {
        for (let i = 0, ii = config.route.length; i < ii; ++i) {
            let current = Object.assign({}, config);
            current.route = config.route[i];
            routeConfigs.push(current);
        }
    }
    else {
        routeConfigs.push(Object.assign({}, config));
    }
    return routeConfigs;
}
const isRootedPath = /^#?\//;
const isAbsoluteUrl = /^([a-z][a-z0-9+\-.]*:)?\/\//i;

/**
 * Class used to configure a [[Router]] instance.
 *
 * @constructor
 */
class RouterConfiguration {
    constructor() {
        this.instructions = [];
        this.options = {};
        this.pipelineSteps = [];
    }
    /**
     * Adds a step to be run during the [[Router]]'s navigation pipeline.
     *
     * @param name The name of the pipeline slot to insert the step into.
     * @param step The pipeline step.
     * @chainable
     */
    addPipelineStep(name, step) {
        if (step === null || step === undefined) {
            throw new Error('Pipeline step cannot be null or undefined.');
        }
        this.pipelineSteps.push({ name, step });
        return this;
    }
    /**
     * Adds a step to be run during the [[Router]]'s authorize pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addAuthorizeStep(step) {
        return this.addPipelineStep("authorize" /* Authorize */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s preActivate pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPreActivateStep(step) {
        return this.addPipelineStep("preActivate" /* PreActivate */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s preRender pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPreRenderStep(step) {
        return this.addPipelineStep("preRender" /* PreRender */, step);
    }
    /**
     * Adds a step to be run during the [[Router]]'s postRender pipeline slot.
     *
     * @param step The pipeline step.
     * @chainable
     */
    addPostRenderStep(step) {
        return this.addPipelineStep("postRender" /* PostRender */, step);
    }
    /**
     * Configures a route that will be used if there is no previous location available on navigation cancellation.
     *
     * @param fragment The URL fragment to use as the navigation destination.
     * @chainable
     */
    fallbackRoute(fragment) {
        this._fallbackRoute = fragment;
        return this;
    }
    /**
     * Maps one or more routes to be registered with the router.
     *
     * @param route The [[RouteConfig]] to map, or an array of [[RouteConfig]] to map.
     * @chainable
     */
    map(route) {
        if (Array.isArray(route)) {
            route.forEach(r => this.map(r));
            return this;
        }
        return this.mapRoute(route);
    }
    /**
     * Configures defaults to use for any view ports.
     *
     * @param viewPortConfig a view port configuration object to use as a
     *  default, of the form { viewPortName: { moduleId } }.
     * @chainable
     */
    useViewPortDefaults(viewPortConfig) {
        this.viewPortDefaults = viewPortConfig;
        return this;
    }
    /**
     * Maps a single route to be registered with the router.
     *
     * @param route The [[RouteConfig]] to map.
     * @chainable
     */
    mapRoute(config) {
        this.instructions.push(router => {
            let routeConfigs = _ensureArrayWithSingleRoutePerConfig(config);
            let navModel;
            for (let i = 0, ii = routeConfigs.length; i < ii; ++i) {
                let routeConfig = routeConfigs[i];
                routeConfig.settings = routeConfig.settings || {};
                if (!navModel) {
                    navModel = router.createNavModel(routeConfig);
                }
                router.addRoute(routeConfig, navModel);
            }
        });
        return this;
    }
    /**
     * Registers an unknown route handler to be run when the URL fragment doesn't match any registered routes.
     *
     * @param config A string containing a moduleId to load, or a [[RouteConfig]], or a function that takes the
     *  [[NavigationInstruction]] and selects a moduleId to load.
     * @chainable
     */
    mapUnknownRoutes(config) {
        this.unknownRouteConfig = config;
        return this;
    }
    /**
     * Applies the current configuration to the specified [[Router]].
     *
     * @param router The [[Router]] to apply the configuration to.
     */
    exportToRouter(router) {
        let instructions = this.instructions;
        for (let i = 0, ii = instructions.length; i < ii; ++i) {
            instructions[i](router);
        }
        let { title, titleSeparator, unknownRouteConfig, _fallbackRoute, viewPortDefaults } = this;
        if (title) {
            router.title = title;
        }
        if (titleSeparator) {
            router.titleSeparator = titleSeparator;
        }
        if (unknownRouteConfig) {
            router.handleUnknownRoutes(unknownRouteConfig);
        }
        if (_fallbackRoute) {
            router.fallbackRoute = _fallbackRoute;
        }
        if (viewPortDefaults) {
            router.useViewPortDefaults(viewPortDefaults);
        }
        Object.assign(router.options, this.options);
        let pipelineSteps = this.pipelineSteps;
        let pipelineStepCount = pipelineSteps.length;
        if (pipelineStepCount) {
            if (!router.isRoot) {
                throw new Error('Pipeline steps can only be added to the root router');
            }
            let pipelineProvider = router.pipelineProvider;
            for (let i = 0, ii = pipelineStepCount; i < ii; ++i) {
                let { name, step } = pipelineSteps[i];
                pipelineProvider.addStep(name, step);
            }
        }
    }
}

/**
 * The primary class responsible for handling routing and navigation.
 */
class Router {
    /**
     * @param container The [[Container]] to use when child routers.
     * @param history The [[History]] implementation to delegate navigation requests to.
     */
    constructor(container, history) {
        /**
         * The parent router, or null if this instance is not a child router.
         */
        this.parent = null;
        this.options = {};
        /**
         * The defaults used when a viewport lacks specified content
         */
        this.viewPortDefaults = {};
        /**
         * Extension point to transform the document title before it is built and displayed.
         * By default, child routers delegate to the parent router, and the app router
         * returns the title unchanged.
         */
        this.transformTitle = (title) => {
            if (this.parent) {
                return this.parent.transformTitle(title);
            }
            return title;
        };
        this.container = container;
        this.history = history;
        this.reset();
    }
    /**
     * Fully resets the router's internal state. Primarily used internally by the framework when multiple calls to setRoot are made.
     * Use with caution (actually, avoid using this). Do not use this to simply change your navigation model.
     */
    reset() {
        this.viewPorts = {};
        this.routes = [];
        this.baseUrl = '';
        this.isConfigured = false;
        this.isNavigating = false;
        this.isExplicitNavigation = false;
        this.isExplicitNavigationBack = false;
        this.isNavigatingFirst = false;
        this.isNavigatingNew = false;
        this.isNavigatingRefresh = false;
        this.isNavigatingForward = false;
        this.isNavigatingBack = false;
        this.couldDeactivate = false;
        this.navigation = [];
        this.currentInstruction = null;
        this.viewPortDefaults = {};
        this._fallbackOrder = 100;
        this._recognizer = new __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__["RouteRecognizer"]();
        this._childRecognizer = new __WEBPACK_IMPORTED_MODULE_3_aurelia_route_recognizer__["RouteRecognizer"]();
        this._configuredPromise = new Promise(resolve => {
            this._resolveConfiguredPromise = resolve;
        });
    }
    /**
     * Gets a value indicating whether or not this [[Router]] is the root in the router tree. I.e., it has no parent.
     */
    get isRoot() {
        return !this.parent;
    }
    /**
     * Registers a viewPort to be used as a rendering target for activated routes.
     *
     * @param viewPort The viewPort.
     * @param name The name of the viewPort. 'default' if unspecified.
     */
    registerViewPort(viewPort, name) {
        name = name || 'default';
        this.viewPorts[name] = viewPort;
    }
    /**
     * Returns a Promise that resolves when the router is configured.
     */
    ensureConfigured() {
        return this._configuredPromise;
    }
    /**
     * Configures the router.
     *
     * @param callbackOrConfig The [[RouterConfiguration]] or a callback that takes a [[RouterConfiguration]].
     */
    configure(callbackOrConfig) {
        this.isConfigured = true;
        let result = callbackOrConfig;
        let config;
        if (typeof callbackOrConfig === 'function') {
            config = new RouterConfiguration();
            result = callbackOrConfig(config);
        }
        return Promise
            .resolve(result)
            .then((c) => {
            if (c && c.exportToRouter) {
                config = c;
            }
            config.exportToRouter(this);
            this.isConfigured = true;
            this._resolveConfiguredPromise();
        });
    }
    /**
     * Navigates to a new location.
     *
     * @param fragment The URL fragment to use as the navigation destination.
     * @param options The navigation options.
     */
    navigate(fragment, options) {
        if (!this.isConfigured && this.parent) {
            return this.parent.navigate(fragment, options);
        }
        this.isExplicitNavigation = true;
        return this.history.navigate(_resolveUrl(fragment, this.baseUrl, this.history._hasPushState), options);
    }
    /**
     * Navigates to a new location corresponding to the route and params specified. Equivallent to [[Router.generate]] followed
     * by [[Router.navigate]].
     *
     * @param route The name of the route to use when generating the navigation location.
     * @param params The route parameters to be used when populating the route pattern.
     * @param options The navigation options.
     */
    navigateToRoute(route, params, options) {
        let path = this.generate(route, params);
        return this.navigate(path, options);
    }
    /**
     * Navigates back to the most recent location in history.
     */
    navigateBack() {
        this.isExplicitNavigationBack = true;
        this.history.navigateBack();
    }
    /**
     * Creates a child router of the current router.
     *
     * @param container The [[Container]] to provide to the child router. Uses the current [[Router]]'s [[Container]] if unspecified.
     * @returns {Router} The new child Router.
     */
    createChild(container) {
        let childRouter = new Router(container || this.container.createChild(), this.history);
        childRouter.parent = this;
        return childRouter;
    }
    /**
     * Generates a URL fragment matching the specified route pattern.
     *
     * @param name The name of the route whose pattern should be used to generate the fragment.
     * @param params The route params to be used to populate the route pattern.
     * @param options If options.absolute = true, then absolute url will be generated; otherwise, it will be relative url.
     * @returns {string} A string containing the generated URL fragment.
     */
    generate(nameOrRoute, params = {}, options = {}) {
        // A child recognizer generates routes for potential child routes. Any potential child route is added
        // to the childRoute property of params for the childRouter to recognize. When generating routes, we
        // use the childRecognizer when childRoute params are available to generate a child router enabled route.
        let recognizer = 'childRoute' in params ? this._childRecognizer : this._recognizer;
        let hasRoute = recognizer.hasRoute(nameOrRoute);
        if (!hasRoute) {
            if (this.parent) {
                return this.parent.generate(nameOrRoute, params, options);
            }
            throw new Error(`A route with name '${nameOrRoute}' could not be found. Check that \`name: '${nameOrRoute}'\` was specified in the route's config.`);
        }
        let path = recognizer.generate(nameOrRoute, params);
        let rootedPath = _createRootedPath(path, this.baseUrl, this.history._hasPushState, options.absolute);
        return options.absolute ? `${this.history.getAbsoluteRoot()}${rootedPath}` : rootedPath;
    }
    /**
     * Creates a [[NavModel]] for the specified route config.
     *
     * @param config The route config.
     */
    createNavModel(config) {
        let navModel = new NavModel(this, 'href' in config
            ? config.href
            // potential error when config.route is a string[] ?
            : config.route);
        navModel.title = config.title;
        navModel.order = config.nav;
        navModel.href = config.href;
        navModel.settings = config.settings;
        navModel.config = config;
        return navModel;
    }
    /**
     * Registers a new route with the router.
     *
     * @param config The [[RouteConfig]].
     * @param navModel The [[NavModel]] to use for the route. May be omitted for single-pattern routes.
     */
    addRoute(config, navModel) {
        if (Array.isArray(config.route)) {
            let routeConfigs = _ensureArrayWithSingleRoutePerConfig(config);
            // the following is wrong. todo: fix this after TS refactoring release
            routeConfigs.forEach(this.addRoute.bind(this));
            return;
        }
        validateRouteConfig(config);
        if (!('viewPorts' in config) && !config.navigationStrategy) {
            config.viewPorts = {
                'default': {
                    moduleId: config.moduleId,
                    view: config.view
                }
            };
        }
        if (!navModel) {
            navModel = this.createNavModel(config);
        }
        this.routes.push(config);
        let path = config.route;
        if (path.charAt(0) === '/') {
            path = path.substr(1);
        }
        let caseSensitive = config.caseSensitive === true;
        let state = this._recognizer.add({
            path: path,
            handler: config,
            caseSensitive: caseSensitive
        });
        if (path) {
            let settings = config.settings;
            delete config.settings;
            let withChild = JSON.parse(JSON.stringify(config));
            config.settings = settings;
            withChild.route = `${path}/*childRoute`;
            withChild.hasChildRouter = true;
            this._childRecognizer.add({
                path: withChild.route,
                handler: withChild,
                caseSensitive: caseSensitive
            });
            withChild.navModel = navModel;
            withChild.settings = config.settings;
            withChild.navigationStrategy = config.navigationStrategy;
        }
        config.navModel = navModel;
        let navigation = this.navigation;
        if ((navModel.order || navModel.order === 0) && navigation.indexOf(navModel) === -1) {
            if ((!navModel.href && navModel.href !== '') && (state.types.dynamics || state.types.stars)) {
                throw new Error('Invalid route config for "' + config.route + '" : dynamic routes must specify an "href:" to be included in the navigation model.');
            }
            if (typeof navModel.order !== 'number') {
                navModel.order = ++this._fallbackOrder;
            }
            navigation.push(navModel);
            // this is a potential error / inconsistency between browsers
            //
            // MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort
            // If compareFunction(a, b) returns 0, leave a and b unchanged with respect to each other,
            // but sorted with respect to all different elements.
            // Note: the ECMAscript standard does not guarantee this behaviour,
            // and thus not all browsers (e.g. Mozilla versions dating back to at least 2003) respect this.
            navigation.sort((a, b) => a.order - b.order);
        }
    }
    /**
     * Gets a value indicating whether or not this [[Router]] or one of its ancestors has a route registered with the specified name.
     *
     * @param name The name of the route to check.
     */
    hasRoute(name) {
        return !!(this._recognizer.hasRoute(name) || this.parent && this.parent.hasRoute(name));
    }
    /**
     * Gets a value indicating whether or not this [[Router]] has a route registered with the specified name.
     *
     * @param name The name of the route to check.
     */
    hasOwnRoute(name) {
        return this._recognizer.hasRoute(name);
    }
    /**
     * Register a handler to use when the incoming URL fragment doesn't match any registered routes.
     *
     * @param config The moduleId, or a function that selects the moduleId, or a [[RouteConfig]].
     */
    handleUnknownRoutes(config) {
        if (!config) {
            throw new Error('Invalid unknown route handler');
        }
        this.catchAllHandler = instruction => {
            return this
                ._createRouteConfig(config, instruction)
                .then(c => {
                instruction.config = c;
                return instruction;
            });
        };
    }
    /**
     * Updates the document title using the current navigation instruction.
     */
    updateTitle() {
        let parentRouter = this.parent;
        if (parentRouter) {
            return parentRouter.updateTitle();
        }
        let currentInstruction = this.currentInstruction;
        if (currentInstruction) {
            currentInstruction._updateTitle();
        }
        return undefined;
    }
    /**
     * Updates the navigation routes with hrefs relative to the current location.
     * Note: This method will likely move to a plugin in a future release.
     */
    refreshNavigation() {
        let nav = this.navigation;
        for (let i = 0, length = nav.length; i < length; i++) {
            let current = nav[i];
            if (!current.config.href) {
                current.href = _createRootedPath(current.relativeHref, this.baseUrl, this.history._hasPushState);
            }
            else {
                current.href = _normalizeAbsolutePath(current.config.href, this.history._hasPushState);
            }
        }
    }
    /**
     * Sets the default configuration for the view ports. This specifies how to
     *  populate a view port for which no module is specified. The default is
     *  an empty view/view-model pair.
     */
    useViewPortDefaults($viewPortDefaults) {
        // a workaround to have strong typings while not requiring to expose interface ViewPortInstruction
        let viewPortDefaults = $viewPortDefaults;
        for (let viewPortName in viewPortDefaults) {
            let viewPortConfig = viewPortDefaults[viewPortName];
            this.viewPortDefaults[viewPortName] = {
                moduleId: viewPortConfig.moduleId
            };
        }
    }
    /**@internal */
    _refreshBaseUrl() {
        let parentRouter = this.parent;
        if (parentRouter) {
            this.baseUrl = generateBaseUrl(parentRouter, parentRouter.currentInstruction);
        }
    }
    /**@internal */
    _createNavigationInstruction(url = '', parentInstruction = null) {
        let fragment = url;
        let queryString = '';
        let queryIndex = url.indexOf('?');
        if (queryIndex !== -1) {
            fragment = url.substr(0, queryIndex);
            queryString = url.substr(queryIndex + 1);
        }
        let urlRecognizationResults = this._recognizer.recognize(url);
        if (!urlRecognizationResults || !urlRecognizationResults.length) {
            urlRecognizationResults = this._childRecognizer.recognize(url);
        }
        let instructionInit = {
            fragment,
            queryString,
            config: null,
            parentInstruction,
            previousInstruction: this.currentInstruction,
            router: this,
            options: {
                compareQueryParams: this.options.compareQueryParams
            }
        };
        let result;
        if (urlRecognizationResults && urlRecognizationResults.length) {
            let first = urlRecognizationResults[0];
            let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                params: first.params,
                queryParams: first.queryParams || urlRecognizationResults.queryParams,
                config: first.config || first.handler
            }));
            if (typeof first.handler === 'function') {
                result = evaluateNavigationStrategy(instruction, first.handler, first);
            }
            else if (first.handler && typeof first.handler.navigationStrategy === 'function') {
                result = evaluateNavigationStrategy(instruction, first.handler.navigationStrategy, first.handler);
            }
            else {
                result = Promise.resolve(instruction);
            }
        }
        else if (this.catchAllHandler) {
            let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                params: { path: fragment },
                queryParams: urlRecognizationResults ? urlRecognizationResults.queryParams : {},
                config: null // config will be created by the catchAllHandler
            }));
            result = evaluateNavigationStrategy(instruction, this.catchAllHandler);
        }
        else if (this.parent) {
            let router = this._parentCatchAllHandler(this.parent);
            if (router) {
                let newParentInstruction = this._findParentInstructionFromRouter(router, parentInstruction);
                let instruction = new NavigationInstruction(Object.assign({}, instructionInit, {
                    params: { path: fragment },
                    queryParams: urlRecognizationResults ? urlRecognizationResults.queryParams : {},
                    router: router,
                    parentInstruction: newParentInstruction,
                    parentCatchHandler: true,
                    config: null // config will be created by the chained parent catchAllHandler
                }));
                result = evaluateNavigationStrategy(instruction, router.catchAllHandler);
            }
        }
        if (result && parentInstruction) {
            this.baseUrl = generateBaseUrl(this.parent, parentInstruction);
        }
        return result || Promise.reject(new Error(`Route not found: ${url}`));
    }
    /**@internal */
    _findParentInstructionFromRouter(router, instruction) {
        if (instruction.router === router) {
            instruction.fragment = router.baseUrl; // need to change the fragment in case of a redirect instead of moduleId
            return instruction;
        }
        else if (instruction.parentInstruction) {
            return this._findParentInstructionFromRouter(router, instruction.parentInstruction);
        }
        return undefined;
    }
    /**@internal */
    _parentCatchAllHandler(router) {
        if (router.catchAllHandler) {
            return router;
        }
        else if (router.parent) {
            return this._parentCatchAllHandler(router.parent);
        }
        return false;
    }
    /**
     * @internal
     */
    _createRouteConfig(config, instruction) {
        return Promise
            .resolve(config)
            .then((c) => {
            if (typeof c === 'string') {
                return { moduleId: c };
            }
            else if (typeof c === 'function') {
                return c(instruction);
            }
            return c;
        })
            // typing here could be either RouteConfig or RedirectConfig
            // but temporarily treat both as RouteConfig
            // todo: improve typings precision
            .then((c) => typeof c === 'string' ? { moduleId: c } : c)
            .then((c) => {
            c.route = instruction.params.path;
            validateRouteConfig(c);
            if (!c.navModel) {
                c.navModel = this.createNavModel(c);
            }
            return c;
        });
    }
}
/* @internal exported for unit testing */
const generateBaseUrl = (router, instruction) => {
    return `${router.baseUrl || ''}${instruction.getBaseUrl() || ''}`;
};
/* @internal exported for unit testing */
const validateRouteConfig = (config) => {
    if (typeof config !== 'object') {
        throw new Error('Invalid Route Config');
    }
    if (typeof config.route !== 'string') {
        let name = config.name || '(no name)';
        throw new Error('Invalid Route Config for "' + name + '": You must specify a "route:" pattern.');
    }
    if (!('redirect' in config || config.moduleId || config.navigationStrategy || config.viewPorts)) {
        throw new Error('Invalid Route Config for "' + config.route + '": You must specify a "moduleId:", "redirect:", "navigationStrategy:", or "viewPorts:".');
    }
};
/* @internal exported for unit testing */
const evaluateNavigationStrategy = (instruction, evaluator, context) => {
    return Promise
        .resolve(evaluator.call(context, instruction))
        .then(() => {
        if (!('viewPorts' in instruction.config)) {
            instruction.config.viewPorts = {
                'default': {
                    moduleId: instruction.config.moduleId
                }
            };
        }
        return instruction;
    });
};

/**@internal exported for unit testing */
const createNextFn = (instruction, steps) => {
    let index = -1;
    const next = function () {
        index++;
        if (index < steps.length) {
            let currentStep = steps[index];
            try {
                return currentStep(instruction, next);
            }
            catch (e) {
                return next.reject(e);
            }
        }
        else {
            return next.complete();
        }
    };
    next.complete = createCompletionHandler(next, "completed" /* Completed */);
    next.cancel = createCompletionHandler(next, "canceled" /* Canceled */);
    next.reject = createCompletionHandler(next, "rejected" /* Rejected */);
    return next;
};
/**@internal exported for unit testing */
const createCompletionHandler = (next, status) => {
    return (output) => Promise
        .resolve({
        status,
        output,
        completed: status === "completed" /* Completed */
    });
};

/**
 * The class responsible for managing and processing the navigation pipeline.
 */
class Pipeline {
    constructor() {
        /**
         * The pipeline steps. And steps added via addStep will be converted to a function
         * The actualy running functions with correct step contexts of this pipeline
         */
        this.steps = [];
    }
    /**
     * Adds a step to the pipeline.
     *
     * @param step The pipeline step.
     */
    addStep(step) {
        let run;
        if (typeof step === 'function') {
            run = step;
        }
        else if (typeof step.getSteps === 'function') {
            // getSteps is to enable support open slots
            // where devs can add multiple steps into the same slot name
            let steps = step.getSteps();
            for (let i = 0, l = steps.length; i < l; i++) {
                this.addStep(steps[i]);
            }
            return this;
        }
        else {
            run = step.run.bind(step);
        }
        this.steps.push(run);
        return this;
    }
    /**
     * Runs the pipeline.
     *
     * @param instruction The navigation instruction to process.
     */
    run(instruction) {
        const nextFn = createNextFn(instruction, this.steps);
        return nextFn();
    }
}

/**
* Determines if the provided object is a navigation command.
* A navigation command is anything with a navigate method.
*
* @param obj The object to check.
*/
function isNavigationCommand(obj) {
    return obj && typeof obj.navigate === 'function';
}
/**
* Used during the activation lifecycle to cause a redirect.
*/
class Redirect {
    /**
     * @param url The URL fragment to use as the navigation destination.
     * @param options The navigation options.
     */
    constructor(url, options = {}) {
        this.url = url;
        this.options = Object.assign({ trigger: true, replace: true }, options);
        this.shouldContinueProcessing = false;
    }
    /**
     * Called by the activation system to set the child router.
     *
     * @param router The router.
     */
    setRouter(router) {
        this.router = router;
    }
    /**
     * Called by the navigation pipeline to navigate.
     *
     * @param appRouter The router to be redirected.
     */
    navigate(appRouter) {
        let navigatingRouter = this.options.useAppRouter ? appRouter : (this.router || appRouter);
        navigatingRouter.navigate(this.url, this.options);
    }
}
/**
 * Used during the activation lifecycle to cause a redirect to a named route.
 */
class RedirectToRoute {
    /**
     * @param route The name of the route.
     * @param params The parameters to be sent to the activation method.
     * @param options The options to use for navigation.
     */
    constructor(route, params = {}, options = {}) {
        this.route = route;
        this.params = params;
        this.options = Object.assign({ trigger: true, replace: true }, options);
        this.shouldContinueProcessing = false;
    }
    /**
     * Called by the activation system to set the child router.
     *
     * @param router The router.
     */
    setRouter(router) {
        this.router = router;
    }
    /**
     * Called by the navigation pipeline to navigate.
     *
     * @param appRouter The router to be redirected.
     */
    navigate(appRouter) {
        let navigatingRouter = this.options.useAppRouter ? appRouter : (this.router || appRouter);
        navigatingRouter.navigateToRoute(this.route, this.params, this.options);
    }
}

/**
 * @internal exported for unit testing
 */
function _buildNavigationPlan(instruction, forceLifecycleMinimum) {
    let config = instruction.config;
    if ('redirect' in config) {
        return buildRedirectPlan(instruction);
    }
    const prevInstruction = instruction.previousInstruction;
    const defaultViewPortConfigs = instruction.router.viewPortDefaults;
    if (prevInstruction) {
        return buildTransitionPlans(instruction, prevInstruction, defaultViewPortConfigs, forceLifecycleMinimum);
    }
    // first navigation, only need to prepare a few information for each viewport plan
    const viewPortPlans = {};
    let viewPortConfigs = config.viewPorts;
    for (let viewPortName in viewPortConfigs) {
        let viewPortConfig = viewPortConfigs[viewPortName];
        if (viewPortConfig.moduleId === null && viewPortName in defaultViewPortConfigs) {
            viewPortConfig = defaultViewPortConfigs[viewPortName];
        }
        viewPortPlans[viewPortName] = {
            name: viewPortName,
            strategy: "replace" /* Replace */,
            config: viewPortConfig
        };
    }
    return Promise.resolve(viewPortPlans);
}
/**
 * Build redirect plan based on config of a navigation instruction
 * @internal exported for unit testing
 */
const buildRedirectPlan = (instruction) => {
    const config = instruction.config;
    const router = instruction.router;
    return router
        ._createNavigationInstruction(config.redirect)
        .then(redirectInstruction => {
        const params = {};
        const originalInstructionParams = instruction.params;
        const redirectInstructionParams = redirectInstruction.params;
        for (let key in redirectInstructionParams) {
            // If the param on the redirect points to another param, e.g. { route: first/:this, redirect: second/:this }
            let val = redirectInstructionParams[key];
            if (typeof val === 'string' && val[0] === ':') {
                val = val.slice(1);
                // And if that param is found on the original instruction then use it
                if (val in originalInstructionParams) {
                    params[key] = originalInstructionParams[val];
                }
            }
            else {
                params[key] = redirectInstructionParams[key];
            }
        }
        let redirectLocation = router.generate(redirectInstruction.config, params, instruction.options);
        // Special handling for child routes
        for (let key in originalInstructionParams) {
            redirectLocation = redirectLocation.replace(`:${key}`, originalInstructionParams[key]);
        }
        let queryString = instruction.queryString;
        if (queryString) {
            redirectLocation += '?' + queryString;
        }
        return Promise.resolve(new Redirect(redirectLocation));
    });
};
/**
 * @param viewPortPlans the Plan record that holds information about built plans
 * @internal exported for unit testing
 */
const buildTransitionPlans = (currentInstruction, previousInstruction, defaultViewPortConfigs, forceLifecycleMinimum) => {
    let viewPortPlans = {};
    let newInstructionConfig = currentInstruction.config;
    let hasNewParams = hasDifferentParameterValues(previousInstruction, currentInstruction);
    let pending = [];
    let previousViewPortInstructions = previousInstruction.viewPortInstructions;
    for (let viewPortName in previousViewPortInstructions) {
        const prevViewPortInstruction = previousViewPortInstructions[viewPortName];
        const prevViewPortComponent = prevViewPortInstruction.component;
        const newInstructionViewPortConfigs = newInstructionConfig.viewPorts;
        // if this is invoked on a viewport without any changes, based on new url,
        // newViewPortConfig will be the existing viewport instruction
        let nextViewPortConfig = viewPortName in newInstructionViewPortConfigs
            ? newInstructionViewPortConfigs[viewPortName]
            : prevViewPortInstruction;
        if (nextViewPortConfig.moduleId === null && viewPortName in defaultViewPortConfigs) {
            nextViewPortConfig = defaultViewPortConfigs[viewPortName];
        }
        const viewPortActivationStrategy = determineActivationStrategy(currentInstruction, prevViewPortInstruction, nextViewPortConfig, hasNewParams, forceLifecycleMinimum);
        const viewPortPlan = viewPortPlans[viewPortName] = {
            name: viewPortName,
            // ViewPortInstruction can quack like a RouteConfig
            config: nextViewPortConfig,
            prevComponent: prevViewPortComponent,
            prevModuleId: prevViewPortInstruction.moduleId,
            strategy: viewPortActivationStrategy
        };
        // recursively build nav plans for all existing child routers/viewports of this viewport
        // this is possible because existing child viewports and routers already have necessary information
        // to process the wildcard path from parent instruction
        if (viewPortActivationStrategy !== "replace" /* Replace */ && prevViewPortInstruction.childRouter) {
            const path = currentInstruction.getWildcardPath();
            const task = prevViewPortInstruction
                .childRouter
                ._createNavigationInstruction(path, currentInstruction)
                .then((childInstruction) => {
                viewPortPlan.childNavigationInstruction = childInstruction;
                return _buildNavigationPlan(childInstruction, 
                // is it safe to assume viewPortPlan has not been changed from previous assignment?
                // if so, can just use local variable viewPortPlanStrategy
                // there could be user code modifying viewport plan during _createNavigationInstruction?
                viewPortPlan.strategy === "invoke-lifecycle" /* InvokeLifecycle */)
                    .then(childPlan => {
                    if (childPlan instanceof Redirect) {
                        return Promise.reject(childPlan);
                    }
                    childInstruction.plan = childPlan;
                    // for bluebird ?
                    return null;
                });
            });
            pending.push(task);
        }
    }
    return Promise.all(pending).then(() => viewPortPlans);
};
/**
 * @param newViewPortConfig if this is invoked on a viewport without any changes, based on new url, newViewPortConfig will be the existing viewport instruction
 * @internal exported for unit testing
 */
const determineActivationStrategy = (currentNavInstruction, prevViewPortInstruction, newViewPortConfig, 
// indicates whether there is difference between old and new url params
hasNewParams, forceLifecycleMinimum) => {
    let newInstructionConfig = currentNavInstruction.config;
    let prevViewPortViewModel = prevViewPortInstruction.component.viewModel;
    let viewPortPlanStrategy;
    if (prevViewPortInstruction.moduleId !== newViewPortConfig.moduleId) {
        viewPortPlanStrategy = "replace" /* Replace */;
    }
    else if ('determineActivationStrategy' in prevViewPortViewModel) {
        viewPortPlanStrategy = prevViewPortViewModel.determineActivationStrategy(...currentNavInstruction.lifecycleArgs);
    }
    else if (newInstructionConfig.activationStrategy) {
        viewPortPlanStrategy = newInstructionConfig.activationStrategy;
    }
    else if (hasNewParams || forceLifecycleMinimum) {
        viewPortPlanStrategy = "invoke-lifecycle" /* InvokeLifecycle */;
    }
    else {
        viewPortPlanStrategy = "no-change" /* NoChange */;
    }
    return viewPortPlanStrategy;
};
/**@internal exported for unit testing */
const hasDifferentParameterValues = (prev, next) => {
    let prevParams = prev.params;
    let nextParams = next.params;
    let nextWildCardName = next.config.hasChildRouter ? next.getWildCardName() : null;
    for (let key in nextParams) {
        if (key === nextWildCardName) {
            continue;
        }
        if (prevParams[key] !== nextParams[key]) {
            return true;
        }
    }
    for (let key in prevParams) {
        if (key === nextWildCardName) {
            continue;
        }
        if (prevParams[key] !== nextParams[key]) {
            return true;
        }
    }
    if (!next.options.compareQueryParams) {
        return false;
    }
    let prevQueryParams = prev.queryParams;
    let nextQueryParams = next.queryParams;
    for (let key in nextQueryParams) {
        if (prevQueryParams[key] !== nextQueryParams[key]) {
            return true;
        }
    }
    for (let key in prevQueryParams) {
        if (prevQueryParams[key] !== nextQueryParams[key]) {
            return true;
        }
    }
    return false;
};

/**
 * Transform a navigation instruction into viewport plan record object,
 * or a redirect request if user viewmodel demands
 */
class BuildNavigationPlanStep {
    run(navigationInstruction, next) {
        return _buildNavigationPlan(navigationInstruction)
            .then(plan => {
            if (plan instanceof Redirect) {
                return next.cancel(plan);
            }
            navigationInstruction.plan = plan;
            return next();
        })
            .catch(next.cancel);
    }
}

/**
 * @internal Exported for unit testing
 */
const loadNewRoute = (routeLoader, navigationInstruction) => {
    let loadingPlans = determineLoadingPlans(navigationInstruction);
    let loadPromises = loadingPlans.map((loadingPlan) => loadRoute(routeLoader, loadingPlan.navigationInstruction, loadingPlan.viewPortPlan));
    return Promise.all(loadPromises);
};
/**
 * @internal Exported for unit testing
 */
const determineLoadingPlans = (navigationInstruction, loadingPlans = []) => {
    let viewPortPlans = navigationInstruction.plan;
    for (let viewPortName in viewPortPlans) {
        let viewPortPlan = viewPortPlans[viewPortName];
        let childNavInstruction = viewPortPlan.childNavigationInstruction;
        if (viewPortPlan.strategy === "replace" /* Replace */) {
            loadingPlans.push({ viewPortPlan, navigationInstruction });
            if (childNavInstruction) {
                determineLoadingPlans(childNavInstruction, loadingPlans);
            }
        }
        else {
            let viewPortInstruction = navigationInstruction.addViewPortInstruction({
                name: viewPortName,
                strategy: viewPortPlan.strategy,
                moduleId: viewPortPlan.prevModuleId,
                component: viewPortPlan.prevComponent
            });
            if (childNavInstruction) {
                viewPortInstruction.childNavigationInstruction = childNavInstruction;
                determineLoadingPlans(childNavInstruction, loadingPlans);
            }
        }
    }
    return loadingPlans;
};
/**
 * @internal Exported for unit testing
 */
const loadRoute = (routeLoader, navigationInstruction, viewPortPlan) => {
    let planConfig = viewPortPlan.config;
    let moduleId = planConfig ? planConfig.moduleId : null;
    return loadComponent(routeLoader, navigationInstruction, planConfig)
        .then((component) => {
        let viewPortInstruction = navigationInstruction.addViewPortInstruction({
            name: viewPortPlan.name,
            strategy: viewPortPlan.strategy,
            moduleId: moduleId,
            component: component
        });
        let childRouter = component.childRouter;
        if (childRouter) {
            let path = navigationInstruction.getWildcardPath();
            return childRouter
                ._createNavigationInstruction(path, navigationInstruction)
                .then((childInstruction) => {
                viewPortPlan.childNavigationInstruction = childInstruction;
                return _buildNavigationPlan(childInstruction)
                    .then((childPlan) => {
                    if (childPlan instanceof Redirect) {
                        return Promise.reject(childPlan);
                    }
                    childInstruction.plan = childPlan;
                    viewPortInstruction.childNavigationInstruction = childInstruction;
                    return loadNewRoute(routeLoader, childInstruction);
                });
            });
        }
        // ts complains without this, though they are same
        return void 0;
    });
};
/**
 * Load a routed-component based on navigation instruction and route config
 * @internal exported for unit testing only
 */
const loadComponent = (routeLoader, navigationInstruction, config) => {
    let router = navigationInstruction.router;
    let lifecycleArgs = navigationInstruction.lifecycleArgs;
    return Promise.resolve()
        .then(() => routeLoader.loadRoute(router, config, navigationInstruction))
        .then(
    /**
     * @param component an object carrying information about loaded route
     * typically contains information about view model, childContainer, view and router
     */
    (component) => {
        let { viewModel, childContainer } = component;
        component.router = router;
        component.config = config;
        if ('configureRouter' in viewModel) {
            let childRouter = childContainer.getChildRouter();
            component.childRouter = childRouter;
            return childRouter
                .configure(c => viewModel.configureRouter(c, childRouter, lifecycleArgs[0], lifecycleArgs[1], lifecycleArgs[2]))
                .then(() => component);
        }
        return component;
    });
};

/**
 * Abstract class that is responsible for loading view / view model from a route config
 * The default implementation can be found in `aurelia-templating-router`
 */
class RouteLoader {
    /**
     * Load a route config based on its viewmodel / view configuration
     */
    // return typing: return typings used to be never
    // as it was a throw. Changing it to Promise<any> should not cause any issues
    loadRoute(router, config, navigationInstruction) {
        throw new Error('Route loaders must implement "loadRoute(router, config, navigationInstruction)".');
    }
}

/**
 * A pipeline step responsible for loading a route config of a navigation instruction
 */
class LoadRouteStep {
    /**@internal */
    static inject() { return [RouteLoader]; }
    constructor(routeLoader) {
        this.routeLoader = routeLoader;
    }
    /**
     * Run the internal to load route config of a navigation instruction to prepare for next steps in the pipeline
     */
    run(navigationInstruction, next) {
        return loadNewRoute(this.routeLoader, navigationInstruction)
            .then(next, next.cancel);
    }
}

/**
 * A pipeline step for instructing a piepline to commit changes on a navigation instruction
 */
class CommitChangesStep {
    run(navigationInstruction, next) {
        return navigationInstruction
            ._commitChanges(/*wait to swap?*/ true)
            .then(() => {
            navigationInstruction._updateTitle();
            return next();
        });
    }
}

/**
 * An optional interface describing the available activation strategies.
 * @internal Used internally.
 */
var InternalActivationStrategy;
(function (InternalActivationStrategy) {
    /**
     * Reuse the existing view model, without invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["NoChange"] = "no-change";
    /**
     * Reuse the existing view model, invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["InvokeLifecycle"] = "invoke-lifecycle";
    /**
     * Replace the existing view model, invoking Router lifecycle hooks.
     */
    InternalActivationStrategy["Replace"] = "replace";
})(InternalActivationStrategy || (InternalActivationStrategy = {}));
/**
 * The strategy to use when activating modules during navigation.
 */
// kept for compat reason
const activationStrategy = {
    noChange: "no-change" /* NoChange */,
    invokeLifecycle: "invoke-lifecycle" /* InvokeLifecycle */,
    replace: "replace" /* Replace */
};

/**
 * Recursively find list of deactivate-able view models
 * and invoke the either 'canDeactivate' or 'deactivate' on each
 * @internal exported for unit testing
 */
const processDeactivatable = (navigationInstruction, callbackName, next, ignoreResult) => {
    let plan = navigationInstruction.plan;
    let infos = findDeactivatable(plan, callbackName);
    let i = infos.length; // query from inside out
    function inspect(val) {
        if (ignoreResult || shouldContinue(val)) {
            return iterate();
        }
        return next.cancel(val);
    }
    function iterate() {
        if (i--) {
            try {
                let viewModel = infos[i];
                let result = viewModel[callbackName](navigationInstruction);
                return processPotential(result, inspect, next.cancel);
            }
            catch (error) {
                return next.cancel(error);
            }
        }
        navigationInstruction.router.couldDeactivate = true;
        return next();
    }
    return iterate();
};
/**
 * Recursively find and returns a list of deactivate-able view models
 * @internal exported for unit testing
 */
const findDeactivatable = (plan, callbackName, list = []) => {
    for (let viewPortName in plan) {
        let viewPortPlan = plan[viewPortName];
        let prevComponent = viewPortPlan.prevComponent;
        if ((viewPortPlan.strategy === activationStrategy.invokeLifecycle || viewPortPlan.strategy === activationStrategy.replace)
            && prevComponent) {
            let viewModel = prevComponent.viewModel;
            if (callbackName in viewModel) {
                list.push(viewModel);
            }
        }
        if (viewPortPlan.strategy === activationStrategy.replace && prevComponent) {
            addPreviousDeactivatable(prevComponent, callbackName, list);
        }
        else if (viewPortPlan.childNavigationInstruction) {
            findDeactivatable(viewPortPlan.childNavigationInstruction.plan, callbackName, list);
        }
    }
    return list;
};
/**
 * @internal exported for unit testing
 */
const addPreviousDeactivatable = (component, callbackName, list) => {
    let childRouter = component.childRouter;
    if (childRouter && childRouter.currentInstruction) {
        let viewPortInstructions = childRouter.currentInstruction.viewPortInstructions;
        for (let viewPortName in viewPortInstructions) {
            let viewPortInstruction = viewPortInstructions[viewPortName];
            let prevComponent = viewPortInstruction.component;
            let prevViewModel = prevComponent.viewModel;
            if (callbackName in prevViewModel) {
                list.push(prevViewModel);
            }
            addPreviousDeactivatable(prevComponent, callbackName, list);
        }
    }
};
/**
 * @internal exported for unit testing
 */
const processActivatable = (navigationInstruction, callbackName, next, ignoreResult) => {
    let infos = findActivatable(navigationInstruction, callbackName);
    let length = infos.length;
    let i = -1; // query from top down
    function inspect(val, router) {
        if (ignoreResult || shouldContinue(val, router)) {
            return iterate();
        }
        return next.cancel(val);
    }
    function iterate() {
        i++;
        if (i < length) {
            try {
                let current = infos[i];
                let result = current.viewModel[callbackName](...current.lifecycleArgs);
                return processPotential(result, (val) => inspect(val, current.router), next.cancel);
            }
            catch (error) {
                return next.cancel(error);
            }
        }
        return next();
    }
    return iterate();
};
/**
 * Find list of activatable view model and add to list (3rd parameter)
 * @internal exported for unit testing
 */
const findActivatable = (navigationInstruction, callbackName, list = [], router) => {
    let plan = navigationInstruction.plan;
    Object
        .keys(plan)
        .forEach((viewPortName) => {
        let viewPortPlan = plan[viewPortName];
        let viewPortInstruction = navigationInstruction.viewPortInstructions[viewPortName];
        let viewPortComponent = viewPortInstruction.component;
        let viewModel = viewPortComponent.viewModel;
        if ((viewPortPlan.strategy === activationStrategy.invokeLifecycle
            || viewPortPlan.strategy === activationStrategy.replace)
            && callbackName in viewModel) {
            list.push({
                viewModel,
                lifecycleArgs: viewPortInstruction.lifecycleArgs,
                router
            });
        }
        let childNavInstruction = viewPortPlan.childNavigationInstruction;
        if (childNavInstruction) {
            findActivatable(childNavInstruction, callbackName, list, viewPortComponent.childRouter || router);
        }
    });
    return list;
};
const shouldContinue = (output, router) => {
    if (output instanceof Error) {
        return false;
    }
    if (isNavigationCommand(output)) {
        if (typeof output.setRouter === 'function') {
            output.setRouter(router);
        }
        return !!output.shouldContinueProcessing;
    }
    if (output === undefined) {
        return true;
    }
    return output;
};
/**
 * wraps a subscription, allowing unsubscribe calls even if
 * the first value comes synchronously
 */
class SafeSubscription {
    constructor(subscriptionFunc) {
        this._subscribed = true;
        this._subscription = subscriptionFunc(this);
        if (!this._subscribed) {
            this.unsubscribe();
        }
    }
    get subscribed() {
        return this._subscribed;
    }
    unsubscribe() {
        if (this._subscribed && this._subscription) {
            this._subscription.unsubscribe();
        }
        this._subscribed = false;
    }
}
/**
 * A function to process return value from `activate`/`canActivate` steps
 * Supports observable/promise
 *
 * For observable, resolve at first next() or on complete()
 */
const processPotential = (obj, resolve, reject) => {
    // if promise like
    if (obj && typeof obj.then === 'function') {
        return Promise.resolve(obj).then(resolve).catch(reject);
    }
    // if observable
    if (obj && typeof obj.subscribe === 'function') {
        let obs = obj;
        return new SafeSubscription(sub => obs.subscribe({
            next() {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    resolve(obj);
                }
            },
            error(error) {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    reject(error);
                }
            },
            complete() {
                if (sub.subscribed) {
                    sub.unsubscribe();
                    resolve(obj);
                }
            }
        }));
    }
    // else just resolve
    try {
        return resolve(obj);
    }
    catch (error) {
        return reject(error);
    }
};

/**
 * A pipeline step responsible for finding and activating method `canDeactivate` on a view model of a route
 */
class CanDeactivatePreviousStep {
    run(navigationInstruction, next) {
        return processDeactivatable(navigationInstruction, 'canDeactivate', next);
    }
}
/**
 * A pipeline step responsible for finding and activating method `canActivate` on a view model of a route
 */
class CanActivateNextStep {
    run(navigationInstruction, next) {
        return processActivatable(navigationInstruction, 'canActivate', next);
    }
}
/**
 * A pipeline step responsible for finding and activating method `deactivate` on a view model of a route
 */
class DeactivatePreviousStep {
    run(navigationInstruction, next) {
        return processDeactivatable(navigationInstruction, 'deactivate', next, true);
    }
}
/**
 * A pipeline step responsible for finding and activating method `activate` on a view model of a route
 */
class ActivateNextStep {
    run(navigationInstruction, next) {
        return processActivatable(navigationInstruction, 'activate', next, true);
    }
}

/**
 * A multi-slots Pipeline Placeholder Step for hooking into a pipeline execution
 */
class PipelineSlot {
    constructor(container, name, alias) {
        this.steps = [];
        this.container = container;
        this.slotName = name;
        this.slotAlias = alias;
    }
    getSteps() {
        return this.steps.map(x => this.container.get(x));
    }
}
/**
 * Class responsible for creating the navigation pipeline.
 */
class PipelineProvider {
    /**@internal */
    static inject() { return [__WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"]]; }
    constructor(container) {
        this.container = container;
        this.steps = [
            BuildNavigationPlanStep,
            CanDeactivatePreviousStep,
            LoadRouteStep,
            createPipelineSlot(container, "authorize" /* Authorize */),
            CanActivateNextStep,
            createPipelineSlot(container, "preActivate" /* PreActivate */, 'modelbind'),
            // NOTE: app state changes start below - point of no return
            DeactivatePreviousStep,
            ActivateNextStep,
            createPipelineSlot(container, "preRender" /* PreRender */, 'precommit'),
            CommitChangesStep,
            createPipelineSlot(container, "postRender" /* PostRender */, 'postcomplete')
        ];
    }
    /**
     * Create the navigation pipeline.
     */
    createPipeline(useCanDeactivateStep = true) {
        let pipeline = new Pipeline();
        this.steps.forEach(step => {
            if (useCanDeactivateStep || step !== CanDeactivatePreviousStep) {
                pipeline.addStep(this.container.get(step));
            }
        });
        return pipeline;
    }
    /**@internal */
    _findStep(name) {
        // Steps that are not PipelineSlots are constructor functions, and they will automatically fail. Probably.
        return this.steps.find(x => x.slotName === name || x.slotAlias === name);
    }
    /**
     * Adds a step into the pipeline at a known slot location.
     */
    addStep(name, step) {
        let found = this._findStep(name);
        if (found) {
            let slotSteps = found.steps;
            // prevent duplicates
            if (!slotSteps.includes(step)) {
                slotSteps.push(step);
            }
        }
        else {
            throw new Error(`Invalid pipeline slot name: ${name}.`);
        }
    }
    /**
     * Removes a step from a slot in the pipeline
     */
    removeStep(name, step) {
        let slot = this._findStep(name);
        if (slot) {
            let slotSteps = slot.steps;
            slotSteps.splice(slotSteps.indexOf(step), 1);
        }
    }
    /**
     * Clears all steps from a slot in the pipeline
     * @internal
     */
    _clearSteps(name = '') {
        let slot = this._findStep(name);
        if (slot) {
            slot.steps = [];
        }
    }
    /**
     * Resets all pipeline slots
     */
    reset() {
        this._clearSteps("authorize" /* Authorize */);
        this._clearSteps("preActivate" /* PreActivate */);
        this._clearSteps("preRender" /* PreRender */);
        this._clearSteps("postRender" /* PostRender */);
    }
}
/**@internal */
const createPipelineSlot = (container, name, alias) => {
    return new PipelineSlot(container, name, alias);
};

const logger = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_logging__["getLogger"])('app-router');
/**
 * The main application router.
 */
class AppRouter extends Router {
    /**@internal */
    static inject() { return [__WEBPACK_IMPORTED_MODULE_1_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_2_aurelia_history__["History"], PipelineProvider, __WEBPACK_IMPORTED_MODULE_4_aurelia_event_aggregator__["EventAggregator"]]; }
    constructor(container, history, pipelineProvider, events) {
        super(container, history); // Note the super will call reset internally.
        this.pipelineProvider = pipelineProvider;
        this.events = events;
    }
    /**
     * Fully resets the router's internal state. Primarily used internally by the framework when multiple calls to setRoot are made.
     * Use with caution (actually, avoid using this). Do not use this to simply change your navigation model.
     */
    reset() {
        super.reset();
        this.maxInstructionCount = 10;
        if (!this._queue) {
            this._queue = [];
        }
        else {
            this._queue.length = 0;
        }
    }
    /**
     * Loads the specified URL.
     *
     * @param url The URL fragment to load.
     */
    loadUrl(url) {
        return this
            ._createNavigationInstruction(url)
            .then(instruction => this._queueInstruction(instruction))
            .catch(error => {
            logger.error(error);
            restorePreviousLocation(this);
        });
    }
    /**
     * Registers a viewPort to be used as a rendering target for activated routes.
     *
     * @param viewPort The viewPort. This is typically a <router-view/> element in Aurelia default impl
     * @param name The name of the viewPort. 'default' if unspecified.
     */
    registerViewPort(viewPort, name) {
        // having strong typing without changing public API
        const $viewPort = viewPort;
        super.registerViewPort($viewPort, name);
        // beside adding viewport to the registry of this instance
        // AppRouter also configure routing/history to start routing functionality
        // There are situation where there are more than 1 <router-view/> element at root view
        // in that case, still only activate once via the following guard
        if (!this.isActive) {
            const viewModel = this._findViewModel($viewPort);
            if ('configureRouter' in viewModel) {
                // If there are more than one <router-view/> element at root view
                // use this flag to guard against configure method being invoked multiple times
                // this flag is set inside method configure
                if (!this.isConfigured) {
                    // replace the real resolve with a noop to guarantee that any action in base class Router
                    // won't resolve the configurePromise prematurely
                    const resolveConfiguredPromise = this._resolveConfiguredPromise;
                    this._resolveConfiguredPromise = () => { };
                    return this
                        .configure(config => Promise
                        .resolve(viewModel.configureRouter(config, this))
                        // an issue with configure interface. Should be fixed there
                        // todo: fix this via configure interface in router
                        .then(() => config))
                        .then(() => {
                        this.activate();
                        resolveConfiguredPromise();
                    });
                }
            }
            else {
                this.activate();
            }
        }
        // when a viewport is added dynamically to a root view that is already activated
        // just process the navigation instruction
        else {
            this._dequeueInstruction();
        }
        return Promise.resolve();
    }
    /**
     * Activates the router. This instructs the router to begin listening for history changes and processing instructions.
     *
     * @params options The set of options to activate the router with.
     */
    activate(options) {
        if (this.isActive) {
            return;
        }
        this.isActive = true;
        // route handler property is responsible for handling url change
        // the interface of aurelia-history isn't clear on this perspective
        this.options = Object.assign({ routeHandler: this.loadUrl.bind(this) }, this.options, options);
        this.history.activate(this.options);
        this._dequeueInstruction();
    }
    /**
     * Deactivates the router.
     */
    deactivate() {
        this.isActive = false;
        this.history.deactivate();
    }
    /**@internal */
    _queueInstruction(instruction) {
        return new Promise((resolve) => {
            instruction.resolve = resolve;
            this._queue.unshift(instruction);
            this._dequeueInstruction();
        });
    }
    /**@internal */
    _dequeueInstruction(instructionCount = 0) {
        return Promise.resolve().then(() => {
            if (this.isNavigating && !instructionCount) {
                // ts complains about inconsistent returns without void 0
                return void 0;
            }
            let instruction = this._queue.shift();
            this._queue.length = 0;
            if (!instruction) {
                // ts complains about inconsistent returns without void 0
                return void 0;
            }
            this.isNavigating = true;
            let navtracker = this.history.getState('NavigationTracker');
            let currentNavTracker = this.currentNavigationTracker;
            if (!navtracker && !currentNavTracker) {
                this.isNavigatingFirst = true;
                this.isNavigatingNew = true;
            }
            else if (!navtracker) {
                this.isNavigatingNew = true;
            }
            else if (!currentNavTracker) {
                this.isNavigatingRefresh = true;
            }
            else if (currentNavTracker < navtracker) {
                this.isNavigatingForward = true;
            }
            else if (currentNavTracker > navtracker) {
                this.isNavigatingBack = true;
            }
            if (!navtracker) {
                navtracker = Date.now();
                this.history.setState('NavigationTracker', navtracker);
            }
            this.currentNavigationTracker = navtracker;
            instruction.previousInstruction = this.currentInstruction;
            let maxInstructionCount = this.maxInstructionCount;
            if (!instructionCount) {
                this.events.publish("router:navigation:processing" /* Processing */, { instruction });
            }
            else if (instructionCount === maxInstructionCount - 1) {
                logger.error(`${instructionCount + 1} navigation instructions have been attempted without success. Restoring last known good location.`);
                restorePreviousLocation(this);
                return this._dequeueInstruction(instructionCount + 1);
            }
            else if (instructionCount > maxInstructionCount) {
                throw new Error('Maximum navigation attempts exceeded. Giving up.');
            }
            let pipeline = this.pipelineProvider.createPipeline(!this.couldDeactivate);
            return pipeline
                .run(instruction)
                .then(result => processResult(instruction, result, instructionCount, this))
                .catch(error => {
                return { output: error instanceof Error ? error : new Error(error) };
            })
                .then(result => resolveInstruction(instruction, result, !!instructionCount, this));
        });
    }
    /**@internal */
    _findViewModel(viewPort) {
        if (this.container.viewModel) {
            return this.container.viewModel;
        }
        if (viewPort.container) {
            let container = viewPort.container;
            while (container) {
                if (container.viewModel) {
                    this.container.viewModel = container.viewModel;
                    return container.viewModel;
                }
                container = container.parent;
            }
        }
        return undefined;
    }
}
const processResult = (instruction, result, instructionCount, router) => {
    if (!(result && 'completed' in result && 'output' in result)) {
        result = result || {};
        result.output = new Error(`Expected router pipeline to return a navigation result, but got [${JSON.stringify(result)}] instead.`);
    }
    let finalResult = null;
    let navigationCommandResult = null;
    if (isNavigationCommand(result.output)) {
        navigationCommandResult = result.output.navigate(router);
    }
    else {
        finalResult = result;
        if (!result.completed) {
            if (result.output instanceof Error) {
                logger.error(result.output.toString());
            }
            restorePreviousLocation(router);
        }
    }
    return Promise.resolve(navigationCommandResult)
        .then(_ => router._dequeueInstruction(instructionCount + 1))
        .then(innerResult => finalResult || innerResult || result);
};
const resolveInstruction = (instruction, result, isInnerInstruction, router) => {
    instruction.resolve(result);
    let eventAggregator = router.events;
    let eventArgs = { instruction, result };
    if (!isInnerInstruction) {
        router.isNavigating = false;
        router.isExplicitNavigation = false;
        router.isExplicitNavigationBack = false;
        router.isNavigatingFirst = false;
        router.isNavigatingNew = false;
        router.isNavigatingRefresh = false;
        router.isNavigatingForward = false;
        router.isNavigatingBack = false;
        router.couldDeactivate = false;
        let eventName;
        if (result.output instanceof Error) {
            eventName = "router:navigation:error" /* Error */;
        }
        else if (!result.completed) {
            eventName = "router:navigation:canceled" /* Canceled */;
        }
        else {
            let queryString = instruction.queryString ? ('?' + instruction.queryString) : '';
            router.history.previousLocation = instruction.fragment + queryString;
            eventName = "router:navigation:success" /* Success */;
        }
        eventAggregator.publish(eventName, eventArgs);
        eventAggregator.publish("router:navigation:complete" /* Complete */, eventArgs);
    }
    else {
        eventAggregator.publish("router:navigation:child:complete" /* ChildComplete */, eventArgs);
    }
    return result;
};
const restorePreviousLocation = (router) => {
    let previousLocation = router.history.previousLocation;
    if (previousLocation) {
        router.navigate(previousLocation, { trigger: false, replace: true });
    }
    else if (router.fallbackRoute) {
        router.navigate(router.fallbackRoute, { trigger: true, replace: true });
    }
    else {
        logger.error('Router navigation failed, and no previous location or fallbackRoute could be restored.');
    }
};

/**
* The status of a Pipeline.
*/
var PipelineStatus;
(function (PipelineStatus) {
    PipelineStatus["Completed"] = "completed";
    PipelineStatus["Canceled"] = "canceled";
    PipelineStatus["Rejected"] = "rejected";
    PipelineStatus["Running"] = "running";
})(PipelineStatus || (PipelineStatus = {}));

/**
 * A list of known router events used by the Aurelia router
 * to signal the pipeline has come to a certain state
 */
// const enum is preserved in tsconfig
var RouterEvent;
(function (RouterEvent) {
    RouterEvent["Processing"] = "router:navigation:processing";
    RouterEvent["Error"] = "router:navigation:error";
    RouterEvent["Canceled"] = "router:navigation:canceled";
    RouterEvent["Complete"] = "router:navigation:complete";
    RouterEvent["Success"] = "router:navigation:success";
    RouterEvent["ChildComplete"] = "router:navigation:child:complete";
})(RouterEvent || (RouterEvent = {}));

/**
 * Available pipeline slot names to insert interceptor into router pipeline
 */
// const enum is preserved in tsconfig
var PipelineSlotName;
(function (PipelineSlotName) {
    /**
     * Authorization slot. Invoked early in the pipeline,
     * before `canActivate` hook of incoming route
     */
    PipelineSlotName["Authorize"] = "authorize";
    /**
     * Pre-activation slot. Invoked early in the pipeline,
     * Invoked timing:
     *   - after Authorization slot
     *   - after canActivate hook on new view model
     *   - before deactivate hook on old view model
     *   - before activate hook on new view model
     */
    PipelineSlotName["PreActivate"] = "preActivate";
    /**
     * Pre-render slot. Invoked later in the pipeline
     * Invokcation timing:
     *   - after activate hook on new view model
     *   - before commit step on new navigation instruction
     */
    PipelineSlotName["PreRender"] = "preRender";
    /**
     * Post-render slot. Invoked last in the pipeline
     */
    PipelineSlotName["PostRender"] = "postRender";
})(PipelineSlotName || (PipelineSlotName = {}));


//# sourceMappingURL=aurelia-router.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-templating-binding":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "AttributeMap", function() { return AttributeMap; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ChildInterpolationBinding", function() { return ChildInterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InterpolationBinding", function() { return InterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "InterpolationBindingExpression", function() { return InterpolationBindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetBinding", function() { return LetBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetExpression", function() { return LetExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetInterpolationBinding", function() { return LetInterpolationBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "LetInterpolationBindingExpression", function() { return LetInterpolationBindingExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SyntaxInterpreter", function() { return SyntaxInterpreter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingBindingLanguage", function() { return TemplatingBindingLanguage; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });




/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

var AttributeMap = (function () {
    function AttributeMap(svg) {
        this.elements = Object.create(null);
        this.allElements = Object.create(null);
        this.svg = svg;
        this.registerUniversal('accesskey', 'accessKey');
        this.registerUniversal('contenteditable', 'contentEditable');
        this.registerUniversal('tabindex', 'tabIndex');
        this.registerUniversal('textcontent', 'textContent');
        this.registerUniversal('innerhtml', 'innerHTML');
        this.registerUniversal('scrolltop', 'scrollTop');
        this.registerUniversal('scrollleft', 'scrollLeft');
        this.registerUniversal('readonly', 'readOnly');
        this.register('label', 'for', 'htmlFor');
        this.register('img', 'usemap', 'useMap');
        this.register('input', 'maxlength', 'maxLength');
        this.register('input', 'minlength', 'minLength');
        this.register('input', 'formaction', 'formAction');
        this.register('input', 'formenctype', 'formEncType');
        this.register('input', 'formmethod', 'formMethod');
        this.register('input', 'formnovalidate', 'formNoValidate');
        this.register('input', 'formtarget', 'formTarget');
        this.register('textarea', 'maxlength', 'maxLength');
        this.register('td', 'rowspan', 'rowSpan');
        this.register('td', 'colspan', 'colSpan');
        this.register('th', 'rowspan', 'rowSpan');
        this.register('th', 'colspan', 'colSpan');
    }
    AttributeMap.prototype.register = function (elementName, attributeName, propertyName) {
        elementName = elementName.toLowerCase();
        attributeName = attributeName.toLowerCase();
        var element = this.elements[elementName] = (this.elements[elementName] || Object.create(null));
        element[attributeName] = propertyName;
    };
    AttributeMap.prototype.registerUniversal = function (attributeName, propertyName) {
        attributeName = attributeName.toLowerCase();
        this.allElements[attributeName] = propertyName;
    };
    AttributeMap.prototype.map = function (elementName, attributeName) {
        if (this.svg.isStandardSvgAttribute(elementName, attributeName)) {
            return attributeName;
        }
        elementName = elementName.toLowerCase();
        attributeName = attributeName.toLowerCase();
        var element = this.elements[elementName];
        if (element !== undefined && attributeName in element) {
            return element[attributeName];
        }
        if (attributeName in this.allElements) {
            return this.allElements[attributeName];
        }
        if (/(?:^data-)|(?:^aria-)|:/.test(attributeName)) {
            return attributeName;
        }
        return __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(attributeName);
    };
    AttributeMap.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["SVGAnalyzer"]];
    return AttributeMap;
}());

var InterpolationBindingExpression = (function () {
    function InterpolationBindingExpression(observerLocator, targetProperty, parts, mode, lookupFunctions, attribute) {
        this.observerLocator = observerLocator;
        this.targetProperty = targetProperty;
        this.parts = parts;
        this.mode = mode;
        this.lookupFunctions = lookupFunctions;
        this.attribute = this.attrToRemove = attribute;
        this.discrete = false;
    }
    InterpolationBindingExpression.prototype.createBinding = function (target) {
        if (this.parts.length === 3) {
            return new ChildInterpolationBinding(target, this.observerLocator, this.parts[1], this.mode, this.lookupFunctions, this.targetProperty, this.parts[0], this.parts[2]);
        }
        return new InterpolationBinding(this.observerLocator, this.parts, target, this.targetProperty, this.mode, this.lookupFunctions);
    };
    return InterpolationBindingExpression;
}());
function validateTarget(target, propertyName) {
    if (propertyName === 'style') {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_logging__["getLogger"]('templating-binding')
            .info('Internet Explorer does not support interpolation in "style" attributes.  Use the style attribute\'s alias, "css" instead.');
    }
    else if (target.parentElement && target.parentElement.nodeName === 'TEXTAREA' && propertyName === 'textContent') {
        throw new Error('Interpolation binding cannot be used in the content of a textarea element.  Use <textarea value.bind="expression"></textarea> instead.');
    }
}
var InterpolationBinding = (function () {
    function InterpolationBinding(observerLocator, parts, target, targetProperty, mode, lookupFunctions) {
        validateTarget(target, targetProperty);
        this.observerLocator = observerLocator;
        this.parts = parts;
        this.target = target;
        this.targetProperty = targetProperty;
        this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
        this.mode = mode;
        this.lookupFunctions = lookupFunctions;
    }
    InterpolationBinding.prototype.interpolate = function () {
        if (this.isBound) {
            var value = '';
            var parts = this.parts;
            for (var i = 0, ii = parts.length; i < ii; i++) {
                value += (i % 2 === 0 ? parts[i] : this["childBinding".concat(i)].value);
            }
            this.targetAccessor.setValue(value, this.target, this.targetProperty);
        }
    };
    InterpolationBinding.prototype.updateOneTimeBindings = function () {
        for (var i = 1, ii = this.parts.length; i < ii; i += 2) {
            var child = this["childBinding".concat(i)];
            if (child.mode === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
                child.call();
            }
        }
    };
    InterpolationBinding.prototype.bind = function (source) {
        if (this.isBound) {
            if (this.source === source) {
                return;
            }
            this.unbind();
        }
        this.source = source;
        var parts = this.parts;
        for (var i = 1, ii = parts.length; i < ii; i += 2) {
            var binding = new ChildInterpolationBinding(this, this.observerLocator, parts[i], this.mode, this.lookupFunctions);
            binding.bind(source);
            this["childBinding".concat(i)] = binding;
        }
        this.isBound = true;
        this.interpolate();
    };
    InterpolationBinding.prototype.unbind = function () {
        if (!this.isBound) {
            return;
        }
        this.isBound = false;
        this.source = null;
        var parts = this.parts;
        for (var i = 1, ii = parts.length; i < ii; i += 2) {
            var name_1 = "childBinding".concat(i);
            this[name_1].unbind();
        }
    };
    return InterpolationBinding;
}());
var ChildInterpolationBinding = (function () {
    function ChildInterpolationBinding(target, observerLocator, sourceExpression, mode, lookupFunctions, targetProperty, left, right) {
        if (target instanceof InterpolationBinding) {
            this.parent = target;
        }
        else {
            validateTarget(target, targetProperty);
            this.target = target;
            this.targetProperty = targetProperty;
            this.targetAccessor = observerLocator.getAccessor(target, targetProperty);
        }
        this.observerLocator = observerLocator;
        this.sourceExpression = sourceExpression;
        this.mode = mode;
        this.lookupFunctions = lookupFunctions;
        this.left = left;
        this.right = right;
    }
    ChildInterpolationBinding.prototype.updateTarget = function (value) {
        value = value === null || value === undefined ? '' : value.toString();
        if (value !== this.value) {
            this.value = value;
            if (this.parent) {
                this.parent.interpolate();
            }
            else {
                this.targetAccessor.setValue(this.left + value + this.right, this.target, this.targetProperty);
            }
        }
    };
    ChildInterpolationBinding.prototype.call = function () {
        if (!this.isBound) {
            return;
        }
        this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
        this.updateTarget(this.rawValue);
        if (this.mode !== __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
            this._version++;
            this.sourceExpression.connect(this, this.source);
            if (this.rawValue instanceof Array) {
                this.observeArray(this.rawValue);
            }
            this.unobserve(false);
        }
    };
    ChildInterpolationBinding.prototype.bind = function (source) {
        if (this.isBound) {
            if (this.source === source) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.source = source;
        var sourceExpression = this.sourceExpression;
        if (sourceExpression.bind) {
            sourceExpression.bind(this, source, this.lookupFunctions);
        }
        this.rawValue = sourceExpression.evaluate(source, this.lookupFunctions);
        this.updateTarget(this.rawValue);
        if (this.mode === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneWay) {
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["enqueueBindingConnect"])(this);
        }
    };
    ChildInterpolationBinding.prototype.unbind = function () {
        if (!this.isBound) {
            return;
        }
        this.isBound = false;
        var sourceExpression = this.sourceExpression;
        if (sourceExpression.unbind) {
            sourceExpression.unbind(this, this.source);
        }
        this.source = null;
        this.value = null;
        this.rawValue = null;
        this.unobserve(true);
    };
    ChildInterpolationBinding.prototype.connect = function (evaluate) {
        if (!this.isBound) {
            return;
        }
        if (evaluate) {
            this.rawValue = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
            this.updateTarget(this.rawValue);
        }
        this.sourceExpression.connect(this, this.source);
        if (this.rawValue instanceof Array) {
            this.observeArray(this.rawValue);
        }
    };
    ChildInterpolationBinding = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["connectable"])()
    ], ChildInterpolationBinding);
    return ChildInterpolationBinding;
}());

var LetExpression = (function () {
    function LetExpression(observerLocator, targetProperty, sourceExpression, lookupFunctions, toBindingContext) {
        this.observerLocator = observerLocator;
        this.sourceExpression = sourceExpression;
        this.targetProperty = targetProperty;
        this.lookupFunctions = lookupFunctions;
        this.toBindingContext = toBindingContext;
    }
    LetExpression.prototype.createBinding = function () {
        return new LetBinding(this.observerLocator, this.sourceExpression, this.targetProperty, this.lookupFunctions, this.toBindingContext);
    };
    return LetExpression;
}());
var LetBinding = (function () {
    function LetBinding(observerLocator, sourceExpression, targetProperty, lookupFunctions, toBindingContext) {
        this.observerLocator = observerLocator;
        this.sourceExpression = sourceExpression;
        this.targetProperty = targetProperty;
        this.lookupFunctions = lookupFunctions;
        this.source = null;
        this.target = null;
        this.toBindingContext = toBindingContext;
    }
    LetBinding.prototype.updateTarget = function () {
        var value = this.sourceExpression.evaluate(this.source, this.lookupFunctions);
        this.target[this.targetProperty] = value;
    };
    LetBinding.prototype.call = function (context) {
        if (!this.isBound) {
            return;
        }
        if (context === __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["sourceContext"]) {
            this.updateTarget();
            return;
        }
        throw new Error("Unexpected call context ".concat(context));
    };
    LetBinding.prototype.bind = function (source) {
        if (this.isBound) {
            if (this.source === source) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.source = source;
        this.target = this.toBindingContext ? source.bindingContext : source.overrideContext;
        if (this.sourceExpression.bind) {
            this.sourceExpression.bind(this, source, this.lookupFunctions);
        }
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["enqueueBindingConnect"])(this);
    };
    LetBinding.prototype.unbind = function () {
        if (!this.isBound) {
            return;
        }
        this.isBound = false;
        if (this.sourceExpression.unbind) {
            this.sourceExpression.unbind(this, this.source);
        }
        this.source = null;
        this.target = null;
        this.unobserve(true);
    };
    LetBinding.prototype.unobserve = function (arg0) {
        throw new Error('Method not implemented.');
    };
    LetBinding.prototype.connect = function () {
        if (!this.isBound) {
            return;
        }
        this.updateTarget();
        this.sourceExpression.connect(this, this.source);
    };
    LetBinding = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["connectable"])()
    ], LetBinding);
    return LetBinding;
}());

var LetInterpolationBindingExpression = (function () {
    function LetInterpolationBindingExpression(observerLocator, targetProperty, parts, lookupFunctions, toBindingContext) {
        this.observerLocator = observerLocator;
        this.targetProperty = targetProperty;
        this.parts = parts;
        this.lookupFunctions = lookupFunctions;
        this.toBindingContext = toBindingContext;
    }
    LetInterpolationBindingExpression.prototype.createBinding = function () {
        return new LetInterpolationBinding(this.observerLocator, this.targetProperty, this.parts, this.lookupFunctions, this.toBindingContext);
    };
    return LetInterpolationBindingExpression;
}());
var LetInterpolationBinding = (function () {
    function LetInterpolationBinding(observerLocator, targetProperty, parts, lookupFunctions, toBindingContext) {
        this.observerLocator = observerLocator;
        this.parts = parts;
        this.targetProperty = targetProperty;
        this.lookupFunctions = lookupFunctions;
        this.toBindingContext = toBindingContext;
        this.target = null;
    }
    LetInterpolationBinding.prototype.bind = function (source) {
        if (this.isBound) {
            if (this.source === source) {
                return;
            }
            this.unbind();
        }
        this.isBound = true;
        this.source = source;
        this.target = this.toBindingContext ? source.bindingContext : source.overrideContext;
        this.interpolationBinding = this.createInterpolationBinding();
        this.interpolationBinding.bind(source);
    };
    LetInterpolationBinding.prototype.unbind = function () {
        if (!this.isBound) {
            return;
        }
        this.isBound = false;
        this.source = null;
        this.target = null;
        this.interpolationBinding.unbind();
        this.interpolationBinding = null;
    };
    LetInterpolationBinding.prototype.createInterpolationBinding = function () {
        if (this.parts.length === 3) {
            return new ChildInterpolationBinding(this.target, this.observerLocator, this.parts[1], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, this.lookupFunctions, this.targetProperty, this.parts[0], this.parts[2]);
        }
        return new InterpolationBinding(this.observerLocator, this.parts, this.target, this.targetProperty, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, this.lookupFunctions);
    };
    return LetInterpolationBinding;
}());

var SyntaxInterpreter = (function () {
    function SyntaxInterpreter(parser, observerLocator, eventManager, attributeMap) {
        this.parser = parser;
        this.observerLocator = observerLocator;
        this.eventManager = eventManager;
        this.attributeMap = attributeMap;
    }
    SyntaxInterpreter.prototype.interpret = function (resources, element, info, existingInstruction, context) {
        if (info.command in this) {
            return this[info.command](resources, element, info, existingInstruction, context);
        }
        return this.handleUnknownCommand(resources, element, info, existingInstruction, context);
    };
    SyntaxInterpreter.prototype.handleUnknownCommand = function (resources, element, info, existingInstruction, context) {
        __WEBPACK_IMPORTED_MODULE_2_aurelia_logging__["getLogger"]('templating-binding').warn('Unknown binding command.', info);
        return existingInstruction;
    };
    SyntaxInterpreter.prototype.determineDefaultBindingMode = function (element, attrName, context) {
        var tagName = element.tagName.toLowerCase();
        if (tagName === 'input' && (attrName === 'value' || attrName === 'files') && element.type !== 'checkbox' && element.type !== 'radio'
            || tagName === 'input' && attrName === 'checked' && (element.type === 'checkbox' || element.type === 'radio')
            || (tagName === 'textarea' || tagName === 'select') && attrName === 'value'
            || (attrName === 'textcontent' || attrName === 'innerhtml') && element.contentEditable === 'true'
            || attrName === 'scrolltop'
            || attrName === 'scrollleft') {
            return __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].twoWay;
        }
        if (context
            && attrName in context.attributes
            && context.attributes[attrName]
            && context.attributes[attrName].defaultBindingMode >= __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime) {
            return context.attributes[attrName].defaultBindingMode;
        }
        return __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView;
    };
    SyntaxInterpreter.prototype.bind = function (resources, element, info, existingInstruction, context) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), info.defaultBindingMode === undefined || info.defaultBindingMode === null
            ? this.determineDefaultBindingMode(element, info.attrName, context)
            : info.defaultBindingMode, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype.trigger = function (resources, element, info) {
        return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].none, true, resources.lookupFunctions);
    };
    SyntaxInterpreter.prototype.capture = function (resources, element, info) {
        return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].capturing, true, resources.lookupFunctions);
    };
    SyntaxInterpreter.prototype.delegate = function (resources, element, info) {
        return new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ListenerExpression"](this.eventManager, info.attrName, this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["delegationStrategy"].bubbling, true, resources.lookupFunctions);
    };
    SyntaxInterpreter.prototype.call = function (resources, element, info, existingInstruction) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["CallExpression"](this.observerLocator, info.attrName, this.parser.parse(info.attrValue), resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype.options = function (resources, element, info, existingInstruction, context) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        var attrValue = info.attrValue;
        var language = this.language;
        var name = null;
        var target = '';
        var current;
        var i;
        var ii;
        var inString = false;
        var inEscape = false;
        var foundName = false;
        for (i = 0, ii = attrValue.length; i < ii; ++i) {
            current = attrValue[i];
            if (current === ';' && !inString) {
                if (!foundName) {
                    name = this._getPrimaryPropertyName(resources, context);
                }
                info = language.inspectAttribute(resources, '?', name, target.trim());
                language.createAttributeInstruction(resources, element, info, instruction, context);
                if (!instruction.attributes[info.attrName]) {
                    instruction.attributes[info.attrName] = info.attrValue;
                }
                target = '';
                name = null;
            }
            else if (current === ':' && name === null) {
                foundName = true;
                name = target.trim();
                target = '';
            }
            else if (current === '\\') {
                target += current;
                inEscape = true;
                continue;
            }
            else {
                target += current;
                if (name !== null && inEscape === false && current === '\'') {
                    inString = !inString;
                }
            }
            inEscape = false;
        }
        if (!foundName) {
            name = this._getPrimaryPropertyName(resources, context);
        }
        if (name !== null) {
            info = language.inspectAttribute(resources, '?', name, target.trim());
            language.createAttributeInstruction(resources, element, info, instruction, context);
            if (!instruction.attributes[info.attrName]) {
                instruction.attributes[info.attrName] = info.attrValue;
            }
        }
        return instruction;
    };
    SyntaxInterpreter.prototype._getPrimaryPropertyName = function (resources, context) {
        var type = resources.getAttribute(context.attributeName);
        if (type && type.primaryProperty) {
            return type.primaryProperty.attribute;
        }
        return null;
    };
    SyntaxInterpreter.prototype['for'] = function (resources, element, info, existingInstruction) {
        var parts;
        var keyValue;
        var instruction;
        var attrValue;
        var isDestructuring;
        attrValue = info.attrValue;
        isDestructuring = attrValue.match(/^ *[[].+[\]]/);
        parts = isDestructuring ? attrValue.split('of ') : attrValue.split(' of ');
        if (parts.length !== 2) {
            throw new Error('Incorrect syntax for "for". The form is: "$local of $items" or "[$key, $value] of $items".');
        }
        instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        if (isDestructuring) {
            keyValue = parts[0].replace(/[[\]]/g, '').replace(/,/g, ' ').replace(/\s+/g, ' ').trim().split(' ');
            instruction.attributes.key = keyValue[0];
            instruction.attributes.value = keyValue[1];
        }
        else {
            instruction.attributes.local = parts[0];
        }
        instruction.attributes.items = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, 'items', this.parser.parse(parts[1]), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype['two-way'] = function (resources, element, info, existingInstruction) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].twoWay, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype['to-view'] = function (resources, element, info, existingInstruction) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype['from-view'] = function (resources, element, info, existingInstruction) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].fromView, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.prototype['one-time'] = function (resources, element, info, existingInstruction) {
        var instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(info.attrName);
        instruction.attributes[info.attrName] = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["BindingExpression"](this.observerLocator, this.attributeMap.map(element.tagName, info.attrName), this.parser.parse(info.attrValue), __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].oneTime, resources.lookupFunctions);
        return instruction;
    };
    SyntaxInterpreter.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["Parser"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ObserverLocator"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["EventManager"], AttributeMap];
    return SyntaxInterpreter;
}());
Object.defineProperty(SyntaxInterpreter.prototype, 'one-way', Object.getOwnPropertyDescriptor(SyntaxInterpreter.prototype, 'to-view'));

var info = {};
var TemplatingBindingLanguage = (function (_super) {
    __extends(TemplatingBindingLanguage, _super);
    function TemplatingBindingLanguage(parser, observerLocator, syntaxInterpreter, attributeMap) {
        var _this = _super.call(this) || this;
        _this.parser = parser;
        _this.observerLocator = observerLocator;
        _this.syntaxInterpreter = syntaxInterpreter;
        _this.emptyStringExpression = _this.parser.parse('\'\'');
        syntaxInterpreter.language = _this;
        _this.attributeMap = attributeMap;
        _this.toBindingContextAttr = 'to-binding-context';
        return _this;
    }
    TemplatingBindingLanguage.prototype.inspectAttribute = function (resources, elementName, attrName, attrValue) {
        var parts = attrName.split('.');
        info.defaultBindingMode = null;
        if (parts.length === 2) {
            info.attrName = parts[0].trim();
            info.attrValue = attrValue;
            info.command = parts[1].trim();
            if (info.command === 'ref') {
                info.expression = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["NameExpression"](this.parser.parse(attrValue), info.attrName, resources.lookupFunctions);
                info.command = null;
                info.attrName = 'ref';
            }
            else {
                info.expression = null;
            }
        }
        else if (attrName === 'ref') {
            info.attrName = attrName;
            info.attrValue = attrValue;
            info.command = null;
            info.expression = new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["NameExpression"](this.parser.parse(attrValue), 'element', resources.lookupFunctions);
        }
        else {
            info.attrName = attrName;
            info.attrValue = attrValue;
            info.command = null;
            var interpolationParts = this.parseInterpolation(resources, attrValue);
            if (interpolationParts === null) {
                info.expression = null;
            }
            else {
                info.expression = new InterpolationBindingExpression(this.observerLocator, this.attributeMap.map(elementName, attrName), interpolationParts, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, resources.lookupFunctions, attrName);
            }
        }
        return info;
    };
    TemplatingBindingLanguage.prototype.createAttributeInstruction = function (resources, element, theInfo, existingInstruction, context) {
        var instruction;
        if (theInfo.expression) {
            if (theInfo.attrName === 'ref') {
                return theInfo.expression;
            }
            instruction = existingInstruction || __WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BehaviorInstruction"].attribute(theInfo.attrName);
            instruction.attributes[theInfo.attrName] = theInfo.expression;
        }
        else if (theInfo.command) {
            instruction = this.syntaxInterpreter.interpret(resources, element, theInfo, existingInstruction, context);
        }
        return instruction;
    };
    TemplatingBindingLanguage.prototype.createLetExpressions = function (resources, letElement) {
        var expressions = [];
        var attributes = letElement.attributes;
        var attr;
        var parts;
        var attrName;
        var attrValue;
        var command;
        var toBindingContextAttr = this.toBindingContextAttr;
        var toBindingContext = letElement.hasAttribute(toBindingContextAttr);
        for (var i = 0, ii = attributes.length; ii > i; ++i) {
            attr = attributes[i];
            attrName = attr.name;
            attrValue = attr.nodeValue;
            parts = attrName.split('.');
            if (attrName === toBindingContextAttr) {
                continue;
            }
            if (parts.length === 2) {
                command = parts[1];
                if (command !== 'bind') {
                    __WEBPACK_IMPORTED_MODULE_2_aurelia_logging__["getLogger"]('templating-binding-language')
                        .warn("Detected invalid let command. Expected \"".concat(parts[0], ".bind\", given \"").concat(attrName, "\""));
                    continue;
                }
                expressions.push(new LetExpression(this.observerLocator, __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(parts[0]), this.parser.parse(attrValue), resources.lookupFunctions, toBindingContext));
            }
            else {
                attrName = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["camelCase"])(attrName);
                parts = this.parseInterpolation(resources, attrValue);
                if (parts === null) {
                    __WEBPACK_IMPORTED_MODULE_2_aurelia_logging__["getLogger"]('templating-binding-language')
                        .warn("Detected string literal in let bindings. Did you mean \"".concat(attrName, ".bind=").concat(attrValue, "\" or \"").concat(attrName, "=${").concat(attrValue, "}\" ?"));
                }
                if (parts) {
                    expressions.push(new LetInterpolationBindingExpression(this.observerLocator, attrName, parts, resources.lookupFunctions, toBindingContext));
                }
                else {
                    expressions.push(new LetExpression(this.observerLocator, attrName, new __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["LiteralString"](attrValue), resources.lookupFunctions, toBindingContext));
                }
            }
        }
        return expressions;
    };
    TemplatingBindingLanguage.prototype.inspectTextContent = function (resources, value) {
        var parts = this.parseInterpolation(resources, value);
        if (parts === null) {
            return null;
        }
        return new InterpolationBindingExpression(this.observerLocator, 'textContent', parts, __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["bindingMode"].toView, resources.lookupFunctions, 'textContent');
    };
    TemplatingBindingLanguage.prototype.parseInterpolation = function (resources, value) {
        var i = value.indexOf('${', 0);
        var ii = value.length;
        var char;
        var pos = 0;
        var open = 0;
        var quote = null;
        var interpolationStart;
        var parts;
        var partIndex = 0;
        while (i >= 0 && i < ii - 2) {
            open = 1;
            interpolationStart = i;
            i += 2;
            do {
                char = value[i];
                i++;
                if (char === "'" || char === '"') {
                    if (quote === null) {
                        quote = char;
                    }
                    else if (quote === char) {
                        quote = null;
                    }
                    continue;
                }
                if (char === '\\') {
                    i++;
                    continue;
                }
                if (quote !== null) {
                    continue;
                }
                if (char === '{') {
                    open++;
                }
                else if (char === '}') {
                    open--;
                }
            } while (open > 0 && i < ii);
            if (open === 0) {
                parts = parts || [];
                if (value[interpolationStart - 1] === '\\' && value[interpolationStart - 2] !== '\\') {
                    parts[partIndex] = value.substring(pos, interpolationStart - 1) + value.substring(interpolationStart, i);
                    partIndex++;
                    parts[partIndex] = this.emptyStringExpression;
                    partIndex++;
                }
                else {
                    parts[partIndex] = value.substring(pos, interpolationStart);
                    partIndex++;
                    parts[partIndex] = this.parser.parse(value.substring(interpolationStart + 2, i - 1));
                    partIndex++;
                }
                pos = i;
                i = value.indexOf('${', i);
            }
            else {
                break;
            }
        }
        if (partIndex === 0) {
            return null;
        }
        parts[partIndex] = value.substr(pos);
        return parts;
    };
    TemplatingBindingLanguage.inject = [__WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["Parser"], __WEBPACK_IMPORTED_MODULE_1_aurelia_binding__["ObserverLocator"], SyntaxInterpreter, AttributeMap];
    return TemplatingBindingLanguage;
}(__WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BindingLanguage"]));

function configure(config) {
    config.container.registerSingleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BindingLanguage"], TemplatingBindingLanguage);
    config.container.registerAlias(__WEBPACK_IMPORTED_MODULE_0_aurelia_templating__["BindingLanguage"], TemplatingBindingLanguage);
}


//# sourceMappingURL=aurelia-templating-binding.js.map


/***/ },

/***/ "aurelia-templating-resources":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__ = __webpack_require__(138);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_loader__ = __webpack_require__("aurelia-loader");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_loader___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_aurelia_loader__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "AbstractRepeater", function() { return AbstractRepeater; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ArrayRepeatStrategy", function() { return ArrayRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "AttrBindingBehavior", function() { return AttrBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "BindingSignaler", function() { return BindingSignaler; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Compose", function() { return Compose; });
/* harmony export (binding) */ __webpack_require__.d(exports, "DebounceBindingBehavior", function() { return DebounceBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Else", function() { return Else; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Focus", function() { return Focus; });
/* harmony export (binding) */ __webpack_require__.d(exports, "FromViewBindingBehavior", function() { return FromViewBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "HTMLSanitizer", function() { return HTMLSanitizer; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Hide", function() { return Hide; });
/* harmony export (binding) */ __webpack_require__.d(exports, "If", function() { return If; });
/* harmony export (binding) */ __webpack_require__.d(exports, "MapRepeatStrategy", function() { return MapRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NullRepeatStrategy", function() { return NullRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "NumberRepeatStrategy", function() { return NumberRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "OneTimeBindingBehavior", function() { return OneTimeBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "OneWayBindingBehavior", function() { return OneWayBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Repeat", function() { return Repeat; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RepeatStrategyLocator", function() { return RepeatStrategyLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Replaceable", function() { return Replaceable; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SanitizeHTMLValueConverter", function() { return SanitizeHTMLValueConverter; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SelfBindingBehavior", function() { return SelfBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SetRepeatStrategy", function() { return SetRepeatStrategy; });
/* harmony export (binding) */ __webpack_require__.d(exports, "Show", function() { return Show; });
/* harmony export (binding) */ __webpack_require__.d(exports, "SignalBindingBehavior", function() { return SignalBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ThrottleBindingBehavior", function() { return ThrottleBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "ToViewBindingBehavior", function() { return ToViewBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TwoWayBindingBehavior", function() { return TwoWayBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "UpdateTriggerBindingBehavior", function() { return UpdateTriggerBindingBehavior; });
/* harmony export (binding) */ __webpack_require__.d(exports, "With", function() { return With; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });
/* harmony export (binding) */ __webpack_require__.d(exports, "createFullOverrideContext", function() { return createFullOverrideContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "getItemsSourceExpression", function() { return getItemsSourceExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "isOneTime", function() { return isOneTime; });
/* harmony export (binding) */ __webpack_require__.d(exports, "unwrapExpression", function() { return unwrapExpression; });
/* harmony export (binding) */ __webpack_require__.d(exports, "updateOneTimeBinding", function() { return updateOneTimeBinding; });
/* harmony export (binding) */ __webpack_require__.d(exports, "updateOverrideContext", function() { return updateOverrideContext; });
/* harmony export (binding) */ __webpack_require__.d(exports, "viewsRequireLifecycle", function() { return viewsRequireLifecycle; });










/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

var ActivationStrategy;
(function (ActivationStrategy) {
    ActivationStrategy["InvokeLifecycle"] = "invoke-lifecycle";
    ActivationStrategy["Replace"] = "replace";
})(ActivationStrategy || (ActivationStrategy = {}));
var Compose = (function () {
    function Compose(element, container, compositionEngine, viewSlot, viewResources, taskQueue) {
        this.activationStrategy = ActivationStrategy.InvokeLifecycle;
        this.element = element;
        this.container = container;
        this.compositionEngine = compositionEngine;
        this.viewSlot = viewSlot;
        this.viewResources = viewResources;
        this.taskQueue = taskQueue;
        this.currentController = null;
        this.currentViewModel = null;
        this.changes = Object.create(null);
    }
    Compose.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"], __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"]];
    };
    Compose.prototype.created = function (owningView) {
        this.owningView = owningView;
    };
    Compose.prototype.bind = function (bindingContext, overrideContext) {
        this.bindingContext = bindingContext;
        this.overrideContext = overrideContext;
        var changes = this.changes;
        changes.view = this.view;
        changes.viewModel = this.viewModel;
        changes.model = this.model;
        if (!this.pendingTask) {
            processChanges(this);
        }
    };
    Compose.prototype.unbind = function () {
        this.changes = Object.create(null);
        this.bindingContext = null;
        this.overrideContext = null;
        var returnToCache = true;
        var skipAnimation = true;
        this.viewSlot.removeAll(returnToCache, skipAnimation);
    };
    Compose.prototype.modelChanged = function (newValue, oldValue) {
        this.changes.model = newValue;
        requestUpdate(this);
    };
    Compose.prototype.viewChanged = function (newValue, oldValue) {
        this.changes.view = newValue;
        requestUpdate(this);
    };
    Compose.prototype.viewModelChanged = function (newValue, oldValue) {
        this.changes.viewModel = newValue;
        requestUpdate(this);
    };
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "model", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "view", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "viewModel", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "activationStrategy", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Compose.prototype, "swapOrder", void 0);
    Compose = __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["noView"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])('compose')
    ], Compose);
    return Compose;
}());
function isEmpty(obj) {
    for (var _ in obj) {
        return false;
    }
    return true;
}
function tryActivateViewModel(vm, model) {
    if (vm && typeof vm.activate === 'function') {
        return Promise.resolve(vm.activate(model));
    }
}
function createInstruction(composer, instruction) {
    return Object.assign(instruction, {
        bindingContext: composer.bindingContext,
        overrideContext: composer.overrideContext,
        owningView: composer.owningView,
        container: composer.container,
        viewSlot: composer.viewSlot,
        viewResources: composer.viewResources,
        currentController: composer.currentController,
        host: composer.element,
        swapOrder: composer.swapOrder
    });
}
function processChanges(composer) {
    var changes = composer.changes;
    composer.changes = Object.create(null);
    if (needsReInitialization(composer, changes)) {
        var instruction = {
            view: composer.view,
            viewModel: composer.currentViewModel || composer.viewModel,
            model: composer.model
        };
        instruction = Object.assign(instruction, changes);
        instruction = createInstruction(composer, instruction);
        composer.pendingTask = composer.compositionEngine.compose(instruction).then(function (controller) {
            composer.currentController = controller;
            composer.currentViewModel = controller ? controller.viewModel : null;
        });
    }
    else {
        composer.pendingTask = tryActivateViewModel(composer.currentViewModel, changes.model);
        if (!composer.pendingTask) {
            return;
        }
    }
    composer.pendingTask = composer.pendingTask
        .then(function () {
        completeCompositionTask(composer);
    }, function (reason) {
        completeCompositionTask(composer);
        throw reason;
    });
}
function completeCompositionTask(composer) {
    composer.pendingTask = null;
    if (!isEmpty(composer.changes)) {
        processChanges(composer);
    }
}
function requestUpdate(composer) {
    if (composer.pendingTask || composer.updateRequested) {
        return;
    }
    composer.updateRequested = true;
    composer.taskQueue.queueMicroTask(function () {
        composer.updateRequested = false;
        processChanges(composer);
    });
}
function needsReInitialization(composer, changes) {
    var activationStrategy = composer.activationStrategy;
    var vm = composer.currentViewModel;
    if (vm && typeof vm.determineActivationStrategy === 'function') {
        activationStrategy = vm.determineActivationStrategy();
    }
    return 'view' in changes
        || 'viewModel' in changes
        || activationStrategy === ActivationStrategy.Replace;
}

var IfCore = (function () {
    function IfCore(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.view = null;
        this.bindingContext = null;
        this.overrideContext = null;
        this.showing = false;
        this.cache = true;
    }
    IfCore.prototype.bind = function (bindingContext, overrideContext) {
        this.bindingContext = bindingContext;
        this.overrideContext = overrideContext;
    };
    IfCore.prototype.unbind = function () {
        if (this.view === null) {
            return;
        }
        this.view.unbind();
        if (!this.viewFactory.isCaching) {
            return;
        }
        if (this.showing) {
            this.showing = false;
            this.viewSlot.remove(this.view, true, true);
        }
        else {
            this.view.returnToCache();
        }
        this.view = null;
    };
    IfCore.prototype._show = function () {
        if (this.showing) {
            if (!this.view.isBound) {
                this.view.bind(this.bindingContext, this.overrideContext);
            }
            return;
        }
        if (this.view === null) {
            this.view = this.viewFactory.create();
        }
        if (!this.view.isBound) {
            this.view.bind(this.bindingContext, this.overrideContext);
        }
        this.showing = true;
        return this.viewSlot.add(this.view);
    };
    IfCore.prototype._hide = function () {
        var _this = this;
        if (!this.showing) {
            return;
        }
        this.showing = false;
        var removed = this.viewSlot.remove(this.view);
        if (removed instanceof Promise) {
            return removed.then(function () {
                _this._unbindView();
            });
        }
        this._unbindView();
    };
    IfCore.prototype._unbindView = function () {
        var cache = this.cache === 'false' ? false : !!this.cache;
        this.view.unbind();
        if (!cache) {
            this.view = null;
        }
    };
    return IfCore;
}());

var If = (function (_super) {
    __extends(If, _super);
    function If() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.cache = true;
        return _this;
    }
    If.prototype.bind = function (bindingContext, overrideContext) {
        _super.prototype.bind.call(this, bindingContext, overrideContext);
        if (this.condition) {
            this._show();
        }
        else {
            this._hide();
        }
    };
    If.prototype.conditionChanged = function (newValue) {
        this._update(newValue);
    };
    If.prototype._update = function (show) {
        var _this = this;
        if (this.animating) {
            return;
        }
        var promise;
        if (this.elseVm) {
            promise = show ? this._swap(this.elseVm, this) : this._swap(this, this.elseVm);
        }
        else {
            promise = show ? this._show() : this._hide();
        }
        if (promise) {
            this.animating = true;
            promise.then(function () {
                _this.animating = false;
                if (_this.condition !== _this.showing) {
                    _this._update(_this.condition);
                }
            });
        }
    };
    If.prototype._swap = function (remove, add) {
        switch (this.swapOrder) {
            case 'before':
                return Promise.resolve(add._show()).then(function () { return remove._hide(); });
            case 'with':
                return Promise.all([remove._hide(), add._show()]);
            default:
                var promise = remove._hide();
                return promise ? promise.then(function () { return add._show(); }) : add._show();
        }
    };
    __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"])({ primaryProperty: true })
    ], If.prototype, "condition", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], If.prototype, "swapOrder", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], If.prototype, "cache", void 0);
    If = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('if'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], If);
    return If;
}(IfCore));

var Else = (function (_super) {
    __extends(Else, _super);
    function Else(viewFactory, viewSlot) {
        var _this = _super.call(this, viewFactory, viewSlot) || this;
        _this._registerInIf();
        return _this;
    }
    Else.prototype.bind = function (bindingContext, overrideContext) {
        _super.prototype.bind.call(this, bindingContext, overrideContext);
        if (this.ifVm.condition) {
            this._hide();
        }
        else {
            this._show();
        }
    };
    Else.prototype._registerInIf = function () {
        var previous = this.viewSlot.anchor.previousSibling;
        while (previous && !previous.au) {
            previous = previous.previousSibling;
        }
        if (!previous || !previous.au.if) {
            throw new Error("Can't find matching If for Else custom attribute.");
        }
        this.ifVm = previous.au.if.viewModel;
        this.ifVm.elseVm = this;
    };
    Else = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('else'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], Else);
    return Else;
}(IfCore));

var With = (function () {
    function With(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.parentOverrideContext = null;
        this.view = null;
    }
    With.prototype.bind = function (bindingContext, overrideContext) {
        this.parentOverrideContext = overrideContext;
        this.valueChanged(this.value);
    };
    With.prototype.valueChanged = function (newValue) {
        var overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["createOverrideContext"])(newValue, this.parentOverrideContext);
        var view = this.view;
        if (!view) {
            view = this.view = this.viewFactory.create();
            view.bind(newValue, overrideContext);
            this.viewSlot.add(view);
        }
        else {
            view.bind(newValue, overrideContext);
        }
    };
    With.prototype.unbind = function () {
        var view = this.view;
        this.parentOverrideContext = null;
        if (view) {
            view.unbind();
        }
    };
    With = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('with'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], With);
    return With;
}());

var oneTime = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].oneTime;
function updateOverrideContexts(views, startIndex) {
    var length = views.length;
    if (startIndex > 0) {
        startIndex = startIndex - 1;
    }
    for (; startIndex < length; ++startIndex) {
        updateOverrideContext(views[startIndex].overrideContext, startIndex, length);
    }
}
function createFullOverrideContext(repeat, data, index, length, key) {
    var bindingContext = {};
    var overrideContext = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["createOverrideContext"])(bindingContext, repeat.scope.overrideContext);
    if (typeof key !== 'undefined') {
        bindingContext[repeat.key] = key;
        bindingContext[repeat.value] = data;
    }
    else {
        bindingContext[repeat.local] = data;
    }
    updateOverrideContext(overrideContext, index, length);
    return overrideContext;
}
function updateOverrideContext(overrideContext, index, length) {
    var first = (index === 0);
    var last = (index === length - 1);
    var even = index % 2 === 0;
    overrideContext.$index = index;
    overrideContext.$first = first;
    overrideContext.$last = last;
    overrideContext.$middle = !(first || last);
    overrideContext.$odd = !even;
    overrideContext.$even = even;
}
function getItemsSourceExpression(instruction, attrName) {
    return instruction.behaviorInstructions
        .filter(function (bi) { return bi.originalAttrName === attrName; })[0]
        .attributes
        .items
        .sourceExpression;
}
function unwrapExpression(expression) {
    var unwrapped = false;
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["BindingBehavior"]) {
        expression = expression.expression;
    }
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["ValueConverter"]) {
        expression = expression.expression;
        unwrapped = true;
    }
    return unwrapped ? expression : null;
}
function isOneTime(expression) {
    while (expression instanceof __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["BindingBehavior"]) {
        if (expression.name === 'oneTime') {
            return true;
        }
        expression = expression.expression;
    }
    return false;
}
function updateOneTimeBinding(binding) {
    if (binding.call && binding.mode === oneTime) {
        binding.call(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"]);
    }
    else if (binding.updateOneTimeBindings) {
        binding.updateOneTimeBindings();
    }
}
function indexOf(array, item, matcher, startIndex) {
    if (!matcher) {
        return array.indexOf(item);
    }
    var length = array.length;
    for (var index = startIndex || 0; index < length; index++) {
        if (matcher(array[index], item)) {
            return index;
        }
    }
    return -1;
}

var ArrayRepeatStrategy = (function () {
    function ArrayRepeatStrategy() {
    }
    ArrayRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getArrayObserver(items);
    };
    ArrayRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var $repeat = repeat;
        var itemsLength = items.length;
        if (!items || itemsLength === 0) {
            $repeat.removeAllViews(true, !$repeat.viewsRequireLifecycle);
            return;
        }
        var children = $repeat.views();
        var viewsLength = children.length;
        if (viewsLength === 0) {
            this._standardProcessInstanceChanged($repeat, items);
            return;
        }
        if ($repeat.viewsRequireLifecycle) {
            var childrenSnapshot = children.slice(0);
            var itemNameInBindingContext = $repeat.local;
            var matcher_1 = $repeat.matcher();
            var itemsPreviouslyInViews_1 = [];
            var viewsToRemove = [];
            for (var index = 0; index < viewsLength; index++) {
                var view = childrenSnapshot[index];
                var oldItem = view.bindingContext[itemNameInBindingContext];
                if (indexOf(items, oldItem, matcher_1) === -1) {
                    viewsToRemove.push(view);
                }
                else {
                    itemsPreviouslyInViews_1.push(oldItem);
                }
            }
            var updateViews = void 0;
            var removePromise = void 0;
            if (itemsPreviouslyInViews_1.length > 0) {
                removePromise = $repeat.removeViews(viewsToRemove, true, !$repeat.viewsRequireLifecycle);
                updateViews = function () {
                    for (var index = 0; index < itemsLength; index++) {
                        var item = items[index];
                        var indexOfView = indexOf(itemsPreviouslyInViews_1, item, matcher_1, index);
                        var view = void 0;
                        if (indexOfView === -1) {
                            var overrideContext = createFullOverrideContext($repeat, items[index], index, itemsLength);
                            $repeat.insertView(index, overrideContext.bindingContext, overrideContext);
                            itemsPreviouslyInViews_1.splice(index, 0, undefined);
                        }
                        else if (indexOfView === index) {
                            view = children[indexOfView];
                            itemsPreviouslyInViews_1[indexOfView] = undefined;
                        }
                        else {
                            view = children[indexOfView];
                            $repeat.moveView(indexOfView, index);
                            itemsPreviouslyInViews_1.splice(indexOfView, 1);
                            itemsPreviouslyInViews_1.splice(index, 0, undefined);
                        }
                        if (view) {
                            updateOverrideContext(view.overrideContext, index, itemsLength);
                        }
                    }
                    _this._inPlaceProcessItems($repeat, items);
                };
            }
            else {
                removePromise = $repeat.removeAllViews(true, !$repeat.viewsRequireLifecycle);
                updateViews = function () { return _this._standardProcessInstanceChanged($repeat, items); };
            }
            if (removePromise instanceof Promise) {
                removePromise.then(updateViews);
            }
            else {
                updateViews();
            }
        }
        else {
            this._inPlaceProcessItems($repeat, items);
        }
    };
    ArrayRepeatStrategy.prototype._standardProcessInstanceChanged = function (repeat, items) {
        for (var i = 0, ii = items.length; i < ii; i++) {
            var overrideContext = createFullOverrideContext(repeat, items[i], i, ii);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
    };
    ArrayRepeatStrategy.prototype._inPlaceProcessItems = function (repeat, items) {
        var itemsLength = items.length;
        var viewsLength = repeat.viewCount();
        while (viewsLength > itemsLength) {
            viewsLength--;
            repeat.removeView(viewsLength, true, !repeat.viewsRequireLifecycle);
        }
        var local = repeat.local;
        for (var i = 0; i < viewsLength; i++) {
            var view = repeat.view(i);
            var last = i === itemsLength - 1;
            var middle = i !== 0 && !last;
            var bindingContext = view.bindingContext;
            var overrideContext = view.overrideContext;
            if (bindingContext[local] === items[i]
                && overrideContext.$middle === middle
                && overrideContext.$last === last) {
                continue;
            }
            bindingContext[local] = items[i];
            overrideContext.$middle = middle;
            overrideContext.$last = last;
            repeat.updateBindings(view);
        }
        for (var i = viewsLength; i < itemsLength; i++) {
            var overrideContext = createFullOverrideContext(repeat, items[i], i, itemsLength);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
    };
    ArrayRepeatStrategy.prototype.instanceMutated = function (repeat, array, splices) {
        var _this = this;
        if (repeat.__queuedSplices) {
            for (var i = 0, ii = splices.length; i < ii; ++i) {
                var _a = splices[i], index = _a.index, removed = _a.removed, addedCount = _a.addedCount;
                __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["mergeSplice"])(repeat.__queuedSplices, index, removed, addedCount);
            }
            repeat.__array = array.slice(0);
            return;
        }
        var maybePromise = this._runSplices(repeat, array.slice(0), splices);
        if (maybePromise instanceof Promise) {
            var queuedSplices_1 = repeat.__queuedSplices = [];
            var runQueuedSplices_1 = function () {
                if (!queuedSplices_1.length) {
                    repeat.__queuedSplices = undefined;
                    repeat.__array = undefined;
                    return;
                }
                var nextPromise = _this._runSplices(repeat, repeat.__array, queuedSplices_1) || Promise.resolve();
                queuedSplices_1 = repeat.__queuedSplices = [];
                nextPromise.then(runQueuedSplices_1);
            };
            maybePromise.then(runQueuedSplices_1);
        }
    };
    ArrayRepeatStrategy.prototype._runSplices = function (repeat, array, splices) {
        var _this = this;
        var removeDelta = 0;
        var rmPromises = [];
        for (var i = 0, ii = splices.length; i < ii; ++i) {
            var splice = splices[i];
            var removed = splice.removed;
            for (var j = 0, jj = removed.length; j < jj; ++j) {
                var viewOrPromise = repeat.removeView(splice.index + removeDelta + rmPromises.length, true);
                if (viewOrPromise instanceof Promise) {
                    rmPromises.push(viewOrPromise);
                }
            }
            removeDelta -= splice.addedCount;
        }
        if (rmPromises.length > 0) {
            return Promise.all(rmPromises).then(function () {
                var spliceIndexLow = _this._handleAddedSplices(repeat, array, splices);
                updateOverrideContexts(repeat.views(), spliceIndexLow);
            });
        }
        var spliceIndexLow = this._handleAddedSplices(repeat, array, splices);
        updateOverrideContexts(repeat.views(), spliceIndexLow);
        return undefined;
    };
    ArrayRepeatStrategy.prototype._handleAddedSplices = function (repeat, array, splices) {
        var spliceIndex;
        var spliceIndexLow;
        var arrayLength = array.length;
        for (var i = 0, ii = splices.length; i < ii; ++i) {
            var splice = splices[i];
            var addIndex = spliceIndex = splice.index;
            var end = splice.index + splice.addedCount;
            if (typeof spliceIndexLow === 'undefined' || spliceIndexLow === null || spliceIndexLow > splice.index) {
                spliceIndexLow = spliceIndex;
            }
            for (; addIndex < end; ++addIndex) {
                var overrideContext = createFullOverrideContext(repeat, array[addIndex], addIndex, arrayLength);
                repeat.insertView(addIndex, overrideContext.bindingContext, overrideContext);
            }
        }
        return spliceIndexLow;
    };
    return ArrayRepeatStrategy;
}());

var MapRepeatStrategy = (function () {
    function MapRepeatStrategy() {
    }
    MapRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getMapObserver(items);
    };
    MapRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, items); });
            return;
        }
        this._standardProcessItems(repeat, items);
    };
    MapRepeatStrategy.prototype._standardProcessItems = function (repeat, items) {
        var index = 0;
        var overrideContext;
        items.forEach(function (value, key) {
            overrideContext = createFullOverrideContext(repeat, value, index, items.size, key);
            repeat.addView(overrideContext.bindingContext, overrideContext);
            ++index;
        });
    };
    MapRepeatStrategy.prototype.instanceMutated = function (repeat, map, records) {
        var key;
        var i;
        var ii;
        var overrideContext;
        var removeIndex;
        var addIndex;
        var record;
        var rmPromises = [];
        var viewOrPromise;
        for (i = 0, ii = records.length; i < ii; ++i) {
            record = records[i];
            key = record.key;
            switch (record.type) {
                case 'update':
                    removeIndex = this._getViewIndexByKey(repeat, key);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    overrideContext = createFullOverrideContext(repeat, map.get(key), removeIndex, map.size, key);
                    repeat.insertView(removeIndex, overrideContext.bindingContext, overrideContext);
                    break;
                case 'add':
                    addIndex = repeat.viewCount() <= map.size - 1 ? repeat.viewCount() : map.size - 1;
                    overrideContext = createFullOverrideContext(repeat, map.get(key), addIndex, map.size, key);
                    repeat.insertView(map.size - 1, overrideContext.bindingContext, overrideContext);
                    break;
                case 'delete':
                    if (record.oldValue === undefined) {
                        return;
                    }
                    removeIndex = this._getViewIndexByKey(repeat, key);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    break;
                case 'clear':
                    repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
                    break;
                default:
                    continue;
            }
        }
        if (rmPromises.length > 0) {
            Promise.all(rmPromises).then(function () {
                updateOverrideContexts(repeat.views(), 0);
            });
        }
        else {
            updateOverrideContexts(repeat.views(), 0);
        }
    };
    MapRepeatStrategy.prototype._getViewIndexByKey = function (repeat, key) {
        var i;
        var ii;
        var child;
        for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
            child = repeat.view(i);
            if (child.bindingContext[repeat.key] === key) {
                return i;
            }
        }
        return undefined;
    };
    return MapRepeatStrategy;
}());

var NullRepeatStrategy = (function () {
    function NullRepeatStrategy() {
    }
    NullRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        repeat.removeAllViews(true);
    };
    NullRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
    };
    return NullRepeatStrategy;
}());

var NumberRepeatStrategy = (function () {
    function NumberRepeatStrategy() {
    }
    NumberRepeatStrategy.prototype.getCollectionObserver = function () {
        return null;
    };
    NumberRepeatStrategy.prototype.instanceChanged = function (repeat, value) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, value); });
            return;
        }
        this._standardProcessItems(repeat, value);
    };
    NumberRepeatStrategy.prototype._standardProcessItems = function (repeat, value) {
        var childrenLength = repeat.viewCount();
        var i;
        var ii;
        var overrideContext;
        var viewsToRemove;
        value = Math.floor(value);
        viewsToRemove = childrenLength - value;
        if (viewsToRemove > 0) {
            if (viewsToRemove > childrenLength) {
                viewsToRemove = childrenLength;
            }
            for (i = 0, ii = viewsToRemove; i < ii; ++i) {
                repeat.removeView(childrenLength - (i + 1), true, !repeat.viewsRequireLifecycle);
            }
            return;
        }
        for (i = childrenLength, ii = value; i < ii; ++i) {
            overrideContext = createFullOverrideContext(repeat, i, i, ii);
            repeat.addView(overrideContext.bindingContext, overrideContext);
        }
        updateOverrideContexts(repeat.views(), 0);
    };
    return NumberRepeatStrategy;
}());

var SetRepeatStrategy = (function () {
    function SetRepeatStrategy() {
    }
    SetRepeatStrategy.prototype.getCollectionObserver = function (observerLocator, items) {
        return observerLocator.getSetObserver(items);
    };
    SetRepeatStrategy.prototype.instanceChanged = function (repeat, items) {
        var _this = this;
        var removePromise = repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
        if (removePromise instanceof Promise) {
            removePromise.then(function () { return _this._standardProcessItems(repeat, items); });
            return;
        }
        this._standardProcessItems(repeat, items);
    };
    SetRepeatStrategy.prototype._standardProcessItems = function (repeat, items) {
        var index = 0;
        var overrideContext;
        items.forEach(function (value) {
            overrideContext = createFullOverrideContext(repeat, value, index, items.size);
            repeat.addView(overrideContext.bindingContext, overrideContext);
            ++index;
        });
    };
    SetRepeatStrategy.prototype.instanceMutated = function (repeat, set, records) {
        var value;
        var i;
        var ii;
        var overrideContext;
        var removeIndex;
        var record;
        var rmPromises = [];
        var viewOrPromise;
        for (i = 0, ii = records.length; i < ii; ++i) {
            record = records[i];
            value = record.value;
            switch (record.type) {
                case 'add':
                    var size = Math.max(set.size - 1, 0);
                    overrideContext = createFullOverrideContext(repeat, value, size, set.size);
                    repeat.insertView(size, overrideContext.bindingContext, overrideContext);
                    break;
                case 'delete':
                    removeIndex = this._getViewIndexByValue(repeat, value);
                    viewOrPromise = repeat.removeView(removeIndex, true, !repeat.viewsRequireLifecycle);
                    if (viewOrPromise instanceof Promise) {
                        rmPromises.push(viewOrPromise);
                    }
                    break;
                case 'clear':
                    repeat.removeAllViews(true, !repeat.viewsRequireLifecycle);
                    break;
                default:
                    continue;
            }
        }
        if (rmPromises.length > 0) {
            Promise.all(rmPromises).then(function () {
                updateOverrideContexts(repeat.views(), 0);
            });
        }
        else {
            updateOverrideContexts(repeat.views(), 0);
        }
    };
    SetRepeatStrategy.prototype._getViewIndexByValue = function (repeat, value) {
        var i;
        var ii;
        var child;
        for (i = 0, ii = repeat.viewCount(); i < ii; ++i) {
            child = repeat.view(i);
            if (child.bindingContext[repeat.local] === value) {
                return i;
            }
        }
        return undefined;
    };
    return SetRepeatStrategy;
}());

var RepeatStrategyLocator = (function () {
    function RepeatStrategyLocator() {
        this.matchers = [];
        this.strategies = [];
        this.addStrategy(function (items) { return items === null || items === undefined; }, new NullRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Array; }, new ArrayRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Map; }, new MapRepeatStrategy());
        this.addStrategy(function (items) { return items instanceof Set; }, new SetRepeatStrategy());
        this.addStrategy(function (items) { return typeof items === 'number'; }, new NumberRepeatStrategy());
    }
    RepeatStrategyLocator.prototype.addStrategy = function (matcher, strategy) {
        this.matchers.push(matcher);
        this.strategies.push(strategy);
    };
    RepeatStrategyLocator.prototype.getStrategy = function (items) {
        var matchers = this.matchers;
        for (var i = 0, ii = matchers.length; i < ii; ++i) {
            if (matchers[i](items)) {
                return this.strategies[i];
            }
        }
        return null;
    };
    return RepeatStrategyLocator;
}());

var lifecycleOptionalBehaviors = ['focus', 'if', 'else', 'repeat', 'show', 'hide', 'with'];
function behaviorRequiresLifecycle(instruction) {
    var t = instruction.type;
    var name = t.elementName !== null ? t.elementName : t.attributeName;
    return lifecycleOptionalBehaviors.indexOf(name) === -1 && (t.handlesAttached || t.handlesBind || t.handlesCreated || t.handlesDetached || t.handlesUnbind)
        || t.viewFactory && viewsRequireLifecycle(t.viewFactory)
        || instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}
function targetRequiresLifecycle(instruction) {
    var behaviors = instruction.behaviorInstructions;
    if (behaviors) {
        var i = behaviors.length;
        while (i--) {
            if (behaviorRequiresLifecycle(behaviors[i])) {
                return true;
            }
        }
    }
    return instruction.viewFactory && viewsRequireLifecycle(instruction.viewFactory);
}
function viewsRequireLifecycle(viewFactory) {
    if ('_viewsRequireLifecycle' in viewFactory) {
        return viewFactory._viewsRequireLifecycle;
    }
    viewFactory._viewsRequireLifecycle = false;
    if (viewFactory.viewFactory) {
        viewFactory._viewsRequireLifecycle = viewsRequireLifecycle(viewFactory.viewFactory);
        return viewFactory._viewsRequireLifecycle;
    }
    if (viewFactory.template.querySelector('.au-animate')) {
        viewFactory._viewsRequireLifecycle = true;
        return true;
    }
    for (var id in viewFactory.instructions) {
        if (targetRequiresLifecycle(viewFactory.instructions[id])) {
            viewFactory._viewsRequireLifecycle = true;
            return true;
        }
    }
    viewFactory._viewsRequireLifecycle = false;
    return false;
}

var AbstractRepeater = (function () {
    function AbstractRepeater(options) {
        Object.assign(this, {
            local: 'items',
            viewsRequireLifecycle: true
        }, options);
    }
    AbstractRepeater.prototype.viewCount = function () {
        throw new Error('subclass must implement `viewCount`');
    };
    AbstractRepeater.prototype.views = function () {
        throw new Error('subclass must implement `views`');
    };
    AbstractRepeater.prototype.view = function (index) {
        throw new Error('subclass must implement `view`');
    };
    AbstractRepeater.prototype.matcher = function () {
        throw new Error('subclass must implement `matcher`');
    };
    AbstractRepeater.prototype.addView = function (bindingContext, overrideContext) {
        throw new Error('subclass must implement `addView`');
    };
    AbstractRepeater.prototype.insertView = function (index, bindingContext, overrideContext) {
        throw new Error('subclass must implement `insertView`');
    };
    AbstractRepeater.prototype.moveView = function (sourceIndex, targetIndex) {
        throw new Error('subclass must implement `moveView`');
    };
    AbstractRepeater.prototype.removeAllViews = function (returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeAllViews`');
    };
    AbstractRepeater.prototype.removeViews = function (viewsToRemove, returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeView`');
    };
    AbstractRepeater.prototype.removeView = function (index, returnToCache, skipAnimation) {
        throw new Error('subclass must implement `removeView`');
    };
    AbstractRepeater.prototype.updateBindings = function (view) {
        throw new Error('subclass must implement `updateBindings`');
    };
    return AbstractRepeater;
}());

var matcherExtractionMarker = '__marker_extracted__';
var Repeat = (function (_super) {
    __extends(Repeat, _super);
    function Repeat(viewFactory, instruction, viewSlot, viewResources, observerLocator, strategyLocator) {
        var _this = _super.call(this, {
            local: 'item',
            viewsRequireLifecycle: viewsRequireLifecycle(viewFactory)
        }) || this;
        _this.viewFactory = viewFactory;
        _this.instruction = instruction;
        _this.viewSlot = viewSlot;
        _this.lookupFunctions = viewResources.lookupFunctions;
        _this.observerLocator = observerLocator;
        _this.key = 'key';
        _this.value = 'value';
        _this.strategyLocator = strategyLocator;
        _this.ignoreMutation = false;
        _this.sourceExpression = getItemsSourceExpression(_this.instruction, 'repeat.for');
        _this.isOneTime = isOneTime(_this.sourceExpression);
        _this.viewsRequireLifecycle = viewsRequireLifecycle(viewFactory);
        return _this;
    }
    Repeat_1 = Repeat;
    Repeat.prototype.call = function (context, changes) {
        this[context](this.items, changes);
    };
    Repeat.prototype.bind = function (bindingContext, overrideContext) {
        this.scope = { bindingContext: bindingContext, overrideContext: overrideContext };
        var instruction = this.instruction;
        if (!(matcherExtractionMarker in instruction)) {
            instruction[matcherExtractionMarker] = this._captureAndRemoveMatcherBinding();
        }
        this.matcherBinding = instruction[matcherExtractionMarker];
        this.itemsChanged();
    };
    Repeat.prototype.unbind = function () {
        this.scope = null;
        this.items = null;
        this.matcherBinding = null;
        this.viewSlot.removeAll(true, true);
        this._unsubscribeCollection();
    };
    Repeat.prototype._unsubscribeCollection = function () {
        if (this.collectionObserver) {
            this.collectionObserver.unsubscribe(this.callContext, this);
            this.collectionObserver = null;
            this.callContext = null;
        }
    };
    Repeat.prototype.itemsChanged = function () {
        var _this = this;
        this._unsubscribeCollection();
        if (!this.scope) {
            return;
        }
        var items = this.items;
        this.strategy = this.strategyLocator.getStrategy(items);
        if (!this.strategy) {
            throw new Error("Value for '".concat(this.sourceExpression, "' is non-repeatable"));
        }
        if (!this.isOneTime && !this._observeInnerCollection()) {
            this._observeCollection();
        }
        this.ignoreMutation = true;
        this.strategy.instanceChanged(this, items);
        this.observerLocator.taskQueue.queueMicroTask(function () {
            _this.ignoreMutation = false;
        });
    };
    Repeat.prototype._getInnerCollection = function () {
        var expression = unwrapExpression(this.sourceExpression);
        if (!expression) {
            return null;
        }
        return expression.evaluate(this.scope, null);
    };
    Repeat.prototype.handleCollectionMutated = function (collection, changes) {
        if (!this.collectionObserver) {
            return;
        }
        if (this.ignoreMutation) {
            return;
        }
        this.strategy.instanceMutated(this, collection, changes);
    };
    Repeat.prototype.handleInnerCollectionMutated = function (collection, changes) {
        var _this = this;
        if (!this.collectionObserver) {
            return;
        }
        if (this.ignoreMutation) {
            return;
        }
        this.ignoreMutation = true;
        var newItems = this.sourceExpression.evaluate(this.scope, this.lookupFunctions);
        this.observerLocator.taskQueue.queueMicroTask(function () { return _this.ignoreMutation = false; });
        if (newItems === this.items) {
            this.itemsChanged();
        }
        else {
            this.items = newItems;
        }
    };
    Repeat.prototype._observeInnerCollection = function () {
        var items = this._getInnerCollection();
        var strategy = this.strategyLocator.getStrategy(items);
        if (!strategy) {
            return false;
        }
        this.collectionObserver = strategy.getCollectionObserver(this.observerLocator, items);
        if (!this.collectionObserver) {
            return false;
        }
        this.callContext = 'handleInnerCollectionMutated';
        this.collectionObserver.subscribe(this.callContext, this);
        return true;
    };
    Repeat.prototype._observeCollection = function () {
        var items = this.items;
        this.collectionObserver = this.strategy.getCollectionObserver(this.observerLocator, items);
        if (this.collectionObserver) {
            this.callContext = 'handleCollectionMutated';
            this.collectionObserver.subscribe(this.callContext, this);
        }
    };
    Repeat.prototype._captureAndRemoveMatcherBinding = function () {
        var viewFactory = this.viewFactory.viewFactory;
        if (viewFactory) {
            var template = viewFactory.template;
            var instructions = viewFactory.instructions;
            if (Repeat_1.useInnerMatcher) {
                return extractMatcherBindingExpression(instructions);
            }
            if (getChildrenCount(template) > 1) {
                return undefined;
            }
            var repeatedElement = getFirstElementChild(template);
            if (!repeatedElement.hasAttribute('au-target-id')) {
                return undefined;
            }
            var repeatedElementTargetId = repeatedElement.getAttribute('au-target-id');
            return extractMatcherBindingExpression(instructions, repeatedElementTargetId);
        }
        return undefined;
    };
    Repeat.prototype.viewCount = function () { return this.viewSlot.children.length; };
    Repeat.prototype.views = function () { return this.viewSlot.children; };
    Repeat.prototype.view = function (index) { return this.viewSlot.children[index]; };
    Repeat.prototype.matcher = function () {
        var matcherBinding = this.matcherBinding;
        return matcherBinding
            ? matcherBinding.sourceExpression.evaluate(this.scope, matcherBinding.lookupFunctions)
            : null;
    };
    Repeat.prototype.addView = function (bindingContext, overrideContext) {
        var view = this.viewFactory.create();
        view.bind(bindingContext, overrideContext);
        this.viewSlot.add(view);
    };
    Repeat.prototype.insertView = function (index, bindingContext, overrideContext) {
        var view = this.viewFactory.create();
        view.bind(bindingContext, overrideContext);
        this.viewSlot.insert(index, view);
    };
    Repeat.prototype.moveView = function (sourceIndex, targetIndex) {
        this.viewSlot.move(sourceIndex, targetIndex);
    };
    Repeat.prototype.removeAllViews = function (returnToCache, skipAnimation) {
        return this.viewSlot.removeAll(returnToCache, skipAnimation);
    };
    Repeat.prototype.removeViews = function (viewsToRemove, returnToCache, skipAnimation) {
        return this.viewSlot.removeMany(viewsToRemove, returnToCache, skipAnimation);
    };
    Repeat.prototype.removeView = function (index, returnToCache, skipAnimation) {
        return this.viewSlot.removeAt(index, returnToCache, skipAnimation);
    };
    Repeat.prototype.updateBindings = function (view) {
        var $view = view;
        var j = $view.bindings.length;
        while (j--) {
            updateOneTimeBinding($view.bindings[j]);
        }
        j = $view.controllers.length;
        while (j--) {
            var k = $view.controllers[j].boundProperties.length;
            while (k--) {
                var binding = $view.controllers[j].boundProperties[k].binding;
                updateOneTimeBinding(binding);
            }
        }
    };
    var Repeat_1;
    Repeat.useInnerMatcher = true;
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "items", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "local", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "key", void 0);
    __decorate([
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"]
    ], Repeat.prototype, "value", void 0);
    Repeat = Repeat_1 = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('repeat'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["TargetInstruction"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewResources"], __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["ObserverLocator"], RepeatStrategyLocator)
    ], Repeat);
    return Repeat;
}(AbstractRepeater));
var extractMatcherBindingExpression = function (instructions, targetedElementId) {
    var instructionIds = Object.keys(instructions);
    for (var i = 0; i < instructionIds.length; i++) {
        var instructionId = instructionIds[i];
        if (targetedElementId !== undefined && instructionId !== targetedElementId) {
            continue;
        }
        var expressions = instructions[instructionId].expressions;
        if (expressions) {
            for (var ii = 0; ii < expressions.length; ii++) {
                if (expressions[ii].targetProperty === 'matcher') {
                    var matcherBindingExpression = expressions[ii];
                    expressions.splice(ii, 1);
                    return matcherBindingExpression;
                }
            }
        }
    }
};
var getChildrenCount = function (el) {
    var childNodes = el.childNodes;
    var count = 0;
    for (var i = 0, ii = childNodes.length; ii > i; ++i) {
        if (childNodes[i].nodeType === 1) {
            ++count;
        }
    }
    return count;
};
var getFirstElementChild = function (el) {
    var firstChild = el.firstChild;
    while (firstChild !== null) {
        if (firstChild.nodeType === 1) {
            return firstChild;
        }
        firstChild = firstChild.nextSibling;
    }
    return null;
};

var aureliaHideClassName = 'aurelia-hide';
var aureliaHideClass = ".".concat(aureliaHideClassName, " { display:none !important; }");
function injectAureliaHideStyleAtHead() {
    __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(aureliaHideClass);
}
function injectAureliaHideStyleAtBoundary(domBoundary) {
    if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["FEATURE"].shadowDOM && domBoundary && !domBoundary.hasAureliaHideStyle) {
        domBoundary.hasAureliaHideStyle = true;
        __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(aureliaHideClass, domBoundary);
    }
}

var Show = (function () {
    function Show(element, animator, domBoundary) {
        this.element = element;
        this.animator = animator;
        this.domBoundary = domBoundary;
    }
    Show.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Animator"], __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Optional"].of(__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].boundary, true)];
    };
    Show.prototype.created = function () {
        injectAureliaHideStyleAtBoundary(this.domBoundary);
    };
    Show.prototype.valueChanged = function (newValue) {
        var element = this.element;
        var animator = this.animator;
        if (newValue) {
            animator.removeClass(element, aureliaHideClassName);
        }
        else {
            animator.addClass(element, aureliaHideClassName);
        }
    };
    Show.prototype.bind = function (bindingContext) {
        this.valueChanged(this.value);
    };
    Show = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('show')
    ], Show);
    return Show;
}());

var Hide = (function () {
    function Hide(element, animator, domBoundary) {
        this.element = element;
        this.animator = animator;
        this.domBoundary = domBoundary;
    }
    Hide.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["Animator"], __WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["Optional"].of(__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].boundary, true)];
    };
    Hide.prototype.created = function () {
        injectAureliaHideStyleAtBoundary(this.domBoundary);
    };
    Hide.prototype.valueChanged = function (newValue) {
        if (newValue) {
            this.animator.addClass(this.element, aureliaHideClassName);
        }
        else {
            this.animator.removeClass(this.element, aureliaHideClassName);
        }
    };
    Hide.prototype.bind = function (bindingContext) {
        this.valueChanged(this.value);
    };
    Hide.prototype.value = function (value) {
        throw new Error('Method not implemented.');
    };
    Hide = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('hide')
    ], Hide);
    return Hide;
}());

var HTMLSanitizer = (function () {
    function HTMLSanitizer() {
    }
    HTMLSanitizer.prototype.sanitize = function (input) {
        throw new Error("To protect the application against a wide variety of sophisticated XSS attacks.\nPlease see https://aurelia.io/docs/binding/basics#element-content for instructions on how to use a secure solution like DOMPurify or sanitize-html.");
    };
    return HTMLSanitizer;
}());

var SanitizeHTMLValueConverter = (function () {
    function SanitizeHTMLValueConverter(sanitizer) {
        this.sanitizer = sanitizer;
    }
    SanitizeHTMLValueConverter.prototype.toView = function (untrustedMarkup) {
        if (untrustedMarkup === null || untrustedMarkup === undefined) {
            return null;
        }
        return this.sanitizer.sanitize(untrustedMarkup);
    };
    SanitizeHTMLValueConverter = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["valueConverter"])('sanitizeHTML'),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(HTMLSanitizer)
    ], SanitizeHTMLValueConverter);
    return SanitizeHTMLValueConverter;
}());

var Replaceable = (function () {
    function Replaceable(viewFactory, viewSlot) {
        this.viewFactory = viewFactory;
        this.viewSlot = viewSlot;
        this.view = null;
    }
    Replaceable.prototype.bind = function (bindingContext, overrideContext) {
        if (this.view === null) {
            this.view = this.viewFactory.create();
            this.viewSlot.add(this.view);
        }
        this.view.bind(bindingContext, overrideContext);
    };
    Replaceable.prototype.unbind = function () {
        this.view.unbind();
    };
    Replaceable = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('replaceable'),
        __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["templateController"],
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_0_aurelia_dependency_injection__["inject"])(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BoundViewFactory"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"])
    ], Replaceable);
    return Replaceable;
}());

var Focus = (function () {
    function Focus(element, taskQueue) {
        this.element = element;
        this.taskQueue = taskQueue;
        this.isAttached = false;
        this.needsApply = false;
    }
    Focus.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_2_aurelia_task_queue__["TaskQueue"]];
    };
    Focus.prototype.valueChanged = function () {
        if (this.isAttached) {
            this._apply();
        }
        else {
            this.needsApply = true;
        }
    };
    Focus.prototype._apply = function () {
        var _this = this;
        if (this.value) {
            this.taskQueue.queueMicroTask(function () {
                if (_this.value) {
                    _this.element.focus();
                }
            });
        }
        else {
            this.element.blur();
        }
    };
    Focus.prototype.attached = function () {
        this.isAttached = true;
        if (this.needsApply) {
            this.needsApply = false;
            this._apply();
        }
        this.element.addEventListener('focus', this);
        this.element.addEventListener('blur', this);
    };
    Focus.prototype.detached = function () {
        this.isAttached = false;
        this.element.removeEventListener('focus', this);
        this.element.removeEventListener('blur', this);
    };
    Focus.prototype.handleEvent = function (e) {
        if (e.type === 'focus') {
            this.value = true;
        }
        else if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].activeElement !== this.element) {
            this.value = false;
        }
    };
    Focus = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customAttribute"])('focus', __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay)
    ], Focus);
    return Focus;
}());

var cssUrlMatcher = /url\((?!['"]data)([^)]+)\)/gi;
function fixupCSSUrls(address, css) {
    if (typeof css !== 'string') {
        throw new Error("Failed loading required CSS file: ".concat(address));
    }
    return css.replace(cssUrlMatcher, function (match, p1) {
        var quote = p1.charAt(0);
        if (quote === '\'' || quote === '"') {
            p1 = p1.substr(1, p1.length - 2);
        }
        return 'url(\'' + __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_6_aurelia_path__["relativeToFile"])(p1, address) + '\')';
    });
}
var CSSResource = (function () {
    function CSSResource(address) {
        this.address = address;
        this._scoped = null;
        this._global = false;
        this._alreadyGloballyInjected = false;
    }
    CSSResource.prototype.initialize = function (container, Target) {
        this._scoped = new Target(this);
    };
    CSSResource.prototype.register = function (registry, name) {
        if (name === 'scoped') {
            registry.registerViewEngineHooks(this._scoped);
        }
        else {
            this._global = true;
        }
    };
    CSSResource.prototype.load = function (container) {
        var _this = this;
        return container.get(__WEBPACK_IMPORTED_MODULE_5_aurelia_loader__["Loader"])
            .loadText(this.address)
            .catch(function () { return null; })
            .then(function (text) {
            text = fixupCSSUrls(_this.address, text);
            _this._scoped.css = text;
            if (_this._global) {
                _this._alreadyGloballyInjected = true;
                __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(text);
            }
            return _this;
        });
    };
    return CSSResource;
}());
var CSSViewEngineHooks = (function () {
    function CSSViewEngineHooks(owner) {
        this.owner = owner;
        this.css = null;
    }
    CSSViewEngineHooks.prototype.beforeCompile = function (content, resources, instruction) {
        if (instruction.targetShadowDOM) {
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css, content, true);
        }
        else if (__WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["FEATURE"].scopedCSS) {
            var styleNode = __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css, content, true);
            styleNode.setAttribute('scoped', 'scoped');
        }
        else if (this._global && !this.owner._alreadyGloballyInjected) {
            __WEBPACK_IMPORTED_MODULE_1_aurelia_pal__["DOM"].injectStyles(this.css);
            this.owner._alreadyGloballyInjected = true;
        }
    };
    return CSSViewEngineHooks;
}());
function _createCSSResource(address) {
    var ViewCSS = (function (_super) {
        __extends(ViewCSS, _super);
        function ViewCSS() {
            return _super !== null && _super.apply(this, arguments) || this;
        }
        ViewCSS = __decorate([
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["resource"])(new CSSResource(address))
        ], ViewCSS);
        return ViewCSS;
    }(CSSViewEngineHooks));
    return ViewCSS;
}

var AttrBindingBehavior = (function () {
    function AttrBindingBehavior() {
    }
    AttrBindingBehavior.prototype.bind = function (binding, source) {
        binding.targetObserver = new __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["DataAttributeObserver"](binding.target, binding.targetProperty);
    };
    AttrBindingBehavior.prototype.unbind = function (binding, source) {
    };
    AttrBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('attr')
    ], AttrBindingBehavior);
    return AttrBindingBehavior;
}());

var modeBindingBehavior = {
    bind: function (binding, source, lookupFunctions) {
        binding.originalMode = binding.mode;
        binding.mode = this.mode;
    },
    unbind: function (binding, source) {
        binding.mode = binding.originalMode;
        binding.originalMode = null;
    }
};
var OneTimeBindingBehavior = (function () {
    function OneTimeBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].oneTime;
    }
    OneTimeBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('oneTime')
    ], OneTimeBindingBehavior);
    return OneTimeBindingBehavior;
}());
var OneWayBindingBehavior = (function () {
    function OneWayBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].toView;
    }
    OneWayBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('oneWay')
    ], OneWayBindingBehavior);
    return OneWayBindingBehavior;
}());
var ToViewBindingBehavior = (function () {
    function ToViewBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].toView;
    }
    ToViewBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('toView')
    ], ToViewBindingBehavior);
    return ToViewBindingBehavior;
}());
var FromViewBindingBehavior = (function () {
    function FromViewBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView;
    }
    FromViewBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('fromView')
    ], FromViewBindingBehavior);
    return FromViewBindingBehavior;
}());
var TwoWayBindingBehavior = (function () {
    function TwoWayBindingBehavior() {
        this.mode = __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay;
    }
    TwoWayBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_7_aurelia_metadata__["mixin"])(modeBindingBehavior),
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('twoWay')
    ], TwoWayBindingBehavior);
    return TwoWayBindingBehavior;
}());

function throttle(newValue) {
    var _this = this;
    var state = this.throttleState;
    var elapsed = +new Date() - state.last;
    if (elapsed >= state.delay) {
        clearTimeout(state.timeoutId);
        state.timeoutId = null;
        state.last = +new Date();
        this.throttledMethod(newValue);
        return;
    }
    state.newValue = newValue;
    if (state.timeoutId === null) {
        state.timeoutId = setTimeout(function () {
            state.timeoutId = null;
            state.last = +new Date();
            _this.throttledMethod(state.newValue);
        }, state.delay - elapsed);
    }
}
var ThrottleBindingBehavior = (function () {
    function ThrottleBindingBehavior() {
    }
    ThrottleBindingBehavior.prototype.bind = function (binding, source, delay) {
        if (delay === void 0) { delay = 200; }
        var methodToThrottle = 'updateTarget';
        if (binding.callSource) {
            methodToThrottle = 'callSource';
        }
        else if (binding.updateSource && binding.mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay) {
            methodToThrottle = 'updateSource';
        }
        binding.throttledMethod = binding[methodToThrottle];
        binding.throttledMethod.originalName = methodToThrottle;
        binding[methodToThrottle] = throttle;
        binding.throttleState = {
            delay: delay,
            last: 0,
            timeoutId: null
        };
    };
    ThrottleBindingBehavior.prototype.unbind = function (binding, source) {
        var methodToRestore = binding.throttledMethod.originalName;
        binding[methodToRestore] = binding.throttledMethod;
        binding.throttledMethod = null;
        clearTimeout(binding.throttleState.timeoutId);
        binding.throttleState = null;
    };
    ThrottleBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('throttle')
    ], ThrottleBindingBehavior);
    return ThrottleBindingBehavior;
}());

var unset = {};
function debounceCallSource(event) {
    var _this = this;
    var state = this.debounceState;
    clearTimeout(state.timeoutId);
    state.timeoutId = setTimeout(function () { return _this.debouncedMethod(event); }, state.delay);
}
function debounceCall(context, newValue, oldValue) {
    var _this = this;
    var state = this.debounceState;
    clearTimeout(state.timeoutId);
    if (context !== state.callContextToDebounce) {
        state.oldValue = unset;
        this.debouncedMethod(context, newValue, oldValue);
        return;
    }
    if (state.oldValue === unset) {
        state.oldValue = oldValue;
    }
    state.timeoutId = setTimeout(function () {
        var _oldValue = state.oldValue;
        state.oldValue = unset;
        _this.debouncedMethod(context, newValue, _oldValue);
    }, state.delay);
}
var DebounceBindingBehavior = (function () {
    function DebounceBindingBehavior() {
    }
    DebounceBindingBehavior.prototype.bind = function (binding, source, delay) {
        if (delay === void 0) { delay = 200; }
        var isCallSource = binding.callSource !== undefined;
        var methodToDebounce = isCallSource ? 'callSource' : 'call';
        var debouncer = isCallSource ? debounceCallSource : debounceCall;
        var mode = binding.mode;
        var callContextToDebounce = mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay || mode === __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView ? __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["targetContext"] : __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"];
        binding.debouncedMethod = binding[methodToDebounce];
        binding.debouncedMethod.originalName = methodToDebounce;
        binding[methodToDebounce] = debouncer;
        binding.debounceState = {
            callContextToDebounce: callContextToDebounce,
            delay: delay,
            timeoutId: 0,
            oldValue: unset
        };
    };
    DebounceBindingBehavior.prototype.unbind = function (binding, source) {
        var methodToRestore = binding.debouncedMethod.originalName;
        binding[methodToRestore] = binding.debouncedMethod;
        binding.debouncedMethod = null;
        clearTimeout(binding.debounceState.timeoutId);
        binding.debounceState = null;
    };
    DebounceBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('debounce')
    ], DebounceBindingBehavior);
    return DebounceBindingBehavior;
}());

function findOriginalEventTarget(event) {
    return (event.path && event.path[0]) || (event.deepPath && event.deepPath[0]) || event.target;
}
function handleSelfEvent(event) {
    var target = findOriginalEventTarget(event);
    if (this.target !== target) {
        return;
    }
    this.selfEventCallSource(event);
}
var SelfBindingBehavior = (function () {
    function SelfBindingBehavior() {
    }
    SelfBindingBehavior.prototype.bind = function (binding, source) {
        if (!binding.callSource || !binding.targetEvent) {
            throw new Error('Self binding behavior only supports event.');
        }
        binding.selfEventCallSource = binding.callSource;
        binding.callSource = handleSelfEvent;
    };
    SelfBindingBehavior.prototype.unbind = function (binding, source) {
        binding.callSource = binding.selfEventCallSource;
        binding.selfEventCallSource = null;
    };
    SelfBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('self')
    ], SelfBindingBehavior);
    return SelfBindingBehavior;
}());

var BindingSignaler = (function () {
    function BindingSignaler() {
        this.signals = {};
    }
    BindingSignaler.prototype.signal = function (name) {
        var bindings = this.signals[name];
        if (!bindings) {
            return;
        }
        var i = bindings.length;
        while (i--) {
            bindings[i].call(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["sourceContext"]);
        }
    };
    return BindingSignaler;
}());

var SignalBindingBehavior = (function () {
    function SignalBindingBehavior(bindingSignaler) {
        this.signals = bindingSignaler.signals;
    }
    SignalBindingBehavior.inject = function () { return [BindingSignaler]; };
    SignalBindingBehavior.prototype.bind = function (binding, source) {
        var names = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            names[_i - 2] = arguments[_i];
        }
        if (!binding.updateTarget) {
            throw new Error('Only property bindings and string interpolation bindings can be signaled.  Trigger, delegate and call bindings cannot be signaled.');
        }
        var signals = this.signals;
        if (names.length === 1) {
            var name_1 = names[0];
            var bindings = signals[name_1] || (signals[name_1] = []);
            bindings.push(binding);
            binding.signalName = name_1;
        }
        else if (names.length > 1) {
            var i = names.length;
            while (i--) {
                var name_2 = names[i];
                var bindings = signals[name_2] || (signals[name_2] = []);
                bindings.push(binding);
            }
            binding.signalName = names;
        }
        else {
            throw new Error('Signal name is required.');
        }
    };
    SignalBindingBehavior.prototype.unbind = function (binding, source) {
        var signals = this.signals;
        var name = binding.signalName;
        binding.signalName = null;
        if (Array.isArray(name)) {
            var names = name;
            var i = names.length;
            while (i--) {
                var n = names[i];
                var bindings = signals[n];
                bindings.splice(bindings.indexOf(binding), 1);
            }
        }
        else {
            var bindings = signals[name];
            bindings.splice(bindings.indexOf(binding), 1);
        }
    };
    SignalBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('signal')
    ], SignalBindingBehavior);
    return SignalBindingBehavior;
}());

var eventNamesRequired = 'The updateTrigger binding behavior requires at least one event name argument: eg <input value.bind="firstName & updateTrigger:\'blur\'">';
var notApplicableMessage = 'The updateTrigger binding behavior can only be applied to two-way/ from-view bindings on input/select elements.';
var UpdateTriggerBindingBehavior = (function () {
    function UpdateTriggerBindingBehavior() {
    }
    UpdateTriggerBindingBehavior.prototype.bind = function (binding, source) {
        var events = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            events[_i - 2] = arguments[_i];
        }
        if (events.length === 0) {
            throw new Error(eventNamesRequired);
        }
        if (binding.mode !== __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].twoWay && binding.mode !== __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingMode"].fromView) {
            throw new Error(notApplicableMessage);
        }
        var targetObserver = binding.observerLocator.getObserver(binding.target, binding.targetProperty);
        if (!targetObserver.handler) {
            throw new Error(notApplicableMessage);
        }
        binding.targetObserver = targetObserver;
        targetObserver.originalHandler = binding.targetObserver.handler;
        var handler = new __WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["EventSubscriber"](events);
        targetObserver.handler = handler;
    };
    UpdateTriggerBindingBehavior.prototype.unbind = function (binding, source) {
        var targetObserver = binding.targetObserver;
        targetObserver.handler.dispose();
        targetObserver.handler = targetObserver.originalHandler;
        targetObserver.originalHandler = null;
    };
    UpdateTriggerBindingBehavior = __decorate([
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_4_aurelia_binding__["bindingBehavior"])('updateTrigger')
    ], UpdateTriggerBindingBehavior);
    return UpdateTriggerBindingBehavior;
}());

function _createDynamicElement(_a) {
    var name = _a.name, viewUrl = _a.viewUrl, bindableNames = _a.bindableNames, useShadowDOMmode = _a.useShadowDOMmode;
    var DynamicElement = (function () {
        function DynamicElement() {
        }
        DynamicElement.prototype.bind = function (bindingContext) {
            this.$parent = bindingContext;
        };
        DynamicElement = __decorate([
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])(name),
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useView"])(viewUrl)
        ], DynamicElement);
        return DynamicElement;
    }());
    for (var i = 0, ii = bindableNames.length; i < ii; ++i) {
        __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["bindable"])(bindableNames[i])(DynamicElement);
    }
    switch (useShadowDOMmode) {
        case 'open':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])({ mode: 'open' })(DynamicElement);
            break;
        case 'closed':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])({ mode: 'closed' })(DynamicElement);
            break;
        case '':
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useShadowDOM"])(DynamicElement);
            break;
        case null:
            break;
        default:
            __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_8_aurelia_logging__["getLogger"])('aurelia-html-only-element')
                .warn("Expected 'use-shadow-dom' value to be \"close\", \"open\" or \"\", received ".concat(useShadowDOMmode));
            break;
    }
    return DynamicElement;
}

function getElementName(address) {
    return /([^\/^\?]+)\.html/i.exec(address)[1].toLowerCase();
}
function configure$1(config) {
    var viewEngine = config.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]);
    var loader = config.aurelia.loader;
    viewEngine.addResourcePlugin('.html', {
        'fetch': function (viewUrl) {
            return loader.loadTemplate(viewUrl).then(function (registryEntry) {
                var _a;
                var bindableNames = registryEntry.template.getAttribute('bindable');
                var useShadowDOMmode = registryEntry.template.getAttribute('use-shadow-dom');
                var name = getElementName(viewUrl);
                if (bindableNames) {
                    bindableNames = bindableNames.split(',').map(function (x) { return x.trim(); });
                    registryEntry.template.removeAttribute('bindable');
                }
                else {
                    bindableNames = [];
                }
                return _a = {}, _a[name] = _createDynamicElement({ name: name, viewUrl: viewUrl, bindableNames: bindableNames, useShadowDOMmode: useShadowDOMmode }), _a;
            });
        }
    });
}

function configure(config) {
    injectAureliaHideStyleAtHead();
    config.globalResources(Compose, If, Else, With, Repeat, Show, Hide, Replaceable, Focus, SanitizeHTMLValueConverter, OneTimeBindingBehavior, OneWayBindingBehavior, ToViewBindingBehavior, FromViewBindingBehavior, TwoWayBindingBehavior, ThrottleBindingBehavior, DebounceBindingBehavior, SelfBindingBehavior, SignalBindingBehavior, UpdateTriggerBindingBehavior, AttrBindingBehavior);
    configure$1(config);
    var viewEngine = config.container.get(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewEngine"]);
    var styleResourcePlugin = {
        fetch: function (address) {
            var _a;
            return _a = {}, _a[address] = _createCSSResource(address), _a;
        }
    };
    ['.css', '.less', '.sass', '.scss', '.styl'].forEach(function (ext) { return viewEngine.addResourcePlugin(ext, styleResourcePlugin); });
}


//# sourceMappingURL=aurelia-templating-resources.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ },

/***/ "aurelia-templating-router":
/***/ function(module, exports, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(Promise) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_aurelia_router__ = __webpack_require__("aurelia-router");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__ = __webpack_require__(58);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_aurelia_path__ = __webpack_require__(23);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_aurelia_dependency_injection__ = __webpack_require__(1);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_aurelia_binding__ = __webpack_require__("aurelia-binding");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_aurelia_pal__ = __webpack_require__(27);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_aurelia_logging__ = __webpack_require__(70);
/* harmony export (binding) */ __webpack_require__.d(exports, "RouteHref", function() { return RouteHref; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterView", function() { return RouterView; });
/* harmony export (binding) */ __webpack_require__.d(exports, "RouterViewLocator", function() { return RouterViewLocator; });
/* harmony export (binding) */ __webpack_require__.d(exports, "TemplatingRouteLoader", function() { return TemplatingRouteLoader; });
/* harmony export (binding) */ __webpack_require__.d(exports, "configure", function() { return configure; });









/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    if (typeof b !== "function" && b !== null)
        throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var EmptyLayoutViewModel = (function () {
    function EmptyLayoutViewModel() {
    }
    return EmptyLayoutViewModel;
}());
var RouterView = (function () {
    function RouterView(element, container, viewSlot, router, viewLocator, compositionTransaction, compositionEngine) {
        this.element = element;
        this.container = container;
        this.viewSlot = viewSlot;
        this.router = router;
        this.viewLocator = viewLocator;
        this.compositionTransaction = compositionTransaction;
        this.compositionEngine = compositionEngine;
        this.router.registerViewPort(this, this.element.getAttribute('name'));
        if (!('initialComposition' in compositionTransaction)) {
            compositionTransaction.initialComposition = true;
            this.compositionTransactionNotifier = compositionTransaction.enlist();
        }
    }
    RouterView.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_6_aurelia_pal__["DOM"].Element, __WEBPACK_IMPORTED_MODULE_4_aurelia_dependency_injection__["Container"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewSlot"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ViewLocator"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionTransaction"], __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"]];
    };
    RouterView.prototype.created = function (owningView) {
        this.owningView = owningView;
    };
    RouterView.prototype.bind = function (bindingContext, overrideContext) {
        this.container.viewModel = bindingContext;
        this.overrideContext = overrideContext;
    };
    RouterView.prototype.process = function ($viewPortInstruction, waitToSwap) {
        var _this = this;
        var viewPortInstruction = $viewPortInstruction;
        var component = viewPortInstruction.component;
        var childContainer = component.childContainer;
        var viewModel = component.viewModel;
        var viewModelResource = component.viewModelResource;
        var metadata = viewModelResource.metadata;
        var config = component.router.currentInstruction.config;
        var viewPortConfig = config.viewPorts ? (config.viewPorts[viewPortInstruction.name] || {}) : {};
        childContainer.get(RouterViewLocator)._notify(this);
        var layoutInstruction = {
            viewModel: viewPortConfig.layoutViewModel || config.layoutViewModel || this.layoutViewModel,
            view: viewPortConfig.layoutView || config.layoutView || this.layoutView,
            model: viewPortConfig.layoutModel || config.layoutModel || this.layoutModel,
            router: viewPortInstruction.component.router,
            childContainer: childContainer,
            viewSlot: this.viewSlot
        };
        var viewStrategy = this.viewLocator.getViewStrategy(component.view || viewModel);
        if (viewStrategy && component.view) {
            viewStrategy.makeRelativeTo(__WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(component.router.container.viewModel.constructor).moduleId);
        }
        return metadata
            .load(childContainer, viewModelResource.value, null, viewStrategy, true)
            .then(function (viewFactory) {
            if (!_this.compositionTransactionNotifier) {
                _this.compositionTransactionOwnershipToken = _this.compositionTransaction.tryCapture();
            }
            if (layoutInstruction.viewModel || layoutInstruction.view) {
                viewPortInstruction.layoutInstruction = layoutInstruction;
            }
            var viewPortComponentBehaviorInstruction = __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["BehaviorInstruction"].dynamic(_this.element, viewModel, viewFactory);
            viewPortInstruction.controller = metadata.create(childContainer, viewPortComponentBehaviorInstruction);
            if (waitToSwap) {
                return null;
            }
            _this.swap(viewPortInstruction);
        });
    };
    RouterView.prototype.swap = function ($viewPortInstruction) {
        var _this = this;
        var viewPortInstruction = $viewPortInstruction;
        var viewPortController = viewPortInstruction.controller;
        var layoutInstruction = viewPortInstruction.layoutInstruction;
        var previousView = this.view;
        var work = function () {
            var swapStrategy = __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SwapStrategies"][_this.swapOrder] || __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["SwapStrategies"].after;
            var viewSlot = _this.viewSlot;
            swapStrategy(viewSlot, previousView, function () { return Promise.resolve(viewSlot.add(_this.view)); }).then(function () {
                _this._notify();
            });
        };
        var ready = function (owningView_or_layoutView) {
            viewPortController.automate(_this.overrideContext, owningView_or_layoutView);
            var transactionOwnerShipToken = _this.compositionTransactionOwnershipToken;
            if (transactionOwnerShipToken) {
                return transactionOwnerShipToken
                    .waitForCompositionComplete()
                    .then(function () {
                    _this.compositionTransactionOwnershipToken = null;
                    return work();
                });
            }
            return work();
        };
        if (layoutInstruction) {
            if (!layoutInstruction.viewModel) {
                layoutInstruction.viewModel = new EmptyLayoutViewModel();
            }
            return this.compositionEngine
                .createController(layoutInstruction)
                .then(function (layoutController) {
                var layoutView = layoutController.view;
                __WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["ShadowDOM"].distributeView(viewPortController.view, layoutController.slots || layoutView.slots);
                layoutController.automate(__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_5_aurelia_binding__["createOverrideContext"])(layoutInstruction.viewModel), _this.owningView);
                layoutView.children.push(viewPortController.view);
                return layoutView || layoutController;
            })
                .then(function (newView) {
                _this.view = newView;
                return ready(newView);
            });
        }
        this.view = viewPortController.view;
        return ready(this.owningView);
    };
    RouterView.prototype._notify = function () {
        var notifier = this.compositionTransactionNotifier;
        if (notifier) {
            notifier.done();
            this.compositionTransactionNotifier = null;
        }
    };
    RouterView.$view = null;
    RouterView.$resource = {
        name: 'router-view',
        bindables: ['swapOrder', 'layoutView', 'layoutViewModel', 'layoutModel', 'inherit-binding-context']
    };
    return RouterView;
}());
var RouterViewLocator = (function () {
    function RouterViewLocator() {
        var _this = this;
        this.promise = new Promise(function (resolve) { return _this.resolve = resolve; });
    }
    RouterViewLocator.prototype.findNearest = function () {
        return this.promise;
    };
    RouterViewLocator.prototype._notify = function (routerView) {
        this.resolve(routerView);
    };
    return RouterViewLocator;
}());

var EmptyClass = (function () {
    function EmptyClass() {
    }
    return EmptyClass;
}());
__webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["inlineView"])('<template></template>')(EmptyClass);
var TemplatingRouteLoader = (function (_super) {
    __extends(TemplatingRouteLoader, _super);
    function TemplatingRouteLoader(compositionEngine) {
        var _this = _super.call(this) || this;
        _this.compositionEngine = compositionEngine;
        return _this;
    }
    TemplatingRouteLoader.prototype.resolveViewModel = function (router, config) {
        return new Promise(function (resolve, reject) {
            var viewModel;
            if ('moduleId' in config) {
                var moduleId = config.moduleId;
                if (moduleId === null) {
                    viewModel = EmptyClass;
                }
                else {
                    moduleId = __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_2_aurelia_path__["relativeToFile"])(moduleId, __WEBPACK_IMPORTED_MODULE_1_aurelia_metadata__["Origin"].get(router.container.viewModel.constructor).moduleId);
                    if (/\.html/i.test(moduleId)) {
                        viewModel = createDynamicClass(moduleId);
                    }
                    else {
                        viewModel = moduleId;
                    }
                }
                return resolve(viewModel);
            }
            reject(new Error('Invalid route config. No "moduleId" found.'));
        });
    };
    TemplatingRouteLoader.prototype.createChildContainer = function (router) {
        var childContainer = router.container.createChild();
        childContainer.registerSingleton(RouterViewLocator);
        childContainer.getChildRouter = function () {
            var childRouter;
            childContainer.registerHandler(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], function () { return childRouter || (childRouter = router.createChild(childContainer)); });
            return childContainer.get(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"]);
        };
        return childContainer;
    };
    TemplatingRouteLoader.prototype.loadRoute = function (router, config, navInstruction) {
        var _this = this;
        return this
            .resolveViewModel(router, config)
            .then(function (viewModel) { return _this.compositionEngine.ensureViewModel({
            viewModel: viewModel,
            childContainer: _this.createChildContainer(router),
            view: config.view || config.viewStrategy,
            router: router
        }); });
    };
    TemplatingRouteLoader.inject = [__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["CompositionEngine"]];
    return TemplatingRouteLoader;
}(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["RouteLoader"]));
function createDynamicClass(moduleId) {
    var name = /([^\/^\?]+)\.html/i.exec(moduleId)[1];
    var DynamicClass = (function () {
        function DynamicClass() {
        }
        DynamicClass.prototype.bind = function (bindingContext) {
            this.$parent = bindingContext;
        };
        return DynamicClass;
    }());
    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["customElement"])(name)(DynamicClass);
    __webpack_require__.i(__WEBPACK_IMPORTED_MODULE_3_aurelia_templating__["useView"])(moduleId)(DynamicClass);
    return DynamicClass;
}

var logger = __WEBPACK_IMPORTED_MODULE_7_aurelia_logging__["getLogger"]('route-href');
var RouteHref = (function () {
    function RouteHref(router, element) {
        this.router = router;
        this.element = element;
        this.attribute = 'href';
    }
    RouteHref.inject = function () {
        return [__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_6_aurelia_pal__["DOM"].Element];
    };
    RouteHref.prototype.bind = function () {
        this.isActive = true;
        this.processChange();
    };
    RouteHref.prototype.unbind = function () {
        this.isActive = false;
    };
    RouteHref.prototype.attributeChanged = function (value, previous) {
        if (previous) {
            this.element.removeAttribute(previous);
        }
        return this.processChange();
    };
    RouteHref.prototype.processChange = function () {
        var _this = this;
        return this.router
            .ensureConfigured()
            .then(function () {
            if (!_this.isActive) {
                return null;
            }
            var element = _this.element;
            var href = _this.router.generate(_this.route, _this.params);
            if (element.au.controller) {
                element.au.controller.viewModel[_this.attribute] = href;
            }
            else {
                element.setAttribute(_this.attribute, href);
            }
            return null;
        })
            .catch(function (reason) {
            logger.error(reason);
        });
    };
    RouteHref.$resource = {
        type: 'attribute',
        name: 'route-href',
        bindables: [
            { name: 'route', changeHandler: 'processChange', primaryProperty: true },
            { name: 'params', changeHandler: 'processChange' },
            'attribute'
        ]
    };
    return RouteHref;
}());

function configure(config) {
    config
        .singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["RouteLoader"], TemplatingRouteLoader)
        .singleton(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["AppRouter"])
        .globalResources(RouterView, RouteHref);
    config.container.registerAlias(__WEBPACK_IMPORTED_MODULE_0_aurelia_router__["Router"], __WEBPACK_IMPORTED_MODULE_0_aurelia_router__["AppRouter"]);
}


//# sourceMappingURL=aurelia-templating-router.js.map

/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__("bluebird")))

/***/ }

},[1354]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXVyZWxpYS5idW5kbGUuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24vZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10YXNrLXF1ZXVlL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10YXNrLXF1ZXVlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1oaXN0b3J5L2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1oaXN0b3J5LmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1sb2dnaW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1sb2dnaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1iaW5kaW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1iaW5kaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1mcmFtZXdvcmsvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWZyYW1ld29yay5qcyIsIndlYnBhY2s6Ly8vLi9+L2F1cmVsaWEtaGlzdG9yeS1icm93c2VyL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLWxvZ2dpbmctY29uc29sZS9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtbG9nZ2luZy1jb25zb2xlLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS1yb3V0ZXIvZGlzdC9lczIwMTUvYXVyZWxpYS1yb3V0ZXIuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtdGVtcGxhdGluZy1iaW5kaW5nLmpzIiwid2VicGFjazovLy8uL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJlc291cmNlcy9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMuanMiLCJ3ZWJwYWNrOi8vLy4vfi9hdXJlbGlhLXRlbXBsYXRpbmctcm91dGVyL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBtZXRhZGF0YSwgcHJvdG9jb2wgfSBmcm9tICdhdXJlbGlhLW1ldGFkYXRhJztcbmltcG9ydCB7IEFnZ3JlZ2F0ZUVycm9yIH0gZnJvbSAnYXVyZWxpYS1wYWwnO1xuXG4vKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uIEFsbCByaWdodHMgcmVzZXJ2ZWQuXHJcbkxpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZVxyXG50aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS4gWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZVxyXG5MaWNlbnNlIGF0IGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxyXG5cclxuVEhJUyBDT0RFIElTIFBST1ZJREVEIE9OIEFOICpBUyBJUyogQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxyXG5LSU5ELCBFSVRIRVIgRVhQUkVTUyBPUiBJTVBMSUVELCBJTkNMVURJTkcgV0lUSE9VVCBMSU1JVEFUSU9OIEFOWSBJTVBMSUVEXHJcbldBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBUSVRMRSwgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UsXHJcbk1FUkNIQU5UQUJMSVRZIE9SIE5PTi1JTkZSSU5HRU1FTlQuXHJcblxyXG5TZWUgdGhlIEFwYWNoZSBWZXJzaW9uIDIuMCBMaWNlbnNlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnNcclxuYW5kIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG5cclxuZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxyXG5cclxuZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xyXG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKG1ldGFkYXRhS2V5LCBtZXRhZGF0YVZhbHVlKTtcclxufVxuXG5mdW5jdGlvbiBpc0luamVjdGFibGUocG90ZW50aWFsVGFyZ2V0KSB7XHJcbiAgICByZXR1cm4gISFwb3RlbnRpYWxUYXJnZXQ7XHJcbn1cclxuZnVuY3Rpb24gYXV0b2luamVjdChwb3RlbnRpYWxUYXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIGlmICghdGFyZ2V0Lmhhc093blByb3BlcnR5KCdpbmplY3QnKSkge1xyXG4gICAgICAgICAgICB0YXJnZXQuaW5qZWN0ID0gKG1ldGFkYXRhLmdldE93bihtZXRhZGF0YS5wYXJhbVR5cGVzLCB0YXJnZXQpIHx8XHJcbiAgICAgICAgICAgICAgICBfZW1wdHlQYXJhbWV0ZXJzKS5zbGljZSgpO1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmluamVjdCAmJiB0YXJnZXQuaW5qZWN0Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGlmICh0YXJnZXQuaW5qZWN0W3RhcmdldC5pbmplY3QubGVuZ3RoIC0gMV0gPT09IE9iamVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldC5pbmplY3Quc3BsaWNlKC0xLCAxKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBpZiAoaXNJbmplY3RhYmxlKHBvdGVudGlhbFRhcmdldCkpIHtcclxuICAgICAgICByZXR1cm4gZGVjbyhwb3RlbnRpYWxUYXJnZXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlY287XHJcbn1cclxuZnVuY3Rpb24gaW5qZWN0KCkge1xyXG4gICAgdmFyIHJlc3QgPSBbXTtcclxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgcmVzdFtfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIF9rZXksIGRlc2NyaXB0b3IpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGRlc2NyaXB0b3IgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIGF1dG9pbmplY3QodGFyZ2V0KTtcclxuICAgICAgICAgICAgaWYgKHJlc3QubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQuaW5qZWN0W2Rlc2NyaXB0b3JdID0gcmVzdFswXTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgICAgIHZhciBmbiA9IGRlc2NyaXB0b3IudmFsdWU7XHJcbiAgICAgICAgICAgIGZuLmluamVjdCA9IHJlc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0YXJnZXQuaW5qZWN0ID0gcmVzdDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XG5cbnZhciByZXNvbHZlciA9IHByb3RvY29sLmNyZWF0ZSgnYXVyZWxpYTpyZXNvbHZlcicsIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgIGlmICghKHR5cGVvZiB0YXJnZXQuZ2V0ID09PSAnZnVuY3Rpb24nKSkge1xyXG4gICAgICAgIHJldHVybiAnUmVzb2x2ZXJzIG11c3QgaW1wbGVtZW50OiBnZXQoY29udGFpbmVyOiBDb250YWluZXIsIGtleTogYW55KTogYW55JztcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59KTtcclxudmFyIFN0cmF0ZWd5O1xyXG4oZnVuY3Rpb24gKFN0cmF0ZWd5KSB7XHJcbiAgICBTdHJhdGVneVtTdHJhdGVneVtcImluc3RhbmNlXCJdID0gMF0gPSBcImluc3RhbmNlXCI7XHJcbiAgICBTdHJhdGVneVtTdHJhdGVneVtcInNpbmdsZXRvblwiXSA9IDFdID0gXCJzaW5nbGV0b25cIjtcclxuICAgIFN0cmF0ZWd5W1N0cmF0ZWd5W1widHJhbnNpZW50XCJdID0gMl0gPSBcInRyYW5zaWVudFwiO1xyXG4gICAgU3RyYXRlZ3lbU3RyYXRlZ3lbXCJmdW5jdGlvblwiXSA9IDNdID0gXCJmdW5jdGlvblwiO1xyXG4gICAgU3RyYXRlZ3lbU3RyYXRlZ3lbXCJhcnJheVwiXSA9IDRdID0gXCJhcnJheVwiO1xyXG4gICAgU3RyYXRlZ3lbU3RyYXRlZ3lbXCJhbGlhc1wiXSA9IDVdID0gXCJhbGlhc1wiO1xyXG59KShTdHJhdGVneSB8fCAoU3RyYXRlZ3kgPSB7fSkpO1xyXG5mdW5jdGlvbiBpc1N0cmF0ZWd5KGFjdHVhbCwgZXhwZWN0ZWQsIHN0YXRlKSB7XHJcbiAgICByZXR1cm4gYWN0dWFsID09PSBleHBlY3RlZDtcclxufVxyXG52YXIgU3RyYXRlZ3lSZXNvbHZlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTdHJhdGVneVJlc29sdmVyKHN0cmF0ZWd5LCBzdGF0ZSkge1xyXG4gICAgICAgIHRoaXMuc3RyYXRlZ3kgPSBzdHJhdGVneTtcclxuICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGU7XHJcbiAgICB9XHJcbiAgICBTdHJhdGVneVJlc29sdmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBrZXkpIHtcclxuICAgICAgICBpZiAoaXNTdHJhdGVneSh0aGlzLnN0cmF0ZWd5LCBTdHJhdGVneS5pbnN0YW5jZSwgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpc1N0cmF0ZWd5KHRoaXMuc3RyYXRlZ3ksIFN0cmF0ZWd5LnNpbmdsZXRvbiwgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgdmFyIHNpbmdsZXRvbiA9IGNvbnRhaW5lci5pbnZva2UodGhpcy5zdGF0ZSk7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSBzaW5nbGV0b247XHJcbiAgICAgICAgICAgIHRoaXMuc3RyYXRlZ3kgPSAwO1xyXG4gICAgICAgICAgICByZXR1cm4gc2luZ2xldG9uO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNTdHJhdGVneSh0aGlzLnN0cmF0ZWd5LCBTdHJhdGVneS50cmFuc2llbnQsIHRoaXMuc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250YWluZXIuaW52b2tlKHRoaXMuc3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNTdHJhdGVneSh0aGlzLnN0cmF0ZWd5LCBTdHJhdGVneS5mdW5jdGlvbiwgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGUoY29udGFpbmVyLCBrZXksIHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaXNTdHJhdGVneSh0aGlzLnN0cmF0ZWd5LCBTdHJhdGVneS5hcnJheSwgdGhpcy5zdGF0ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhdGVbMF0uZ2V0KGNvbnRhaW5lciwga2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGlzU3RyYXRlZ3kodGhpcy5zdHJhdGVneSwgU3RyYXRlZ3kuYWxpYXMsIHRoaXMuc3RhdGUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250YWluZXIuZ2V0KHRoaXMuc3RhdGUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc3RyYXRlZ3k6ICcgKyB0aGlzLnN0cmF0ZWd5KTtcclxuICAgIH07XHJcbiAgICBTdHJhdGVneVJlc29sdmVyID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgcmVzb2x2ZXIoKSxcclxuICAgICAgICBfX21ldGFkYXRhKFwiZGVzaWduOnBhcmFtdHlwZXNcIiwgW051bWJlciwgT2JqZWN0XSlcclxuICAgIF0sIFN0cmF0ZWd5UmVzb2x2ZXIpO1xyXG4gICAgcmV0dXJuIFN0cmF0ZWd5UmVzb2x2ZXI7XHJcbn0oKSk7XHJcbnZhciBMYXp5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIExhenkoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgfVxyXG4gICAgTGF6eV8xID0gTGF6eTtcclxuICAgIExhenkucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7IHJldHVybiBjb250YWluZXIuZ2V0KF90aGlzLl9rZXkpOyB9O1xyXG4gICAgfTtcclxuICAgIExhenkub2YgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMYXp5XzEoa2V5KTtcclxuICAgIH07XHJcbiAgICB2YXIgTGF6eV8xO1xyXG4gICAgTGF6eSA9IExhenlfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKVxyXG4gICAgXSwgTGF6eSk7XHJcbiAgICByZXR1cm4gTGF6eTtcclxufSgpKTtcclxudmFyIEFsbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBbGwoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgfVxyXG4gICAgQWxsXzEgPSBBbGw7XHJcbiAgICBBbGwucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICByZXR1cm4gY29udGFpbmVyLmdldEFsbCh0aGlzLl9rZXkpO1xyXG4gICAgfTtcclxuICAgIEFsbC5vZiA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gbmV3IEFsbF8xKGtleSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIEFsbF8xO1xyXG4gICAgQWxsID0gQWxsXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlcigpLFxyXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSlcclxuICAgIF0sIEFsbCk7XHJcbiAgICByZXR1cm4gQWxsO1xyXG59KCkpO1xyXG52YXIgT3B0aW9uYWwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gT3B0aW9uYWwoa2V5LCBjaGVja1BhcmVudCkge1xyXG4gICAgICAgIGlmIChjaGVja1BhcmVudCA9PT0gdm9pZCAwKSB7IGNoZWNrUGFyZW50ID0gdHJ1ZTsgfVxyXG4gICAgICAgIHRoaXMuX2tleSA9IGtleTtcclxuICAgICAgICB0aGlzLl9jaGVja1BhcmVudCA9IGNoZWNrUGFyZW50O1xyXG4gICAgfVxyXG4gICAgT3B0aW9uYWxfMSA9IE9wdGlvbmFsO1xyXG4gICAgT3B0aW9uYWwucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICBpZiAoY29udGFpbmVyLmhhc1Jlc29sdmVyKHRoaXMuX2tleSwgdGhpcy5fY2hlY2tQYXJlbnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250YWluZXIuZ2V0KHRoaXMuX2tleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIE9wdGlvbmFsLm9mID0gZnVuY3Rpb24gKGtleSwgY2hlY2tQYXJlbnQpIHtcclxuICAgICAgICBpZiAoY2hlY2tQYXJlbnQgPT09IHZvaWQgMCkgeyBjaGVja1BhcmVudCA9IHRydWU7IH1cclxuICAgICAgICByZXR1cm4gbmV3IE9wdGlvbmFsXzEoa2V5LCBjaGVja1BhcmVudCk7XHJcbiAgICB9O1xyXG4gICAgdmFyIE9wdGlvbmFsXzE7XHJcbiAgICBPcHRpb25hbCA9IE9wdGlvbmFsXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlcigpLFxyXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0LCBCb29sZWFuXSlcclxuICAgIF0sIE9wdGlvbmFsKTtcclxuICAgIHJldHVybiBPcHRpb25hbDtcclxufSgpKTtcclxudmFyIFBhcmVudCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBQYXJlbnQoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgfVxyXG4gICAgUGFyZW50XzEgPSBQYXJlbnQ7XHJcbiAgICBQYXJlbnQucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICByZXR1cm4gY29udGFpbmVyLnBhcmVudCA/IGNvbnRhaW5lci5wYXJlbnQuZ2V0KHRoaXMuX2tleSkgOiBudWxsO1xyXG4gICAgfTtcclxuICAgIFBhcmVudC5vZiA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gbmV3IFBhcmVudF8xKGtleSk7XHJcbiAgICB9O1xyXG4gICAgdmFyIFBhcmVudF8xO1xyXG4gICAgUGFyZW50ID0gUGFyZW50XzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlcigpLFxyXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0XSlcclxuICAgIF0sIFBhcmVudCk7XHJcbiAgICByZXR1cm4gUGFyZW50O1xyXG59KCkpO1xyXG52YXIgRmFjdG9yeSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBGYWN0b3J5KGtleSkge1xyXG4gICAgICAgIHRoaXMuX2tleSA9IGtleTtcclxuICAgIH1cclxuICAgIEZhY3RvcnlfMSA9IEZhY3Rvcnk7XHJcbiAgICBGYWN0b3J5LnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoY29udGFpbmVyKSB7XHJcbiAgICAgICAgdmFyIGZuID0gdGhpcy5fa2V5O1xyXG4gICAgICAgIHZhciByZXNvbHZlciA9IGNvbnRhaW5lci5nZXRSZXNvbHZlcihmbik7XHJcbiAgICAgICAgaWYgKHJlc29sdmVyICYmIHJlc29sdmVyLnN0cmF0ZWd5ID09PSBTdHJhdGVneS5mdW5jdGlvbikge1xyXG4gICAgICAgICAgICBmbiA9IHJlc29sdmVyLnN0YXRlO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVzdCA9IFtdO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgcmVzdFtfaV0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjb250YWluZXIuaW52b2tlKGZuLCByZXN0KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIEZhY3Rvcnkub2YgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBGYWN0b3J5XzEoa2V5KTtcclxuICAgIH07XHJcbiAgICB2YXIgRmFjdG9yeV8xO1xyXG4gICAgRmFjdG9yeSA9IEZhY3RvcnlfMSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHJlc29sdmVyKCksXHJcbiAgICAgICAgX19tZXRhZGF0YShcImRlc2lnbjpwYXJhbXR5cGVzXCIsIFtPYmplY3RdKVxyXG4gICAgXSwgRmFjdG9yeSk7XHJcbiAgICByZXR1cm4gRmFjdG9yeTtcclxufSgpKTtcclxudmFyIE5ld0luc3RhbmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE5ld0luc3RhbmNlKGtleSkge1xyXG4gICAgICAgIHZhciBkeW5hbWljRGVwZW5kZW5jaWVzID0gW107XHJcbiAgICAgICAgZm9yICh2YXIgX2kgPSAxOyBfaSA8IGFyZ3VtZW50cy5sZW5ndGg7IF9pKyspIHtcclxuICAgICAgICAgICAgZHluYW1pY0RlcGVuZGVuY2llc1tfaSAtIDFdID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5rZXkgPSBrZXk7XHJcbiAgICAgICAgdGhpcy5hc0tleSA9IGtleTtcclxuICAgICAgICB0aGlzLmR5bmFtaWNEZXBlbmRlbmNpZXMgPSBkeW5hbWljRGVwZW5kZW5jaWVzO1xyXG4gICAgfVxyXG4gICAgTmV3SW5zdGFuY2VfMSA9IE5ld0luc3RhbmNlO1xyXG4gICAgTmV3SW5zdGFuY2UucHJvdG90eXBlLmdldCA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICB2YXIgZHluYW1pY0RlcGVuZGVuY2llcyA9IHRoaXMuZHluYW1pY0RlcGVuZGVuY2llcy5sZW5ndGggPiAwXHJcbiAgICAgICAgICAgID8gdGhpcy5keW5hbWljRGVwZW5kZW5jaWVzLm1hcChmdW5jdGlvbiAoZGVwZW5kZW5jeSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGRlcGVuZGVuY3lbJ3Byb3RvY29sOmF1cmVsaWE6cmVzb2x2ZXInXVxyXG4gICAgICAgICAgICAgICAgICAgID8gZGVwZW5kZW5jeS5nZXQoY29udGFpbmVyKVxyXG4gICAgICAgICAgICAgICAgICAgIDogY29udGFpbmVyLmdldChkZXBlbmRlbmN5KTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIGZuID0gdGhpcy5rZXk7XHJcbiAgICAgICAgdmFyIHJlc29sdmVyID0gY29udGFpbmVyLmdldFJlc29sdmVyKGZuKTtcclxuICAgICAgICBpZiAocmVzb2x2ZXIgJiYgcmVzb2x2ZXIuc3RyYXRlZ3kgPT09IDMpIHtcclxuICAgICAgICAgICAgZm4gPSByZXNvbHZlci5zdGF0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGluc3RhbmNlID0gY29udGFpbmVyLmludm9rZShmbiwgZHluYW1pY0RlcGVuZGVuY2llcyk7XHJcbiAgICAgICAgY29udGFpbmVyLnJlZ2lzdGVySW5zdGFuY2UodGhpcy5hc0tleSwgaW5zdGFuY2UpO1xyXG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcclxuICAgIH07XHJcbiAgICBOZXdJbnN0YW5jZS5wcm90b3R5cGUuYXMgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5hc0tleSA9IGtleTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICBOZXdJbnN0YW5jZS5vZiA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICB2YXIgZHluYW1pY0RlcGVuZGVuY2llcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIGR5bmFtaWNEZXBlbmRlbmNpZXNbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgKE5ld0luc3RhbmNlXzEuYmluZC5hcHBseShOZXdJbnN0YW5jZV8xLCBbdm9pZCAwLCBrZXldLmNvbmNhdChkeW5hbWljRGVwZW5kZW5jaWVzKSkpKCk7XHJcbiAgICB9O1xyXG4gICAgdmFyIE5ld0luc3RhbmNlXzE7XHJcbiAgICBOZXdJbnN0YW5jZSA9IE5ld0luc3RhbmNlXzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICByZXNvbHZlcigpLFxyXG4gICAgICAgIF9fbWV0YWRhdGEoXCJkZXNpZ246cGFyYW10eXBlc1wiLCBbT2JqZWN0LCBPYmplY3RdKVxyXG4gICAgXSwgTmV3SW5zdGFuY2UpO1xyXG4gICAgcmV0dXJuIE5ld0luc3RhbmNlO1xyXG59KCkpO1xyXG5mdW5jdGlvbiBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KSB7XHJcbiAgICBhdXRvaW5qZWN0KHRhcmdldCk7XHJcbiAgICByZXR1cm4gdGFyZ2V0LmluamVjdDtcclxufVxyXG5mdW5jdGlvbiBsYXp5KGtleVZhbHVlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwgX2tleSwgaW5kZXgpIHtcclxuICAgICAgICB2YXIgaW5qZWN0JCQxID0gZ2V0RGVjb3JhdG9yRGVwZW5kZW5jaWVzKHRhcmdldCk7XHJcbiAgICAgICAgaW5qZWN0JCQxW2luZGV4XSA9IExhenkub2Yoa2V5VmFsdWUpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBhbGwoa2V5VmFsdWUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBfa2V5LCBpbmRleCkge1xyXG4gICAgICAgIHZhciBpbmplY3QkJDEgPSBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KTtcclxuICAgICAgICBpbmplY3QkJDFbaW5kZXhdID0gQWxsLm9mKGtleVZhbHVlKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gb3B0aW9uYWwoY2hlY2tQYXJlbnRPclRhcmdldCkge1xyXG4gICAgaWYgKGNoZWNrUGFyZW50T3JUYXJnZXQgPT09IHZvaWQgMCkgeyBjaGVja1BhcmVudE9yVGFyZ2V0ID0gdHJ1ZTsgfVxyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAoY2hlY2tQYXJlbnQpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCwgX2tleSwgaW5kZXgpIHtcclxuICAgICAgICAgICAgdmFyIGluamVjdCQkMSA9IGdldERlY29yYXRvckRlcGVuZGVuY2llcyh0YXJnZXQpO1xyXG4gICAgICAgICAgICBpbmplY3QkJDFbaW5kZXhdID0gT3B0aW9uYWwub2YoaW5qZWN0JCQxW2luZGV4XSwgY2hlY2tQYXJlbnQpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgaWYgKHR5cGVvZiBjaGVja1BhcmVudE9yVGFyZ2V0ID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICByZXR1cm4gZGVjbyhjaGVja1BhcmVudE9yVGFyZ2V0KTtcclxuICAgIH1cclxuICAgIHJldHVybiBkZWNvKHRydWUpO1xyXG59XHJcbmZ1bmN0aW9uIHBhcmVudCh0YXJnZXQsIF9rZXksIGluZGV4KSB7XHJcbiAgICB2YXIgaW5qZWN0JCQxID0gZ2V0RGVjb3JhdG9yRGVwZW5kZW5jaWVzKHRhcmdldCk7XHJcbiAgICBpbmplY3QkJDFbaW5kZXhdID0gUGFyZW50Lm9mKGluamVjdCQkMVtpbmRleF0pO1xyXG59XHJcbmZ1bmN0aW9uIGZhY3Rvcnkoa2V5VmFsdWUpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBfa2V5LCBpbmRleCkge1xyXG4gICAgICAgIHZhciBpbmplY3QkJDEgPSBnZXREZWNvcmF0b3JEZXBlbmRlbmNpZXModGFyZ2V0KTtcclxuICAgICAgICBpbmplY3QkJDFbaW5kZXhdID0gRmFjdG9yeS5vZihrZXlWYWx1ZSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIG5ld0luc3RhbmNlKGFzS2V5T3JUYXJnZXQpIHtcclxuICAgIHZhciBkeW5hbWljRGVwZW5kZW5jaWVzID0gW107XHJcbiAgICBmb3IgKHZhciBfaSA9IDE7IF9pIDwgYXJndW1lbnRzLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgIGR5bmFtaWNEZXBlbmRlbmNpZXNbX2kgLSAxXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICB9XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uIChhc0tleSkge1xyXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBfa2V5LCBpbmRleCkge1xyXG4gICAgICAgICAgICB2YXIgaW5qZWN0JCQxID0gZ2V0RGVjb3JhdG9yRGVwZW5kZW5jaWVzKHRhcmdldCk7XHJcbiAgICAgICAgICAgIGluamVjdCQkMVtpbmRleF0gPSBOZXdJbnN0YW5jZS5vZi5hcHBseShOZXdJbnN0YW5jZSwgW2luamVjdCQkMVtpbmRleF1dLmNvbmNhdChkeW5hbWljRGVwZW5kZW5jaWVzKSk7XHJcbiAgICAgICAgICAgIGlmICghIWFzS2V5KSB7XHJcbiAgICAgICAgICAgICAgICBpbmplY3QkJDFbaW5kZXhdLmFzKGFzS2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPj0gMSkge1xyXG4gICAgICAgIHJldHVybiBkZWNvKGFzS2V5T3JUYXJnZXQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlY28oKTtcclxufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUtleShrZXkpIHtcclxuICAgIGlmIChrZXkgPT09IG51bGwgfHwga2V5ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2tleS92YWx1ZSBjYW5ub3QgYmUgbnVsbCBvciB1bmRlZmluZWQuIEFyZSB5b3UgdHJ5aW5nIHRvIGluamVjdC9yZWdpc3RlciBzb21ldGhpbmcgdGhhdCBkb2VzblxcJ3QgZXhpc3Qgd2l0aCBEST8nKTtcclxuICAgIH1cclxufVxyXG52YXIgX2VtcHR5UGFyYW1ldGVycyA9IE9iamVjdC5mcmVlemUoW10pO1xyXG5tZXRhZGF0YS5yZWdpc3RyYXRpb24gPSAnYXVyZWxpYTpyZWdpc3RyYXRpb24nO1xyXG5tZXRhZGF0YS5pbnZva2VyID0gJ2F1cmVsaWE6aW52b2tlcic7XHJcbnZhciByZXNvbHZlckRlY29yYXRlcyA9IHJlc29sdmVyLmRlY29yYXRlcztcclxudmFyIEludm9jYXRpb25IYW5kbGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEludm9jYXRpb25IYW5kbGVyKGZuLCBpbnZva2VyLCBkZXBlbmRlbmNpZXMpIHtcclxuICAgICAgICB0aGlzLmZuID0gZm47XHJcbiAgICAgICAgdGhpcy5pbnZva2VyID0gaW52b2tlcjtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcztcclxuICAgIH1cclxuICAgIEludm9jYXRpb25IYW5kbGVyLnByb3RvdHlwZS5pbnZva2UgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBkeW5hbWljRGVwZW5kZW5jaWVzKSB7XHJcbiAgICAgICAgcmV0dXJuIGR5bmFtaWNEZXBlbmRlbmNpZXMgIT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IHRoaXMuaW52b2tlci5pbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llcyhjb250YWluZXIsIHRoaXMuZm4sIHRoaXMuZGVwZW5kZW5jaWVzLCBkeW5hbWljRGVwZW5kZW5jaWVzKVxyXG4gICAgICAgICAgICA6IHRoaXMuaW52b2tlci5pbnZva2UoY29udGFpbmVyLCB0aGlzLmZuLCB0aGlzLmRlcGVuZGVuY2llcyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEludm9jYXRpb25IYW5kbGVyO1xyXG59KCkpO1xyXG5mdW5jdGlvbiBpbnZva2VXaXRoRHluYW1pY0RlcGVuZGVuY2llcyhjb250YWluZXIsIGZuLCBzdGF0aWNEZXBlbmRlbmNpZXMsIGR5bmFtaWNEZXBlbmRlbmNpZXMpIHtcclxuICAgIHZhciBpID0gc3RhdGljRGVwZW5kZW5jaWVzLmxlbmd0aDtcclxuICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGkpO1xyXG4gICAgdmFyIGxvb2t1cDtcclxuICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICBsb29rdXAgPSBzdGF0aWNEZXBlbmRlbmNpZXNbaV07XHJcbiAgICAgICAgaWYgKGxvb2t1cCA9PT0gbnVsbCB8fCBsb29rdXAgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbnN0cnVjdG9yIFBhcmFtZXRlciB3aXRoIGluZGV4ICcgK1xyXG4gICAgICAgICAgICAgICAgaSArXHJcbiAgICAgICAgICAgICAgICAnIGNhbm5vdCBiZSBudWxsIG9yIHVuZGVmaW5lZC4gQXJlIHlvdSB0cnlpbmcgdG8gaW5qZWN0L3JlZ2lzdGVyIHNvbWV0aGluZyB0aGF0IGRvZXNuXFwndCBleGlzdCB3aXRoIERJPycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYXJnc1tpXSA9IGNvbnRhaW5lci5nZXQobG9va3VwKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBpZiAoZHluYW1pY0RlcGVuZGVuY2llcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgYXJncyA9IGFyZ3MuY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIFJlZmxlY3QuY29uc3RydWN0KGZuLCBhcmdzKTtcclxufVxyXG52YXIgY2xhc3NJbnZva2VyID0ge1xyXG4gICAgaW52b2tlOiBmdW5jdGlvbiAoY29udGFpbmVyLCBUeXBlLCBkZXBzKSB7XHJcbiAgICAgICAgdmFyIGluc3RhbmNlcyA9IGRlcHMubWFwKGZ1bmN0aW9uIChkZXApIHsgcmV0dXJuIGNvbnRhaW5lci5nZXQoZGVwKTsgfSk7XHJcbiAgICAgICAgcmV0dXJuIFJlZmxlY3QuY29uc3RydWN0KFR5cGUsIGluc3RhbmNlcyk7XHJcbiAgICB9LFxyXG4gICAgaW52b2tlV2l0aER5bmFtaWNEZXBlbmRlbmNpZXM6IGludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzXHJcbn07XHJcbmZ1bmN0aW9uIGdldERlcGVuZGVuY2llcyhmKSB7XHJcbiAgICBpZiAoIWYuaGFzT3duUHJvcGVydHkoJ2luamVjdCcpKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBmLmluamVjdCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBmLmluamVjdCgpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGYuaW5qZWN0O1xyXG59XHJcbnZhciBDb250YWluZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29udGFpbmVyKGNvbmZpZ3VyYXRpb24pIHtcclxuICAgICAgICBpZiAoY29uZmlndXJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24gPSB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247XHJcbiAgICAgICAgdGhpcy5fb25IYW5kbGVyQ3JlYXRlZCA9IGNvbmZpZ3VyYXRpb24ub25IYW5kbGVyQ3JlYXRlZDtcclxuICAgICAgICB0aGlzLl9oYW5kbGVycyA9XHJcbiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb24uaGFuZGxlcnMgfHwgKGNvbmZpZ3VyYXRpb24uaGFuZGxlcnMgPSBuZXcgTWFwKCkpO1xyXG4gICAgICAgIHRoaXMuX3Jlc29sdmVycyA9IG5ldyBNYXAoKTtcclxuICAgICAgICB0aGlzLnJvb3QgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucGFyZW50ID0gbnVsbDtcclxuICAgIH1cclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUubWFrZUdsb2JhbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBDb250YWluZXIuaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuc2V0SGFuZGxlckNyZWF0ZWRDYWxsYmFjayA9IGZ1bmN0aW9uIChvbkhhbmRsZXJDcmVhdGVkKSB7XHJcbiAgICAgICAgdGhpcy5fb25IYW5kbGVyQ3JlYXRlZCA9IG9uSGFuZGxlckNyZWF0ZWQ7XHJcbiAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbi5vbkhhbmRsZXJDcmVhdGVkID0gb25IYW5kbGVyQ3JlYXRlZDtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVySW5zdGFuY2UgPSBmdW5jdGlvbiAoa2V5LCBpbnN0YW5jZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigwLCBpbnN0YW5jZSA9PT0gdW5kZWZpbmVkID8ga2V5IDogaW5zdGFuY2UpKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnJlZ2lzdGVyU2luZ2xldG9uID0gZnVuY3Rpb24gKGtleSwgZm4pIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclJlc29sdmVyKGtleSwgbmV3IFN0cmF0ZWd5UmVzb2x2ZXIoMSwgZm4gPT09IHVuZGVmaW5lZCA/IGtleSA6IGZuKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3RlclRyYW5zaWVudCA9IGZ1bmN0aW9uIChrZXksIGZuKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDIsIGZuID09PSB1bmRlZmluZWQgPyBrZXkgOiBmbikpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUucmVnaXN0ZXJIYW5kbGVyID0gZnVuY3Rpb24gKGtleSwgaGFuZGxlcikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcigzLCBoYW5kbGVyKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3RlckFsaWFzID0gZnVuY3Rpb24gKG9yaWdpbmFsS2V5LCBhbGlhc0tleSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyUmVzb2x2ZXIoYWxpYXNLZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDUsIG9yaWdpbmFsS2V5KSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5yZWdpc3RlclJlc29sdmVyID0gZnVuY3Rpb24gKGtleSwgcmVzb2x2ZXIkJDEpIHtcclxuICAgICAgICB2YWxpZGF0ZUtleShrZXkpO1xyXG4gICAgICAgIHZhciBhbGxSZXNvbHZlcnMgPSB0aGlzLl9yZXNvbHZlcnM7XHJcbiAgICAgICAgdmFyIHJlc3VsdCA9IGFsbFJlc29sdmVycy5nZXQoa2V5KTtcclxuICAgICAgICBpZiAocmVzdWx0ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgYWxsUmVzb2x2ZXJzLnNldChrZXksIHJlc29sdmVyJCQxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAocmVzdWx0LnN0cmF0ZWd5ID09PSA0KSB7XHJcbiAgICAgICAgICAgIHJlc3VsdC5zdGF0ZS5wdXNoKHJlc29sdmVyJCQxKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGFsbFJlc29sdmVycy5zZXQoa2V5LCBuZXcgU3RyYXRlZ3lSZXNvbHZlcig0LCBbcmVzdWx0LCByZXNvbHZlciQkMV0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmVyJCQxO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuYXV0b1JlZ2lzdGVyID0gZnVuY3Rpb24gKGtleSwgZm4pIHtcclxuICAgICAgICBmbiA9IGZuID09PSB1bmRlZmluZWQgPyBrZXkgOiBmbjtcclxuICAgICAgICBpZiAodHlwZW9mIGZuID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIHZhciByZWdpc3RyYXRpb24gPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVnaXN0cmF0aW9uLCBmbik7XHJcbiAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb24gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVnaXN0ZXJSZXNvbHZlcihrZXksIG5ldyBTdHJhdGVneVJlc29sdmVyKDEsIGZuKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvbi5yZWdpc3RlclJlc29sdmVyKHRoaXMsIGtleSwgZm4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclJlc29sdmVyKGtleSwgbmV3IFN0cmF0ZWd5UmVzb2x2ZXIoMCwgZm4pKTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmF1dG9SZWdpc3RlckFsbCA9IGZ1bmN0aW9uIChmbnMpIHtcclxuICAgICAgICB2YXIgaSA9IGZucy5sZW5ndGg7XHJcbiAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICB0aGlzLmF1dG9SZWdpc3RlcihmbnNbaV0pO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLnVucmVnaXN0ZXIgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fcmVzb2x2ZXJzLmRlbGV0ZShrZXkpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuaGFzUmVzb2x2ZXIgPSBmdW5jdGlvbiAoa2V5LCBjaGVja1BhcmVudCkge1xyXG4gICAgICAgIGlmIChjaGVja1BhcmVudCA9PT0gdm9pZCAwKSB7IGNoZWNrUGFyZW50ID0gZmFsc2U7IH1cclxuICAgICAgICB2YWxpZGF0ZUtleShrZXkpO1xyXG4gICAgICAgIHJldHVybiAodGhpcy5fcmVzb2x2ZXJzLmhhcyhrZXkpIHx8XHJcbiAgICAgICAgICAgIChjaGVja1BhcmVudCAmJlxyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICAgIHRoaXMucGFyZW50Lmhhc1Jlc29sdmVyKGtleSwgY2hlY2tQYXJlbnQpKSk7XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5nZXRSZXNvbHZlciA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fcmVzb2x2ZXJzLmdldChrZXkpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHZhbGlkYXRlS2V5KGtleSk7XHJcbiAgICAgICAgaWYgKGtleSA9PT0gQ29udGFpbmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzb2x2ZXJEZWNvcmF0ZXMoa2V5KSkge1xyXG4gICAgICAgICAgICByZXR1cm4ga2V5LmdldCh0aGlzLCBrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgcmVzb2x2ZXIkJDEgPSB0aGlzLl9yZXNvbHZlcnMuZ2V0KGtleSk7XHJcbiAgICAgICAgaWYgKHJlc29sdmVyJCQxID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMucGFyZW50ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRvUmVnaXN0ZXIoa2V5KS5nZXQodGhpcywga2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVnaXN0cmF0aW9uID0gbWV0YWRhdGEuZ2V0KG1ldGFkYXRhLnJlZ2lzdHJhdGlvbiwga2V5KTtcclxuICAgICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbiA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQuX2dldChrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZWdpc3RyYXRpb24ucmVnaXN0ZXJSZXNvbHZlcih0aGlzLCBrZXksIGtleSkuZ2V0KHRoaXMsIGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXNvbHZlciQkMS5nZXQodGhpcywga2V5KTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLl9nZXQgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFyIHJlc29sdmVyJCQxID0gdGhpcy5fcmVzb2x2ZXJzLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChyZXNvbHZlciQkMSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXV0b1JlZ2lzdGVyKGtleSkuZ2V0KHRoaXMsIGtleSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50Ll9nZXQoa2V5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmVyJCQxLmdldCh0aGlzLCBrZXkpO1xyXG4gICAgfTtcclxuICAgIENvbnRhaW5lci5wcm90b3R5cGUuZ2V0QWxsID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgIHZhbGlkYXRlS2V5KGtleSk7XHJcbiAgICAgICAgdmFyIHJlc29sdmVyJCQxID0gdGhpcy5fcmVzb2x2ZXJzLmdldChrZXkpO1xyXG4gICAgICAgIGlmIChyZXNvbHZlciQkMSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9lbXB0eVBhcmFtZXRlcnM7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdldEFsbChrZXkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVzb2x2ZXIkJDEuc3RyYXRlZ3kgPT09IDQpIHtcclxuICAgICAgICAgICAgdmFyIHN0YXRlID0gcmVzb2x2ZXIkJDEuc3RhdGU7XHJcbiAgICAgICAgICAgIHZhciBpID0gc3RhdGUubGVuZ3RoO1xyXG4gICAgICAgICAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheShpKTtcclxuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0c1tpXSA9IHN0YXRlW2ldLmdldCh0aGlzLCBrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiByZXN1bHRzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW3Jlc29sdmVyJCQxLmdldCh0aGlzLCBrZXkpXTtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmNyZWF0ZUNoaWxkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjaGlsZCA9IG5ldyBDb250YWluZXIodGhpcy5fY29uZmlndXJhdGlvbik7XHJcbiAgICAgICAgY2hpbGQucm9vdCA9IHRoaXMucm9vdDtcclxuICAgICAgICBjaGlsZC5wYXJlbnQgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBjaGlsZDtcclxuICAgIH07XHJcbiAgICBDb250YWluZXIucHJvdG90eXBlLmludm9rZSA9IGZ1bmN0aW9uIChmbiwgZHluYW1pY0RlcGVuZGVuY2llcykge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5faGFuZGxlcnMuZ2V0KGZuKTtcclxuICAgICAgICAgICAgaWYgKGhhbmRsZXIgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgaGFuZGxlciA9IHRoaXMuX2NyZWF0ZUludm9jYXRpb25IYW5kbGVyKGZuKTtcclxuICAgICAgICAgICAgICAgIHRoaXMuX2hhbmRsZXJzLnNldChmbiwgaGFuZGxlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGhhbmRsZXIuaW52b2tlKHRoaXMsIGR5bmFtaWNEZXBlbmRlbmNpZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRjaCAoZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgQWdncmVnYXRlRXJyb3IoXCJFcnJvciBpbnZva2luZyBcIiArIGZuLm5hbWUgKyBcIi4gQ2hlY2sgdGhlIGlubmVyIGVycm9yIGZvciBkZXRhaWxzLlwiLCBlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udGFpbmVyLnByb3RvdHlwZS5fY3JlYXRlSW52b2NhdGlvbkhhbmRsZXIgPSBmdW5jdGlvbiAoZm4pIHtcclxuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIGlmIChmbi5pbmplY3QgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBkZXBlbmRlbmNpZXMgPVxyXG4gICAgICAgICAgICAgICAgbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLnBhcmFtVHlwZXMsIGZuKSB8fCBfZW1wdHlQYXJhbWV0ZXJzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgZGVwZW5kZW5jaWVzID0gW107XHJcbiAgICAgICAgICAgIHZhciBjdG9yID0gZm47XHJcbiAgICAgICAgICAgIHdoaWxlICh0eXBlb2YgY3RvciA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgZGVwZW5kZW5jaWVzLnB1c2guYXBwbHkoZGVwZW5kZW5jaWVzLCBnZXREZXBlbmRlbmNpZXMoY3RvcikpO1xyXG4gICAgICAgICAgICAgICAgY3RvciA9IE9iamVjdC5nZXRQcm90b3R5cGVPZihjdG9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaW52b2tlciA9IG1ldGFkYXRhLmdldE93bihtZXRhZGF0YS5pbnZva2VyLCBmbikgfHwgY2xhc3NJbnZva2VyO1xyXG4gICAgICAgIHZhciBoYW5kbGVyID0gbmV3IEludm9jYXRpb25IYW5kbGVyKGZuLCBpbnZva2VyLCBkZXBlbmRlbmNpZXMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9vbkhhbmRsZXJDcmVhdGVkICE9PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgPyB0aGlzLl9vbkhhbmRsZXJDcmVhdGVkKGhhbmRsZXIpXHJcbiAgICAgICAgICAgIDogaGFuZGxlcjtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29udGFpbmVyO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBpbnZva2VyKHZhbHVlKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5pbnZva2VyLCB2YWx1ZSwgdGFyZ2V0KTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gaW52b2tlQXNGYWN0b3J5KHBvdGVudGlhbFRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLmludm9rZXIsIEZhY3RvcnlJbnZva2VyLmluc3RhbmNlLCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBwb3RlbnRpYWxUYXJnZXQgPyBkZWNvKHBvdGVudGlhbFRhcmdldCkgOiBkZWNvO1xyXG59XHJcbnZhciBGYWN0b3J5SW52b2tlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBGYWN0b3J5SW52b2tlcigpIHtcclxuICAgIH1cclxuICAgIEZhY3RvcnlJbnZva2VyLnByb3RvdHlwZS5pbnZva2UgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBmbiwgZGVwZW5kZW5jaWVzKSB7XHJcbiAgICAgICAgdmFyIGkgPSBkZXBlbmRlbmNpZXMubGVuZ3RoO1xyXG4gICAgICAgIHZhciBhcmdzID0gbmV3IEFycmF5KGkpO1xyXG4gICAgICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICAgICAgYXJnc1tpXSA9IGNvbnRhaW5lci5nZXQoZGVwZW5kZW5jaWVzW2ldKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZuLmFwcGx5KHVuZGVmaW5lZCwgYXJncyk7XHJcbiAgICB9O1xyXG4gICAgRmFjdG9yeUludm9rZXIucHJvdG90eXBlLmludm9rZVdpdGhEeW5hbWljRGVwZW5kZW5jaWVzID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgZm4sIHN0YXRpY0RlcGVuZGVuY2llcywgZHluYW1pY0RlcGVuZGVuY2llcykge1xyXG4gICAgICAgIHZhciBpID0gc3RhdGljRGVwZW5kZW5jaWVzLmxlbmd0aDtcclxuICAgICAgICB2YXIgYXJncyA9IG5ldyBBcnJheShpKTtcclxuICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICAgIGFyZ3NbaV0gPSBjb250YWluZXIuZ2V0KHN0YXRpY0RlcGVuZGVuY2llc1tpXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkeW5hbWljRGVwZW5kZW5jaWVzICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgYXJncyA9IGFyZ3MuY29uY2F0KGR5bmFtaWNEZXBlbmRlbmNpZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZm4uYXBwbHkodW5kZWZpbmVkLCBhcmdzKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRmFjdG9yeUludm9rZXI7XHJcbn0oKSk7XHJcbkZhY3RvcnlJbnZva2VyLmluc3RhbmNlID0gbmV3IEZhY3RvcnlJbnZva2VyKCk7XG5cbmZ1bmN0aW9uIHJlZ2lzdHJhdGlvbih2YWx1ZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVnaXN0cmF0aW9uLCB2YWx1ZSwgdGFyZ2V0KTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gdHJhbnNpZW50KGtleSkge1xyXG4gICAgcmV0dXJuIHJlZ2lzdHJhdGlvbihuZXcgVHJhbnNpZW50UmVnaXN0cmF0aW9uKGtleSkpO1xyXG59XHJcbmZ1bmN0aW9uIHNpbmdsZXRvbihrZXlPclJlZ2lzdGVySW5DaGlsZCwgcmVnaXN0ZXJJbkNoaWxkKSB7XHJcbiAgICBpZiAocmVnaXN0ZXJJbkNoaWxkID09PSB2b2lkIDApIHsgcmVnaXN0ZXJJbkNoaWxkID0gZmFsc2U7IH1cclxuICAgIHJldHVybiByZWdpc3RyYXRpb24obmV3IFNpbmdsZXRvblJlZ2lzdHJhdGlvbihrZXlPclJlZ2lzdGVySW5DaGlsZCwgcmVnaXN0ZXJJbkNoaWxkKSk7XHJcbn1cclxudmFyIFRyYW5zaWVudFJlZ2lzdHJhdGlvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUcmFuc2llbnRSZWdpc3RyYXRpb24oa2V5KSB7XHJcbiAgICAgICAgdGhpcy5fa2V5ID0ga2V5O1xyXG4gICAgfVxyXG4gICAgVHJhbnNpZW50UmVnaXN0cmF0aW9uLnByb3RvdHlwZS5yZWdpc3RlclJlc29sdmVyID0gZnVuY3Rpb24gKGNvbnRhaW5lciwga2V5LCBmbikge1xyXG4gICAgICAgIHZhciBleGlzdGluZ1Jlc29sdmVyID0gY29udGFpbmVyLmdldFJlc29sdmVyKHRoaXMuX2tleSB8fCBrZXkpO1xyXG4gICAgICAgIHJldHVybiBleGlzdGluZ1Jlc29sdmVyID09PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgPyBjb250YWluZXIucmVnaXN0ZXJUcmFuc2llbnQoKHRoaXMuX2tleSB8fCBrZXkpLCBmbilcclxuICAgICAgICAgICAgOiBleGlzdGluZ1Jlc29sdmVyO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBUcmFuc2llbnRSZWdpc3RyYXRpb247XHJcbn0oKSk7XHJcbnZhciBTaW5nbGV0b25SZWdpc3RyYXRpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2luZ2xldG9uUmVnaXN0cmF0aW9uKGtleU9yUmVnaXN0ZXJJbkNoaWxkLCByZWdpc3RlckluQ2hpbGQpIHtcclxuICAgICAgICBpZiAocmVnaXN0ZXJJbkNoaWxkID09PSB2b2lkIDApIHsgcmVnaXN0ZXJJbkNoaWxkID0gZmFsc2U7IH1cclxuICAgICAgICBpZiAodHlwZW9mIGtleU9yUmVnaXN0ZXJJbkNoaWxkID09PSAnYm9vbGVhbicpIHtcclxuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJJbkNoaWxkID0ga2V5T3JSZWdpc3RlckluQ2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9rZXkgPSBrZXlPclJlZ2lzdGVySW5DaGlsZDtcclxuICAgICAgICAgICAgdGhpcy5fcmVnaXN0ZXJJbkNoaWxkID0gcmVnaXN0ZXJJbkNoaWxkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFNpbmdsZXRvblJlZ2lzdHJhdGlvbi5wcm90b3R5cGUucmVnaXN0ZXJSZXNvbHZlciA9IGZ1bmN0aW9uIChjb250YWluZXIsIGtleSwgZm4pIHtcclxuICAgICAgICB2YXIgdGFyZ2V0Q29udGFpbmVyID0gdGhpcy5fcmVnaXN0ZXJJbkNoaWxkID8gY29udGFpbmVyIDogY29udGFpbmVyLnJvb3Q7XHJcbiAgICAgICAgdmFyIGV4aXN0aW5nUmVzb2x2ZXIgPSB0YXJnZXRDb250YWluZXIuZ2V0UmVzb2x2ZXIodGhpcy5fa2V5IHx8IGtleSk7XHJcbiAgICAgICAgcmV0dXJuIGV4aXN0aW5nUmVzb2x2ZXIgPT09IHVuZGVmaW5lZFxyXG4gICAgICAgICAgICA/IHRhcmdldENvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbih0aGlzLl9rZXkgfHwga2V5LCBmbilcclxuICAgICAgICAgICAgOiBleGlzdGluZ1Jlc29sdmVyO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTaW5nbGV0b25SZWdpc3RyYXRpb247XHJcbn0oKSk7XG5cbmV4cG9ydCB7IF9lbXB0eVBhcmFtZXRlcnMsIEludm9jYXRpb25IYW5kbGVyLCBDb250YWluZXIsIGF1dG9pbmplY3QsIGluamVjdCwgaW52b2tlciwgaW52b2tlQXNGYWN0b3J5LCBGYWN0b3J5SW52b2tlciwgcmVnaXN0cmF0aW9uLCB0cmFuc2llbnQsIHNpbmdsZXRvbiwgVHJhbnNpZW50UmVnaXN0cmF0aW9uLCBTaW5nbGV0b25SZWdpc3RyYXRpb24sIHJlc29sdmVyLCBTdHJhdGVneSwgU3RyYXRlZ3lSZXNvbHZlciwgTGF6eSwgQWxsLCBPcHRpb25hbCwgUGFyZW50LCBGYWN0b3J5LCBOZXdJbnN0YW5jZSwgZ2V0RGVjb3JhdG9yRGVwZW5kZW5jaWVzLCBsYXp5LCBhbGwsIG9wdGlvbmFsLCBwYXJlbnQsIGZhY3RvcnksIG5ld0luc3RhbmNlIH07XG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbi9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24uanNcbi8vIG1vZHVsZSBpZCA9IDFcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwidmFyIF90eXBlb2YgPSB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgdHlwZW9mIFN5bWJvbC5pdGVyYXRvciA9PT0gXCJzeW1ib2xcIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIG9iai5jb25zdHJ1Y3RvciA9PT0gU3ltYm9sICYmIG9iaiAhPT0gU3ltYm9sLnByb3RvdHlwZSA/IFwic3ltYm9sXCIgOiB0eXBlb2Ygb2JqOyB9O1xuXG5cblxuaW1wb3J0IHsgRE9NLCBGRUFUVVJFIH0gZnJvbSAnYXVyZWxpYS1wYWwnO1xuXG52YXIgc3RhY2tTZXBhcmF0b3IgPSAnXFxuRW5xdWV1ZWQgaW4gVGFza1F1ZXVlIGJ5Olxcbic7XG52YXIgbWljcm9TdGFja1NlcGFyYXRvciA9ICdcXG5FbnF1ZXVlZCBpbiBNaWNyb1Rhc2tRdWV1ZSBieTpcXG4nO1xuXG5mdW5jdGlvbiBtYWtlUmVxdWVzdEZsdXNoRnJvbU11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpIHtcbiAgdmFyIG9ic2VydmVyID0gRE9NLmNyZWF0ZU11dGF0aW9uT2JzZXJ2ZXIoZmx1c2gpO1xuICB2YXIgdmFsID0gJ2EnO1xuICB2YXIgbm9kZSA9IERPTS5jcmVhdGVUZXh0Tm9kZSgnYScpO1xuICB2YXIgdmFsdWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgdmFsdWVzLmEgPSAnYic7XG4gIHZhbHVlcy5iID0gJ2EnO1xuICBvYnNlcnZlci5vYnNlcnZlKG5vZGUsIHsgY2hhcmFjdGVyRGF0YTogdHJ1ZSB9KTtcbiAgcmV0dXJuIGZ1bmN0aW9uIHJlcXVlc3RGbHVzaCgpIHtcbiAgICBub2RlLmRhdGEgPSB2YWwgPSB2YWx1ZXNbdmFsXTtcbiAgfTtcbn1cblxuZnVuY3Rpb24gbWFrZVJlcXVlc3RGbHVzaEZyb21UaW1lcihmbHVzaCkge1xuICByZXR1cm4gZnVuY3Rpb24gcmVxdWVzdEZsdXNoKCkge1xuICAgIHZhciB0aW1lb3V0SGFuZGxlID0gc2V0VGltZW91dChoYW5kbGVGbHVzaFRpbWVyLCAwKTtcblxuICAgIHZhciBpbnRlcnZhbEhhbmRsZSA9IHNldEludGVydmFsKGhhbmRsZUZsdXNoVGltZXIsIDUwKTtcbiAgICBmdW5jdGlvbiBoYW5kbGVGbHVzaFRpbWVyKCkge1xuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVvdXRIYW5kbGUpO1xuICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbEhhbmRsZSk7XG4gICAgICBmbHVzaCgpO1xuICAgIH1cbiAgfTtcbn1cblxuZnVuY3Rpb24gb25FcnJvcihlcnJvciwgdGFzaywgbG9uZ1N0YWNrcykge1xuICBpZiAobG9uZ1N0YWNrcyAmJiB0YXNrLnN0YWNrICYmICh0eXBlb2YgZXJyb3IgPT09ICd1bmRlZmluZWQnID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKGVycm9yKSkgPT09ICdvYmplY3QnICYmIGVycm9yICE9PSBudWxsKSB7XG4gICAgZXJyb3Iuc3RhY2sgPSBmaWx0ZXJGbHVzaFN0YWNrKGVycm9yLnN0YWNrKSArIHRhc2suc3RhY2s7XG4gIH1cblxuICBpZiAoJ29uRXJyb3InIGluIHRhc2spIHtcbiAgICB0YXNrLm9uRXJyb3IoZXJyb3IpO1xuICB9IGVsc2Uge1xuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfSwgMCk7XG4gIH1cbn1cblxuZXhwb3J0IHZhciBUYXNrUXVldWUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFRhc2tRdWV1ZSgpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgXG5cbiAgICB0aGlzLmZsdXNoaW5nID0gZmFsc2U7XG4gICAgdGhpcy5sb25nU3RhY2tzID0gZmFsc2U7XG5cbiAgICB0aGlzLm1pY3JvVGFza1F1ZXVlID0gW107XG4gICAgdGhpcy5taWNyb1Rhc2tRdWV1ZUNhcGFjaXR5ID0gMTAyNDtcbiAgICB0aGlzLnRhc2tRdWV1ZSA9IFtdO1xuXG4gICAgaWYgKEZFQVRVUkUubXV0YXRpb25PYnNlcnZlcikge1xuICAgICAgdGhpcy5yZXF1ZXN0Rmx1c2hNaWNyb1Rhc2tRdWV1ZSA9IG1ha2VSZXF1ZXN0Rmx1c2hGcm9tTXV0YXRpb25PYnNlcnZlcihmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5mbHVzaE1pY3JvVGFza1F1ZXVlKCk7XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5yZXF1ZXN0Rmx1c2hNaWNyb1Rhc2tRdWV1ZSA9IG1ha2VSZXF1ZXN0Rmx1c2hGcm9tVGltZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuZmx1c2hNaWNyb1Rhc2tRdWV1ZSgpO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5yZXF1ZXN0Rmx1c2hUYXNrUXVldWUgPSBtYWtlUmVxdWVzdEZsdXNoRnJvbVRpbWVyKGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiBfdGhpcy5mbHVzaFRhc2tRdWV1ZSgpO1xuICAgIH0pO1xuICB9XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5fZmx1c2hRdWV1ZSA9IGZ1bmN0aW9uIF9mbHVzaFF1ZXVlKHF1ZXVlLCBjYXBhY2l0eSkge1xuICAgIHZhciBpbmRleCA9IDA7XG4gICAgdmFyIHRhc2sgPSB2b2lkIDA7XG5cbiAgICB0cnkge1xuICAgICAgdGhpcy5mbHVzaGluZyA9IHRydWU7XG4gICAgICB3aGlsZSAoaW5kZXggPCBxdWV1ZS5sZW5ndGgpIHtcbiAgICAgICAgdGFzayA9IHF1ZXVlW2luZGV4XTtcbiAgICAgICAgaWYgKHRoaXMubG9uZ1N0YWNrcykge1xuICAgICAgICAgIHRoaXMuc3RhY2sgPSB0eXBlb2YgdGFzay5zdGFjayA9PT0gJ3N0cmluZycgPyB0YXNrLnN0YWNrIDogdW5kZWZpbmVkO1xuICAgICAgICB9XG4gICAgICAgIHRhc2suY2FsbCgpO1xuICAgICAgICBpbmRleCsrO1xuXG4gICAgICAgIGlmIChpbmRleCA+IGNhcGFjaXR5KSB7XG4gICAgICAgICAgZm9yICh2YXIgc2NhbiA9IDAsIG5ld0xlbmd0aCA9IHF1ZXVlLmxlbmd0aCAtIGluZGV4OyBzY2FuIDwgbmV3TGVuZ3RoOyBzY2FuKyspIHtcbiAgICAgICAgICAgIHF1ZXVlW3NjYW5dID0gcXVldWVbc2NhbiArIGluZGV4XTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBxdWV1ZS5sZW5ndGggLT0gaW5kZXg7XG4gICAgICAgICAgaW5kZXggPSAwO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIG9uRXJyb3IoZXJyb3IsIHRhc2ssIHRoaXMubG9uZ1N0YWNrcyk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRoaXMuZmx1c2hpbmcgPSBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgVGFza1F1ZXVlLnByb3RvdHlwZS5xdWV1ZU1pY3JvVGFzayA9IGZ1bmN0aW9uIHF1ZXVlTWljcm9UYXNrKHRhc2spIHtcbiAgICBpZiAodGhpcy5taWNyb1Rhc2tRdWV1ZS5sZW5ndGggPCAxKSB7XG4gICAgICB0aGlzLnJlcXVlc3RGbHVzaE1pY3JvVGFza1F1ZXVlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubG9uZ1N0YWNrcykge1xuICAgICAgdGFzay5zdGFjayA9IHRoaXMucHJlcGFyZVF1ZXVlU3RhY2sobWljcm9TdGFja1NlcGFyYXRvcik7XG4gICAgfVxuXG4gICAgdGhpcy5taWNyb1Rhc2tRdWV1ZS5wdXNoKHRhc2spO1xuICB9O1xuXG4gIFRhc2tRdWV1ZS5wcm90b3R5cGUucXVldWVUYXNrID0gZnVuY3Rpb24gcXVldWVUYXNrKHRhc2spIHtcbiAgICBpZiAodGhpcy50YXNrUXVldWUubGVuZ3RoIDwgMSkge1xuICAgICAgdGhpcy5yZXF1ZXN0Rmx1c2hUYXNrUXVldWUoKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5sb25nU3RhY2tzKSB7XG4gICAgICB0YXNrLnN0YWNrID0gdGhpcy5wcmVwYXJlUXVldWVTdGFjayhzdGFja1NlcGFyYXRvcik7XG4gICAgfVxuXG4gICAgdGhpcy50YXNrUXVldWUucHVzaCh0YXNrKTtcbiAgfTtcblxuICBUYXNrUXVldWUucHJvdG90eXBlLmZsdXNoVGFza1F1ZXVlID0gZnVuY3Rpb24gZmx1c2hUYXNrUXVldWUoKSB7XG4gICAgdmFyIHF1ZXVlID0gdGhpcy50YXNrUXVldWU7XG4gICAgdGhpcy50YXNrUXVldWUgPSBbXTtcbiAgICB0aGlzLl9mbHVzaFF1ZXVlKHF1ZXVlLCBOdW1iZXIuTUFYX1ZBTFVFKTtcbiAgfTtcblxuICBUYXNrUXVldWUucHJvdG90eXBlLmZsdXNoTWljcm9UYXNrUXVldWUgPSBmdW5jdGlvbiBmbHVzaE1pY3JvVGFza1F1ZXVlKCkge1xuICAgIHZhciBxdWV1ZSA9IHRoaXMubWljcm9UYXNrUXVldWU7XG4gICAgdGhpcy5fZmx1c2hRdWV1ZShxdWV1ZSwgdGhpcy5taWNyb1Rhc2tRdWV1ZUNhcGFjaXR5KTtcbiAgICBxdWV1ZS5sZW5ndGggPSAwO1xuICB9O1xuXG4gIFRhc2tRdWV1ZS5wcm90b3R5cGUucHJlcGFyZVF1ZXVlU3RhY2sgPSBmdW5jdGlvbiBwcmVwYXJlUXVldWVTdGFjayhzZXBhcmF0b3IpIHtcbiAgICB2YXIgc3RhY2sgPSBzZXBhcmF0b3IgKyBmaWx0ZXJRdWV1ZVN0YWNrKGNhcHR1cmVTdGFjaygpKTtcblxuICAgIGlmICh0eXBlb2YgdGhpcy5zdGFjayA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHN0YWNrID0gZmlsdGVyRmx1c2hTdGFjayhzdGFjaykgKyB0aGlzLnN0YWNrO1xuICAgIH1cblxuICAgIHJldHVybiBzdGFjaztcbiAgfTtcblxuICByZXR1cm4gVGFza1F1ZXVlO1xufSgpO1xuXG5mdW5jdGlvbiBjYXB0dXJlU3RhY2soKSB7XG4gIHZhciBlcnJvciA9IG5ldyBFcnJvcigpO1xuXG4gIGlmIChlcnJvci5zdGFjaykge1xuICAgIHJldHVybiBlcnJvci5zdGFjaztcbiAgfVxuXG4gIHRyeSB7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4gZS5zdGFjaztcbiAgfVxufVxuXG5mdW5jdGlvbiBmaWx0ZXJRdWV1ZVN0YWNrKHN0YWNrKSB7XG4gIHJldHVybiBzdGFjay5yZXBsYWNlKC9eW1xcc1xcU10qP1xcYnF1ZXVlKE1pY3JvKT9UYXNrXFxiW15cXG5dKlxcbi8sICcnKTtcbn1cblxuZnVuY3Rpb24gZmlsdGVyRmx1c2hTdGFjayhzdGFjaykge1xuICB2YXIgaW5kZXggPSBzdGFjay5sYXN0SW5kZXhPZignZmx1c2hNaWNyb1Rhc2tRdWV1ZScpO1xuXG4gIGlmIChpbmRleCA8IDApIHtcbiAgICBpbmRleCA9IHN0YWNrLmxhc3RJbmRleE9mKCdmbHVzaFRhc2tRdWV1ZScpO1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIHJldHVybiBzdGFjaztcbiAgICB9XG4gIH1cblxuICBpbmRleCA9IHN0YWNrLmxhc3RJbmRleE9mKCdcXG4nLCBpbmRleCk7XG5cbiAgcmV0dXJuIGluZGV4IDwgMCA/IHN0YWNrIDogc3RhY2suc3Vic3RyKDAsIGluZGV4KTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10YXNrLXF1ZXVlL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10YXNrLXF1ZXVlLmpzXG4vLyBtb2R1bGUgaWQgPSAxMzhcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiXG5cbmZ1bmN0aW9uIG1pKG5hbWUpIHtcbiAgdGhyb3cgbmV3IEVycm9yKCdIaXN0b3J5IG11c3QgaW1wbGVtZW50ICcgKyBuYW1lICsgJygpLicpO1xufVxuXG5leHBvcnQgdmFyIEhpc3RvcnkgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEhpc3RvcnkoKSB7XG4gICAgXG4gIH1cblxuICBIaXN0b3J5LnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uIGFjdGl2YXRlKG9wdGlvbnMpIHtcbiAgICBtaSgnYWN0aXZhdGUnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gZGVhY3RpdmF0ZSgpIHtcbiAgICBtaSgnZGVhY3RpdmF0ZScpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLmdldEFic29sdXRlUm9vdCA9IGZ1bmN0aW9uIGdldEFic29sdXRlUm9vdCgpIHtcbiAgICBtaSgnZ2V0QWJzb2x1dGVSb290Jyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUubmF2aWdhdGUgPSBmdW5jdGlvbiBuYXZpZ2F0ZShmcmFnbWVudCwgb3B0aW9ucykge1xuICAgIG1pKCduYXZpZ2F0ZScpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLm5hdmlnYXRlQmFjayA9IGZ1bmN0aW9uIG5hdmlnYXRlQmFjaygpIHtcbiAgICBtaSgnbmF2aWdhdGVCYWNrJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiBzZXRUaXRsZSh0aXRsZSkge1xuICAgIG1pKCdzZXRUaXRsZScpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24gc2V0U3RhdGUoa2V5LCB2YWx1ZSkge1xuICAgIG1pKCdzZXRTdGF0ZScpO1xuICB9O1xuXG4gIEhpc3RvcnkucHJvdG90eXBlLmdldFN0YXRlID0gZnVuY3Rpb24gZ2V0U3RhdGUoa2V5KSB7XG4gICAgbWkoJ2dldFN0YXRlJyk7XG4gIH07XG5cbiAgSGlzdG9yeS5wcm90b3R5cGUuZ2V0SGlzdG9yeUluZGV4ID0gZnVuY3Rpb24gZ2V0SGlzdG9yeUluZGV4KCkge1xuICAgIG1pKCdnZXRIaXN0b3J5SW5kZXgnKTtcbiAgfTtcblxuICBIaXN0b3J5LnByb3RvdHlwZS5nbyA9IGZ1bmN0aW9uIGdvKG1vdmVtZW50KSB7XG4gICAgbWkoJ2dvJyk7XG4gIH07XG5cbiAgcmV0dXJuIEhpc3Rvcnk7XG59KCk7XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtaGlzdG9yeS9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtaGlzdG9yeS5qc1xuLy8gbW9kdWxlIGlkID0gMjEzXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsImltcG9ydCB7IERPTSwgRkVBVFVSRSwgUExBVEZPUk0gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgeyBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnksIExvYWRlciB9IGZyb20gJ2F1cmVsaWEtbG9hZGVyJztcbmltcG9ydCB7IG1ldGFkYXRhLCBPcmlnaW4sIHByb3RvY29sIH0gZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5pbXBvcnQgeyByZWxhdGl2ZVRvRmlsZSB9IGZyb20gJ2F1cmVsaWEtcGF0aCc7XG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5pbXBvcnQgeyBzdWJzY3JpYmVyQ29sbGVjdGlvbiwgYmluZGluZ01vZGUsIGNyZWF0ZU92ZXJyaWRlQ29udGV4dCwgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZSwgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UsIE9ic2VydmVyTG9jYXRvciwgY2FtZWxDYXNlLCBFdmVudE1hbmFnZXIgfSBmcm9tICdhdXJlbGlhLWJpbmRpbmcnO1xuaW1wb3J0IHsgQ29udGFpbmVyLCByZXNvbHZlciwgaW5qZWN0IH0gZnJvbSAnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbic7XG5pbXBvcnQgeyBUYXNrUXVldWUgfSBmcm9tICdhdXJlbGlhLXRhc2stcXVldWUnO1xuXG52YXIgRWxlbWVudEV2ZW50cyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBFbGVtZW50RXZlbnRzKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IHt9O1xyXG4gICAgfVxyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuX2VucXVldWVIYW5kbGVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdID0gdGhpcy5zdWJzY3JpcHRpb25zW2hhbmRsZXIuZXZlbnROYW1lXSB8fCBbXTtcclxuICAgICAgICB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdLnB1c2goaGFuZGxlcik7XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuX2RlcXVldWVIYW5kbGVyID0gZnVuY3Rpb24gKGhhbmRsZXIpIHtcclxuICAgICAgICB2YXIgaW5kZXg7XHJcbiAgICAgICAgdmFyIHN1YnNjcmlwdGlvbnMgPSB0aGlzLnN1YnNjcmlwdGlvbnNbaGFuZGxlci5ldmVudE5hbWVdO1xyXG4gICAgICAgIGlmIChzdWJzY3JpcHRpb25zKSB7XHJcbiAgICAgICAgICAgIGluZGV4ID0gc3Vic2NyaXB0aW9ucy5pbmRleE9mKGhhbmRsZXIpO1xyXG4gICAgICAgICAgICBpZiAoaW5kZXggPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9ucy5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoYW5kbGVyO1xyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLnB1Ymxpc2ggPSBmdW5jdGlvbiAoZXZlbnROYW1lLCBkZXRhaWwsIGJ1YmJsZXMsIGNhbmNlbGFibGUpIHtcclxuICAgICAgICBpZiAoZGV0YWlsID09PSB2b2lkIDApIHsgZGV0YWlsID0ge307IH1cclxuICAgICAgICBpZiAoYnViYmxlcyA9PT0gdm9pZCAwKSB7IGJ1YmJsZXMgPSB0cnVlOyB9XHJcbiAgICAgICAgaWYgKGNhbmNlbGFibGUgPT09IHZvaWQgMCkgeyBjYW5jZWxhYmxlID0gdHJ1ZTsgfVxyXG4gICAgICAgIHZhciBldmVudCA9IERPTS5jcmVhdGVDdXN0b21FdmVudChldmVudE5hbWUsIHsgY2FuY2VsYWJsZTogY2FuY2VsYWJsZSwgYnViYmxlczogYnViYmxlcywgZGV0YWlsOiBkZXRhaWwgfSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmRpc3BhdGNoRXZlbnQoZXZlbnQpO1xyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIsIGNhcHR1cmVPck9wdGlvbnMpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgaWYgKGNhcHR1cmVPck9wdGlvbnMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY2FwdHVyZU9yT3B0aW9ucyA9IEVsZW1lbnRFdmVudHMuZGVmYXVsdExpc3RlbmVyT3B0aW9ucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgZXZlbnRIYW5kbGVyID0gbmV3IEV2ZW50SGFuZGxlckltcGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBldmVudEhhbmRsZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgRWxlbWVudEV2ZW50cy5wcm90b3R5cGUuc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uIChldmVudE5hbWUsIGhhbmRsZXIsIGNhcHR1cmVPck9wdGlvbnMpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgaWYgKGNhcHR1cmVPck9wdGlvbnMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY2FwdHVyZU9yT3B0aW9ucyA9IEVsZW1lbnRFdmVudHMuZGVmYXVsdExpc3RlbmVyT3B0aW9ucztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgZXZlbnRIYW5kbGVyID0gbmV3IEV2ZW50SGFuZGxlckltcGwodGhpcywgZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zLCB0cnVlKTtcclxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50SGFuZGxlcjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xyXG4gICAgICAgIGlmIChldmVudE5hbWUgJiYgdHlwZW9mIGV2ZW50TmFtZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdmFyIHN1YnNjcmlwdGlvbnMgPSB0aGlzLnN1YnNjcmlwdGlvbnNbZXZlbnROYW1lXTtcclxuICAgICAgICAgICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChzdWJzY3JpcHRpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25zLnBvcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3Vic2NyaXB0aW9uLmRpc3Bvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZUFsbCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFbGVtZW50RXZlbnRzLnByb3RvdHlwZS5kaXNwb3NlQWxsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZvciAodmFyIGtleSBpbiB0aGlzLnN1YnNjcmlwdGlvbnMpIHtcclxuICAgICAgICAgICAgdGhpcy5kaXNwb3NlKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEVsZW1lbnRFdmVudHMuZGVmYXVsdExpc3RlbmVyT3B0aW9ucyA9IHRydWU7XHJcbiAgICByZXR1cm4gRWxlbWVudEV2ZW50cztcclxufSgpKTtcclxudmFyIEV2ZW50SGFuZGxlckltcGwgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRXZlbnRIYW5kbGVySW1wbChvd25lciwgZXZlbnROYW1lLCBoYW5kbGVyLCBjYXB0dXJlT3JPcHRpb25zLCBvbmNlKSB7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG93bmVyO1xyXG4gICAgICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XHJcbiAgICAgICAgdGhpcy5jYXB0dXJlID0gdHlwZW9mIGNhcHR1cmVPck9wdGlvbnMgPT09ICdib29sZWFuJyA/IGNhcHR1cmVPck9wdGlvbnMgOiBjYXB0dXJlT3JPcHRpb25zLmNhcHR1cmU7XHJcbiAgICAgICAgdGhpcy5idWJibGVzID0gIXRoaXMuY2FwdHVyZTtcclxuICAgICAgICB0aGlzLmNhcHR1cmVPck9wdGlvbnMgPSBjYXB0dXJlT3JPcHRpb25zO1xyXG4gICAgICAgIHRoaXMub25jZSA9IG9uY2U7XHJcbiAgICAgICAgb3duZXIuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgdGhpcywgY2FwdHVyZU9yT3B0aW9ucyk7XHJcbiAgICAgICAgb3duZXIuX2VucXVldWVIYW5kbGVyKHRoaXMpO1xyXG4gICAgfVxyXG4gICAgRXZlbnRIYW5kbGVySW1wbC5wcm90b3R5cGUuaGFuZGxlRXZlbnQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciBmbiA9IHRoaXMuaGFuZGxlcjtcclxuICAgICAgICBmbihlKTtcclxuICAgICAgICBpZiAodGhpcy5vbmNlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuZGlzcG9zZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBFdmVudEhhbmRsZXJJbXBsLnByb3RvdHlwZS5kaXNwb3NlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMub3duZXIuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLCB0aGlzLmNhcHR1cmVPck9wdGlvbnMpO1xyXG4gICAgICAgIHRoaXMub3duZXIuX2RlcXVldWVIYW5kbGVyKHRoaXMpO1xyXG4gICAgICAgIHRoaXMub3duZXIgPSB0aGlzLmhhbmRsZXIgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBFdmVudEhhbmRsZXJJbXBsO1xyXG59KCkpO1xuXG52YXIgUmVzb3VyY2VMb2FkQ29udGV4dCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXNvdXJjZUxvYWRDb250ZXh0KCkge1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzID0ge307XHJcbiAgICB9XHJcbiAgICBSZXNvdXJjZUxvYWRDb250ZXh0LnByb3RvdHlwZS5hZGREZXBlbmRlbmN5ID0gZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jaWVzW3VybF0gPSB0cnVlO1xyXG4gICAgfTtcclxuICAgIFJlc291cmNlTG9hZENvbnRleHQucHJvdG90eXBlLmhhc0RlcGVuZGVuY3kgPSBmdW5jdGlvbiAodXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIHVybCBpbiB0aGlzLmRlcGVuZGVuY2llcztcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVzb3VyY2VMb2FkQ29udGV4dDtcclxufSgpKTtcclxudmFyIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0NvbXBpbGVJbnN0cnVjdGlvbih0YXJnZXRTaGFkb3dET00sIGNvbXBpbGVTdXJyb2dhdGUpIHtcclxuICAgICAgICBpZiAodGFyZ2V0U2hhZG93RE9NID09PSB2b2lkIDApIHsgdGFyZ2V0U2hhZG93RE9NID0gZmFsc2U7IH1cclxuICAgICAgICBpZiAoY29tcGlsZVN1cnJvZ2F0ZSA9PT0gdm9pZCAwKSB7IGNvbXBpbGVTdXJyb2dhdGUgPSBmYWxzZTsgfVxyXG4gICAgICAgIHRoaXMudGFyZ2V0U2hhZG93RE9NID0gdGFyZ2V0U2hhZG93RE9NO1xyXG4gICAgICAgIHRoaXMuY29tcGlsZVN1cnJvZ2F0ZSA9IGNvbXBpbGVTdXJyb2dhdGU7XHJcbiAgICAgICAgdGhpcy5hc3NvY2lhdGVkTW9kdWxlSWQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgVmlld0NvbXBpbGVJbnN0cnVjdGlvbi5ub3JtYWwgPSBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbigpO1xyXG4gICAgcmV0dXJuIFZpZXdDb21waWxlSW5zdHJ1Y3Rpb247XHJcbn0oKSk7XHJcbnZhciBCZWhhdmlvckluc3RydWN0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKSB7XHJcbiAgICB9XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLmVuaGFuY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5lbmhhbmNlID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi51bml0VGVzdCA9IGZ1bmN0aW9uICh0eXBlLCBhdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzID0gYXR0cmlidXRlcyB8fCB7fTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi5lbGVtZW50ID0gZnVuY3Rpb24gKG5vZGUsIHR5cGUpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lciA9ICEobm9kZS5oYXNBdHRyaWJ1dGUoJ2NvbnRhaW5lcmxlc3MnKSB8fCB0eXBlLmNvbnRhaW5lcmxlc3MpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmluaXRpYXRlZEJ5QmVoYXZpb3IgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChhdHRyTmFtZSwgdHlwZSkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBCZWhhdmlvckluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0ck5hbWUgPSBhdHRyTmFtZTtcclxuICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZSB8fCBudWxsO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JJbnN0cnVjdGlvbi5keW5hbWljID0gZnVuY3Rpb24gKGhvc3QsIHZpZXdNb2RlbCwgdmlld0ZhY3RvcnkpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgQmVoYXZpb3JJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmhvc3QgPSBob3N0O1xyXG4gICAgICAgIGluc3RydWN0aW9uLnZpZXdNb2RlbCA9IHZpZXdNb2RlbDtcclxuICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIGluc3RydWN0aW9uLmluaGVyaXRCaW5kaW5nQ29udGV4dCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9ySW5zdHJ1Y3Rpb24ubm9ybWFsID0gbmV3IEJlaGF2aW9ySW5zdHJ1Y3Rpb24oKTtcclxuICAgIHJldHVybiBCZWhhdmlvckluc3RydWN0aW9uO1xyXG59KCkpO1xyXG52YXIgYmlQcm90byA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24ucHJvdG90eXBlO1xyXG5iaVByb3RvLmluaXRpYXRlZEJ5QmVoYXZpb3IgPSBmYWxzZTtcclxuYmlQcm90by5lbmhhbmNlID0gZmFsc2U7XHJcbmJpUHJvdG8ucGFydFJlcGxhY2VtZW50cyA9IG51bGw7XHJcbmJpUHJvdG8udmlld0ZhY3RvcnkgPSBudWxsO1xyXG5iaVByb3RvLm9yaWdpbmFsQXR0ck5hbWUgPSBudWxsO1xyXG5iaVByb3RvLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IGZhbHNlO1xyXG5iaVByb3RvLmNvbnRlbnRGYWN0b3J5ID0gbnVsbDtcclxuYmlQcm90by52aWV3TW9kZWwgPSBudWxsO1xyXG5iaVByb3RvLmFuY2hvcklzQ29udGFpbmVyID0gZmFsc2U7XHJcbmJpUHJvdG8uaG9zdCA9IG51bGw7XHJcbmJpUHJvdG8uYXR0cmlidXRlcyA9IG51bGw7XHJcbmJpUHJvdG8udHlwZSA9IG51bGw7XHJcbmJpUHJvdG8uYXR0ck5hbWUgPSBudWxsO1xyXG5iaVByb3RvLmluaGVyaXRCaW5kaW5nQ29udGV4dCA9IGZhbHNlO1xyXG52YXIgVGFyZ2V0SW5zdHJ1Y3Rpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVGFyZ2V0SW5zdHJ1Y3Rpb24oKSB7XHJcbiAgICB9XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5zaGFkb3dTbG90ID0gZnVuY3Rpb24gKHBhcmVudEluamVjdG9ySWQpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBuZXcgVGFyZ2V0SW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5wYXJlbnRJbmplY3RvcklkID0gcGFyZW50SW5qZWN0b3JJZDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5zaGFkb3dTbG90ID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24gPSBmdW5jdGlvbiAoZXhwcmVzc2lvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uID0gZXhwcmVzc2lvbjtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgVGFyZ2V0SW5zdHJ1Y3Rpb24ubGV0RWxlbWVudCA9IGZ1bmN0aW9uIChleHByZXNzaW9ucykge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ubGV0RWxlbWVudCA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLmxpZnRpbmcgPSBmdW5jdGlvbiAocGFyZW50SW5qZWN0b3JJZCwgbGlmdGluZ0luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZCA9IHBhcmVudEluamVjdG9ySWQ7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBUYXJnZXRJbnN0cnVjdGlvbi5ub0V4cHJlc3Npb25zO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gW2xpZnRpbmdJbnN0cnVjdGlvbl07XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSBsaWZ0aW5nSW5zdHJ1Y3Rpb24udmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gW2xpZnRpbmdJbnN0cnVjdGlvbi50eXBlLnRhcmdldF07XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ubGlmdGluZyA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFRhcmdldEluc3RydWN0aW9uLm5vcm1hbCA9IGZ1bmN0aW9uIChpbmplY3RvcklkLCBwYXJlbnRJbmplY3RvcklkLCBwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgZWxlbWVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gbmV3IFRhcmdldEluc3RydWN0aW9uKCk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uaW5qZWN0b3JJZCA9IGluamVjdG9ySWQ7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucGFyZW50SW5qZWN0b3JJZCA9IHBhcmVudEluamVjdG9ySWQ7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24ucHJvdmlkZXJzID0gcHJvdmlkZXJzO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gYmVoYXZpb3JJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnMgPSBleHByZXNzaW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lciA9IGVsZW1lbnRJbnN0cnVjdGlvbiA/IGVsZW1lbnRJbnN0cnVjdGlvbi5hbmNob3JJc0NvbnRhaW5lciA6IHRydWU7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uZWxlbWVudEluc3RydWN0aW9uID0gZWxlbWVudEluc3RydWN0aW9uO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5zdXJyb2dhdGUgPSBmdW5jdGlvbiAocHJvdmlkZXJzLCBiZWhhdmlvckluc3RydWN0aW9ucywgZXhwcmVzc2lvbnMsIHZhbHVlcykge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IG5ldyBUYXJnZXRJbnN0cnVjdGlvbigpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmV4cHJlc3Npb25zID0gZXhwcmVzc2lvbnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBiZWhhdmlvckluc3RydWN0aW9ucztcclxuICAgICAgICBpbnN0cnVjdGlvbi5wcm92aWRlcnMgPSBwcm92aWRlcnM7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmFsdWVzID0gdmFsdWVzO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUYXJnZXRJbnN0cnVjdGlvbi5ub0V4cHJlc3Npb25zID0gT2JqZWN0LmZyZWV6ZShbXSk7XHJcbiAgICByZXR1cm4gVGFyZ2V0SW5zdHJ1Y3Rpb247XHJcbn0oKSk7XHJcbnZhciB0aVByb3RvID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ucHJvdG90eXBlO1xyXG50aVByb3RvLmluamVjdG9ySWQgPSBudWxsO1xyXG50aVByb3RvLnBhcmVudEluamVjdG9ySWQgPSBudWxsO1xyXG50aVByb3RvLnNoYWRvd1Nsb3QgPSBmYWxzZTtcclxudGlQcm90by5zbG90TmFtZSA9IG51bGw7XHJcbnRpUHJvdG8uc2xvdEZhbGxiYWNrRmFjdG9yeSA9IG51bGw7XHJcbnRpUHJvdG8uY29udGVudEV4cHJlc3Npb24gPSBudWxsO1xyXG50aVByb3RvLmxldEVsZW1lbnQgPSBmYWxzZTtcclxudGlQcm90by5leHByZXNzaW9ucyA9IG51bGw7XHJcbnRpUHJvdG8uZXhwcmVzc2lvbnMgPSBudWxsO1xyXG50aVByb3RvLnByb3ZpZGVycyA9IG51bGw7XHJcbnRpUHJvdG8udmlld0ZhY3RvcnkgPSBudWxsO1xyXG50aVByb3RvLmFuY2hvcklzQ29udGFpbmVyID0gZmFsc2U7XHJcbnRpUHJvdG8uZWxlbWVudEluc3RydWN0aW9uID0gbnVsbDtcclxudGlQcm90by5saWZ0aW5nID0gZmFsc2U7XHJcbnRpUHJvdG8udmFsdWVzID0gbnVsbDtcblxuLyohICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqXHJcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxyXG5cclxuUGVybWlzc2lvbiB0byB1c2UsIGNvcHksIG1vZGlmeSwgYW5kL29yIGRpc3RyaWJ1dGUgdGhpcyBzb2Z0d2FyZSBmb3IgYW55XHJcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cclxuXHJcblRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCBcIkFTIElTXCIgQU5EIFRIRSBBVVRIT1IgRElTQ0xBSU1TIEFMTCBXQVJSQU5USUVTIFdJVEhcclxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXHJcbkFORCBGSVRORVNTLiBJTiBOTyBFVkVOVCBTSEFMTCBUSEUgQVVUSE9SIEJFIExJQUJMRSBGT1IgQU5ZIFNQRUNJQUwsIERJUkVDVCxcclxuSU5ESVJFQ1QsIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyBPUiBBTlkgREFNQUdFUyBXSEFUU09FVkVSIFJFU1VMVElORyBGUk9NXHJcbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXHJcbk9USEVSIFRPUlRJT1VTIEFDVElPTiwgQVJJU0lORyBPVVQgT0YgT1IgSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBVU0UgT1JcclxuUEVSRk9STUFOQ0UgT0YgVEhJUyBTT0ZUV0FSRS5cclxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cclxuXHJcbmZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cblxudmFyIGNhcGl0YWxNYXRjaGVyID0gLyhbQS1aXSkvZztcclxuZnVuY3Rpb24gYWRkSHlwaGVuQW5kTG93ZXIoY2hhcikge1xyXG4gICAgcmV0dXJuICctJyArIGNoYXIudG9Mb3dlckNhc2UoKTtcclxufVxyXG5mdW5jdGlvbiBfaHlwaGVuYXRlKG5hbWUpIHtcclxuICAgIHJldHVybiAobmFtZS5jaGFyQXQoMCkudG9Mb3dlckNhc2UoKSArIG5hbWUuc2xpY2UoMSkpLnJlcGxhY2UoY2FwaXRhbE1hdGNoZXIsIGFkZEh5cGhlbkFuZExvd2VyKTtcclxufVxyXG5mdW5jdGlvbiBfaXNBbGxXaGl0ZXNwYWNlKG5vZGUpIHtcclxuICAgIHJldHVybiAhKG5vZGUuYXVJbnRlcnBvbGF0aW9uVGFyZ2V0IHx8ICgvW15cXHRcXG5cXHIgXS8udGVzdChub2RlLnRleHRDb250ZW50KSkpO1xyXG59XG5cbnZhciBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyKHRhc2tRdWV1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUsIHNlbGZTdWJzY3JpYmVyLCBpbml0aWFsVmFsdWUpIHtcclxuICAgICAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcclxuICAgICAgICB0aGlzLm9iaiA9IG9iajtcclxuICAgICAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcclxuICAgICAgICB0aGlzLm5vdHF1ZXVlZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5wdWJsaXNoaW5nID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFZhbHVlID0gdGhpcy5vbGRWYWx1ZSA9IGluaXRpYWxWYWx1ZTtcclxuICAgIH1cclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudFZhbHVlO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLmN1cnJlbnRWYWx1ZTtcclxuICAgICAgICBpZiAoIU9iamVjdC5pcyhuZXdWYWx1ZSwgb2xkVmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHRoaXMub2xkVmFsdWUgPSBvbGRWYWx1ZTtcclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50VmFsdWUgPSBuZXdWYWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMucHVibGlzaGluZyAmJiB0aGlzLm5vdHF1ZXVlZCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudGFza1F1ZXVlLmZsdXNoaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLm5vdHF1ZXVlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xyXG4gICAgICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xyXG4gICAgICAgIHRoaXMubm90cXVldWVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoT2JqZWN0LmlzKG5ld1ZhbHVlLCBvbGRWYWx1ZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5zZWxmU3Vic2NyaWJlcikge1xyXG4gICAgICAgICAgICB0aGlzLnNlbGZTdWJzY3JpYmVyKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgdGhpcy5vbGRWYWx1ZSA9IG5ld1ZhbHVlO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUuY2FsbFN1YnNjcmliZXJzID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYWJsZSkge1xyXG4gICAgICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XHJcbiAgICB9O1xyXG4gICAgQmVoYXZpb3JQcm9wZXJ0eU9ic2VydmVyLnByb3RvdHlwZS5hZGRTdWJzY3JpYmVyID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxhYmxlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoY29udGV4dCwgY2FsbGFibGUpIHtcclxuICAgICAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xyXG4gICAgfTtcclxuICAgIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlci5wcm90b3R5cGUucmVtb3ZlU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYWJsZSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH07XHJcbiAgICBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBzdWJzY3JpYmVyQ29sbGVjdGlvbigpXHJcbiAgICBdLCBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIpO1xyXG4gICAgcmV0dXJuIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlcjtcclxufSgpKTtcblxuZnVuY3Rpb24gZ2V0T2JzZXJ2ZXIoaW5zdGFuY2UsIG5hbWUpIHtcclxuICAgIHZhciBsb29rdXAgPSBpbnN0YW5jZS5fX29ic2VydmVyc19fO1xyXG4gICAgaWYgKGxvb2t1cCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgdmFyIGN0b3IgPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YoaW5zdGFuY2UpLmNvbnN0cnVjdG9yO1xyXG4gICAgICAgIHZhciBiZWhhdmlvciA9IG1ldGFkYXRhLmdldChtZXRhZGF0YS5yZXNvdXJjZSwgY3Rvcik7XHJcbiAgICAgICAgaWYgKCFiZWhhdmlvci5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIGJlaGF2aW9yLmluaXRpYWxpemUoQ29udGFpbmVyLmluc3RhbmNlIHx8IG5ldyBDb250YWluZXIoKSwgaW5zdGFuY2UuY29uc3RydWN0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsb29rdXAgPSBiZWhhdmlvci5vYnNlcnZlckxvY2F0b3IuZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAoaW5zdGFuY2UpO1xyXG4gICAgICAgIGJlaGF2aW9yLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZChpbnN0YW5jZSwgbG9va3VwKTtcclxuICAgIH1cclxuICAgIHJldHVybiBsb29rdXBbbmFtZV07XHJcbn1cclxudmFyIEJpbmRhYmxlUHJvcGVydHkgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQmluZGFibGVQcm9wZXJ0eShuYW1lT3JDb25maWcpIHtcclxuICAgICAgICBpZiAodHlwZW9mIG5hbWVPckNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5uYW1lID0gbmFtZU9yQ29uZmlnO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBuYW1lT3JDb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZSA9IHRoaXMuYXR0cmlidXRlIHx8IF9oeXBoZW5hdGUodGhpcy5uYW1lKTtcclxuICAgICAgICB2YXIgZGVmYXVsdEJpbmRpbmdNb2RlID0gdGhpcy5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgaWYgKGRlZmF1bHRCaW5kaW5nTW9kZSA9PT0gbnVsbCB8fCBkZWZhdWx0QmluZGluZ01vZGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aGlzLmRlZmF1bHRCaW5kaW5nTW9kZSA9IGJpbmRpbmdNb2RlLm9uZVdheTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIGRlZmF1bHRCaW5kaW5nTW9kZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0QmluZGluZ01vZGUgPSBiaW5kaW5nTW9kZVtkZWZhdWx0QmluZGluZ01vZGVdIHx8IGJpbmRpbmdNb2RlLm9uZVdheTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VIYW5kbGVyID0gdGhpcy5jaGFuZ2VIYW5kbGVyIHx8IG51bGw7XHJcbiAgICAgICAgdGhpcy5vd25lciA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5kZXNjcmlwdG9yID0gbnVsbDtcclxuICAgIH1cclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLnJlZ2lzdGVyV2l0aCA9IGZ1bmN0aW9uICh0YXJnZXQsIGJlaGF2aW9yLCBkZXNjcmlwdG9yKSB7XHJcbiAgICAgICAgYmVoYXZpb3IucHJvcGVydGllcy5wdXNoKHRoaXMpO1xyXG4gICAgICAgIGJlaGF2aW9yLmF0dHJpYnV0ZXNbdGhpcy5hdHRyaWJ1dGVdID0gdGhpcztcclxuICAgICAgICB0aGlzLm93bmVyID0gYmVoYXZpb3I7XHJcbiAgICAgICAgaWYgKGRlc2NyaXB0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5kZXNjcmlwdG9yID0gZGVzY3JpcHRvcjtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZ3VyZURlc2NyaXB0b3IoZGVzY3JpcHRvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuX2NvbmZpZ3VyZURlc2NyaXB0b3IgPSBmdW5jdGlvbiAoZGVzY3JpcHRvcikge1xyXG4gICAgICAgIHZhciBuYW1lID0gdGhpcy5uYW1lO1xyXG4gICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTtcclxuICAgICAgICBkZXNjcmlwdG9yLmVudW1lcmFibGUgPSB0cnVlO1xyXG4gICAgICAgIGlmICgnaW5pdGlhbGl6ZXInIGluIGRlc2NyaXB0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSBkZXNjcmlwdG9yLmluaXRpYWxpemVyO1xyXG4gICAgICAgICAgICBkZWxldGUgZGVzY3JpcHRvci5pbml0aWFsaXplcjtcclxuICAgICAgICAgICAgZGVsZXRlIGRlc2NyaXB0b3Iud3JpdGFibGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgndmFsdWUnIGluIGRlc2NyaXB0b3IpIHtcclxuICAgICAgICAgICAgdGhpcy5kZWZhdWx0VmFsdWUgPSBkZXNjcmlwdG9yLnZhbHVlO1xyXG4gICAgICAgICAgICBkZWxldGUgZGVzY3JpcHRvci52YWx1ZTtcclxuICAgICAgICAgICAgZGVsZXRlIGRlc2NyaXB0b3Iud3JpdGFibGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGRlc2NyaXB0b3IuZ2V0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0T2JzZXJ2ZXIodGhpcywgbmFtZSkuZ2V0VmFsdWUoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlc2NyaXB0b3Iuc2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIGdldE9ic2VydmVyKHRoaXMsIG5hbWUpLnNldFZhbHVlKHZhbHVlKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlc2NyaXB0b3IuZ2V0LmdldE9ic2VydmVyID0gZnVuY3Rpb24gKG9iaikge1xyXG4gICAgICAgICAgICByZXR1cm4gZ2V0T2JzZXJ2ZXIob2JqLCBuYW1lKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHJldHVybiBkZXNjcmlwdG9yO1xyXG4gICAgfTtcclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLmRlZmluZU9uID0gZnVuY3Rpb24gKHRhcmdldCwgYmVoYXZpb3IpIHtcclxuICAgICAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcclxuICAgICAgICB2YXIgaGFuZGxlck5hbWU7XHJcbiAgICAgICAgaWYgKHRoaXMuY2hhbmdlSGFuZGxlciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBoYW5kbGVyTmFtZSA9IG5hbWUgKyAnQ2hhbmdlZCc7XHJcbiAgICAgICAgICAgIGlmIChoYW5kbGVyTmFtZSBpbiB0YXJnZXQucHJvdG90eXBlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBoYW5kbGVyTmFtZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kZXNjcmlwdG9yID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQucHJvdG90eXBlLCBuYW1lLCB0aGlzLl9jb25maWd1cmVEZXNjcmlwdG9yKHt9KSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJpbmRhYmxlUHJvcGVydHkucHJvdG90eXBlLmNyZWF0ZU9ic2VydmVyID0gZnVuY3Rpb24gKHZpZXdNb2RlbCkge1xyXG4gICAgICAgIHZhciBzZWxmU3Vic2NyaWJlciA9IG51bGw7XHJcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIHZhciBjaGFuZ2VIYW5kbGVyTmFtZSA9IHRoaXMuY2hhbmdlSGFuZGxlcjtcclxuICAgICAgICB2YXIgbmFtZSA9IHRoaXMubmFtZTtcclxuICAgICAgICB2YXIgaW5pdGlhbFZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLmhhc09wdGlvbnMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNoYW5nZUhhbmRsZXJOYW1lIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLnByb3BlcnR5Q2hhbmdlZChuYW1lLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgeyByZXR1cm4gdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpOyB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsgcmV0dXJuIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTsgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY2hhbmdlSGFuZGxlck5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2hhbmdlIGhhbmRsZXIgXCIuY29uY2F0KGNoYW5nZUhhbmRsZXJOYW1lLCBcIiB3YXMgc3BlY2lmaWVkIGJ1dCBub3QgZGVjbGFyZWQgb24gdGhlIGNsYXNzLlwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZWZhdWx0VmFsdWUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBpbml0aWFsVmFsdWUgPSB0eXBlb2YgZGVmYXVsdFZhbHVlID09PSAnZnVuY3Rpb24nID8gZGVmYXVsdFZhbHVlLmNhbGwodmlld01vZGVsKSA6IGRlZmF1bHRWYWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGhpcy5vd25lci50YXNrUXVldWUsIHZpZXdNb2RlbCwgdGhpcy5uYW1lLCBzZWxmU3Vic2NyaWJlciwgaW5pdGlhbFZhbHVlKTtcclxuICAgIH07XHJcbiAgICBCaW5kYWJsZVByb3BlcnR5LnByb3RvdHlwZS5faW5pdGlhbGl6ZSA9IGZ1bmN0aW9uICh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwLCBhdHRyaWJ1dGVzLCBiZWhhdmlvckhhbmRsZXNCaW5kLCBib3VuZFByb3BlcnRpZXMpIHtcclxuICAgICAgICB2YXIgc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgdmFyIG9ic2VydmVyO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGU7XHJcbiAgICAgICAgdmFyIGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGVmYXVsdFZhbHVlO1xyXG4gICAgICAgIGlmICh0aGlzLmlzRHluYW1pYykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gYXR0cmlidXRlcykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fY3JlYXRlRHluYW1pY1Byb3BlcnR5KHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGJlaGF2aW9ySGFuZGxlc0JpbmQsIGtleSwgYXR0cmlidXRlc1trZXldLCBib3VuZFByb3BlcnRpZXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCF0aGlzLmhhc09wdGlvbnMpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckxvb2t1cFt0aGlzLm5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoYXR0cmlidXRlcyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBvYnNlcnZlci5zZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbdGhpcy5hdHRyaWJ1dGVdO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJlaGF2aW9ySGFuZGxlc0JpbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWxbdGhpcy5uYW1lXSA9IGF0dHJpYnV0ZTtcclxuICAgICAgICAgICAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhdHRyaWJ1dGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBib3VuZFByb3BlcnRpZXMucHVzaCh7IG9ic2VydmVyOiBvYnNlcnZlciwgYmluZGluZzogYXR0cmlidXRlLmNyZWF0ZUJpbmRpbmcodmlld01vZGVsKSB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGRlZmF1bHRWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuY2FsbCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBzZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvYnNlcnZlci5wdWJsaXNoaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQmluZGFibGVQcm9wZXJ0eS5wcm90b3R5cGUuX2NyZWF0ZUR5bmFtaWNQcm9wZXJ0eSA9IGZ1bmN0aW9uICh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwLCBiZWhhdmlvckhhbmRsZXNCaW5kLCBuYW1lLCBhdHRyaWJ1dGUsIGJvdW5kUHJvcGVydGllcykge1xyXG4gICAgICAgIHZhciBjaGFuZ2VIYW5kbGVyTmFtZSA9IG5hbWUgKyAnQ2hhbmdlZCc7XHJcbiAgICAgICAgdmFyIHNlbGZTdWJzY3JpYmVyID0gbnVsbDtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXI7XHJcbiAgICAgICAgdmFyIGluZm87XHJcbiAgICAgICAgaWYgKGNoYW5nZUhhbmRsZXJOYW1lIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBpZiAoJ3Byb3BlcnR5Q2hhbmdlZCcgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWxbY2hhbmdlSGFuZGxlck5hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsLnByb3BlcnR5Q2hhbmdlZChuYW1lLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlbGZTdWJzY3JpYmVyID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgeyByZXR1cm4gdmlld01vZGVsW2NoYW5nZUhhbmRsZXJOYW1lXShuZXdWYWx1ZSwgb2xkVmFsdWUpOyB9O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKCdwcm9wZXJ0eUNoYW5nZWQnIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBzZWxmU3Vic2NyaWJlciA9IGZ1bmN0aW9uIChuZXdWYWx1ZSwgb2xkVmFsdWUpIHsgcmV0dXJuIHZpZXdNb2RlbC5wcm9wZXJ0eUNoYW5nZWQobmFtZSwgbmV3VmFsdWUsIG9sZFZhbHVlKTsgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb2JzZXJ2ZXIgPSBvYnNlcnZlckxvb2t1cFtuYW1lXSA9IG5ldyBCZWhhdmlvclByb3BlcnR5T2JzZXJ2ZXIodGhpcy5vd25lci50YXNrUXVldWUsIHZpZXdNb2RlbCwgbmFtZSwgc2VsZlN1YnNjcmliZXIpO1xyXG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh2aWV3TW9kZWwsIG5hbWUsIHtcclxuICAgICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBlbnVtZXJhYmxlOiB0cnVlLFxyXG4gICAgICAgICAgICBnZXQ6IG9ic2VydmVyLmdldFZhbHVlLmJpbmQob2JzZXJ2ZXIpLFxyXG4gICAgICAgICAgICBzZXQ6IG9ic2VydmVyLnNldFZhbHVlLmJpbmQob2JzZXJ2ZXIpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGJlaGF2aW9ySGFuZGxlc0JpbmQpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIuc2VsZlN1YnNjcmliZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGF0dHJpYnV0ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdmlld01vZGVsW25hbWVdID0gYXR0cmlidXRlO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGF0dHJpYnV0ZSkge1xyXG4gICAgICAgICAgICBpbmZvID0geyBvYnNlcnZlcjogb2JzZXJ2ZXIsIGJpbmRpbmc6IGF0dHJpYnV0ZS5jcmVhdGVCaW5kaW5nKHZpZXdNb2RlbCkgfTtcclxuICAgICAgICAgICAgYm91bmRQcm9wZXJ0aWVzLnB1c2goaW5mbyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xyXG4gICAgICAgIG9ic2VydmVyLnNlbGZTdWJzY3JpYmVyID0gc2VsZlN1YnNjcmliZXI7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEJpbmRhYmxlUHJvcGVydHk7XHJcbn0oKSk7XG5cbnZhciBWaWV3TG9jYXRvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3TG9jYXRvcigpIHtcclxuICAgIH1cclxuICAgIFZpZXdMb2NhdG9yLnByb3RvdHlwZS5nZXRWaWV3U3RyYXRlZ3kgPSBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICBpZiAoIXZhbHVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiAnZ2V0Vmlld1N0cmF0ZWd5JyBpbiB2YWx1ZSkge1xyXG4gICAgICAgICAgICB2YXIgb3JpZ2luXzEgPSBPcmlnaW4uZ2V0KHZhbHVlLmNvbnN0cnVjdG9yKTtcclxuICAgICAgICAgICAgdmFsdWUgPSB2YWx1ZS5nZXRWaWV3U3RyYXRlZ3koKTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHZhbHVlID0gbmV3IFJlbGF0aXZlVmlld1N0cmF0ZWd5KHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2aWV3U3RyYXRlZ3kuYXNzZXJ0KHZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKG9yaWdpbl8xLm1vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICB2YWx1ZS5tYWtlUmVsYXRpdmVUbyhvcmlnaW5fMS5tb2R1bGVJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IG5ldyBSZWxhdGl2ZVZpZXdTdHJhdGVneSh2YWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3U3RyYXRlZ3kudmFsaWRhdGUodmFsdWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB2YWx1ZSA9IHZhbHVlLmNvbnN0cnVjdG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJyR2aWV3JyBpbiB2YWx1ZSkge1xyXG4gICAgICAgICAgICB2YXIgYyA9IHZhbHVlLiR2aWV3O1xyXG4gICAgICAgICAgICB2YXIgdmlldyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgYyA9IHR5cGVvZiBjID09PSAnZnVuY3Rpb24nID8gYy5jYWxsKHZhbHVlKSA6IGM7XHJcbiAgICAgICAgICAgIGlmIChjID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3ID0gbmV3IE5vVmlld1N0cmF0ZWd5KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3ID0gYyBpbnN0YW5jZW9mIFN0YXRpY1ZpZXdTdHJhdGVneSA/IGMgOiBuZXcgU3RhdGljVmlld1N0cmF0ZWd5KGMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgdmlldywgdmFsdWUpO1xyXG4gICAgICAgICAgICByZXR1cm4gdmlldztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIG9yaWdpbiA9IE9yaWdpbi5nZXQodmFsdWUpO1xyXG4gICAgICAgIHZhciBzdHJhdGVneSA9IG1ldGFkYXRhLmdldChWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgdmFsdWUpO1xyXG4gICAgICAgIGlmICghc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgaWYgKCFvcmlnaW4ubW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGRldGVybWluZSBkZWZhdWx0IHZpZXcgc3RyYXRlZ3kgZm9yIG9iamVjdC5cXG4nICsgdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN0cmF0ZWd5ID0gdGhpcy5jcmVhdGVGYWxsYmFja1ZpZXdTdHJhdGVneShvcmlnaW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChvcmlnaW4ubW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgc3RyYXRlZ3kubW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBzdHJhdGVneTtcclxuICAgIH07XHJcbiAgICBWaWV3TG9jYXRvci5wcm90b3R5cGUuY3JlYXRlRmFsbGJhY2tWaWV3U3RyYXRlZ3kgPSBmdW5jdGlvbiAob3JpZ2luKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kodGhpcywgb3JpZ2luKTtcclxuICAgIH07XHJcbiAgICBWaWV3TG9jYXRvci5wcm90b3R5cGUuY29udmVydE9yaWdpblRvVmlld1VybCA9IGZ1bmN0aW9uIChvcmlnaW4pIHtcclxuICAgICAgICB2YXIgbW9kdWxlSWQgPSBvcmlnaW4ubW9kdWxlSWQ7XHJcbiAgICAgICAgdmFyIGlkID0gKG1vZHVsZUlkLmVuZHNXaXRoKCcuanMnKSB8fCBtb2R1bGVJZC5lbmRzV2l0aCgnLnRzJykpID8gbW9kdWxlSWQuc3Vic3RyaW5nKDAsIG1vZHVsZUlkLmxlbmd0aCAtIDMpIDogbW9kdWxlSWQ7XHJcbiAgICAgICAgcmV0dXJuIGlkICsgJy5odG1sJztcclxuICAgIH07XHJcbiAgICBWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSA9ICdhdXJlbGlhOnZpZXctc3RyYXRlZ3knO1xyXG4gICAgcmV0dXJuIFZpZXdMb2NhdG9yO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBtaShuYW1lKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJCaW5kaW5nTGFuZ3VhZ2UgbXVzdCBpbXBsZW1lbnQgXCIuY29uY2F0KG5hbWUsIFwiKCkuXCIpKTtcclxufVxyXG52YXIgQmluZGluZ0xhbmd1YWdlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEJpbmRpbmdMYW5ndWFnZSgpIHtcclxuICAgIH1cclxuICAgIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuaW5zcGVjdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnROYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKSB7XHJcbiAgICAgICAgbWkoJ2luc3BlY3RBdHRyaWJ1dGUnKTtcclxuICAgIH07XHJcbiAgICBCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xyXG4gICAgICAgIG1pKCdjcmVhdGVBdHRyaWJ1dGVJbnN0cnVjdGlvbicpO1xyXG4gICAgfTtcclxuICAgIEJpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuY3JlYXRlTGV0RXhwcmVzc2lvbnMgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50KSB7XHJcbiAgICAgICAgbWkoJ2NyZWF0ZUxldEV4cHJlc3Npb25zJyk7XHJcbiAgICB9O1xyXG4gICAgQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5pbnNwZWN0VGV4dENvbnRlbnQgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCB2YWx1ZSkge1xyXG4gICAgICAgIG1pKCdpbnNwZWN0VGV4dENvbnRlbnQnKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQmluZGluZ0xhbmd1YWdlO1xyXG59KCkpO1xuXG52YXIgbm9Ob2RlcyA9IE9iamVjdC5mcmVlemUoW10pO1xyXG52YXIgU2xvdEN1c3RvbUF0dHJpYnV0ZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTbG90Q3VzdG9tQXR0cmlidXRlKGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hdVNsb3RBdHRyaWJ1dGUgPSB0aGlzO1xyXG4gICAgfVxyXG4gICAgU2xvdEN1c3RvbUF0dHJpYnV0ZS5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtET00uRWxlbWVudF07XHJcbiAgICB9O1xyXG4gICAgU2xvdEN1c3RvbUF0dHJpYnV0ZS5wcm90b3R5cGUudmFsdWVDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkgeyB9O1xyXG4gICAgcmV0dXJuIFNsb3RDdXN0b21BdHRyaWJ1dGU7XHJcbn0oKSk7XHJcbnZhciBQYXNzVGhyb3VnaFNsb3QgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUGFzc1Rocm91Z2hTbG90KGFuY2hvciwgbmFtZSwgZGVzdGluYXRpb25OYW1lLCBmYWxsYmFja0ZhY3RvcnkpIHtcclxuICAgICAgICB0aGlzLmFuY2hvciA9IGFuY2hvcjtcclxuICAgICAgICB0aGlzLmFuY2hvci52aWV3U2xvdCA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uTmFtZSA9IGRlc3RpbmF0aW9uTmFtZTtcclxuICAgICAgICB0aGlzLmZhbGxiYWNrRmFjdG9yeSA9IGZhbGxiYWNrRmFjdG9yeTtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9ucyA9IDA7XHJcbiAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgdmFyIGF0dHIgPSBuZXcgU2xvdEN1c3RvbUF0dHJpYnV0ZSh0aGlzLmFuY2hvcik7XHJcbiAgICAgICAgYXR0ci52YWx1ZSA9IHRoaXMuZGVzdGluYXRpb25OYW1lO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUsIFwibmVlZHNGYWxsYmFja1JlbmRlcmluZ1wiLCB7XHJcbiAgICAgICAgZ2V0OiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmZhbGxiYWNrRmFjdG9yeSAmJiB0aGlzLnByb2plY3Rpb25zID09PSAwO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucmVuZGVyRmFsbGJhY2tDb250ZW50ID0gZnVuY3Rpb24gKHZpZXcsIG5vZGVzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSB0aGlzLmZhbGxiYWNrRmFjdG9yeS5jcmVhdGUodGhpcy5vd25lclZpZXcuY29udGFpbmVyKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHRoaXMub3duZXJWaWV3LmJpbmRpbmdDb250ZXh0LCB0aGlzLm93bmVyVmlldy5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICB2YXIgc2xvdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgICAgICBzbG90c1t0aGlzLmRlc3RpbmF0aW9uU2xvdC5uYW1lXSA9IHRoaXMuZGVzdGluYXRpb25TbG90O1xyXG4gICAgICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodGhpcy5jb250ZW50Vmlldywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCB0aGlzLmRlc3RpbmF0aW9uU2xvdC5uYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5wYXNzVGhyb3VnaFRvID0gZnVuY3Rpb24gKGRlc3RpbmF0aW9uU2xvdCkge1xyXG4gICAgICAgIHRoaXMuZGVzdGluYXRpb25TbG90ID0gZGVzdGluYXRpb25TbG90O1xyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuYWRkTm9kZSA9IGZ1bmN0aW9uICh2aWV3LCBub2RlLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcucmVtb3ZlTm9kZXMoKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnVuYmluZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG5vZGUudmlld1Nsb3QgaW5zdGFuY2VvZiBQYXNzVGhyb3VnaFNsb3QpIHtcclxuICAgICAgICAgICAgbm9kZS52aWV3U2xvdC5wYXNzVGhyb3VnaFRvKHRoaXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbnMrKztcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdC5hZGROb2RlKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiAodmlldywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIHRoaXMucHJvamVjdGlvbnMtLTtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdC5yZW1vdmVWaWV3KHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIGlmICh0aGlzLm5lZWRzRmFsbGJhY2tSZW5kZXJpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQobnVsbCwgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUucmVtb3ZlQWxsID0gZnVuY3Rpb24gKHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICB0aGlzLnByb2plY3Rpb25zID0gMDtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdC5yZW1vdmVBbGwocHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xyXG4gICAgICAgICAgICB0aGlzLnJlbmRlckZhbGxiYWNrQ29udGVudChudWxsLCBub05vZGVzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5wcm9qZWN0RnJvbSA9IGZ1bmN0aW9uICh2aWV3LCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3QucHJvamVjdEZyb20odmlldywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKG93bmVyVmlldykge1xyXG4gICAgICAgIHRoaXMub3duZXJWaWV3ID0gb3duZXJWaWV3O1xyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5iaW5kKHZpZXcuYmluZGluZ0NvbnRleHQsIHZpZXcub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUGFzc1Rocm91Z2hTbG90LnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFBhc3NUaHJvdWdoU2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBQYXNzVGhyb3VnaFNsb3QucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gUGFzc1Rocm91Z2hTbG90O1xyXG59KCkpO1xyXG52YXIgU2hhZG93U2xvdCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBTaGFkb3dTbG90KGFuY2hvciwgbmFtZSwgZmFsbGJhY2tGYWN0b3J5KSB7XHJcbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XHJcbiAgICAgICAgdGhpcy5hbmNob3IuaXNDb250ZW50UHJvamVjdGlvblNvdXJjZSA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5hbmNob3Iudmlld1Nsb3QgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5mYWxsYmFja0ZhY3RvcnkgPSBmYWxsYmFja0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0aW9ucyA9IDA7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIHRoaXMucHJvamVjdEZyb21BbmNob3JzID0gbnVsbDtcclxuICAgICAgICB0aGlzLmRlc3RpbmF0aW9uU2xvdHMgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KFNoYWRvd1Nsb3QucHJvdG90eXBlLCBcIm5lZWRzRmFsbGJhY2tSZW5kZXJpbmdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mYWxsYmFja0ZhY3RvcnkgJiYgdGhpcy5wcm9qZWN0aW9ucyA9PT0gMDtcclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxyXG4gICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZVxyXG4gICAgfSk7XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5hZGROb2RlID0gZnVuY3Rpb24gKHZpZXcsIG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCBkZXN0aW5hdGlvbikge1xyXG4gICAgICAgIHZhciAkbm9kZSA9IG5vZGU7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoJG5vZGUudmlld1Nsb3QgaW5zdGFuY2VvZiBQYXNzVGhyb3VnaFNsb3QpIHtcclxuICAgICAgICAgICAgJG5vZGUudmlld1Nsb3QucGFzc1Rocm91Z2hUbyh0aGlzKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvblNsb3RzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS5kaXN0cmlidXRlTm9kZXModmlldywgWyRub2RlXSwgdGhpcy5kZXN0aW5hdGlvblNsb3RzLCB0aGlzLCBpbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAkbm9kZS5hdU93bmVyVmlldyA9IHZpZXc7XHJcbiAgICAgICAgICAgICRub2RlLmF1UHJvamVjdGlvblNvdXJjZSA9IHByb2plY3Rpb25Tb3VyY2U7XHJcbiAgICAgICAgICAgICRub2RlLmF1QXNzaWduZWRTbG90ID0gdGhpcztcclxuICAgICAgICAgICAgdmFyIGFuY2hvciA9IHRoaXMuX2ZpbmRBbmNob3IodmlldywgJG5vZGUsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KTtcclxuICAgICAgICAgICAgdmFyIHBhcmVudF8xID0gYW5jaG9yLnBhcmVudE5vZGU7XHJcbiAgICAgICAgICAgIHBhcmVudF8xLmluc2VydEJlZm9yZSgkbm9kZSwgYW5jaG9yKTtcclxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKCRub2RlKTtcclxuICAgICAgICAgICAgdGhpcy5wcm9qZWN0aW9ucysrO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5yZW1vdmVWaWV3ID0gZnVuY3Rpb24gKHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpIHtcclxuICAgICAgICBpZiAodGhpcy5kZXN0aW5hdGlvblNsb3RzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY29udGVudFZpZXcgJiYgdGhpcy5jb250ZW50Vmlldy5oYXNTbG90cykge1xyXG4gICAgICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLmNvbnRlbnRWaWV3LnNsb3RzLCBwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBmb3VuZCA9IHRoaXMuY2hpbGRyZW4uZmluZChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC5hdVNsb3RQcm9qZWN0RnJvbSA9PT0gcHJvamVjdGlvblNvdXJjZTsgfSk7XHJcbiAgICAgICAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICB2YXIgb3duQ2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZC5hdU93bmVyVmlldyA9PT0gdmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcuZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucHJvamVjdGlvbnMtLTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IG93bkNoaWxkcmVuLmluZGV4T2YoY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bkNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmVlZHNGYWxsYmFja1JlbmRlcmluZykge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVuZGVyRmFsbGJhY2tDb250ZW50KHZpZXcsIG5vTm9kZXMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIChwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb25TbG90cyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsKHRoaXMuZGVzdGluYXRpb25TbG90cywgdGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY29udGVudFZpZXcgJiYgdGhpcy5jb250ZW50Vmlldy5oYXNTbG90cykge1xyXG4gICAgICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsKHRoaXMuY29udGVudFZpZXcuc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIGZvdW5kID0gdGhpcy5jaGlsZHJlbi5maW5kKGZ1bmN0aW9uICh4KSB7IHJldHVybiB4LmF1U2xvdFByb2plY3RGcm9tID09PSBwcm9qZWN0aW9uU291cmNlOyB9KTtcclxuICAgICAgICAgICAgaWYgKGZvdW5kKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSBmb3VuZC5hdVByb2plY3Rpb25DaGlsZHJlbjtcclxuICAgICAgICAgICAgICAgIHZhciBvd25DaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuYXVPd25lclZpZXcuZnJhZ21lbnQuYXBwZW5kQ2hpbGQoY2hpbGQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucHJvamVjdGlvbnMtLTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaWR4ID0gb3duQ2hpbGRyZW4uaW5kZXhPZihjaGlsZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG93bkNoaWxkcmVuLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGZvdW5kLmF1UHJvamVjdGlvbkNoaWxkcmVuID0gW107XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW5kZXJGYWxsYmFja0NvbnRlbnQobnVsbCwgbm9Ob2RlcywgcHJvamVjdGlvblNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuX2ZpbmRBbmNob3IgPSBmdW5jdGlvbiAodmlldywgbm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpIHtcclxuICAgICAgICBpZiAocHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgICAgICB2YXIgZm91bmQgPSB0aGlzLmNoaWxkcmVuLmZpbmQoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguYXVTbG90UHJvamVjdEZyb20gPT09IHByb2plY3Rpb25Tb3VyY2U7IH0pO1xyXG4gICAgICAgICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICAgICAgICAgIGlmIChpbmRleCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGNoaWxkcmVuID0gZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW47XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXdJbmRleCA9IC0xO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBsYXN0VmlldyA9IHZvaWQgMDtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjdXJyZW50ID0gY2hpbGRyZW5baV07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50LmF1T3duZXJWaWV3ICE9PSBsYXN0Vmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlld0luZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYXN0VmlldyA9IGN1cnJlbnQuYXVPd25lclZpZXc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlld0luZGV4ID49IGluZGV4ICYmIGxhc3RWaWV3ICE9PSB2aWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW4uc3BsaWNlKGksIDAsIG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm91bmQuYXVQcm9qZWN0aW9uQ2hpbGRyZW4ucHVzaChub2RlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmb3VuZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5hbmNob3I7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUucHJvamVjdFRvID0gZnVuY3Rpb24gKHNsb3RzKSB7XHJcbiAgICAgICAgdGhpcy5kZXN0aW5hdGlvblNsb3RzID0gc2xvdHM7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUucHJvamVjdEZyb20gPSBmdW5jdGlvbiAodmlldywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIHZhciBhbmNob3IgPSBET00uY3JlYXRlQ29tbWVudCgnYW5jaG9yJyk7XHJcbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuYW5jaG9yLnBhcmVudE5vZGU7XHJcbiAgICAgICAgYW5jaG9yLmF1U2xvdFByb2plY3RGcm9tID0gcHJvamVjdGlvblNvdXJjZTtcclxuICAgICAgICBhbmNob3IuYXVPd25lclZpZXcgPSB2aWV3O1xyXG4gICAgICAgIGFuY2hvci5hdVByb2plY3Rpb25DaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIHBhcmVudC5pbnNlcnRCZWZvcmUoYW5jaG9yLCB0aGlzLmFuY2hvcik7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5wdXNoKGFuY2hvcik7XHJcbiAgICAgICAgaWYgKHRoaXMucHJvamVjdEZyb21BbmNob3JzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMucHJvamVjdEZyb21BbmNob3JzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucHJvamVjdEZyb21BbmNob3JzLnB1c2goYW5jaG9yKTtcclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5yZW5kZXJGYWxsYmFja0NvbnRlbnQgPSBmdW5jdGlvbiAodmlldywgbm9kZXMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50VmlldyA9IHRoaXMuZmFsbGJhY2tGYWN0b3J5LmNyZWF0ZSh0aGlzLm93bmVyVmlldy5jb250YWluZXIpO1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3LmJpbmQodGhpcy5vd25lclZpZXcuYmluZGluZ0NvbnRleHQsIHRoaXMub3duZXJWaWV3Lm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUodGhpcy5hbmNob3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jb250ZW50Vmlldy5oYXNTbG90cykge1xyXG4gICAgICAgICAgICB2YXIgc2xvdHMgPSB0aGlzLmNvbnRlbnRWaWV3LnNsb3RzO1xyXG4gICAgICAgICAgICB2YXIgcHJvamVjdEZyb21BbmNob3JzID0gdGhpcy5wcm9qZWN0RnJvbUFuY2hvcnM7XHJcbiAgICAgICAgICAgIGlmIChwcm9qZWN0RnJvbUFuY2hvcnMgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNsb3QgPSBzbG90c1tzbG90TmFtZV07XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcHJvamVjdEZyb21BbmNob3JzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFuY2hvciA9IHByb2plY3RGcm9tQW5jaG9yc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2xvdC5wcm9qZWN0RnJvbShhbmNob3IuYXVPd25lclZpZXcsIGFuY2hvci5hdVNsb3RQcm9qZWN0RnJvbSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuZmFsbGJhY2tTbG90cyA9IHNsb3RzO1xyXG4gICAgICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZU5vZGVzKHZpZXcsIG5vZGVzLCBzbG90cywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKG93bmVyVmlldykge1xyXG4gICAgICAgIHRoaXMub3duZXJWaWV3ID0gb3duZXJWaWV3O1xyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYmluZCh2aWV3LmJpbmRpbmdDb250ZXh0LCB2aWV3Lm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd1Nsb3QucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93U2xvdC5wcm90b3R5cGUuZGV0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dTbG90LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udGVudFZpZXcpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZW50Vmlldy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFNoYWRvd1Nsb3Q7XHJcbn0oKSk7XHJcbnZhciBTaGFkb3dET00gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2hhZG93RE9NKCkge1xyXG4gICAgfVxyXG4gICAgU2hhZG93RE9NLmdldFNsb3ROYW1lID0gZnVuY3Rpb24gKG5vZGUpIHtcclxuICAgICAgICBpZiAobm9kZS5hdVNsb3RBdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gU2hhZG93RE9NLmRlZmF1bHRTbG90S2V5O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbm9kZS5hdVNsb3RBdHRyaWJ1dGUudmFsdWU7XHJcbiAgICB9O1xyXG4gICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3ID0gZnVuY3Rpb24gKHZpZXcsIHNsb3RzLCBwcm9qZWN0aW9uU291cmNlLCBpbmRleCwgZGVzdGluYXRpb25PdmVycmlkZSkge1xyXG4gICAgICAgIHZhciBub2RlcztcclxuICAgICAgICBpZiAodmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBub2RlcyA9IG5vTm9kZXM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YXIgY2hpbGROb2RlcyA9IHZpZXcuZnJhZ21lbnQuY2hpbGROb2RlcztcclxuICAgICAgICAgICAgdmFyIGlpID0gY2hpbGROb2Rlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIG5vZGVzID0gbmV3IEFycmF5KGlpKTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBub2Rlc1tpXSA9IGNoaWxkTm9kZXNbaV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVOb2Rlcyh2aWV3LCBub2Rlcywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCBkZXN0aW5hdGlvbk92ZXJyaWRlKTtcclxuICAgIH07XHJcbiAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyA9IGZ1bmN0aW9uICh2aWV3LCBzbG90cywgcHJvamVjdGlvblNvdXJjZSkge1xyXG4gICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgIHNsb3RzW3Nsb3ROYW1lXS5yZW1vdmVWaWV3KHZpZXcsIHByb2plY3Rpb25Tb3VyY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsID0gZnVuY3Rpb24gKHNsb3RzLCBwcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgc2xvdHNbc2xvdE5hbWVdLnJlbW92ZUFsbChwcm9qZWN0aW9uU291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVOb2RlcyA9IGZ1bmN0aW9uICh2aWV3LCBub2Rlcywgc2xvdHMsIHByb2plY3Rpb25Tb3VyY2UsIGluZGV4LCBkZXN0aW5hdGlvbk92ZXJyaWRlKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbm9kZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudE5vZGUgPSBub2Rlc1tpXTtcclxuICAgICAgICAgICAgdmFyIG5vZGVUeXBlID0gY3VycmVudE5vZGUubm9kZVR5cGU7XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50Tm9kZS5pc0NvbnRlbnRQcm9qZWN0aW9uU291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Tm9kZS52aWV3U2xvdC5wcm9qZWN0VG8oc2xvdHMpO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgc2xvdE5hbWUgaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBzbG90c1tzbG90TmFtZV0ucHJvamVjdEZyb20odmlldywgY3VycmVudE5vZGUudmlld1Nsb3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgaWktLTtcclxuICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChub2RlVHlwZSA9PT0gMSB8fCBub2RlVHlwZSA9PT0gMyB8fCBjdXJyZW50Tm9kZS52aWV3U2xvdCBpbnN0YW5jZW9mIFBhc3NUaHJvdWdoU2xvdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5vZGVUeXBlID09PSAzICYmIF9pc0FsbFdoaXRlc3BhY2UoY3VycmVudE5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZXMuc3BsaWNlKGksIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGZvdW5kID0gc2xvdHNbZGVzdGluYXRpb25PdmVycmlkZSB8fCBTaGFkb3dET00uZ2V0U2xvdE5hbWUoY3VycmVudE5vZGUpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm91bmQuYWRkTm9kZSh2aWV3LCBjdXJyZW50Tm9kZSwgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBub2Rlcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlpLS07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGktLTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBub2Rlcy5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgICAgICBpaS0tO1xyXG4gICAgICAgICAgICAgICAgaS0tO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIHNsb3ROYW1lIGluIHNsb3RzKSB7XHJcbiAgICAgICAgICAgIHZhciBzbG90ID0gc2xvdHNbc2xvdE5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoc2xvdC5uZWVkc0ZhbGxiYWNrUmVuZGVyaW5nKSB7XHJcbiAgICAgICAgICAgICAgICBzbG90LnJlbmRlckZhbGxiYWNrQ29udGVudCh2aWV3LCBub2RlcywgcHJvamVjdGlvblNvdXJjZSwgaW5kZXgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNoYWRvd0RPTS5kZWZhdWx0U2xvdEtleSA9ICdfX2F1LWRlZmF1bHQtc2xvdC1rZXlfXyc7XHJcbiAgICByZXR1cm4gU2hhZG93RE9NO1xyXG59KCkpO1xuXG52YXIgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcihvd25lcikge1xyXG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcclxuICAgICAgICB0aGlzLm93bmVyLl9jb21wb3NpdGlvbkNvdW50Kys7XHJcbiAgICB9XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIucHJvdG90eXBlLmRvbmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5vd25lci5fY29tcG9zaXRpb25Db3VudC0tO1xyXG4gICAgICAgIHRoaXMub3duZXIuX3RyeUNvbXBsZXRlVHJhbnNhY3Rpb24oKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyO1xyXG59KCkpO1xyXG52YXIgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbihvd25lcikge1xyXG4gICAgICAgIHRoaXMub3duZXIgPSBvd25lcjtcclxuICAgICAgICB0aGlzLm93bmVyLl9vd25lcnNoaXBUb2tlbiA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy50aGVuYWJsZSA9IHRoaXMuX2NyZWF0ZVRoZW5hYmxlKCk7XHJcbiAgICB9XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMub3duZXIuX3RyeUNvbXBsZXRlVHJhbnNhY3Rpb24oKTtcclxuICAgICAgICByZXR1cm4gdGhpcy50aGVuYWJsZTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4ucHJvdG90eXBlLnJlc29sdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5fcmVzb2x2ZUNhbGxiYWNrKCk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuLnByb3RvdHlwZS5fcmVzb2x2ZUNhbGxiYWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIk1ldGhvZCBub3QgaW1wbGVtZW50ZWQuXCIpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi5wcm90b3R5cGUuX2NyZWF0ZVRoZW5hYmxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9yZXNvbHZlQ2FsbGJhY2sgPSByZXNvbHZlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW47XHJcbn0oKSk7XHJcbnZhciBDb21wb3NpdGlvblRyYW5zYWN0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24oKSB7XHJcbiAgICAgICAgdGhpcy5fb3duZXJzaGlwVG9rZW4gPSBudWxsO1xyXG4gICAgICAgIHRoaXMuX2NvbXBvc2l0aW9uQ291bnQgPSAwO1xyXG4gICAgfVxyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbi5wcm90b3R5cGUudHJ5Q2FwdHVyZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fb3duZXJzaGlwVG9rZW4gPT09IG51bGxcclxuICAgICAgICAgICAgPyBuZXcgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKHRoaXMpXHJcbiAgICAgICAgICAgIDogbnVsbDtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvblRyYW5zYWN0aW9uLnByb3RvdHlwZS5lbmxpc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25UcmFuc2FjdGlvbi5wcm90b3R5cGUuX3RyeUNvbXBsZXRlVHJhbnNhY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuX2NvbXBvc2l0aW9uQ291bnQgPD0gMCkge1xyXG4gICAgICAgICAgICB0aGlzLl9jb21wb3NpdGlvbkNvdW50ID0gMDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX293bmVyc2hpcFRva2VuICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdG9rZW4gPSB0aGlzLl9vd25lcnNoaXBUb2tlbjtcclxuICAgICAgICAgICAgICAgIHRoaXMuX293bmVyc2hpcFRva2VuID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHRva2VuLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQ29tcG9zaXRpb25UcmFuc2FjdGlvbjtcclxufSgpKTtcblxudmFyIFZpZXcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlldyhjb250YWluZXIsIHZpZXdGYWN0b3J5LCBmcmFnbWVudCwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbiwgc2xvdHMpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSB2aWV3RmFjdG9yeS5yZXNvdXJjZXM7XHJcbiAgICAgICAgdGhpcy5mcmFnbWVudCA9IGZyYWdtZW50O1xyXG4gICAgICAgIHRoaXMuZmlyc3RDaGlsZCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgdGhpcy5sYXN0Q2hpbGQgPSBmcmFnbWVudC5sYXN0Q2hpbGQ7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVycyA9IGNvbnRyb2xsZXJzO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ3MgPSBiaW5kaW5ncztcclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcbiAgICAgICAgdGhpcy5zbG90cyA9IHNsb3RzO1xyXG4gICAgICAgIHRoaXMuaGFzU2xvdHMgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmZyb21DYWNoZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNvbnRyb2xsZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlld01vZGVsU2NvcGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuYW5pbWF0YWJsZUVsZW1lbnQgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdGhpcy5faXNVc2VyQ29udHJvbGxlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBudWxsO1xyXG4gICAgICAgIGZvciAodmFyIF8gaW4gc2xvdHMpIHtcclxuICAgICAgICAgICAgdGhpcy5oYXNTbG90cyA9IHRydWU7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFZpZXcucHJvdG90eXBlLnJldHVyblRvQ2FjaGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh0aGlzKTtcclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyc1tpXS5jcmVhdGVkKHRoaXMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQsIF9zeXN0ZW1VcGRhdGUpIHtcclxuICAgICAgICB2YXIgY29udHJvbGxlcnM7XHJcbiAgICAgICAgdmFyIGJpbmRpbmdzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgaWYgKF9zeXN0ZW1VcGRhdGUgJiYgdGhpcy5faXNVc2VyQ29udHJvbGxlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYmluZGluZ0NvbnRleHQgPT09IGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQgfHwgY3JlYXRlT3ZlcnJpZGVDb250ZXh0KGJpbmRpbmdDb250ZXh0KTtcclxuICAgICAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlQmluZCcsIHRoaXMpO1xyXG4gICAgICAgIGJpbmRpbmdzID0gdGhpcy5iaW5kaW5ncztcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgYmluZGluZ3NbaV0uYmluZCh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudmlld01vZGVsU2NvcGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgYmluZGluZ0NvbnRleHQuYmluZCh0aGlzLnZpZXdNb2RlbFNjb3BlLmJpbmRpbmdDb250ZXh0LCB0aGlzLnZpZXdNb2RlbFNjb3BlLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsU2NvcGUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250cm9sbGVycyA9IHRoaXMuY29udHJvbGxlcnM7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzW2ldLmJpbmQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY2hpbGRyZW5baV0uYmluZChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0LCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaGFzU2xvdHMpIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHRoaXMuY29udGVudFZpZXcsIHRoaXMuc2xvdHMpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3LnByb3RvdHlwZS5hZGRCaW5kaW5nID0gZnVuY3Rpb24gKGJpbmRpbmcpIHtcclxuICAgICAgICB0aGlzLmJpbmRpbmdzLnB1c2goYmluZGluZyk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBiaW5kaW5nLmJpbmQodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY29udHJvbGxlcnM7XHJcbiAgICAgICAgdmFyIGJpbmRpbmdzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5yZXNvdXJjZXMuX2ludm9rZUhvb2soJ2JlZm9yZVVuYmluZCcsIHRoaXMpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250cm9sbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIudW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmluZGluZ3MgPSB0aGlzLmJpbmRpbmdzO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGJpbmRpbmdzW2ldLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyc1tpXS51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0udW5iaW5kKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuaW5zZXJ0Tm9kZXNCZWZvcmUgPSBmdW5jdGlvbiAocmVmTm9kZSkge1xyXG4gICAgICAgIHJlZk5vZGUucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUodGhpcy5mcmFnbWVudCwgcmVmTm9kZSk7XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuYXBwZW5kTm9kZXNUbyA9IGZ1bmN0aW9uIChwYXJlbnQpIHtcclxuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5mcmFnbWVudCk7XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUucmVtb3ZlTm9kZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudDtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMuZmlyc3RDaGlsZDtcclxuICAgICAgICB2YXIgZW5kID0gdGhpcy5sYXN0Q2hpbGQ7XHJcbiAgICAgICAgdmFyIG5leHQ7XHJcbiAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgbmV4dCA9IGN1cnJlbnQubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGN1cnJlbnQpO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gZW5kKSB7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyZW50ID0gbmV4dDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlldy5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuY29udHJvbGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRyb2xsZXIuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29udHJvbGxlcnMgPSB0aGlzLmNvbnRyb2xsZXJzO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY29udHJvbGxlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjb250cm9sbGVyc1tpXS5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuW2ldLmF0dGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXcucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBjb250cm9sbGVycztcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbnRyb2xsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY29udHJvbGxlci5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzID0gdGhpcy5jb250cm9sbGVycztcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjb250cm9sbGVycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyc1tpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBWaWV3O1xyXG59KCkpO1xuXG52YXIgQW5pbWF0b3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQW5pbWF0b3IoKSB7XHJcbiAgICB9XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUuZW50ZXIgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5sZWF2ZSA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShmYWxzZSk7XHJcbiAgICB9O1xyXG4gICAgQW5pbWF0b3IucHJvdG90eXBlLnJlbW92ZUNsYXNzID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzTmFtZSkge1xyXG4gICAgICAgIGVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShjbGFzc05hbWUpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5hZGRDbGFzcyA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuICAgICAgICBlbGVtZW50LmNsYXNzTGlzdC5hZGQoY2xhc3NOYW1lKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUuYW5pbWF0ZSA9IGZ1bmN0aW9uIChlbGVtZW50LCBjbGFzc05hbWUpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGZhbHNlKTtcclxuICAgIH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUucnVuU2VxdWVuY2UgPSBmdW5jdGlvbiAoYW5pbWF0aW9ucykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoZmFsc2UpO1xyXG4gICAgfTtcclxuICAgIEFuaW1hdG9yLnByb3RvdHlwZS5yZWdpc3RlckVmZmVjdCA9IGZ1bmN0aW9uIChlZmZlY3ROYW1lLCBwcm9wZXJ0aWVzKSB7IH07XHJcbiAgICBBbmltYXRvci5wcm90b3R5cGUudW5yZWdpc3RlckVmZmVjdCA9IGZ1bmN0aW9uIChlZmZlY3ROYW1lKSB7IH07XHJcbiAgICByZXR1cm4gQW5pbWF0b3I7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIGdldEFuaW1hdGFibGVFbGVtZW50KHZpZXcpIHtcclxuICAgIGlmICh2aWV3LmFuaW1hdGFibGVFbGVtZW50ICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICByZXR1cm4gdmlldy5hbmltYXRhYmxlRWxlbWVudDtcclxuICAgIH1cclxuICAgIHZhciBjdXJyZW50ID0gdmlldy5maXJzdENoaWxkO1xyXG4gICAgd2hpbGUgKGN1cnJlbnQgJiYgY3VycmVudC5ub2RlVHlwZSAhPT0gMSkge1xyXG4gICAgICAgIGN1cnJlbnQgPSBjdXJyZW50Lm5leHRTaWJsaW5nO1xyXG4gICAgfVxyXG4gICAgaWYgKGN1cnJlbnQgJiYgY3VycmVudC5ub2RlVHlwZSA9PT0gMSkge1xyXG4gICAgICAgIHJldHVybiAodmlldy5hbmltYXRhYmxlRWxlbWVudCA9IGN1cnJlbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdhdS1hbmltYXRlJykgPyBjdXJyZW50IDogbnVsbCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gKHZpZXcuYW5pbWF0YWJsZUVsZW1lbnQgPSBudWxsKTtcclxufVxyXG52YXIgVmlld1Nsb3QgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld1Nsb3QoYW5jaG9yLCBhbmNob3JJc0NvbnRhaW5lciwgYW5pbWF0b3IpIHtcclxuICAgICAgICBpZiAoYW5pbWF0b3IgPT09IHZvaWQgMCkgeyBhbmltYXRvciA9IEFuaW1hdG9yLmluc3RhbmNlOyB9XHJcbiAgICAgICAgdGhpcy5hbmNob3IgPSBhbmNob3I7XHJcbiAgICAgICAgdGhpcy5hbmNob3JJc0NvbnRhaW5lciA9IGFuY2hvcklzQ29udGFpbmVyO1xyXG4gICAgICAgIHRoaXMuYmluZGluZ0NvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmFuaW1hdG9yID0gYW5pbWF0b3I7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY29udGVudFNlbGVjdG9ycyA9IG51bGw7XHJcbiAgICAgICAgYW5jaG9yLnZpZXdTbG90ID0gdGhpcztcclxuICAgICAgICBhbmNob3IuaXNDb250ZW50UHJvamVjdGlvblNvdXJjZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmFuaW1hdGVWaWV3ID0gZnVuY3Rpb24gKHZpZXcsIGRpcmVjdGlvbikge1xyXG4gICAgICAgIGlmIChkaXJlY3Rpb24gPT09IHZvaWQgMCkgeyBkaXJlY3Rpb24gPSAnZW50ZXInOyB9XHJcbiAgICAgICAgdmFyIGFuaW1hdGFibGVFbGVtZW50ID0gZ2V0QW5pbWF0YWJsZUVsZW1lbnQodmlldyk7XHJcbiAgICAgICAgaWYgKGFuaW1hdGFibGVFbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHN3aXRjaCAoZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdlbnRlcic6XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0b3IuZW50ZXIoYW5pbWF0YWJsZUVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnbGVhdmUnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdG9yLmxlYXZlKGFuaW1hdGFibGVFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGFuaW1hdGlvbiBkaXJlY3Rpb246ICcgKyBkaXJlY3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS50cmFuc2Zvcm1DaGlsZE5vZGVzSW50b1ZpZXcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuYW5jaG9yO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh7XHJcbiAgICAgICAgICAgIGZyYWdtZW50OiBwYXJlbnQsXHJcbiAgICAgICAgICAgIGZpcnN0Q2hpbGQ6IHBhcmVudC5maXJzdENoaWxkLFxyXG4gICAgICAgICAgICBsYXN0Q2hpbGQ6IHBhcmVudC5sYXN0Q2hpbGQsXHJcbiAgICAgICAgICAgIHJldHVyblRvQ2FjaGU6IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgICAgICAgICAgcmVtb3ZlTm9kZXM6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXN0O1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGxhc3QgPSBwYXJlbnQubGFzdENoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50LnJlbW92ZUNoaWxkKGxhc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBjcmVhdGVkOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGJpbmQ6IGZ1bmN0aW9uICgpIHsgfSxcclxuICAgICAgICAgICAgdW5iaW5kOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGF0dGFjaGVkOiBmdW5jdGlvbiAoKSB7IH0sXHJcbiAgICAgICAgICAgIGRldGFjaGVkOiBmdW5jdGlvbiAoKSB7IH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmJpbmRpbmdDb250ZXh0ID09PSBiaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQgfHwgdGhpcy5iaW5kaW5nQ29udGV4dDtcclxuICAgICAgICB0aGlzLm92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dCB8fCB0aGlzLm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkcmVuW2ldLmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCwgdHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB2YXIgaSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgdmFyIGlpID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gbnVsbDtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZHJlbltpXS51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuYWRkID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICBpZiAodGhpcy5hbmNob3JJc0NvbnRhaW5lcikge1xyXG4gICAgICAgICAgICB2aWV3LmFwcGVuZE5vZGVzVG8odGhpcy5hbmNob3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmlldy5pbnNlcnROb2Rlc0JlZm9yZSh0aGlzLmFuY2hvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh2aWV3KTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYW5pbWF0ZVZpZXcodmlldywgJ2VudGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5pbnNlcnQgPSBmdW5jdGlvbiAoaW5kZXgsIHZpZXcpIHtcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBsZW5ndGggPSBjaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgaWYgKChpbmRleCA9PT0gMCAmJiBsZW5ndGggPT09IDApIHx8IGluZGV4ID49IGxlbmd0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hZGQodmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZpZXcuaW5zZXJ0Tm9kZXNCZWZvcmUoY2hpbGRyZW5baW5kZXhdLmZpcnN0Q2hpbGQpO1xyXG4gICAgICAgIGNoaWxkcmVuLnNwbGljZShpbmRleCwgMCwgdmlldyk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFuaW1hdGVWaWV3KHZpZXcsICdlbnRlcicpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUubW92ZSA9IGZ1bmN0aW9uIChzb3VyY2VJbmRleCwgdGFyZ2V0SW5kZXgpIHtcclxuICAgICAgICBpZiAoc291cmNlSW5kZXggPT09IHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgdmlldyA9IGNoaWxkcmVuW3NvdXJjZUluZGV4XTtcclxuICAgICAgICB2aWV3LnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgdmlldy5pbnNlcnROb2Rlc0JlZm9yZShjaGlsZHJlblt0YXJnZXRJbmRleF0uZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKHNvdXJjZUluZGV4LCAxKTtcclxuICAgICAgICBjaGlsZHJlbi5zcGxpY2UodGFyZ2V0SW5kZXgsIDAsIHZpZXcpO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAodmlldywgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJlbW92ZUF0KHRoaXMuY2hpbGRyZW4uaW5kZXhPZih2aWV3KSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbik7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZU1hbnkgPSBmdW5jdGlvbiAodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgaWkgPSB2aWV3c1RvUmVtb3ZlLmxlbmd0aDtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xyXG4gICAgICAgIHZpZXdzVG9SZW1vdmUuZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHtcclxuICAgICAgICAgICAgaWYgKHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGFuaW1hdGlvbiA9IF90aGlzLmFuaW1hdGVWaWV3KGNoaWxkLCAnbGVhdmUnKTtcclxuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcm1Qcm9taXNlcy5wdXNoKGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNoaWxkLnJlbW92ZU5vZGVzKCk7IH0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkLnJlbW92ZU5vZGVzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICB2YXIgcmVtb3ZlQWN0aW9uID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3c1RvUmVtb3ZlW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld3NUb1JlbW92ZVtpXS5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGNoaWxkcmVuLmluZGV4T2Yodmlld3NUb1JlbW92ZVtpXSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkcmVuLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7IH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZUF0ID0gZnVuY3Rpb24gKGluZGV4LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMuY2hpbGRyZW5baW5kZXhdO1xyXG4gICAgICAgIHZhciByZW1vdmVBY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGluZGV4ID0gX3RoaXMuY2hpbGRyZW4uaW5kZXhPZih2aWV3KTtcclxuICAgICAgICAgICAgdmlldy5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICBfdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgdmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3LnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdmlldztcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmICghc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICB2YXIgYW5pbWF0aW9uID0gdGhpcy5hbmltYXRlVmlldyh2aWV3LCAnbGVhdmUnKTtcclxuICAgICAgICAgICAgaWYgKGFuaW1hdGlvbikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGFuaW1hdGlvbi50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZUFjdGlvbigpOyB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcmVtb3ZlQWN0aW9uKCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnJlbW92ZUFsbCA9IGZ1bmN0aW9uIChyZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIHZhciBpaSA9IGNoaWxkcmVuLmxlbmd0aDtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xyXG4gICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XHJcbiAgICAgICAgICAgIGlmIChza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZhciBhbmltYXRpb24gPSBfdGhpcy5hbmltYXRlVmlldyhjaGlsZCwgJ2xlYXZlJyk7XHJcbiAgICAgICAgICAgIGlmIChhbmltYXRpb24pIHtcclxuICAgICAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaChhbmltYXRpb24udGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBjaGlsZC5yZW1vdmVOb2RlcygpOyB9KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZC5yZW1vdmVOb2RlcygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHJlbW92ZUFjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKF90aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgY2hpbGQgPSBjaGlsZHJlbltpXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGQucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBfdGhpcy5jaGlsZHJlbiA9IFtdO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocm1Qcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZW1vdmVBY3Rpb24oKTsgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZW1vdmVBY3Rpb24oKTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuYXR0YWNoZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbjtcclxuICAgICAgICB2YXIgY2hpbGQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IHRydWU7XHJcbiAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjaGlsZCA9IGNoaWxkcmVuW2ldO1xyXG4gICAgICAgICAgICBjaGlsZC5hdHRhY2hlZCgpO1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdGVWaWV3KGNoaWxkLCAnZW50ZXInKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY2hpbGRyZW47XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuO1xyXG4gICAgICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkcmVuW2ldLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLnByb2plY3RUbyA9IGZ1bmN0aW9uIChzbG90cykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5wcm9qZWN0VG9TbG90cyA9IHNsb3RzO1xyXG4gICAgICAgIHRoaXMuYWRkID0gdGhpcy5fcHJvamVjdGlvbkFkZDtcclxuICAgICAgICB0aGlzLmluc2VydCA9IHRoaXMuX3Byb2plY3Rpb25JbnNlcnQ7XHJcbiAgICAgICAgdGhpcy5tb3ZlID0gdGhpcy5fcHJvamVjdGlvbk1vdmU7XHJcbiAgICAgICAgdGhpcy5yZW1vdmUgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlO1xyXG4gICAgICAgIHRoaXMucmVtb3ZlQXQgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlQXQ7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVNYW55ID0gdGhpcy5fcHJvamVjdGlvblJlbW92ZU1hbnk7XHJcbiAgICAgICAgdGhpcy5yZW1vdmVBbGwgPSB0aGlzLl9wcm9qZWN0aW9uUmVtb3ZlQWxsO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAodmlldykgeyByZXR1cm4gU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHNsb3RzLCBfdGhpcyk7IH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdTbG90LnByb3RvdHlwZS5fcHJvamVjdGlvbkFkZCA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh2aWV3KTtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHZpZXcuYXR0YWNoZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uSW5zZXJ0ID0gZnVuY3Rpb24gKGluZGV4LCB2aWV3KSB7XHJcbiAgICAgICAgaWYgKChpbmRleCA9PT0gMCAmJiAhdGhpcy5jaGlsZHJlbi5sZW5ndGgpIHx8IGluZGV4ID49IHRoaXMuY2hpbGRyZW4ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkKHZpZXcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMsIGluZGV4KTtcclxuICAgICAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDAsIHZpZXcpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uTW92ZSA9IGZ1bmN0aW9uIChzb3VyY2VJbmRleCwgdGFyZ2V0SW5kZXgpIHtcclxuICAgICAgICBpZiAoc291cmNlSW5kZXggPT09IHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjtcclxuICAgICAgICB2YXIgdmlldyA9IGNoaWxkcmVuW3NvdXJjZUluZGV4XTtcclxuICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlVmlldyh2aWV3LCB0aGlzLnByb2plY3RUb1Nsb3RzLCB0aGlzKTtcclxuICAgICAgICBTaGFkb3dET00uZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcywgdGFyZ2V0SW5kZXgpO1xyXG4gICAgICAgIGNoaWxkcmVuLnNwbGljZShzb3VyY2VJbmRleCwgMSk7XHJcbiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKHRhcmdldEluZGV4LCAwLCB2aWV3KTtcclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmUgPSBmdW5jdGlvbiAodmlldywgcmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgIFNoYWRvd0RPTS51bmRpc3RyaWJ1dGVWaWV3KHZpZXcsIHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuY2hpbGRyZW4uc3BsaWNlKHRoaXMuY2hpbGRyZW4uaW5kZXhPZih2aWV3KSwgMSk7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgICAgIHZpZXcucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3U2xvdC5wcm90b3R5cGUuX3Byb2plY3Rpb25SZW1vdmVBdCA9IGZ1bmN0aW9uIChpbmRleCwgcmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy5jaGlsZHJlbltpbmRleF07XHJcbiAgICAgICAgU2hhZG93RE9NLnVuZGlzdHJpYnV0ZVZpZXcodmlldywgdGhpcy5wcm9qZWN0VG9TbG90cywgdGhpcyk7XHJcbiAgICAgICAgdGhpcy5jaGlsZHJlbi5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgdmlldy5kZXRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICB2aWV3LnJldHVyblRvQ2FjaGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uUmVtb3ZlTWFueSA9IGZ1bmN0aW9uICh2aWV3c1RvUmVtb3ZlLCByZXR1cm5Ub0NhY2hlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2aWV3c1RvUmVtb3ZlLmZvckVhY2goZnVuY3Rpb24gKHZpZXcpIHsgcmV0dXJuIF90aGlzLnJlbW92ZSh2aWV3LCByZXR1cm5Ub0NhY2hlKTsgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Nsb3QucHJvdG90eXBlLl9wcm9qZWN0aW9uUmVtb3ZlQWxsID0gZnVuY3Rpb24gKHJldHVyblRvQ2FjaGUpIHtcclxuICAgICAgICBTaGFkb3dET00udW5kaXN0cmlidXRlQWxsKHRoaXMucHJvamVjdFRvU2xvdHMsIHRoaXMpO1xyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47XHJcbiAgICAgICAgdmFyIGlpID0gY2hpbGRyZW4ubGVuZ3RoO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBpZiAocmV0dXJuVG9DYWNoZSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0ucmV0dXJuVG9DYWNoZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHRoaXMuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW5baV0uZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoaWxkcmVuID0gW107XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXdTbG90O1xyXG59KCkpO1xuXG52YXIgJHJlc29sdmVyID0gcmVzb2x2ZXI7XHJcbnZhciBQcm92aWRlclJlc29sdmVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFByb3ZpZGVyUmVzb2x2ZXIoKSB7XHJcbiAgICB9XHJcbiAgICBQcm92aWRlclJlc29sdmVyLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBrZXkpIHtcclxuICAgICAgICB2YXIgaWQgPSBrZXkuX19wcm92aWRlcklkX187XHJcbiAgICAgICAgcmV0dXJuIGlkIGluIGNvbnRhaW5lciA/IGNvbnRhaW5lcltpZF0gOiAoY29udGFpbmVyW2lkXSA9IGNvbnRhaW5lci5pbnZva2Uoa2V5KSk7XHJcbiAgICB9O1xyXG4gICAgUHJvdmlkZXJSZXNvbHZlciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgICRyZXNvbHZlclxyXG4gICAgXSwgUHJvdmlkZXJSZXNvbHZlcik7XHJcbiAgICByZXR1cm4gUHJvdmlkZXJSZXNvbHZlcjtcclxufSgpKTtcclxudmFyIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSA9IG5ldyBQcm92aWRlclJlc29sdmVyKCk7XHJcbmZ1bmN0aW9uIGVsZW1lbnRDb250YWluZXJHZXQoa2V5KSB7XHJcbiAgICBpZiAoa2V5ID09PSBET00uRWxlbWVudCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQ7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBCb3VuZFZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYm91bmRWaWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ib3VuZFZpZXdGYWN0b3J5O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZmFjdG9yeSA9IHRoaXMuaW5zdHJ1Y3Rpb24udmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdmFyIHBhcnRSZXBsYWNlbWVudHMgPSB0aGlzLnBhcnRSZXBsYWNlbWVudHM7XHJcbiAgICAgICAgaWYgKHBhcnRSZXBsYWNlbWVudHMpIHtcclxuICAgICAgICAgICAgZmFjdG9yeSA9IHBhcnRSZXBsYWNlbWVudHNbZmFjdG9yeS5wYXJ0XSB8fCBmYWN0b3J5O1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJvdW5kVmlld0ZhY3RvcnkgPSBuZXcgQm91bmRWaWV3RmFjdG9yeSh0aGlzLCBmYWN0b3J5LCBwYXJ0UmVwbGFjZW1lbnRzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5ib3VuZFZpZXdGYWN0b3J5O1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gVmlld1Nsb3QpIHtcclxuICAgICAgICBpZiAodGhpcy52aWV3U2xvdCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld1Nsb3QgPSBuZXcgVmlld1Nsb3QodGhpcy5lbGVtZW50LCB0aGlzLmluc3RydWN0aW9uLmFuY2hvcklzQ29udGFpbmVyKTtcclxuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlzQ29udGVudFByb2plY3Rpb25Tb3VyY2UgPSB0aGlzLmluc3RydWN0aW9uLmxpZnRpbmc7XHJcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4ucHVzaCh0aGlzLnZpZXdTbG90KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3Q7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBFbGVtZW50RXZlbnRzKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZWxlbWVudEV2ZW50cyB8fCAodGhpcy5lbGVtZW50RXZlbnRzID0gbmV3IEVsZW1lbnRFdmVudHModGhpcy5lbGVtZW50KSk7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBDb21wb3NpdGlvblRyYW5zYWN0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbiB8fCAodGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uID0gdGhpcy5wYXJlbnQuZ2V0KGtleSkpO1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSA9PT0gVmlld1Jlc291cmNlcykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdSZXNvdXJjZXM7XHJcbiAgICB9XHJcbiAgICBpZiAoa2V5ID09PSBUYXJnZXRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmluc3RydWN0aW9uO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuc3VwZXJHZXQoa2V5KTtcclxufVxyXG5mdW5jdGlvbiBjcmVhdGVFbGVtZW50Q29udGFpbmVyKHBhcmVudCwgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNoaWxkcmVuLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpIHtcclxuICAgIHZhciBjb250YWluZXIgPSBwYXJlbnQuY3JlYXRlQ2hpbGQoKTtcclxuICAgIHZhciBwcm92aWRlcnM7XHJcbiAgICB2YXIgaTtcclxuICAgIGNvbnRhaW5lci5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgIGNvbnRhaW5lci5pbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xyXG4gICAgY29udGFpbmVyLmNoaWxkcmVuID0gY2hpbGRyZW47XHJcbiAgICBjb250YWluZXIudmlld1Jlc291cmNlcyA9IHJlc291cmNlcztcclxuICAgIGNvbnRhaW5lci5wYXJ0UmVwbGFjZW1lbnRzID0gcGFydFJlcGxhY2VtZW50cztcclxuICAgIHByb3ZpZGVycyA9IGluc3RydWN0aW9uLnByb3ZpZGVycztcclxuICAgIGkgPSBwcm92aWRlcnMubGVuZ3RoO1xyXG4gICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgIGNvbnRhaW5lci5fcmVzb2x2ZXJzLnNldChwcm92aWRlcnNbaV0sIHByb3ZpZGVyUmVzb2x2ZXJJbnN0YW5jZSk7XHJcbiAgICB9XHJcbiAgICBjb250YWluZXIuc3VwZXJHZXQgPSBjb250YWluZXIuZ2V0O1xyXG4gICAgY29udGFpbmVyLmdldCA9IGVsZW1lbnRDb250YWluZXJHZXQ7XHJcbiAgICByZXR1cm4gY29udGFpbmVyO1xyXG59XHJcbmZ1bmN0aW9uIGhhc0F0dHJpYnV0ZShuYW1lKSB7XHJcbiAgICByZXR1cm4gdGhpcy5fZWxlbWVudC5oYXNBdHRyaWJ1dGUobmFtZSk7XHJcbn1cclxuZnVuY3Rpb24gZ2V0QXR0cmlidXRlKG5hbWUpIHtcclxuICAgIHJldHVybiB0aGlzLl9lbGVtZW50LmdldEF0dHJpYnV0ZShuYW1lKTtcclxufVxyXG5mdW5jdGlvbiBzZXRBdHRyaWJ1dGUobmFtZSwgdmFsdWUpIHtcclxuICAgIHRoaXMuX2VsZW1lbnQuc2V0QXR0cmlidXRlKG5hbWUsIHZhbHVlKTtcclxufVxyXG5mdW5jdGlvbiBtYWtlRWxlbWVudEludG9BbmNob3IoZWxlbWVudCwgZWxlbWVudEluc3RydWN0aW9uKSB7XHJcbiAgICB2YXIgYW5jaG9yID0gRE9NLmNyZWF0ZUNvbW1lbnQoJ2FuY2hvcicpO1xyXG4gICAgaWYgKGVsZW1lbnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBmaXJzdENoaWxkID0gZWxlbWVudC5maXJzdENoaWxkO1xyXG4gICAgICAgIGlmIChmaXJzdENoaWxkICYmIGZpcnN0Q2hpbGQudGFnTmFtZSA9PT0gJ0FVLUNPTlRFTlQnKSB7XHJcbiAgICAgICAgICAgIGFuY2hvci5jb250ZW50RWxlbWVudCA9IGZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFuY2hvci5fZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgYW5jaG9yLmhhc0F0dHJpYnV0ZSA9IGhhc0F0dHJpYnV0ZTtcclxuICAgICAgICBhbmNob3IuZ2V0QXR0cmlidXRlID0gZ2V0QXR0cmlidXRlO1xyXG4gICAgICAgIGFuY2hvci5zZXRBdHRyaWJ1dGUgPSBzZXRBdHRyaWJ1dGU7XHJcbiAgICB9XHJcbiAgICBET00ucmVwbGFjZU5vZGUoYW5jaG9yLCBlbGVtZW50KTtcclxuICAgIHJldHVybiBhbmNob3I7XHJcbn1cclxuZnVuY3Rpb24gYXBwbHlJbnN0cnVjdGlvbnMoY29udGFpbmVycywgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpIHtcclxuICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zO1xyXG4gICAgdmFyIGV4cHJlc3Npb25zID0gaW5zdHJ1Y3Rpb24uZXhwcmVzc2lvbnM7XHJcbiAgICB2YXIgZWxlbWVudENvbnRhaW5lcjtcclxuICAgIHZhciBpO1xyXG4gICAgdmFyIGlpO1xyXG4gICAgdmFyIGN1cnJlbnQ7XHJcbiAgICB2YXIgaW5zdGFuY2U7XHJcbiAgICBpZiAoaW5zdHJ1Y3Rpb24uY29udGVudEV4cHJlc3Npb24pIHtcclxuICAgICAgICBiaW5kaW5ncy5wdXNoKGluc3RydWN0aW9uLmNvbnRlbnRFeHByZXNzaW9uLmNyZWF0ZUJpbmRpbmcoZWxlbWVudC5uZXh0U2libGluZykpO1xyXG4gICAgICAgIGVsZW1lbnQubmV4dFNpYmxpbmcuYXVJbnRlcnBvbGF0aW9uVGFyZ2V0ID0gdHJ1ZTtcclxuICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGluc3RydWN0aW9uLnNoYWRvd1Nsb3QpIHtcclxuICAgICAgICB2YXIgY29tbWVudEFuY2hvciA9IERPTS5jcmVhdGVDb21tZW50KCdzbG90Jyk7XHJcbiAgICAgICAgdmFyIHNsb3QgPSB2b2lkIDA7XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLnNsb3REZXN0aW5hdGlvbikge1xyXG4gICAgICAgICAgICBzbG90ID0gbmV3IFBhc3NUaHJvdWdoU2xvdChjb21tZW50QW5jaG9yLCBpbnN0cnVjdGlvbi5zbG90TmFtZSwgaW5zdHJ1Y3Rpb24uc2xvdERlc3RpbmF0aW9uLCBpbnN0cnVjdGlvbi5zbG90RmFsbGJhY2tGYWN0b3J5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHNsb3QgPSBuZXcgU2hhZG93U2xvdChjb21tZW50QW5jaG9yLCBpbnN0cnVjdGlvbi5zbG90TmFtZSwgaW5zdHJ1Y3Rpb24uc2xvdEZhbGxiYWNrRmFjdG9yeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIERPTS5yZXBsYWNlTm9kZShjb21tZW50QW5jaG9yLCBlbGVtZW50KTtcclxuICAgICAgICBzaGFkb3dTbG90c1tpbnN0cnVjdGlvbi5zbG90TmFtZV0gPSBzbG90O1xyXG4gICAgICAgIGNvbnRyb2xsZXJzLnB1c2goc2xvdCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGluc3RydWN0aW9uLmxldEVsZW1lbnQpIHtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGV4cHJlc3Npb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgaWYgKGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgIGlmICghaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcclxuICAgICAgICAgICAgZWxlbWVudCA9IG1ha2VFbGVtZW50SW50b0FuY2hvcihlbGVtZW50LCBpbnN0cnVjdGlvbi5lbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250YWluZXJzW2luc3RydWN0aW9uLmluamVjdG9ySWRdID0gZWxlbWVudENvbnRhaW5lciA9XHJcbiAgICAgICAgICAgIGNyZWF0ZUVsZW1lbnRDb250YWluZXIoY29udGFpbmVyc1tpbnN0cnVjdGlvbi5wYXJlbnRJbmplY3RvcklkXSwgZWxlbWVudCwgaW5zdHJ1Y3Rpb24sIGNoaWxkcmVuLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XHJcbiAgICAgICAgICAgIGluc3RhbmNlID0gY3VycmVudC50eXBlLmNyZWF0ZShlbGVtZW50Q29udGFpbmVyLCBjdXJyZW50LCBlbGVtZW50LCBiaW5kaW5ncyk7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXJzLnB1c2goaW5zdGFuY2UpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgIGJpbmRpbmdzLnB1c2goZXhwcmVzc2lvbnNbaV0uY3JlYXRlQmluZGluZyhlbGVtZW50KSk7XHJcbiAgICB9XHJcbn1cclxuZnVuY3Rpb24gc3R5bGVTdHJpbmdUb09iamVjdChzdHlsZSwgdGFyZ2V0KSB7XHJcbiAgICB2YXIgYXR0cmlidXRlcyA9IHN0eWxlLnNwbGl0KCc7Jyk7XHJcbiAgICB2YXIgZmlyc3RJbmRleE9mQ29sb247XHJcbiAgICB2YXIgaTtcclxuICAgIHZhciBjdXJyZW50O1xyXG4gICAgdmFyIGtleTtcclxuICAgIHZhciB2YWx1ZTtcclxuICAgIHRhcmdldCA9IHRhcmdldCB8fCB7fTtcclxuICAgIGZvciAoaSA9IDA7IGkgPCBhdHRyaWJ1dGVzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgY3VycmVudCA9IGF0dHJpYnV0ZXNbaV07XHJcbiAgICAgICAgZmlyc3RJbmRleE9mQ29sb24gPSBjdXJyZW50LmluZGV4T2YoJzonKTtcclxuICAgICAgICBrZXkgPSBjdXJyZW50LnN1YnN0cmluZygwLCBmaXJzdEluZGV4T2ZDb2xvbikudHJpbSgpO1xyXG4gICAgICAgIHZhbHVlID0gY3VycmVudC5zdWJzdHJpbmcoZmlyc3RJbmRleE9mQ29sb24gKyAxKS50cmltKCk7XHJcbiAgICAgICAgdGFyZ2V0W2tleV0gPSB2YWx1ZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0YXJnZXQ7XHJcbn1cclxuZnVuY3Rpb24gc3R5bGVPYmplY3RUb1N0cmluZyhvYmopIHtcclxuICAgIHZhciByZXN1bHQgPSAnJztcclxuICAgIGZvciAodmFyIGtleSBpbiBvYmopIHtcclxuICAgICAgICByZXN1bHQgKz0ga2V5ICsgJzonICsgb2JqW2tleV0gKyAnOyc7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59XHJcbmZ1bmN0aW9uIGFwcGx5U3Vycm9nYXRlSW5zdHJ1Y3Rpb24oY29udGFpbmVyLCBlbGVtZW50LCBpbnN0cnVjdGlvbiwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbikge1xyXG4gICAgdmFyIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zID0gaW5zdHJ1Y3Rpb24uYmVoYXZpb3JJbnN0cnVjdGlvbnM7XHJcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBpbnN0cnVjdGlvbi5leHByZXNzaW9ucztcclxuICAgIHZhciBwcm92aWRlcnMgPSBpbnN0cnVjdGlvbi5wcm92aWRlcnM7XHJcbiAgICB2YXIgdmFsdWVzID0gaW5zdHJ1Y3Rpb24udmFsdWVzO1xyXG4gICAgdmFyIGk7XHJcbiAgICB2YXIgaWk7XHJcbiAgICB2YXIgY3VycmVudDtcclxuICAgIHZhciBpbnN0YW5jZTtcclxuICAgIHZhciBjdXJyZW50QXR0cmlidXRlVmFsdWU7XHJcbiAgICBpID0gcHJvdmlkZXJzLmxlbmd0aDtcclxuICAgIHdoaWxlIChpLS0pIHtcclxuICAgICAgICBjb250YWluZXIuX3Jlc29sdmVycy5zZXQocHJvdmlkZXJzW2ldLCBwcm92aWRlclJlc29sdmVySW5zdGFuY2UpO1xyXG4gICAgfVxyXG4gICAgZm9yICh2YXIga2V5IGluIHZhbHVlcykge1xyXG4gICAgICAgIGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKGtleSk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnRBdHRyaWJ1dGVWYWx1ZSkge1xyXG4gICAgICAgICAgICBpZiAoa2V5ID09PSAnY2xhc3MnKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCBjdXJyZW50QXR0cmlidXRlVmFsdWUgKyAnICcgKyB2YWx1ZXNba2V5XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5ID09PSAnc3R5bGUnKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3R5bGVPYmplY3QgPSBzdHlsZVN0cmluZ1RvT2JqZWN0KHZhbHVlc1trZXldKTtcclxuICAgICAgICAgICAgICAgIHN0eWxlU3RyaW5nVG9PYmplY3QoY3VycmVudEF0dHJpYnV0ZVZhbHVlLCBzdHlsZU9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnc3R5bGUnLCBzdHlsZU9iamVjdFRvU3RyaW5nKHN0eWxlT2JqZWN0KSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKGtleSwgdmFsdWVzW2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGlmIChiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGgpIHtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY3VycmVudCA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xyXG4gICAgICAgICAgICBpbnN0YW5jZSA9IGN1cnJlbnQudHlwZS5jcmVhdGUoY29udGFpbmVyLCBjdXJyZW50LCBlbGVtZW50LCBiaW5kaW5ncyk7XHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZS5jb250ZW50Vmlldykge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRyZW4ucHVzaChpbnN0YW5jZS5jb250ZW50Vmlldyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udHJvbGxlcnMucHVzaChpbnN0YW5jZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgYmluZGluZ3MucHVzaChleHByZXNzaW9uc1tpXS5jcmVhdGVCaW5kaW5nKGVsZW1lbnQpKTtcclxuICAgIH1cclxufVxyXG52YXIgQm91bmRWaWV3RmFjdG9yeSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCb3VuZFZpZXdGYWN0b3J5KHBhcmVudENvbnRhaW5lciwgdmlld0ZhY3RvcnksIHBhcnRSZXBsYWNlbWVudHMpIHtcclxuICAgICAgICB0aGlzLnBhcmVudENvbnRhaW5lciA9IHBhcmVudENvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy5mYWN0b3J5Q3JlYXRlSW5zdHJ1Y3Rpb24gPSB7IHBhcnRSZXBsYWNlbWVudHM6IHBhcnRSZXBsYWNlbWVudHMgfTtcclxuICAgIH1cclxuICAgIEJvdW5kVmlld0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKHRoaXMucGFyZW50Q29udGFpbmVyLmNyZWF0ZUNoaWxkKCksIHRoaXMuZmFjdG9yeUNyZWF0ZUluc3RydWN0aW9uKTtcclxuICAgICAgICB2aWV3Ll9pc1VzZXJDb250cm9sbGVkID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gdmlldztcclxuICAgIH07XHJcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUsIFwiaXNDYWNoaW5nXCIsIHtcclxuICAgICAgICBnZXQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIEJvdW5kVmlld0ZhY3RvcnkucHJvdG90eXBlLnNldENhY2hlU2l6ZSA9IGZ1bmN0aW9uIChzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeS5zZXRDYWNoZVNpemUoc2l6ZSwgZG9Ob3RPdmVycmlkZUlmQWxyZWFkeVNldCk7XHJcbiAgICB9O1xyXG4gICAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUuZ2V0Q2FjaGVkVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5nZXRDYWNoZWRWaWV3KCk7XHJcbiAgICB9O1xyXG4gICAgQm91bmRWaWV3RmFjdG9yeS5wcm90b3R5cGUucmV0dXJuVmlld1RvQ2FjaGUgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkucmV0dXJuVmlld1RvQ2FjaGUodmlldyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIEJvdW5kVmlld0ZhY3Rvcnk7XHJcbn0oKSk7XHJcbnZhciBWaWV3RmFjdG9yeSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3RmFjdG9yeSh0ZW1wbGF0ZSwgaW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpIHtcclxuICAgICAgICB0aGlzLmlzQ2FjaGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudGVtcGxhdGUgPSB0ZW1wbGF0ZTtcclxuICAgICAgICB0aGlzLmluc3RydWN0aW9ucyA9IGluc3RydWN0aW9ucztcclxuICAgICAgICB0aGlzLnJlc291cmNlcyA9IHJlc291cmNlcztcclxuICAgICAgICB0aGlzLmNhY2hlU2l6ZSA9IC0xO1xyXG4gICAgICAgIHRoaXMuY2FjaGUgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgVmlld0ZhY3RvcnkucHJvdG90eXBlLnNldENhY2hlU2l6ZSA9IGZ1bmN0aW9uIChzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KSB7XHJcbiAgICAgICAgaWYgKHNpemUpIHtcclxuICAgICAgICAgICAgaWYgKHNpemUgPT09ICcqJykge1xyXG4gICAgICAgICAgICAgICAgc2l6ZSA9IE51bWJlci5NQVhfVkFMVUU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHNpemUgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICBzaXplID0gcGFyc2VJbnQoc2l6ZSwgMTApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlU2l6ZSA9PT0gLTEgfHwgIWRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZVNpemUgPSBOdW1iZXIoc2l6ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNhY2hlU2l6ZSA+IDApIHtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZSA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jYWNoZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNDYWNoaW5nID0gdGhpcy5jYWNoZVNpemUgPiAwO1xyXG4gICAgfTtcclxuICAgIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlICE9PSBudWxsID8gKHRoaXMuY2FjaGUucG9wKCkgfHwgbnVsbCkgOiBudWxsO1xyXG4gICAgfTtcclxuICAgIFZpZXdGYWN0b3J5LnByb3RvdHlwZS5yZXR1cm5WaWV3VG9DYWNoZSA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgaWYgKHZpZXcuaXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB2aWV3LmRldGFjaGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3LmlzQm91bmQpIHtcclxuICAgICAgICAgICAgdmlldy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuY2FjaGUgIT09IG51bGwgJiYgdGhpcy5jYWNoZS5sZW5ndGggPCB0aGlzLmNhY2hlU2l6ZSkge1xyXG4gICAgICAgICAgICB2aWV3LmZyb21DYWNoZSA9IHRydWU7XHJcbiAgICAgICAgICAgIHRoaXMuY2FjaGUucHVzaCh2aWV3KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgVmlld0ZhY3RvcnkucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGNyZWF0ZUluc3RydWN0aW9uLCBlbGVtZW50KSB7XHJcbiAgICAgICAgY3JlYXRlSW5zdHJ1Y3Rpb24gPSBjcmVhdGVJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLm5vcm1hbDtcclxuICAgICAgICB2YXIgY2FjaGVkVmlldyA9IHRoaXMuZ2V0Q2FjaGVkVmlldygpO1xyXG4gICAgICAgIGlmIChjYWNoZWRWaWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjYWNoZWRWaWV3O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZnJhZ21lbnQgPSBjcmVhdGVJbnN0cnVjdGlvbi5lbmhhbmNlID8gdGhpcy50ZW1wbGF0ZSA6IHRoaXMudGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGFibGVzID0gZnJhZ21lbnQucXVlcnlTZWxlY3RvckFsbCgnLmF1LXRhcmdldCcpO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbnMgPSB0aGlzLmluc3RydWN0aW9ucztcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXJzID0gW107XHJcbiAgICAgICAgdmFyIGJpbmRpbmdzID0gW107XHJcbiAgICAgICAgdmFyIGNoaWxkcmVuID0gW107XHJcbiAgICAgICAgdmFyIHNoYWRvd1Nsb3RzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB2YXIgY29udGFpbmVycyA9IHsgcm9vdDogY29udGFpbmVyIH07XHJcbiAgICAgICAgdmFyIHBhcnRSZXBsYWNlbWVudHMgPSBjcmVhdGVJbnN0cnVjdGlvbi5wYXJ0UmVwbGFjZW1lbnRzO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgdmlldztcclxuICAgICAgICB2YXIgaW5zdHJ1Y3RhYmxlO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbjtcclxuICAgICAgICB0aGlzLnJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlQ3JlYXRlJywgdGhpcywgY29udGFpbmVyLCBmcmFnbWVudCwgY3JlYXRlSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIGlmIChlbGVtZW50ICYmIHRoaXMuc3Vycm9nYXRlSW5zdHJ1Y3Rpb24gIT09IG51bGwpIHtcclxuICAgICAgICAgICAgYXBwbHlTdXJyb2dhdGVJbnN0cnVjdGlvbihjb250YWluZXIsIGVsZW1lbnQsIHRoaXMuc3Vycm9nYXRlSW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY3JlYXRlSW5zdHJ1Y3Rpb24uZW5oYW5jZSAmJiBmcmFnbWVudC5oYXNBdHRyaWJ1dGUoJ2F1LXRhcmdldC1pZCcpKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0YWJsZSA9IGZyYWdtZW50O1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uc1tpbnN0cnVjdGFibGUuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKV07XHJcbiAgICAgICAgICAgIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGluc3RydWN0YWJsZSwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGluc3RydWN0YWJsZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGFibGUgPSBpbnN0cnVjdGFibGVzW2ldO1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uc1tpbnN0cnVjdGFibGUuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKV07XHJcbiAgICAgICAgICAgIGFwcGx5SW5zdHJ1Y3Rpb25zKGNvbnRhaW5lcnMsIGluc3RydWN0YWJsZSwgaW5zdHJ1Y3Rpb24sIGNvbnRyb2xsZXJzLCBiaW5kaW5ncywgY2hpbGRyZW4sIHNoYWRvd1Nsb3RzLCBwYXJ0UmVwbGFjZW1lbnRzLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2aWV3ID0gbmV3IFZpZXcoY29udGFpbmVyLCB0aGlzLCBmcmFnbWVudCwgY29udHJvbGxlcnMsIGJpbmRpbmdzLCBjaGlsZHJlbiwgc2hhZG93U2xvdHMpO1xyXG4gICAgICAgIGlmICghY3JlYXRlSW5zdHJ1Y3Rpb24uaW5pdGlhdGVkQnlCZWhhdmlvcikge1xyXG4gICAgICAgICAgICB2aWV3LmNyZWF0ZWQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMuX2ludm9rZUhvb2soJ2FmdGVyQ3JlYXRlJywgdmlldyk7XHJcbiAgICAgICAgcmV0dXJuIHZpZXc7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXdGYWN0b3J5O1xyXG59KCkpO1xuXG52YXIgbmV4dEluamVjdG9ySWQgPSAwO1xyXG5mdW5jdGlvbiBnZXROZXh0SW5qZWN0b3JJZCgpIHtcclxuICAgIHJldHVybiArK25leHRJbmplY3RvcklkO1xyXG59XHJcbnZhciBsYXN0QVVUYXJnZXRJRCA9IDA7XHJcbmZ1bmN0aW9uIGdldE5leHRBVVRhcmdldElEKCkge1xyXG4gICAgcmV0dXJuICgrK2xhc3RBVVRhcmdldElEKS50b1N0cmluZygpO1xyXG59XHJcbmZ1bmN0aW9uIG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQoZWxlbWVudCkge1xyXG4gICAgdmFyIHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2NsYXNzJyk7XHJcbiAgICB2YXIgYXVUYXJnZXRJRCA9IGdldE5leHRBVVRhcmdldElEKCk7XHJcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAodmFsdWUgPyB2YWx1ZSArICcgYXUtdGFyZ2V0JyA6ICdhdS10YXJnZXQnKSk7XHJcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJywgYXVUYXJnZXRJRCk7XHJcbiAgICByZXR1cm4gYXVUYXJnZXRJRDtcclxufVxyXG5mdW5jdGlvbiBtYWtlU2hhZG93U2xvdChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbnMsIHBhcmVudEluamVjdG9ySWQpIHtcclxuICAgIHZhciBhdVNoYWRvd1Nsb3QgPSBET00uY3JlYXRlRWxlbWVudCgnYXUtc2hhZG93LXNsb3QnKTtcclxuICAgIERPTS5yZXBsYWNlTm9kZShhdVNoYWRvd1Nsb3QsIG5vZGUpO1xyXG4gICAgdmFyIGF1VGFyZ2V0SUQgPSBtYWtlSW50b0luc3RydWN0aW9uVGFyZ2V0KGF1U2hhZG93U2xvdCk7XHJcbiAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBUYXJnZXRJbnN0cnVjdGlvbi5zaGFkb3dTbG90KHBhcmVudEluamVjdG9ySWQpO1xyXG4gICAgaW5zdHJ1Y3Rpb24uc2xvdE5hbWUgPSBub2RlLmdldEF0dHJpYnV0ZSgnbmFtZScpIHx8IFNoYWRvd0RPTS5kZWZhdWx0U2xvdEtleTtcclxuICAgIGluc3RydWN0aW9uLnNsb3REZXN0aW5hdGlvbiA9IG5vZGUuZ2V0QXR0cmlidXRlKCdzbG90Jyk7XHJcbiAgICBpZiAobm9kZS5pbm5lckhUTUwudHJpbSgpKSB7XHJcbiAgICAgICAgdmFyIGZyYWdtZW50ID0gRE9NLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcclxuICAgICAgICB2YXIgY2hpbGQgPSB2b2lkIDA7XHJcbiAgICAgICAgd2hpbGUgKGNoaWxkID0gbm9kZS5maXJzdENoaWxkKSB7XHJcbiAgICAgICAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGNoaWxkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uc2xvdEZhbGxiYWNrRmFjdG9yeSA9IGNvbXBpbGVyLmNvbXBpbGUoZnJhZ21lbnQsIHJlc291cmNlcyk7XHJcbiAgICB9XHJcbiAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBpbnN0cnVjdGlvbjtcclxuICAgIHJldHVybiBhdVNoYWRvd1Nsb3Q7XHJcbn1cclxudmFyIGRlZmF1bHRMZXRIYW5kbGVyID0gQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5jcmVhdGVMZXRFeHByZXNzaW9ucztcclxudmFyIFZpZXdDb21waWxlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBWaWV3Q29tcGlsZXIoYmluZGluZ0xhbmd1YWdlLCByZXNvdXJjZXMpIHtcclxuICAgICAgICB0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IGJpbmRpbmdMYW5ndWFnZTtcclxuICAgICAgICB0aGlzLnJlc291cmNlcyA9IHJlc291cmNlcztcclxuICAgIH1cclxuICAgIFZpZXdDb21waWxlci5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtCaW5kaW5nTGFuZ3VhZ2UsIFZpZXdSZXNvdXJjZXNdO1xyXG4gICAgfTtcclxuICAgIFZpZXdDb21waWxlci5wcm90b3R5cGUuY29tcGlsZSA9IGZ1bmN0aW9uIChzb3VyY2UsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgcmVzb3VyY2VzID0gcmVzb3VyY2VzIHx8IHRoaXMucmVzb3VyY2VzO1xyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbiA9IGNvbXBpbGVJbnN0cnVjdGlvbiB8fCBWaWV3Q29tcGlsZUluc3RydWN0aW9uLm5vcm1hbDtcclxuICAgICAgICBzb3VyY2UgPSB0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJyA/IERPTS5jcmVhdGVUZW1wbGF0ZUZyb21NYXJrdXAoc291cmNlKSA6IHNvdXJjZTtcclxuICAgICAgICB2YXIgY29udGVudDtcclxuICAgICAgICB2YXIgcGFydDtcclxuICAgICAgICB2YXIgY2FjaGVTaXplO1xyXG4gICAgICAgIGlmIChzb3VyY2UuY29udGVudCkge1xyXG4gICAgICAgICAgICBwYXJ0ID0gc291cmNlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xyXG4gICAgICAgICAgICBjYWNoZVNpemUgPSBzb3VyY2UuZ2V0QXR0cmlidXRlKCd2aWV3LWNhY2hlJyk7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBET00uYWRvcHROb2RlKHNvdXJjZS5jb250ZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQgPSBzb3VyY2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi50YXJnZXRTaGFkb3dET00gPSBjb21waWxlSW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NICYmIEZFQVRVUkUuc2hhZG93RE9NO1xyXG4gICAgICAgIHJlc291cmNlcy5faW52b2tlSG9vaygnYmVmb3JlQ29tcGlsZScsIGNvbnRlbnQsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uKTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25zID0ge307XHJcbiAgICAgICAgdGhpcy5fY29tcGlsZU5vZGUoY29udGVudCwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHNvdXJjZSwgJ3Jvb3QnLCAhY29tcGlsZUluc3RydWN0aW9uLnRhcmdldFNoYWRvd0RPTSk7XHJcbiAgICAgICAgdmFyIGZpcnN0Q2hpbGQgPSBjb250ZW50LmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgaWYgKGZpcnN0Q2hpbGQgJiYgZmlyc3RDaGlsZC5ub2RlVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICB2YXIgdGFyZ2V0SWQgPSBmaXJzdENoaWxkLmdldEF0dHJpYnV0ZSgnYXUtdGFyZ2V0LWlkJyk7XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXRJZCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlucyA9IGluc3RydWN0aW9uc1t0YXJnZXRJZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zLnNoYWRvd1Nsb3QgfHwgaW5zLmxpZnRpbmcgfHwgKGlucy5lbGVtZW50SW5zdHJ1Y3Rpb24gJiYgIWlucy5lbGVtZW50SW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGVudC5pbnNlcnRCZWZvcmUoRE9NLmNyZWF0ZUNvbW1lbnQoJ3ZpZXcnKSwgZmlyc3RDaGlsZCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGZhY3RvcnkgPSBuZXcgVmlld0ZhY3RvcnkoY29udGVudCwgaW5zdHJ1Y3Rpb25zLCByZXNvdXJjZXMpO1xyXG4gICAgICAgIGZhY3Rvcnkuc3Vycm9nYXRlSW5zdHJ1Y3Rpb24gPSBjb21waWxlSW5zdHJ1Y3Rpb24uY29tcGlsZVN1cnJvZ2F0ZSA/IHRoaXMuX2NvbXBpbGVTdXJyb2dhdGUoc291cmNlLCByZXNvdXJjZXMpIDogbnVsbDtcclxuICAgICAgICBmYWN0b3J5LnBhcnQgPSBwYXJ0O1xyXG4gICAgICAgIGlmIChjYWNoZVNpemUpIHtcclxuICAgICAgICAgICAgZmFjdG9yeS5zZXRDYWNoZVNpemUoY2FjaGVTaXplKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzb3VyY2VzLl9pbnZva2VIb29rKCdhZnRlckNvbXBpbGUnLCBmYWN0b3J5KTtcclxuICAgICAgICByZXR1cm4gZmFjdG9yeTtcclxuICAgIH07XHJcbiAgICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb21waWxlTm9kZSA9IGZ1bmN0aW9uIChub2RlLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgcGFyZW50Tm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pIHtcclxuICAgICAgICBzd2l0Y2ggKG5vZGUubm9kZVR5cGUpIHtcclxuICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBpbGVFbGVtZW50KG5vZGUsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBwYXJlbnROb2RlLCBwYXJlbnRJbmplY3RvcklkLCB0YXJnZXRMaWdodERPTSk7XHJcbiAgICAgICAgICAgIGNhc2UgMzpcclxuICAgICAgICAgICAgICAgIHZhciBleHByZXNzaW9uID0gcmVzb3VyY2VzLmdldEJpbmRpbmdMYW5ndWFnZSh0aGlzLmJpbmRpbmdMYW5ndWFnZSkuaW5zcGVjdFRleHRDb250ZW50KHJlc291cmNlcywgbm9kZS53aG9sZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24pIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWFya2VyID0gRE9NLmNyZWF0ZUVsZW1lbnQoJ2F1LW1hcmtlcicpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChtYXJrZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkuaW5zZXJ0QmVmb3JlKG1hcmtlciwgbm9kZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS50ZXh0Q29udGVudCA9ICcgJztcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5jb250ZW50RXhwcmVzc2lvbihleHByZXNzaW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAobm9kZS5uZXh0U2libGluZyAmJiBub2RlLm5leHRTaWJsaW5nLm5vZGVUeXBlID09PSAzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIChub2RlLnBhcmVudE5vZGUgfHwgcGFyZW50Tm9kZSkucmVtb3ZlQ2hpbGQobm9kZS5uZXh0U2libGluZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5vZGUubmV4dFNpYmxpbmcgJiYgbm9kZS5uZXh0U2libGluZy5ub2RlVHlwZSA9PT0gMykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5uZXh0U2libGluZztcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgICAgICAgICAgY2FzZSAxMTpcclxuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50Q2hpbGQgPSBub2RlLmZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudENoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudENoaWxkID0gdGhpcy5fY29tcGlsZU5vZGUoY3VycmVudENoaWxkLCByZXNvdXJjZXMsIGluc3RydWN0aW9ucywgbm9kZSwgcGFyZW50SW5qZWN0b3JJZCwgdGFyZ2V0TGlnaHRET00pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgfTtcclxuICAgIFZpZXdDb21waWxlci5wcm90b3R5cGUuX2NvbXBpbGVTdXJyb2dhdGUgPSBmdW5jdGlvbiAobm9kZSwgcmVzb3VyY2VzKSB7XHJcbiAgICAgICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcztcclxuICAgICAgICB2YXIgYmluZGluZ0xhbmd1YWdlID0gcmVzb3VyY2VzLmdldEJpbmRpbmdMYW5ndWFnZSh0aGlzLmJpbmRpbmdMYW5ndWFnZSk7XHJcbiAgICAgICAgdmFyIGtub3duQXR0cmlidXRlO1xyXG4gICAgICAgIHZhciBwcm9wZXJ0eTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBhdHRyO1xyXG4gICAgICAgIHZhciBhdHRyTmFtZTtcclxuICAgICAgICB2YXIgYXR0clZhbHVlO1xyXG4gICAgICAgIHZhciBpbmZvO1xyXG4gICAgICAgIHZhciB0eXBlO1xyXG4gICAgICAgIHZhciBleHByZXNzaW9ucyA9IFtdO1xyXG4gICAgICAgIHZhciBleHByZXNzaW9uO1xyXG4gICAgICAgIHZhciBiZWhhdmlvckluc3RydWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIHZhciB2YWx1ZXMgPSB7fTtcclxuICAgICAgICB2YXIgaGFzVmFsdWVzID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIHByb3ZpZGVycyA9IFtdO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gYXR0cmlidXRlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGF0dHIgPSBhdHRyaWJ1dGVzW2ldO1xyXG4gICAgICAgICAgICBhdHRyTmFtZSA9IGF0dHIubmFtZTtcclxuICAgICAgICAgICAgYXR0clZhbHVlID0gYXR0ci52YWx1ZTtcclxuICAgICAgICAgICAgaW5mbyA9IGJpbmRpbmdMYW5ndWFnZS5pbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgdGFnTmFtZSwgYXR0ck5hbWUsIGF0dHJWYWx1ZSk7XHJcbiAgICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAga25vd25BdHRyaWJ1dGUgPSByZXNvdXJjZXMubWFwQXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGtub3duQXR0cmlidXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkgPSB0eXBlLmF0dHJpYnV0ZXNba25vd25BdHRyaWJ1dGVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IHByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbmZvLmNvbW1hbmQgJiYgIWluZm8uZXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5jb21tYW5kID0gcHJvcGVydHkuaGFzT3B0aW9ucyA/ICdvcHRpb25zJyA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8uY29tbWFuZCAmJiAoaW5mby5jb21tYW5kICE9PSAnb3B0aW9ucycpICYmIHR5cGUucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpbWFyeVByb3BlcnR5ID0gdHlwZS5wcmltYXJ5UHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyTmFtZSA9IGluZm8uYXR0ck5hbWUgPSBwcmltYXJ5UHJvcGVydHkuYXR0cmlidXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcmltYXJ5UHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uID0gYmluZGluZ0xhbmd1YWdlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uKHJlc291cmNlcywgbm9kZSwgaW5mbywgdW5kZWZpbmVkLCB0eXBlKTtcclxuICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uYWx0ZXJlZEF0dHIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlID0gcmVzb3VyY2VzLmdldEF0dHJpYnV0ZShpbnN0cnVjdGlvbi5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uZGlzY3JldGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnR5cGUgPSB0eXBlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9jb25maWd1cmVQcm9wZXJ0aWVzKGluc3RydWN0aW9uLCByZXNvdXJjZXMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZS5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignWW91IGNhbm5vdCBwbGFjZSBhIHRlbXBsYXRlIGNvbnRyb2xsZXIgb24gYSBzdXJyb2dhdGUgZWxlbWVudC4nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5zdHJ1Y3Rpb24uYXR0ck5hbWVdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoYXR0ck5hbWUsIHR5cGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbcmVzb3VyY2VzLm1hcEF0dHJpYnV0ZShhdHRyTmFtZSldID0gYXR0clZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlLmxpZnRzQ29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBjYW5ub3QgcGxhY2UgYSB0ZW1wbGF0ZSBjb250cm9sbGVyIG9uIGEgc3Vycm9nYXRlIGVsZW1lbnQuJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChhdHRyTmFtZSAhPT0gJ2lkJyAmJiBhdHRyTmFtZSAhPT0gJ3BhcnQnICYmIGF0dHJOYW1lICE9PSAncmVwbGFjZS1wYXJ0Jykge1xyXG4gICAgICAgICAgICAgICAgICAgIGhhc1ZhbHVlcyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzW2F0dHJOYW1lXSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoIHx8IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCB8fCBoYXNWYWx1ZXMpIHtcclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBiZWhhdmlvckluc3RydWN0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZS5jb21waWxlKHRoaXMsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzLnB1c2goaW5zdHJ1Y3Rpb24udHlwZS50YXJnZXQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gZXhwcmVzc2lvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgaWYgKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShleHByZXNzaW9uLmF0dHJUb1JlbW92ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFRhcmdldEluc3RydWN0aW9uLnN1cnJvZ2F0ZShwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgdmFsdWVzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgVmlld0NvbXBpbGVyLnByb3RvdHlwZS5fY29tcGlsZUVsZW1lbnQgPSBmdW5jdGlvbiAobm9kZSwgcmVzb3VyY2VzLCBpbnN0cnVjdGlvbnMsIHBhcmVudE5vZGUsIHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKSB7XHJcbiAgICAgICAgdmFyIHRhZ05hbWUgPSBub2RlLnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IG5vZGUuYXR0cmlidXRlcztcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbnMgPSBbXTtcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbjtcclxuICAgICAgICB2YXIgYmVoYXZpb3JJbnN0cnVjdGlvbnMgPSBbXTtcclxuICAgICAgICB2YXIgcHJvdmlkZXJzID0gW107XHJcbiAgICAgICAgdmFyIGJpbmRpbmdMYW5ndWFnZSA9IHJlc291cmNlcy5nZXRCaW5kaW5nTGFuZ3VhZ2UodGhpcy5iaW5kaW5nTGFuZ3VhZ2UpO1xyXG4gICAgICAgIHZhciBsaWZ0aW5nSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdmFyIHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHZhciB0eXBlO1xyXG4gICAgICAgIHZhciBlbGVtZW50SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdmFyIGVsZW1lbnRQcm9wZXJ0eTtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGF0dHI7XHJcbiAgICAgICAgdmFyIGF0dHJOYW1lO1xyXG4gICAgICAgIHZhciBhdHRyVmFsdWU7XHJcbiAgICAgICAgdmFyIG9yaWdpbmFsQXR0ck5hbWU7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uO1xyXG4gICAgICAgIHZhciBpbmZvO1xyXG4gICAgICAgIHZhciBwcm9wZXJ0eTtcclxuICAgICAgICB2YXIga25vd25BdHRyaWJ1dGU7XHJcbiAgICAgICAgdmFyIGF1VGFyZ2V0SUQ7XHJcbiAgICAgICAgdmFyIGluamVjdG9ySWQ7XHJcbiAgICAgICAgaWYgKHRhZ05hbWUgPT09ICdzbG90Jykge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0TGlnaHRET00pIHtcclxuICAgICAgICAgICAgICAgIG5vZGUgPSBtYWtlU2hhZG93U2xvdCh0aGlzLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9ucywgcGFyZW50SW5qZWN0b3JJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG5vZGUubmV4dFNpYmxpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRhZ05hbWUgPT09ICd0ZW1wbGF0ZScpIHtcclxuICAgICAgICAgICAgaWYgKCEoJ2NvbnRlbnQnIGluIG5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1lvdSBjYW5ub3QgcGxhY2UgYSB0ZW1wbGF0ZSBlbGVtZW50IHdpdGhpbiAnICsgbm9kZS5uYW1lc3BhY2VVUkkgKyAnIG5hbWVzcGFjZScpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZpZXdGYWN0b3J5ID0gdGhpcy5jb21waWxlKG5vZGUsIHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgIHZpZXdGYWN0b3J5LnBhcnQgPSBub2RlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRFbGVtZW50KG5vZGUuZ2V0QXR0cmlidXRlKCdhcy1lbGVtZW50JykgfHwgdGFnTmFtZSk7XHJcbiAgICAgICAgICAgIGlmICh0YWdOYW1lID09PSAnbGV0JyAmJiAhdHlwZSAmJiBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlTGV0RXhwcmVzc2lvbnMgIT09IGRlZmF1bHRMZXRIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICBleHByZXNzaW9ucyA9IGJpbmRpbmdMYW5ndWFnZS5jcmVhdGVMZXRFeHByZXNzaW9ucyhyZXNvdXJjZXMsIG5vZGUpO1xyXG4gICAgICAgICAgICAgICAgYXVUYXJnZXRJRCA9IG1ha2VJbnRvSW5zdHJ1Y3Rpb25UYXJnZXQobm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnNbYXVUYXJnZXRJRF0gPSBUYXJnZXRJbnN0cnVjdGlvbi5sZXRFbGVtZW50KGV4cHJlc3Npb25zKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBub2RlLm5leHRTaWJsaW5nO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50SW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmVsZW1lbnQobm9kZSwgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICB0eXBlLnByb2Nlc3NBdHRyaWJ1dGVzKHRoaXMsIHJlc291cmNlcywgbm9kZSwgYXR0cmlidXRlcywgZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLnB1c2goZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGF0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBhdHRyID0gYXR0cmlidXRlc1tpXTtcclxuICAgICAgICAgICAgb3JpZ2luYWxBdHRyTmFtZSA9IGF0dHJOYW1lID0gYXR0ci5uYW1lO1xyXG4gICAgICAgICAgICBhdHRyVmFsdWUgPSBhdHRyLnZhbHVlO1xyXG4gICAgICAgICAgICBpbmZvID0gYmluZGluZ0xhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCB0YWdOYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHRhcmdldExpZ2h0RE9NICYmIGluZm8uYXR0ck5hbWUgPT09ICdzbG90Jykge1xyXG4gICAgICAgICAgICAgICAgaW5mby5hdHRyTmFtZSA9IGF0dHJOYW1lID0gJ2F1LXNsb3QnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICBlbGVtZW50UHJvcGVydHkgPSBudWxsO1xyXG4gICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAga25vd25BdHRyaWJ1dGUgPSByZXNvdXJjZXMubWFwQXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGtub3duQXR0cmlidXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcHJvcGVydHkgPSB0eXBlLmF0dHJpYnV0ZXNba25vd25BdHRyaWJ1dGVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IHByb3BlcnR5LmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFpbmZvLmNvbW1hbmQgJiYgIWluZm8uZXhwcmVzc2lvbikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5jb21tYW5kID0gcHJvcGVydHkuaGFzT3B0aW9ucyA/ICdvcHRpb25zJyA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGluZm8uY29tbWFuZCAmJiAoaW5mby5jb21tYW5kICE9PSAnb3B0aW9ucycpICYmIHR5cGUucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpbWFyeVByb3BlcnR5ID0gdHlwZS5wcmltYXJ5UHJvcGVydHk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyTmFtZSA9IGluZm8uYXR0ck5hbWUgPSBwcmltYXJ5UHJvcGVydHkuYXR0cmlidXRlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPSBwcmltYXJ5UHJvcGVydHkuZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGVsZW1lbnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudFByb3BlcnR5ID0gZWxlbWVudEluc3RydWN0aW9uLnR5cGUuYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXTtcclxuICAgICAgICAgICAgICAgIGlmIChlbGVtZW50UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IGVsZW1lbnRQcm9wZXJ0eS5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGVsZW1lbnRQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBiaW5kaW5nTGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBub2RlLCBpbmZvLCB1bmRlZmluZWQsIHR5cGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChpbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uLmFsdGVyZWRBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZSA9IHJlc291cmNlcy5nZXRBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24uYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKGluc3RydWN0aW9uLmRpc2NyZXRlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi50eXBlID0gdHlwZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fY29uZmlndXJlUHJvcGVydGllcyhpbnN0cnVjdGlvbiwgcmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5vcmlnaW5hbEF0dHJOYW1lID0gb3JpZ2luYWxBdHRyTmFtZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxpZnRpbmdJbnN0cnVjdGlvbiA9IGluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudEluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0udGFyZ2V0UHJvcGVydHkgPSBlbGVtZW50UHJvcGVydHkubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4cHJlc3Npb25zLnB1c2goaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbnN0cnVjdGlvbi5hdHRyTmFtZV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24gPSBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShhdHRyTmFtZSwgdHlwZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tyZXNvdXJjZXMubWFwQXR0cmlidXRlKGF0dHJOYW1lKV0gPSBhdHRyVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLm9yaWdpbmFsQXR0ck5hbWUgPSBvcmlnaW5hbEF0dHJOYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsaWZ0aW5nSW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWhhdmlvckluc3RydWN0aW9ucy5wdXNoKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChlbGVtZW50UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50SW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1thdHRyTmFtZV0gPSBhdHRyVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGxpZnRpbmdJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICBsaWZ0aW5nSW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICAgICAgbm9kZSA9IGxpZnRpbmdJbnN0cnVjdGlvbi50eXBlLmNvbXBpbGUodGhpcywgcmVzb3VyY2VzLCBub2RlLCBsaWZ0aW5nSW5zdHJ1Y3Rpb24sIHBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChub2RlKTtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb25zW2F1VGFyZ2V0SURdID0gVGFyZ2V0SW5zdHJ1Y3Rpb24ubGlmdGluZyhwYXJlbnRJbmplY3RvcklkLCBsaWZ0aW5nSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHNraXBDb250ZW50UHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoZXhwcmVzc2lvbnMubGVuZ3RoIHx8IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgaW5qZWN0b3JJZCA9IGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLmxlbmd0aCA/IGdldE5leHRJbmplY3RvcklkKCkgOiBmYWxzZTtcclxuICAgICAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYmVoYXZpb3JJbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uID0gYmVoYXZpb3JJbnN0cnVjdGlvbnNbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udHlwZS5jb21waWxlKHRoaXMsIHJlc291cmNlcywgbm9kZSwgaW5zdHJ1Y3Rpb24sIHBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHByb3ZpZGVycy5wdXNoKGluc3RydWN0aW9uLnR5cGUudGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgICAgICBza2lwQ29udGVudFByb2Nlc3NpbmcgPSBza2lwQ29udGVudFByb2Nlc3NpbmcgfHwgaW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBleHByZXNzaW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb25zW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uLmF0dHJUb1JlbW92ZSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGV4cHJlc3Npb24uYXR0clRvUmVtb3ZlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBhdVRhcmdldElEID0gbWFrZUludG9JbnN0cnVjdGlvblRhcmdldChub2RlKTtcclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uc1thdVRhcmdldElEXSA9IFRhcmdldEluc3RydWN0aW9uLm5vcm1hbChpbmplY3RvcklkLCBwYXJlbnRJbmplY3RvcklkLCBwcm92aWRlcnMsIGJlaGF2aW9ySW5zdHJ1Y3Rpb25zLCBleHByZXNzaW9ucywgZWxlbWVudEluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoc2tpcENvbnRlbnRQcm9jZXNzaW5nKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY3VycmVudENoaWxkID0gbm9kZS5maXJzdENoaWxkO1xyXG4gICAgICAgICAgICB3aGlsZSAoY3VycmVudENoaWxkKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50Q2hpbGQgPSB0aGlzLl9jb21waWxlTm9kZShjdXJyZW50Q2hpbGQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb25zLCBub2RlLCBpbmplY3RvcklkIHx8IHBhcmVudEluamVjdG9ySWQsIHRhcmdldExpZ2h0RE9NKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbm9kZS5uZXh0U2libGluZztcclxuICAgIH07XHJcbiAgICBWaWV3Q29tcGlsZXIucHJvdG90eXBlLl9jb25maWd1cmVQcm9wZXJ0aWVzID0gZnVuY3Rpb24gKGluc3RydWN0aW9uLCByZXNvdXJjZXMpIHtcclxuICAgICAgICB2YXIgdHlwZSA9IGluc3RydWN0aW9uLnR5cGU7XHJcbiAgICAgICAgdmFyIGF0dHJOYW1lID0gaW5zdHJ1Y3Rpb24uYXR0ck5hbWU7XHJcbiAgICAgICAgdmFyIGF0dHJpYnV0ZXMgPSBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzO1xyXG4gICAgICAgIHZhciBwcm9wZXJ0eTtcclxuICAgICAgICB2YXIga2V5O1xyXG4gICAgICAgIHZhciB2YWx1ZTtcclxuICAgICAgICB2YXIga25vd25BdHRyaWJ1dGUgPSByZXNvdXJjZXMubWFwQXR0cmlidXRlKGF0dHJOYW1lKTtcclxuICAgICAgICBpZiAoa25vd25BdHRyaWJ1dGUgJiYgYXR0ck5hbWUgaW4gYXR0cmlidXRlcyAmJiBrbm93bkF0dHJpYnV0ZSAhPT0gYXR0ck5hbWUpIHtcclxuICAgICAgICAgICAgYXR0cmlidXRlc1trbm93bkF0dHJpYnV0ZV0gPSBhdHRyaWJ1dGVzW2F0dHJOYW1lXTtcclxuICAgICAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbYXR0ck5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGtleSBpbiBhdHRyaWJ1dGVzKSB7XHJcbiAgICAgICAgICAgIHZhbHVlID0gYXR0cmlidXRlc1trZXldO1xyXG4gICAgICAgICAgICBpZiAodmFsdWUgIT09IG51bGwgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xyXG4gICAgICAgICAgICAgICAgcHJvcGVydHkgPSB0eXBlLmF0dHJpYnV0ZXNba2V5XTtcclxuICAgICAgICAgICAgICAgIGlmIChwcm9wZXJ0eSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUudGFyZ2V0UHJvcGVydHkgPSBwcm9wZXJ0eS5uYW1lO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFsdWUudGFyZ2V0UHJvcGVydHkgPSBrZXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFZpZXdDb21waWxlcjtcclxufSgpKTtcblxudmFyIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlKCkge1xyXG4gICAgfVxyXG4gICAgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHtcclxuICAgICAgICB0aGlzLmluc3RhbmNlID0gY29udGFpbmVyLmdldCh0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChyZWdpc3RyeSwgbmFtZSkge1xyXG4gICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyVmlld0VuZ2luZUhvb2tzKHRoaXMuaW5zdGFuY2UpO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7IH07XHJcbiAgICBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICBpZiAobmFtZS5lbmRzV2l0aCgnVmlld0VuZ2luZUhvb2tzJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlld0VuZ2luZUhvb2tzUmVzb3VyY2U7XHJcbn0oKSk7XHJcbmZ1bmN0aW9uIHZpZXdFbmdpbmVIb29rcyh0YXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIG5ldyBWaWV3RW5naW5lSG9va3NSZXNvdXJjZSgpLCB0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxuXG52YXIgUmVzb3VyY2VNb2R1bGUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUmVzb3VyY2VNb2R1bGUobW9kdWxlSWQpIHtcclxuICAgICAgICB0aGlzLmlkID0gbW9kdWxlSWQ7XHJcbiAgICAgICAgdGhpcy5tb2R1bGVJbnN0YW5jZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5tYWluUmVzb3VyY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMucmVzb3VyY2VzID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZpZXdTdHJhdGVneSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5vbkxvYWRlZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5sb2FkQ29udGV4dCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBSZXNvdXJjZU1vZHVsZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICB2YXIgY3VycmVudCA9IHRoaXMubWFpblJlc291cmNlO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcclxuICAgICAgICB2YXIgdnMgPSB0aGlzLnZpZXdTdHJhdGVneTtcclxuICAgICAgICBpZiAodGhpcy5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0luaXRpYWxpemVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQubWV0YWRhdGEudmlld1N0cmF0ZWd5ID0gdnM7XHJcbiAgICAgICAgICAgIGN1cnJlbnQuaW5pdGlhbGl6ZShjb250YWluZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gcmVzb3VyY2VzW2ldO1xyXG4gICAgICAgICAgICBjdXJyZW50Lm1ldGFkYXRhLnZpZXdTdHJhdGVneSA9IHZzO1xyXG4gICAgICAgICAgICBjdXJyZW50LmluaXRpYWxpemUoY29udGFpbmVyKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmVzb3VyY2VNb2R1bGUucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlZ2lzdHJ5LCBuYW1lKSB7XHJcbiAgICAgICAgdmFyIG1haW4gPSB0aGlzLm1haW5SZXNvdXJjZTtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gdGhpcy5yZXNvdXJjZXM7XHJcbiAgICAgICAgaWYgKG1haW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBtYWluLnJlZ2lzdGVyKHJlZ2lzdHJ5LCBuYW1lKTtcclxuICAgICAgICAgICAgbmFtZSA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHJlc291cmNlcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHJlc291cmNlc1tpXS5yZWdpc3RlcihyZWdpc3RyeSwgbmFtZSk7XHJcbiAgICAgICAgICAgIG5hbWUgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSZXNvdXJjZU1vZHVsZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIGxvYWRDb250ZXh0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMub25Mb2FkZWQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZENvbnRleHQgPT09IGxvYWRDb250ZXh0ID8gUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLm9uTG9hZGVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbWFpbiA9IHRoaXMubWFpblJlc291cmNlO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSB0aGlzLnJlc291cmNlcztcclxuICAgICAgICB2YXIgbG9hZHM7XHJcbiAgICAgICAgaWYgKG1haW4gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICBsb2FkcyA9IG5ldyBBcnJheShyZXNvdXJjZXMubGVuZ3RoICsgMSk7XHJcbiAgICAgICAgICAgIGxvYWRzWzBdID0gbWFpbi5sb2FkKGNvbnRhaW5lciwgbG9hZENvbnRleHQpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgbG9hZHNbaSArIDFdID0gcmVzb3VyY2VzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxvYWRzID0gbmV3IEFycmF5KHJlc291cmNlcy5sZW5ndGgpO1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSByZXNvdXJjZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgbG9hZHNbaV0gPSByZXNvdXJjZXNbaV0ubG9hZChjb250YWluZXIsIGxvYWRDb250ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvYWRDb250ZXh0ID0gbG9hZENvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5vbkxvYWRlZCA9IFByb21pc2UuYWxsKGxvYWRzKTtcclxuICAgICAgICByZXR1cm4gdGhpcy5vbkxvYWRlZDtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUmVzb3VyY2VNb2R1bGU7XHJcbn0oKSk7XHJcbnZhciBSZXNvdXJjZURlc2NyaXB0aW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgaWYgKCFyZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBtZXRhZGF0YS5nZXQobWV0YWRhdGEucmVzb3VyY2UsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICBpZiAoIXJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEgPSBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XHJcbiAgICAgICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIHJlc291cmNlVHlwZU1ldGEsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5lbGVtZW50TmFtZSA9IF9oeXBoZW5hdGUoa2V5KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChyZXNvdXJjZVR5cGVNZXRhLmF0dHJpYnV0ZU5hbWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID0gX2h5cGhlbmF0ZShrZXkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXJlc291cmNlVHlwZU1ldGEubmFtZSkge1xyXG4gICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLm5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubWV0YWRhdGEgPSByZXNvdXJjZVR5cGVNZXRhO1xyXG4gICAgICAgIHRoaXMudmFsdWUgPSBleHBvcnRlZFZhbHVlO1xyXG4gICAgfVxyXG4gICAgUmVzb3VyY2VEZXNjcmlwdGlvbi5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIChjb250YWluZXIpIHtcclxuICAgICAgICB0aGlzLm1ldGFkYXRhLmluaXRpYWxpemUoY29udGFpbmVyLCB0aGlzLnZhbHVlKTtcclxuICAgIH07XHJcbiAgICBSZXNvdXJjZURlc2NyaXB0aW9uLnByb3RvdHlwZS5yZWdpc3RlciA9IGZ1bmN0aW9uIChyZWdpc3RyeSwgbmFtZSkge1xyXG4gICAgICAgIHRoaXMubWV0YWRhdGEucmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpO1xyXG4gICAgfTtcclxuICAgIFJlc291cmNlRGVzY3JpcHRpb24ucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBsb2FkQ29udGV4dCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm1ldGFkYXRhLmxvYWQoY29udGFpbmVyLCB0aGlzLnZhbHVlLCBsb2FkQ29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFJlc291cmNlRGVzY3JpcHRpb247XHJcbn0oKSk7XHJcbnZhciBNb2R1bGVBbmFseXplciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBNb2R1bGVBbmFseXplcigpIHtcclxuICAgICAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIH1cclxuICAgIE1vZHVsZUFuYWx5emVyLnByb3RvdHlwZS5nZXRBbmFseXNpcyA9IGZ1bmN0aW9uIChtb2R1bGVJZCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNhY2hlW21vZHVsZUlkXTtcclxuICAgIH07XHJcbiAgICBNb2R1bGVBbmFseXplci5wcm90b3R5cGUuYW5hbHl6ZSA9IGZ1bmN0aW9uIChtb2R1bGVJZCwgbW9kdWxlSW5zdGFuY2UsIG1haW5SZXNvdXJjZUtleSkge1xyXG4gICAgICAgIHZhciBtYWluUmVzb3VyY2U7XHJcbiAgICAgICAgdmFyIGZhbGxiYWNrVmFsdWU7XHJcbiAgICAgICAgdmFyIGZhbGxiYWNrS2V5O1xyXG4gICAgICAgIHZhciByZXNvdXJjZVR5cGVNZXRhO1xyXG4gICAgICAgIHZhciBrZXk7XHJcbiAgICAgICAgdmFyIGV4cG9ydGVkVmFsdWU7XHJcbiAgICAgICAgdmFyIHJlc291cmNlcyA9IFtdO1xyXG4gICAgICAgIHZhciBjb252ZW50aW9uYWw7XHJcbiAgICAgICAgdmFyIHZzO1xyXG4gICAgICAgIHZhciByZXNvdXJjZU1vZHVsZTtcclxuICAgICAgICByZXNvdXJjZU1vZHVsZSA9IHRoaXMuY2FjaGVbbW9kdWxlSWRdO1xyXG4gICAgICAgIGlmIChyZXNvdXJjZU1vZHVsZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VNb2R1bGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc291cmNlTW9kdWxlID0gbmV3IFJlc291cmNlTW9kdWxlKG1vZHVsZUlkKTtcclxuICAgICAgICB0aGlzLmNhY2hlW21vZHVsZUlkXSA9IHJlc291cmNlTW9kdWxlO1xyXG4gICAgICAgIGlmICh0eXBlb2YgbW9kdWxlSW5zdGFuY2UgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgbW9kdWxlSW5zdGFuY2UgPSB7ICdkZWZhdWx0JzogbW9kdWxlSW5zdGFuY2UgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKG1haW5SZXNvdXJjZUtleSkge1xyXG4gICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihtYWluUmVzb3VyY2VLZXksIG1vZHVsZUluc3RhbmNlW21haW5SZXNvdXJjZUtleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGtleSBpbiBtb2R1bGVJbnN0YW5jZSkge1xyXG4gICAgICAgICAgICBleHBvcnRlZFZhbHVlID0gbW9kdWxlSW5zdGFuY2Vba2V5XTtcclxuICAgICAgICAgICAgaWYgKGtleSA9PT0gbWFpblJlc291cmNlS2V5IHx8IHR5cGVvZiBleHBvcnRlZFZhbHVlICE9PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gbWV0YWRhdGEuZ2V0KG1ldGFkYXRhLnJlc291cmNlLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEpIHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGVNZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24oZXhwb3J0ZWRWYWx1ZSwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIEh0bWxCZWhhdmlvclJlc291cmNlLmNvbnZlbnRpb24oa2V5LCByZXNvdXJjZVR5cGVNZXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlVHlwZU1ldGEuYXR0cmlidXRlTmFtZSA9PT0gbnVsbCAmJiByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKCFtYWluUmVzb3VyY2UgJiYgcmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIHJlc291cmNlVHlwZU1ldGEpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCByZXNvdXJjZVR5cGVNZXRhKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodmlld1N0cmF0ZWd5LmRlY29yYXRlcyhleHBvcnRlZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgdnMgPSBleHBvcnRlZFZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGV4cG9ydGVkVmFsdWUgaW5zdGFuY2VvZiBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkpIHtcclxuICAgICAgICAgICAgICAgIHZzID0gbmV3IFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kobW9kdWxlSWQsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnZlbnRpb25hbCA9IFZpZXdSZXNvdXJjZXMuY29udmVudGlvbihleHBvcnRlZFZhbHVlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb252ZW50aW9uYWwuZWxlbWVudE5hbWUgIT09IG51bGwgJiYgIW1haW5SZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMucHVzaChuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGNvbnZlbnRpb25hbCwgZXhwb3J0ZWRWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjb252ZW50aW9uYWwgPSBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY29udmVudGlvbmFsLmVsZW1lbnROYW1lICE9PSBudWxsICYmICFtYWluUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWFpblJlc291cmNlID0gbmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2VzLnB1c2gobmV3IFJlc291cmNlRGVzY3JpcHRpb24oa2V5LCBleHBvcnRlZFZhbHVlLCBjb252ZW50aW9uYWwpKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBjb252ZW50aW9uYWwsIGV4cG9ydGVkVmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29udmVudGlvbmFsID0gVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5jb252ZW50aW9uKGtleSlcclxuICAgICAgICAgICAgICAgICAgICB8fCBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGtleSlcclxuICAgICAgICAgICAgICAgICAgICB8fCBWaWV3RW5naW5lSG9va3NSZXNvdXJjZS5jb252ZW50aW9uKGtleSkpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZXMucHVzaChuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihrZXksIGV4cG9ydGVkVmFsdWUsIGNvbnZlbnRpb25hbCkpO1xyXG4gICAgICAgICAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgY29udmVudGlvbmFsLCBleHBvcnRlZFZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFmYWxsYmFja1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tWYWx1ZSA9IGV4cG9ydGVkVmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgZmFsbGJhY2tLZXkgPSBrZXk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFtYWluUmVzb3VyY2UgJiYgZmFsbGJhY2tWYWx1ZSkge1xyXG4gICAgICAgICAgICBtYWluUmVzb3VyY2UgPSBuZXcgUmVzb3VyY2VEZXNjcmlwdGlvbihmYWxsYmFja0tleSwgZmFsbGJhY2tWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc291cmNlTW9kdWxlLm1vZHVsZUluc3RhbmNlID0gbW9kdWxlSW5zdGFuY2U7XHJcbiAgICAgICAgcmVzb3VyY2VNb2R1bGUubWFpblJlc291cmNlID0gbWFpblJlc291cmNlO1xyXG4gICAgICAgIHJlc291cmNlTW9kdWxlLnJlc291cmNlcyA9IHJlc291cmNlcztcclxuICAgICAgICByZXNvdXJjZU1vZHVsZS52aWV3U3RyYXRlZ3kgPSB2cztcclxuICAgICAgICByZXR1cm4gcmVzb3VyY2VNb2R1bGU7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE1vZHVsZUFuYWx5emVyO1xyXG59KCkpO1xuXG52YXIgbG9nZ2VyID0gTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKTtcclxuZnVuY3Rpb24gZW5zdXJlUmVnaXN0cnlFbnRyeShsb2FkZXIsIHVybE9yUmVnaXN0cnlFbnRyeSkge1xyXG4gICAgaWYgKHVybE9yUmVnaXN0cnlFbnRyeSBpbnN0YW5jZW9mIFRlbXBsYXRlUmVnaXN0cnlFbnRyeSkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodXJsT3JSZWdpc3RyeUVudHJ5KTtcclxuICAgIH1cclxuICAgIHJldHVybiBsb2FkZXIubG9hZFRlbXBsYXRlKHVybE9yUmVnaXN0cnlFbnRyeSk7XHJcbn1cclxudmFyIFByb3h5Vmlld0ZhY3RvcnkgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUHJveHlWaWV3RmFjdG9yeShwcm9taXNlKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKHgpIHsgcmV0dXJuIF90aGlzLnZpZXdGYWN0b3J5ID0geDsgfSk7XHJcbiAgICB9XHJcbiAgICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBiaW5kaW5nQ29udGV4dCwgY3JlYXRlSW5zdHJ1Y3Rpb24sIGVsZW1lbnQpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUoY29udGFpbmVyLCBiaW5kaW5nQ29udGV4dCwgY3JlYXRlSW5zdHJ1Y3Rpb24sIGVsZW1lbnQpO1xyXG4gICAgfTtcclxuICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZSwgXCJpc0NhY2hpbmdcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy52aWV3RmFjdG9yeS5pc0NhY2hpbmc7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcclxuICAgICAgICBjb25maWd1cmFibGU6IHRydWVcclxuICAgIH0pO1xyXG4gICAgUHJveHlWaWV3RmFjdG9yeS5wcm90b3R5cGUuc2V0Q2FjaGVTaXplID0gZnVuY3Rpb24gKHNpemUsIGRvTm90T3ZlcnJpZGVJZkFscmVhZHlTZXQpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5LnNldENhY2hlU2l6ZShzaXplLCBkb05vdE92ZXJyaWRlSWZBbHJlYWR5U2V0KTtcclxuICAgIH07XHJcbiAgICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5nZXRDYWNoZWRWaWV3ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdGYWN0b3J5LmdldENhY2hlZFZpZXcoKTtcclxuICAgIH07XHJcbiAgICBQcm94eVZpZXdGYWN0b3J5LnByb3RvdHlwZS5yZXR1cm5WaWV3VG9DYWNoZSA9IGZ1bmN0aW9uICh2aWV3KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeS5yZXR1cm5WaWV3VG9DYWNoZSh2aWV3KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gUHJveHlWaWV3RmFjdG9yeTtcclxufSgpKTtcclxudmFyIGF1U2xvdEJlaGF2aW9yID0gbnVsbDtcclxudmFyIFZpZXdFbmdpbmUgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld0VuZ2luZShsb2FkZXIsIGNvbnRhaW5lciwgdmlld0NvbXBpbGVyLCBtb2R1bGVBbmFseXplciwgYXBwUmVzb3VyY2VzKSB7XHJcbiAgICAgICAgdGhpcy5sb2FkZXIgPSBsb2FkZXI7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy52aWV3Q29tcGlsZXIgPSB2aWV3Q29tcGlsZXI7XHJcbiAgICAgICAgdGhpcy5tb2R1bGVBbmFseXplciA9IG1vZHVsZUFuYWx5emVyO1xyXG4gICAgICAgIHRoaXMuYXBwUmVzb3VyY2VzID0gYXBwUmVzb3VyY2VzO1xyXG4gICAgICAgIHRoaXMuX3BsdWdpbk1hcCA9IHt9O1xyXG4gICAgICAgIGlmIChhdVNsb3RCZWhhdmlvciA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICBhdVNsb3RCZWhhdmlvciA9IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICBhdVNsb3RCZWhhdmlvci5hdHRyaWJ1dGVOYW1lID0gJ2F1LXNsb3QnO1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGF1U2xvdEJlaGF2aW9yLCBTbG90Q3VzdG9tQXR0cmlidXRlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYXVTbG90QmVoYXZpb3IuaW5pdGlhbGl6ZShjb250YWluZXIsIFNsb3RDdXN0b21BdHRyaWJ1dGUpO1xyXG4gICAgICAgIGF1U2xvdEJlaGF2aW9yLnJlZ2lzdGVyKGFwcFJlc291cmNlcyk7XHJcbiAgICB9XHJcbiAgICBWaWV3RW5naW5lLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW0xvYWRlciwgQ29udGFpbmVyLCBWaWV3Q29tcGlsZXIsIE1vZHVsZUFuYWx5emVyLCBWaWV3UmVzb3VyY2VzXTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5hZGRSZXNvdXJjZVBsdWdpbiA9IGZ1bmN0aW9uIChleHRlbnNpb24sIGltcGxlbWVudGF0aW9uKSB7XHJcbiAgICAgICAgdmFyIG5hbWUgPSBleHRlbnNpb24ucmVwbGFjZSgnLicsICcnKSArICctcmVzb3VyY2UtcGx1Z2luJztcclxuICAgICAgICB0aGlzLl9wbHVnaW5NYXBbZXh0ZW5zaW9uXSA9IG5hbWU7XHJcbiAgICAgICAgdGhpcy5sb2FkZXIuYWRkUGx1Z2luKG5hbWUsIGltcGxlbWVudGF0aW9uKTtcclxuICAgIH07XHJcbiAgICBWaWV3RW5naW5lLnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodXJsT3JSZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGxvYWRDb250ZXh0ID0gbG9hZENvbnRleHQgfHwgbmV3IFJlc291cmNlTG9hZENvbnRleHQoKTtcclxuICAgICAgICByZXR1cm4gZW5zdXJlUmVnaXN0cnlFbnRyeSh0aGlzLmxvYWRlciwgdXJsT3JSZWdpc3RyeUVudHJ5KS50aGVuKGZ1bmN0aW9uIChyZWdpc3RyeUVudHJ5KSB7XHJcbiAgICAgICAgICAgIHZhciB1cmwgPSByZWdpc3RyeUVudHJ5LmFkZHJlc3M7XHJcbiAgICAgICAgICAgIGlmIChyZWdpc3RyeUVudHJ5Lm9uUmVhZHkpIHtcclxuICAgICAgICAgICAgICAgIGlmICghbG9hZENvbnRleHQuaGFzRGVwZW5kZW5jeSh1cmwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZENvbnRleHQuYWRkRGVwZW5kZW5jeSh1cmwpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5Lm9uUmVhZHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVnaXN0cnlFbnRyeS50ZW1wbGF0ZSA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWdpc3RyeUVudHJ5Lm9uUmVhZHk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBQcm94eVZpZXdGYWN0b3J5KHJlZ2lzdHJ5RW50cnkub25SZWFkeSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxvYWRDb250ZXh0LmFkZERlcGVuZGVuY3kodXJsKTtcclxuICAgICAgICAgICAgcmVnaXN0cnlFbnRyeS5vblJlYWR5ID0gX3RoaXMubG9hZFRlbXBsYXRlUmVzb3VyY2VzKHJlZ2lzdHJ5RW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkudGhlbihmdW5jdGlvbiAocmVzb3VyY2VzKSB7XHJcbiAgICAgICAgICAgICAgICByZWdpc3RyeUVudHJ5LnJlc291cmNlcyA9IHJlc291cmNlcztcclxuICAgICAgICAgICAgICAgIGlmIChyZWdpc3RyeUVudHJ5LnRlbXBsYXRlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lzdHJ5RW50cnkuZmFjdG9yeSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB2YXIgdmlld0ZhY3RvcnkgPSBfdGhpcy52aWV3Q29tcGlsZXIuY29tcGlsZShyZWdpc3RyeUVudHJ5LnRlbXBsYXRlLCByZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5mYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVnaXN0cnlFbnRyeS5vblJlYWR5O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLmxvYWRUZW1wbGF0ZVJlc291cmNlcyA9IGZ1bmN0aW9uIChyZWdpc3RyeUVudHJ5LCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgcmVzb3VyY2VzID0gbmV3IFZpZXdSZXNvdXJjZXModGhpcy5hcHBSZXNvdXJjZXMsIHJlZ2lzdHJ5RW50cnkuYWRkcmVzcyk7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY2llcyA9IHJlZ2lzdHJ5RW50cnkuZGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIHZhciBpbXBvcnRJZHM7XHJcbiAgICAgICAgdmFyIG5hbWVzO1xyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbiA9IGNvbXBpbGVJbnN0cnVjdGlvbiB8fCBWaWV3Q29tcGlsZUluc3RydWN0aW9uLm5vcm1hbDtcclxuICAgICAgICBpZiAoZGVwZW5kZW5jaWVzLmxlbmd0aCA9PT0gMCAmJiAhY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc291cmNlcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGltcG9ydElkcyA9IGRlcGVuZGVuY2llcy5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHguc3JjOyB9KTtcclxuICAgICAgICBuYW1lcyA9IGRlcGVuZGVuY2llcy5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIHgubmFtZTsgfSk7XHJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKFwiaW1wb3J0aW5nIHJlc291cmNlcyBmb3IgXCIuY29uY2F0KHJlZ2lzdHJ5RW50cnkuYWRkcmVzcyksIGltcG9ydElkcyk7XHJcbiAgICAgICAgaWYgKHRhcmdldCkge1xyXG4gICAgICAgICAgICB2YXIgdmlld01vZGVsUmVxdWlyZXMgPSBtZXRhZGF0YS5nZXQoVmlld0VuZ2luZS52aWV3TW9kZWxSZXF1aXJlTWV0YWRhdGFLZXksIHRhcmdldCk7XHJcbiAgICAgICAgICAgIGlmICh2aWV3TW9kZWxSZXF1aXJlcykge1xyXG4gICAgICAgICAgICAgICAgdmFyIHRlbXBsYXRlSW1wb3J0Q291bnQgPSBpbXBvcnRJZHMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gdmlld01vZGVsUmVxdWlyZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByZXEgPSB2aWV3TW9kZWxSZXF1aXJlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgaW1wb3J0SWQgPSB0eXBlb2YgcmVxID09PSAnZnVuY3Rpb24nXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gT3JpZ2luLmdldChyZXEpLm1vZHVsZUlkXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDogcmVsYXRpdmVUb0ZpbGUocmVxLnNyYyB8fCByZXEsIHJlZ2lzdHJ5RW50cnkuYWRkcmVzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGltcG9ydElkcy5pbmRleE9mKGltcG9ydElkKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW1wb3J0SWRzLnB1c2goaW1wb3J0SWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lcy5wdXNoKHJlcS5hcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKFwiaW1wb3J0aW5nIFZpZXdNb2RlbCByZXNvdXJjZXMgZm9yIFwiLmNvbmNhdChjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkKSwgaW1wb3J0SWRzLnNsaWNlKHRlbXBsYXRlSW1wb3J0Q291bnQpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5pbXBvcnRWaWV3UmVzb3VyY2VzKGltcG9ydElkcywgbmFtZXMsIHJlc291cmNlcywgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUuaW1wb3J0Vmlld01vZGVsUmVzb3VyY2UgPSBmdW5jdGlvbiAobW9kdWxlSW1wb3J0LCBtb2R1bGVNZW1iZXIpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmxvYWRlci5sb2FkTW9kdWxlKG1vZHVsZUltcG9ydCkudGhlbihmdW5jdGlvbiAodmlld01vZGVsTW9kdWxlKSB7XHJcbiAgICAgICAgICAgIHZhciBub3JtYWxpemVkSWQgPSBPcmlnaW4uZ2V0KHZpZXdNb2RlbE1vZHVsZSkubW9kdWxlSWQ7XHJcbiAgICAgICAgICAgIHZhciByZXNvdXJjZU1vZHVsZSA9IF90aGlzLm1vZHVsZUFuYWx5emVyLmFuYWx5emUobm9ybWFsaXplZElkLCB2aWV3TW9kZWxNb2R1bGUsIG1vZHVsZU1lbWJlcik7XHJcbiAgICAgICAgICAgIGlmICghcmVzb3VyY2VNb2R1bGUubWFpblJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyB2aWV3IG1vZGVsIGZvdW5kIGluIG1vZHVsZSBcXFwiXCIuY29uY2F0KG1vZHVsZUltcG9ydCwgXCJcXFwiLlwiKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzb3VyY2VNb2R1bGUuaW5pdGlhbGl6ZShfdGhpcy5jb250YWluZXIpO1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzb3VyY2VNb2R1bGUubWFpblJlc291cmNlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIFZpZXdFbmdpbmUucHJvdG90eXBlLmltcG9ydFZpZXdSZXNvdXJjZXMgPSBmdW5jdGlvbiAobW9kdWxlSWRzLCBuYW1lcywgcmVzb3VyY2VzLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBsb2FkQ29udGV4dCA9IGxvYWRDb250ZXh0IHx8IG5ldyBSZXNvdXJjZUxvYWRDb250ZXh0KCk7XHJcbiAgICAgICAgY29tcGlsZUluc3RydWN0aW9uID0gY29tcGlsZUluc3RydWN0aW9uIHx8IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24ubm9ybWFsO1xyXG4gICAgICAgIG1vZHVsZUlkcyA9IG1vZHVsZUlkcy5tYXAoZnVuY3Rpb24gKHgpIHsgcmV0dXJuIF90aGlzLl9hcHBseUxvYWRlclBsdWdpbih4KTsgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVyLmxvYWRBbGxNb2R1bGVzKG1vZHVsZUlkcykudGhlbihmdW5jdGlvbiAoaW1wb3J0cykge1xyXG4gICAgICAgICAgICB2YXIgaTtcclxuICAgICAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgICAgICB2YXIgYW5hbHlzaXM7XHJcbiAgICAgICAgICAgIHZhciBub3JtYWxpemVkSWQ7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50O1xyXG4gICAgICAgICAgICB2YXIgYXNzb2NpYXRlZE1vZHVsZTtcclxuICAgICAgICAgICAgdmFyIGNvbnRhaW5lciA9IF90aGlzLmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgdmFyIG1vZHVsZUFuYWx5emVyID0gX3RoaXMubW9kdWxlQW5hbHl6ZXI7XHJcbiAgICAgICAgICAgIHZhciBhbGxBbmFseXNpcyA9IG5ldyBBcnJheShpbXBvcnRzLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gaW1wb3J0cy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gaW1wb3J0c1tpXTtcclxuICAgICAgICAgICAgICAgIG5vcm1hbGl6ZWRJZCA9IE9yaWdpbi5nZXQoY3VycmVudCkubW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICBhbmFseXNpcyA9IG1vZHVsZUFuYWx5emVyLmFuYWx5emUobm9ybWFsaXplZElkLCBjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgIGFuYWx5c2lzLmluaXRpYWxpemUoY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgIGFuYWx5c2lzLnJlZ2lzdGVyKHJlc291cmNlcywgbmFtZXNbaV0pO1xyXG4gICAgICAgICAgICAgICAgYWxsQW5hbHlzaXNbaV0gPSBhbmFseXNpcztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoY29tcGlsZUluc3RydWN0aW9uLmFzc29jaWF0ZWRNb2R1bGVJZCkge1xyXG4gICAgICAgICAgICAgICAgYXNzb2NpYXRlZE1vZHVsZSA9IG1vZHVsZUFuYWx5emVyLmdldEFuYWx5c2lzKGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFzc29jaWF0ZWRNb2R1bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBhc3NvY2lhdGVkTW9kdWxlLnJlZ2lzdGVyKHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBhbGxBbmFseXNpcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBhbGxBbmFseXNpc1tpXSA9IGFsbEFuYWx5c2lzW2ldLmxvYWQoY29udGFpbmVyLCBsb2FkQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGFsbEFuYWx5c2lzKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlc291cmNlczsgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS5wcm90b3R5cGUuX2FwcGx5TG9hZGVyUGx1Z2luID0gZnVuY3Rpb24gKGlkKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gaWQubGFzdEluZGV4T2YoJy4nKTtcclxuICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHZhciBleHQgPSBpZC5zdWJzdHJpbmcoaW5kZXgpO1xyXG4gICAgICAgICAgICB2YXIgcGx1Z2luTmFtZSA9IHRoaXMuX3BsdWdpbk1hcFtleHRdO1xyXG4gICAgICAgICAgICBpZiAocGx1Z2luTmFtZSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9hZGVyLmFwcGx5UGx1Z2luVG9VcmwoaWQsIHBsdWdpbk5hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaWQ7XHJcbiAgICB9O1xyXG4gICAgVmlld0VuZ2luZS52aWV3TW9kZWxSZXF1aXJlTWV0YWRhdGFLZXkgPSAnYXVyZWxpYTp2aWV3LW1vZGVsLXJlcXVpcmUnO1xyXG4gICAgcmV0dXJuIFZpZXdFbmdpbmU7XHJcbn0oKSk7XG5cbnZhciBDb250cm9sbGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbnRyb2xsZXIoYmVoYXZpb3IsIGluc3RydWN0aW9uLCB2aWV3TW9kZWwsIGNvbnRhaW5lcikge1xyXG4gICAgICAgIHRoaXMuYmVoYXZpb3IgPSBiZWhhdmlvcjtcclxuICAgICAgICB0aGlzLmluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgdGhpcy52aWV3TW9kZWwgPSB2aWV3TW9kZWw7XHJcbiAgICAgICAgdGhpcy5pc0F0dGFjaGVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gbnVsbDtcclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnNjb3BlID0gbnVsbDtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmVsZW1lbnRFdmVudHMgPSBjb250YWluZXIuZWxlbWVudEV2ZW50cyB8fCBudWxsO1xyXG4gICAgICAgIHZhciBvYnNlcnZlckxvb2t1cCA9IGJlaGF2aW9yLm9ic2VydmVyTG9jYXRvci5nZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cCh2aWV3TW9kZWwpO1xyXG4gICAgICAgIHZhciBoYW5kbGVzQmluZCA9IGJlaGF2aW9yLmhhbmRsZXNCaW5kO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVzID0gaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcztcclxuICAgICAgICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gdGhpcy5ib3VuZFByb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICB2YXIgcHJvcGVydGllcyA9IGJlaGF2aW9yLnByb3BlcnRpZXM7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIGJlaGF2aW9yLl9lbnN1cmVQcm9wZXJ0aWVzRGVmaW5lZCh2aWV3TW9kZWwsIG9ic2VydmVyTG9va3VwKTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBwcm9wZXJ0aWVzW2ldLl9pbml0aWFsaXplKHZpZXdNb2RlbCwgb2JzZXJ2ZXJMb29rdXAsIGF0dHJpYnV0ZXMsIGhhbmRsZXNCaW5kLCBib3VuZFByb3BlcnRpZXMpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAob3duaW5nVmlldykge1xyXG4gICAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNDcmVhdGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmNyZWF0ZWQob3duaW5nVmlldywgdGhpcy52aWV3KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUuYXV0b21hdGUgPSBmdW5jdGlvbiAob3ZlcnJpZGVDb250ZXh0LCBvd25pbmdWaWV3KSB7XHJcbiAgICAgICAgdGhpcy52aWV3LmJpbmRpbmdDb250ZXh0ID0gdGhpcy52aWV3TW9kZWw7XHJcbiAgICAgICAgdGhpcy52aWV3Lm92ZXJyaWRlQ29udGV4dCA9IG92ZXJyaWRlQ29udGV4dCB8fCBjcmVhdGVPdmVycmlkZUNvbnRleHQodGhpcy52aWV3TW9kZWwpO1xyXG4gICAgICAgIHRoaXMudmlldy5faXNVc2VyQ29udHJvbGxlZCA9IHRydWU7XHJcbiAgICAgICAgaWYgKHRoaXMuYmVoYXZpb3IuaGFuZGxlc0NyZWF0ZWQpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuY3JlYXRlZChvd25pbmdWaWV3IHx8IG51bGwsIHRoaXMudmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYmluZCh0aGlzLnZpZXcpO1xyXG4gICAgfTtcclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoc2NvcGUpIHtcclxuICAgICAgICB2YXIgc2tpcFNlbGZTdWJzY3JpYmVyID0gdGhpcy5iZWhhdmlvci5oYW5kbGVzQmluZDtcclxuICAgICAgICB2YXIgYm91bmRQcm9wZXJ0aWVzID0gdGhpcy5ib3VuZFByb3BlcnRpZXM7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciB4O1xyXG4gICAgICAgIHZhciBvYnNlcnZlcjtcclxuICAgICAgICB2YXIgc2VsZlN1YnNjcmliZXI7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZSA9PT0gc2NvcGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc2NvcGUgPSBzY29wZTtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IGJvdW5kUHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHggPSBib3VuZFByb3BlcnRpZXNbaV07XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0geC5vYnNlcnZlcjtcclxuICAgICAgICAgICAgc2VsZlN1YnNjcmliZXIgPSBvYnNlcnZlci5zZWxmU3Vic2NyaWJlcjtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIucHVibGlzaGluZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgeC5iaW5kaW5nLmJpbmQoc2NvcGUpO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5jYWxsKCk7XHJcbiAgICAgICAgICAgIG9ic2VydmVyLnB1Ymxpc2hpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5zZWxmU3Vic2NyaWJlciA9IHNlbGZTdWJzY3JpYmVyO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKHNraXBTZWxmU3Vic2NyaWJlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy52aWV3LnZpZXdNb2RlbFNjb3BlID0gc2NvcGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMudmlld01vZGVsID09PSBzY29wZS5vdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLmluc3RydWN0aW9uLmluaGVyaXRCaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHRoaXMudmlld01vZGVsLCBzY29wZS5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlT3ZlcnJpZGVDb250ZXh0KHRoaXMudmlld01vZGVsKTtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dC5fX3BhcmVudE92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnZpZXcuYmluZCh0aGlzLnZpZXdNb2RlbCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoc2tpcFNlbGZTdWJzY3JpYmVyKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IHNjb3BlLm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICAgICAgaWYgKHNjb3BlLm92ZXJyaWRlQ29udGV4dC5fX3BhcmVudE92ZXJyaWRlQ29udGV4dCAhPT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICAgICAgICAmJiB0aGlzLnZpZXdNb2RlbC52aWV3RmFjdG9yeSAmJiB0aGlzLnZpZXdNb2RlbC52aWV3RmFjdG9yeS5mYWN0b3J5Q3JlYXRlSW5zdHJ1Y3Rpb24ucGFydFJlcGxhY2VtZW50cykge1xyXG4gICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gT2JqZWN0LmFzc2lnbih7fSwgc2NvcGUub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dC5wYXJlbnRPdmVycmlkZUNvbnRleHQgPSBzY29wZS5vdmVycmlkZUNvbnRleHQuX19wYXJlbnRPdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy52aWV3TW9kZWwuYmluZChzY29wZS5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29udHJvbGxlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgdmFyIGJvdW5kUHJvcGVydGllcyA9IHRoaXMuYm91bmRQcm9wZXJ0aWVzO1xyXG4gICAgICAgICAgICB2YXIgaSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgdmFyIGlpID0gdm9pZCAwO1xyXG4gICAgICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy5zY29wZSA9IG51bGw7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnZpZXcgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzVW5iaW5kKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC51bmJpbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5lbGVtZW50RXZlbnRzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmVsZW1lbnRFdmVudHMuZGlzcG9zZUFsbCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gYm91bmRQcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIGJvdW5kUHJvcGVydGllc1tpXS5iaW5kaW5nLnVuYmluZCgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENvbnRyb2xsZXIucHJvdG90eXBlLmF0dGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQXR0YWNoZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLmJlaGF2aW9yLmhhbmRsZXNBdHRhY2hlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXdNb2RlbC5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldy5hdHRhY2hlZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBDb250cm9sbGVyLnByb3RvdHlwZS5kZXRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICBpZiAodGhpcy52aWV3ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXcuZGV0YWNoZWQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5iZWhhdmlvci5oYW5kbGVzRGV0YWNoZWQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsLmRldGFjaGVkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENvbnRyb2xsZXI7XHJcbn0oKSk7XG5cbnZhciBsYXN0UHJvdmlkZXJJZCA9IDA7XHJcbmZ1bmN0aW9uIG5leHRQcm92aWRlcklkKCkge1xyXG4gICAgcmV0dXJuICsrbGFzdFByb3ZpZGVySWQ7XHJcbn1cclxuZnVuY3Rpb24gZG9Qcm9jZXNzQ29udGVudCgpIHsgcmV0dXJuIHRydWU7IH1cclxuZnVuY3Rpb24gZG9Qcm9jZXNzQXR0cmlidXRlcygpIHsgfVxyXG52YXIgSHRtbEJlaGF2aW9yUmVzb3VyY2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSHRtbEJlaGF2aW9yUmVzb3VyY2UoKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50TmFtZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gbnVsbDtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IHVuZGVmaW5lZDtcclxuICAgICAgICB0aGlzLmxpZnRzQ29udGVudCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0U2hhZG93RE9NID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zaGFkb3dET01PcHRpb25zID0gbnVsbDtcclxuICAgICAgICB0aGlzLnByb2Nlc3NBdHRyaWJ1dGVzID0gZG9Qcm9jZXNzQXR0cmlidXRlcztcclxuICAgICAgICB0aGlzLnByb2Nlc3NDb250ZW50ID0gZG9Qcm9jZXNzQ29udGVudDtcclxuICAgICAgICB0aGlzLnVzZXNTaGFkb3dET00gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNoaWxkQmluZGluZ3MgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaGFzRHluYW1pY09wdGlvbnMgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lcmxlc3MgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnByb3BlcnRpZXMgPSBbXTtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSB7fTtcclxuICAgICAgICB0aGlzLmlzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnByaW1hcnlQcm9wZXJ0eSA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gKG5hbWUsIGV4aXN0aW5nKSB7XHJcbiAgICAgICAgdmFyIGJlaGF2aW9yO1xyXG4gICAgICAgIGlmIChuYW1lLmVuZHNXaXRoKCdDdXN0b21BdHRyaWJ1dGUnKSkge1xyXG4gICAgICAgICAgICBiZWhhdmlvciA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICBiZWhhdmlvci5hdHRyaWJ1dGVOYW1lID0gX2h5cGhlbmF0ZShuYW1lLnN1YnN0cmluZygwLCBuYW1lLmxlbmd0aCAtIDE1KSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuYW1lLmVuZHNXaXRoKCdDdXN0b21FbGVtZW50JykpIHtcclxuICAgICAgICAgICAgYmVoYXZpb3IgPSBleGlzdGluZyB8fCBuZXcgSHRtbEJlaGF2aW9yUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgYmVoYXZpb3IuZWxlbWVudE5hbWUgPSBfaHlwaGVuYXRlKG5hbWUuc3Vic3RyaW5nKDAsIG5hbWUubGVuZ3RoIC0gMTMpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJlaGF2aW9yO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5hZGRDaGlsZEJpbmRpbmcgPSBmdW5jdGlvbiAoYmVoYXZpb3IpIHtcclxuICAgICAgICBpZiAodGhpcy5jaGlsZEJpbmRpbmdzID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2hpbGRCaW5kaW5ncyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNoaWxkQmluZGluZ3MucHVzaChiZWhhdmlvcik7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgcHJvdG8gPSB0YXJnZXQucHJvdG90eXBlO1xyXG4gICAgICAgIHZhciBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVOYW1lID0gdGhpcy5hdHRyaWJ1dGVOYW1lO1xyXG4gICAgICAgIHZhciBhdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgPSB0aGlzLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQ7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNJbml0aWFsaXplZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNJbml0aWFsaXplZCA9IHRydWU7XHJcbiAgICAgICAgdGFyZ2V0Ll9fcHJvdmlkZXJJZF9fID0gbmV4dFByb3ZpZGVySWQoKTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IGNvbnRhaW5lci5nZXQoT2JzZXJ2ZXJMb2NhdG9yKTtcclxuICAgICAgICB0aGlzLnRhc2tRdWV1ZSA9IGNvbnRhaW5lci5nZXQoVGFza1F1ZXVlKTtcclxuICAgICAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcclxuICAgICAgICB0aGlzLnVzZXNTaGFkb3dET00gPSB0aGlzLnRhcmdldFNoYWRvd0RPTSAmJiBGRUFUVVJFLnNoYWRvd0RPTTtcclxuICAgICAgICB0aGlzLmhhbmRsZXNDcmVhdGVkID0gKCdjcmVhdGVkJyBpbiBwcm90byk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVzQmluZCA9ICgnYmluZCcgaW4gcHJvdG8pO1xyXG4gICAgICAgIHRoaXMuaGFuZGxlc1VuYmluZCA9ICgndW5iaW5kJyBpbiBwcm90byk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVzQXR0YWNoZWQgPSAoJ2F0dGFjaGVkJyBpbiBwcm90byk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVzRGV0YWNoZWQgPSAoJ2RldGFjaGVkJyBpbiBwcm90byk7XHJcbiAgICAgICAgdGhpcy5odG1sTmFtZSA9IHRoaXMuZWxlbWVudE5hbWUgfHwgdGhpcy5hdHRyaWJ1dGVOYW1lO1xyXG4gICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGlmIChwcm9wZXJ0aWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgbmV3IEJpbmRhYmxlUHJvcGVydHkoe1xyXG4gICAgICAgICAgICAgICAgICAgIG5hbWU6ICd2YWx1ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlSGFuZGxlcjogJ3ZhbHVlQ2hhbmdlZCcgaW4gcHJvdG8gPyAndmFsdWVDaGFuZ2VkJyA6IG51bGwsXHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlOiBhdHRyaWJ1dGVOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHRCaW5kaW5nTW9kZTogYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlXHJcbiAgICAgICAgICAgICAgICB9KS5yZWdpc3RlcldpdGgodGFyZ2V0LCB0aGlzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyZW50ID0gcHJvcGVydGllc1swXTtcclxuICAgICAgICAgICAgaWYgKHByb3BlcnRpZXMubGVuZ3RoID09PSAxICYmIGN1cnJlbnQubmFtZSA9PT0gJ3ZhbHVlJykge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5pc0R5bmFtaWMgPSBjdXJyZW50Lmhhc09wdGlvbnMgPSB0aGlzLmhhc0R5bmFtaWNPcHRpb25zO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5kZWZpbmVPbih0YXJnZXQsIHRoaXMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzW2ldLmRlZmluZU9uKHRhcmdldCwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHByb3BlcnRpZXNbaV0ucHJpbWFyeVByb3BlcnR5KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnByaW1hcnlQcm9wZXJ0eSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IG9uZSBiaW5kYWJsZSBwcm9wZXJ0eSBvbiBhIGN1c3RvbSBlbGVtZW50IGNhbiBiZSBkZWZpbmVkIGFzIHRoZSBkZWZhdWx0Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wcmltYXJ5UHJvcGVydHkgPSBwcm9wZXJ0aWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGN1cnJlbnQgPSBuZXcgQmluZGFibGVQcm9wZXJ0eSh7XHJcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJ3ZhbHVlJyxcclxuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VIYW5kbGVyOiAndmFsdWVDaGFuZ2VkJyBpbiBwcm90byA/ICd2YWx1ZUNoYW5nZWQnIDogbnVsbCxcclxuICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGU6IGF0dHJpYnV0ZU5hbWUsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdEJpbmRpbmdNb2RlOiBhdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGVcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgY3VycmVudC5oYXNPcHRpb25zID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQucmVnaXN0ZXJXaXRoKHRhcmdldCwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gcHJvcGVydGllcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBwcm9wZXJ0aWVzW2ldLmRlZmluZU9uKHRhcmdldCwgdGhpcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5fY29weUluaGVyaXRlZFByb3BlcnRpZXMoY29udGFpbmVyLCB0YXJnZXQpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmF0dHJpYnV0ZU5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJBdHRyaWJ1dGUobmFtZSB8fCB0aGlzLmF0dHJpYnV0ZU5hbWUsIHRoaXMsIHRoaXMuYXR0cmlidXRlTmFtZSk7XHJcbiAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMuYWxpYXNlcykpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWxpYXNlc1xyXG4gICAgICAgICAgICAgICAgICAgIC5mb3JFYWNoKGZ1bmN0aW9uIChhbGlhcykge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyQXR0cmlidXRlKGFsaWFzLCBfdGhpcywgX3RoaXMuYXR0cmlidXRlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZWdpc3RyeS5yZWdpc3RlckVsZW1lbnQobmFtZSB8fCB0aGlzLmVsZW1lbnROYW1lLCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmFsaWFzZXMgPSBmdW5jdGlvbiAoYWxpYXNlcykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH07XHJcbiAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCwgbG9hZENvbnRleHQsIHZpZXdTdHJhdGVneSwgdHJhbnNpZW50Vmlldykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIG9wdGlvbnM7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdmlld1N0cmF0ZWd5ID0gY29udGFpbmVyLmdldChWaWV3TG9jYXRvcikuZ2V0Vmlld1N0cmF0ZWd5KHZpZXdTdHJhdGVneSB8fCB0aGlzLnZpZXdTdHJhdGVneSB8fCB0YXJnZXQpO1xyXG4gICAgICAgICAgICBvcHRpb25zID0gbmV3IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24odGhpcy50YXJnZXRTaGFkb3dET00sIHRydWUpO1xyXG4gICAgICAgICAgICBpZiAoIXZpZXdTdHJhdGVneS5tb2R1bGVJZCkge1xyXG4gICAgICAgICAgICAgICAgdmlld1N0cmF0ZWd5Lm1vZHVsZUlkID0gT3JpZ2luLmdldCh0YXJnZXQpLm1vZHVsZUlkO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB2aWV3U3RyYXRlZ3lcclxuICAgICAgICAgICAgICAgIC5sb2FkVmlld0ZhY3RvcnkoY29udGFpbmVyLmdldChWaWV3RW5naW5lKSwgb3B0aW9ucywgbG9hZENvbnRleHQsIHRhcmdldClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKCF0cmFuc2llbnRWaWV3IHx8ICFfdGhpcy52aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5jb21waWxlID0gZnVuY3Rpb24gKGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uLCBwYXJlbnROb2RlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGlmdHNDb250ZW50KSB7XHJcbiAgICAgICAgICAgIGlmICghaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IERPTS5jcmVhdGVFbGVtZW50KCd0ZW1wbGF0ZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gRE9NLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcclxuICAgICAgICAgICAgICAgIHZhciBjYWNoZVNpemUgPSBub2RlLmdldEF0dHJpYnV0ZSgndmlldy1jYWNoZScpO1xyXG4gICAgICAgICAgICAgICAgdmFyIHBhcnQgPSBub2RlLmdldEF0dHJpYnV0ZSgncGFydCcpO1xyXG4gICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoaW5zdHJ1Y3Rpb24ub3JpZ2luYWxBdHRyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICBET00ucmVwbGFjZU5vZGUodGVtcGxhdGUsIG5vZGUsIHBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQuYXBwZW5kQ2hpbGQobm9kZSk7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSA9IGNvbXBpbGVyLmNvbXBpbGUoZnJhZ21lbnQsIHJlc291cmNlcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnZpZXdGYWN0b3J5LnBhcnQgPSBwYXJ0O1xyXG4gICAgICAgICAgICAgICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKCdwYXJ0Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoY2FjaGVTaXplKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld0ZhY3Rvcnkuc2V0Q2FjaGVTaXplKGNhY2hlU2l6ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoJ3ZpZXctY2FjaGUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIG5vZGUgPSB0ZW1wbGF0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0aGlzLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHZhciBwYXJ0UmVwbGFjZW1lbnRzID0ge307XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnByb2Nlc3NDb250ZW50KGNvbXBpbGVyLCByZXNvdXJjZXMsIG5vZGUsIGluc3RydWN0aW9uKSAmJiBub2RlLmhhc0NoaWxkTm9kZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGN1cnJlbnRDaGlsZCA9IG5vZGUuZmlyc3RDaGlsZDtcclxuICAgICAgICAgICAgICAgIHZhciBjb250ZW50RWxlbWVudCA9IHRoaXMudXNlc1NoYWRvd0RPTSA/IG51bGwgOiBET00uY3JlYXRlRWxlbWVudCgnYXUtY29udGVudCcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG5leHRTaWJsaW5nID0gdm9pZCAwO1xyXG4gICAgICAgICAgICAgICAgdmFyIHRvUmVwbGFjZSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgICAgIHdoaWxlIChjdXJyZW50Q2hpbGQpIHtcclxuICAgICAgICAgICAgICAgICAgICBuZXh0U2libGluZyA9IGN1cnJlbnRDaGlsZC5uZXh0U2libGluZztcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudENoaWxkLnRhZ05hbWUgPT09ICdURU1QTEFURScgJiYgKHRvUmVwbGFjZSA9IGN1cnJlbnRDaGlsZC5nZXRBdHRyaWJ1dGUoJ3JlcGxhY2UtcGFydCcpKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJ0UmVwbGFjZW1lbnRzW3RvUmVwbGFjZV0gPSBjb21waWxlci5jb21waWxlKGN1cnJlbnRDaGlsZCwgcmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgRE9NLnJlbW92ZU5vZGUoY3VycmVudENoaWxkLCBwYXJlbnROb2RlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24ucGFydFJlcGxhY2VtZW50cyA9IHBhcnRSZXBsYWNlbWVudHM7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbnRlbnRFbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2hpbGQubm9kZVR5cGUgPT09IDMgJiYgX2lzQWxsV2hpdGVzcGFjZShjdXJyZW50Q2hpbGQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBET00ucmVtb3ZlTm9kZShjdXJyZW50Q2hpbGQsIHBhcmVudE5vZGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudEVsZW1lbnQuYXBwZW5kQ2hpbGQoY3VycmVudENoaWxkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2hpbGQgPSBuZXh0U2libGluZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjb250ZW50RWxlbWVudCAhPT0gbnVsbCAmJiBjb250ZW50RWxlbWVudC5oYXNDaGlsZE5vZGVzKCkpIHtcclxuICAgICAgICAgICAgICAgICAgICBub2RlLmFwcGVuZENoaWxkKGNvbnRlbnRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGluc3RydWN0aW9uLnNraXBDb250ZW50UHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICghdGhpcy5wcm9jZXNzQ29udGVudChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikpIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uc2tpcENvbnRlbnRQcm9jZXNzaW5nID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5vZGU7XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uIChjb250YWluZXIsIGluc3RydWN0aW9uLCBlbGVtZW50LCBiaW5kaW5ncykge1xyXG4gICAgICAgIHZhciB2aWV3SG9zdDtcclxuICAgICAgICB2YXIgYXUgPSBudWxsO1xyXG4gICAgICAgIGluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5ub3JtYWw7XHJcbiAgICAgICAgZWxlbWVudCA9IGVsZW1lbnQgfHwgbnVsbDtcclxuICAgICAgICBiaW5kaW5ncyA9IGJpbmRpbmdzIHx8IG51bGw7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwgJiYgZWxlbWVudCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy51c2VzU2hhZG93RE9NKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3SG9zdCA9IGVsZW1lbnQuYXR0YWNoU2hhZG93KHRoaXMuc2hhZG93RE9NT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uYm91bmRhcnksIHZpZXdIb3N0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZpZXdIb3N0ID0gZWxlbWVudDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFNoYWRvd0RPTSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5ib3VuZGFyeSwgdmlld0hvc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChlbGVtZW50ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXUgPSBhdSA9IGVsZW1lbnQuYXUgfHwge307XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB2aWV3TW9kZWwgPSBpbnN0cnVjdGlvbi52aWV3TW9kZWwgfHwgY29udGFpbmVyLmdldCh0aGlzLnRhcmdldCk7XHJcbiAgICAgICAgdmFyIGNvbnRyb2xsZXIgPSBuZXcgQ29udHJvbGxlcih0aGlzLCBpbnN0cnVjdGlvbiwgdmlld01vZGVsLCBjb250YWluZXIpO1xyXG4gICAgICAgIHZhciBjaGlsZEJpbmRpbmdzID0gdGhpcy5jaGlsZEJpbmRpbmdzO1xyXG4gICAgICAgIHZhciB2aWV3RmFjdG9yeTtcclxuICAgICAgICBpZiAodGhpcy5saWZ0c0NvbnRlbnQpIHtcclxuICAgICAgICAgICAgYXUuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZWxlbWVudE5hbWUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgdmlld0ZhY3RvcnkgPSBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSB8fCB0aGlzLnZpZXdGYWN0b3J5O1xyXG4gICAgICAgICAgICBjb250YWluZXIudmlld01vZGVsID0gdmlld01vZGVsO1xyXG4gICAgICAgICAgICBpZiAodmlld0ZhY3RvcnkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldyA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250YWluZXIsIGluc3RydWN0aW9uLCBlbGVtZW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZWxlbWVudCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgYXUuY29udHJvbGxlciA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgICAgICBpZiAoY29udHJvbGxlci52aWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0aGlzLnVzZXNTaGFkb3dET00gJiYgKGVsZW1lbnQuY2hpbGROb2Rlcy5sZW5ndGggPT09IDEgfHwgZWxlbWVudC5jb250ZW50RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvbnRlbnRFbGVtZW50ID0gZWxlbWVudC5jaGlsZE5vZGVzWzBdIHx8IGVsZW1lbnQuY29udGVudEVsZW1lbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250ZW50VmlldyA9IHsgZnJhZ21lbnQ6IGNvbnRlbnRFbGVtZW50IH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnRFbGVtZW50LnBhcmVudE5vZGUgJiYgRE9NLnJlbW92ZU5vZGUoY29udGVudEVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24uYW5jaG9ySXNDb250YWluZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hZGRCaW5kaW5nKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGVsZW1lbnQsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hcHBlbmROb2Rlc1RvKHZpZXdIb3N0KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5pbnNlcnROb2Rlc0JlZm9yZSh2aWV3SG9zdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY2hpbGRCaW5kaW5ncyAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkQmluZGluZ3MubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGVsZW1lbnQsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjb250cm9sbGVyLnZpZXcpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5jb250cm9sbGVyID0gY29udHJvbGxlcjtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRCaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5hZGRCaW5kaW5nKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGluc3RydWN0aW9uLmhvc3QsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjaGlsZEJpbmRpbmdzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBjaGlsZEJpbmRpbmdzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGluc3RydWN0aW9uLmhvc3QsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGNoaWxkQmluZGluZ3MgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gY2hpbGRCaW5kaW5ncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGNoaWxkQmluZGluZ3NbaV0uY3JlYXRlKGVsZW1lbnQsIHZpZXdNb2RlbCwgY29udHJvbGxlcikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhdSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBhdVt0aGlzLmh0bWxOYW1lXSA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbnN0cnVjdGlvbi5pbml0aWF0ZWRCeUJlaGF2aW9yICYmIHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIudmlldy5jcmVhdGVkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjb250cm9sbGVyO1xyXG4gICAgfTtcclxuICAgIEh0bWxCZWhhdmlvclJlc291cmNlLnByb3RvdHlwZS5fZW5zdXJlUHJvcGVydGllc0RlZmluZWQgPSBmdW5jdGlvbiAoaW5zdGFuY2UsIGxvb2t1cCkge1xyXG4gICAgICAgIHZhciBwcm9wZXJ0aWVzO1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXI7XHJcbiAgICAgICAgaWYgKCdfX3Byb3BlcnRpZXNEZWZpbmVkX18nIGluIGxvb2t1cCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxvb2t1cC5fX3Byb3BlcnRpZXNEZWZpbmVkX18gPSB0cnVlO1xyXG4gICAgICAgIHByb3BlcnRpZXMgPSB0aGlzLnByb3BlcnRpZXM7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBwcm9wZXJ0aWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgb2JzZXJ2ZXIgPSBwcm9wZXJ0aWVzW2ldLmNyZWF0ZU9ic2VydmVyKGluc3RhbmNlKTtcclxuICAgICAgICAgICAgaWYgKG9ic2VydmVyICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGxvb2t1cFtvYnNlcnZlci5wcm9wZXJ0eU5hbWVdID0gb2JzZXJ2ZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSHRtbEJlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLl9jb3B5SW5oZXJpdGVkUHJvcGVydGllcyA9IGZ1bmN0aW9uIChjb250YWluZXIsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBiZWhhdmlvcjtcclxuICAgICAgICB2YXIgZGVyaXZlZCA9IHRhcmdldDtcclxuICAgICAgICB3aGlsZSAodHJ1ZSkge1xyXG4gICAgICAgICAgICB2YXIgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGFyZ2V0LnByb3RvdHlwZSk7XHJcbiAgICAgICAgICAgIHRhcmdldCA9IHByb3RvICYmIHByb3RvLmNvbnN0cnVjdG9yO1xyXG4gICAgICAgICAgICBpZiAoIXRhcmdldCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJlaGF2aW9yID0gbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLnJlc291cmNlLCB0YXJnZXQpO1xyXG4gICAgICAgICAgICBpZiAoYmVoYXZpb3IpIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJlaGF2aW9yLmluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpO1xyXG4gICAgICAgIHZhciBfbG9vcF8xID0gZnVuY3Rpb24gKGksIGlpKSB7XHJcbiAgICAgICAgICAgIHZhciBwcm9wID0gYmVoYXZpb3IucHJvcGVydGllc1tpXTtcclxuICAgICAgICAgICAgaWYgKHRoaXNfMS5wcm9wZXJ0aWVzLnNvbWUoZnVuY3Rpb24gKHApIHsgcmV0dXJuIHAubmFtZSA9PT0gcHJvcC5uYW1lOyB9KSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiY29udGludWVcIjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuZXcgQmluZGFibGVQcm9wZXJ0eShwcm9wKS5yZWdpc3RlcldpdGgoZGVyaXZlZCwgdGhpc18xKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZhciB0aGlzXzEgPSB0aGlzO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGJlaGF2aW9yLnByb3BlcnRpZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBfbG9vcF8xKGkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gSHRtbEJlaGF2aW9yUmVzb3VyY2U7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyKGxvb2t1cCwgbmFtZSwgcmVzb3VyY2UsIHR5cGUpIHtcclxuICAgIGlmICghbmFtZSkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIHZhciBleGlzdGluZyA9IGxvb2t1cFtuYW1lXTtcclxuICAgIGlmIChleGlzdGluZykge1xyXG4gICAgICAgIGlmIChleGlzdGluZyAhPT0gcmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIHJlZ2lzdGVyIFwiLmNvbmNhdCh0eXBlLCBcIiB3aGVuIG9uZSB3aXRoIHRoZSBzYW1lIG5hbWUgYWxyZWFkeSBleGlzdHMuIE5hbWU6IFwiKS5jb25jYXQobmFtZSwgXCIuXCIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbG9va3VwW25hbWVdID0gcmVzb3VyY2U7XHJcbn1cclxuZnVuY3Rpb24gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZSwgdHlwZSkge1xyXG4gICAgaWYgKC9bQS1aXS8udGVzdChuYW1lKSkge1xyXG4gICAgICAgIHZhciBuZXdOYW1lID0gX2h5cGhlbmF0ZShuYW1lKTtcclxuICAgICAgICBMb2dNYW5hZ2VyXHJcbiAgICAgICAgICAgIC5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKVxyXG4gICAgICAgICAgICAud2FybihcIidcIi5jb25jYXQobmFtZSwgXCInIGlzIG5vdCBhIHZhbGlkIFwiKS5jb25jYXQodHlwZSwgXCIgbmFtZSBhbmQgaGFzIGJlZW4gY29udmVydGVkIHRvICdcIikuY29uY2F0KG5ld05hbWUsIFwiJy4gVXBwZXItY2FzZSBsZXR0ZXJzIGFyZSBub3QgYWxsb3dlZCBiZWNhdXNlIHRoZSBET00gaXMgbm90IGNhc2Utc2Vuc2l0aXZlLlwiKSk7XHJcbiAgICAgICAgcmV0dXJuIG5ld05hbWU7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gbmFtZTtcclxufVxyXG52YXIgY29udmVudGlvbk1hcmsgPSAnX19hdV9yZXNvdXJjZV9fJztcclxudmFyIFZpZXdSZXNvdXJjZXMgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVmlld1Jlc291cmNlcyhwYXJlbnQsIHZpZXdVcmwpIHtcclxuICAgICAgICB0aGlzLmJpbmRpbmdMYW5ndWFnZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQgfHwgbnVsbDtcclxuICAgICAgICB0aGlzLmhhc1BhcmVudCA9IHRoaXMucGFyZW50ICE9PSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlld1VybCA9IHZpZXdVcmwgfHwgJyc7XHJcbiAgICAgICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSB7XHJcbiAgICAgICAgICAgIHZhbHVlQ29udmVydGVyczogdGhpcy5nZXRWYWx1ZUNvbnZlcnRlci5iaW5kKHRoaXMpLFxyXG4gICAgICAgICAgICBiaW5kaW5nQmVoYXZpb3JzOiB0aGlzLmdldEJpbmRpbmdCZWhhdmlvci5iaW5kKHRoaXMpXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudHMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMudmFsdWVDb252ZXJ0ZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLmJpbmRpbmdCZWhhdmlvcnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgICAgICB0aGlzLnZhbHVlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5iZWZvcmVDb21waWxlID0gdGhpcy5hZnRlckNvbXBpbGUgPSB0aGlzLmJlZm9yZUNyZWF0ZSA9IHRoaXMuYWZ0ZXJDcmVhdGUgPSB0aGlzLmJlZm9yZUJpbmQgPSB0aGlzLmJlZm9yZVVuYmluZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgVmlld1Jlc291cmNlcy5jb252ZW50aW9uID0gZnVuY3Rpb24gKHRhcmdldCwgZXhpc3RpbmcpIHtcclxuICAgICAgICB2YXIgcmVzb3VyY2U7XHJcbiAgICAgICAgaWYgKGV4aXN0aW5nICYmIGNvbnZlbnRpb25NYXJrIGluIGV4aXN0aW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBleGlzdGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCckcmVzb3VyY2UnIGluIHRhcmdldCkge1xyXG4gICAgICAgICAgICB2YXIgY29uZmlnID0gdGFyZ2V0LiRyZXNvdXJjZTtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25maWcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZSA9IGV4aXN0aW5nIHx8IG5ldyBIdG1sQmVoYXZpb3JSZXNvdXJjZSgpO1xyXG4gICAgICAgICAgICAgICAgcmVzb3VyY2VbY29udmVudGlvbk1hcmtdID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIGlmICghcmVzb3VyY2UuZWxlbWVudE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZS5lbGVtZW50TmFtZSA9IHZhbGlkYXRlQmVoYXZpb3JOYW1lKGNvbmZpZywgJ2N1c3RvbSBlbGVtZW50Jyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZyA9IGNvbmZpZy5jYWxsKHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbmZpZyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcgPSB7IG5hbWU6IGNvbmZpZyB9O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcclxuICAgICAgICAgICAgICAgIHZhciByZXNvdXJjZVR5cGUgPSBjb25maWcudHlwZSB8fCAnZWxlbWVudCc7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmFtZV8xID0gY29uZmlnLm5hbWU7XHJcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKHJlc291cmNlVHlwZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2VsZW1lbnQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2F0dHJpYnV0ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gZXhpc3RpbmcgfHwgbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlW2NvbnZlbnRpb25NYXJrXSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNvdXJjZVR5cGUgPT09ICdlbGVtZW50Jykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNvdXJjZS5lbGVtZW50TmFtZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlLmVsZW1lbnROYW1lID0gbmFtZV8xXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gdmFsaWRhdGVCZWhhdmlvck5hbWUobmFtZV8xLCAnY3VzdG9tIGVsZW1lbnQnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF9oeXBoZW5hdGUodGFyZ2V0Lm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNvdXJjZS5hdHRyaWJ1dGVOYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UuYXR0cmlidXRlTmFtZSA9IG5hbWVfMVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IHZhbGlkYXRlQmVoYXZpb3JOYW1lKG5hbWVfMSwgJ2N1c3RvbSBhdHRyaWJ1dGUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IF9oeXBoZW5hdGUodGFyZ2V0Lm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgndGVtcGxhdGVDb250cm9sbGVyJyBpbiBjb25maWcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZy5saWZ0c0NvbnRlbnQgPSBjb25maWcudGVtcGxhdGVDb250cm9sbGVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsZXRlIGNvbmZpZy50ZW1wbGF0ZUNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCdkZWZhdWx0QmluZGluZ01vZGUnIGluIGNvbmZpZyAmJiByZXNvdXJjZS5hdHRyaWJ1dGVEZWZhdWx0QmluZGluZ01vZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmF0dHJpYnV0ZURlZmF1bHRCaW5kaW5nTW9kZSA9IGNvbmZpZy5kZWZhdWx0QmluZGluZ01vZGU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxldGUgY29uZmlnLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ocmVzb3VyY2UsIGNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ3ZhbHVlQ29udmVydGVyJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBuZXcgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZShjYW1lbENhc2UobmFtZV8xIHx8IHRhcmdldC5uYW1lKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ2JpbmRpbmdCZWhhdmlvcic6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc291cmNlID0gbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKGNhbWVsQ2FzZShuYW1lXzEgfHwgdGFyZ2V0Lm5hbWUpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAndmlld0VuZ2luZUhvb2tzJzpcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSBuZXcgVmlld0VuZ2luZUhvb2tzUmVzb3VyY2UoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc291cmNlIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBiaW5kYWJsZXMgPSB0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJyA/IHVuZGVmaW5lZCA6IGNvbmZpZy5iaW5kYWJsZXM7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFByb3BzID0gcmVzb3VyY2UucHJvcGVydGllcztcclxuICAgICAgICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KGJpbmRhYmxlcykpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBiaW5kYWJsZXMubGVuZ3RoOyBpaSA+IGk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJvcCA9IGJpbmRhYmxlc1tpXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFwcm9wIHx8ICh0eXBlb2YgcHJvcCAhPT0gJ3N0cmluZycgJiYgIXByb3AubmFtZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgYmluZGFibGUgcHJvcGVydHkgYXQgXFxcIlwiLmNvbmNhdChpLCBcIlxcXCIgZm9yIGNsYXNzIFxcXCJcIikuY29uY2F0KHRhcmdldC5uYW1lLCBcIlxcXCIuIEV4cGVjdGVkIGVpdGhlciBhIHN0cmluZyBvciBhbiBvYmplY3Qgd2l0aCBcXFwibmFtZVxcXCIgcHJvcGVydHkuXCIpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbmV3UHJvcCA9IG5ldyBCaW5kYWJsZVByb3BlcnR5KHByb3ApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXhpc3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMCwgamogPSBjdXJyZW50UHJvcHMubGVuZ3RoOyBqaiA+IGo7ICsraikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRQcm9wc1tqXS5uYW1lID09PSBuZXdQcm9wLm5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGlzdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3RlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3UHJvcC5yZWdpc3RlcldpdGgodGFyZ2V0LCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByZXNvdXJjZTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5fdHJ5QWRkSG9vayA9IGZ1bmN0aW9uIChvYmosIG5hbWUpIHtcclxuICAgICAgICBpZiAodHlwZW9mIG9ialtuYW1lXSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICB2YXIgZnVuYyA9IG9ialtuYW1lXS5iaW5kKG9iaik7XHJcbiAgICAgICAgICAgIHZhciBjb3VudGVyID0gMTtcclxuICAgICAgICAgICAgdmFyIGNhbGxiYWNrTmFtZSA9IHZvaWQgMDtcclxuICAgICAgICAgICAgd2hpbGUgKHRoaXNbY2FsbGJhY2tOYW1lID0gbmFtZSArIGNvdW50ZXIudG9TdHJpbmcoKV0gIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgY291bnRlcisrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXNbbmFtZV0gPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzW2NhbGxiYWNrTmFtZV0gPSBmdW5jO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5faW52b2tlSG9vayA9IGZ1bmN0aW9uIChuYW1lLCBvbmUsIHR3bywgdGhyZWUsIGZvdXIpIHtcclxuICAgICAgICBpZiAodGhpcy5oYXNQYXJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnQuX2ludm9rZUhvb2sobmFtZSwgb25lLCB0d28sIHRocmVlLCBmb3VyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXNbbmFtZV0pIHtcclxuICAgICAgICAgICAgdGhpc1tuYW1lICsgJzEnXShvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xyXG4gICAgICAgICAgICB2YXIgY2FsbGJhY2tOYW1lID0gbmFtZSArICcyJztcclxuICAgICAgICAgICAgaWYgKHRoaXNbY2FsbGJhY2tOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG9uZSwgdHdvLCB0aHJlZSwgZm91cik7XHJcbiAgICAgICAgICAgICAgICBjYWxsYmFja05hbWUgPSBuYW1lICsgJzMnO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXNbY2FsbGJhY2tOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXShvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudGVyID0gNDtcclxuICAgICAgICAgICAgICAgICAgICB3aGlsZSAodGhpc1tjYWxsYmFja05hbWUgPSBuYW1lICsgY291bnRlci50b1N0cmluZygpXSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXNbY2FsbGJhY2tOYW1lXShvbmUsIHR3bywgdGhyZWUsIGZvdXIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3VudGVyKys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyVmlld0VuZ2luZUhvb2tzID0gZnVuY3Rpb24gKGhvb2tzKSB7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2JlZm9yZUNvbXBpbGUnKTtcclxuICAgICAgICB0aGlzLl90cnlBZGRIb29rKGhvb2tzLCAnYWZ0ZXJDb21waWxlJyk7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2JlZm9yZUNyZWF0ZScpO1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdhZnRlckNyZWF0ZScpO1xyXG4gICAgICAgIHRoaXMuX3RyeUFkZEhvb2soaG9va3MsICdiZWZvcmVCaW5kJyk7XHJcbiAgICAgICAgdGhpcy5fdHJ5QWRkSG9vayhob29rcywgJ2JlZm9yZVVuYmluZCcpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLmdldEJpbmRpbmdMYW5ndWFnZSA9IGZ1bmN0aW9uIChiaW5kaW5nTGFuZ3VhZ2VGYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdMYW5ndWFnZSB8fCAodGhpcy5iaW5kaW5nTGFuZ3VhZ2UgPSBiaW5kaW5nTGFuZ3VhZ2VGYWxsYmFjayk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucGF0Y2hJblBhcmVudCA9IGZ1bmN0aW9uIChuZXdQYXJlbnQpIHtcclxuICAgICAgICB2YXIgb3JpZ2luYWxQYXJlbnQgPSB0aGlzLnBhcmVudDtcclxuICAgICAgICB0aGlzLnBhcmVudCA9IG5ld1BhcmVudCB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuaGFzUGFyZW50ID0gdGhpcy5wYXJlbnQgIT09IG51bGw7XHJcbiAgICAgICAgaWYgKG5ld1BhcmVudC5wYXJlbnQgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgbmV3UGFyZW50LnBhcmVudCA9IG9yaWdpbmFsUGFyZW50O1xyXG4gICAgICAgICAgICBuZXdQYXJlbnQuaGFzUGFyZW50ID0gb3JpZ2luYWxQYXJlbnQgIT09IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlbGF0aXZlVG9WaWV3ID0gZnVuY3Rpb24gKHBhdGgpIHtcclxuICAgICAgICByZXR1cm4gcmVsYXRpdmVUb0ZpbGUocGF0aCwgdGhpcy52aWV3VXJsKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5yZWdpc3RlckVsZW1lbnQgPSBmdW5jdGlvbiAodGFnTmFtZSwgYmVoYXZpb3IpIHtcclxuICAgICAgICByZWdpc3Rlcih0aGlzLmVsZW1lbnRzLCB0YWdOYW1lLCBiZWhhdmlvciwgJ2FuIEVsZW1lbnQnKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRFbGVtZW50ID0gZnVuY3Rpb24gKHRhZ05hbWUpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5lbGVtZW50c1t0YWdOYW1lXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRFbGVtZW50KHRhZ05hbWUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUubWFwQXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZU1hcFthdHRyaWJ1dGVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50Lm1hcEF0dHJpYnV0ZShhdHRyaWJ1dGUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJBdHRyaWJ1dGUgPSBmdW5jdGlvbiAoYXR0cmlidXRlLCBiZWhhdmlvciwga25vd25BdHRyaWJ1dGUpIHtcclxuICAgICAgICB0aGlzLmF0dHJpYnV0ZU1hcFthdHRyaWJ1dGVdID0ga25vd25BdHRyaWJ1dGU7XHJcbiAgICAgICAgcmVnaXN0ZXIodGhpcy5hdHRyaWJ1dGVzLCBhdHRyaWJ1dGUsIGJlaGF2aW9yLCAnYW4gQXR0cmlidXRlJyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0QXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJpYnV0ZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmF0dHJpYnV0ZXNbYXR0cmlidXRlXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyVmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiAobmFtZSwgdmFsdWVDb252ZXJ0ZXIpIHtcclxuICAgICAgICByZWdpc3Rlcih0aGlzLnZhbHVlQ29udmVydGVycywgbmFtZSwgdmFsdWVDb252ZXJ0ZXIsICdhIFZhbHVlQ29udmVydGVyJyk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuZ2V0VmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlQ29udmVydGVyc1tuYW1lXSB8fCAodGhpcy5oYXNQYXJlbnQgPyB0aGlzLnBhcmVudC5nZXRWYWx1ZUNvbnZlcnRlcihuYW1lKSA6IG51bGwpO1xyXG4gICAgfTtcclxuICAgIFZpZXdSZXNvdXJjZXMucHJvdG90eXBlLnJlZ2lzdGVyQmluZGluZ0JlaGF2aW9yID0gZnVuY3Rpb24gKG5hbWUsIGJpbmRpbmdCZWhhdmlvcikge1xyXG4gICAgICAgIHJlZ2lzdGVyKHRoaXMuYmluZGluZ0JlaGF2aW9ycywgbmFtZSwgYmluZGluZ0JlaGF2aW9yLCAnYSBCaW5kaW5nQmVoYXZpb3InKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiAobmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmJpbmRpbmdCZWhhdmlvcnNbbmFtZV0gfHwgKHRoaXMuaGFzUGFyZW50ID8gdGhpcy5wYXJlbnQuZ2V0QmluZGluZ0JlaGF2aW9yKG5hbWUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUucmVnaXN0ZXJWYWx1ZSA9IGZ1bmN0aW9uIChuYW1lLCB2YWx1ZSkge1xyXG4gICAgICAgIHJlZ2lzdGVyKHRoaXMudmFsdWVzLCBuYW1lLCB2YWx1ZSwgJ2EgdmFsdWUnKTtcclxuICAgIH07XHJcbiAgICBWaWV3UmVzb3VyY2VzLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVzW25hbWVdIHx8ICh0aGlzLmhhc1BhcmVudCA/IHRoaXMucGFyZW50LmdldFZhbHVlKG5hbWUpIDogbnVsbCk7XHJcbiAgICB9O1xyXG4gICAgVmlld1Jlc291cmNlcy5wcm90b3R5cGUuYXV0b1JlZ2lzdGVyID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgaW1wbCkge1xyXG4gICAgICAgIHZhciByZXNvdXJjZVR5cGVNZXRhID0gbWV0YWRhdGEuZ2V0T3duKG1ldGFkYXRhLnJlc291cmNlLCBpbXBsKTtcclxuICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSkge1xyXG4gICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YSBpbnN0YW5jZW9mIEh0bWxCZWhhdmlvclJlc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICBWaWV3UmVzb3VyY2VzLmNvbnZlbnRpb24oaW1wbCwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSwgcmVzb3VyY2VUeXBlTWV0YSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VUeXBlTWV0YS5hdHRyaWJ1dGVOYW1lID09PSBudWxsICYmIHJlc291cmNlVHlwZU1ldGEuZWxlbWVudE5hbWUgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShpbXBsLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gVmlld1Jlc291cmNlcy5jb252ZW50aW9uKGltcGwpXHJcbiAgICAgICAgICAgICAgICB8fCBIdG1sQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSlcclxuICAgICAgICAgICAgICAgIHx8IFZhbHVlQ29udmVydGVyUmVzb3VyY2UuY29udmVudGlvbihpbXBsLm5hbWUpXHJcbiAgICAgICAgICAgICAgICB8fCBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5jb252ZW50aW9uKGltcGwubmFtZSlcclxuICAgICAgICAgICAgICAgIHx8IFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLmNvbnZlbnRpb24oaW1wbC5uYW1lKTtcclxuICAgICAgICAgICAgaWYgKCFyZXNvdXJjZVR5cGVNZXRhKSB7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhID0gbmV3IEh0bWxCZWhhdmlvclJlc291cmNlKCk7XHJcbiAgICAgICAgICAgICAgICByZXNvdXJjZVR5cGVNZXRhLmVsZW1lbnROYW1lID0gX2h5cGhlbmF0ZShpbXBsLm5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgcmVzb3VyY2VUeXBlTWV0YSwgaW1wbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlc291cmNlVHlwZU1ldGEuaW5pdGlhbGl6ZShjb250YWluZXIsIGltcGwpO1xyXG4gICAgICAgIHJlc291cmNlVHlwZU1ldGEucmVnaXN0ZXIodGhpcywgdW5kZWZpbmVkKTtcclxuICAgICAgICByZXR1cm4gcmVzb3VyY2VUeXBlTWV0YTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gVmlld1Jlc291cmNlcztcclxufSgpKTtcblxudmFyIHZpZXdTdHJhdGVneSA9IHByb3RvY29sLmNyZWF0ZSgnYXVyZWxpYTp2aWV3LXN0cmF0ZWd5Jywge1xyXG4gICAgdmFsaWRhdGU6IGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBpZiAoISh0eXBlb2YgdGFyZ2V0LmxvYWRWaWV3RmFjdG9yeSA9PT0gJ2Z1bmN0aW9uJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuICdWaWV3IHN0cmF0ZWdpZXMgbXVzdCBpbXBsZW1lbnQ6IGxvYWRWaWV3RmFjdG9yeSh2aWV3RW5naW5lOiBWaWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb246IFZpZXdDb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0PzogUmVzb3VyY2VMb2FkQ29udGV4dCk6IFByb21pc2U8Vmlld0ZhY3Rvcnk+JztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9LFxyXG4gICAgY29tcG9zZTogZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIGlmICghKHR5cGVvZiB0YXJnZXQubWFrZVJlbGF0aXZlVG8gPT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgICAgICAgIHRhcmdldC5tYWtlUmVsYXRpdmVUbyA9IFBMQVRGT1JNLm5vb3A7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTtcclxudmFyIFJlbGF0aXZlVmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJlbGF0aXZlVmlld1N0cmF0ZWd5KHBhdGgpIHtcclxuICAgICAgICB0aGlzLnBhdGggPSBwYXRoO1xyXG4gICAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gbnVsbDtcclxuICAgIH1cclxuICAgIFJlbGF0aXZlVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWJzb2x1dGVQYXRoID09PSBudWxsICYmIHRoaXMubW9kdWxlSWQpIHtcclxuICAgICAgICAgICAgdGhpcy5hYnNvbHV0ZVBhdGggPSByZWxhdGl2ZVRvRmlsZSh0aGlzLnBhdGgsIHRoaXMubW9kdWxlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkodGhpcy5hYnNvbHV0ZVBhdGggfHwgdGhpcy5wYXRoLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIFJlbGF0aXZlVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5tYWtlUmVsYXRpdmVUbyA9IGZ1bmN0aW9uIChmaWxlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuYWJzb2x1dGVQYXRoID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWJzb2x1dGVQYXRoID0gcmVsYXRpdmVUb0ZpbGUodGhpcy5wYXRoLCBmaWxlKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmVsYXRpdmVWaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgUmVsYXRpdmVWaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIFJlbGF0aXZlVmlld1N0cmF0ZWd5O1xyXG59KCkpO1xyXG52YXIgQ29udmVudGlvbmFsVmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSh2aWV3TG9jYXRvciwgb3JpZ2luKSB7XHJcbiAgICAgICAgdGhpcy5tb2R1bGVJZCA9IG9yaWdpbi5tb2R1bGVJZDtcclxuICAgICAgICB0aGlzLnZpZXdVcmwgPSB2aWV3TG9jYXRvci5jb252ZXJ0T3JpZ2luVG9WaWV3VXJsKG9yaWdpbik7XHJcbiAgICB9XHJcbiAgICBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkodGhpcy52aWV3VXJsLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpO1xyXG4gICAgfTtcclxuICAgIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBDb252ZW50aW9uYWxWaWV3U3RyYXRlZ3kpO1xyXG4gICAgcmV0dXJuIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneTtcclxufSgpKTtcclxudmFyIE5vVmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE5vVmlld1N0cmF0ZWd5KGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcyB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwgPSBkZXBlbmRlbmN5QmFzZVVybCB8fCAnJztcclxuICAgIH1cclxuICAgIE5vVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGVudHJ5ID0gdGhpcy5lbnRyeTtcclxuICAgICAgICB2YXIgZGVwZW5kZW5jaWVzID0gdGhpcy5kZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5LmZhY3RvcnlJc1JlYWR5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZW50cnkgPSBlbnRyeSA9IG5ldyBUZW1wbGF0ZVJlZ2lzdHJ5RW50cnkodGhpcy5tb2R1bGVJZCB8fCB0aGlzLmRlcGVuZGVuY3lCYXNlVXJsKTtcclxuICAgICAgICBlbnRyeS5kZXBlbmRlbmNpZXMgPSBbXTtcclxuICAgICAgICBlbnRyeS50ZW1wbGF0ZUlzTG9hZGVkID0gdHJ1ZTtcclxuICAgICAgICBpZiAoZGVwZW5kZW5jaWVzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGRlcGVuZGVuY2llc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VycmVudCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5hZGREZXBlbmRlbmN5KGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50LmZyb20sIGN1cnJlbnQuYXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeShlbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBOb1ZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBOb1ZpZXdTdHJhdGVneSk7XHJcbiAgICByZXR1cm4gTm9WaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XHJcbnZhciBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kobW9kdWxlSWQsIGVudHJ5KSB7XHJcbiAgICAgICAgdGhpcy5tb2R1bGVJZCA9IG1vZHVsZUlkO1xyXG4gICAgICAgIHRoaXMuZW50cnkgPSBlbnRyeTtcclxuICAgIH1cclxuICAgIFRlbXBsYXRlUmVnaXN0cnlWaWV3U3RyYXRlZ3kucHJvdG90eXBlLmxvYWRWaWV3RmFjdG9yeSA9IGZ1bmN0aW9uICh2aWV3RW5naW5lLCBjb21waWxlSW5zdHJ1Y3Rpb24sIGxvYWRDb250ZXh0LCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgZW50cnkgPSB0aGlzLmVudHJ5O1xyXG4gICAgICAgIGlmIChlbnRyeS5mYWN0b3J5SXNSZWFkeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudHJ5LmZhY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb21waWxlSW5zdHJ1Y3Rpb24uYXNzb2NpYXRlZE1vZHVsZUlkID0gdGhpcy5tb2R1bGVJZDtcclxuICAgICAgICByZXR1cm4gdmlld0VuZ2luZS5sb2FkVmlld0ZhY3RvcnkoZW50cnksIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCk7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGVSZWdpc3RyeVZpZXdTdHJhdGVneSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZpZXdTdHJhdGVneSgpXHJcbiAgICBdLCBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5O1xyXG59KCkpO1xyXG52YXIgSW5saW5lVmlld1N0cmF0ZWd5ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIElubGluZVZpZXdTdHJhdGVneShtYXJrdXAsIGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcclxuICAgICAgICB0aGlzLm1hcmt1cCA9IG1hcmt1cDtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGRlcGVuZGVuY2llcyB8fCBudWxsO1xyXG4gICAgICAgIHRoaXMuZGVwZW5kZW5jeUJhc2VVcmwgPSBkZXBlbmRlbmN5QmFzZVVybCB8fCAnJztcclxuICAgIH1cclxuICAgIElubGluZVZpZXdTdHJhdGVneS5wcm90b3R5cGUubG9hZFZpZXdGYWN0b3J5ID0gZnVuY3Rpb24gKHZpZXdFbmdpbmUsIGNvbXBpbGVJbnN0cnVjdGlvbiwgbG9hZENvbnRleHQsIHRhcmdldCkge1xyXG4gICAgICAgIHZhciBlbnRyeSA9IHRoaXMuZW50cnk7XHJcbiAgICAgICAgdmFyIGRlcGVuZGVuY2llcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIGlmIChlbnRyeSAmJiBlbnRyeS5mYWN0b3J5SXNSZWFkeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKGVudHJ5LmZhY3RvcnkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmVudHJ5ID0gZW50cnkgPSBuZXcgVGVtcGxhdGVSZWdpc3RyeUVudHJ5KHRoaXMubW9kdWxlSWQgfHwgdGhpcy5kZXBlbmRlbmN5QmFzZVVybCk7XHJcbiAgICAgICAgZW50cnkudGVtcGxhdGUgPSBET00uY3JlYXRlVGVtcGxhdGVGcm9tTWFya3VwKHRoaXMubWFya3VwKTtcclxuICAgICAgICBpZiAoZGVwZW5kZW5jaWVzICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudCA9IGRlcGVuZGVuY2llc1tpXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY3VycmVudCA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGN1cnJlbnQgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbnRyeS5hZGREZXBlbmRlbmN5KGN1cnJlbnQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZW50cnkuYWRkRGVwZW5kZW5jeShjdXJyZW50LmZyb20sIGN1cnJlbnQuYXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbXBpbGVJbnN0cnVjdGlvbi5hc3NvY2lhdGVkTW9kdWxlSWQgPSB0aGlzLm1vZHVsZUlkO1xyXG4gICAgICAgIHJldHVybiB2aWV3RW5naW5lLmxvYWRWaWV3RmFjdG9yeShlbnRyeSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KTtcclxuICAgIH07XHJcbiAgICBJbmxpbmVWaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgSW5saW5lVmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBJbmxpbmVWaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XHJcbnZhciBTdGF0aWNWaWV3U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU3RhdGljVmlld1N0cmF0ZWd5KGNvbmZpZykge1xyXG4gICAgICAgIGlmICh0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJyB8fCAoY29uZmlnIGluc3RhbmNlb2YgRE9NLkVsZW1lbnQgJiYgY29uZmlnLnRhZ05hbWUgPT09ICdURU1QTEFURScpKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZyA9IHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBjb25maWdcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IGNvbmZpZy50ZW1wbGF0ZTtcclxuICAgICAgICB0aGlzLmRlcGVuZGVuY2llcyA9IGNvbmZpZy5kZXBlbmRlbmNpZXMgfHwgW107XHJcbiAgICAgICAgdGhpcy5mYWN0b3J5SXNSZWFkeSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMub25SZWFkeSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5tb2R1bGVJZCA9ICd1bmRlZmluZWQnO1xyXG4gICAgfVxyXG4gICAgU3RhdGljVmlld1N0cmF0ZWd5LnByb3RvdHlwZS5sb2FkVmlld0ZhY3RvcnkgPSBmdW5jdGlvbiAodmlld0VuZ2luZSwgY29tcGlsZUluc3RydWN0aW9uLCBsb2FkQ29udGV4dCwgdGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5mYWN0b3J5SXNSZWFkeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHRoaXMuZmFjdG9yeSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciAkZGVwcyA9IHRoaXMuZGVwZW5kZW5jaWVzO1xyXG4gICAgICAgIHZhciBkZXBzID0gdHlwZW9mICRkZXBzID09PSAnZnVuY3Rpb24nID8gJGRlcHMoKSA6ICRkZXBzO1xyXG4gICAgICAgIGRlcHMgPSBkZXBzID8gZGVwcyA6IFtdO1xyXG4gICAgICAgIGRlcHMgPSBBcnJheS5pc0FycmF5KGRlcHMpID8gZGVwcyA6IFtkZXBzXTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoZGVwcykudGhlbihmdW5jdGlvbiAoZGVwZW5kZW5jaWVzKSB7XHJcbiAgICAgICAgICAgIHZhciBjb250YWluZXIgPSB2aWV3RW5naW5lLmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgdmFyIGFwcFJlc291cmNlcyA9IHZpZXdFbmdpbmUuYXBwUmVzb3VyY2VzO1xyXG4gICAgICAgICAgICB2YXIgdmlld0NvbXBpbGVyID0gdmlld0VuZ2luZS52aWV3Q29tcGlsZXI7XHJcbiAgICAgICAgICAgIHZhciB2aWV3UmVzb3VyY2VzID0gbmV3IFZpZXdSZXNvdXJjZXMoYXBwUmVzb3VyY2VzKTtcclxuICAgICAgICAgICAgdmFyIHJlc291cmNlO1xyXG4gICAgICAgICAgICB2YXIgZWxEZXBzID0gW107XHJcbiAgICAgICAgICAgIGlmICh0YXJnZXQpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdSZXNvdXJjZXMuYXV0b1JlZ2lzdGVyKGNvbnRhaW5lciwgdGFyZ2V0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBmb3IgKHZhciBfaSA9IDAsIGRlcGVuZGVuY2llc18xID0gZGVwZW5kZW5jaWVzOyBfaSA8IGRlcGVuZGVuY2llc18xLmxlbmd0aDsgX2krKykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRlcCA9IGRlcGVuZGVuY2llc18xW19pXTtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZGVwID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb3VyY2UgPSB2aWV3UmVzb3VyY2VzLmF1dG9SZWdpc3Rlcihjb250YWluZXIsIGRlcCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsRGVwcy5wdXNoKHJlc291cmNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChkZXAgJiYgdHlwZW9mIGRlcCA9PT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGVwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBleHBvcnRlZCA9IGRlcFtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGV4cG9ydGVkID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvdXJjZSA9IHZpZXdSZXNvdXJjZXMuYXV0b1JlZ2lzdGVyKGNvbnRhaW5lciwgZXhwb3J0ZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc291cmNlLmVsZW1lbnROYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxEZXBzLnB1c2gocmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZGVwZW5kZW5jeSBuZWl0aGVyIGZ1bmN0aW9uIG5vciBvYmplY3QuIFJlY2VpdmVkOiBcXFwiXCIuY29uY2F0KHR5cGVvZiBkZXAsIFwiXFxcIlwiKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKGVsRGVwcy5tYXAoZnVuY3Rpb24gKGVsKSB7IHJldHVybiBlbC5sb2FkKGNvbnRhaW5lciwgZWwudGFyZ2V0KTsgfSkpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZhY3RvcnkgPSBfdGhpcy50ZW1wbGF0ZSAhPT0gbnVsbFxyXG4gICAgICAgICAgICAgICAgICAgID8gdmlld0NvbXBpbGVyLmNvbXBpbGUoX3RoaXMudGVtcGxhdGUsIHZpZXdSZXNvdXJjZXMsIGNvbXBpbGVJbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICA6IG51bGw7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5mYWN0b3J5SXNSZWFkeSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5mYWN0b3J5ID0gZmFjdG9yeTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWN0b3J5O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBTdGF0aWNWaWV3U3RyYXRlZ3kgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICB2aWV3U3RyYXRlZ3koKVxyXG4gICAgXSwgU3RhdGljVmlld1N0cmF0ZWd5KTtcclxuICAgIHJldHVybiBTdGF0aWNWaWV3U3RyYXRlZ3k7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIHJlbW92ZSh2aWV3U2xvdCwgcHJldmlvdXMpIHtcclxuICAgIHJldHVybiBBcnJheS5pc0FycmF5KHByZXZpb3VzKVxyXG4gICAgICAgID8gdmlld1Nsb3QucmVtb3ZlTWFueShwcmV2aW91cywgdHJ1ZSlcclxuICAgICAgICA6IHZpZXdTbG90LnJlbW92ZShwcmV2aW91cywgdHJ1ZSk7XHJcbn1cclxudmFyIFN3YXBTdHJhdGVnaWVzID0ge1xyXG4gICAgYmVmb3JlOiBmdW5jdGlvbiAodmlld1Nsb3QsIHByZXZpb3VzLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiAocHJldmlvdXMgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgPyBjYWxsYmFjaygpXHJcbiAgICAgICAgICAgIDogY2FsbGJhY2soKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlbW92ZSh2aWV3U2xvdCwgcHJldmlvdXMpOyB9KTtcclxuICAgIH0sXHJcbiAgICB3aXRoOiBmdW5jdGlvbiAodmlld1Nsb3QsIHByZXZpb3VzLCBjYWxsYmFjaykge1xyXG4gICAgICAgIHJldHVybiAocHJldmlvdXMgPT09IHVuZGVmaW5lZClcclxuICAgICAgICAgICAgPyBjYWxsYmFjaygpXHJcbiAgICAgICAgICAgIDogUHJvbWlzZS5hbGwoW3JlbW92ZSh2aWV3U2xvdCwgcHJldmlvdXMpLCBjYWxsYmFjaygpXSk7XHJcbiAgICB9LFxyXG4gICAgYWZ0ZXI6IGZ1bmN0aW9uICh2aWV3U2xvdCwgcHJldmlvdXMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2aWV3U2xvdC5yZW1vdmVBbGwodHJ1ZSkpLnRoZW4oY2FsbGJhY2spO1xyXG4gICAgfVxyXG59O1xuXG5mdW5jdGlvbiB0cnlBY3RpdmF0ZVZpZXdNb2RlbChjb250ZXh0KSB7XHJcbiAgICBpZiAoY29udGV4dC5za2lwQWN0aXZhdGlvbiB8fCB0eXBlb2YgY29udGV4dC52aWV3TW9kZWwuYWN0aXZhdGUgIT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY29udGV4dC52aWV3TW9kZWwuYWN0aXZhdGUoY29udGV4dC5tb2RlbCkgfHwgUHJvbWlzZS5yZXNvbHZlKCk7XHJcbn1cclxudmFyIENvbXBvc2l0aW9uRW5naW5lID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENvbXBvc2l0aW9uRW5naW5lKHZpZXdFbmdpbmUsIHZpZXdMb2NhdG9yKSB7XHJcbiAgICAgICAgdGhpcy52aWV3RW5naW5lID0gdmlld0VuZ2luZTtcclxuICAgICAgICB0aGlzLnZpZXdMb2NhdG9yID0gdmlld0xvY2F0b3I7XHJcbiAgICB9XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuX3N3YXAgPSBmdW5jdGlvbiAoY29udGV4dCwgdmlldykge1xyXG4gICAgICAgIHZhciBzd2FwU3RyYXRlZ3kgPSBTd2FwU3RyYXRlZ2llc1tjb250ZXh0LnN3YXBPcmRlcl0gfHwgU3dhcFN0cmF0ZWdpZXMuYWZ0ZXI7XHJcbiAgICAgICAgdmFyIHByZXZpb3VzVmlld3MgPSBjb250ZXh0LnZpZXdTbG90LmNoaWxkcmVuLnNsaWNlKCk7XHJcbiAgICAgICAgcmV0dXJuIHN3YXBTdHJhdGVneShjb250ZXh0LnZpZXdTbG90LCBwcmV2aW91c1ZpZXdzLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY29udGV4dC52aWV3U2xvdC5hZGQodmlldykpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRleHQuY3VycmVudENvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250ZXh0LmN1cnJlbnRDb250cm9sbGVyLnVuYmluZCgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllci5kb25lKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuX2NyZWF0ZUNvbnRyb2xsZXJBbmRTd2FwID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZUNvbnRyb2xsZXIoY29udGV4dCkudGhlbihmdW5jdGlvbiAoY29udHJvbGxlcikge1xyXG4gICAgICAgICAgICBpZiAoY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlblxyXG4gICAgICAgICAgICAgICAgICAgIC53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXIuYXV0b21hdGUoY29udGV4dC5vdmVycmlkZUNvbnRleHQsIGNvbnRleHQub3duaW5nVmlldyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLl9zd2FwKGNvbnRleHQsIGNvbnRyb2xsZXIudmlldyk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGNvbnRyb2xsZXI7IH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXIuYXV0b21hdGUoY29udGV4dC5vdmVycmlkZUNvbnRleHQsIGNvbnRleHQub3duaW5nVmlldyk7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcy5fc3dhcChjb250ZXh0LCBjb250cm9sbGVyLnZpZXcpLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gY29udHJvbGxlcjsgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUucHJvdG90eXBlLmNyZWF0ZUNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGNoaWxkQ29udGFpbmVyO1xyXG4gICAgICAgIHZhciB2aWV3TW9kZWw7XHJcbiAgICAgICAgdmFyIHZpZXdNb2RlbFJlc291cmNlO1xyXG4gICAgICAgIHZhciBtO1xyXG4gICAgICAgIHJldHVybiB0aGlzXHJcbiAgICAgICAgICAgIC5lbnN1cmVWaWV3TW9kZWwoY29udGV4dClcclxuICAgICAgICAgICAgLnRoZW4odHJ5QWN0aXZhdGVWaWV3TW9kZWwpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXIgPSBjb250ZXh0LmNoaWxkQ29udGFpbmVyO1xyXG4gICAgICAgICAgICB2aWV3TW9kZWwgPSBjb250ZXh0LnZpZXdNb2RlbDtcclxuICAgICAgICAgICAgdmlld01vZGVsUmVzb3VyY2UgPSBjb250ZXh0LnZpZXdNb2RlbFJlc291cmNlO1xyXG4gICAgICAgICAgICBtID0gdmlld01vZGVsUmVzb3VyY2UubWV0YWRhdGE7XHJcbiAgICAgICAgICAgIHZhciB2aWV3U3RyYXRlZ3kgPSBfdGhpcy52aWV3TG9jYXRvci5nZXRWaWV3U3RyYXRlZ3koY29udGV4dC52aWV3IHx8IHZpZXdNb2RlbCk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LnZpZXdSZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgICAgIHZpZXdTdHJhdGVneS5tYWtlUmVsYXRpdmVUbyhjb250ZXh0LnZpZXdSZXNvdXJjZXMudmlld1VybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG0ubG9hZChjaGlsZENvbnRhaW5lciwgdmlld01vZGVsUmVzb3VyY2UudmFsdWUsIG51bGwsIHZpZXdTdHJhdGVneSwgdHJ1ZSk7XHJcbiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAodmlld0ZhY3RvcnkpIHsgcmV0dXJuIG0uY3JlYXRlKGNoaWxkQ29udGFpbmVyLCBCZWhhdmlvckluc3RydWN0aW9uLmR5bmFtaWMoY29udGV4dC5ob3N0LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KSk7IH0pO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2l0aW9uRW5naW5lLnByb3RvdHlwZS5lbnN1cmVWaWV3TW9kZWwgPSBmdW5jdGlvbiAoY29udGV4dCkge1xyXG4gICAgICAgIHZhciBjaGlsZENvbnRhaW5lciA9IGNvbnRleHQuY2hpbGRDb250YWluZXIgPSAoY29udGV4dC5jaGlsZENvbnRhaW5lciB8fCBjb250ZXh0LmNvbnRhaW5lci5jcmVhdGVDaGlsZCgpKTtcclxuICAgICAgICBpZiAodHlwZW9mIGNvbnRleHQudmlld01vZGVsID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICBjb250ZXh0LnZpZXdNb2RlbCA9IGNvbnRleHQudmlld1Jlc291cmNlc1xyXG4gICAgICAgICAgICAgICAgPyBjb250ZXh0LnZpZXdSZXNvdXJjZXMucmVsYXRpdmVUb1ZpZXcoY29udGV4dC52aWV3TW9kZWwpXHJcbiAgICAgICAgICAgICAgICA6IGNvbnRleHQudmlld01vZGVsO1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy52aWV3RW5naW5lLmltcG9ydFZpZXdNb2RlbFJlc291cmNlKGNvbnRleHQudmlld01vZGVsKS50aGVuKGZ1bmN0aW9uICh2aWV3TW9kZWxSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgY2hpbGRDb250YWluZXIuYXV0b1JlZ2lzdGVyKHZpZXdNb2RlbFJlc291cmNlLnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIGlmIChjb250ZXh0Lmhvc3QpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZENvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5FbGVtZW50LCBjb250ZXh0Lmhvc3QpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29udGV4dC52aWV3TW9kZWwgPSBjaGlsZENvbnRhaW5lci52aWV3TW9kZWwgPSBjaGlsZENvbnRhaW5lci5nZXQodmlld01vZGVsUmVzb3VyY2UudmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC52aWV3TW9kZWxSZXNvdXJjZSA9IHZpZXdNb2RlbFJlc291cmNlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQ7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY3RvciA9IGNvbnRleHQudmlld01vZGVsLmNvbnN0cnVjdG9yO1xyXG4gICAgICAgIHZhciBpc0NsYXNzID0gdHlwZW9mIGNvbnRleHQudmlld01vZGVsID09PSAnZnVuY3Rpb24nO1xyXG4gICAgICAgIGlmIChpc0NsYXNzKSB7XHJcbiAgICAgICAgICAgIGN0b3IgPSBjb250ZXh0LnZpZXdNb2RlbDtcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXIuYXV0b1JlZ2lzdGVyKGN0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgbSA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgY3Rvcik7XHJcbiAgICAgICAgbS5lbGVtZW50TmFtZSA9IG0uZWxlbWVudE5hbWUgfHwgJ2R5bmFtaWMtZWxlbWVudCc7XHJcbiAgICAgICAgbS5pbml0aWFsaXplKGlzQ2xhc3MgPyBjaGlsZENvbnRhaW5lciA6IChjb250ZXh0LmNvbnRhaW5lciB8fCBjaGlsZENvbnRhaW5lciksIGN0b3IpO1xyXG4gICAgICAgIGNvbnRleHQudmlld01vZGVsUmVzb3VyY2UgPSB7IG1ldGFkYXRhOiBtLCB2YWx1ZTogY3RvciB9O1xyXG4gICAgICAgIGlmIChjb250ZXh0Lmhvc3QpIHtcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShET00uRWxlbWVudCwgY29udGV4dC5ob3N0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2hpbGRDb250YWluZXIudmlld01vZGVsID0gY29udGV4dC52aWV3TW9kZWwgPSBpc0NsYXNzID8gY2hpbGRDb250YWluZXIuZ2V0KGN0b3IpIDogY29udGV4dC52aWV3TW9kZWw7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb250ZXh0KTtcclxuICAgIH07XHJcbiAgICBDb21wb3NpdGlvbkVuZ2luZS5wcm90b3R5cGUuY29tcG9zZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBjb250ZXh0LmNoaWxkQ29udGFpbmVyID0gY29udGV4dC5jaGlsZENvbnRhaW5lciB8fCBjb250ZXh0LmNvbnRhaW5lci5jcmVhdGVDaGlsZCgpO1xyXG4gICAgICAgIGNvbnRleHQudmlldyA9IHRoaXMudmlld0xvY2F0b3IuZ2V0Vmlld1N0cmF0ZWd5KGNvbnRleHQudmlldyk7XHJcbiAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gY29udGV4dC5jaGlsZENvbnRhaW5lci5nZXQoQ29tcG9zaXRpb25UcmFuc2FjdGlvbik7XHJcbiAgICAgICAgdmFyIGNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbiA9IHRyYW5zYWN0aW9uLnRyeUNhcHR1cmUoKTtcclxuICAgICAgICBpZiAoY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuKSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIgPSB0cmFuc2FjdGlvbi5lbmxpc3QoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNvbnRleHQudmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9jcmVhdGVDb250cm9sbGVyQW5kU3dhcChjb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoY29udGV4dC52aWV3KSB7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LnZpZXdSZXNvdXJjZXMpIHtcclxuICAgICAgICAgICAgICAgIGNvbnRleHQudmlldy5tYWtlUmVsYXRpdmVUbyhjb250ZXh0LnZpZXdSZXNvdXJjZXMudmlld1VybCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQudmlldy5sb2FkVmlld0ZhY3RvcnkodGhpcy52aWV3RW5naW5lLCBuZXcgVmlld0NvbXBpbGVJbnN0cnVjdGlvbigpKS50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHZpZXdGYWN0b3J5LmNyZWF0ZShjb250ZXh0LmNoaWxkQ29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgIHJlc3VsdC5iaW5kKGNvbnRleHQuYmluZGluZ0NvbnRleHQsIGNvbnRleHQub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbi53YWl0Rm9yQ29tcG9zaXRpb25Db21wbGV0ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9zd2FwKGNvbnRleHQsIHJlc3VsdCk7IH0pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlc3VsdDsgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuX3N3YXAoY29udGV4dCwgcmVzdWx0KS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJlc3VsdDsgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChjb250ZXh0LnZpZXdTbG90KSB7XHJcbiAgICAgICAgICAgIGNvbnRleHQudmlld1Nsb3QucmVtb3ZlQWxsKCk7XHJcbiAgICAgICAgICAgIGlmIChjb250ZXh0LmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xyXG4gICAgICAgICAgICAgICAgY29udGV4dC5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIuZG9uZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zaXRpb25FbmdpbmUgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBpbmplY3QoVmlld0VuZ2luZSwgVmlld0xvY2F0b3IpXHJcbiAgICBdLCBDb21wb3NpdGlvbkVuZ2luZSk7XHJcbiAgICByZXR1cm4gQ29tcG9zaXRpb25FbmdpbmU7XHJcbn0oKSk7XG5cbnZhciBhbmltYXRpb25FdmVudCA9IHtcclxuICAgIGVudGVyQmVnaW46ICdhbmltYXRpb246ZW50ZXI6YmVnaW4nLFxyXG4gICAgZW50ZXJBY3RpdmU6ICdhbmltYXRpb246ZW50ZXI6YWN0aXZlJyxcclxuICAgIGVudGVyRG9uZTogJ2FuaW1hdGlvbjplbnRlcjpkb25lJyxcclxuICAgIGVudGVyVGltZW91dDogJ2FuaW1hdGlvbjplbnRlcjp0aW1lb3V0JyxcclxuICAgIGxlYXZlQmVnaW46ICdhbmltYXRpb246bGVhdmU6YmVnaW4nLFxyXG4gICAgbGVhdmVBY3RpdmU6ICdhbmltYXRpb246bGVhdmU6YWN0aXZlJyxcclxuICAgIGxlYXZlRG9uZTogJ2FuaW1hdGlvbjpsZWF2ZTpkb25lJyxcclxuICAgIGxlYXZlVGltZW91dDogJ2FuaW1hdGlvbjpsZWF2ZTp0aW1lb3V0JyxcclxuICAgIHN0YWdnZXJOZXh0OiAnYW5pbWF0aW9uOnN0YWdnZXI6bmV4dCcsXHJcbiAgICByZW1vdmVDbGFzc0JlZ2luOiAnYW5pbWF0aW9uOnJlbW92ZS1jbGFzczpiZWdpbicsXHJcbiAgICByZW1vdmVDbGFzc0FjdGl2ZTogJ2FuaW1hdGlvbjpyZW1vdmUtY2xhc3M6YWN0aXZlJyxcclxuICAgIHJlbW92ZUNsYXNzRG9uZTogJ2FuaW1hdGlvbjpyZW1vdmUtY2xhc3M6ZG9uZScsXHJcbiAgICByZW1vdmVDbGFzc1RpbWVvdXQ6ICdhbmltYXRpb246cmVtb3ZlLWNsYXNzOnRpbWVvdXQnLFxyXG4gICAgYWRkQ2xhc3NCZWdpbjogJ2FuaW1hdGlvbjphZGQtY2xhc3M6YmVnaW4nLFxyXG4gICAgYWRkQ2xhc3NBY3RpdmU6ICdhbmltYXRpb246YWRkLWNsYXNzOmFjdGl2ZScsXHJcbiAgICBhZGRDbGFzc0RvbmU6ICdhbmltYXRpb246YWRkLWNsYXNzOmRvbmUnLFxyXG4gICAgYWRkQ2xhc3NUaW1lb3V0OiAnYW5pbWF0aW9uOmFkZC1jbGFzczp0aW1lb3V0JyxcclxuICAgIGFuaW1hdGVCZWdpbjogJ2FuaW1hdGlvbjphbmltYXRlOmJlZ2luJyxcclxuICAgIGFuaW1hdGVBY3RpdmU6ICdhbmltYXRpb246YW5pbWF0ZTphY3RpdmUnLFxyXG4gICAgYW5pbWF0ZURvbmU6ICdhbmltYXRpb246YW5pbWF0ZTpkb25lJyxcclxuICAgIGFuaW1hdGVUaW1lb3V0OiAnYW5pbWF0aW9uOmFuaW1hdGU6dGltZW91dCcsXHJcbiAgICBzZXF1ZW5jZUJlZ2luOiAnYW5pbWF0aW9uOnNlcXVlbmNlOmJlZ2luJyxcclxuICAgIHNlcXVlbmNlRG9uZTogJ2FuaW1hdGlvbjpzZXF1ZW5jZTpkb25lJ1xyXG59O1xuXG5mdW5jdGlvbiBjcmVhdGVDaGlsZE9ic2VydmVyRGVjb3JhdG9yKHNlbGVjdG9yT3JDb25maWcsIGFsbCkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSwgZGVzY3JpcHRvcikge1xyXG4gICAgICAgIHZhciBhY3R1YWxUYXJnZXQgPSB0eXBlb2Yga2V5ID09PSAnc3RyaW5nJyA/IHRhcmdldC5jb25zdHJ1Y3RvciA6IHRhcmdldDtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgYWN0dWFsVGFyZ2V0KTtcclxuICAgICAgICBpZiAodHlwZW9mIHNlbGVjdG9yT3JDb25maWcgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHNlbGVjdG9yT3JDb25maWcgPSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3Rvcjogc2VsZWN0b3JPckNvbmZpZyxcclxuICAgICAgICAgICAgICAgIG5hbWU6IGtleVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGVzY3JpcHRvcikge1xyXG4gICAgICAgICAgICBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTtcclxuICAgICAgICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZWxlY3Rvck9yQ29uZmlnLmFsbCA9IGFsbDtcclxuICAgICAgICByLmFkZENoaWxkQmluZGluZyhuZXcgQ2hpbGRPYnNlcnZlcihzZWxlY3Rvck9yQ29uZmlnKSk7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIGNoaWxkcmVuKHNlbGVjdG9yT3JDb25maWcpIHtcclxuICAgIHJldHVybiBjcmVhdGVDaGlsZE9ic2VydmVyRGVjb3JhdG9yKHNlbGVjdG9yT3JDb25maWcsIHRydWUpO1xyXG59XHJcbmZ1bmN0aW9uIGNoaWxkKHNlbGVjdG9yT3JDb25maWcpIHtcclxuICAgIHJldHVybiBjcmVhdGVDaGlsZE9ic2VydmVyRGVjb3JhdG9yKHNlbGVjdG9yT3JDb25maWcsIGZhbHNlKTtcclxufVxyXG52YXIgQ2hpbGRPYnNlcnZlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDaGlsZE9ic2VydmVyKGNvbmZpZykge1xyXG4gICAgICAgIHRoaXMubmFtZSA9IGNvbmZpZy5uYW1lO1xyXG4gICAgICAgIHRoaXMuY2hhbmdlSGFuZGxlciA9IGNvbmZpZy5jaGFuZ2VIYW5kbGVyIHx8IHRoaXMubmFtZSArICdDaGFuZ2VkJztcclxuICAgICAgICB0aGlzLnNlbGVjdG9yID0gY29uZmlnLnNlbGVjdG9yO1xyXG4gICAgICAgIHRoaXMuYWxsID0gY29uZmlnLmFsbDtcclxuICAgIH1cclxuICAgIENoaWxkT2JzZXJ2ZXIucHJvdG90eXBlLmNyZWF0ZSA9IGZ1bmN0aW9uICh2aWV3SG9zdCwgdmlld01vZGVsLCBjb250cm9sbGVyKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBDaGlsZE9ic2VydmVyQmluZGVyKHRoaXMuc2VsZWN0b3IsIHZpZXdIb3N0LCB0aGlzLm5hbWUsIHZpZXdNb2RlbCwgY29udHJvbGxlciwgdGhpcy5jaGFuZ2VIYW5kbGVyLCB0aGlzLmFsbCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENoaWxkT2JzZXJ2ZXI7XHJcbn0oKSk7XHJcbnZhciBub011dGF0aW9ucyA9IFtdO1xyXG5mdW5jdGlvbiB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKSB7XHJcbiAgICB2YXIgbXV0YXRpb25zID0gZ3JvdXBlZE11dGF0aW9ucy5nZXQoYmluZGVyKTtcclxuICAgIGlmICghbXV0YXRpb25zKSB7XHJcbiAgICAgICAgbXV0YXRpb25zID0gW107XHJcbiAgICAgICAgZ3JvdXBlZE11dGF0aW9ucy5zZXQoYmluZGVyLCBtdXRhdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgbXV0YXRpb25zLnB1c2gocmVjb3JkKTtcclxufVxyXG5mdW5jdGlvbiBvbkNoaWxkQ2hhbmdlKG11dGF0aW9ucywgb2JzZXJ2ZXIpIHtcclxuICAgIHZhciBiaW5kZXJzID0gb2JzZXJ2ZXIuYmluZGVycztcclxuICAgIHZhciBiaW5kZXJzTGVuZ3RoID0gYmluZGVycy5sZW5ndGg7XHJcbiAgICB2YXIgZ3JvdXBlZE11dGF0aW9ucyA9IG5ldyBNYXAoKTtcclxuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IG11dGF0aW9ucy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgdmFyIHJlY29yZCA9IG11dGF0aW9uc1tpXTtcclxuICAgICAgICB2YXIgYWRkZWQgPSByZWNvcmQuYWRkZWROb2RlcztcclxuICAgICAgICB2YXIgcmVtb3ZlZCA9IHJlY29yZC5yZW1vdmVkTm9kZXM7XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gcmVtb3ZlZC5sZW5ndGg7IGogPCBqajsgKytqKSB7XHJcbiAgICAgICAgICAgIHZhciBub2RlID0gcmVtb3ZlZFtqXTtcclxuICAgICAgICAgICAgaWYgKG5vZGUubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBrIDwgYmluZGVyc0xlbmd0aDsgKytrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGJpbmRlciA9IGJpbmRlcnNba107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGJpbmRlci5vblJlbW92ZShub2RlKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFja011dGF0aW9uKGdyb3VwZWRNdXRhdGlvbnMsIGJpbmRlciwgcmVjb3JkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgaiA9IDAsIGpqID0gYWRkZWQubGVuZ3RoOyBqIDwgamo7ICsraikge1xyXG4gICAgICAgICAgICB2YXIgbm9kZSA9IGFkZGVkW2pdO1xyXG4gICAgICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBiaW5kZXJzTGVuZ3RoOyArK2spIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgYmluZGVyID0gYmluZGVyc1trXTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoYmluZGVyLm9uQWRkKG5vZGUpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYWNrTXV0YXRpb24oZ3JvdXBlZE11dGF0aW9ucywgYmluZGVyLCByZWNvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGdyb3VwZWRNdXRhdGlvbnMuZm9yRWFjaChmdW5jdGlvbiAobXV0YXRpb25SZWNvcmRzLCBiaW5kZXIpIHtcclxuICAgICAgICBpZiAoYmluZGVyLmlzQm91bmQgJiYgYmluZGVyLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgYmluZGVyLnZpZXdNb2RlbFtiaW5kZXIuY2hhbmdlSGFuZGxlcl0obXV0YXRpb25SZWNvcmRzKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxufVxyXG52YXIgQ2hpbGRPYnNlcnZlckJpbmRlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDaGlsZE9ic2VydmVyQmluZGVyKHNlbGVjdG9yLCB2aWV3SG9zdCwgcHJvcGVydHksIHZpZXdNb2RlbCwgY29udHJvbGxlciwgY2hhbmdlSGFuZGxlciwgYWxsKSB7XHJcbiAgICAgICAgdGhpcy5zZWxlY3RvciA9IHNlbGVjdG9yO1xyXG4gICAgICAgIHRoaXMudmlld0hvc3QgPSB2aWV3SG9zdDtcclxuICAgICAgICB0aGlzLnByb3BlcnR5ID0gcHJvcGVydHk7XHJcbiAgICAgICAgdGhpcy52aWV3TW9kZWwgPSB2aWV3TW9kZWw7XHJcbiAgICAgICAgdGhpcy5jb250cm9sbGVyID0gY29udHJvbGxlcjtcclxuICAgICAgICB0aGlzLmNoYW5nZUhhbmRsZXIgPSBjaGFuZ2VIYW5kbGVyIGluIHZpZXdNb2RlbCA/IGNoYW5nZUhhbmRsZXIgOiBudWxsO1xyXG4gICAgICAgIHRoaXMudXNlc1NoYWRvd0RPTSA9IGNvbnRyb2xsZXIuYmVoYXZpb3IudXNlc1NoYWRvd0RPTTtcclxuICAgICAgICB0aGlzLmFsbCA9IGFsbDtcclxuICAgICAgICBpZiAoIXRoaXMudXNlc1NoYWRvd0RPTSAmJiBjb250cm9sbGVyLnZpZXcgJiYgY29udHJvbGxlci52aWV3LmNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGVudFZpZXcgPSBjb250cm9sbGVyLnZpZXcuY29udGVudFZpZXc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRlbnRWaWV3ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUubWF0Y2hlcyA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKGVsZW1lbnQubWF0Y2hlcyh0aGlzLnNlbGVjdG9yKSkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZW50VmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGNvbnRlbnRWaWV3ID0gdGhpcy5jb250ZW50VmlldztcclxuICAgICAgICAgICAgdmFyIGFzc2lnbmVkU2xvdCA9IGVsZW1lbnQuYXVBc3NpZ25lZFNsb3Q7XHJcbiAgICAgICAgICAgIGlmIChhc3NpZ25lZFNsb3QgJiYgYXNzaWduZWRTbG90LnByb2plY3RGcm9tQW5jaG9ycykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGFuY2hvcnMgPSBhc3NpZ25lZFNsb3QucHJvamVjdEZyb21BbmNob3JzO1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYW5jaG9ycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFuY2hvcnNbaV0uYXVPd25lclZpZXcgPT09IGNvbnRlbnRWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gZWxlbWVudC5hdU93bmVyVmlldyA9PT0gY29udGVudFZpZXc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHNvdXJjZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcclxuICAgICAgICB2YXIgdmlld0hvc3QgPSB0aGlzLnZpZXdIb3N0O1xyXG4gICAgICAgIHZhciB2aWV3TW9kZWwgPSB0aGlzLnZpZXdNb2RlbDtcclxuICAgICAgICB2YXIgb2JzZXJ2ZXIgPSB2aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXztcclxuICAgICAgICBpZiAoIW9ic2VydmVyKSB7XHJcbiAgICAgICAgICAgIG9ic2VydmVyID0gdmlld0hvc3QuX19jaGlsZE9ic2VydmVyX18gPSBET00uY3JlYXRlTXV0YXRpb25PYnNlcnZlcihvbkNoaWxkQ2hhbmdlKTtcclxuICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICBjaGlsZExpc3Q6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBzdWJ0cmVlOiAhdGhpcy51c2VzU2hhZG93RE9NXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIG9ic2VydmVyLm9ic2VydmUodmlld0hvc3QsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICBvYnNlcnZlci5iaW5kZXJzID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9ic2VydmVyLmJpbmRlcnMucHVzaCh0aGlzKTtcclxuICAgICAgICBpZiAodGhpcy51c2VzU2hhZG93RE9NKSB7XHJcbiAgICAgICAgICAgIHZhciBjdXJyZW50ID0gdmlld0hvc3QuZmlyc3RFbGVtZW50Q2hpbGQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmFsbCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGl0ZW1zID0gdmlld01vZGVsW3RoaXMucHJvcGVydHldO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFpdGVtcykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zID0gdmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW107XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtcy5zcGxpY2UoMCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB3aGlsZSAoY3VycmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hdGNoZXMoY3VycmVudCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXMucHVzaChjdXJyZW50LmF1ICYmIGN1cnJlbnQuYXUuY29udHJvbGxlciA/IGN1cnJlbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBjdXJyZW50KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0obm9NdXRhdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKGN1cnJlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGN1cnJlbnQuYXUgJiYgY3VycmVudC5hdS5jb250cm9sbGVyID8gY3VycmVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbCA6IGN1cnJlbnQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gdmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmNoYW5nZUhhbmRsZXIgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0odmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50ID0gY3VycmVudC5uZXh0RWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUub25SZW1vdmUgPSBmdW5jdGlvbiAoZWxlbWVudCkge1xyXG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXMoZWxlbWVudCkpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gZWxlbWVudC5hdSAmJiBlbGVtZW50LmF1LmNvbnRyb2xsZXIgPyBlbGVtZW50LmF1LmNvbnRyb2xsZXIudmlld01vZGVsIDogZWxlbWVudDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuYWxsKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgaXRlbXMgPSAodGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gfHwgKHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gW10pKTtcclxuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGl0ZW1zLmluZGV4T2YodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnNwbGljZShpbmRleCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gdGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV07XHJcbiAgICAgICAgICAgIGlmIChjdXJyZW50VmFsdWUgPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0JvdW5kICYmIHRoaXMuY2hhbmdlSGFuZGxlciAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMuY2hhbmdlSGFuZGxlcl0odmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH07XHJcbiAgICBDaGlsZE9ic2VydmVyQmluZGVyLnByb3RvdHlwZS5vbkFkZCA9IGZ1bmN0aW9uIChlbGVtZW50KSB7XHJcbiAgICAgICAgaWYgKHRoaXMubWF0Y2hlcyhlbGVtZW50KSkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBlbGVtZW50LmF1ICYmIGVsZW1lbnQuYXUuY29udHJvbGxlciA/IGVsZW1lbnQuYXUuY29udHJvbGxlci52aWV3TW9kZWwgOiBlbGVtZW50O1xyXG4gICAgICAgICAgICBpZiAodGhpcy5hbGwpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpdGVtcyA9ICh0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSB8fCAodGhpcy52aWV3TW9kZWxbdGhpcy5wcm9wZXJ0eV0gPSBbXSkpO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2VsZWN0b3IgPT09ICcqJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW1zLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgIHZhciBwcmV2ID0gZWxlbWVudC5wcmV2aW91c0VsZW1lbnRTaWJsaW5nO1xyXG4gICAgICAgICAgICAgICAgd2hpbGUgKHByZXYpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tYXRjaGVzKHByZXYpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHByZXYgPSBwcmV2LnByZXZpb3VzRWxlbWVudFNpYmxpbmc7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpdGVtcy5zcGxpY2UoaW5kZXgsIDAsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudmlld01vZGVsW3RoaXMucHJvcGVydHldID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQm91bmQgJiYgdGhpcy5jaGFuZ2VIYW5kbGVyICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLmNoYW5nZUhhbmRsZXJdKHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgQ2hpbGRPYnNlcnZlckJpbmRlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBudWxsO1xyXG4gICAgICAgIHZhciBjaGlsZE9ic2VydmVyID0gdGhpcy52aWV3SG9zdC5fX2NoaWxkT2JzZXJ2ZXJfXztcclxuICAgICAgICBpZiAoY2hpbGRPYnNlcnZlcikge1xyXG4gICAgICAgICAgICB2YXIgYmluZGVycyA9IGNoaWxkT2JzZXJ2ZXIuYmluZGVycztcclxuICAgICAgICAgICAgaWYgKGJpbmRlcnMgJiYgYmluZGVycy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZHggPSBiaW5kZXJzLmluZGV4T2YodGhpcyk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGJpbmRlcnMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoYmluZGVycy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZE9ic2VydmVyLmRpc2Nvbm5lY3QoKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpZXdIb3N0Ll9fY2hpbGRPYnNlcnZlcl9fID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy51c2VzU2hhZG93RE9NKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnZpZXdNb2RlbFt0aGlzLnByb3BlcnR5XSA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIENoaWxkT2JzZXJ2ZXJCaW5kZXI7XHJcbn0oKSk7XG5cbnZhciBFbGVtZW50Q29uZmlnUmVzb3VyY2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRWxlbWVudENvbmZpZ1Jlc291cmNlKCkge1xyXG4gICAgfVxyXG4gICAgRWxlbWVudENvbmZpZ1Jlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgdGFyZ2V0KSB7IH07XHJcbiAgICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKHJlZ2lzdHJ5LCBuYW1lKSB7IH07XHJcbiAgICBFbGVtZW50Q29uZmlnUmVzb3VyY2UucHJvdG90eXBlLmxvYWQgPSBmdW5jdGlvbiAoY29udGFpbmVyLCB0YXJnZXQpIHtcclxuICAgICAgICB2YXIgY29uZmlnID0gbmV3IHRhcmdldCgpO1xyXG4gICAgICAgIHZhciBldmVudE1hbmFnZXIgPSBjb250YWluZXIuZ2V0KEV2ZW50TWFuYWdlcik7XHJcbiAgICAgICAgZXZlbnRNYW5hZ2VyLnJlZ2lzdGVyRWxlbWVudENvbmZpZyhjb25maWcpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBFbGVtZW50Q29uZmlnUmVzb3VyY2U7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIHJlc291cmNlKGluc3RhbmNlT3JDb25maWcpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdmFyIGlzQ29uZmlnID0gdHlwZW9mIGluc3RhbmNlT3JDb25maWcgPT09ICdzdHJpbmcnIHx8IE9iamVjdC5nZXRQcm90b3R5cGVPZihpbnN0YW5jZU9yQ29uZmlnKSA9PT0gT2JqZWN0LnByb3RvdHlwZTtcclxuICAgICAgICBpZiAoaXNDb25maWcpIHtcclxuICAgICAgICAgICAgdGFyZ2V0LiRyZXNvdXJjZSA9IGluc3RhbmNlT3JDb25maWc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIGluc3RhbmNlT3JDb25maWcsIHRhcmdldCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBiZWhhdmlvcihvdmVycmlkZSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBpZiAob3ZlcnJpZGUgaW5zdGFuY2VvZiBIdG1sQmVoYXZpb3JSZXNvdXJjZSkge1xyXG4gICAgICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIG92ZXJyaWRlLCB0YXJnZXQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHRhcmdldCk7XHJcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24ociwgb3ZlcnJpZGUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gY3VzdG9tRWxlbWVudChuYW1lKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0YXJnZXQpO1xyXG4gICAgICAgIHIuZWxlbWVudE5hbWUgPSB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCAnY3VzdG9tIGVsZW1lbnQnKTtcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gY3VzdG9tQXR0cmlidXRlKG5hbWUsIGRlZmF1bHRCaW5kaW5nTW9kZSwgYWxpYXNlcykge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdGFyZ2V0KTtcclxuICAgICAgICByLmF0dHJpYnV0ZU5hbWUgPSB2YWxpZGF0ZUJlaGF2aW9yTmFtZShuYW1lLCAnY3VzdG9tIGF0dHJpYnV0ZScpO1xyXG4gICAgICAgIHIuYXR0cmlidXRlRGVmYXVsdEJpbmRpbmdNb2RlID0gZGVmYXVsdEJpbmRpbmdNb2RlO1xyXG4gICAgICAgIHIuYWxpYXNlcyA9IGFsaWFzZXM7XHJcbiAgICB9O1xyXG59XHJcbmZ1bmN0aW9uIHRlbXBsYXRlQ29udHJvbGxlcih0YXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci5saWZ0c0NvbnRlbnQgPSB0cnVlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIGJpbmRhYmxlKG5hbWVPckNvbmZpZ09yVGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHRhcmdldCwga2V5MiwgZGVzY3JpcHRvcjIpIHtcclxuICAgICAgICB2YXIgYWN0dWFsVGFyZ2V0ID0ga2V5MiA/IHRhcmdldC5jb25zdHJ1Y3RvciA6IHRhcmdldDtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgYWN0dWFsVGFyZ2V0KTtcclxuICAgICAgICB2YXIgcHJvcDtcclxuICAgICAgICBpZiAoa2V5Mikge1xyXG4gICAgICAgICAgICBuYW1lT3JDb25maWdPclRhcmdldCA9IG5hbWVPckNvbmZpZ09yVGFyZ2V0IHx8IHt9O1xyXG4gICAgICAgICAgICBuYW1lT3JDb25maWdPclRhcmdldC5uYW1lID0ga2V5MjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcHJvcCA9IG5ldyBCaW5kYWJsZVByb3BlcnR5KG5hbWVPckNvbmZpZ09yVGFyZ2V0KTtcclxuICAgICAgICByZXR1cm4gcHJvcC5yZWdpc3RlcldpdGgoYWN0dWFsVGFyZ2V0LCByLCBkZXNjcmlwdG9yMik7XHJcbiAgICB9O1xyXG4gICAgaWYgKCFuYW1lT3JDb25maWdPclRhcmdldCkge1xyXG4gICAgICAgIHJldHVybiBkZWNvO1xyXG4gICAgfVxyXG4gICAgaWYgKGtleSkge1xyXG4gICAgICAgIHZhciB0YXJnZXQgPSBuYW1lT3JDb25maWdPclRhcmdldDtcclxuICAgICAgICBuYW1lT3JDb25maWdPclRhcmdldCA9IG51bGw7XHJcbiAgICAgICAgcmV0dXJuIGRlY28odGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGRlY287XHJcbn1cclxuZnVuY3Rpb24gZHluYW1pY09wdGlvbnModGFyZ2V0KSB7XHJcbiAgICB2YXIgZGVjbyA9IGZ1bmN0aW9uICh0KSB7XHJcbiAgICAgICAgdmFyIHIgPSBtZXRhZGF0YS5nZXRPckNyZWF0ZU93bihtZXRhZGF0YS5yZXNvdXJjZSwgSHRtbEJlaGF2aW9yUmVzb3VyY2UsIHQpO1xyXG4gICAgICAgIHIuaGFzRHluYW1pY09wdGlvbnMgPSB0cnVlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XHJcbnZhciBkZWZhdWx0U2hhZG93RE9NT3B0aW9ucyA9IHsgbW9kZTogJ29wZW4nIH07XHJcbmZ1bmN0aW9uIHVzZVNoYWRvd0RPTSh0YXJnZXRPck9wdGlvbnMpIHtcclxuICAgIHZhciBvcHRpb25zID0gdHlwZW9mIHRhcmdldE9yT3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJyB8fCAhdGFyZ2V0T3JPcHRpb25zXHJcbiAgICAgICAgPyBkZWZhdWx0U2hhZG93RE9NT3B0aW9uc1xyXG4gICAgICAgIDogdGFyZ2V0T3JPcHRpb25zO1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLnRhcmdldFNoYWRvd0RPTSA9IHRydWU7XHJcbiAgICAgICAgci5zaGFkb3dET01PcHRpb25zID0gb3B0aW9ucztcclxuICAgIH07XHJcbiAgICByZXR1cm4gdHlwZW9mIHRhcmdldE9yT3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJyA/IGRlY28odGFyZ2V0T3JPcHRpb25zKSA6IGRlY287XHJcbn1cclxuZnVuY3Rpb24gcHJvY2Vzc0F0dHJpYnV0ZXMocHJvY2Vzc29yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci5wcm9jZXNzQXR0cmlidXRlcyA9IGZ1bmN0aW9uIChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBhdHRyaWJ1dGVzLCBlbGVtZW50SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3Nvcihjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBhdHRyaWJ1dGVzLCBlbGVtZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmcnKS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBkb05vdFByb2Nlc3NDb250ZW50KCkgeyByZXR1cm4gZmFsc2U7IH1cclxuZnVuY3Rpb24gcHJvY2Vzc0NvbnRlbnQocHJvY2Vzc29yKSB7XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICB2YXIgciA9IG1ldGFkYXRhLmdldE9yQ3JlYXRlT3duKG1ldGFkYXRhLnJlc291cmNlLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgdCk7XHJcbiAgICAgICAgci5wcm9jZXNzQ29udGVudCA9IHByb2Nlc3NvciA/IGZ1bmN0aW9uIChjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHByb2Nlc3Nvcihjb21waWxlciwgcmVzb3VyY2VzLCBub2RlLCBpbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZycpLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gOiBkb05vdFByb2Nlc3NDb250ZW50O1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiBjb250YWluZXJsZXNzKHRhcmdldCkge1xyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIHZhciByID0gbWV0YWRhdGEuZ2V0T3JDcmVhdGVPd24obWV0YWRhdGEucmVzb3VyY2UsIEh0bWxCZWhhdmlvclJlc291cmNlLCB0KTtcclxuICAgICAgICByLmNvbnRhaW5lcmxlc3MgPSB0cnVlO1xyXG4gICAgfTtcclxuICAgIHJldHVybiB0YXJnZXQgPyBkZWNvKHRhcmdldCkgOiBkZWNvO1xyXG59XHJcbmZ1bmN0aW9uIHVzZVZpZXdTdHJhdGVneShzdHJhdGVneSkge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUoVmlld0xvY2F0b3Iudmlld1N0cmF0ZWd5TWV0YWRhdGFLZXksIHN0cmF0ZWd5LCB0YXJnZXQpO1xyXG4gICAgfTtcclxufVxyXG5mdW5jdGlvbiB1c2VWaWV3KHBhdGgpIHtcclxuICAgIHJldHVybiB1c2VWaWV3U3RyYXRlZ3kobmV3IFJlbGF0aXZlVmlld1N0cmF0ZWd5KHBhdGgpKTtcclxufVxyXG5mdW5jdGlvbiBpbmxpbmVWaWV3KG1hcmt1cCwgZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkge1xyXG4gICAgcmV0dXJuIHVzZVZpZXdTdHJhdGVneShuZXcgSW5saW5lVmlld1N0cmF0ZWd5KG1hcmt1cCwgZGVwZW5kZW5jaWVzLCBkZXBlbmRlbmN5QmFzZVVybCkpO1xyXG59XHJcbmZ1bmN0aW9uIG5vVmlldyh0YXJnZXRPckRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpIHtcclxuICAgIHZhciB0YXJnZXQ7XHJcbiAgICB2YXIgZGVwZW5kZW5jaWVzO1xyXG4gICAgaWYgKHR5cGVvZiB0YXJnZXRPckRlcGVuZGVuY2llcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHRhcmdldCA9IHRhcmdldE9yRGVwZW5kZW5jaWVzO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZGVwZW5kZW5jaWVzID0gdGFyZ2V0T3JEZXBlbmRlbmNpZXM7XHJcbiAgICAgICAgdGFyZ2V0ID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgdmFyIGRlY28gPSBmdW5jdGlvbiAodCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShWaWV3TG9jYXRvci52aWV3U3RyYXRlZ3lNZXRhZGF0YUtleSwgbmV3IE5vVmlld1N0cmF0ZWd5KGRlcGVuZGVuY2llcywgZGVwZW5kZW5jeUJhc2VVcmwpLCB0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gdGFyZ2V0ID8gZGVjbyh0YXJnZXQpIDogZGVjbztcclxufVxyXG5mdW5jdGlvbiB2aWV3KHRlbXBsYXRlT3JDb25maWcpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgdGFyZ2V0LiR2aWV3ID0gdGVtcGxhdGVPckNvbmZpZztcclxuICAgIH07XHJcbn1cclxuZnVuY3Rpb24gZWxlbWVudENvbmZpZyh0YXJnZXQpIHtcclxuICAgIHZhciBkZWNvID0gZnVuY3Rpb24gKHQpIHtcclxuICAgICAgICBtZXRhZGF0YS5kZWZpbmUobWV0YWRhdGEucmVzb3VyY2UsIG5ldyBFbGVtZW50Q29uZmlnUmVzb3VyY2UoKSwgdCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIHRhcmdldCA/IGRlY28odGFyZ2V0KSA6IGRlY287XHJcbn1cclxuZnVuY3Rpb24gdmlld1Jlc291cmNlcygpIHtcclxuICAgIHZhciByZXNvdXJjZXMgPSBbXTtcclxuICAgIGZvciAodmFyIF9pID0gMDsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgcmVzb3VyY2VzW19pXSA9IGFyZ3VtZW50c1tfaV07XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIG1ldGFkYXRhLmRlZmluZShWaWV3RW5naW5lLnZpZXdNb2RlbFJlcXVpcmVNZXRhZGF0YUtleSwgcmVzb3VyY2VzLCB0YXJnZXQpO1xyXG4gICAgfTtcclxufVxuXG52YXIgVGVtcGxhdGluZ0VuZ2luZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUZW1wbGF0aW5nRW5naW5lKGNvbnRhaW5lciwgbW9kdWxlQW5hbHl6ZXIsIHZpZXdDb21waWxlciwgY29tcG9zaXRpb25FbmdpbmUpIHtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5fbW9kdWxlQW5hbHl6ZXIgPSBtb2R1bGVBbmFseXplcjtcclxuICAgICAgICB0aGlzLl92aWV3Q29tcGlsZXIgPSB2aWV3Q29tcGlsZXI7XHJcbiAgICAgICAgdGhpcy5fY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcclxuICAgICAgICBjb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShBbmltYXRvciwgQW5pbWF0b3IuaW5zdGFuY2UgPSBuZXcgQW5pbWF0b3IoKSk7XHJcbiAgICB9XHJcbiAgICBUZW1wbGF0aW5nRW5naW5lLnByb3RvdHlwZS5jb25maWd1cmVBbmltYXRvciA9IGZ1bmN0aW9uIChhbmltYXRvcikge1xyXG4gICAgICAgIHRoaXMuX2NvbnRhaW5lci51bnJlZ2lzdGVyKEFuaW1hdG9yKTtcclxuICAgICAgICB0aGlzLl9jb250YWluZXIucmVnaXN0ZXJJbnN0YW5jZShBbmltYXRvciwgQW5pbWF0b3IuaW5zdGFuY2UgPSBhbmltYXRvcik7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ0VuZ2luZS5wcm90b3R5cGUuY29tcG9zZSA9IGZ1bmN0aW9uIChjb250ZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbXBvc2l0aW9uRW5naW5lLmNvbXBvc2UoY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ0VuZ2luZS5wcm90b3R5cGUuZW5oYW5jZSA9IGZ1bmN0aW9uIChpbnN0cnVjdGlvbikge1xyXG4gICAgICAgIGlmIChpbnN0cnVjdGlvbiBpbnN0YW5jZW9mIERPTS5FbGVtZW50KSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uID0geyBlbGVtZW50OiBpbnN0cnVjdGlvbiB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgY29tcGlsZXJJbnN0cnVjdGlvbnMgPSB7IGxldEV4cHJlc3Npb25zOiBbXSB9O1xyXG4gICAgICAgIHZhciByZXNvdXJjZXMgPSBpbnN0cnVjdGlvbi5yZXNvdXJjZXMgfHwgdGhpcy5fY29udGFpbmVyLmdldChWaWV3UmVzb3VyY2VzKTtcclxuICAgICAgICB0aGlzLl92aWV3Q29tcGlsZXIuX2NvbXBpbGVOb2RlKGluc3RydWN0aW9uLmVsZW1lbnQsIHJlc291cmNlcywgY29tcGlsZXJJbnN0cnVjdGlvbnMsIGluc3RydWN0aW9uLmVsZW1lbnQucGFyZW50Tm9kZSwgJ3Jvb3QnLCB0cnVlKTtcclxuICAgICAgICB2YXIgZmFjdG9yeSA9IG5ldyBWaWV3RmFjdG9yeShpbnN0cnVjdGlvbi5lbGVtZW50LCBjb21waWxlckluc3RydWN0aW9ucywgcmVzb3VyY2VzKTtcclxuICAgICAgICB2YXIgY29udGFpbmVyID0gaW5zdHJ1Y3Rpb24uY29udGFpbmVyIHx8IHRoaXMuX2NvbnRhaW5lci5jcmVhdGVDaGlsZCgpO1xyXG4gICAgICAgIHZhciB2aWV3ID0gZmFjdG9yeS5jcmVhdGUoY29udGFpbmVyLCBCZWhhdmlvckluc3RydWN0aW9uLmVuaGFuY2UoKSk7XHJcbiAgICAgICAgdmlldy5iaW5kKGluc3RydWN0aW9uLmJpbmRpbmdDb250ZXh0IHx8IHt9LCBpbnN0cnVjdGlvbi5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIHZpZXcuZmlyc3RDaGlsZCA9IHZpZXcubGFzdENoaWxkID0gdmlldy5mcmFnbWVudDtcclxuICAgICAgICB2aWV3LmZyYWdtZW50ID0gRE9NLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtcclxuICAgICAgICB2aWV3LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgcmV0dXJuIHZpZXc7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ0VuZ2luZS5pbmplY3QgPSBbQ29udGFpbmVyLCBNb2R1bGVBbmFseXplciwgVmlld0NvbXBpbGVyLCBDb21wb3NpdGlvbkVuZ2luZV07XHJcbiAgICByZXR1cm4gVGVtcGxhdGluZ0VuZ2luZTtcclxufSgpKTtcblxuZXhwb3J0IHsgQW5pbWF0b3IsIEJlaGF2aW9ySW5zdHJ1Y3Rpb24sIEJlaGF2aW9yUHJvcGVydHlPYnNlcnZlciwgQmluZGFibGVQcm9wZXJ0eSwgQmluZGluZ0xhbmd1YWdlLCBCb3VuZFZpZXdGYWN0b3J5LCBDb21wb3NpdGlvbkVuZ2luZSwgQ29tcG9zaXRpb25UcmFuc2FjdGlvbiwgQ29tcG9zaXRpb25UcmFuc2FjdGlvbk5vdGlmaWVyLCBDb21wb3NpdGlvblRyYW5zYWN0aW9uT3duZXJzaGlwVG9rZW4sIENvbnRyb2xsZXIsIENvbnZlbnRpb25hbFZpZXdTdHJhdGVneSwgRWxlbWVudENvbmZpZ1Jlc291cmNlLCBFbGVtZW50RXZlbnRzLCBIdG1sQmVoYXZpb3JSZXNvdXJjZSwgSW5saW5lVmlld1N0cmF0ZWd5LCBNb2R1bGVBbmFseXplciwgTm9WaWV3U3RyYXRlZ3ksIFBhc3NUaHJvdWdoU2xvdCwgUmVsYXRpdmVWaWV3U3RyYXRlZ3ksIFJlc291cmNlRGVzY3JpcHRpb24sIFJlc291cmNlTG9hZENvbnRleHQsIFJlc291cmNlTW9kdWxlLCBTaGFkb3dET00sIFNoYWRvd1Nsb3QsIFNsb3RDdXN0b21BdHRyaWJ1dGUsIFN0YXRpY1ZpZXdTdHJhdGVneSwgU3dhcFN0cmF0ZWdpZXMsIFRhcmdldEluc3RydWN0aW9uLCBUZW1wbGF0ZVJlZ2lzdHJ5Vmlld1N0cmF0ZWd5LCBUZW1wbGF0aW5nRW5naW5lLCBWaWV3LCBWaWV3Q29tcGlsZUluc3RydWN0aW9uLCBWaWV3Q29tcGlsZXIsIFZpZXdFbmdpbmUsIFZpZXdFbmdpbmVIb29rc1Jlc291cmNlLCBWaWV3RmFjdG9yeSwgVmlld0xvY2F0b3IsIFZpZXdSZXNvdXJjZXMsIFZpZXdTbG90LCBfaHlwaGVuYXRlLCBfaXNBbGxXaGl0ZXNwYWNlLCBhbmltYXRpb25FdmVudCwgYmVoYXZpb3IsIGJpbmRhYmxlLCBjaGlsZCwgY2hpbGRyZW4sIGNvbnRhaW5lcmxlc3MsIGN1c3RvbUF0dHJpYnV0ZSwgY3VzdG9tRWxlbWVudCwgZHluYW1pY09wdGlvbnMsIGVsZW1lbnRDb25maWcsIGlubGluZVZpZXcsIG5vVmlldywgcHJvY2Vzc0F0dHJpYnV0ZXMsIHByb2Nlc3NDb250ZW50LCByZXNvdXJjZSwgdGVtcGxhdGVDb250cm9sbGVyLCB1c2VTaGFkb3dET00sIHVzZVZpZXcsIHVzZVZpZXdTdHJhdGVneSwgdmFsaWRhdGVCZWhhdmlvck5hbWUsIHZpZXcsIHZpZXdFbmdpbmVIb29rcywgdmlld1Jlc291cmNlcywgdmlld1N0cmF0ZWd5IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJlbGlhLXRlbXBsYXRpbmcuanMubWFwXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS10ZW1wbGF0aW5nLmpzXG4vLyBtb2R1bGUgaWQgPSA0NFxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJcblxuZXhwb3J0IHZhciBsb2dMZXZlbCA9IHtcbiAgbm9uZTogMCxcbiAgZXJyb3I6IDEwLFxuICB3YXJuOiAyMCxcbiAgaW5mbzogMzAsXG4gIGRlYnVnOiA0MFxufTtcblxudmFyIGxvZ2dlcnMgPSB7fTtcbnZhciBhcHBlbmRlcnMgPSBbXTtcbnZhciBnbG9iYWxEZWZhdWx0TGV2ZWwgPSBsb2dMZXZlbC5ub25lO1xuXG52YXIgc3RhbmRhcmRMZXZlbHMgPSBbJ25vbmUnLCAnZXJyb3InLCAnd2FybicsICdpbmZvJywgJ2RlYnVnJ107XG5mdW5jdGlvbiBpc1N0YW5kYXJkTGV2ZWwobGV2ZWwpIHtcbiAgcmV0dXJuIHN0YW5kYXJkTGV2ZWxzLmZpbHRlcihmdW5jdGlvbiAobCkge1xuICAgIHJldHVybiBsID09PSBsZXZlbDtcbiAgfSkubGVuZ3RoID4gMDtcbn1cblxuZnVuY3Rpb24gYXBwZW5kQXJncygpIHtcbiAgcmV0dXJuIFt0aGlzXS5jb25jYXQoQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKSk7XG59XG5cbmZ1bmN0aW9uIGxvZ0ZhY3RvcnkobGV2ZWwpIHtcbiAgdmFyIHRocmVzaG9sZCA9IGxvZ0xldmVsW2xldmVsXTtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5sZXZlbCA8IHRocmVzaG9sZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBhcmdzID0gYXBwZW5kQXJncy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIHZhciBpID0gYXBwZW5kZXJzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB2YXIgX2FwcGVuZGVycyRpO1xuXG4gICAgICAoX2FwcGVuZGVycyRpID0gYXBwZW5kZXJzW2ldKVtsZXZlbF0uYXBwbHkoX2FwcGVuZGVycyRpLCBhcmdzKTtcbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIGxvZ0ZhY3RvcnlDdXN0b20obGV2ZWwpIHtcbiAgdmFyIHRocmVzaG9sZCA9IGxvZ0xldmVsW2xldmVsXTtcbiAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICBpZiAodGhpcy5sZXZlbCA8IHRocmVzaG9sZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZhciBhcmdzID0gYXBwZW5kQXJncy5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIHZhciBpID0gYXBwZW5kZXJzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB2YXIgYXBwZW5kZXIgPSBhcHBlbmRlcnNbaV07XG4gICAgICBpZiAoYXBwZW5kZXJbbGV2ZWxdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgYXBwZW5kZXJbbGV2ZWxdLmFwcGx5KGFwcGVuZGVyLCBhcmdzKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNvbm5lY3RMb2dnZXJzKCkge1xuICB2YXIgcHJvdG8gPSBMb2dnZXIucHJvdG90eXBlO1xuICBmb3IgKHZhciBfbGV2ZWwgaW4gbG9nTGV2ZWwpIHtcbiAgICBpZiAoaXNTdGFuZGFyZExldmVsKF9sZXZlbCkpIHtcbiAgICAgIGlmIChfbGV2ZWwgIT09ICdub25lJykge1xuICAgICAgICBwcm90b1tfbGV2ZWxdID0gbG9nRmFjdG9yeShfbGV2ZWwpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBwcm90b1tfbGV2ZWxdID0gbG9nRmFjdG9yeUN1c3RvbShfbGV2ZWwpO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBkaXNjb25uZWN0TG9nZ2VycygpIHtcbiAgdmFyIHByb3RvID0gTG9nZ2VyLnByb3RvdHlwZTtcbiAgZm9yICh2YXIgX2xldmVsMiBpbiBsb2dMZXZlbCkge1xuICAgIGlmIChfbGV2ZWwyICE9PSAnbm9uZScpIHtcbiAgICAgIHByb3RvW19sZXZlbDJdID0gZnVuY3Rpb24gKCkge307XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRMb2dnZXIoaWQpIHtcbiAgcmV0dXJuIGxvZ2dlcnNbaWRdIHx8IG5ldyBMb2dnZXIoaWQpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gYWRkQXBwZW5kZXIoYXBwZW5kZXIpIHtcbiAgaWYgKGFwcGVuZGVycy5wdXNoKGFwcGVuZGVyKSA9PT0gMSkge1xuICAgIGNvbm5lY3RMb2dnZXJzKCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUFwcGVuZGVyKGFwcGVuZGVyKSB7XG4gIGFwcGVuZGVycyA9IGFwcGVuZGVycy5maWx0ZXIoZnVuY3Rpb24gKGEpIHtcbiAgICByZXR1cm4gYSAhPT0gYXBwZW5kZXI7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0QXBwZW5kZXJzKCkge1xuICByZXR1cm4gW10uY29uY2F0KGFwcGVuZGVycyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjbGVhckFwcGVuZGVycygpIHtcbiAgYXBwZW5kZXJzID0gW107XG4gIGRpc2Nvbm5lY3RMb2dnZXJzKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhZGRDdXN0b21MZXZlbChuYW1lLCB2YWx1ZSkge1xuICBpZiAobG9nTGV2ZWxbbmFtZV0gIT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IEVycm9yKCdMb2cgbGV2ZWwgXCInICsgbmFtZSArICdcIiBhbHJlYWR5IGV4aXN0cy4nKTtcbiAgfVxuXG4gIGlmIChpc05hTih2YWx1ZSkpIHtcbiAgICB0aHJvdyBFcnJvcignVmFsdWUgbXVzdCBiZSBhIG51bWJlci4nKTtcbiAgfVxuXG4gIGxvZ0xldmVsW25hbWVdID0gdmFsdWU7XG5cbiAgaWYgKGFwcGVuZGVycy5sZW5ndGggPiAwKSB7XG4gICAgY29ubmVjdExvZ2dlcnMoKTtcbiAgfSBlbHNlIHtcbiAgICBMb2dnZXIucHJvdG90eXBlW25hbWVdID0gZnVuY3Rpb24gKCkge307XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlbW92ZUN1c3RvbUxldmVsKG5hbWUpIHtcbiAgaWYgKGxvZ0xldmVsW25hbWVdID09PSB1bmRlZmluZWQpIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBpZiAoaXNTdGFuZGFyZExldmVsKG5hbWUpKSB7XG4gICAgdGhyb3cgRXJyb3IoJ0J1aWx0LWluIGxvZyBsZXZlbCBcIicgKyBuYW1lICsgJ1wiIGNhbm5vdCBiZSByZW1vdmVkLicpO1xuICB9XG5cbiAgZGVsZXRlIGxvZ0xldmVsW25hbWVdO1xuICBkZWxldGUgTG9nZ2VyLnByb3RvdHlwZVtuYW1lXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldExldmVsKGxldmVsKSB7XG4gIGdsb2JhbERlZmF1bHRMZXZlbCA9IGxldmVsO1xuICBmb3IgKHZhciBrZXkgaW4gbG9nZ2Vycykge1xuICAgIGxvZ2dlcnNba2V5XS5zZXRMZXZlbChsZXZlbCk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldExldmVsKCkge1xuICByZXR1cm4gZ2xvYmFsRGVmYXVsdExldmVsO1xufVxuXG5leHBvcnQgdmFyIExvZ2dlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gTG9nZ2VyKGlkKSB7XG4gICAgXG5cbiAgICB2YXIgY2FjaGVkID0gbG9nZ2Vyc1tpZF07XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICB9XG5cbiAgICBsb2dnZXJzW2lkXSA9IHRoaXM7XG4gICAgdGhpcy5pZCA9IGlkO1xuICAgIHRoaXMubGV2ZWwgPSBnbG9iYWxEZWZhdWx0TGV2ZWw7XG4gIH1cblxuICBMb2dnZXIucHJvdG90eXBlLmRlYnVnID0gZnVuY3Rpb24gZGVidWcobWVzc2FnZSkge307XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS5pbmZvID0gZnVuY3Rpb24gaW5mbyhtZXNzYWdlKSB7fTtcblxuICBMb2dnZXIucHJvdG90eXBlLndhcm4gPSBmdW5jdGlvbiB3YXJuKG1lc3NhZ2UpIHt9O1xuXG4gIExvZ2dlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvcihtZXNzYWdlKSB7fTtcblxuICBMb2dnZXIucHJvdG90eXBlLnNldExldmVsID0gZnVuY3Rpb24gc2V0TGV2ZWwobGV2ZWwpIHtcbiAgICB0aGlzLmxldmVsID0gbGV2ZWw7XG4gIH07XG5cbiAgTG9nZ2VyLnByb3RvdHlwZS5pc0RlYnVnRW5hYmxlZCA9IGZ1bmN0aW9uIGlzRGVidWdFbmFibGVkKCkge1xuICAgIHJldHVybiB0aGlzLmxldmVsID09PSBsb2dMZXZlbC5kZWJ1ZztcbiAgfTtcblxuICByZXR1cm4gTG9nZ2VyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWxvZ2dpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLWxvZ2dpbmcuanNcbi8vIG1vZHVsZSBpZCA9IDcwXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsImV4cG9ydCB7IF9nZXRBcnJheU9ic2VydmVyIGFzIGdldEFycmF5T2JzZXJ2ZXIgfTtcbmV4cG9ydCB7IF9nZXRNYXBPYnNlcnZlciBhcyBnZXRNYXBPYnNlcnZlciB9O1xuZXhwb3J0IHsgX2dldFNldE9ic2VydmVyIGFzIGdldFNldE9ic2VydmVyIH07XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbnZhciBfdHlwZW9mID0gdHlwZW9mIFN5bWJvbCA9PT0gXCJmdW5jdGlvblwiICYmIHR5cGVvZiBTeW1ib2wuaXRlcmF0b3IgPT09IFwic3ltYm9sXCIgPyBmdW5jdGlvbiAob2JqKSB7IHJldHVybiB0eXBlb2Ygb2JqOyB9IDogZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gb2JqICYmIHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvYmouY29uc3RydWN0b3IgPT09IFN5bWJvbCAmJiBvYmogIT09IFN5bWJvbC5wcm90b3R5cGUgPyBcInN5bWJvbFwiIDogdHlwZW9mIG9iajsgfTtcblxudmFyIF9kZWMsIF9kZWMyLCBfY2xhc3MsIF9kZWMzLCBfY2xhc3MyLCBfZGVjNCwgX2NsYXNzMywgX2RlYzUsIF9jbGFzczUsIF9kZWM2LCBfY2xhc3M3LCBfZGVjNywgX2NsYXNzOCwgX2RlYzgsIF9jbGFzczksIF9kZWM5LCBfY2xhc3MxMCwgX2NsYXNzMTIsIF90ZW1wLCBfZGVjMTAsIF9jbGFzczEzLCBfY2xhc3MxNCwgX3RlbXAyO1xuXG5mdW5jdGlvbiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybihzZWxmLCBjYWxsKSB7IGlmICghc2VsZikgeyB0aHJvdyBuZXcgUmVmZXJlbmNlRXJyb3IoXCJ0aGlzIGhhc24ndCBiZWVuIGluaXRpYWxpc2VkIC0gc3VwZXIoKSBoYXNuJ3QgYmVlbiBjYWxsZWRcIik7IH0gcmV0dXJuIGNhbGwgJiYgKHR5cGVvZiBjYWxsID09PSBcIm9iamVjdFwiIHx8IHR5cGVvZiBjYWxsID09PSBcImZ1bmN0aW9uXCIpID8gY2FsbCA6IHNlbGY7IH1cblxuZnVuY3Rpb24gX2luaGVyaXRzKHN1YkNsYXNzLCBzdXBlckNsYXNzKSB7IGlmICh0eXBlb2Ygc3VwZXJDbGFzcyAhPT0gXCJmdW5jdGlvblwiICYmIHN1cGVyQ2xhc3MgIT09IG51bGwpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgXCIgKyB0eXBlb2Ygc3VwZXJDbGFzcyk7IH0gc3ViQ2xhc3MucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShzdXBlckNsYXNzICYmIHN1cGVyQ2xhc3MucHJvdG90eXBlLCB7IGNvbnN0cnVjdG9yOiB7IHZhbHVlOiBzdWJDbGFzcywgZW51bWVyYWJsZTogZmFsc2UsIHdyaXRhYmxlOiB0cnVlLCBjb25maWd1cmFibGU6IHRydWUgfSB9KTsgaWYgKHN1cGVyQ2xhc3MpIE9iamVjdC5zZXRQcm90b3R5cGVPZiA/IE9iamVjdC5zZXRQcm90b3R5cGVPZihzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOyB9XG5cblxuXG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5pbXBvcnQgeyBQTEFURk9STSwgRE9NIH0gZnJvbSAnYXVyZWxpYS1wYWwnO1xuaW1wb3J0IHsgVGFza1F1ZXVlIH0gZnJvbSAnYXVyZWxpYS10YXNrLXF1ZXVlJztcbmltcG9ydCB7IG1ldGFkYXRhIH0gZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5cbmV4cG9ydCB2YXIgdGFyZ2V0Q29udGV4dCA9ICdCaW5kaW5nOnRhcmdldCc7XG5leHBvcnQgdmFyIHNvdXJjZUNvbnRleHQgPSAnQmluZGluZzpzb3VyY2UnO1xuXG52YXIgbWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNhbWVsQ2FzZShuYW1lKSB7XG4gIGlmIChuYW1lIGluIG1hcCkge1xuICAgIHJldHVybiBtYXBbbmFtZV07XG4gIH1cbiAgdmFyIHJlc3VsdCA9IG5hbWUuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkgKyBuYW1lLnNsaWNlKDEpLnJlcGxhY2UoL1tfLi1dKFxcd3wkKS9nLCBmdW5jdGlvbiAoXywgeCkge1xuICAgIHJldHVybiB4LnRvVXBwZXJDYXNlKCk7XG4gIH0pO1xuICBtYXBbbmFtZV0gPSByZXN1bHQ7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQsIHBhcmVudE92ZXJyaWRlQ29udGV4dCkge1xuICByZXR1cm4ge1xuICAgIGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCxcbiAgICBwYXJlbnRPdmVycmlkZUNvbnRleHQ6IHBhcmVudE92ZXJyaWRlQ29udGV4dCB8fCBudWxsXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb250ZXh0Rm9yKG5hbWUsIHNjb3BlLCBhbmNlc3Rvcikge1xuICB2YXIgb2MgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG5cbiAgaWYgKGFuY2VzdG9yKSB7XG4gICAgd2hpbGUgKGFuY2VzdG9yICYmIG9jKSB7XG4gICAgICBhbmNlc3Rvci0tO1xuICAgICAgb2MgPSBvYy5wYXJlbnRPdmVycmlkZUNvbnRleHQ7XG4gICAgfVxuICAgIGlmIChhbmNlc3RvciB8fCAhb2MpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBuYW1lIGluIG9jID8gb2MgOiBvYy5iaW5kaW5nQ29udGV4dDtcbiAgfVxuXG4gIHdoaWxlIChvYyAmJiAhKG5hbWUgaW4gb2MpICYmICEob2MuYmluZGluZ0NvbnRleHQgJiYgbmFtZSBpbiBvYy5iaW5kaW5nQ29udGV4dCkpIHtcbiAgICBvYyA9IG9jLnBhcmVudE92ZXJyaWRlQ29udGV4dDtcbiAgfVxuICBpZiAob2MpIHtcbiAgICByZXR1cm4gbmFtZSBpbiBvYyA/IG9jIDogb2MuYmluZGluZ0NvbnRleHQ7XG4gIH1cblxuICByZXR1cm4gc2NvcGUuYmluZGluZ0NvbnRleHQgfHwgc2NvcGUub3ZlcnJpZGVDb250ZXh0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlU2NvcGVGb3JUZXN0KGJpbmRpbmdDb250ZXh0LCBwYXJlbnRCaW5kaW5nQ29udGV4dCkge1xuICBpZiAocGFyZW50QmluZGluZ0NvbnRleHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0LFxuICAgICAgb3ZlcnJpZGVDb250ZXh0OiBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQsIGNyZWF0ZU92ZXJyaWRlQ29udGV4dChwYXJlbnRCaW5kaW5nQ29udGV4dCkpXG4gICAgfTtcbiAgfVxuICByZXR1cm4ge1xuICAgIGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCxcbiAgICBvdmVycmlkZUNvbnRleHQ6IGNyZWF0ZU92ZXJyaWRlQ29udGV4dChiaW5kaW5nQ29udGV4dClcbiAgfTtcbn1cblxudmFyIHNsb3ROYW1lcyA9IFtdO1xudmFyIHZlcnNpb25TbG90TmFtZXMgPSBbXTtcbnZhciBsYXN0U2xvdCA9IC0xO1xuZnVuY3Rpb24gZW5zdXJlRW5vdWdoU2xvdE5hbWVzKGN1cnJlbnRTbG90KSB7XG4gIGlmIChjdXJyZW50U2xvdCA9PT0gbGFzdFNsb3QpIHtcbiAgICBsYXN0U2xvdCArPSA1O1xuICAgIHZhciBpaSA9IHNsb3ROYW1lcy5sZW5ndGggPSB2ZXJzaW9uU2xvdE5hbWVzLmxlbmd0aCA9IGxhc3RTbG90ICsgMTtcbiAgICBmb3IgKHZhciBpID0gY3VycmVudFNsb3QgKyAxOyBpIDwgaWk7ICsraSkge1xuICAgICAgc2xvdE5hbWVzW2ldID0gJ19vYnNlcnZlcicgKyBpO1xuICAgICAgdmVyc2lvblNsb3ROYW1lc1tpXSA9ICdfb2JzZXJ2ZXJWZXJzaW9uJyArIGk7XG4gICAgfVxuICB9XG59XG5lbnN1cmVFbm91Z2hTbG90TmFtZXMoLTEpO1xuXG5mdW5jdGlvbiBhZGRPYnNlcnZlcihvYnNlcnZlcikge1xuICB2YXIgb2JzZXJ2ZXJTbG90cyA9IHRoaXMuX29ic2VydmVyU2xvdHMgPT09IHVuZGVmaW5lZCA/IDAgOiB0aGlzLl9vYnNlcnZlclNsb3RzO1xuICB2YXIgaSA9IG9ic2VydmVyU2xvdHM7XG4gIHdoaWxlIChpLS0gJiYgdGhpc1tzbG90TmFtZXNbaV1dICE9PSBvYnNlcnZlcikge31cblxuICBpZiAoaSA9PT0gLTEpIHtcbiAgICBpID0gMDtcbiAgICB3aGlsZSAodGhpc1tzbG90TmFtZXNbaV1dKSB7XG4gICAgICBpKys7XG4gICAgfVxuICAgIHRoaXNbc2xvdE5hbWVzW2ldXSA9IG9ic2VydmVyO1xuICAgIG9ic2VydmVyLnN1YnNjcmliZShzb3VyY2VDb250ZXh0LCB0aGlzKTtcblxuICAgIGlmIChpID09PSBvYnNlcnZlclNsb3RzKSB7XG4gICAgICB0aGlzLl9vYnNlcnZlclNsb3RzID0gaSArIDE7XG4gICAgfVxuICB9XG5cbiAgaWYgKHRoaXMuX3ZlcnNpb24gPT09IHVuZGVmaW5lZCkge1xuICAgIHRoaXMuX3ZlcnNpb24gPSAwO1xuICB9XG4gIHRoaXNbdmVyc2lvblNsb3ROYW1lc1tpXV0gPSB0aGlzLl92ZXJzaW9uO1xuICBlbnN1cmVFbm91Z2hTbG90TmFtZXMoaSk7XG59XG5cbmZ1bmN0aW9uIG9ic2VydmVQcm9wZXJ0eShvYmosIHByb3BlcnR5TmFtZSkge1xuICB2YXIgb2JzZXJ2ZXIgPSB0aGlzLm9ic2VydmVyTG9jYXRvci5nZXRPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSk7XG4gIGFkZE9ic2VydmVyLmNhbGwodGhpcywgb2JzZXJ2ZXIpO1xufVxuXG5mdW5jdGlvbiBvYnNlcnZlQXJyYXkoYXJyYXkpIHtcbiAgdmFyIG9ic2VydmVyID0gdGhpcy5vYnNlcnZlckxvY2F0b3IuZ2V0QXJyYXlPYnNlcnZlcihhcnJheSk7XG4gIGFkZE9ic2VydmVyLmNhbGwodGhpcywgb2JzZXJ2ZXIpO1xufVxuXG5mdW5jdGlvbiB1bm9ic2VydmUoYWxsKSB7XG4gIHZhciBpID0gdGhpcy5fb2JzZXJ2ZXJTbG90cztcbiAgd2hpbGUgKGktLSkge1xuICAgIGlmIChhbGwgfHwgdGhpc1t2ZXJzaW9uU2xvdE5hbWVzW2ldXSAhPT0gdGhpcy5fdmVyc2lvbikge1xuICAgICAgdmFyIG9ic2VydmVyID0gdGhpc1tzbG90TmFtZXNbaV1dO1xuICAgICAgdGhpc1tzbG90TmFtZXNbaV1dID0gbnVsbDtcbiAgICAgIGlmIChvYnNlcnZlcikge1xuICAgICAgICBvYnNlcnZlci51bnN1YnNjcmliZShzb3VyY2VDb250ZXh0LCB0aGlzKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbm5lY3RhYmxlKCkge1xuICByZXR1cm4gZnVuY3Rpb24gKHRhcmdldCkge1xuICAgIHRhcmdldC5wcm90b3R5cGUub2JzZXJ2ZVByb3BlcnR5ID0gb2JzZXJ2ZVByb3BlcnR5O1xuICAgIHRhcmdldC5wcm90b3R5cGUub2JzZXJ2ZUFycmF5ID0gb2JzZXJ2ZUFycmF5O1xuICAgIHRhcmdldC5wcm90b3R5cGUudW5vYnNlcnZlID0gdW5vYnNlcnZlO1xuICAgIHRhcmdldC5wcm90b3R5cGUuYWRkT2JzZXJ2ZXIgPSBhZGRPYnNlcnZlcjtcbiAgfTtcbn1cblxudmFyIHF1ZXVlID0gW107XG52YXIgcXVldWVkID0ge307XG52YXIgbmV4dElkID0gMDtcbnZhciBtaW5pbXVtSW1tZWRpYXRlID0gMTAwO1xudmFyIGZyYW1lQnVkZ2V0ID0gMTU7XG5cbnZhciBpc0ZsdXNoUmVxdWVzdGVkID0gZmFsc2U7XG52YXIgaW1tZWRpYXRlID0gMDtcblxuZnVuY3Rpb24gZmx1c2goYW5pbWF0aW9uRnJhbWVTdGFydCkge1xuICB2YXIgbGVuZ3RoID0gcXVldWUubGVuZ3RoO1xuICB2YXIgaSA9IDA7XG4gIHdoaWxlIChpIDwgbGVuZ3RoKSB7XG4gICAgdmFyIGJpbmRpbmcgPSBxdWV1ZVtpXTtcbiAgICBxdWV1ZWRbYmluZGluZy5fX2Nvbm5lY3RRdWV1ZUlkXSA9IGZhbHNlO1xuICAgIGJpbmRpbmcuY29ubmVjdCh0cnVlKTtcbiAgICBpKys7XG5cbiAgICBpZiAoaSAlIDEwMCA9PT0gMCAmJiBQTEFURk9STS5wZXJmb3JtYW5jZS5ub3coKSAtIGFuaW1hdGlvbkZyYW1lU3RhcnQgPiBmcmFtZUJ1ZGdldCkge1xuICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHF1ZXVlLnNwbGljZSgwLCBpKTtcblxuICBpZiAocXVldWUubGVuZ3RoKSB7XG4gICAgUExBVEZPUk0ucmVxdWVzdEFuaW1hdGlvbkZyYW1lKGZsdXNoKTtcbiAgfSBlbHNlIHtcbiAgICBpc0ZsdXNoUmVxdWVzdGVkID0gZmFsc2U7XG4gICAgaW1tZWRpYXRlID0gMDtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5xdWV1ZUJpbmRpbmdDb25uZWN0KGJpbmRpbmcpIHtcbiAgaWYgKGltbWVkaWF0ZSA8IG1pbmltdW1JbW1lZGlhdGUpIHtcbiAgICBpbW1lZGlhdGUrKztcbiAgICBiaW5kaW5nLmNvbm5lY3QoZmFsc2UpO1xuICB9IGVsc2Uge1xuICAgIHZhciBpZCA9IGJpbmRpbmcuX19jb25uZWN0UXVldWVJZDtcbiAgICBpZiAoaWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgaWQgPSBuZXh0SWQ7XG4gICAgICBuZXh0SWQrKztcbiAgICAgIGJpbmRpbmcuX19jb25uZWN0UXVldWVJZCA9IGlkO1xuICAgIH1cblxuICAgIGlmICghcXVldWVkW2lkXSkge1xuICAgICAgcXVldWUucHVzaChiaW5kaW5nKTtcbiAgICAgIHF1ZXVlZFtpZF0gPSB0cnVlO1xuICAgIH1cbiAgfVxuICBpZiAoIWlzRmx1c2hSZXF1ZXN0ZWQpIHtcbiAgICBpc0ZsdXNoUmVxdWVzdGVkID0gdHJ1ZTtcbiAgICBQTEFURk9STS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZmx1c2gpO1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzZXRDb25uZWN0UXVldWVUaHJlc2hvbGQodmFsdWUpIHtcbiAgbWluaW11bUltbWVkaWF0ZSA9IHZhbHVlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlQ29ubmVjdFF1ZXVlKCkge1xuICBzZXRDb25uZWN0UXVldWVUaHJlc2hvbGQoMTAwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRpc2FibGVDb25uZWN0UXVldWUoKSB7XG4gIHNldENvbm5lY3RRdWV1ZVRocmVzaG9sZChOdW1iZXIuTUFYX1NBRkVfSU5URUdFUik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb25uZWN0UXVldWVTaXplKCkge1xuICByZXR1cm4gcXVldWUubGVuZ3RoO1xufVxuXG5mdW5jdGlvbiBhZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gIGlmICh0aGlzLmhhc1N1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpKSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIGlmICghdGhpcy5fY29udGV4dDApIHtcbiAgICB0aGlzLl9jb250ZXh0MCA9IGNvbnRleHQ7XG4gICAgdGhpcy5fY2FsbGFibGUwID0gY2FsbGFibGU7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKCF0aGlzLl9jb250ZXh0MSkge1xuICAgIHRoaXMuX2NvbnRleHQxID0gY29udGV4dDtcbiAgICB0aGlzLl9jYWxsYWJsZTEgPSBjYWxsYWJsZTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoIXRoaXMuX2NvbnRleHQyKSB7XG4gICAgdGhpcy5fY29udGV4dDIgPSBjb250ZXh0O1xuICAgIHRoaXMuX2NhbGxhYmxlMiA9IGNhbGxhYmxlO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICghdGhpcy5fY29udGV4dHNSZXN0KSB7XG4gICAgdGhpcy5fY29udGV4dHNSZXN0ID0gW2NvbnRleHRdO1xuICAgIHRoaXMuX2NhbGxhYmxlc1Jlc3QgPSBbY2FsbGFibGVdO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHRoaXMuX2NvbnRleHRzUmVzdC5wdXNoKGNvbnRleHQpO1xuICB0aGlzLl9jYWxsYWJsZXNSZXN0LnB1c2goY2FsbGFibGUpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkge1xuICBpZiAodGhpcy5fY29udGV4dDAgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUwID09PSBjYWxsYWJsZSkge1xuICAgIHRoaXMuX2NvbnRleHQwID0gbnVsbDtcbiAgICB0aGlzLl9jYWxsYWJsZTAgPSBudWxsO1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmICh0aGlzLl9jb250ZXh0MSA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTEgPT09IGNhbGxhYmxlKSB7XG4gICAgdGhpcy5fY29udGV4dDEgPSBudWxsO1xuICAgIHRoaXMuX2NhbGxhYmxlMSA9IG51bGw7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgaWYgKHRoaXMuX2NvbnRleHQyID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMiA9PT0gY2FsbGFibGUpIHtcbiAgICB0aGlzLl9jb250ZXh0MiA9IG51bGw7XG4gICAgdGhpcy5fY2FsbGFibGUyID0gbnVsbDtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICB2YXIgY2FsbGFibGVzID0gdGhpcy5fY2FsbGFibGVzUmVzdDtcbiAgaWYgKGNhbGxhYmxlcyA9PT0gdW5kZWZpbmVkIHx8IGNhbGxhYmxlcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgdmFyIGNvbnRleHRzID0gdGhpcy5fY29udGV4dHNSZXN0O1xuICB2YXIgaSA9IDA7XG4gIHdoaWxlICghKGNhbGxhYmxlc1tpXSA9PT0gY2FsbGFibGUgJiYgY29udGV4dHNbaV0gPT09IGNvbnRleHQpICYmIGNhbGxhYmxlcy5sZW5ndGggPiBpKSB7XG4gICAgaSsrO1xuICB9XG4gIGlmIChpID49IGNhbGxhYmxlcy5sZW5ndGgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgY29udGV4dHMuc3BsaWNlKGksIDEpO1xuICBjYWxsYWJsZXMuc3BsaWNlKGksIDEpO1xuICByZXR1cm4gdHJ1ZTtcbn1cblxudmFyIGFycmF5UG9vbDEgPSBbXTtcbnZhciBhcnJheVBvb2wyID0gW107XG52YXIgcG9vbFV0aWxpemF0aW9uID0gW107XG5cbmZ1bmN0aW9uIGNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpIHtcbiAgdmFyIGNvbnRleHQwID0gdGhpcy5fY29udGV4dDA7XG4gIHZhciBjYWxsYWJsZTAgPSB0aGlzLl9jYWxsYWJsZTA7XG4gIHZhciBjb250ZXh0MSA9IHRoaXMuX2NvbnRleHQxO1xuICB2YXIgY2FsbGFibGUxID0gdGhpcy5fY2FsbGFibGUxO1xuICB2YXIgY29udGV4dDIgPSB0aGlzLl9jb250ZXh0MjtcbiAgdmFyIGNhbGxhYmxlMiA9IHRoaXMuX2NhbGxhYmxlMjtcbiAgdmFyIGxlbmd0aCA9IHRoaXMuX2NvbnRleHRzUmVzdCA/IHRoaXMuX2NvbnRleHRzUmVzdC5sZW5ndGggOiAwO1xuICB2YXIgY29udGV4dHNSZXN0ID0gdm9pZCAwO1xuICB2YXIgY2FsbGFibGVzUmVzdCA9IHZvaWQgMDtcbiAgdmFyIHBvb2xJbmRleCA9IHZvaWQgMDtcbiAgdmFyIGkgPSB2b2lkIDA7XG4gIGlmIChsZW5ndGgpIHtcbiAgICBwb29sSW5kZXggPSBwb29sVXRpbGl6YXRpb24ubGVuZ3RoO1xuICAgIHdoaWxlIChwb29sSW5kZXgtLSAmJiBwb29sVXRpbGl6YXRpb25bcG9vbEluZGV4XSkge31cbiAgICBpZiAocG9vbEluZGV4IDwgMCkge1xuICAgICAgcG9vbEluZGV4ID0gcG9vbFV0aWxpemF0aW9uLmxlbmd0aDtcbiAgICAgIGNvbnRleHRzUmVzdCA9IFtdO1xuICAgICAgY2FsbGFibGVzUmVzdCA9IFtdO1xuICAgICAgcG9vbFV0aWxpemF0aW9uLnB1c2godHJ1ZSk7XG4gICAgICBhcnJheVBvb2wxLnB1c2goY29udGV4dHNSZXN0KTtcbiAgICAgIGFycmF5UG9vbDIucHVzaChjYWxsYWJsZXNSZXN0KTtcbiAgICB9IGVsc2Uge1xuICAgICAgcG9vbFV0aWxpemF0aW9uW3Bvb2xJbmRleF0gPSB0cnVlO1xuICAgICAgY29udGV4dHNSZXN0ID0gYXJyYXlQb29sMVtwb29sSW5kZXhdO1xuICAgICAgY2FsbGFibGVzUmVzdCA9IGFycmF5UG9vbDJbcG9vbEluZGV4XTtcbiAgICB9XG5cbiAgICBpID0gbGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGNvbnRleHRzUmVzdFtpXSA9IHRoaXMuX2NvbnRleHRzUmVzdFtpXTtcbiAgICAgIGNhbGxhYmxlc1Jlc3RbaV0gPSB0aGlzLl9jYWxsYWJsZXNSZXN0W2ldO1xuICAgIH1cbiAgfVxuXG4gIGlmIChjb250ZXh0MCkge1xuICAgIGlmIChjYWxsYWJsZTApIHtcbiAgICAgIGNhbGxhYmxlMC5jYWxsKGNvbnRleHQwLCBuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb250ZXh0MChuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH1cbiAgfVxuICBpZiAoY29udGV4dDEpIHtcbiAgICBpZiAoY2FsbGFibGUxKSB7XG4gICAgICBjYWxsYWJsZTEuY2FsbChjb250ZXh0MSwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29udGV4dDEobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgICB9XG4gIH1cbiAgaWYgKGNvbnRleHQyKSB7XG4gICAgaWYgKGNhbGxhYmxlMikge1xuICAgICAgY2FsbGFibGUyLmNhbGwoY29udGV4dDIsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnRleHQyKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgfVxuICB9XG4gIGlmIChsZW5ndGgpIHtcbiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhciBjYWxsYWJsZSA9IGNhbGxhYmxlc1Jlc3RbaV07XG4gICAgICB2YXIgY29udGV4dCA9IGNvbnRleHRzUmVzdFtpXTtcbiAgICAgIGlmIChjYWxsYWJsZSkge1xuICAgICAgICBjYWxsYWJsZS5jYWxsKGNvbnRleHQsIG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb250ZXh0KG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgICB9XG4gICAgICBjb250ZXh0c1Jlc3RbaV0gPSBudWxsO1xuICAgICAgY2FsbGFibGVzUmVzdFtpXSA9IG51bGw7XG4gICAgfVxuICAgIHBvb2xVdGlsaXphdGlvbltwb29sSW5kZXhdID0gZmFsc2U7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFzU3Vic2NyaWJlcnMoKSB7XG4gIHJldHVybiAhISh0aGlzLl9jb250ZXh0MCB8fCB0aGlzLl9jb250ZXh0MSB8fCB0aGlzLl9jb250ZXh0MiB8fCB0aGlzLl9jb250ZXh0c1Jlc3QgJiYgdGhpcy5fY29udGV4dHNSZXN0Lmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIGhhc1N1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgdmFyIGhhcyA9IHRoaXMuX2NvbnRleHQwID09PSBjb250ZXh0ICYmIHRoaXMuX2NhbGxhYmxlMCA9PT0gY2FsbGFibGUgfHwgdGhpcy5fY29udGV4dDEgPT09IGNvbnRleHQgJiYgdGhpcy5fY2FsbGFibGUxID09PSBjYWxsYWJsZSB8fCB0aGlzLl9jb250ZXh0MiA9PT0gY29udGV4dCAmJiB0aGlzLl9jYWxsYWJsZTIgPT09IGNhbGxhYmxlO1xuICBpZiAoaGFzKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgdmFyIGluZGV4ID0gdm9pZCAwO1xuICB2YXIgY29udGV4dHMgPSB0aGlzLl9jb250ZXh0c1Jlc3Q7XG4gIGlmICghY29udGV4dHMgfHwgKGluZGV4ID0gY29udGV4dHMubGVuZ3RoKSA9PT0gMCkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICB2YXIgY2FsbGFibGVzID0gdGhpcy5fY2FsbGFibGVzUmVzdDtcbiAgd2hpbGUgKGluZGV4LS0pIHtcbiAgICBpZiAoY29udGV4dHNbaW5kZXhdID09PSBjb250ZXh0ICYmIGNhbGxhYmxlc1tpbmRleF0gPT09IGNhbGxhYmxlKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSB7XG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0KSB7XG4gICAgdGFyZ2V0LnByb3RvdHlwZS5hZGRTdWJzY3JpYmVyID0gYWRkU3Vic2NyaWJlcjtcbiAgICB0YXJnZXQucHJvdG90eXBlLnJlbW92ZVN1YnNjcmliZXIgPSByZW1vdmVTdWJzY3JpYmVyO1xuICAgIHRhcmdldC5wcm90b3R5cGUuY2FsbFN1YnNjcmliZXJzID0gY2FsbFN1YnNjcmliZXJzO1xuICAgIHRhcmdldC5wcm90b3R5cGUuaGFzU3Vic2NyaWJlcnMgPSBoYXNTdWJzY3JpYmVycztcbiAgICB0YXJnZXQucHJvdG90eXBlLmhhc1N1YnNjcmliZXIgPSBoYXNTdWJzY3JpYmVyO1xuICB9O1xufVxuXG5leHBvcnQgdmFyIEV4cHJlc3Npb25PYnNlcnZlciA9IChfZGVjID0gY29ubmVjdGFibGUoKSwgX2RlYzIgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjKF9jbGFzcyA9IF9kZWMyKF9jbGFzcyA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXhwcmVzc2lvbk9ic2VydmVyKHNjb3BlLCBleHByZXNzaW9uLCBvYnNlcnZlckxvY2F0b3IsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5zY29wZSA9IHNjb3BlO1xuICAgIHRoaXMuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBFeHByZXNzaW9uT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbk9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5leHByZXNzaW9uLmFzc2lnbih0aGlzLnNjb3BlLCBuZXdWYWx1ZSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbk9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKCF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zY29wZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgdGhpcy5leHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zY29wZSk7XG4gICAgfVxuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgY29udGV4dCBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgICAgICAgIF90aGlzLnVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH07XG5cbiAgRXhwcmVzc2lvbk9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy51bm9ic2VydmUodHJ1ZSk7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gdW5kZWZpbmVkO1xuICAgIH1cbiAgfTtcblxuICBFeHByZXNzaW9uT2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKCkge1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMuZXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5vbGRWYWx1ZTtcbiAgICBpZiAobmV3VmFsdWUgIT09IG9sZFZhbHVlKSB7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gbmV3VmFsdWU7XG4gICAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLl92ZXJzaW9uKys7XG4gICAgdGhpcy5leHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zY29wZSk7XG4gICAgdGhpcy51bm9ic2VydmUoZmFsc2UpO1xuICB9O1xuXG4gIHJldHVybiBFeHByZXNzaW9uT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzcykgfHwgX2NsYXNzKTtcblxuZnVuY3Rpb24gaXNJbmRleChzKSB7XG4gIHJldHVybiArcyA9PT0gcyA+Pj4gMDtcbn1cblxuZnVuY3Rpb24gdG9OdW1iZXIocykge1xuICByZXR1cm4gK3M7XG59XG5cbmZ1bmN0aW9uIG5ld1NwbGljZShpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCkge1xuICByZXR1cm4ge1xuICAgIGluZGV4OiBpbmRleCxcbiAgICByZW1vdmVkOiByZW1vdmVkLFxuICAgIGFkZGVkQ291bnQ6IGFkZGVkQ291bnRcbiAgfTtcbn1cblxudmFyIEVESVRfTEVBVkUgPSAwO1xudmFyIEVESVRfVVBEQVRFID0gMTtcbnZhciBFRElUX0FERCA9IDI7XG52YXIgRURJVF9ERUxFVEUgPSAzO1xuXG5mdW5jdGlvbiBBcnJheVNwbGljZSgpIHt9XG5cbkFycmF5U3BsaWNlLnByb3RvdHlwZSA9IHtcbiAgY2FsY0VkaXREaXN0YW5jZXM6IGZ1bmN0aW9uIGNhbGNFZGl0RGlzdGFuY2VzKGN1cnJlbnQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCwgb2xkLCBvbGRTdGFydCwgb2xkRW5kKSB7XG4gICAgdmFyIHJvd0NvdW50ID0gb2xkRW5kIC0gb2xkU3RhcnQgKyAxO1xuICAgIHZhciBjb2x1bW5Db3VudCA9IGN1cnJlbnRFbmQgLSBjdXJyZW50U3RhcnQgKyAxO1xuICAgIHZhciBkaXN0YW5jZXMgPSBuZXcgQXJyYXkocm93Q291bnQpO1xuICAgIHZhciBub3J0aCA9IHZvaWQgMDtcbiAgICB2YXIgd2VzdCA9IHZvaWQgMDtcblxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcm93Q291bnQ7ICsraSkge1xuICAgICAgZGlzdGFuY2VzW2ldID0gbmV3IEFycmF5KGNvbHVtbkNvdW50KTtcbiAgICAgIGRpc3RhbmNlc1tpXVswXSA9IGk7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaiA9IDA7IGogPCBjb2x1bW5Db3VudDsgKytqKSB7XG4gICAgICBkaXN0YW5jZXNbMF1bal0gPSBqO1xuICAgIH1cblxuICAgIGZvciAodmFyIF9pID0gMTsgX2kgPCByb3dDb3VudDsgKytfaSkge1xuICAgICAgZm9yICh2YXIgX2ogPSAxOyBfaiA8IGNvbHVtbkNvdW50OyArK19qKSB7XG4gICAgICAgIGlmICh0aGlzLmVxdWFscyhjdXJyZW50W2N1cnJlbnRTdGFydCArIF9qIC0gMV0sIG9sZFtvbGRTdGFydCArIF9pIC0gMV0pKSB7XG4gICAgICAgICAgZGlzdGFuY2VzW19pXVtfal0gPSBkaXN0YW5jZXNbX2kgLSAxXVtfaiAtIDFdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIG5vcnRoID0gZGlzdGFuY2VzW19pIC0gMV1bX2pdICsgMTtcbiAgICAgICAgICB3ZXN0ID0gZGlzdGFuY2VzW19pXVtfaiAtIDFdICsgMTtcbiAgICAgICAgICBkaXN0YW5jZXNbX2ldW19qXSA9IG5vcnRoIDwgd2VzdCA/IG5vcnRoIDogd2VzdDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBkaXN0YW5jZXM7XG4gIH0sXG5cbiAgc3BsaWNlT3BlcmF0aW9uc0Zyb21FZGl0RGlzdGFuY2VzOiBmdW5jdGlvbiBzcGxpY2VPcGVyYXRpb25zRnJvbUVkaXREaXN0YW5jZXMoZGlzdGFuY2VzKSB7XG4gICAgdmFyIGkgPSBkaXN0YW5jZXMubGVuZ3RoIC0gMTtcbiAgICB2YXIgaiA9IGRpc3RhbmNlc1swXS5sZW5ndGggLSAxO1xuICAgIHZhciBjdXJyZW50ID0gZGlzdGFuY2VzW2ldW2pdO1xuICAgIHZhciBlZGl0cyA9IFtdO1xuICAgIHdoaWxlIChpID4gMCB8fCBqID4gMCkge1xuICAgICAgaWYgKGkgPT09IDApIHtcbiAgICAgICAgZWRpdHMucHVzaChFRElUX0FERCk7XG4gICAgICAgIGotLTtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICBpZiAoaiA9PT0gMCkge1xuICAgICAgICBlZGl0cy5wdXNoKEVESVRfREVMRVRFKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhciBub3J0aFdlc3QgPSBkaXN0YW5jZXNbaSAtIDFdW2ogLSAxXTtcbiAgICAgIHZhciB3ZXN0ID0gZGlzdGFuY2VzW2kgLSAxXVtqXTtcbiAgICAgIHZhciBub3J0aCA9IGRpc3RhbmNlc1tpXVtqIC0gMV07XG5cbiAgICAgIHZhciBtaW4gPSB2b2lkIDA7XG4gICAgICBpZiAod2VzdCA8IG5vcnRoKSB7XG4gICAgICAgIG1pbiA9IHdlc3QgPCBub3J0aFdlc3QgPyB3ZXN0IDogbm9ydGhXZXN0O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWluID0gbm9ydGggPCBub3J0aFdlc3QgPyBub3J0aCA6IG5vcnRoV2VzdDtcbiAgICAgIH1cblxuICAgICAgaWYgKG1pbiA9PT0gbm9ydGhXZXN0KSB7XG4gICAgICAgIGlmIChub3J0aFdlc3QgPT09IGN1cnJlbnQpIHtcbiAgICAgICAgICBlZGl0cy5wdXNoKEVESVRfTEVBVkUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGVkaXRzLnB1c2goRURJVF9VUERBVEUpO1xuICAgICAgICAgIGN1cnJlbnQgPSBub3J0aFdlc3Q7XG4gICAgICAgIH1cbiAgICAgICAgaS0tO1xuICAgICAgICBqLS07XG4gICAgICB9IGVsc2UgaWYgKG1pbiA9PT0gd2VzdCkge1xuICAgICAgICBlZGl0cy5wdXNoKEVESVRfREVMRVRFKTtcbiAgICAgICAgaS0tO1xuICAgICAgICBjdXJyZW50ID0gd2VzdDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVkaXRzLnB1c2goRURJVF9BREQpO1xuICAgICAgICBqLS07XG4gICAgICAgIGN1cnJlbnQgPSBub3J0aDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBlZGl0cy5yZXZlcnNlKCk7XG4gICAgcmV0dXJuIGVkaXRzO1xuICB9LFxuXG4gIGNhbGNTcGxpY2VzOiBmdW5jdGlvbiBjYWxjU3BsaWNlcyhjdXJyZW50LCBjdXJyZW50U3RhcnQsIGN1cnJlbnRFbmQsIG9sZCwgb2xkU3RhcnQsIG9sZEVuZCkge1xuICAgIHZhciBwcmVmaXhDb3VudCA9IDA7XG4gICAgdmFyIHN1ZmZpeENvdW50ID0gMDtcblxuICAgIHZhciBtaW5MZW5ndGggPSBNYXRoLm1pbihjdXJyZW50RW5kIC0gY3VycmVudFN0YXJ0LCBvbGRFbmQgLSBvbGRTdGFydCk7XG4gICAgaWYgKGN1cnJlbnRTdGFydCA9PT0gMCAmJiBvbGRTdGFydCA9PT0gMCkge1xuICAgICAgcHJlZml4Q291bnQgPSB0aGlzLnNoYXJlZFByZWZpeChjdXJyZW50LCBvbGQsIG1pbkxlbmd0aCk7XG4gICAgfVxuXG4gICAgaWYgKGN1cnJlbnRFbmQgPT09IGN1cnJlbnQubGVuZ3RoICYmIG9sZEVuZCA9PT0gb2xkLmxlbmd0aCkge1xuICAgICAgc3VmZml4Q291bnQgPSB0aGlzLnNoYXJlZFN1ZmZpeChjdXJyZW50LCBvbGQsIG1pbkxlbmd0aCAtIHByZWZpeENvdW50KTtcbiAgICB9XG5cbiAgICBjdXJyZW50U3RhcnQgKz0gcHJlZml4Q291bnQ7XG4gICAgb2xkU3RhcnQgKz0gcHJlZml4Q291bnQ7XG4gICAgY3VycmVudEVuZCAtPSBzdWZmaXhDb3VudDtcbiAgICBvbGRFbmQgLT0gc3VmZml4Q291bnQ7XG5cbiAgICBpZiAoY3VycmVudEVuZCAtIGN1cnJlbnRTdGFydCA9PT0gMCAmJiBvbGRFbmQgLSBvbGRTdGFydCA9PT0gMCkge1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cblxuICAgIGlmIChjdXJyZW50U3RhcnQgPT09IGN1cnJlbnRFbmQpIHtcbiAgICAgIHZhciBfc3BsaWNlID0gbmV3U3BsaWNlKGN1cnJlbnRTdGFydCwgW10sIDApO1xuICAgICAgd2hpbGUgKG9sZFN0YXJ0IDwgb2xkRW5kKSB7XG4gICAgICAgIF9zcGxpY2UucmVtb3ZlZC5wdXNoKG9sZFtvbGRTdGFydCsrXSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBbX3NwbGljZV07XG4gICAgfSBlbHNlIGlmIChvbGRTdGFydCA9PT0gb2xkRW5kKSB7XG4gICAgICByZXR1cm4gW25ld1NwbGljZShjdXJyZW50U3RhcnQsIFtdLCBjdXJyZW50RW5kIC0gY3VycmVudFN0YXJ0KV07XG4gICAgfVxuXG4gICAgdmFyIG9wcyA9IHRoaXMuc3BsaWNlT3BlcmF0aW9uc0Zyb21FZGl0RGlzdGFuY2VzKHRoaXMuY2FsY0VkaXREaXN0YW5jZXMoY3VycmVudCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kLCBvbGQsIG9sZFN0YXJ0LCBvbGRFbmQpKTtcblxuICAgIHZhciBzcGxpY2UgPSB1bmRlZmluZWQ7XG4gICAgdmFyIHNwbGljZXMgPSBbXTtcbiAgICB2YXIgaW5kZXggPSBjdXJyZW50U3RhcnQ7XG4gICAgdmFyIG9sZEluZGV4ID0gb2xkU3RhcnQ7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBvcHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHN3aXRjaCAob3BzW2ldKSB7XG4gICAgICAgIGNhc2UgRURJVF9MRUFWRTpcbiAgICAgICAgICBpZiAoc3BsaWNlKSB7XG4gICAgICAgICAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgICAgICAgICAgIHNwbGljZSA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgIG9sZEluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRURJVF9VUERBVEU6XG4gICAgICAgICAgaWYgKCFzcGxpY2UpIHtcbiAgICAgICAgICAgIHNwbGljZSA9IG5ld1NwbGljZShpbmRleCwgW10sIDApO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHNwbGljZS5hZGRlZENvdW50Kys7XG4gICAgICAgICAgaW5kZXgrKztcblxuICAgICAgICAgIHNwbGljZS5yZW1vdmVkLnB1c2gob2xkW29sZEluZGV4XSk7XG4gICAgICAgICAgb2xkSW5kZXgrKztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBFRElUX0FERDpcbiAgICAgICAgICBpZiAoIXNwbGljZSkge1xuICAgICAgICAgICAgc3BsaWNlID0gbmV3U3BsaWNlKGluZGV4LCBbXSwgMCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgc3BsaWNlLmFkZGVkQ291bnQrKztcbiAgICAgICAgICBpbmRleCsrO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEVESVRfREVMRVRFOlxuICAgICAgICAgIGlmICghc3BsaWNlKSB7XG4gICAgICAgICAgICBzcGxpY2UgPSBuZXdTcGxpY2UoaW5kZXgsIFtdLCAwKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBzcGxpY2UucmVtb3ZlZC5wdXNoKG9sZFtvbGRJbmRleF0pO1xuICAgICAgICAgIG9sZEluZGV4Kys7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHNwbGljZSkge1xuICAgICAgc3BsaWNlcy5wdXNoKHNwbGljZSk7XG4gICAgfVxuICAgIHJldHVybiBzcGxpY2VzO1xuICB9LFxuXG4gIHNoYXJlZFByZWZpeDogZnVuY3Rpb24gc2hhcmVkUHJlZml4KGN1cnJlbnQsIG9sZCwgc2VhcmNoTGVuZ3RoKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzZWFyY2hMZW5ndGg7ICsraSkge1xuICAgICAgaWYgKCF0aGlzLmVxdWFscyhjdXJyZW50W2ldLCBvbGRbaV0pKSB7XG4gICAgICAgIHJldHVybiBpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBzZWFyY2hMZW5ndGg7XG4gIH0sXG5cbiAgc2hhcmVkU3VmZml4OiBmdW5jdGlvbiBzaGFyZWRTdWZmaXgoY3VycmVudCwgb2xkLCBzZWFyY2hMZW5ndGgpIHtcbiAgICB2YXIgaW5kZXgxID0gY3VycmVudC5sZW5ndGg7XG4gICAgdmFyIGluZGV4MiA9IG9sZC5sZW5ndGg7XG4gICAgdmFyIGNvdW50ID0gMDtcbiAgICB3aGlsZSAoY291bnQgPCBzZWFyY2hMZW5ndGggJiYgdGhpcy5lcXVhbHMoY3VycmVudFstLWluZGV4MV0sIG9sZFstLWluZGV4Ml0pKSB7XG4gICAgICBjb3VudCsrO1xuICAgIH1cblxuICAgIHJldHVybiBjb3VudDtcbiAgfSxcblxuICBjYWxjdWxhdGVTcGxpY2VzOiBmdW5jdGlvbiBjYWxjdWxhdGVTcGxpY2VzKGN1cnJlbnQsIHByZXZpb3VzKSB7XG4gICAgcmV0dXJuIHRoaXMuY2FsY1NwbGljZXMoY3VycmVudCwgMCwgY3VycmVudC5sZW5ndGgsIHByZXZpb3VzLCAwLCBwcmV2aW91cy5sZW5ndGgpO1xuICB9LFxuXG4gIGVxdWFsczogZnVuY3Rpb24gZXF1YWxzKGN1cnJlbnRWYWx1ZSwgcHJldmlvdXNWYWx1ZSkge1xuICAgIHJldHVybiBjdXJyZW50VmFsdWUgPT09IHByZXZpb3VzVmFsdWU7XG4gIH1cbn07XG5cbnZhciBhcnJheVNwbGljZSA9IG5ldyBBcnJheVNwbGljZSgpO1xuXG5leHBvcnQgZnVuY3Rpb24gY2FsY1NwbGljZXMoY3VycmVudCwgY3VycmVudFN0YXJ0LCBjdXJyZW50RW5kLCBvbGQsIG9sZFN0YXJ0LCBvbGRFbmQpIHtcbiAgcmV0dXJuIGFycmF5U3BsaWNlLmNhbGNTcGxpY2VzKGN1cnJlbnQsIGN1cnJlbnRTdGFydCwgY3VycmVudEVuZCwgb2xkLCBvbGRTdGFydCwgb2xkRW5kKTtcbn1cblxuZnVuY3Rpb24gaW50ZXJzZWN0KHN0YXJ0MSwgZW5kMSwgc3RhcnQyLCBlbmQyKSB7XG4gIGlmIChlbmQxIDwgc3RhcnQyIHx8IGVuZDIgPCBzdGFydDEpIHtcbiAgICByZXR1cm4gLTE7XG4gIH1cblxuICBpZiAoZW5kMSA9PT0gc3RhcnQyIHx8IGVuZDIgPT09IHN0YXJ0MSkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgaWYgKHN0YXJ0MSA8IHN0YXJ0Mikge1xuICAgIGlmIChlbmQxIDwgZW5kMikge1xuICAgICAgcmV0dXJuIGVuZDEgLSBzdGFydDI7XG4gICAgfVxuXG4gICAgcmV0dXJuIGVuZDIgLSBzdGFydDI7XG4gIH1cblxuICBpZiAoZW5kMiA8IGVuZDEpIHtcbiAgICByZXR1cm4gZW5kMiAtIHN0YXJ0MTtcbiAgfVxuXG4gIHJldHVybiBlbmQxIC0gc3RhcnQxO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VTcGxpY2Uoc3BsaWNlcywgaW5kZXgsIHJlbW92ZWQsIGFkZGVkQ291bnQpIHtcbiAgdmFyIHNwbGljZSA9IG5ld1NwbGljZShpbmRleCwgcmVtb3ZlZCwgYWRkZWRDb3VudCk7XG5cbiAgdmFyIGluc2VydGVkID0gZmFsc2U7XG4gIHZhciBpbnNlcnRpb25PZmZzZXQgPSAwO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3BsaWNlcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciBjdXJyZW50ID0gc3BsaWNlc1tpXTtcbiAgICBjdXJyZW50LmluZGV4ICs9IGluc2VydGlvbk9mZnNldDtcblxuICAgIGlmIChpbnNlcnRlZCkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuXG4gICAgdmFyIGludGVyc2VjdENvdW50ID0gaW50ZXJzZWN0KHNwbGljZS5pbmRleCwgc3BsaWNlLmluZGV4ICsgc3BsaWNlLnJlbW92ZWQubGVuZ3RoLCBjdXJyZW50LmluZGV4LCBjdXJyZW50LmluZGV4ICsgY3VycmVudC5hZGRlZENvdW50KTtcblxuICAgIGlmIChpbnRlcnNlY3RDb3VudCA+PSAwKSB7XG5cbiAgICAgIHNwbGljZXMuc3BsaWNlKGksIDEpO1xuICAgICAgaS0tO1xuXG4gICAgICBpbnNlcnRpb25PZmZzZXQgLT0gY3VycmVudC5hZGRlZENvdW50IC0gY3VycmVudC5yZW1vdmVkLmxlbmd0aDtcblxuICAgICAgc3BsaWNlLmFkZGVkQ291bnQgKz0gY3VycmVudC5hZGRlZENvdW50IC0gaW50ZXJzZWN0Q291bnQ7XG4gICAgICB2YXIgZGVsZXRlQ291bnQgPSBzcGxpY2UucmVtb3ZlZC5sZW5ndGggKyBjdXJyZW50LnJlbW92ZWQubGVuZ3RoIC0gaW50ZXJzZWN0Q291bnQ7XG5cbiAgICAgIGlmICghc3BsaWNlLmFkZGVkQ291bnQgJiYgIWRlbGV0ZUNvdW50KSB7XG4gICAgICAgIGluc2VydGVkID0gdHJ1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBjdXJyZW50UmVtb3ZlZCA9IGN1cnJlbnQucmVtb3ZlZDtcblxuICAgICAgICBpZiAoc3BsaWNlLmluZGV4IDwgY3VycmVudC5pbmRleCkge1xuICAgICAgICAgIHZhciBwcmVwZW5kID0gc3BsaWNlLnJlbW92ZWQuc2xpY2UoMCwgY3VycmVudC5pbmRleCAtIHNwbGljZS5pbmRleCk7XG4gICAgICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkocHJlcGVuZCwgY3VycmVudFJlbW92ZWQpO1xuICAgICAgICAgIGN1cnJlbnRSZW1vdmVkID0gcHJlcGVuZDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzcGxpY2UuaW5kZXggKyBzcGxpY2UucmVtb3ZlZC5sZW5ndGggPiBjdXJyZW50LmluZGV4ICsgY3VycmVudC5hZGRlZENvdW50KSB7XG4gICAgICAgICAgdmFyIGFwcGVuZCA9IHNwbGljZS5yZW1vdmVkLnNsaWNlKGN1cnJlbnQuaW5kZXggKyBjdXJyZW50LmFkZGVkQ291bnQgLSBzcGxpY2UuaW5kZXgpO1xuICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KGN1cnJlbnRSZW1vdmVkLCBhcHBlbmQpO1xuICAgICAgICB9XG5cbiAgICAgICAgc3BsaWNlLnJlbW92ZWQgPSBjdXJyZW50UmVtb3ZlZDtcbiAgICAgICAgaWYgKGN1cnJlbnQuaW5kZXggPCBzcGxpY2UuaW5kZXgpIHtcbiAgICAgICAgICBzcGxpY2UuaW5kZXggPSBjdXJyZW50LmluZGV4O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChzcGxpY2UuaW5kZXggPCBjdXJyZW50LmluZGV4KSB7XG5cbiAgICAgIGluc2VydGVkID0gdHJ1ZTtcblxuICAgICAgc3BsaWNlcy5zcGxpY2UoaSwgMCwgc3BsaWNlKTtcbiAgICAgIGkrKztcblxuICAgICAgdmFyIG9mZnNldCA9IHNwbGljZS5hZGRlZENvdW50IC0gc3BsaWNlLnJlbW92ZWQubGVuZ3RoO1xuICAgICAgY3VycmVudC5pbmRleCArPSBvZmZzZXQ7XG4gICAgICBpbnNlcnRpb25PZmZzZXQgKz0gb2Zmc2V0O1xuICAgIH1cbiAgfVxuXG4gIGlmICghaW5zZXJ0ZWQpIHtcbiAgICBzcGxpY2VzLnB1c2goc3BsaWNlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVJbml0aWFsU3BsaWNlcyhhcnJheSwgY2hhbmdlUmVjb3Jkcykge1xuICB2YXIgc3BsaWNlcyA9IFtdO1xuXG4gIGZvciAodmFyIGkgPSAwOyBpIDwgY2hhbmdlUmVjb3Jkcy5sZW5ndGg7IGkrKykge1xuICAgIHZhciByZWNvcmQgPSBjaGFuZ2VSZWNvcmRzW2ldO1xuICAgIHN3aXRjaCAocmVjb3JkLnR5cGUpIHtcbiAgICAgIGNhc2UgJ3NwbGljZSc6XG4gICAgICAgIG1lcmdlU3BsaWNlKHNwbGljZXMsIHJlY29yZC5pbmRleCwgcmVjb3JkLnJlbW92ZWQuc2xpY2UoKSwgcmVjb3JkLmFkZGVkQ291bnQpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2FkZCc6XG4gICAgICBjYXNlICd1cGRhdGUnOlxuICAgICAgY2FzZSAnZGVsZXRlJzpcbiAgICAgICAgaWYgKCFpc0luZGV4KHJlY29yZC5uYW1lKSkge1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGluZGV4ID0gdG9OdW1iZXIocmVjb3JkLm5hbWUpO1xuICAgICAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBtZXJnZVNwbGljZShzcGxpY2VzLCBpbmRleCwgW3JlY29yZC5vbGRWYWx1ZV0sIHJlY29yZC50eXBlID09PSAnZGVsZXRlJyA/IDAgOiAxKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLmVycm9yKCdVbmV4cGVjdGVkIHJlY29yZCB0eXBlOiAnICsgSlNPTi5zdHJpbmdpZnkocmVjb3JkKSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBzcGxpY2VzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvamVjdEFycmF5U3BsaWNlcyhhcnJheSwgY2hhbmdlUmVjb3Jkcykge1xuICB2YXIgc3BsaWNlcyA9IFtdO1xuXG4gIGNyZWF0ZUluaXRpYWxTcGxpY2VzKGFycmF5LCBjaGFuZ2VSZWNvcmRzKS5mb3JFYWNoKGZ1bmN0aW9uIChzcGxpY2UpIHtcbiAgICBpZiAoc3BsaWNlLmFkZGVkQ291bnQgPT09IDEgJiYgc3BsaWNlLnJlbW92ZWQubGVuZ3RoID09PSAxKSB7XG4gICAgICBpZiAoc3BsaWNlLnJlbW92ZWRbMF0gIT09IGFycmF5W3NwbGljZS5pbmRleF0pIHtcbiAgICAgICAgc3BsaWNlcy5wdXNoKHNwbGljZSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzcGxpY2VzID0gc3BsaWNlcy5jb25jYXQoY2FsY1NwbGljZXMoYXJyYXksIHNwbGljZS5pbmRleCwgc3BsaWNlLmluZGV4ICsgc3BsaWNlLmFkZGVkQ291bnQsIHNwbGljZS5yZW1vdmVkLCAwLCBzcGxpY2UucmVtb3ZlZC5sZW5ndGgpKTtcbiAgfSk7XG5cbiAgcmV0dXJuIHNwbGljZXM7XG59XG5cbmZ1bmN0aW9uIG5ld1JlY29yZCh0eXBlLCBvYmplY3QsIGtleSwgb2xkVmFsdWUpIHtcbiAgcmV0dXJuIHtcbiAgICB0eXBlOiB0eXBlLFxuICAgIG9iamVjdDogb2JqZWN0LFxuICAgIGtleToga2V5LFxuICAgIG9sZFZhbHVlOiBvbGRWYWx1ZVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2hhbmdlUmVjb3JkcyhtYXApIHtcbiAgdmFyIGVudHJpZXMgPSBuZXcgQXJyYXkobWFwLnNpemUpO1xuICB2YXIga2V5cyA9IG1hcC5rZXlzKCk7XG4gIHZhciBpID0gMDtcbiAgdmFyIGl0ZW0gPSB2b2lkIDA7XG5cbiAgd2hpbGUgKGl0ZW0gPSBrZXlzLm5leHQoKSkge1xuICAgIGlmIChpdGVtLmRvbmUpIHtcbiAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIGVudHJpZXNbaV0gPSBuZXdSZWNvcmQoJ2FkZGVkJywgbWFwLCBpdGVtLnZhbHVlKTtcbiAgICBpKys7XG4gIH1cblxuICByZXR1cm4gZW50cmllcztcbn1cblxuZXhwb3J0IHZhciBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIgPSAoX2RlYzMgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjMyhfY2xhc3MyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIodGFza1F1ZXVlLCBjb2xsZWN0aW9uKSB7XG4gICAgXG5cbiAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcbiAgICB0aGlzLnF1ZXVlZCA9IGZhbHNlO1xuICAgIHRoaXMuY2hhbmdlUmVjb3JkcyA9IG51bGw7XG4gICAgdGhpcy5vbGRDb2xsZWN0aW9uID0gbnVsbDtcbiAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIHRoaXMubGVuZ3RoUHJvcGVydHlOYW1lID0gY29sbGVjdGlvbiBpbnN0YW5jZW9mIE1hcCB8fCBjb2xsZWN0aW9uIGluc3RhbmNlb2YgU2V0ID8gJ3NpemUnIDogJ2xlbmd0aCc7XG4gIH1cblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgdGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLmFkZENoYW5nZVJlY29yZCA9IGZ1bmN0aW9uIGFkZENoYW5nZVJlY29yZChjaGFuZ2VSZWNvcmQpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSAmJiAhdGhpcy5sZW5ndGhPYnNlcnZlcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjaGFuZ2VSZWNvcmQudHlwZSA9PT0gJ3NwbGljZScpIHtcbiAgICAgIHZhciBpbmRleCA9IGNoYW5nZVJlY29yZC5pbmRleDtcbiAgICAgIHZhciBhcnJheUxlbmd0aCA9IGNoYW5nZVJlY29yZC5vYmplY3QubGVuZ3RoO1xuICAgICAgaWYgKGluZGV4ID4gYXJyYXlMZW5ndGgpIHtcbiAgICAgICAgaW5kZXggPSBhcnJheUxlbmd0aCAtIGNoYW5nZVJlY29yZC5hZGRlZENvdW50O1xuICAgICAgfSBlbHNlIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSBhcnJheUxlbmd0aCArIGNoYW5nZVJlY29yZC5yZW1vdmVkLmxlbmd0aCArIGluZGV4IC0gY2hhbmdlUmVjb3JkLmFkZGVkQ291bnQ7XG4gICAgICB9XG4gICAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgIGluZGV4ID0gMDtcbiAgICAgIH1cbiAgICAgIGNoYW5nZVJlY29yZC5pbmRleCA9IGluZGV4O1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNoYW5nZVJlY29yZHMgPT09IG51bGwpIHtcbiAgICAgIHRoaXMuY2hhbmdlUmVjb3JkcyA9IFtjaGFuZ2VSZWNvcmRdO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmNoYW5nZVJlY29yZHMucHVzaChjaGFuZ2VSZWNvcmQpO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5xdWV1ZWQpIHtcbiAgICAgIHRoaXMucXVldWVkID0gdHJ1ZTtcbiAgICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLmZsdXNoQ2hhbmdlUmVjb3JkcyA9IGZ1bmN0aW9uIGZsdXNoQ2hhbmdlUmVjb3JkcygpIHtcbiAgICBpZiAodGhpcy5jaGFuZ2VSZWNvcmRzICYmIHRoaXMuY2hhbmdlUmVjb3Jkcy5sZW5ndGggfHwgdGhpcy5vbGRDb2xsZWN0aW9uKSB7XG4gICAgICB0aGlzLmNhbGwoKTtcbiAgICB9XG4gIH07XG5cbiAgTW9kaWZ5Q29sbGVjdGlvbk9ic2VydmVyLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uIHJlc2V0KG9sZENvbGxlY3Rpb24pIHtcbiAgICB0aGlzLm9sZENvbGxlY3Rpb24gPSBvbGRDb2xsZWN0aW9uO1xuXG4gICAgaWYgKHRoaXMuaGFzU3Vic2NyaWJlcnMoKSAmJiAhdGhpcy5xdWV1ZWQpIHtcbiAgICAgIHRoaXMucXVldWVkID0gdHJ1ZTtcbiAgICAgIHRoaXMudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIucHJvdG90eXBlLmdldExlbmd0aE9ic2VydmVyID0gZnVuY3Rpb24gZ2V0TGVuZ3RoT2JzZXJ2ZXIoKSB7XG4gICAgcmV0dXJuIHRoaXMubGVuZ3RoT2JzZXJ2ZXIgfHwgKHRoaXMubGVuZ3RoT2JzZXJ2ZXIgPSBuZXcgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyKHRoaXMuY29sbGVjdGlvbikpO1xuICB9O1xuXG4gIE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlci5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoKSB7XG4gICAgdmFyIGNoYW5nZVJlY29yZHMgPSB0aGlzLmNoYW5nZVJlY29yZHM7XG4gICAgdmFyIG9sZENvbGxlY3Rpb24gPSB0aGlzLm9sZENvbGxlY3Rpb247XG4gICAgdmFyIHJlY29yZHMgPSB2b2lkIDA7XG5cbiAgICB0aGlzLnF1ZXVlZCA9IGZhbHNlO1xuICAgIHRoaXMuY2hhbmdlUmVjb3JkcyA9IFtdO1xuICAgIHRoaXMub2xkQ29sbGVjdGlvbiA9IG51bGw7XG5cbiAgICBpZiAodGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICBpZiAob2xkQ29sbGVjdGlvbikge1xuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uIGluc3RhbmNlb2YgTWFwIHx8IHRoaXMuY29sbGVjdGlvbiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgICAgIHJlY29yZHMgPSBnZXRDaGFuZ2VSZWNvcmRzKG9sZENvbGxlY3Rpb24pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlY29yZHMgPSBjYWxjU3BsaWNlcyh0aGlzLmNvbGxlY3Rpb24sIDAsIHRoaXMuY29sbGVjdGlvbi5sZW5ndGgsIG9sZENvbGxlY3Rpb24sIDAsIG9sZENvbGxlY3Rpb24ubGVuZ3RoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHRoaXMuY29sbGVjdGlvbiBpbnN0YW5jZW9mIE1hcCB8fCB0aGlzLmNvbGxlY3Rpb24gaW5zdGFuY2VvZiBTZXQpIHtcbiAgICAgICAgICByZWNvcmRzID0gY2hhbmdlUmVjb3JkcztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWNvcmRzID0gcHJvamVjdEFycmF5U3BsaWNlcyh0aGlzLmNvbGxlY3Rpb24sIGNoYW5nZVJlY29yZHMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKHJlY29yZHMpO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmxlbmd0aE9ic2VydmVyKSB7XG4gICAgICB0aGlzLmxlbmd0aE9ic2VydmVyLmNhbGwodGhpcy5jb2xsZWN0aW9uW3RoaXMubGVuZ3RoUHJvcGVydHlOYW1lXSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczIpO1xuXG5leHBvcnQgdmFyIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlciA9IChfZGVjNCA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM0KF9jbGFzczMgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlcihjb2xsZWN0aW9uKSB7XG4gICAgXG5cbiAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb2xsZWN0aW9uO1xuICAgIHRoaXMubGVuZ3RoUHJvcGVydHlOYW1lID0gY29sbGVjdGlvbiBpbnN0YW5jZW9mIE1hcCB8fCBjb2xsZWN0aW9uIGluc3RhbmNlb2YgU2V0ID8gJ3NpemUnIDogJ2xlbmd0aCc7XG4gICAgdGhpcy5jdXJyZW50VmFsdWUgPSBjb2xsZWN0aW9uW3RoaXMubGVuZ3RoUHJvcGVydHlOYW1lXTtcbiAgfVxuXG4gIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5jb2xsZWN0aW9uW3RoaXMubGVuZ3RoUHJvcGVydHlOYW1lXTtcbiAgfTtcblxuICBDb2xsZWN0aW9uTGVuZ3RoT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB0aGlzLmNvbGxlY3Rpb25bdGhpcy5sZW5ndGhQcm9wZXJ0eU5hbWVdID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIENvbGxlY3Rpb25MZW5ndGhPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbChuZXdWYWx1ZSkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gICAgdGhpcy5jdXJyZW50VmFsdWUgPSBuZXdWYWx1ZTtcbiAgfTtcblxuICByZXR1cm4gQ29sbGVjdGlvbkxlbmd0aE9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3MzKTtcblxudmFyIGFycmF5UHJvdG8gPSBBcnJheS5wcm90b3R5cGU7XG52YXIgcG9wID0gYXJyYXlQcm90by5wb3A7XG52YXIgcHVzaCA9IGFycmF5UHJvdG8ucHVzaDtcbnZhciByZXZlcnNlID0gYXJyYXlQcm90by5yZXZlcnNlO1xudmFyIHNoaWZ0ID0gYXJyYXlQcm90by5zaGlmdDtcbnZhciBzb3J0ID0gYXJyYXlQcm90by5zb3J0O1xudmFyIHNwbGljZSA9IGFycmF5UHJvdG8uc3BsaWNlO1xudmFyIHVuc2hpZnQgPSBhcnJheVByb3RvLnVuc2hpZnQ7XG5cbmlmIChhcnJheVByb3RvLl9fYXVfcGF0Y2hlZF9fKSB7XG4gIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdhcnJheS1vYnNlcnZhdGlvbicpLndhcm4oJ0RldGVjdGVkIDJuZCBhdHRlbXB0IG9mIHBhdGNoaW5nIGFycmF5IGZyb20gQXVyZWxpYSBiaW5kaW5nLicgKyAnIFRoaXMgaXMgcHJvYmFibHkgY2F1c2VkIGJ5IGRlcGVuZGVuY3kgbWlzbWF0Y2ggYmV0d2VlbiBjb3JlIG1vZHVsZXMgYW5kIGEgM3JkIHBhcnR5IHBsdWdpbi4nICsgJyBQbGVhc2Ugc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hdXJlbGlhL2NsaS9wdWxsLzkwNiBpZiB5b3UgYXJlIHVzaW5nIHdlYnBhY2suJyk7XG59IGVsc2Uge1xuICBSZWZsZWN0LmRlZmluZVByb3BlcnR5KGFycmF5UHJvdG8sICdfX2F1X3BhdGNoZWRfXycsIHsgdmFsdWU6IDEgfSk7XG4gIGFycmF5UHJvdG8ucG9wID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBub3RFbXB0eSA9IHRoaXMubGVuZ3RoID4gMDtcbiAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHBvcC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIGlmIChub3RFbXB0eSAmJiB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgb2JqZWN0OiB0aGlzLFxuICAgICAgICBuYW1lOiB0aGlzLmxlbmd0aCxcbiAgICAgICAgb2xkVmFsdWU6IG1ldGhvZENhbGxSZXN1bHRcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWV0aG9kQ2FsbFJlc3VsdDtcbiAgfTtcblxuICBhcnJheVByb3RvLnB1c2ggPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwdXNoLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdzcGxpY2UnLFxuICAgICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICAgIGluZGV4OiB0aGlzLmxlbmd0aCAtIGFyZ3VtZW50cy5sZW5ndGgsXG4gICAgICAgIHJlbW92ZWQ6IFtdLFxuICAgICAgICBhZGRlZENvdW50OiBhcmd1bWVudHMubGVuZ3RoXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG5cbiAgYXJyYXlQcm90by5yZXZlcnNlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBvbGRBcnJheSA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uZmx1c2hDaGFuZ2VSZWNvcmRzKCk7XG4gICAgICBvbGRBcnJheSA9IHRoaXMuc2xpY2UoKTtcbiAgICB9XG4gICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSByZXZlcnNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLnJlc2V0KG9sZEFycmF5KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG5cbiAgYXJyYXlQcm90by5zaGlmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm90RW1wdHkgPSB0aGlzLmxlbmd0aCA+IDA7XG4gICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBzaGlmdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIGlmIChub3RFbXB0eSAmJiB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICB0eXBlOiAnZGVsZXRlJyxcbiAgICAgICAgb2JqZWN0OiB0aGlzLFxuICAgICAgICBuYW1lOiAwLFxuICAgICAgICBvbGRWYWx1ZTogbWV0aG9kQ2FsbFJlc3VsdFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICB9O1xuXG4gIGFycmF5UHJvdG8uc29ydCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgb2xkQXJyYXkgPSB2b2lkIDA7XG4gICAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmZsdXNoQ2hhbmdlUmVjb3JkcygpO1xuICAgICAgb2xkQXJyYXkgPSB0aGlzLnNsaWNlKCk7XG4gICAgfVxuICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gc29ydC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIGlmICh0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aGlzLl9fYXJyYXlfb2JzZXJ2ZXJfXy5yZXNldChvbGRBcnJheSk7XG4gICAgfVxuICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICB9O1xuXG4gIGFycmF5UHJvdG8uc3BsaWNlID0gZnVuY3Rpb24gKCkge1xuICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gc3BsaWNlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgaWYgKHRoaXMuX19hcnJheV9vYnNlcnZlcl9fICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuX19hcnJheV9vYnNlcnZlcl9fLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdzcGxpY2UnLFxuICAgICAgICBvYmplY3Q6IHRoaXMsXG4gICAgICAgIGluZGV4OiArYXJndW1lbnRzWzBdLFxuICAgICAgICByZW1vdmVkOiBtZXRob2RDYWxsUmVzdWx0LFxuICAgICAgICBhZGRlZENvdW50OiBhcmd1bWVudHMubGVuZ3RoID4gMiA/IGFyZ3VtZW50cy5sZW5ndGggLSAyIDogMFxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICB9O1xuXG4gIGFycmF5UHJvdG8udW5zaGlmdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHVuc2hpZnQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICBpZiAodGhpcy5fX2FycmF5X29ic2VydmVyX18gIT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhpcy5fX2FycmF5X29ic2VydmVyX18uYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgdHlwZTogJ3NwbGljZScsXG4gICAgICAgIG9iamVjdDogdGhpcyxcbiAgICAgICAgaW5kZXg6IDAsXG4gICAgICAgIHJlbW92ZWQ6IFtdLFxuICAgICAgICBhZGRlZENvdW50OiBhcmd1bWVudHMubGVuZ3RoXG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gIH07XG59XG5cbmZ1bmN0aW9uIF9nZXRBcnJheU9ic2VydmVyKHRhc2tRdWV1ZSwgYXJyYXkpIHtcbiAgcmV0dXJuIE1vZGlmeUFycmF5T2JzZXJ2ZXIuZm9yKHRhc2tRdWV1ZSwgYXJyYXkpO1xufVxuXG52YXIgTW9kaWZ5QXJyYXlPYnNlcnZlciA9IGZ1bmN0aW9uIChfTW9kaWZ5Q29sbGVjdGlvbk9ic2UpIHtcbiAgX2luaGVyaXRzKE1vZGlmeUFycmF5T2JzZXJ2ZXIsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZSk7XG5cbiAgZnVuY3Rpb24gTW9kaWZ5QXJyYXlPYnNlcnZlcih0YXNrUXVldWUsIGFycmF5KSB7XG4gICAgXG5cbiAgICByZXR1cm4gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX01vZGlmeUNvbGxlY3Rpb25PYnNlLmNhbGwodGhpcywgdGFza1F1ZXVlLCBhcnJheSkpO1xuICB9XG5cbiAgTW9kaWZ5QXJyYXlPYnNlcnZlci5mb3IgPSBmdW5jdGlvbiBfZm9yKHRhc2tRdWV1ZSwgYXJyYXkpIHtcbiAgICBpZiAoISgnX19hcnJheV9vYnNlcnZlcl9fJyBpbiBhcnJheSkpIHtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkoYXJyYXksICdfX2FycmF5X29ic2VydmVyX18nLCB7XG4gICAgICAgIHZhbHVlOiBNb2RpZnlBcnJheU9ic2VydmVyLmNyZWF0ZSh0YXNrUXVldWUsIGFycmF5KSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gYXJyYXkuX19hcnJheV9vYnNlcnZlcl9fO1xuICB9O1xuXG4gIE1vZGlmeUFycmF5T2JzZXJ2ZXIuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHRhc2tRdWV1ZSwgYXJyYXkpIHtcbiAgICByZXR1cm4gbmV3IE1vZGlmeUFycmF5T2JzZXJ2ZXIodGFza1F1ZXVlLCBhcnJheSk7XG4gIH07XG5cbiAgcmV0dXJuIE1vZGlmeUFycmF5T2JzZXJ2ZXI7XG59KE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcik7XG5cbmV4cG9ydCB2YXIgRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRXhwcmVzc2lvbigpIHtcbiAgICBcblxuICAgIHRoaXMuaXNBc3NpZ25hYmxlID0gZmFsc2U7XG4gIH1cblxuICBFeHByZXNzaW9uLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIGFyZ3MpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0JpbmRpbmcgZXhwcmVzc2lvbiBcIicgKyB0aGlzICsgJ1wiIGNhbm5vdCBiZSBldmFsdWF0ZWQuJyk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbi5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCaW5kaW5nIGV4cHJlc3Npb24gXCInICsgdGhpcyArICdcIiBjYW5ub3QgYmUgYXNzaWduZWQgdG8uJyk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbi5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbiB0b1N0cmluZygpIHtcbiAgICByZXR1cm4gdHlwZW9mIEZFQVRVUkVfTk9fVU5QQVJTRVIgPT09ICd1bmRlZmluZWQnID8gX1VucGFyc2VyLnVucGFyc2UodGhpcykgOiBGdW5jdGlvbi5wcm90b3R5cGUudG9TdHJpbmcuY2FsbCh0aGlzKTtcbiAgfTtcblxuICByZXR1cm4gRXhwcmVzc2lvbjtcbn0oKTtcblxuZXhwb3J0IHZhciBCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24pIHtcbiAgX2luaGVyaXRzKEJpbmRpbmdCZWhhdmlvciwgX0V4cHJlc3Npb24pO1xuXG4gIGZ1bmN0aW9uIEJpbmRpbmdCZWhhdmlvcihleHByZXNzaW9uLCBuYW1lLCBhcmdzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMzID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24uY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczMuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgX3RoaXMzLm5hbWUgPSBuYW1lO1xuICAgIF90aGlzMy5hcmdzID0gYXJncztcbiAgICByZXR1cm4gX3RoaXMzO1xuICB9XG5cbiAgQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuIHRoaXMuZXhwcmVzc2lvbi5hc3NpZ24oc2NvcGUsIHZhbHVlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdEJpbmRpbmdCZWhhdmlvcih0aGlzKTtcbiAgfTtcblxuICBCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5leHByZXNzaW9uLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoYmluZGluZywgc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIGlmICh0aGlzLmV4cHJlc3Npb24uZXhwcmVzc2lvbiAmJiB0aGlzLmV4cHJlc3Npb24uYmluZCkge1xuICAgICAgdGhpcy5leHByZXNzaW9uLmJpbmQoYmluZGluZywgc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuICAgIHZhciBiZWhhdmlvciA9IGxvb2t1cEZ1bmN0aW9ucy5iaW5kaW5nQmVoYXZpb3JzKHRoaXMubmFtZSk7XG4gICAgaWYgKCFiZWhhdmlvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBCaW5kaW5nQmVoYXZpb3IgbmFtZWQgXCInICsgdGhpcy5uYW1lICsgJ1wiIHdhcyBmb3VuZCEnKTtcbiAgICB9XG4gICAgdmFyIGJlaGF2aW9yS2V5ID0gJ2JlaGF2aW9yLScgKyB0aGlzLm5hbWU7XG4gICAgaWYgKGJpbmRpbmdbYmVoYXZpb3JLZXldKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgYmluZGluZyBiZWhhdmlvciBuYW1lZCBcIicgKyB0aGlzLm5hbWUgKyAnXCIgaGFzIGFscmVhZHkgYmVlbiBhcHBsaWVkIHRvIFwiJyArIHRoaXMuZXhwcmVzc2lvbiArICdcIicpO1xuICAgIH1cbiAgICBiaW5kaW5nW2JlaGF2aW9yS2V5XSA9IGJlaGF2aW9yO1xuICAgIGJlaGF2aW9yLmJpbmQuYXBwbHkoYmVoYXZpb3IsIFtiaW5kaW5nLCBzY29wZV0uY29uY2F0KGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFyZ3MsIGJpbmRpbmcubG9va3VwRnVuY3Rpb25zKSkpO1xuICB9O1xuXG4gIEJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGJlaGF2aW9yS2V5ID0gJ2JlaGF2aW9yLScgKyB0aGlzLm5hbWU7XG4gICAgYmluZGluZ1tiZWhhdmlvcktleV0udW5iaW5kKGJpbmRpbmcsIHNjb3BlKTtcbiAgICBiaW5kaW5nW2JlaGF2aW9yS2V5XSA9IG51bGw7XG4gICAgaWYgKHRoaXMuZXhwcmVzc2lvbi5leHByZXNzaW9uICYmIHRoaXMuZXhwcmVzc2lvbi51bmJpbmQpIHtcbiAgICAgIHRoaXMuZXhwcmVzc2lvbi51bmJpbmQoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQmluZGluZ0JlaGF2aW9yO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBWYWx1ZUNvbnZlcnRlciA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjIpIHtcbiAgX2luaGVyaXRzKFZhbHVlQ29udmVydGVyLCBfRXhwcmVzc2lvbjIpO1xuXG4gIGZ1bmN0aW9uIFZhbHVlQ29udmVydGVyKGV4cHJlc3Npb24sIG5hbWUsIGFyZ3MpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczQgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjIuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczQuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgX3RoaXM0Lm5hbWUgPSBuYW1lO1xuICAgIF90aGlzNC5hcmdzID0gYXJncztcbiAgICBfdGhpczQuYWxsQXJncyA9IFtleHByZXNzaW9uXS5jb25jYXQoYXJncyk7XG4gICAgcmV0dXJuIF90aGlzNDtcbiAgfVxuXG4gIFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgY29udmVydGVyID0gbG9va3VwRnVuY3Rpb25zLnZhbHVlQ29udmVydGVycyh0aGlzLm5hbWUpO1xuICAgIGlmICghY29udmVydGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFZhbHVlQ29udmVydGVyIG5hbWVkIFwiJyArIHRoaXMubmFtZSArICdcIiB3YXMgZm91bmQhJyk7XG4gICAgfVxuXG4gICAgaWYgKCd0b1ZpZXcnIGluIGNvbnZlcnRlcikge1xuICAgICAgcmV0dXJuIGNvbnZlcnRlci50b1ZpZXcuYXBwbHkoY29udmVydGVyLCBldmFsTGlzdChzY29wZSwgdGhpcy5hbGxBcmdzLCBsb29rdXBGdW5jdGlvbnMpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5hbGxBcmdzWzBdLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgY29udmVydGVyID0gbG9va3VwRnVuY3Rpb25zLnZhbHVlQ29udmVydGVycyh0aGlzLm5hbWUpO1xuICAgIGlmICghY29udmVydGVyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ05vIFZhbHVlQ29udmVydGVyIG5hbWVkIFwiJyArIHRoaXMubmFtZSArICdcIiB3YXMgZm91bmQhJyk7XG4gICAgfVxuXG4gICAgaWYgKCdmcm9tVmlldycgaW4gY29udmVydGVyKSB7XG4gICAgICB2YWx1ZSA9IGNvbnZlcnRlci5mcm9tVmlldy5hcHBseShjb252ZXJ0ZXIsIFt2YWx1ZV0uY29uY2F0KGV2YWxMaXN0KHNjb3BlLCB0aGlzLmFyZ3MsIGxvb2t1cEZ1bmN0aW9ucykpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5hbGxBcmdzWzBdLmFzc2lnbihzY29wZSwgdmFsdWUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRWYWx1ZUNvbnZlcnRlcih0aGlzKTtcbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlci5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSB0aGlzLmFsbEFyZ3M7XG4gICAgdmFyIGkgPSBleHByZXNzaW9ucy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgZXhwcmVzc2lvbnNbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICAgIHZhciBjb252ZXJ0ZXIgPSBiaW5kaW5nLmxvb2t1cEZ1bmN0aW9ucy52YWx1ZUNvbnZlcnRlcnModGhpcy5uYW1lKTtcbiAgICBpZiAoIWNvbnZlcnRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBWYWx1ZUNvbnZlcnRlciBuYW1lZCBcIicgKyB0aGlzLm5hbWUgKyAnXCIgd2FzIGZvdW5kIScpO1xuICAgIH1cbiAgICB2YXIgc2lnbmFscyA9IGNvbnZlcnRlci5zaWduYWxzO1xuICAgIGlmIChzaWduYWxzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaSA9IHNpZ25hbHMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGNvbm5lY3RCaW5kaW5nVG9TaWduYWwoYmluZGluZywgc2lnbmFsc1tpXSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBWYWx1ZUNvbnZlcnRlcjtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQXNzaWduID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMykge1xuICBfaW5oZXJpdHMoQXNzaWduLCBfRXhwcmVzc2lvbjMpO1xuXG4gIGZ1bmN0aW9uIEFzc2lnbih0YXJnZXQsIHZhbHVlKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXM1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24zLmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXM1LnRhcmdldCA9IHRhcmdldDtcbiAgICBfdGhpczUudmFsdWUgPSB2YWx1ZTtcbiAgICBfdGhpczUuaXNBc3NpZ25hYmxlID0gdHJ1ZTtcbiAgICByZXR1cm4gX3RoaXM1O1xuICB9XG5cbiAgQXNzaWduLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy50YXJnZXQuYXNzaWduKHNjb3BlLCB0aGlzLnZhbHVlLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpKTtcbiAgfTtcblxuICBBc3NpZ24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXN0b3IpIHtcbiAgICB2aXN0b3IudmlzaXRBc3NpZ24odGhpcyk7XG4gIH07XG5cbiAgQXNzaWduLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge307XG5cbiAgQXNzaWduLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlKSB7XG4gICAgdGhpcy52YWx1ZS5hc3NpZ24oc2NvcGUsIHZhbHVlKTtcbiAgICB0aGlzLnRhcmdldC5hc3NpZ24oc2NvcGUsIHZhbHVlKTtcbiAgfTtcblxuICByZXR1cm4gQXNzaWduO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBDb25kaXRpb25hbCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjQpIHtcbiAgX2luaGVyaXRzKENvbmRpdGlvbmFsLCBfRXhwcmVzc2lvbjQpO1xuXG4gIGZ1bmN0aW9uIENvbmRpdGlvbmFsKGNvbmRpdGlvbiwgeWVzLCBubykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzNiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uNC5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzNi5jb25kaXRpb24gPSBjb25kaXRpb247XG4gICAgX3RoaXM2LnllcyA9IHllcztcbiAgICBfdGhpczYubm8gPSBubztcbiAgICByZXR1cm4gX3RoaXM2O1xuICB9XG5cbiAgQ29uZGl0aW9uYWwucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiAhIXRoaXMuY29uZGl0aW9uLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpID8gdGhpcy55ZXMuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykgOiB0aGlzLm5vLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIENvbmRpdGlvbmFsLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0Q29uZGl0aW9uYWwodGhpcyk7XG4gIH07XG5cbiAgQ29uZGl0aW9uYWwucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5jb25kaXRpb24uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgaWYgKHRoaXMuY29uZGl0aW9uLmV2YWx1YXRlKHNjb3BlKSkge1xuICAgICAgdGhpcy55ZXMuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubm8uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDb25kaXRpb25hbDtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQWNjZXNzVGhpcyA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjUpIHtcbiAgX2luaGVyaXRzKEFjY2Vzc1RoaXMsIF9FeHByZXNzaW9uNSk7XG5cbiAgZnVuY3Rpb24gQWNjZXNzVGhpcyhhbmNlc3Rvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzNyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uNS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzNy5hbmNlc3RvciA9IGFuY2VzdG9yO1xuICAgIHJldHVybiBfdGhpczc7XG4gIH1cblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgb2MgPSBzY29wZS5vdmVycmlkZUNvbnRleHQ7XG4gICAgdmFyIGkgPSB0aGlzLmFuY2VzdG9yO1xuICAgIHdoaWxlIChpLS0gJiYgb2MpIHtcbiAgICAgIG9jID0gb2MucGFyZW50T3ZlcnJpZGVDb250ZXh0O1xuICAgIH1cbiAgICByZXR1cm4gaSA8IDEgJiYgb2MgPyBvYy5iaW5kaW5nQ29udGV4dCA6IHVuZGVmaW5lZDtcbiAgfTtcblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QWNjZXNzVGhpcyh0aGlzKTtcbiAgfTtcblxuICBBY2Nlc3NUaGlzLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge307XG5cbiAgcmV0dXJuIEFjY2Vzc1RoaXM7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIEFjY2Vzc1Njb3BlID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uNikge1xuICBfaW5oZXJpdHMoQWNjZXNzU2NvcGUsIF9FeHByZXNzaW9uNik7XG5cbiAgZnVuY3Rpb24gQWNjZXNzU2NvcGUobmFtZSwgYW5jZXN0b3IpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczggPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjYuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczgubmFtZSA9IG5hbWU7XG4gICAgX3RoaXM4LmFuY2VzdG9yID0gYW5jZXN0b3I7XG4gICAgX3RoaXM4LmlzQXNzaWduYWJsZSA9IHRydWU7XG4gICAgcmV0dXJuIF90aGlzODtcbiAgfVxuXG4gIEFjY2Vzc1Njb3BlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgY29udGV4dCA9IGdldENvbnRleHRGb3IodGhpcy5uYW1lLCBzY29wZSwgdGhpcy5hbmNlc3Rvcik7XG4gICAgcmV0dXJuIGNvbnRleHRbdGhpcy5uYW1lXTtcbiAgfTtcblxuICBBY2Nlc3NTY29wZS5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHZhciBjb250ZXh0ID0gZ2V0Q29udGV4dEZvcih0aGlzLm5hbWUsIHNjb3BlLCB0aGlzLmFuY2VzdG9yKTtcbiAgICByZXR1cm4gY29udGV4dCA/IGNvbnRleHRbdGhpcy5uYW1lXSA9IHZhbHVlIDogdW5kZWZpbmVkO1xuICB9O1xuXG4gIEFjY2Vzc1Njb3BlLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0QWNjZXNzU2NvcGUodGhpcyk7XG4gIH07XG5cbiAgQWNjZXNzU2NvcGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0Rm9yKHRoaXMubmFtZSwgc2NvcGUsIHRoaXMuYW5jZXN0b3IpO1xuICAgIGJpbmRpbmcub2JzZXJ2ZVByb3BlcnR5KGNvbnRleHQsIHRoaXMubmFtZSk7XG4gIH07XG5cbiAgcmV0dXJuIEFjY2Vzc1Njb3BlO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBBY2Nlc3NNZW1iZXIgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb243KSB7XG4gIF9pbmhlcml0cyhBY2Nlc3NNZW1iZXIsIF9FeHByZXNzaW9uNyk7XG5cbiAgZnVuY3Rpb24gQWNjZXNzTWVtYmVyKG9iamVjdCwgbmFtZSkge1xuICAgIFxuXG4gICAgdmFyIF90aGlzOSA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uNy5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzOS5vYmplY3QgPSBvYmplY3Q7XG4gICAgX3RoaXM5Lm5hbWUgPSBuYW1lO1xuICAgIF90aGlzOS5pc0Fzc2lnbmFibGUgPSB0cnVlO1xuICAgIHJldHVybiBfdGhpczk7XG4gIH1cblxuICBBY2Nlc3NNZW1iZXIucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHJldHVybiBpbnN0YW5jZSA9PT0gbnVsbCB8fCBpbnN0YW5jZSA9PT0gdW5kZWZpbmVkID8gaW5zdGFuY2UgOiBpbnN0YW5jZVt0aGlzLm5hbWVdO1xuICB9O1xuXG4gIEFjY2Vzc01lbWJlci5wcm90b3R5cGUuYXNzaWduID0gZnVuY3Rpb24gYXNzaWduKHNjb3BlLCB2YWx1ZSkge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlKTtcblxuICAgIGlmIChpbnN0YW5jZSA9PT0gbnVsbCB8fCBpbnN0YW5jZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbnN0YW5jZSA9IHt9O1xuICAgICAgdGhpcy5vYmplY3QuYXNzaWduKHNjb3BlLCBpbnN0YW5jZSk7XG4gICAgfVxuXG4gICAgaW5zdGFuY2VbdGhpcy5uYW1lXSA9IHZhbHVlO1xuICAgIHJldHVybiB2YWx1ZTtcbiAgfTtcblxuICBBY2Nlc3NNZW1iZXIucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRBY2Nlc3NNZW1iZXIodGhpcyk7XG4gIH07XG5cbiAgQWNjZXNzTWVtYmVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKG9iaikge1xuICAgICAgYmluZGluZy5vYnNlcnZlUHJvcGVydHkob2JqLCB0aGlzLm5hbWUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQWNjZXNzTWVtYmVyO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBBY2Nlc3NLZXllZCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjgpIHtcbiAgX2luaGVyaXRzKEFjY2Vzc0tleWVkLCBfRXhwcmVzc2lvbjgpO1xuXG4gIGZ1bmN0aW9uIEFjY2Vzc0tleWVkKG9iamVjdCwga2V5KSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uOC5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTAub2JqZWN0ID0gb2JqZWN0O1xuICAgIF90aGlzMTAua2V5ID0ga2V5O1xuICAgIF90aGlzMTAuaXNBc3NpZ25hYmxlID0gdHJ1ZTtcbiAgICByZXR1cm4gX3RoaXMxMDtcbiAgfVxuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgbG9va3VwID0gdGhpcy5rZXkuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgcmV0dXJuIGdldEtleWVkKGluc3RhbmNlLCBsb29rdXApO1xuICB9O1xuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5hc3NpZ24gPSBmdW5jdGlvbiBhc3NpZ24oc2NvcGUsIHZhbHVlKSB7XG4gICAgdmFyIGluc3RhbmNlID0gdGhpcy5vYmplY3QuZXZhbHVhdGUoc2NvcGUpO1xuICAgIHZhciBsb29rdXAgPSB0aGlzLmtleS5ldmFsdWF0ZShzY29wZSk7XG4gICAgcmV0dXJuIHNldEtleWVkKGluc3RhbmNlLCBsb29rdXAsIHZhbHVlKTtcbiAgfTtcblxuICBBY2Nlc3NLZXllZC5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdEFjY2Vzc0tleWVkKHRoaXMpO1xuICB9O1xuXG4gIEFjY2Vzc0tleWVkLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgdGhpcy5rZXkuY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgICB2YXIga2V5ID0gdGhpcy5rZXkuZXZhbHVhdGUoc2NvcGUpO1xuXG4gICAgICBpZiAoa2V5ICE9PSBudWxsICYmIGtleSAhPT0gdW5kZWZpbmVkICYmICEoQXJyYXkuaXNBcnJheShvYmopICYmIHR5cGVvZiBrZXkgPT09ICdudW1iZXInKSkge1xuICAgICAgICBiaW5kaW5nLm9ic2VydmVQcm9wZXJ0eShvYmosIGtleSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBBY2Nlc3NLZXllZDtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgQ2FsbFNjb3BlID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uOSkge1xuICBfaW5oZXJpdHMoQ2FsbFNjb3BlLCBfRXhwcmVzc2lvbjkpO1xuXG4gIGZ1bmN0aW9uIENhbGxTY29wZShuYW1lLCBhcmdzLCBhbmNlc3Rvcikge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTEgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjkuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczExLm5hbWUgPSBuYW1lO1xuICAgIF90aGlzMTEuYXJncyA9IGFyZ3M7XG4gICAgX3RoaXMxMS5hbmNlc3RvciA9IGFuY2VzdG9yO1xuICAgIHJldHVybiBfdGhpczExO1xuICB9XG5cbiAgQ2FsbFNjb3BlLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIG11c3RFdmFsdWF0ZSkge1xuICAgIHZhciBhcmdzID0gZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgY29udGV4dCA9IGdldENvbnRleHRGb3IodGhpcy5uYW1lLCBzY29wZSwgdGhpcy5hbmNlc3Rvcik7XG4gICAgdmFyIGZ1bmMgPSBnZXRGdW5jdGlvbihjb250ZXh0LCB0aGlzLm5hbWUsIG11c3RFdmFsdWF0ZSk7XG4gICAgaWYgKGZ1bmMpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIENhbGxTY29wZS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdENhbGxTY29wZSh0aGlzKTtcbiAgfTtcblxuICBDYWxsU2NvcGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdmFyIGFyZ3MgPSB0aGlzLmFyZ3M7XG4gICAgdmFyIGkgPSBhcmdzLmxlbmd0aDtcbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICBhcmdzW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2FsbFNjb3BlO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBDYWxsTWVtYmVyID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTApIHtcbiAgX2luaGVyaXRzKENhbGxNZW1iZXIsIF9FeHByZXNzaW9uMTApO1xuXG4gIGZ1bmN0aW9uIENhbGxNZW1iZXIob2JqZWN0LCBuYW1lLCBhcmdzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMiA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTAuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczEyLm9iamVjdCA9IG9iamVjdDtcbiAgICBfdGhpczEyLm5hbWUgPSBuYW1lO1xuICAgIF90aGlzMTIuYXJncyA9IGFyZ3M7XG4gICAgcmV0dXJuIF90aGlzMTI7XG4gIH1cblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMsIG11c3RFdmFsdWF0ZSkge1xuICAgIHZhciBpbnN0YW5jZSA9IHRoaXMub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIHZhciBhcmdzID0gZXZhbExpc3Qoc2NvcGUsIHRoaXMuYXJncywgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB2YXIgZnVuYyA9IGdldEZ1bmN0aW9uKGluc3RhbmNlLCB0aGlzLm5hbWUsIG11c3RFdmFsdWF0ZSk7XG4gICAgaWYgKGZ1bmMpIHtcbiAgICAgIHJldHVybiBmdW5jLmFwcGx5KGluc3RhbmNlLCBhcmdzKTtcbiAgICB9XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfTtcblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0Q2FsbE1lbWJlcih0aGlzKTtcbiAgfTtcblxuICBDYWxsTWVtYmVyLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMub2JqZWN0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBvYmogPSB0aGlzLm9iamVjdC5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKGdldEZ1bmN0aW9uKG9iaiwgdGhpcy5uYW1lLCBmYWxzZSkpIHtcbiAgICAgIHZhciBhcmdzID0gdGhpcy5hcmdzO1xuICAgICAgdmFyIGkgPSBhcmdzLmxlbmd0aDtcbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgYXJnc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICAgIH1cbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENhbGxNZW1iZXI7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIENhbGxGdW5jdGlvbiA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjExKSB7XG4gIF9pbmhlcml0cyhDYWxsRnVuY3Rpb24sIF9FeHByZXNzaW9uMTEpO1xuXG4gIGZ1bmN0aW9uIENhbGxGdW5jdGlvbihmdW5jLCBhcmdzKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxMyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTEuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczEzLmZ1bmMgPSBmdW5jO1xuICAgIF90aGlzMTMuYXJncyA9IGFyZ3M7XG4gICAgcmV0dXJuIF90aGlzMTM7XG4gIH1cblxuICBDYWxsRnVuY3Rpb24ucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKSB7XG4gICAgdmFyIGZ1bmMgPSB0aGlzLmZ1bmMuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICByZXR1cm4gZnVuYy5hcHBseShudWxsLCBldmFsTGlzdChzY29wZSwgdGhpcy5hcmdzLCBsb29rdXBGdW5jdGlvbnMpKTtcbiAgICB9XG4gICAgaWYgKCFtdXN0RXZhbHVhdGUgJiYgKGZ1bmMgPT09IG51bGwgfHwgZnVuYyA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKHRoaXMuZnVuYyArICcgaXMgbm90IGEgZnVuY3Rpb24nKTtcbiAgfTtcblxuICBDYWxsRnVuY3Rpb24ucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRDYWxsRnVuY3Rpb24odGhpcyk7XG4gIH07XG5cbiAgQ2FsbEZ1bmN0aW9uLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHRoaXMuZnVuYy5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB2YXIgZnVuYyA9IHRoaXMuZnVuYy5ldmFsdWF0ZShzY29wZSk7XG4gICAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICB2YXIgYXJncyA9IHRoaXMuYXJncztcbiAgICAgIHZhciBpID0gYXJncy5sZW5ndGg7XG4gICAgICB3aGlsZSAoaS0tKSB7XG4gICAgICAgIGFyZ3NbaV0uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDYWxsRnVuY3Rpb247XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIEJpbmFyeSA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjEyKSB7XG4gIF9pbmhlcml0cyhCaW5hcnksIF9FeHByZXNzaW9uMTIpO1xuXG4gIGZ1bmN0aW9uIEJpbmFyeShvcGVyYXRpb24sIGxlZnQsIHJpZ2h0KSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxNCA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTIuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczE0Lm9wZXJhdGlvbiA9IG9wZXJhdGlvbjtcbiAgICBfdGhpczE0LmxlZnQgPSBsZWZ0O1xuICAgIF90aGlzMTQucmlnaHQgPSByaWdodDtcbiAgICByZXR1cm4gX3RoaXMxNDtcbiAgfVxuXG4gIEJpbmFyeS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgdmFyIGxlZnQgPSB0aGlzLmxlZnQuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG5cbiAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlICcmJic6XG4gICAgICAgIHJldHVybiBsZWZ0ICYmIHRoaXMucmlnaHQuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgICBjYXNlICd8fCc6XG4gICAgICAgIHJldHVybiBsZWZ0IHx8IHRoaXMucmlnaHQuZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuXG4gICAgdmFyIHJpZ2h0ID0gdGhpcy5yaWdodC5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcblxuICAgIHN3aXRjaCAodGhpcy5vcGVyYXRpb24pIHtcbiAgICAgIGNhc2UgJz09JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgPT0gcmlnaHQ7XG4gICAgICBjYXNlICc9PT0nOlxuICAgICAgICByZXR1cm4gbGVmdCA9PT0gcmlnaHQ7XG4gICAgICBjYXNlICchPSc6XG4gICAgICAgIHJldHVybiBsZWZ0ICE9IHJpZ2h0O1xuICAgICAgY2FzZSAnIT09JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgIT09IHJpZ2h0O1xuICAgICAgY2FzZSAnaW5zdGFuY2VvZic6XG4gICAgICAgIHJldHVybiB0eXBlb2YgcmlnaHQgPT09ICdmdW5jdGlvbicgJiYgbGVmdCBpbnN0YW5jZW9mIHJpZ2h0O1xuICAgICAgY2FzZSAnaW4nOlxuICAgICAgICByZXR1cm4gKHR5cGVvZiByaWdodCA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IF90eXBlb2YocmlnaHQpKSA9PT0gJ29iamVjdCcgJiYgcmlnaHQgIT09IG51bGwgJiYgbGVmdCBpbiByaWdodDtcbiAgICB9XG5cbiAgICBpZiAobGVmdCA9PT0gbnVsbCB8fCByaWdodCA9PT0gbnVsbCB8fCBsZWZ0ID09PSB1bmRlZmluZWQgfHwgcmlnaHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgICBjYXNlICcrJzpcbiAgICAgICAgICBpZiAobGVmdCAhPT0gbnVsbCAmJiBsZWZ0ICE9PSB1bmRlZmluZWQpIHJldHVybiBsZWZ0O1xuICAgICAgICAgIGlmIChyaWdodCAhPT0gbnVsbCAmJiByaWdodCAhPT0gdW5kZWZpbmVkKSByZXR1cm4gcmlnaHQ7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIGNhc2UgJy0nOlxuICAgICAgICAgIGlmIChsZWZ0ICE9PSBudWxsICYmIGxlZnQgIT09IHVuZGVmaW5lZCkgcmV0dXJuIGxlZnQ7XG4gICAgICAgICAgaWYgKHJpZ2h0ICE9PSBudWxsICYmIHJpZ2h0ICE9PSB1bmRlZmluZWQpIHJldHVybiAwIC0gcmlnaHQ7XG4gICAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHN3aXRjaCAodGhpcy5vcGVyYXRpb24pIHtcbiAgICAgIGNhc2UgJysnOlxuICAgICAgICByZXR1cm4gYXV0b0NvbnZlcnRBZGQobGVmdCwgcmlnaHQpO1xuICAgICAgY2FzZSAnLSc6XG4gICAgICAgIHJldHVybiBsZWZ0IC0gcmlnaHQ7XG4gICAgICBjYXNlICcqJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgKiByaWdodDtcbiAgICAgIGNhc2UgJy8nOlxuICAgICAgICByZXR1cm4gbGVmdCAvIHJpZ2h0O1xuICAgICAgY2FzZSAnJSc6XG4gICAgICAgIHJldHVybiBsZWZ0ICUgcmlnaHQ7XG4gICAgICBjYXNlICc8JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgPCByaWdodDtcbiAgICAgIGNhc2UgJz4nOlxuICAgICAgICByZXR1cm4gbGVmdCA+IHJpZ2h0O1xuICAgICAgY2FzZSAnPD0nOlxuICAgICAgICByZXR1cm4gbGVmdCA8PSByaWdodDtcbiAgICAgIGNhc2UgJz49JzpcbiAgICAgICAgcmV0dXJuIGxlZnQgPj0gcmlnaHQ7XG4gICAgICBjYXNlICdeJzpcbiAgICAgICAgcmV0dXJuIGxlZnQgXiByaWdodDtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVybmFsIGVycm9yIFsnICsgdGhpcy5vcGVyYXRpb24gKyAnXSBub3QgaGFuZGxlZCcpO1xuICB9O1xuXG4gIEJpbmFyeS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdEJpbmFyeSh0aGlzKTtcbiAgfTtcblxuICBCaW5hcnkucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgdGhpcy5sZWZ0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIHZhciBsZWZ0ID0gdGhpcy5sZWZ0LmV2YWx1YXRlKHNjb3BlKTtcbiAgICBpZiAodGhpcy5vcGVyYXRpb24gPT09ICcmJicgJiYgIWxlZnQgfHwgdGhpcy5vcGVyYXRpb24gPT09ICd8fCcgJiYgbGVmdCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLnJpZ2h0LmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICB9O1xuXG4gIHJldHVybiBCaW5hcnk7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIFVuYXJ5ID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTMpIHtcbiAgX2luaGVyaXRzKFVuYXJ5LCBfRXhwcmVzc2lvbjEzKTtcblxuICBmdW5jdGlvbiBVbmFyeShvcGVyYXRpb24sIGV4cHJlc3Npb24pIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xMy5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTUub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xuICAgIF90aGlzMTUuZXhwcmVzc2lvbiA9IGV4cHJlc3Npb247XG4gICAgcmV0dXJuIF90aGlzMTU7XG4gIH1cblxuICBVbmFyeS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgY2FzZSAnISc6XG4gICAgICAgIHJldHVybiAhdGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgICAgY2FzZSAndHlwZW9mJzpcbiAgICAgICAgcmV0dXJuIF90eXBlb2YodGhpcy5leHByZXNzaW9uLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpKTtcbiAgICAgIGNhc2UgJ3ZvaWQnOlxuICAgICAgICByZXR1cm4gdm9pZCB0aGlzLmV4cHJlc3Npb24uZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuXG4gICAgdGhyb3cgbmV3IEVycm9yKCdJbnRlcm5hbCBlcnJvciBbJyArIHRoaXMub3BlcmF0aW9uICsgJ10gbm90IGhhbmRsZWQnKTtcbiAgfTtcblxuICBVbmFyeS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdFByZWZpeCh0aGlzKTtcbiAgfTtcblxuICBVbmFyeS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB0aGlzLmV4cHJlc3Npb24uY29ubmVjdChiaW5kaW5nLCBzY29wZSk7XG4gIH07XG5cbiAgcmV0dXJuIFVuYXJ5O1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBMaXRlcmFsUHJpbWl0aXZlID0gZnVuY3Rpb24gKF9FeHByZXNzaW9uMTQpIHtcbiAgX2luaGVyaXRzKExpdGVyYWxQcmltaXRpdmUsIF9FeHByZXNzaW9uMTQpO1xuXG4gIGZ1bmN0aW9uIExpdGVyYWxQcmltaXRpdmUodmFsdWUpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE2ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xNC5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTYudmFsdWUgPSB2YWx1ZTtcbiAgICByZXR1cm4gX3RoaXMxNjtcbiAgfVxuXG4gIExpdGVyYWxQcmltaXRpdmUucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIExpdGVyYWxQcmltaXRpdmUucHJvdG90eXBlLmFjY2VwdCA9IGZ1bmN0aW9uIGFjY2VwdCh2aXNpdG9yKSB7XG4gICAgcmV0dXJuIHZpc2l0b3IudmlzaXRMaXRlcmFsUHJpbWl0aXZlKHRoaXMpO1xuICB9O1xuXG4gIExpdGVyYWxQcmltaXRpdmUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7fTtcblxuICByZXR1cm4gTGl0ZXJhbFByaW1pdGl2ZTtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgTGl0ZXJhbFN0cmluZyA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE1KSB7XG4gIF9pbmhlcml0cyhMaXRlcmFsU3RyaW5nLCBfRXhwcmVzc2lvbjE1KTtcblxuICBmdW5jdGlvbiBMaXRlcmFsU3RyaW5nKHZhbHVlKSB7XG4gICAgXG5cbiAgICB2YXIgX3RoaXMxNyA9IF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9FeHByZXNzaW9uMTUuY2FsbCh0aGlzKSk7XG5cbiAgICBfdGhpczE3LnZhbHVlID0gdmFsdWU7XG4gICAgcmV0dXJuIF90aGlzMTc7XG4gIH1cblxuICBMaXRlcmFsU3RyaW5nLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfTtcblxuICBMaXRlcmFsU3RyaW5nLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0TGl0ZXJhbFN0cmluZyh0aGlzKTtcbiAgfTtcblxuICBMaXRlcmFsU3RyaW5nLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge307XG5cbiAgcmV0dXJuIExpdGVyYWxTdHJpbmc7XG59KEV4cHJlc3Npb24pO1xuXG5leHBvcnQgdmFyIExpdGVyYWxUZW1wbGF0ZSA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE2KSB7XG4gIF9pbmhlcml0cyhMaXRlcmFsVGVtcGxhdGUsIF9FeHByZXNzaW9uMTYpO1xuXG4gIGZ1bmN0aW9uIExpdGVyYWxUZW1wbGF0ZShjb29rZWQsIGV4cHJlc3Npb25zLCByYXcsIHRhZykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMTggPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE2LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMxOC5jb29rZWQgPSBjb29rZWQ7XG4gICAgX3RoaXMxOC5leHByZXNzaW9ucyA9IGV4cHJlc3Npb25zIHx8IFtdO1xuICAgIF90aGlzMTgubGVuZ3RoID0gX3RoaXMxOC5leHByZXNzaW9ucy5sZW5ndGg7XG4gICAgX3RoaXMxOC50YWdnZWQgPSB0YWcgIT09IHVuZGVmaW5lZDtcbiAgICBpZiAoX3RoaXMxOC50YWdnZWQpIHtcbiAgICAgIF90aGlzMTguY29va2VkLnJhdyA9IHJhdztcbiAgICAgIF90aGlzMTgudGFnID0gdGFnO1xuICAgICAgaWYgKHRhZyBpbnN0YW5jZW9mIEFjY2Vzc1Njb3BlKSB7XG4gICAgICAgIF90aGlzMTguY29udGV4dFR5cGUgPSAnU2NvcGUnO1xuICAgICAgfSBlbHNlIGlmICh0YWcgaW5zdGFuY2VvZiBBY2Nlc3NNZW1iZXIgfHwgdGFnIGluc3RhbmNlb2YgQWNjZXNzS2V5ZWQpIHtcbiAgICAgICAgX3RoaXMxOC5jb250ZXh0VHlwZSA9ICdPYmplY3QnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKF90aGlzMTgudGFnICsgJyBpcyBub3QgYSB2YWxpZCB0ZW1wbGF0ZSB0YWcnKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF90aGlzMTg7XG4gIH1cblxuICBMaXRlcmFsVGVtcGxhdGUucHJvdG90eXBlLmdldFNjb3BlQ29udGV4dCA9IGZ1bmN0aW9uIGdldFNjb3BlQ29udGV4dChzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgcmV0dXJuIGdldENvbnRleHRGb3IodGhpcy50YWcubmFtZSwgc2NvcGUsIHRoaXMudGFnLmFuY2VzdG9yKTtcbiAgfTtcblxuICBMaXRlcmFsVGVtcGxhdGUucHJvdG90eXBlLmdldE9iamVjdENvbnRleHQgPSBmdW5jdGlvbiBnZXRPYmplY3RDb250ZXh0KHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy50YWcub2JqZWN0LmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIExpdGVyYWxUZW1wbGF0ZS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zLCBtdXN0RXZhbHVhdGUpIHtcbiAgICB2YXIgcmVzdWx0cyA9IG5ldyBBcnJheSh0aGlzLmxlbmd0aCk7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICByZXN1bHRzW2ldID0gdGhpcy5leHByZXNzaW9uc1tpXS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudGFnZ2VkKSB7XG4gICAgICB2YXIgZnVuYyA9IHRoaXMudGFnLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgICAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpc1snZ2V0JyArIHRoaXMuY29udGV4dFR5cGUgKyAnQ29udGV4dCddKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgICAgICByZXR1cm4gZnVuYy5jYWxsLmFwcGx5KGZ1bmMsIFtjb250ZXh0LCB0aGlzLmNvb2tlZF0uY29uY2F0KHJlc3VsdHMpKTtcbiAgICAgIH1cbiAgICAgIGlmICghbXVzdEV2YWx1YXRlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgICAgdGhyb3cgbmV3IEVycm9yKHRoaXMudGFnICsgJyBpcyBub3QgYSBmdW5jdGlvbicpO1xuICAgIH1cbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5jb29rZWRbMF07XG4gICAgZm9yICh2YXIgX2kyID0gMDsgX2kyIDwgdGhpcy5sZW5ndGg7IF9pMisrKSB7XG4gICAgICByZXN1bHQgPSBTdHJpbmcucHJvdG90eXBlLmNvbmNhdChyZXN1bHQsIHJlc3VsdHNbX2kyXSwgdGhpcy5jb29rZWRbX2kyICsgMV0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIExpdGVyYWxUZW1wbGF0ZS5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxUZW1wbGF0ZSh0aGlzKTtcbiAgfTtcblxuICBMaXRlcmFsVGVtcGxhdGUucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiBjb25uZWN0KGJpbmRpbmcsIHNjb3BlKSB7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLmV4cHJlc3Npb25zW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgICBpZiAodGhpcy50YWdnZWQpIHtcbiAgICAgIHRoaXMudGFnLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gTGl0ZXJhbFRlbXBsYXRlO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IHZhciBMaXRlcmFsQXJyYXkgPSBmdW5jdGlvbiAoX0V4cHJlc3Npb24xNykge1xuICBfaW5oZXJpdHMoTGl0ZXJhbEFycmF5LCBfRXhwcmVzc2lvbjE3KTtcblxuICBmdW5jdGlvbiBMaXRlcmFsQXJyYXkoZWxlbWVudHMpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczE5ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xNy5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMTkuZWxlbWVudHMgPSBlbGVtZW50cztcbiAgICByZXR1cm4gX3RoaXMxOTtcbiAgfVxuXG4gIExpdGVyYWxBcnJheS5wcm90b3R5cGUuZXZhbHVhdGUgPSBmdW5jdGlvbiBldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgdmFyIGVsZW1lbnRzID0gdGhpcy5lbGVtZW50cztcbiAgICB2YXIgcmVzdWx0ID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgIHJlc3VsdFtpXSA9IGVsZW1lbnRzW2ldLmV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgTGl0ZXJhbEFycmF5LnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHJldHVybiB2aXNpdG9yLnZpc2l0TGl0ZXJhbEFycmF5KHRoaXMpO1xuICB9O1xuXG4gIExpdGVyYWxBcnJheS5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5lbGVtZW50cy5sZW5ndGg7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xuICAgICAgdGhpcy5lbGVtZW50c1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIExpdGVyYWxBcnJheTtcbn0oRXhwcmVzc2lvbik7XG5cbmV4cG9ydCB2YXIgTGl0ZXJhbE9iamVjdCA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE4KSB7XG4gIF9pbmhlcml0cyhMaXRlcmFsT2JqZWN0LCBfRXhwcmVzc2lvbjE4KTtcblxuICBmdW5jdGlvbiBMaXRlcmFsT2JqZWN0KGtleXMsIHZhbHVlcykge1xuICAgIFxuXG4gICAgdmFyIF90aGlzMjAgPSBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfRXhwcmVzc2lvbjE4LmNhbGwodGhpcykpO1xuXG4gICAgX3RoaXMyMC5rZXlzID0ga2V5cztcbiAgICBfdGhpczIwLnZhbHVlcyA9IHZhbHVlcztcbiAgICByZXR1cm4gX3RoaXMyMDtcbiAgfVxuXG4gIExpdGVyYWxPYmplY3QucHJvdG90eXBlLmV2YWx1YXRlID0gZnVuY3Rpb24gZXZhbHVhdGUoc2NvcGUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIHZhciBpbnN0YW5jZSA9IHt9O1xuICAgIHZhciBrZXlzID0gdGhpcy5rZXlzO1xuICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcztcblxuICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICBpbnN0YW5jZVtrZXlzW2ldXSA9IHZhbHVlc1tpXS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4gaW5zdGFuY2U7XG4gIH07XG5cbiAgTGl0ZXJhbE9iamVjdC5wcm90b3R5cGUuYWNjZXB0ID0gZnVuY3Rpb24gYWNjZXB0KHZpc2l0b3IpIHtcbiAgICByZXR1cm4gdmlzaXRvci52aXNpdExpdGVyYWxPYmplY3QodGhpcyk7XG4gIH07XG5cbiAgTGl0ZXJhbE9iamVjdC5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoYmluZGluZywgc2NvcGUpIHtcbiAgICB2YXIgbGVuZ3RoID0gdGhpcy5rZXlzLmxlbmd0aDtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgICB0aGlzLnZhbHVlc1tpXS5jb25uZWN0KGJpbmRpbmcsIHNjb3BlKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIExpdGVyYWxPYmplY3Q7XG59KEV4cHJlc3Npb24pO1xuXG5mdW5jdGlvbiBldmFsTGlzdChzY29wZSwgbGlzdCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gIHZhciBsZW5ndGggPSBsaXN0Lmxlbmd0aDtcbiAgdmFyIHJlc3VsdCA9IFtdO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7XG4gICAgcmVzdWx0W2ldID0gbGlzdFtpXS5ldmFsdWF0ZShzY29wZSwgbG9va3VwRnVuY3Rpb25zKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBhdXRvQ29udmVydEFkZChhLCBiKSB7XG4gIGlmIChhICE9PSBudWxsICYmIGIgIT09IG51bGwpIHtcbiAgICBpZiAodHlwZW9mIGEgPT09ICdzdHJpbmcnICYmIHR5cGVvZiBiICE9PSAnc3RyaW5nJykge1xuICAgICAgcmV0dXJuIGEgKyBiLnRvU3RyaW5nKCk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBhICE9PSAnc3RyaW5nJyAmJiB0eXBlb2YgYiA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHJldHVybiBhLnRvU3RyaW5nKCkgKyBiO1xuICAgIH1cblxuICAgIHJldHVybiBhICsgYjtcbiAgfVxuXG4gIGlmIChhICE9PSBudWxsKSB7XG4gICAgcmV0dXJuIGE7XG4gIH1cblxuICBpZiAoYiAhPT0gbnVsbCkge1xuICAgIHJldHVybiBiO1xuICB9XG5cbiAgcmV0dXJuIDA7XG59XG5cbmZ1bmN0aW9uIGdldEZ1bmN0aW9uKG9iaiwgbmFtZSwgbXVzdEV4aXN0KSB7XG4gIHZhciBmdW5jID0gb2JqID09PSBudWxsIHx8IG9iaiA9PT0gdW5kZWZpbmVkID8gbnVsbCA6IG9ialtuYW1lXTtcbiAgaWYgKHR5cGVvZiBmdW5jID09PSAnZnVuY3Rpb24nKSB7XG4gICAgcmV0dXJuIGZ1bmM7XG4gIH1cbiAgaWYgKCFtdXN0RXhpc3QgJiYgKGZ1bmMgPT09IG51bGwgfHwgZnVuYyA9PT0gdW5kZWZpbmVkKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihuYW1lICsgJyBpcyBub3QgYSBmdW5jdGlvbicpO1xufVxuXG5mdW5jdGlvbiBnZXRLZXllZChvYmosIGtleSkge1xuICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG4gICAgcmV0dXJuIG9ialtwYXJzZUludChrZXksIDEwKV07XG4gIH0gZWxzZSBpZiAob2JqKSB7XG4gICAgcmV0dXJuIG9ialtrZXldO1xuICB9IGVsc2UgaWYgKG9iaiA9PT0gbnVsbCB8fCBvYmogPT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICByZXR1cm4gb2JqW2tleV07XG59XG5cbmZ1bmN0aW9uIHNldEtleWVkKG9iaiwga2V5LCB2YWx1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7XG4gICAgdmFyIGluZGV4ID0gcGFyc2VJbnQoa2V5LCAxMCk7XG5cbiAgICBpZiAob2JqLmxlbmd0aCA8PSBpbmRleCkge1xuICAgICAgb2JqLmxlbmd0aCA9IGluZGV4ICsgMTtcbiAgICB9XG5cbiAgICBvYmpbaW5kZXhdID0gdmFsdWU7XG4gIH0gZWxzZSB7XG4gICAgb2JqW2tleV0gPSB2YWx1ZTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxudmFyIF9VbnBhcnNlciA9IG51bGw7XG5cbmV4cG9ydCB7IF9VbnBhcnNlciBhcyBVbnBhcnNlciB9O1xuaWYgKHR5cGVvZiBGRUFUVVJFX05PX1VOUEFSU0VSID09PSAndW5kZWZpbmVkJykge1xuICBfVW5wYXJzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gVW5wYXJzZXIoYnVmZmVyKSB7XG4gICAgICBcblxuICAgICAgdGhpcy5idWZmZXIgPSBidWZmZXI7XG4gICAgfVxuXG4gICAgVW5wYXJzZXIudW5wYXJzZSA9IGZ1bmN0aW9uIHVucGFyc2UoZXhwcmVzc2lvbikge1xuICAgICAgdmFyIGJ1ZmZlciA9IFtdO1xuICAgICAgdmFyIHZpc2l0b3IgPSBuZXcgX1VucGFyc2VyKGJ1ZmZlcik7XG5cbiAgICAgIGV4cHJlc3Npb24uYWNjZXB0KHZpc2l0b3IpO1xuXG4gICAgICByZXR1cm4gYnVmZmVyLmpvaW4oJycpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUud3JpdGUgPSBmdW5jdGlvbiB3cml0ZSh0ZXh0KSB7XG4gICAgICB0aGlzLmJ1ZmZlci5wdXNoKHRleHQpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUud3JpdGVBcmdzID0gZnVuY3Rpb24gd3JpdGVBcmdzKGFyZ3MpIHtcbiAgICAgIHRoaXMud3JpdGUoJygnKTtcblxuICAgICAgZm9yICh2YXIgaSA9IDAsIGxlbmd0aCA9IGFyZ3MubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcbiAgICAgICAgaWYgKGkgIT09IDApIHtcbiAgICAgICAgICB0aGlzLndyaXRlKCcsJyk7XG4gICAgICAgIH1cblxuICAgICAgICBhcmdzW2ldLmFjY2VwdCh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy53cml0ZSgnKScpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiB2aXNpdEJpbmRpbmdCZWhhdmlvcihiZWhhdmlvcikge1xuICAgICAgdmFyIGFyZ3MgPSBiZWhhdmlvci5hcmdzO1xuXG4gICAgICBiZWhhdmlvci5leHByZXNzaW9uLmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGUoJyYnICsgYmVoYXZpb3IubmFtZSk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBhcmdzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIHRoaXMud3JpdGUoJzonKTtcbiAgICAgICAgYXJnc1tpXS5hY2NlcHQodGhpcyk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdFZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gdmlzaXRWYWx1ZUNvbnZlcnRlcihjb252ZXJ0ZXIpIHtcbiAgICAgIHZhciBhcmdzID0gY29udmVydGVyLmFyZ3M7XG5cbiAgICAgIGNvbnZlcnRlci5leHByZXNzaW9uLmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGUoJ3wnICsgY29udmVydGVyLm5hbWUpO1xuXG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gYXJncy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICB0aGlzLndyaXRlKCc6Jyk7XG4gICAgICAgIGFyZ3NbaV0uYWNjZXB0KHRoaXMpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRBc3NpZ24gPSBmdW5jdGlvbiB2aXNpdEFzc2lnbihhc3NpZ24pIHtcbiAgICAgIGFzc2lnbi50YXJnZXQuYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnPScpO1xuICAgICAgYXNzaWduLnZhbHVlLmFjY2VwdCh0aGlzKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0Q29uZGl0aW9uYWwgPSBmdW5jdGlvbiB2aXNpdENvbmRpdGlvbmFsKGNvbmRpdGlvbmFsKSB7XG4gICAgICBjb25kaXRpb25hbC5jb25kaXRpb24uYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnPycpO1xuICAgICAgY29uZGl0aW9uYWwueWVzLmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGUoJzonKTtcbiAgICAgIGNvbmRpdGlvbmFsLm5vLmFjY2VwdCh0aGlzKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0QWNjZXNzVGhpcyA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzVGhpcyhhY2Nlc3MpIHtcbiAgICAgIGlmIChhY2Nlc3MuYW5jZXN0b3IgPT09IDApIHtcbiAgICAgICAgdGhpcy53cml0ZSgnJHRoaXMnKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy53cml0ZSgnJHBhcmVudCcpO1xuICAgICAgdmFyIGkgPSBhY2Nlc3MuYW5jZXN0b3IgLSAxO1xuICAgICAgd2hpbGUgKGktLSkge1xuICAgICAgICB0aGlzLndyaXRlKCcuJHBhcmVudCcpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRBY2Nlc3NTY29wZSA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzU2NvcGUoYWNjZXNzKSB7XG4gICAgICB2YXIgaSA9IGFjY2Vzcy5hbmNlc3RvcjtcbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgdGhpcy53cml0ZSgnJHBhcmVudC4nKTtcbiAgICAgIH1cbiAgICAgIHRoaXMud3JpdGUoYWNjZXNzLm5hbWUpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRBY2Nlc3NNZW1iZXIgPSBmdW5jdGlvbiB2aXNpdEFjY2Vzc01lbWJlcihhY2Nlc3MpIHtcbiAgICAgIGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnLicgKyBhY2Nlc3MubmFtZSk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdEFjY2Vzc0tleWVkID0gZnVuY3Rpb24gdmlzaXRBY2Nlc3NLZXllZChhY2Nlc3MpIHtcbiAgICAgIGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnWycpO1xuICAgICAgYWNjZXNzLmtleS5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlKCddJyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdENhbGxTY29wZSA9IGZ1bmN0aW9uIHZpc2l0Q2FsbFNjb3BlKGNhbGwpIHtcbiAgICAgIHZhciBpID0gY2FsbC5hbmNlc3RvcjtcbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgdGhpcy53cml0ZSgnJHBhcmVudC4nKTtcbiAgICAgIH1cbiAgICAgIHRoaXMud3JpdGUoY2FsbC5uYW1lKTtcbiAgICAgIHRoaXMud3JpdGVBcmdzKGNhbGwuYXJncyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdENhbGxGdW5jdGlvbiA9IGZ1bmN0aW9uIHZpc2l0Q2FsbEZ1bmN0aW9uKGNhbGwpIHtcbiAgICAgIGNhbGwuZnVuYy5hY2NlcHQodGhpcyk7XG4gICAgICB0aGlzLndyaXRlQXJncyhjYWxsLmFyZ3MpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRDYWxsTWVtYmVyID0gZnVuY3Rpb24gdmlzaXRDYWxsTWVtYmVyKGNhbGwpIHtcbiAgICAgIGNhbGwub2JqZWN0LmFjY2VwdCh0aGlzKTtcbiAgICAgIHRoaXMud3JpdGUoJy4nICsgY2FsbC5uYW1lKTtcbiAgICAgIHRoaXMud3JpdGVBcmdzKGNhbGwuYXJncyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdFByZWZpeCA9IGZ1bmN0aW9uIHZpc2l0UHJlZml4KHByZWZpeCkge1xuICAgICAgdGhpcy53cml0ZSgnKCcgKyBwcmVmaXgub3BlcmF0aW9uKTtcbiAgICAgIGlmIChwcmVmaXgub3BlcmF0aW9uLmNoYXJDb2RlQXQoMCkgPj0gOTcpIHtcbiAgICAgICAgdGhpcy53cml0ZSgnICcpO1xuICAgICAgfVxuICAgICAgcHJlZml4LmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpO1xuICAgICAgdGhpcy53cml0ZSgnKScpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRCaW5hcnkgPSBmdW5jdGlvbiB2aXNpdEJpbmFyeShiaW5hcnkpIHtcbiAgICAgIGJpbmFyeS5sZWZ0LmFjY2VwdCh0aGlzKTtcbiAgICAgIGlmIChiaW5hcnkub3BlcmF0aW9uLmNoYXJDb2RlQXQoMCkgPT09IDEwNSkge1xuICAgICAgICB0aGlzLndyaXRlKCcgJyArIGJpbmFyeS5vcGVyYXRpb24gKyAnICcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy53cml0ZShiaW5hcnkub3BlcmF0aW9uKTtcbiAgICAgIH1cbiAgICAgIGJpbmFyeS5yaWdodC5hY2NlcHQodGhpcyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdExpdGVyYWxQcmltaXRpdmUgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxQcmltaXRpdmUobGl0ZXJhbCkge1xuICAgICAgdGhpcy53cml0ZSgnJyArIGxpdGVyYWwudmFsdWUpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsQXJyYXkgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxBcnJheShsaXRlcmFsKSB7XG4gICAgICB2YXIgZWxlbWVudHMgPSBsaXRlcmFsLmVsZW1lbnRzO1xuXG4gICAgICB0aGlzLndyaXRlKCdbJyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBlbGVtZW50cy5sZW5ndGg7IGkgPCBsZW5ndGg7ICsraSkge1xuICAgICAgICBpZiAoaSAhPT0gMCkge1xuICAgICAgICAgIHRoaXMud3JpdGUoJywnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGVsZW1lbnRzW2ldLmFjY2VwdCh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy53cml0ZSgnXScpO1xuICAgIH07XG5cbiAgICBVbnBhcnNlci5wcm90b3R5cGUudmlzaXRMaXRlcmFsT2JqZWN0ID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsT2JqZWN0KGxpdGVyYWwpIHtcbiAgICAgIHZhciBrZXlzID0gbGl0ZXJhbC5rZXlzO1xuICAgICAgdmFyIHZhbHVlcyA9IGxpdGVyYWwudmFsdWVzO1xuXG4gICAgICB0aGlzLndyaXRlKCd7Jyk7XG5cbiAgICAgIGZvciAodmFyIGkgPSAwLCBsZW5ndGggPSBrZXlzLmxlbmd0aDsgaSA8IGxlbmd0aDsgKytpKSB7XG4gICAgICAgIGlmIChpICE9PSAwKSB7XG4gICAgICAgICAgdGhpcy53cml0ZSgnLCcpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy53cml0ZSgnXFwnJyArIGtleXNbaV0gKyAnXFwnOicpO1xuICAgICAgICB2YWx1ZXNbaV0uYWNjZXB0KHRoaXMpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndyaXRlKCd9Jyk7XG4gICAgfTtcblxuICAgIFVucGFyc2VyLnByb3RvdHlwZS52aXNpdExpdGVyYWxTdHJpbmcgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxTdHJpbmcobGl0ZXJhbCkge1xuICAgICAgdmFyIGVzY2FwZWQgPSBsaXRlcmFsLnZhbHVlLnJlcGxhY2UoLycvZywgXCJcXCdcIik7XG4gICAgICB0aGlzLndyaXRlKCdcXCcnICsgZXNjYXBlZCArICdcXCcnKTtcbiAgICB9O1xuXG4gICAgVW5wYXJzZXIucHJvdG90eXBlLnZpc2l0TGl0ZXJhbFRlbXBsYXRlID0gZnVuY3Rpb24gdmlzaXRMaXRlcmFsVGVtcGxhdGUobGl0ZXJhbCkge1xuICAgICAgdmFyIGNvb2tlZCA9IGxpdGVyYWwuY29va2VkLFxuICAgICAgICAgIGV4cHJlc3Npb25zID0gbGl0ZXJhbC5leHByZXNzaW9ucztcblxuICAgICAgdmFyIGxlbmd0aCA9IGV4cHJlc3Npb25zLmxlbmd0aDtcbiAgICAgIHRoaXMud3JpdGUoJ2AnKTtcbiAgICAgIHRoaXMud3JpdGUoY29va2VkWzBdKTtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgZXhwcmVzc2lvbnNbaV0uYWNjZXB0KHRoaXMpO1xuICAgICAgICB0aGlzLndyaXRlKGNvb2tlZFtpICsgMV0pO1xuICAgICAgfVxuICAgICAgdGhpcy53cml0ZSgnYCcpO1xuICAgIH07XG5cbiAgICByZXR1cm4gVW5wYXJzZXI7XG4gIH0oKTtcbn1cblxuZXhwb3J0IHZhciBFeHByZXNzaW9uQ2xvbmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFeHByZXNzaW9uQ2xvbmVyKCkge1xuICAgIFxuICB9XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUuY2xvbmVFeHByZXNzaW9uQXJyYXkgPSBmdW5jdGlvbiBjbG9uZUV4cHJlc3Npb25BcnJheShhcnJheSkge1xuICAgIHZhciBjbG9uZWRBcnJheSA9IFtdO1xuICAgIHZhciBpID0gYXJyYXkubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGNsb25lZEFycmF5W2ldID0gYXJyYXlbaV0uYWNjZXB0KHRoaXMpO1xuICAgIH1cbiAgICByZXR1cm4gY2xvbmVkQXJyYXk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiB2aXNpdEJpbmRpbmdCZWhhdmlvcihiZWhhdmlvcikge1xuICAgIHJldHVybiBuZXcgQmluZGluZ0JlaGF2aW9yKGJlaGF2aW9yLmV4cHJlc3Npb24uYWNjZXB0KHRoaXMpLCBiZWhhdmlvci5uYW1lLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGJlaGF2aW9yLmFyZ3MpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdFZhbHVlQ29udmVydGVyID0gZnVuY3Rpb24gdmlzaXRWYWx1ZUNvbnZlcnRlcihjb252ZXJ0ZXIpIHtcbiAgICByZXR1cm4gbmV3IFZhbHVlQ29udmVydGVyKGNvbnZlcnRlci5leHByZXNzaW9uLmFjY2VwdCh0aGlzKSwgY29udmVydGVyLm5hbWUsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkoY29udmVydGVyLmFyZ3MpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFzc2lnbiA9IGZ1bmN0aW9uIHZpc2l0QXNzaWduKGFzc2lnbikge1xuICAgIHJldHVybiBuZXcgQXNzaWduKGFzc2lnbi50YXJnZXQuYWNjZXB0KHRoaXMpLCBhc3NpZ24udmFsdWUuYWNjZXB0KHRoaXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdENvbmRpdGlvbmFsID0gZnVuY3Rpb24gdmlzaXRDb25kaXRpb25hbChjb25kaXRpb25hbCkge1xuICAgIHJldHVybiBuZXcgQ29uZGl0aW9uYWwoY29uZGl0aW9uYWwuY29uZGl0aW9uLmFjY2VwdCh0aGlzKSwgY29uZGl0aW9uYWwueWVzLmFjY2VwdCh0aGlzKSwgY29uZGl0aW9uYWwubm8uYWNjZXB0KHRoaXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc1RoaXMgPSBmdW5jdGlvbiB2aXNpdEFjY2Vzc1RoaXMoYWNjZXNzKSB7XG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NUaGlzKGFjY2Vzcy5hbmNlc3Rvcik7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRBY2Nlc3NTY29wZSA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzU2NvcGUoYWNjZXNzKSB7XG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NTY29wZShhY2Nlc3MubmFtZSwgYWNjZXNzLmFuY2VzdG9yKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdEFjY2Vzc01lbWJlciA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzTWVtYmVyKGFjY2Vzcykge1xuICAgIHJldHVybiBuZXcgQWNjZXNzTWVtYmVyKGFjY2Vzcy5vYmplY3QuYWNjZXB0KHRoaXMpLCBhY2Nlc3MubmFtZSk7XG4gIH07XG5cbiAgRXhwcmVzc2lvbkNsb25lci5wcm90b3R5cGUudmlzaXRBY2Nlc3NLZXllZCA9IGZ1bmN0aW9uIHZpc2l0QWNjZXNzS2V5ZWQoYWNjZXNzKSB7XG4gICAgcmV0dXJuIG5ldyBBY2Nlc3NLZXllZChhY2Nlc3Mub2JqZWN0LmFjY2VwdCh0aGlzKSwgYWNjZXNzLmtleS5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q2FsbFNjb3BlID0gZnVuY3Rpb24gdmlzaXRDYWxsU2NvcGUoY2FsbCkge1xuICAgIHJldHVybiBuZXcgQ2FsbFNjb3BlKGNhbGwubmFtZSwgdGhpcy5jbG9uZUV4cHJlc3Npb25BcnJheShjYWxsLmFyZ3MpLCBjYWxsLmFuY2VzdG9yKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdENhbGxGdW5jdGlvbiA9IGZ1bmN0aW9uIHZpc2l0Q2FsbEZ1bmN0aW9uKGNhbGwpIHtcbiAgICByZXR1cm4gbmV3IENhbGxGdW5jdGlvbihjYWxsLmZ1bmMuYWNjZXB0KHRoaXMpLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGNhbGwuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0Q2FsbE1lbWJlciA9IGZ1bmN0aW9uIHZpc2l0Q2FsbE1lbWJlcihjYWxsKSB7XG4gICAgcmV0dXJuIG5ldyBDYWxsTWVtYmVyKGNhbGwub2JqZWN0LmFjY2VwdCh0aGlzKSwgY2FsbC5uYW1lLCB0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGNhbGwuYXJncykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0VW5hcnkgPSBmdW5jdGlvbiB2aXNpdFVuYXJ5KHVuYXJ5KSB7XG4gICAgcmV0dXJuIG5ldyBVbmFyeShwcmVmaXgub3BlcmF0aW9uLCBwcmVmaXguZXhwcmVzc2lvbi5hY2NlcHQodGhpcykpO1xuICB9O1xuXG4gIEV4cHJlc3Npb25DbG9uZXIucHJvdG90eXBlLnZpc2l0QmluYXJ5ID0gZnVuY3Rpb24gdmlzaXRCaW5hcnkoYmluYXJ5KSB7XG4gICAgcmV0dXJuIG5ldyBCaW5hcnkoYmluYXJ5Lm9wZXJhdGlvbiwgYmluYXJ5LmxlZnQuYWNjZXB0KHRoaXMpLCBiaW5hcnkucmlnaHQuYWNjZXB0KHRoaXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxQcmltaXRpdmUgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxQcmltaXRpdmUobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFByaW1pdGl2ZShsaXRlcmFsKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxBcnJheSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbEFycmF5KGxpdGVyYWwpIHtcbiAgICByZXR1cm4gbmV3IExpdGVyYWxBcnJheSh0aGlzLmNsb25lRXhwcmVzc2lvbkFycmF5KGxpdGVyYWwuZWxlbWVudHMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxPYmplY3QgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxPYmplY3QobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbE9iamVjdChsaXRlcmFsLmtleXMsIHRoaXMuY2xvbmVFeHByZXNzaW9uQXJyYXkobGl0ZXJhbC52YWx1ZXMpKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxTdHJpbmcgPSBmdW5jdGlvbiB2aXNpdExpdGVyYWxTdHJpbmcobGl0ZXJhbCkge1xuICAgIHJldHVybiBuZXcgTGl0ZXJhbFN0cmluZyhsaXRlcmFsLnZhbHVlKTtcbiAgfTtcblxuICBFeHByZXNzaW9uQ2xvbmVyLnByb3RvdHlwZS52aXNpdExpdGVyYWxUZW1wbGF0ZSA9IGZ1bmN0aW9uIHZpc2l0TGl0ZXJhbFRlbXBsYXRlKGxpdGVyYWwpIHtcbiAgICByZXR1cm4gbmV3IExpdGVyYWxUZW1wbGF0ZShsaXRlcmFsLmNvb2tlZCwgdGhpcy5jbG9uZUV4cHJlc3Npb25BcnJheShsaXRlcmFsLmV4cHJlc3Npb25zKSwgbGl0ZXJhbC5yYXcsIGxpdGVyYWwudGFnICYmIGxpdGVyYWwudGFnLmFjY2VwdCh0aGlzKSk7XG4gIH07XG5cbiAgcmV0dXJuIEV4cHJlc3Npb25DbG9uZXI7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjbG9uZUV4cHJlc3Npb24oZXhwcmVzc2lvbikge1xuICB2YXIgdmlzaXRvciA9IG5ldyBFeHByZXNzaW9uQ2xvbmVyKCk7XG4gIHJldHVybiBleHByZXNzaW9uLmFjY2VwdCh2aXNpdG9yKTtcbn1cblxuZXhwb3J0IHZhciBiaW5kaW5nTW9kZSA9IHtcbiAgb25lVGltZTogMCxcbiAgdG9WaWV3OiAxLFxuICBvbmVXYXk6IDEsXG4gIHR3b1dheTogMixcbiAgZnJvbVZpZXc6IDNcbn07XG5cbmV4cG9ydCB2YXIgUGFyc2VyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQYXJzZXIoKSB7XG4gICAgXG5cbiAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIFBhcnNlci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiBwYXJzZShzcmMpIHtcbiAgICBzcmMgPSBzcmMgfHwgJyc7XG5cbiAgICByZXR1cm4gdGhpcy5jYWNoZVtzcmNdIHx8ICh0aGlzLmNhY2hlW3NyY10gPSBuZXcgUGFyc2VySW1wbGVtZW50YXRpb24oc3JjKS5wYXJzZUJpbmRpbmdCZWhhdmlvcigpKTtcbiAgfTtcblxuICByZXR1cm4gUGFyc2VyO1xufSgpO1xuXG52YXIgZnJvbUNoYXJDb2RlID0gU3RyaW5nLmZyb21DaGFyQ29kZTtcblxuZXhwb3J0IHZhciBQYXJzZXJJbXBsZW1lbnRhdGlvbiA9IGZ1bmN0aW9uICgpIHtcbiAgX2NyZWF0ZUNsYXNzKFBhcnNlckltcGxlbWVudGF0aW9uLCBbe1xuICAgIGtleTogJ3JhdycsXG4gICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7XG4gICAgICByZXR1cm4gdGhpcy5zcmMuc2xpY2UodGhpcy5zdGFydCwgdGhpcy5pZHgpO1xuICAgIH1cbiAgfV0pO1xuXG4gIGZ1bmN0aW9uIFBhcnNlckltcGxlbWVudGF0aW9uKHNyYykge1xuICAgIFxuXG4gICAgdGhpcy5pZHggPSAwO1xuXG4gICAgdGhpcy5zdGFydCA9IDA7XG5cbiAgICB0aGlzLnNyYyA9IHNyYztcbiAgICB0aGlzLmxlbiA9IHNyYy5sZW5ndGg7XG5cbiAgICB0aGlzLnRrbiA9IFQkRU9GO1xuXG4gICAgdGhpcy52YWwgPSB1bmRlZmluZWQ7XG5cbiAgICB0aGlzLmNoID0gc3JjLmNoYXJDb2RlQXQoMCk7XG4gIH1cblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUucGFyc2VCaW5kaW5nQmVoYXZpb3IgPSBmdW5jdGlvbiBwYXJzZUJpbmRpbmdCZWhhdmlvcigpIHtcbiAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgIGlmICh0aGlzLnRrbiAmIFQkRXhwcmVzc2lvblRlcm1pbmFsKSB7XG4gICAgICB0aGlzLmVycignSW52YWxpZCBzdGFydCBvZiBleHByZXNzaW9uJyk7XG4gICAgfVxuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlVmFsdWVDb252ZXJ0ZXIoKTtcbiAgICB3aGlsZSAodGhpcy5vcHQoVCRBbXBlcnNhbmQpKSB7XG4gICAgICByZXN1bHQgPSBuZXcgQmluZGluZ0JlaGF2aW9yKHJlc3VsdCwgdGhpcy52YWwsIHRoaXMucGFyc2VWYXJpYWRpY0FyZ3MoKSk7XG4gICAgfVxuICAgIGlmICh0aGlzLnRrbiAhPT0gVCRFT0YpIHtcbiAgICAgIHRoaXMuZXJyKCdVbmNvbnN1bWVkIHRva2VuICcgKyB0aGlzLnJhdyk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlVmFsdWVDb252ZXJ0ZXIgPSBmdW5jdGlvbiBwYXJzZVZhbHVlQ29udmVydGVyKCkge1xuICAgIHZhciByZXN1bHQgPSB0aGlzLnBhcnNlRXhwcmVzc2lvbigpO1xuICAgIHdoaWxlICh0aGlzLm9wdChUJEJhcikpIHtcbiAgICAgIHJlc3VsdCA9IG5ldyBWYWx1ZUNvbnZlcnRlcihyZXN1bHQsIHRoaXMudmFsLCB0aGlzLnBhcnNlVmFyaWFkaWNBcmdzKCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZVZhcmlhZGljQXJncyA9IGZ1bmN0aW9uIHBhcnNlVmFyaWFkaWNBcmdzKCkge1xuICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHdoaWxlICh0aGlzLm9wdChUJENvbG9uKSkge1xuICAgICAgcmVzdWx0LnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbigpIHtcbiAgICB2YXIgZXhwclN0YXJ0ID0gdGhpcy5pZHg7XG4gICAgdmFyIHJlc3VsdCA9IHRoaXMucGFyc2VDb25kaXRpb25hbCgpO1xuXG4gICAgd2hpbGUgKHRoaXMudGtuID09PSBUJEVxKSB7XG4gICAgICBpZiAoIXJlc3VsdC5pc0Fzc2lnbmFibGUpIHtcbiAgICAgICAgdGhpcy5lcnIoJ0V4cHJlc3Npb24gJyArIHRoaXMuc3JjLnNsaWNlKGV4cHJTdGFydCwgdGhpcy5zdGFydCkgKyAnIGlzIG5vdCBhc3NpZ25hYmxlJyk7XG4gICAgICB9XG4gICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgZXhwclN0YXJ0ID0gdGhpcy5pZHg7XG4gICAgICByZXN1bHQgPSBuZXcgQXNzaWduKHJlc3VsdCwgdGhpcy5wYXJzZUNvbmRpdGlvbmFsKCkpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUNvbmRpdGlvbmFsID0gZnVuY3Rpb24gcGFyc2VDb25kaXRpb25hbCgpIHtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5wYXJzZUJpbmFyeSgwKTtcblxuICAgIGlmICh0aGlzLm9wdChUJFF1ZXN0aW9uKSkge1xuICAgICAgdmFyIHllcyA9IHRoaXMucGFyc2VFeHByZXNzaW9uKCk7XG4gICAgICB0aGlzLmV4cGVjdChUJENvbG9uKTtcbiAgICAgIHJlc3VsdCA9IG5ldyBDb25kaXRpb25hbChyZXN1bHQsIHllcywgdGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlQmluYXJ5ID0gZnVuY3Rpb24gcGFyc2VCaW5hcnkobWluUHJlY2VkZW5jZSkge1xuICAgIHZhciBsZWZ0ID0gdGhpcy5wYXJzZUxlZnRIYW5kU2lkZSgwKTtcblxuICAgIHdoaWxlICh0aGlzLnRrbiAmIFQkQmluYXJ5T3ApIHtcbiAgICAgIHZhciBvcFRva2VuID0gdGhpcy50a247XG4gICAgICBpZiAoKG9wVG9rZW4gJiBUJFByZWNlZGVuY2UpIDw9IG1pblByZWNlZGVuY2UpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgbGVmdCA9IG5ldyBCaW5hcnkoVG9rZW5WYWx1ZXNbb3BUb2tlbiAmIFQkVG9rZW5NYXNrXSwgbGVmdCwgdGhpcy5wYXJzZUJpbmFyeShvcFRva2VuICYgVCRQcmVjZWRlbmNlKSk7XG4gICAgfVxuICAgIHJldHVybiBsZWZ0O1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5wYXJzZUxlZnRIYW5kU2lkZSA9IGZ1bmN0aW9uIHBhcnNlTGVmdEhhbmRTaWRlKGNvbnRleHQpIHtcbiAgICB2YXIgcmVzdWx0ID0gdm9pZCAwO1xuXG4gICAgcHJpbWFyeTogc3dpdGNoICh0aGlzLnRrbikge1xuICAgICAgY2FzZSBUJFBsdXM6XG4gICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgIHJldHVybiB0aGlzLnBhcnNlTGVmdEhhbmRTaWRlKDApO1xuICAgICAgY2FzZSBUJE1pbnVzOlxuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICByZXR1cm4gbmV3IEJpbmFyeSgnLScsIG5ldyBMaXRlcmFsUHJpbWl0aXZlKDApLCB0aGlzLnBhcnNlTGVmdEhhbmRTaWRlKDApKTtcbiAgICAgIGNhc2UgVCRCYW5nOlxuICAgICAgY2FzZSBUJFR5cGVvZktleXdvcmQ6XG4gICAgICBjYXNlIFQkVm9pZEtleXdvcmQ6XG4gICAgICAgIHZhciBvcCA9IFRva2VuVmFsdWVzW3RoaXMudGtuICYgVCRUb2tlbk1hc2tdO1xuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICByZXR1cm4gbmV3IFVuYXJ5KG9wLCB0aGlzLnBhcnNlTGVmdEhhbmRTaWRlKDApKTtcbiAgICAgIGNhc2UgVCRQYXJlbnRTY29wZTpcbiAgICAgICAge1xuICAgICAgICAgIGRvIHtcbiAgICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgICBjb250ZXh0Kys7XG4gICAgICAgICAgICBpZiAodGhpcy5vcHQoVCRQZXJpb2QpKSB7XG4gICAgICAgICAgICAgIGlmICh0aGlzLnRrbiA9PT0gVCRQZXJpb2QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmVycigpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRrbiAmIFQkQWNjZXNzU2NvcGVUZXJtaW5hbCkge1xuICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgQWNjZXNzVGhpcyhjb250ZXh0ICYgQyRBbmNlc3Rvcik7XG5cbiAgICAgICAgICAgICAgY29udGV4dCA9IGNvbnRleHQgJiBDJFNob3J0aGFuZFByb3AgfCBDJFRoaXM7XG4gICAgICAgICAgICAgIGJyZWFrIHByaW1hcnk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLmVycigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gd2hpbGUgKHRoaXMudGtuID09PSBUJFBhcmVudFNjb3BlKTtcbiAgICAgICAgfVxuXG4gICAgICBjYXNlIFQkSWRlbnRpZmllcjpcbiAgICAgICAge1xuICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NTY29wZSh0aGlzLnZhbCwgY29udGV4dCAmIEMkQW5jZXN0b3IpO1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgY29udGV4dCA9IGNvbnRleHQgJiBDJFNob3J0aGFuZFByb3AgfCBDJFNjb3BlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICBjYXNlIFQkVGhpc1Njb3BlOlxuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICByZXN1bHQgPSBuZXcgQWNjZXNzVGhpcygwKTtcbiAgICAgICAgY29udGV4dCA9IGNvbnRleHQgJiBDJFNob3J0aGFuZFByb3AgfCBDJFRoaXM7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBUJExQYXJlbjpcbiAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5wYXJzZUV4cHJlc3Npb24oKTtcbiAgICAgICAgdGhpcy5leHBlY3QoVCRSUGFyZW4pO1xuICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVCRMQnJhY2tldDpcbiAgICAgICAge1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgdmFyIF9lbGVtZW50cyA9IFtdO1xuICAgICAgICAgIGlmICh0aGlzLnRrbiAhPT0gVCRSQnJhY2tldCkge1xuICAgICAgICAgICAgZG8ge1xuICAgICAgICAgICAgICBfZWxlbWVudHMucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgICAgICAgIH0gd2hpbGUgKHRoaXMub3B0KFQkQ29tbWEpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5leHBlY3QoVCRSQnJhY2tldCk7XG4gICAgICAgICAgcmVzdWx0ID0gbmV3IExpdGVyYWxBcnJheShfZWxlbWVudHMpO1xuICAgICAgICAgIGNvbnRleHQgPSBDJFByaW1hcnk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgVCRMQnJhY2U6XG4gICAgICAgIHtcbiAgICAgICAgICB2YXIga2V5cyA9IFtdO1xuICAgICAgICAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgIHdoaWxlICh0aGlzLnRrbiAhPT0gVCRSQnJhY2UpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnRrbiAmIFQkSWRlbnRpZmllck9yS2V5d29yZCkge1xuICAgICAgICAgICAgICB2YXIgY2ggPSB0aGlzLmNoLFxuICAgICAgICAgICAgICAgICAgdGtuID0gdGhpcy50a24sXG4gICAgICAgICAgICAgICAgICBpZHggPSB0aGlzLmlkeDtcblxuICAgICAgICAgICAgICBrZXlzLnB1c2godGhpcy52YWwpO1xuICAgICAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgICAgICBpZiAodGhpcy5vcHQoVCRDb2xvbikpIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXMucHVzaCh0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoID0gY2g7XG4gICAgICAgICAgICAgICAgdGhpcy50a24gPSB0a247XG4gICAgICAgICAgICAgICAgdGhpcy5pZHggPSBpZHg7XG4gICAgICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5wYXJzZUxlZnRIYW5kU2lkZShDJFNob3J0aGFuZFByb3ApKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIGlmICh0aGlzLnRrbiAmIFQkTGl0ZXJhbCkge1xuICAgICAgICAgICAgICBrZXlzLnB1c2godGhpcy52YWwpO1xuICAgICAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgICAgICB0aGlzLmV4cGVjdChUJENvbG9uKTtcbiAgICAgICAgICAgICAgdmFsdWVzLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aGlzLmVycigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudGtuICE9PSBUJFJCcmFjZSkge1xuICAgICAgICAgICAgICB0aGlzLmV4cGVjdChUJENvbW1hKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5leHBlY3QoVCRSQnJhY2UpO1xuICAgICAgICAgIHJlc3VsdCA9IG5ldyBMaXRlcmFsT2JqZWN0KGtleXMsIHZhbHVlcyk7XG4gICAgICAgICAgY29udGV4dCA9IEMkUHJpbWFyeTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgY2FzZSBUJFN0cmluZ0xpdGVyYWw6XG4gICAgICAgIHJlc3VsdCA9IG5ldyBMaXRlcmFsU3RyaW5nKHRoaXMudmFsKTtcbiAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgY29udGV4dCA9IEMkUHJpbWFyeTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIFQkVGVtcGxhdGVUYWlsOlxuICAgICAgICByZXN1bHQgPSBuZXcgTGl0ZXJhbFRlbXBsYXRlKFt0aGlzLnZhbF0pO1xuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVCRUZW1wbGF0ZUNvbnRpbnVhdGlvbjpcbiAgICAgICAgcmVzdWx0ID0gdGhpcy5wYXJzZVRlbXBsYXRlKDApO1xuICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgVCROdW1lcmljTGl0ZXJhbDpcbiAgICAgICAge1xuICAgICAgICAgIHJlc3VsdCA9IG5ldyBMaXRlcmFsUHJpbWl0aXZlKHRoaXMudmFsKTtcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuXG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIGNhc2UgVCROdWxsS2V5d29yZDpcbiAgICAgIGNhc2UgVCRVbmRlZmluZWRLZXl3b3JkOlxuICAgICAgY2FzZSBUJFRydWVLZXl3b3JkOlxuICAgICAgY2FzZSBUJEZhbHNlS2V5d29yZDpcbiAgICAgICAgcmVzdWx0ID0gbmV3IExpdGVyYWxQcmltaXRpdmUoVG9rZW5WYWx1ZXNbdGhpcy50a24gJiBUJFRva2VuTWFza10pO1xuICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICBjb250ZXh0ID0gQyRQcmltYXJ5O1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGlmICh0aGlzLmlkeCA+PSB0aGlzLmxlbikge1xuICAgICAgICAgIHRoaXMuZXJyKCdVbmV4cGVjdGVkIGVuZCBvZiBleHByZXNzaW9uJyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5lcnIoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGlmIChjb250ZXh0ICYgQyRTaG9ydGhhbmRQcm9wKSB7XG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cblxuICAgIHZhciBuYW1lID0gdGhpcy52YWw7XG4gICAgd2hpbGUgKHRoaXMudGtuICYgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uKSB7XG4gICAgICBzd2l0Y2ggKHRoaXMudGtuKSB7XG4gICAgICAgIGNhc2UgVCRQZXJpb2Q6XG4gICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICBpZiAoISh0aGlzLnRrbiAmIFQkSWRlbnRpZmllck9yS2V5d29yZCkpIHtcbiAgICAgICAgICAgIHRoaXMuZXJyKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG5hbWUgPSB0aGlzLnZhbDtcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuXG4gICAgICAgICAgY29udGV4dCA9IGNvbnRleHQgJiBDJFByaW1hcnkgfCAoY29udGV4dCAmIChDJFRoaXMgfCBDJFNjb3BlKSkgPDwgMSB8IGNvbnRleHQgJiBDJE1lbWJlciB8IChjb250ZXh0ICYgQyRLZXllZCkgPj4gMSB8IChjb250ZXh0ICYgQyRDYWxsKSA+PiAyO1xuICAgICAgICAgIGlmICh0aGlzLnRrbiA9PT0gVCRMUGFyZW4pIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY29udGV4dCAmIEMkU2NvcGUpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBBY2Nlc3NTY29wZShuYW1lLCByZXN1bHQuYW5jZXN0b3IpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBuZXcgQWNjZXNzTWVtYmVyKHJlc3VsdCwgbmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICBjYXNlIFQkTEJyYWNrZXQ6XG4gICAgICAgICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICAgICAgICBjb250ZXh0ID0gQyRLZXllZDtcbiAgICAgICAgICByZXN1bHQgPSBuZXcgQWNjZXNzS2V5ZWQocmVzdWx0LCB0aGlzLnBhcnNlRXhwcmVzc2lvbigpKTtcbiAgICAgICAgICB0aGlzLmV4cGVjdChUJFJCcmFja2V0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUJExQYXJlbjpcbiAgICAgICAgICB0aGlzLm5leHRUb2tlbigpO1xuICAgICAgICAgIHZhciBhcmdzID0gW107XG4gICAgICAgICAgd2hpbGUgKHRoaXMudGtuICE9PSBUJFJQYXJlbikge1xuICAgICAgICAgICAgYXJncy5wdXNoKHRoaXMucGFyc2VFeHByZXNzaW9uKCkpO1xuICAgICAgICAgICAgaWYgKCF0aGlzLm9wdChUJENvbW1hKSkge1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy5leHBlY3QoVCRSUGFyZW4pO1xuICAgICAgICAgIGlmIChjb250ZXh0ICYgQyRTY29wZSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gbmV3IENhbGxTY29wZShuYW1lLCBhcmdzLCByZXN1bHQuYW5jZXN0b3IpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoY29udGV4dCAmIChDJE1lbWJlciB8IEMkUHJpbWFyeSkpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBDYWxsTWVtYmVyKHJlc3VsdCwgbmFtZSwgYXJncyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IG5ldyBDYWxsRnVuY3Rpb24ocmVzdWx0LCBhcmdzKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29udGV4dCA9IEMkQ2FsbDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBUJFRlbXBsYXRlVGFpbDpcbiAgICAgICAgICByZXN1bHQgPSBuZXcgTGl0ZXJhbFRlbXBsYXRlKFt0aGlzLnZhbF0sIFtdLCBbdGhpcy5yYXddLCByZXN1bHQpO1xuICAgICAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgVCRUZW1wbGF0ZUNvbnRpbnVhdGlvbjpcbiAgICAgICAgICByZXN1bHQgPSB0aGlzLnBhcnNlVGVtcGxhdGUoY29udGV4dCB8IEMkVGFnZ2VkLCByZXN1bHQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLnBhcnNlVGVtcGxhdGUgPSBmdW5jdGlvbiBwYXJzZVRlbXBsYXRlKGNvbnRleHQsIGZ1bmMpIHtcbiAgICB2YXIgY29va2VkID0gW3RoaXMudmFsXTtcbiAgICB2YXIgcmF3ID0gY29udGV4dCAmIEMkVGFnZ2VkID8gW3RoaXMucmF3XSA6IHVuZGVmaW5lZDtcbiAgICB0aGlzLmV4cGVjdChUJFRlbXBsYXRlQ29udGludWF0aW9uKTtcbiAgICB2YXIgZXhwcmVzc2lvbnMgPSBbdGhpcy5wYXJzZUV4cHJlc3Npb24oKV07XG5cbiAgICB3aGlsZSAoKHRoaXMudGtuID0gdGhpcy5zY2FuVGVtcGxhdGVUYWlsKCkpICE9PSBUJFRlbXBsYXRlVGFpbCkge1xuICAgICAgY29va2VkLnB1c2godGhpcy52YWwpO1xuICAgICAgaWYgKGNvbnRleHQgJiBDJFRhZ2dlZCkge1xuICAgICAgICByYXcucHVzaCh0aGlzLnJhdyk7XG4gICAgICB9XG4gICAgICB0aGlzLmV4cGVjdChUJFRlbXBsYXRlQ29udGludWF0aW9uKTtcbiAgICAgIGV4cHJlc3Npb25zLnB1c2godGhpcy5wYXJzZUV4cHJlc3Npb24oKSk7XG4gICAgfVxuXG4gICAgY29va2VkLnB1c2godGhpcy52YWwpO1xuICAgIGlmIChjb250ZXh0ICYgQyRUYWdnZWQpIHtcbiAgICAgIHJhdy5wdXNoKHRoaXMucmF3KTtcbiAgICB9XG4gICAgdGhpcy5uZXh0VG9rZW4oKTtcbiAgICByZXR1cm4gbmV3IExpdGVyYWxUZW1wbGF0ZShjb29rZWQsIGV4cHJlc3Npb25zLCByYXcsIGZ1bmMpO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5uZXh0VG9rZW4gPSBmdW5jdGlvbiBuZXh0VG9rZW4oKSB7XG4gICAgd2hpbGUgKHRoaXMuaWR4IDwgdGhpcy5sZW4pIHtcbiAgICAgIGlmICh0aGlzLmNoIDw9IDB4MjApIHtcbiAgICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdGhpcy5zdGFydCA9IHRoaXMuaWR4O1xuICAgICAgaWYgKHRoaXMuY2ggPT09IDB4MjQgfHwgdGhpcy5jaCA+PSAweDYxICYmIHRoaXMuY2ggPD0gMHg3QSkge1xuICAgICAgICB0aGlzLnRrbiA9IHRoaXMuc2NhbklkZW50aWZpZXIoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBpZiAoKHRoaXMudGtuID0gQ2hhclNjYW5uZXJzW3RoaXMuY2hdKHRoaXMpKSAhPT0gbnVsbCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICAgIHRoaXMudGtuID0gVCRFT0Y7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLm5leHQgPSBmdW5jdGlvbiBuZXh0KCkge1xuICAgIHJldHVybiB0aGlzLmNoID0gdGhpcy5zcmMuY2hhckNvZGVBdCgrK3RoaXMuaWR4KTtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuc2NhbklkZW50aWZpZXIgPSBmdW5jdGlvbiBzY2FuSWRlbnRpZmllcigpIHtcbiAgICB3aGlsZSAoQXNjaWlJZFBhcnRzLmhhcyh0aGlzLm5leHQoKSkgfHwgdGhpcy5jaCA+IDB4N0YgJiYgSWRQYXJ0c1t0aGlzLmNoXSkge31cblxuICAgIHJldHVybiBLZXl3b3JkTG9va3VwW3RoaXMudmFsID0gdGhpcy5yYXddIHx8IFQkSWRlbnRpZmllcjtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuc2Nhbk51bWJlciA9IGZ1bmN0aW9uIHNjYW5OdW1iZXIoaXNGbG9hdCkge1xuICAgIGlmIChpc0Zsb2F0KSB7XG4gICAgICB0aGlzLnZhbCA9IDA7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMudmFsID0gdGhpcy5jaCAtIDB4MzA7XG4gICAgICB3aGlsZSAodGhpcy5uZXh0KCkgPD0gMHgzOSAmJiB0aGlzLmNoID49IDB4MzApIHtcbiAgICAgICAgdGhpcy52YWwgPSB0aGlzLnZhbCAqIDEwICsgdGhpcy5jaCAtIDB4MzA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGlzRmxvYXQgfHwgdGhpcy5jaCA9PT0gMHgyRSkge1xuICAgICAgaWYgKCFpc0Zsb2F0KSB7XG4gICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgfVxuICAgICAgdmFyIHN0YXJ0ID0gdGhpcy5pZHg7XG4gICAgICB2YXIgdmFsdWUgPSB0aGlzLmNoIC0gMHgzMDtcbiAgICAgIHdoaWxlICh0aGlzLm5leHQoKSA8PSAweDM5ICYmIHRoaXMuY2ggPj0gMHgzMCkge1xuICAgICAgICB2YWx1ZSA9IHZhbHVlICogMTAgKyB0aGlzLmNoIC0gMHgzMDtcbiAgICAgIH1cbiAgICAgIHRoaXMudmFsID0gdGhpcy52YWwgKyB2YWx1ZSAvIE1hdGgucG93KDEwLCB0aGlzLmlkeCAtIHN0YXJ0KTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5jaCA9PT0gMHg2NSB8fCB0aGlzLmNoID09PSAweDQ1KSB7XG4gICAgICB2YXIgX3N0YXJ0ID0gdGhpcy5pZHg7XG5cbiAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgaWYgKHRoaXMuY2ggPT09IDB4MkQgfHwgdGhpcy5jaCA9PT0gMHgyQikge1xuICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCEodGhpcy5jaCA+PSAweDMwICYmIHRoaXMuY2ggPD0gMHgzOSkpIHtcbiAgICAgICAgdGhpcy5pZHggPSBfc3RhcnQ7XG4gICAgICAgIHRoaXMuZXJyKCdJbnZhbGlkIGV4cG9uZW50Jyk7XG4gICAgICB9XG4gICAgICB3aGlsZSAodGhpcy5uZXh0KCkgPD0gMHgzOSAmJiB0aGlzLmNoID49IDB4MzApIHt9XG4gICAgICB0aGlzLnZhbCA9IHBhcnNlRmxvYXQodGhpcy5zcmMuc2xpY2UodGhpcy5zdGFydCwgdGhpcy5pZHgpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gVCROdW1lcmljTGl0ZXJhbDtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuc2NhblN0cmluZyA9IGZ1bmN0aW9uIHNjYW5TdHJpbmcoKSB7XG4gICAgdmFyIHF1b3RlID0gdGhpcy5jaDtcbiAgICB0aGlzLm5leHQoKTtcblxuICAgIHZhciBidWZmZXIgPSB2b2lkIDA7XG4gICAgdmFyIG1hcmtlciA9IHRoaXMuaWR4O1xuXG4gICAgd2hpbGUgKHRoaXMuY2ggIT09IHF1b3RlKSB7XG4gICAgICBpZiAodGhpcy5jaCA9PT0gMHg1Qykge1xuICAgICAgICBpZiAoIWJ1ZmZlcikge1xuICAgICAgICAgIGJ1ZmZlciA9IFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgYnVmZmVyLnB1c2godGhpcy5zcmMuc2xpY2UobWFya2VyLCB0aGlzLmlkeCkpO1xuXG4gICAgICAgIHRoaXMubmV4dCgpO1xuXG4gICAgICAgIHZhciBfdW5lc2NhcGVkID0gdm9pZCAwO1xuXG4gICAgICAgIGlmICh0aGlzLmNoID09PSAweDc1KSB7XG4gICAgICAgICAgdGhpcy5uZXh0KCk7XG5cbiAgICAgICAgICBpZiAodGhpcy5pZHggKyA0IDwgdGhpcy5sZW4pIHtcbiAgICAgICAgICAgIHZhciBoZXggPSB0aGlzLnNyYy5zbGljZSh0aGlzLmlkeCwgdGhpcy5pZHggKyA0KTtcblxuICAgICAgICAgICAgaWYgKCEvW0EtWjAtOV17NH0vaS50ZXN0KGhleCkpIHtcbiAgICAgICAgICAgICAgdGhpcy5lcnIoJ0ludmFsaWQgdW5pY29kZSBlc2NhcGUgW1xcXFx1JyArIGhleCArICddJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIF91bmVzY2FwZWQgPSBwYXJzZUludChoZXgsIDE2KTtcbiAgICAgICAgICAgIHRoaXMuaWR4ICs9IDQ7XG4gICAgICAgICAgICB0aGlzLmNoID0gdGhpcy5zcmMuY2hhckNvZGVBdCh0aGlzLmlkeCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZXJyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIF91bmVzY2FwZWQgPSB1bmVzY2FwZSh0aGlzLmNoKTtcbiAgICAgICAgICB0aGlzLm5leHQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGJ1ZmZlci5wdXNoKGZyb21DaGFyQ29kZShfdW5lc2NhcGVkKSk7XG4gICAgICAgIG1hcmtlciA9IHRoaXMuaWR4O1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmNoID09PSAwIHx8IHRoaXMuaWR4ID49IHRoaXMubGVuKSB7XG4gICAgICAgIHRoaXMuZXJyKCdVbnRlcm1pbmF0ZWQgcXVvdGUnKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMubmV4dCgpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBsYXN0ID0gdGhpcy5zcmMuc2xpY2UobWFya2VyLCB0aGlzLmlkeCk7XG4gICAgdGhpcy5uZXh0KCk7XG4gICAgdmFyIHVuZXNjYXBlZCA9IGxhc3Q7XG5cbiAgICBpZiAoYnVmZmVyICE9PSBudWxsICYmIGJ1ZmZlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBidWZmZXIucHVzaChsYXN0KTtcbiAgICAgIHVuZXNjYXBlZCA9IGJ1ZmZlci5qb2luKCcnKTtcbiAgICB9XG5cbiAgICB0aGlzLnZhbCA9IHVuZXNjYXBlZDtcbiAgICByZXR1cm4gVCRTdHJpbmdMaXRlcmFsO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5zY2FuVGVtcGxhdGUgPSBmdW5jdGlvbiBzY2FuVGVtcGxhdGUoKSB7XG4gICAgdmFyIHRhaWwgPSB0cnVlO1xuICAgIHZhciByZXN1bHQgPSAnJztcblxuICAgIHdoaWxlICh0aGlzLm5leHQoKSAhPT0gMHg2MCkge1xuICAgICAgaWYgKHRoaXMuY2ggPT09IDB4MjQpIHtcbiAgICAgICAgaWYgKHRoaXMuaWR4ICsgMSA8IHRoaXMubGVuICYmIHRoaXMuc3JjLmNoYXJDb2RlQXQodGhpcy5pZHggKyAxKSA9PT0gMHg3Qikge1xuICAgICAgICAgIHRoaXMuaWR4Kys7XG4gICAgICAgICAgdGFpbCA9IGZhbHNlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdCArPSAnJCc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodGhpcy5jaCA9PT0gMHg1Qykge1xuICAgICAgICByZXN1bHQgKz0gZnJvbUNoYXJDb2RlKHVuZXNjYXBlKHRoaXMubmV4dCgpKSk7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMuY2ggPT09IDAgfHwgdGhpcy5pZHggPj0gdGhpcy5sZW4pIHtcbiAgICAgICAgdGhpcy5lcnIoJ1VudGVybWluYXRlZCB0ZW1wbGF0ZSBsaXRlcmFsJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQgKz0gZnJvbUNoYXJDb2RlKHRoaXMuY2gpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMubmV4dCgpO1xuICAgIHRoaXMudmFsID0gcmVzdWx0O1xuICAgIGlmICh0YWlsKSB7XG4gICAgICByZXR1cm4gVCRUZW1wbGF0ZVRhaWw7XG4gICAgfVxuICAgIHJldHVybiBUJFRlbXBsYXRlQ29udGludWF0aW9uO1xuICB9O1xuXG4gIFBhcnNlckltcGxlbWVudGF0aW9uLnByb3RvdHlwZS5zY2FuVGVtcGxhdGVUYWlsID0gZnVuY3Rpb24gc2NhblRlbXBsYXRlVGFpbCgpIHtcbiAgICBpZiAodGhpcy5pZHggPj0gdGhpcy5sZW4pIHtcbiAgICAgIHRoaXMuZXJyKCdVbnRlcm1pbmF0ZWQgdGVtcGxhdGUnKTtcbiAgICB9XG4gICAgdGhpcy5pZHgtLTtcbiAgICByZXR1cm4gdGhpcy5zY2FuVGVtcGxhdGUoKTtcbiAgfTtcblxuICBQYXJzZXJJbXBsZW1lbnRhdGlvbi5wcm90b3R5cGUuZXJyID0gZnVuY3Rpb24gZXJyKCkge1xuICAgIHZhciBtZXNzYWdlID0gYXJndW1lbnRzLmxlbmd0aCA+IDAgJiYgYXJndW1lbnRzWzBdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMF0gOiAnVW5leHBlY3RlZCB0b2tlbiAnICsgdGhpcy5yYXc7XG4gICAgdmFyIGNvbHVtbiA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogdGhpcy5zdGFydDtcblxuICAgIHRocm93IG5ldyBFcnJvcignUGFyc2VyIEVycm9yOiAnICsgbWVzc2FnZSArICcgYXQgY29sdW1uICcgKyBjb2x1bW4gKyAnIGluIGV4cHJlc3Npb24gWycgKyB0aGlzLnNyYyArICddJyk7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLm9wdCA9IGZ1bmN0aW9uIG9wdCh0b2tlbikge1xuICAgIGlmICh0aGlzLnRrbiA9PT0gdG9rZW4pIHtcbiAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgUGFyc2VySW1wbGVtZW50YXRpb24ucHJvdG90eXBlLmV4cGVjdCA9IGZ1bmN0aW9uIGV4cGVjdCh0b2tlbikge1xuICAgIGlmICh0aGlzLnRrbiA9PT0gdG9rZW4pIHtcbiAgICAgIHRoaXMubmV4dFRva2VuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXJyKCdNaXNzaW5nIGV4cGVjdGVkIHRva2VuICcgKyBUb2tlblZhbHVlc1t0b2tlbiAmIFQkVG9rZW5NYXNrXSwgdGhpcy5pZHgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gUGFyc2VySW1wbGVtZW50YXRpb247XG59KCk7XG5cbmZ1bmN0aW9uIHVuZXNjYXBlKGNvZGUpIHtcbiAgc3dpdGNoIChjb2RlKSB7XG4gICAgY2FzZSAweDY2OlxuICAgICAgcmV0dXJuIDB4QztcbiAgICBjYXNlIDB4NkU6XG4gICAgICByZXR1cm4gMHhBO1xuICAgIGNhc2UgMHg3MjpcbiAgICAgIHJldHVybiAweEQ7XG4gICAgY2FzZSAweDc0OlxuICAgICAgcmV0dXJuIDB4OTtcbiAgICBjYXNlIDB4NzY6XG4gICAgICByZXR1cm4gMHhCO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gY29kZTtcbiAgfVxufVxuXG52YXIgQyRUaGlzID0gMSA8PCAxMDtcbnZhciBDJFNjb3BlID0gMSA8PCAxMTtcbnZhciBDJE1lbWJlciA9IDEgPDwgMTI7XG52YXIgQyRLZXllZCA9IDEgPDwgMTM7XG52YXIgQyRDYWxsID0gMSA8PCAxNDtcbnZhciBDJFByaW1hcnkgPSAxIDw8IDE1O1xudmFyIEMkU2hvcnRoYW5kUHJvcCA9IDEgPDwgMTY7XG52YXIgQyRUYWdnZWQgPSAxIDw8IDE3O1xuXG52YXIgQyRBbmNlc3RvciA9ICgxIDw8IDkpIC0gMTtcblxudmFyIFQkVG9rZW5NYXNrID0gKDEgPDwgNikgLSAxO1xuXG52YXIgVCRQcmVjU2hpZnQgPSA2O1xuXG52YXIgVCRQcmVjZWRlbmNlID0gNyA8PCBUJFByZWNTaGlmdDtcblxudmFyIFQkRXhwcmVzc2lvblRlcm1pbmFsID0gMSA8PCAxMTtcblxudmFyIFQkQ2xvc2luZ1Rva2VuID0gMSA8PCAxMjtcblxudmFyIFQkT3BlbmluZ1Rva2VuID0gMSA8PCAxMztcblxudmFyIFQkQWNjZXNzU2NvcGVUZXJtaW5hbCA9IDEgPDwgMTQ7XG52YXIgVCRLZXl3b3JkID0gMSA8PCAxNTtcbnZhciBUJEVPRiA9IDEgPDwgMTYgfCBUJEFjY2Vzc1Njb3BlVGVybWluYWwgfCBUJEV4cHJlc3Npb25UZXJtaW5hbDtcbnZhciBUJElkZW50aWZpZXIgPSAxIDw8IDE3O1xudmFyIFQkSWRlbnRpZmllck9yS2V5d29yZCA9IFQkSWRlbnRpZmllciB8IFQkS2V5d29yZDtcbnZhciBUJExpdGVyYWwgPSAxIDw8IDE4O1xudmFyIFQkTnVtZXJpY0xpdGVyYWwgPSAxIDw8IDE5IHwgVCRMaXRlcmFsO1xudmFyIFQkU3RyaW5nTGl0ZXJhbCA9IDEgPDwgMjAgfCBUJExpdGVyYWw7XG52YXIgVCRCaW5hcnlPcCA9IDEgPDwgMjE7XG5cbnZhciBUJFVuYXJ5T3AgPSAxIDw8IDIyO1xuXG52YXIgVCRNZW1iZXJFeHByZXNzaW9uID0gMSA8PCAyMztcblxudmFyIFQkTWVtYmVyT3JDYWxsRXhwcmVzc2lvbiA9IDEgPDwgMjQ7XG52YXIgVCRUZW1wbGF0ZVRhaWwgPSAxIDw8IDI1IHwgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uO1xudmFyIFQkVGVtcGxhdGVDb250aW51YXRpb24gPSAxIDw8IDI2IHwgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uO1xuXG52YXIgVCRGYWxzZUtleXdvcmQgPSAwIHwgVCRLZXl3b3JkIHwgVCRMaXRlcmFsO1xudmFyIFQkVHJ1ZUtleXdvcmQgPSAxIHwgVCRLZXl3b3JkIHwgVCRMaXRlcmFsO1xudmFyIFQkTnVsbEtleXdvcmQgPSAyIHwgVCRLZXl3b3JkIHwgVCRMaXRlcmFsO1xudmFyIFQkVW5kZWZpbmVkS2V5d29yZCA9IDMgfCBUJEtleXdvcmQgfCBUJExpdGVyYWw7XG52YXIgVCRUaGlzU2NvcGUgPSA0IHwgVCRJZGVudGlmaWVyT3JLZXl3b3JkO1xudmFyIFQkUGFyZW50U2NvcGUgPSA1IHwgVCRJZGVudGlmaWVyT3JLZXl3b3JkO1xuXG52YXIgVCRMUGFyZW4gPSA2IHwgVCRPcGVuaW5nVG9rZW4gfCBUJEFjY2Vzc1Njb3BlVGVybWluYWwgfCBUJE1lbWJlck9yQ2FsbEV4cHJlc3Npb247XG52YXIgVCRMQnJhY2UgPSA3IHwgVCRPcGVuaW5nVG9rZW47XG52YXIgVCRQZXJpb2QgPSA4IHwgVCRNZW1iZXJFeHByZXNzaW9uIHwgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uO1xudmFyIFQkUkJyYWNlID0gOSB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbCB8IFQkQ2xvc2luZ1Rva2VuIHwgVCRFeHByZXNzaW9uVGVybWluYWw7XG52YXIgVCRSUGFyZW4gPSAxMCB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbCB8IFQkQ2xvc2luZ1Rva2VuIHwgVCRFeHByZXNzaW9uVGVybWluYWw7XG52YXIgVCRDb21tYSA9IDExIHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsO1xudmFyIFQkTEJyYWNrZXQgPSAxMiB8IFQkT3BlbmluZ1Rva2VuIHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsIHwgVCRNZW1iZXJFeHByZXNzaW9uIHwgVCRNZW1iZXJPckNhbGxFeHByZXNzaW9uO1xudmFyIFQkUkJyYWNrZXQgPSAxMyB8IFQkQ2xvc2luZ1Rva2VuIHwgVCRFeHByZXNzaW9uVGVybWluYWw7XG52YXIgVCRDb2xvbiA9IDE0IHwgVCRBY2Nlc3NTY29wZVRlcm1pbmFsO1xudmFyIFQkUXVlc3Rpb24gPSAxNTtcblxudmFyIFQkQW1wZXJzYW5kID0gMTggfCBUJEFjY2Vzc1Njb3BlVGVybWluYWw7XG52YXIgVCRCYXIgPSAxOSB8IFQkQWNjZXNzU2NvcGVUZXJtaW5hbDtcbnZhciBUJEJhckJhciA9IDIwIHwgMSA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRBbXBlcnNhbmRBbXBlcnNhbmQgPSAyMSB8IDIgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkQ2FyZXQgPSAyMiB8IDMgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkRXFFcSA9IDIzIHwgNCA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRCYW5nRXEgPSAyNCB8IDQgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkRXFFcUVxID0gMjUgfCA0IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEJhbmdFcUVxID0gMjYgfCA0IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEx0ID0gMjcgfCA1IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEd0ID0gMjggfCA1IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEx0RXEgPSAyOSB8IDUgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wO1xudmFyIFQkR3RFcSA9IDMwIHwgNSA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRJbktleXdvcmQgPSAzMSB8IDUgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wIHwgVCRLZXl3b3JkO1xudmFyIFQkSW5zdGFuY2VPZktleXdvcmQgPSAzMiB8IDUgPDwgVCRQcmVjU2hpZnQgfCBUJEJpbmFyeU9wIHwgVCRLZXl3b3JkO1xudmFyIFQkUGx1cyA9IDMzIHwgNiA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3AgfCBUJFVuYXJ5T3A7XG52YXIgVCRNaW51cyA9IDM0IHwgNiA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3AgfCBUJFVuYXJ5T3A7XG52YXIgVCRUeXBlb2ZLZXl3b3JkID0gMzUgfCBUJFVuYXJ5T3AgfCBUJEtleXdvcmQ7XG52YXIgVCRWb2lkS2V5d29yZCA9IDM2IHwgVCRVbmFyeU9wIHwgVCRLZXl3b3JkO1xudmFyIFQkU3RhciA9IDM3IHwgNyA8PCBUJFByZWNTaGlmdCB8IFQkQmluYXJ5T3A7XG52YXIgVCRQZXJjZW50ID0gMzggfCA3IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJFNsYXNoID0gMzkgfCA3IDw8IFQkUHJlY1NoaWZ0IHwgVCRCaW5hcnlPcDtcbnZhciBUJEVxID0gNDA7XG52YXIgVCRCYW5nID0gNDEgfCBUJFVuYXJ5T3A7XG5cbnZhciBLZXl3b3JkTG9va3VwID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbktleXdvcmRMb29rdXAudHJ1ZSA9IFQkVHJ1ZUtleXdvcmQ7XG5LZXl3b3JkTG9va3VwLm51bGwgPSBUJE51bGxLZXl3b3JkO1xuS2V5d29yZExvb2t1cC5mYWxzZSA9IFQkRmFsc2VLZXl3b3JkO1xuS2V5d29yZExvb2t1cC51bmRlZmluZWQgPSBUJFVuZGVmaW5lZEtleXdvcmQ7XG5LZXl3b3JkTG9va3VwLiR0aGlzID0gVCRUaGlzU2NvcGU7XG5LZXl3b3JkTG9va3VwLiRwYXJlbnQgPSBUJFBhcmVudFNjb3BlO1xuS2V5d29yZExvb2t1cC5pbiA9IFQkSW5LZXl3b3JkO1xuS2V5d29yZExvb2t1cC5pbnN0YW5jZW9mID0gVCRJbnN0YW5jZU9mS2V5d29yZDtcbktleXdvcmRMb29rdXAudHlwZW9mID0gVCRUeXBlb2ZLZXl3b3JkO1xuS2V5d29yZExvb2t1cC52b2lkID0gVCRWb2lkS2V5d29yZDtcblxudmFyIFRva2VuVmFsdWVzID0gW2ZhbHNlLCB0cnVlLCBudWxsLCB1bmRlZmluZWQsICckdGhpcycsICckcGFyZW50JywgJygnLCAneycsICcuJywgJ30nLCAnKScsICcsJywgJ1snLCAnXScsICc6JywgJz8nLCAnXFwnJywgJ1wiJywgJyYnLCAnfCcsICd8fCcsICcmJicsICdeJywgJz09JywgJyE9JywgJz09PScsICchPT0nLCAnPCcsICc+JywgJzw9JywgJz49JywgJ2luJywgJ2luc3RhbmNlb2YnLCAnKycsICctJywgJ3R5cGVvZicsICd2b2lkJywgJyonLCAnJScsICcvJywgJz0nLCAnISddO1xuXG52YXIgY29kZXMgPSB7XG4gIEFzY2lpSWRQYXJ0OiBbMHgyNCwgMCwgMHgzMCwgMHgzQSwgMHg0MSwgMHg1QiwgMHg1RiwgMCwgMHg2MSwgMHg3Ql0sXG4gIElkU3RhcnQ6IFsweDI0LCAwLCAweDQxLCAweDVCLCAweDVGLCAwLCAweDYxLCAweDdCLCAweEFBLCAwLCAweEJBLCAwLCAweEMwLCAweEQ3LCAweEQ4LCAweEY3LCAweEY4LCAweDJCOSwgMHgyRTAsIDB4MkU1LCAweDFEMDAsIDB4MUQyNiwgMHgxRDJDLCAweDFENUQsIDB4MUQ2MiwgMHgxRDY2LCAweDFENkIsIDB4MUQ3OCwgMHgxRDc5LCAweDFEQkYsIDB4MUUwMCwgMHgxRjAwLCAweDIwNzEsIDAsIDB4MjA3RiwgMCwgMHgyMDkwLCAweDIwOUQsIDB4MjEyQSwgMHgyMTJDLCAweDIxMzIsIDAsIDB4MjE0RSwgMCwgMHgyMTYwLCAweDIxODksIDB4MkM2MCwgMHgyQzgwLCAweEE3MjIsIDB4QTc4OCwgMHhBNzhCLCAweEE3QUYsIDB4QTdCMCwgMHhBN0I4LCAweEE3RjcsIDB4QTgwMCwgMHhBQjMwLCAweEFCNUIsIDB4QUI1QywgMHhBQjY1LCAweEZCMDAsIDB4RkIwNywgMHhGRjIxLCAweEZGM0IsIDB4RkY0MSwgMHhGRjVCXSxcbiAgRGlnaXQ6IFsweDMwLCAweDNBXSxcbiAgU2tpcDogWzAsIDB4MjEsIDB4N0YsIDB4QTFdXG59O1xuXG5mdW5jdGlvbiBkZWNvbXByZXNzKGxvb2t1cCwgc2V0LCBjb21wcmVzc2VkLCB2YWx1ZSkge1xuICB2YXIgcmFuZ2VDb3VudCA9IGNvbXByZXNzZWQubGVuZ3RoO1xuICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlQ291bnQ7IGkgKz0gMikge1xuICAgIHZhciBzdGFydCA9IGNvbXByZXNzZWRbaV07XG4gICAgdmFyIGVuZCA9IGNvbXByZXNzZWRbaSArIDFdO1xuICAgIGVuZCA9IGVuZCA+IDAgPyBlbmQgOiBzdGFydCArIDE7XG4gICAgaWYgKGxvb2t1cCkge1xuICAgICAgdmFyIGogPSBzdGFydDtcbiAgICAgIHdoaWxlIChqIDwgZW5kKSB7XG4gICAgICAgIGxvb2t1cFtqXSA9IHZhbHVlO1xuICAgICAgICBqKys7XG4gICAgICB9XG4gICAgfVxuICAgIGlmIChzZXQpIHtcbiAgICAgIGZvciAodmFyIGNoID0gc3RhcnQ7IGNoIDwgZW5kOyBjaCsrKSB7XG4gICAgICAgIHNldC5hZGQoY2gpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiByZXR1cm5Ub2tlbih0b2tlbikge1xuICByZXR1cm4gZnVuY3Rpb24gKHApIHtcbiAgICBwLm5leHQoKTtcbiAgICByZXR1cm4gdG9rZW47XG4gIH07XG59XG5mdW5jdGlvbiB1bmV4cGVjdGVkQ2hhcmFjdGVyKHApIHtcbiAgcC5lcnIoJ1VuZXhwZWN0ZWQgY2hhcmFjdGVyIFsnICsgZnJvbUNoYXJDb2RlKHAuY2gpICsgJ10nKTtcbiAgcmV0dXJuIG51bGw7XG59XG5cbnZhciBBc2NpaUlkUGFydHMgPSBuZXcgU2V0KCk7XG5kZWNvbXByZXNzKG51bGwsIEFzY2lpSWRQYXJ0cywgY29kZXMuQXNjaWlJZFBhcnQsIHRydWUpO1xuXG52YXIgSWRQYXJ0cyA9IG5ldyBVaW50OEFycmF5KDB4RkZGRik7XG5kZWNvbXByZXNzKElkUGFydHMsIG51bGwsIGNvZGVzLklkU3RhcnQsIDEpO1xuZGVjb21wcmVzcyhJZFBhcnRzLCBudWxsLCBjb2Rlcy5EaWdpdCwgMSk7XG5cbnZhciBDaGFyU2Nhbm5lcnMgPSBuZXcgQXJyYXkoMHhGRkZGKTtcbnZhciBjaSA9IDA7XG53aGlsZSAoY2kgPCAweEZGRkYpIHtcbiAgQ2hhclNjYW5uZXJzW2NpXSA9IHVuZXhwZWN0ZWRDaGFyYWN0ZXI7XG4gIGNpKys7XG59XG5cbmRlY29tcHJlc3MoQ2hhclNjYW5uZXJzLCBudWxsLCBjb2Rlcy5Ta2lwLCBmdW5jdGlvbiAocCkge1xuICBwLm5leHQoKTtcbiAgcmV0dXJuIG51bGw7XG59KTtcbmRlY29tcHJlc3MoQ2hhclNjYW5uZXJzLCBudWxsLCBjb2Rlcy5JZFN0YXJ0LCBmdW5jdGlvbiAocCkge1xuICByZXR1cm4gcC5zY2FuSWRlbnRpZmllcigpO1xufSk7XG5kZWNvbXByZXNzKENoYXJTY2FubmVycywgbnVsbCwgY29kZXMuRGlnaXQsIGZ1bmN0aW9uIChwKSB7XG4gIHJldHVybiBwLnNjYW5OdW1iZXIoZmFsc2UpO1xufSk7XG5cbkNoYXJTY2FubmVyc1sweDIyXSA9IENoYXJTY2FubmVyc1sweDI3XSA9IGZ1bmN0aW9uIChwKSB7XG4gIHJldHVybiBwLnNjYW5TdHJpbmcoKTtcbn07XG5DaGFyU2Nhbm5lcnNbMHg2MF0gPSBmdW5jdGlvbiAocCkge1xuICByZXR1cm4gcC5zY2FuVGVtcGxhdGUoKTtcbn07XG5cbkNoYXJTY2FubmVyc1sweDIxXSA9IGZ1bmN0aW9uIChwKSB7XG4gIGlmIChwLm5leHQoKSAhPT0gMHgzRCkge1xuICAgIHJldHVybiBUJEJhbmc7XG4gIH1cbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkQmFuZ0VxO1xuICB9XG4gIHAubmV4dCgpO1xuICByZXR1cm4gVCRCYW5nRXFFcTtcbn07XG5cbkNoYXJTY2FubmVyc1sweDNEXSA9IGZ1bmN0aW9uIChwKSB7XG4gIGlmIChwLm5leHQoKSAhPT0gMHgzRCkge1xuICAgIHJldHVybiBUJEVxO1xuICB9XG4gIGlmIChwLm5leHQoKSAhPT0gMHgzRCkge1xuICAgIHJldHVybiBUJEVxRXE7XG4gIH1cbiAgcC5uZXh0KCk7XG4gIHJldHVybiBUJEVxRXFFcTtcbn07XG5cbkNoYXJTY2FubmVyc1sweDI2XSA9IGZ1bmN0aW9uIChwKSB7XG4gIGlmIChwLm5leHQoKSAhPT0gMHgyNikge1xuICAgIHJldHVybiBUJEFtcGVyc2FuZDtcbiAgfVxuICBwLm5leHQoKTtcbiAgcmV0dXJuIFQkQW1wZXJzYW5kQW1wZXJzYW5kO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4N0NdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDdDKSB7XG4gICAgcmV0dXJuIFQkQmFyO1xuICB9XG4gIHAubmV4dCgpO1xuICByZXR1cm4gVCRCYXJCYXI7XG59O1xuXG5DaGFyU2Nhbm5lcnNbMHgyRV0gPSBmdW5jdGlvbiAocCkge1xuICBpZiAocC5uZXh0KCkgPD0gMHgzOSAmJiBwLmNoID49IDB4MzApIHtcbiAgICByZXR1cm4gcC5zY2FuTnVtYmVyKHRydWUpO1xuICB9XG4gIHJldHVybiBUJFBlcmlvZDtcbn07XG5cbkNoYXJTY2FubmVyc1sweDNDXSA9IGZ1bmN0aW9uIChwKSB7XG4gIGlmIChwLm5leHQoKSAhPT0gMHgzRCkge1xuICAgIHJldHVybiBUJEx0O1xuICB9XG4gIHAubmV4dCgpO1xuICByZXR1cm4gVCRMdEVxO1xufTtcblxuQ2hhclNjYW5uZXJzWzB4M0VdID0gZnVuY3Rpb24gKHApIHtcbiAgaWYgKHAubmV4dCgpICE9PSAweDNEKSB7XG4gICAgcmV0dXJuIFQkR3Q7XG4gIH1cbiAgcC5uZXh0KCk7XG4gIHJldHVybiBUJEd0RXE7XG59O1xuXG5DaGFyU2Nhbm5lcnNbMHgyNV0gPSByZXR1cm5Ub2tlbihUJFBlcmNlbnQpO1xuQ2hhclNjYW5uZXJzWzB4MjhdID0gcmV0dXJuVG9rZW4oVCRMUGFyZW4pO1xuQ2hhclNjYW5uZXJzWzB4MjldID0gcmV0dXJuVG9rZW4oVCRSUGFyZW4pO1xuQ2hhclNjYW5uZXJzWzB4MkFdID0gcmV0dXJuVG9rZW4oVCRTdGFyKTtcbkNoYXJTY2FubmVyc1sweDJCXSA9IHJldHVyblRva2VuKFQkUGx1cyk7XG5DaGFyU2Nhbm5lcnNbMHgyQ10gPSByZXR1cm5Ub2tlbihUJENvbW1hKTtcbkNoYXJTY2FubmVyc1sweDJEXSA9IHJldHVyblRva2VuKFQkTWludXMpO1xuQ2hhclNjYW5uZXJzWzB4MkZdID0gcmV0dXJuVG9rZW4oVCRTbGFzaCk7XG5DaGFyU2Nhbm5lcnNbMHgzQV0gPSByZXR1cm5Ub2tlbihUJENvbG9uKTtcbkNoYXJTY2FubmVyc1sweDNGXSA9IHJldHVyblRva2VuKFQkUXVlc3Rpb24pO1xuQ2hhclNjYW5uZXJzWzB4NUJdID0gcmV0dXJuVG9rZW4oVCRMQnJhY2tldCk7XG5DaGFyU2Nhbm5lcnNbMHg1RF0gPSByZXR1cm5Ub2tlbihUJFJCcmFja2V0KTtcbkNoYXJTY2FubmVyc1sweDVFXSA9IHJldHVyblRva2VuKFQkQ2FyZXQpO1xuQ2hhclNjYW5uZXJzWzB4N0JdID0gcmV0dXJuVG9rZW4oVCRMQnJhY2UpO1xuQ2hhclNjYW5uZXJzWzB4N0RdID0gcmV0dXJuVG9rZW4oVCRSQnJhY2UpO1xuXG52YXIgbWFwUHJvdG8gPSBNYXAucHJvdG90eXBlO1xuXG5mdW5jdGlvbiBfZ2V0TWFwT2JzZXJ2ZXIodGFza1F1ZXVlLCBtYXApIHtcbiAgcmV0dXJuIE1vZGlmeU1hcE9ic2VydmVyLmZvcih0YXNrUXVldWUsIG1hcCk7XG59XG5cbnZhciBNb2RpZnlNYXBPYnNlcnZlciA9IGZ1bmN0aW9uIChfTW9kaWZ5Q29sbGVjdGlvbk9ic2UyKSB7XG4gIF9pbmhlcml0cyhNb2RpZnlNYXBPYnNlcnZlciwgX01vZGlmeUNvbGxlY3Rpb25PYnNlMik7XG5cbiAgZnVuY3Rpb24gTW9kaWZ5TWFwT2JzZXJ2ZXIodGFza1F1ZXVlLCBtYXApIHtcbiAgICBcblxuICAgIHJldHVybiBfcG9zc2libGVDb25zdHJ1Y3RvclJldHVybih0aGlzLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UyLmNhbGwodGhpcywgdGFza1F1ZXVlLCBtYXApKTtcbiAgfVxuXG4gIE1vZGlmeU1hcE9ic2VydmVyLmZvciA9IGZ1bmN0aW9uIF9mb3IodGFza1F1ZXVlLCBtYXApIHtcbiAgICBpZiAoISgnX19tYXBfb2JzZXJ2ZXJfXycgaW4gbWFwKSkge1xuICAgICAgUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eShtYXAsICdfX21hcF9vYnNlcnZlcl9fJywge1xuICAgICAgICB2YWx1ZTogTW9kaWZ5TWFwT2JzZXJ2ZXIuY3JlYXRlKHRhc2tRdWV1ZSwgbWFwKSxcbiAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsIGNvbmZpZ3VyYWJsZTogZmFsc2VcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWFwLl9fbWFwX29ic2VydmVyX187XG4gIH07XG5cbiAgTW9kaWZ5TWFwT2JzZXJ2ZXIuY3JlYXRlID0gZnVuY3Rpb24gY3JlYXRlKHRhc2tRdWV1ZSwgbWFwKSB7XG4gICAgdmFyIG9ic2VydmVyID0gbmV3IE1vZGlmeU1hcE9ic2VydmVyKHRhc2tRdWV1ZSwgbWFwKTtcblxuICAgIHZhciBwcm90byA9IG1hcFByb3RvO1xuICAgIGlmIChwcm90by5zZXQgIT09IG1hcC5zZXQgfHwgcHJvdG8uZGVsZXRlICE9PSBtYXAuZGVsZXRlIHx8IHByb3RvLmNsZWFyICE9PSBtYXAuY2xlYXIpIHtcbiAgICAgIHByb3RvID0ge1xuICAgICAgICBzZXQ6IG1hcC5zZXQsXG4gICAgICAgIGRlbGV0ZTogbWFwLmRlbGV0ZSxcbiAgICAgICAgY2xlYXI6IG1hcC5jbGVhclxuICAgICAgfTtcbiAgICB9XG5cbiAgICBtYXAuc2V0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGhhc1ZhbHVlID0gbWFwLmhhcyhhcmd1bWVudHNbMF0pO1xuICAgICAgdmFyIHR5cGUgPSBoYXNWYWx1ZSA/ICd1cGRhdGUnIDogJ2FkZCc7XG4gICAgICB2YXIgb2xkVmFsdWUgPSBtYXAuZ2V0KGFyZ3VtZW50c1swXSk7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLnNldC5hcHBseShtYXAsIGFyZ3VtZW50cyk7XG4gICAgICBpZiAoIWhhc1ZhbHVlIHx8IG9sZFZhbHVlICE9PSBtYXAuZ2V0KGFyZ3VtZW50c1swXSkpIHtcbiAgICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgICB0eXBlOiB0eXBlLFxuICAgICAgICAgIG9iamVjdDogbWFwLFxuICAgICAgICAgIGtleTogYXJndW1lbnRzWzBdLFxuICAgICAgICAgIG9sZFZhbHVlOiBvbGRWYWx1ZVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICBtYXAuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGhhc1ZhbHVlID0gbWFwLmhhcyhhcmd1bWVudHNbMF0pO1xuICAgICAgdmFyIG9sZFZhbHVlID0gbWFwLmdldChhcmd1bWVudHNbMF0pO1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5kZWxldGUuYXBwbHkobWFwLCBhcmd1bWVudHMpO1xuICAgICAgaWYgKGhhc1ZhbHVlKSB7XG4gICAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgICAgdHlwZTogJ2RlbGV0ZScsXG4gICAgICAgICAgb2JqZWN0OiBtYXAsXG4gICAgICAgICAga2V5OiBhcmd1bWVudHNbMF0sXG4gICAgICAgICAgb2xkVmFsdWU6IG9sZFZhbHVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIG1hcC5jbGVhciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uY2xlYXIuYXBwbHkobWFwLCBhcmd1bWVudHMpO1xuICAgICAgb2JzZXJ2ZXIuYWRkQ2hhbmdlUmVjb3JkKHtcbiAgICAgICAgdHlwZTogJ2NsZWFyJyxcbiAgICAgICAgb2JqZWN0OiBtYXBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG1ldGhvZENhbGxSZXN1bHQ7XG4gICAgfTtcblxuICAgIHJldHVybiBvYnNlcnZlcjtcbiAgfTtcblxuICByZXR1cm4gTW9kaWZ5TWFwT2JzZXJ2ZXI7XG59KE1vZGlmeUNvbGxlY3Rpb25PYnNlcnZlcik7XG5cbnZhciBlbUxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdldmVudC1tYW5hZ2VyJyk7XG5cbmZ1bmN0aW9uIGZpbmRPcmlnaW5hbEV2ZW50VGFyZ2V0KGV2ZW50KSB7XG4gIHJldHVybiBldmVudC5jb21wb3NlZFBhdGggJiYgZXZlbnQuY29tcG9zZWRQYXRoKClbMF0gfHwgZXZlbnQuZGVlcFBhdGggJiYgZXZlbnQuZGVlcFBhdGgoKVswXSB8fCBldmVudC5wYXRoICYmIGV2ZW50LnBhdGhbMF0gfHwgZXZlbnQudGFyZ2V0O1xufVxuXG5mdW5jdGlvbiBzdG9wUHJvcGFnYXRpb24oKSB7XG4gIHRoaXMuc3RhbmRhcmRTdG9wUHJvcGFnYXRpb24oKTtcbiAgdGhpcy5wcm9wYWdhdGlvblN0b3BwZWQgPSB0cnVlO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVDYXB0dXJlZEV2ZW50KGV2ZW50KSB7XG4gIGV2ZW50LnByb3BhZ2F0aW9uU3RvcHBlZCA9IGZhbHNlO1xuICB2YXIgdGFyZ2V0ID0gZmluZE9yaWdpbmFsRXZlbnRUYXJnZXQoZXZlbnQpO1xuXG4gIHZhciBvcmRlcmVkQ2FsbGJhY2tzID0gW107XG5cbiAgd2hpbGUgKHRhcmdldCkge1xuICAgIGlmICh0YXJnZXQuY2FwdHVyZWRDYWxsYmFja3MpIHtcbiAgICAgIHZhciBjYWxsYmFjayA9IHRhcmdldC5jYXB0dXJlZENhbGxiYWNrc1tldmVudC50eXBlXTtcbiAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uICE9PSBzdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICBldmVudC5zdGFuZGFyZFN0b3BQcm9wYWdhdGlvbiA9IGV2ZW50LnN0b3BQcm9wYWdhdGlvbjtcbiAgICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24gPSBzdG9wUHJvcGFnYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgb3JkZXJlZENhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGFyZ2V0ID0gdGFyZ2V0LnBhcmVudE5vZGU7XG4gIH1cbiAgZm9yICh2YXIgaSA9IG9yZGVyZWRDYWxsYmFja3MubGVuZ3RoIC0gMTsgaSA+PSAwICYmICFldmVudC5wcm9wYWdhdGlvblN0b3BwZWQ7IGktLSkge1xuICAgIHZhciBvcmRlcmVkQ2FsbGJhY2sgPSBvcmRlcmVkQ2FsbGJhY2tzW2ldO1xuICAgIGlmICgnaGFuZGxlRXZlbnQnIGluIG9yZGVyZWRDYWxsYmFjaykge1xuICAgICAgb3JkZXJlZENhbGxiYWNrLmhhbmRsZUV2ZW50KGV2ZW50KTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3JkZXJlZENhbGxiYWNrKGV2ZW50KTtcbiAgICB9XG4gIH1cbn1cblxudmFyIENhcHR1cmVkSGFuZGxlckVudHJ5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDYXB0dXJlZEhhbmRsZXJFbnRyeShldmVudE5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICB9XG5cbiAgQ2FwdHVyZWRIYW5kbGVyRW50cnkucHJvdG90eXBlLmluY3JlbWVudCA9IGZ1bmN0aW9uIGluY3JlbWVudCgpIHtcbiAgICB0aGlzLmNvdW50Kys7XG5cbiAgICBpZiAodGhpcy5jb3VudCA9PT0gMSkge1xuICAgICAgRE9NLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIGhhbmRsZUNhcHR1cmVkRXZlbnQsIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICBDYXB0dXJlZEhhbmRsZXJFbnRyeS5wcm90b3R5cGUuZGVjcmVtZW50ID0gZnVuY3Rpb24gZGVjcmVtZW50KCkge1xuICAgIGlmICh0aGlzLmNvdW50ID09PSAwKSB7XG4gICAgICBlbUxvZ2dlci53YXJuKCdUaGUgc2FtZSBFdmVudExpc3RlbmVyIHdhcyBkaXNwb3NlZCBtdWx0aXBsZSB0aW1lcy4nKTtcbiAgICB9IGVsc2UgaWYgKC0tdGhpcy5jb3VudCA9PT0gMCkge1xuICAgICAgRE9NLnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy5ldmVudE5hbWUsIGhhbmRsZUNhcHR1cmVkRXZlbnQsIHRydWUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ2FwdHVyZWRIYW5kbGVyRW50cnk7XG59KCk7XG5cbnZhciBEZWxlZ2F0ZUhhbmRsZXJFbnRyeSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRGVsZWdhdGVIYW5kbGVyRW50cnkoZXZlbnROYW1lLCBldmVudE1hbmFnZXIpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnROYW1lID0gZXZlbnROYW1lO1xuICAgIHRoaXMuY291bnQgPSAwO1xuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICB9XG5cbiAgRGVsZWdhdGVIYW5kbGVyRW50cnkucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoZXZlbnQpIHtcbiAgICBldmVudC5wcm9wYWdhdGlvblN0b3BwZWQgPSBmYWxzZTtcbiAgICB2YXIgdGFyZ2V0ID0gZmluZE9yaWdpbmFsRXZlbnRUYXJnZXQoZXZlbnQpO1xuXG4gICAgd2hpbGUgKHRhcmdldCAmJiAhZXZlbnQucHJvcGFnYXRpb25TdG9wcGVkKSB7XG4gICAgICBpZiAodGFyZ2V0LmRlbGVnYXRlZENhbGxiYWNrcykge1xuICAgICAgICB2YXIgY2FsbGJhY2sgPSB0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzW2V2ZW50LnR5cGVdO1xuICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uICE9PSBzdG9wUHJvcGFnYXRpb24pIHtcbiAgICAgICAgICAgIGV2ZW50LnN0YW5kYXJkU3RvcFByb3BhZ2F0aW9uID0gZXZlbnQuc3RvcFByb3BhZ2F0aW9uO1xuICAgICAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uID0gc3RvcFByb3BhZ2F0aW9uO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoJ2hhbmRsZUV2ZW50JyBpbiBjYWxsYmFjaykge1xuICAgICAgICAgICAgY2FsbGJhY2suaGFuZGxlRXZlbnQoZXZlbnQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYWxsYmFjayhldmVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHZhciBwYXJlbnQgPSB0YXJnZXQucGFyZW50Tm9kZTtcbiAgICAgIHZhciBzaG91bGRFc2NhcGVTaGFkb3dSb290ID0gdGhpcy5ldmVudE1hbmFnZXIuZXNjYXBlU2hhZG93Um9vdCAmJiBwYXJlbnQgaW5zdGFuY2VvZiBTaGFkb3dSb290O1xuXG4gICAgICB0YXJnZXQgPSBzaG91bGRFc2NhcGVTaGFkb3dSb290ID8gcGFyZW50Lmhvc3QgOiBwYXJlbnQ7XG4gICAgfVxuICB9O1xuXG4gIERlbGVnYXRlSGFuZGxlckVudHJ5LnByb3RvdHlwZS5pbmNyZW1lbnQgPSBmdW5jdGlvbiBpbmNyZW1lbnQoKSB7XG4gICAgdGhpcy5jb3VudCsrO1xuXG4gICAgaWYgKHRoaXMuY291bnQgPT09IDEpIHtcbiAgICAgIERPTS5hZGRFdmVudExpc3RlbmVyKHRoaXMuZXZlbnROYW1lLCB0aGlzLCBmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIERlbGVnYXRlSGFuZGxlckVudHJ5LnByb3RvdHlwZS5kZWNyZW1lbnQgPSBmdW5jdGlvbiBkZWNyZW1lbnQoKSB7XG4gICAgaWYgKHRoaXMuY291bnQgPT09IDApIHtcbiAgICAgIGVtTG9nZ2VyLndhcm4oJ1RoZSBzYW1lIEV2ZW50TGlzdGVuZXIgd2FzIGRpc3Bvc2VkIG11bHRpcGxlIHRpbWVzLicpO1xuICAgIH0gZWxzZSBpZiAoLS10aGlzLmNvdW50ID09PSAwKSB7XG4gICAgICBET00ucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLmV2ZW50TmFtZSwgdGhpcywgZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gRGVsZWdhdGVIYW5kbGVyRW50cnk7XG59KCk7XG5cbnZhciBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyKGVudHJ5LCBsb29rdXAsIHRhcmdldEV2ZW50KSB7XG4gICAgXG5cbiAgICB0aGlzLmVudHJ5ID0gZW50cnk7XG4gICAgdGhpcy5sb29rdXAgPSBsb29rdXA7XG4gICAgdGhpcy50YXJnZXRFdmVudCA9IHRhcmdldEV2ZW50O1xuICB9XG5cbiAgRGVsZWdhdGlvbkVudHJ5SGFuZGxlci5wcm90b3R5cGUuZGlzcG9zZSA9IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgaWYgKHRoaXMubG9va3VwW3RoaXMudGFyZ2V0RXZlbnRdKSB7XG4gICAgICB0aGlzLmVudHJ5LmRlY3JlbWVudCgpO1xuICAgICAgdGhpcy5sb29rdXBbdGhpcy50YXJnZXRFdmVudF0gPSBudWxsO1xuICAgIH0gZWxzZSB7XG4gICAgICBlbUxvZ2dlci53YXJuKCdDYWxsaW5nIC5kaXNwb3NlKCkgb24gYWxyZWFkeSBkaXNwb3NlZCBldmVudExpc3RlbmVyJyk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyO1xufSgpO1xuXG52YXIgRXZlbnRIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFdmVudEhhbmRsZXIodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2spIHtcbiAgICBcblxuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMudGFyZ2V0RXZlbnQgPSB0YXJnZXRFdmVudDtcbiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gIH1cblxuICBFdmVudEhhbmRsZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIHRoaXMudGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodGhpcy50YXJnZXRFdmVudCwgdGhpcy5jYWxsYmFjayk7XG4gIH07XG5cbiAgcmV0dXJuIEV2ZW50SGFuZGxlcjtcbn0oKTtcblxudmFyIERlZmF1bHRFdmVudFN0cmF0ZWd5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBEZWZhdWx0RXZlbnRTdHJhdGVneShldmVudE1hbmFnZXIpIHtcbiAgICBcblxuICAgIHRoaXMuZGVsZWdhdGVkSGFuZGxlcnMgPSB7fTtcbiAgICB0aGlzLmNhcHR1cmVkSGFuZGxlcnMgPSB7fTtcblxuICAgIHRoaXMuZXZlbnRNYW5hZ2VyID0gZXZlbnRNYW5hZ2VyO1xuICB9XG5cbiAgRGVmYXVsdEV2ZW50U3RyYXRlZ3kucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZSh0YXJnZXQsIHRhcmdldEV2ZW50LCBjYWxsYmFjaywgc3RyYXRlZ3ksIGRpc3Bvc2FibGUpIHtcbiAgICB2YXIgZGVsZWdhdGVkSGFuZGxlcnMgPSB2b2lkIDA7XG4gICAgdmFyIGNhcHR1cmVkSGFuZGxlcnMgPSB2b2lkIDA7XG4gICAgdmFyIGhhbmRsZXJFbnRyeSA9IHZvaWQgMDtcblxuICAgIGlmIChzdHJhdGVneSA9PT0gZGVsZWdhdGlvblN0cmF0ZWd5LmJ1YmJsaW5nKSB7XG4gICAgICBkZWxlZ2F0ZWRIYW5kbGVycyA9IHRoaXMuZGVsZWdhdGVkSGFuZGxlcnM7XG4gICAgICBoYW5kbGVyRW50cnkgPSBkZWxlZ2F0ZWRIYW5kbGVyc1t0YXJnZXRFdmVudF0gfHwgKGRlbGVnYXRlZEhhbmRsZXJzW3RhcmdldEV2ZW50XSA9IG5ldyBEZWxlZ2F0ZUhhbmRsZXJFbnRyeSh0YXJnZXRFdmVudCwgdGhpcy5ldmVudE1hbmFnZXIpKTtcbiAgICAgIHZhciBkZWxlZ2F0ZWRDYWxsYmFja3MgPSB0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzIHx8ICh0YXJnZXQuZGVsZWdhdGVkQ2FsbGJhY2tzID0ge30pO1xuICAgICAgaWYgKCFkZWxlZ2F0ZWRDYWxsYmFja3NbdGFyZ2V0RXZlbnRdKSB7XG4gICAgICAgIGhhbmRsZXJFbnRyeS5pbmNyZW1lbnQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVtTG9nZ2VyLndhcm4oJ092ZXJyaWRpbmcgcHJldmlvdXMgY2FsbGJhY2sgZm9yIGV2ZW50IGxpc3RlbmVyJywgeyBldmVudDogdGFyZ2V0RXZlbnQsIGNhbGxiYWNrOiBjYWxsYmFjaywgcHJldmlvdXNDYWxsYmFjazogZGVsZWdhdGVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSB9KTtcbiAgICAgIH1cbiAgICAgIGRlbGVnYXRlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0gPSBjYWxsYmFjaztcblxuICAgICAgaWYgKGRpc3Bvc2FibGUgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyKGhhbmRsZXJFbnRyeSwgZGVsZWdhdGVkQ2FsbGJhY2tzLCB0YXJnZXRFdmVudCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGhhbmRsZXJFbnRyeS5kZWNyZW1lbnQoKTtcbiAgICAgICAgZGVsZWdhdGVkQ2FsbGJhY2tzW3RhcmdldEV2ZW50XSA9IG51bGw7XG4gICAgICB9O1xuICAgIH1cbiAgICBpZiAoc3RyYXRlZ3kgPT09IGRlbGVnYXRpb25TdHJhdGVneS5jYXB0dXJpbmcpIHtcbiAgICAgIGNhcHR1cmVkSGFuZGxlcnMgPSB0aGlzLmNhcHR1cmVkSGFuZGxlcnM7XG4gICAgICBoYW5kbGVyRW50cnkgPSBjYXB0dXJlZEhhbmRsZXJzW3RhcmdldEV2ZW50XSB8fCAoY2FwdHVyZWRIYW5kbGVyc1t0YXJnZXRFdmVudF0gPSBuZXcgQ2FwdHVyZWRIYW5kbGVyRW50cnkodGFyZ2V0RXZlbnQpKTtcbiAgICAgIHZhciBjYXB0dXJlZENhbGxiYWNrcyA9IHRhcmdldC5jYXB0dXJlZENhbGxiYWNrcyB8fCAodGFyZ2V0LmNhcHR1cmVkQ2FsbGJhY2tzID0ge30pO1xuICAgICAgaWYgKCFjYXB0dXJlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0pIHtcbiAgICAgICAgaGFuZGxlckVudHJ5LmluY3JlbWVudCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZW1Mb2dnZXIuZXJyb3IoJ2FscmVhZHkgaGF2ZSBhIGNhbGxiYWNrIGZvciBldmVudCcsIHsgZXZlbnQ6IHRhcmdldEV2ZW50LCBjYWxsYmFjazogY2FsbGJhY2sgfSk7XG4gICAgICB9XG4gICAgICBjYXB0dXJlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0gPSBjYWxsYmFjaztcblxuICAgICAgaWYgKGRpc3Bvc2FibGUgPT09IHRydWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEZWxlZ2F0aW9uRW50cnlIYW5kbGVyKGhhbmRsZXJFbnRyeSwgY2FwdHVyZWRDYWxsYmFja3MsIHRhcmdldEV2ZW50KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaGFuZGxlckVudHJ5LmRlY3JlbWVudCgpO1xuICAgICAgICBjYXB0dXJlZENhbGxiYWNrc1t0YXJnZXRFdmVudF0gPSBudWxsO1xuICAgICAgfTtcbiAgICB9XG5cbiAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0YXJnZXRFdmVudCwgY2FsbGJhY2spO1xuXG4gICAgaWYgKGRpc3Bvc2FibGUgPT09IHRydWUpIHtcbiAgICAgIHJldHVybiBuZXcgRXZlbnRIYW5kbGVyKHRhcmdldCwgdGFyZ2V0RXZlbnQsIGNhbGxiYWNrKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgdGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodGFyZ2V0RXZlbnQsIGNhbGxiYWNrKTtcbiAgICB9O1xuICB9O1xuXG4gIHJldHVybiBEZWZhdWx0RXZlbnRTdHJhdGVneTtcbn0oKTtcblxuZXhwb3J0IHZhciBkZWxlZ2F0aW9uU3RyYXRlZ3kgPSB7XG4gIG5vbmU6IDAsXG4gIGNhcHR1cmluZzogMSxcbiAgYnViYmxpbmc6IDJcbn07XG5cbmV4cG9ydCB2YXIgRXZlbnRNYW5hZ2VyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBFdmVudE1hbmFnZXIoKSB7XG4gICAgdmFyIGVzY2FwZVNoYWRvd1Jvb3QgPSBhcmd1bWVudHMubGVuZ3RoID4gMCAmJiBhcmd1bWVudHNbMF0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1swXSA6IGZhbHNlO1xuXG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnRIYW5kbGVyTG9va3VwID0ge307XG4gICAgdGhpcy5ldmVudFN0cmF0ZWd5TG9va3VwID0ge307XG4gICAgdGhpcy5lc2NhcGVTaGFkb3dSb290ID0gZXNjYXBlU2hhZG93Um9vdDtcblxuICAgIHRoaXMucmVnaXN0ZXJFbGVtZW50Q29uZmlnKHtcbiAgICAgIHRhZ05hbWU6ICdpbnB1dCcsXG4gICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHZhbHVlOiBbJ2NoYW5nZScsICdpbnB1dCddLFxuICAgICAgICBjaGVja2VkOiBbJ2NoYW5nZScsICdpbnB1dCddLFxuICAgICAgICBmaWxlczogWydjaGFuZ2UnLCAnaW5wdXQnXVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ3RleHRhcmVhJyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgdmFsdWU6IFsnY2hhbmdlJywgJ2lucHV0J11cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMucmVnaXN0ZXJFbGVtZW50Q29uZmlnKHtcbiAgICAgIHRhZ05hbWU6ICdzZWxlY3QnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB2YWx1ZTogWydjaGFuZ2UnXVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGhpcy5yZWdpc3RlckVsZW1lbnRDb25maWcoe1xuICAgICAgdGFnTmFtZTogJ2NvbnRlbnQgZWRpdGFibGUnLFxuICAgICAgcHJvcGVydGllczoge1xuICAgICAgICB2YWx1ZTogWydjaGFuZ2UnLCAnaW5wdXQnLCAnYmx1cicsICdrZXl1cCcsICdwYXN0ZSddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyRWxlbWVudENvbmZpZyh7XG4gICAgICB0YWdOYW1lOiAnc2Nyb2xsYWJsZSBlbGVtZW50JyxcbiAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc2Nyb2xsVG9wOiBbJ3Njcm9sbCddLFxuICAgICAgICBzY3JvbGxMZWZ0OiBbJ3Njcm9sbCddXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLmRlZmF1bHRFdmVudFN0cmF0ZWd5ID0gbmV3IERlZmF1bHRFdmVudFN0cmF0ZWd5KHRoaXMpO1xuICB9XG5cbiAgRXZlbnRNYW5hZ2VyLnByb3RvdHlwZS5yZWdpc3RlckVsZW1lbnRDb25maWcgPSBmdW5jdGlvbiByZWdpc3RlckVsZW1lbnRDb25maWcoY29uZmlnKSB7XG4gICAgdmFyIHRhZ05hbWUgPSBjb25maWcudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgIHZhciBwcm9wZXJ0aWVzID0gY29uZmlnLnByb3BlcnRpZXM7XG4gICAgdmFyIHByb3BlcnR5TmFtZSA9IHZvaWQgMDtcblxuICAgIHZhciBsb29rdXAgPSB0aGlzLmVsZW1lbnRIYW5kbGVyTG9va3VwW3RhZ05hbWVdID0ge307XG5cbiAgICBmb3IgKHByb3BlcnR5TmFtZSBpbiBwcm9wZXJ0aWVzKSB7XG4gICAgICBpZiAocHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eShwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgIGxvb2t1cFtwcm9wZXJ0eU5hbWVdID0gcHJvcGVydGllc1twcm9wZXJ0eU5hbWVdO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBFdmVudE1hbmFnZXIucHJvdG90eXBlLnJlZ2lzdGVyRXZlbnRTdHJhdGVneSA9IGZ1bmN0aW9uIHJlZ2lzdGVyRXZlbnRTdHJhdGVneShldmVudE5hbWUsIHN0cmF0ZWd5KSB7XG4gICAgdGhpcy5ldmVudFN0cmF0ZWd5TG9va3VwW2V2ZW50TmFtZV0gPSBzdHJhdGVneTtcbiAgfTtcblxuICBFdmVudE1hbmFnZXIucHJvdG90eXBlLmdldEVsZW1lbnRIYW5kbGVyID0gZnVuY3Rpb24gZ2V0RWxlbWVudEhhbmRsZXIodGFyZ2V0LCBwcm9wZXJ0eU5hbWUpIHtcbiAgICB2YXIgdGFnTmFtZSA9IHZvaWQgMDtcbiAgICB2YXIgbG9va3VwID0gdGhpcy5lbGVtZW50SGFuZGxlckxvb2t1cDtcblxuICAgIGlmICh0YXJnZXQudGFnTmFtZSkge1xuICAgICAgdGFnTmFtZSA9IHRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIGlmIChsb29rdXBbdGFnTmFtZV0gJiYgbG9va3VwW3RhZ05hbWVdW3Byb3BlcnR5TmFtZV0pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFdmVudFN1YnNjcmliZXIobG9va3VwW3RhZ05hbWVdW3Byb3BlcnR5TmFtZV0pO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAndGV4dENvbnRlbnQnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ2lubmVySFRNTCcpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBFdmVudFN1YnNjcmliZXIobG9va3VwWydjb250ZW50IGVkaXRhYmxlJ10udmFsdWUpO1xuICAgICAgfVxuXG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnc2Nyb2xsVG9wJyB8fCBwcm9wZXJ0eU5hbWUgPT09ICdzY3JvbGxMZWZ0Jykge1xuICAgICAgICByZXR1cm4gbmV3IEV2ZW50U3Vic2NyaWJlcihsb29rdXBbJ3Njcm9sbGFibGUgZWxlbWVudCddW3Byb3BlcnR5TmFtZV0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBudWxsO1xuICB9O1xuXG4gIEV2ZW50TWFuYWdlci5wcm90b3R5cGUuYWRkRXZlbnRMaXN0ZW5lciA9IGZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2tPckxpc3RlbmVyLCBkZWxlZ2F0ZSwgZGlzcG9zYWJsZSkge1xuICAgIHJldHVybiAodGhpcy5ldmVudFN0cmF0ZWd5TG9va3VwW3RhcmdldEV2ZW50XSB8fCB0aGlzLmRlZmF1bHRFdmVudFN0cmF0ZWd5KS5zdWJzY3JpYmUodGFyZ2V0LCB0YXJnZXRFdmVudCwgY2FsbGJhY2tPckxpc3RlbmVyLCBkZWxlZ2F0ZSwgZGlzcG9zYWJsZSk7XG4gIH07XG5cbiAgcmV0dXJuIEV2ZW50TWFuYWdlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBFdmVudFN1YnNjcmliZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50U3Vic2NyaWJlcihldmVudHMpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRzID0gZXZlbnRzO1xuICAgIHRoaXMuZWxlbWVudCA9IG51bGw7XG4gICAgdGhpcy5oYW5kbGVyID0gbnVsbDtcbiAgfVxuXG4gIEV2ZW50U3Vic2NyaWJlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGVsZW1lbnQsIGNhbGxiYWNrT3JMaXN0ZW5lcikge1xuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5oYW5kbGVyID0gY2FsbGJhY2tPckxpc3RlbmVyO1xuXG4gICAgdmFyIGV2ZW50cyA9IHRoaXMuZXZlbnRzO1xuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGV2ZW50cy5sZW5ndGg7IGlpID4gaTsgKytpKSB7XG4gICAgICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoZXZlbnRzW2ldLCBjYWxsYmFja09yTGlzdGVuZXIpO1xuICAgIH1cbiAgfTtcblxuICBFdmVudFN1YnNjcmliZXIucHJvdG90eXBlLmRpc3Bvc2UgPSBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgIGlmICh0aGlzLmVsZW1lbnQgPT09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XG4gICAgdmFyIGNhbGxiYWNrT3JMaXN0ZW5lciA9IHRoaXMuaGFuZGxlcjtcbiAgICB2YXIgZXZlbnRzID0gdGhpcy5ldmVudHM7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gZXZlbnRzLmxlbmd0aDsgaWkgPiBpOyArK2kpIHtcbiAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudHNbaV0sIGNhbGxiYWNrT3JMaXN0ZW5lcik7XG4gICAgfVxuICAgIHRoaXMuZWxlbWVudCA9IHRoaXMuaGFuZGxlciA9IG51bGw7XG4gIH07XG5cbiAgcmV0dXJuIEV2ZW50U3Vic2NyaWJlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBEaXJ0eUNoZWNrZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIERpcnR5Q2hlY2tlcigpIHtcbiAgICBcblxuICAgIHRoaXMudHJhY2tlZCA9IFtdO1xuICAgIHRoaXMuY2hlY2tEZWxheSA9IDEyMDtcbiAgfVxuXG4gIERpcnR5Q2hlY2tlci5wcm90b3R5cGUuYWRkUHJvcGVydHkgPSBmdW5jdGlvbiBhZGRQcm9wZXJ0eShwcm9wZXJ0eSkge1xuICAgIHZhciB0cmFja2VkID0gdGhpcy50cmFja2VkO1xuXG4gICAgdHJhY2tlZC5wdXNoKHByb3BlcnR5KTtcblxuICAgIGlmICh0cmFja2VkLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdGhpcy5zY2hlZHVsZURpcnR5Q2hlY2soKTtcbiAgICB9XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5yZW1vdmVQcm9wZXJ0eSA9IGZ1bmN0aW9uIHJlbW92ZVByb3BlcnR5KHByb3BlcnR5KSB7XG4gICAgdmFyIHRyYWNrZWQgPSB0aGlzLnRyYWNrZWQ7XG4gICAgdHJhY2tlZC5zcGxpY2UodHJhY2tlZC5pbmRleE9mKHByb3BlcnR5KSwgMSk7XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5zY2hlZHVsZURpcnR5Q2hlY2sgPSBmdW5jdGlvbiBzY2hlZHVsZURpcnR5Q2hlY2soKSB7XG4gICAgdmFyIF90aGlzMjIgPSB0aGlzO1xuXG4gICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gX3RoaXMyMi5jaGVjaygpO1xuICAgIH0sIHRoaXMuY2hlY2tEZWxheSk7XG4gIH07XG5cbiAgRGlydHlDaGVja2VyLnByb3RvdHlwZS5jaGVjayA9IGZ1bmN0aW9uIGNoZWNrKCkge1xuICAgIHZhciB0cmFja2VkID0gdGhpcy50cmFja2VkO1xuICAgIHZhciBpID0gdHJhY2tlZC5sZW5ndGg7XG5cbiAgICB3aGlsZSAoaS0tKSB7XG4gICAgICB2YXIgY3VycmVudCA9IHRyYWNrZWRbaV07XG5cbiAgICAgIGlmIChjdXJyZW50LmlzRGlydHkoKSkge1xuICAgICAgICBjdXJyZW50LmNhbGwoKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodHJhY2tlZC5sZW5ndGgpIHtcbiAgICAgIHRoaXMuc2NoZWR1bGVEaXJ0eUNoZWNrKCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBEaXJ0eUNoZWNrZXI7XG59KCk7XG5cbmV4cG9ydCB2YXIgRGlydHlDaGVja1Byb3BlcnR5ID0gKF9kZWM1ID0gc3Vic2NyaWJlckNvbGxlY3Rpb24oKSwgX2RlYzUoX2NsYXNzNSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRGlydHlDaGVja1Byb3BlcnR5KGRpcnR5Q2hlY2tlciwgb2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZGlydHlDaGVja2VyID0gZGlydHlDaGVja2VyO1xuICAgIHRoaXMub2JqID0gb2JqO1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICB9XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLm9ialt0aGlzLnByb3BlcnR5TmFtZV07XG4gIH07XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gY2FsbCgpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMuZ2V0VmFsdWUoKTtcblxuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG5cbiAgICB0aGlzLm9sZFZhbHVlID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgRGlydHlDaGVja1Byb3BlcnR5LnByb3RvdHlwZS5pc0RpcnR5ID0gZnVuY3Rpb24gaXNEaXJ0eSgpIHtcbiAgICByZXR1cm4gdGhpcy5vbGRWYWx1ZSAhPT0gdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIERpcnR5Q2hlY2tQcm9wZXJ0eS5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKCF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgICB0aGlzLmRpcnR5Q2hlY2tlci5hZGRQcm9wZXJ0eSh0aGlzKTtcbiAgICB9XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBEaXJ0eUNoZWNrUHJvcGVydHkucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAodGhpcy5yZW1vdmVTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKSAmJiAhdGhpcy5oYXNTdWJzY3JpYmVycygpKSB7XG4gICAgICB0aGlzLmRpcnR5Q2hlY2tlci5yZW1vdmVQcm9wZXJ0eSh0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIERpcnR5Q2hlY2tQcm9wZXJ0eTtcbn0oKSkgfHwgX2NsYXNzNSk7XG5cbnZhciBsb2dnZXIgPSBMb2dNYW5hZ2VyLmdldExvZ2dlcigncHJvcGVydHktb2JzZXJ2YXRpb24nKTtcblxuZXhwb3J0IHZhciBwcm9wZXJ0eUFjY2Vzc29yID0ge1xuICBnZXRWYWx1ZTogZnVuY3Rpb24gZ2V0VmFsdWUob2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICByZXR1cm4gb2JqW3Byb3BlcnR5TmFtZV07XG4gIH0sXG4gIHNldFZhbHVlOiBmdW5jdGlvbiBzZXRWYWx1ZSh2YWx1ZSwgb2JqLCBwcm9wZXJ0eU5hbWUpIHtcbiAgICBvYmpbcHJvcGVydHlOYW1lXSA9IHZhbHVlO1xuICB9XG59O1xuXG5leHBvcnQgdmFyIFByaW1pdGl2ZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBQcmltaXRpdmVPYnNlcnZlcihwcmltaXRpdmUsIHByb3BlcnR5TmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5kb05vdENhY2hlID0gdHJ1ZTtcblxuICAgIHRoaXMucHJpbWl0aXZlID0gcHJpbWl0aXZlO1xuICAgIHRoaXMucHJvcGVydHlOYW1lID0gcHJvcGVydHlOYW1lO1xuICB9XG5cbiAgUHJpbWl0aXZlT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMucHJpbWl0aXZlW3RoaXMucHJvcGVydHlOYW1lXTtcbiAgfTtcblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZSgpIHtcbiAgICB2YXIgdHlwZSA9IF90eXBlb2YodGhpcy5wcmltaXRpdmUpO1xuICAgIHRocm93IG5ldyBFcnJvcignVGhlICcgKyB0aGlzLnByb3BlcnR5TmFtZSArICcgcHJvcGVydHkgb2YgYSAnICsgdHlwZSArICcgKCcgKyB0aGlzLnByaW1pdGl2ZSArICcpIGNhbm5vdCBiZSBhc3NpZ25lZC4nKTtcbiAgfTtcblxuICBQcmltaXRpdmVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKCkge307XG5cbiAgUHJpbWl0aXZlT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoKSB7fTtcblxuICByZXR1cm4gUHJpbWl0aXZlT2JzZXJ2ZXI7XG59KCk7XG5cbmV4cG9ydCB2YXIgU2V0dGVyT2JzZXJ2ZXIgPSAoX2RlYzYgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNihfY2xhc3M3ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTZXR0ZXJPYnNlcnZlcih0YXNrUXVldWUsIG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLnRhc2tRdWV1ZSA9IHRhc2tRdWV1ZTtcbiAgICB0aGlzLm9iaiA9IG9iajtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgICB0aGlzLnF1ZXVlZCA9IGZhbHNlO1xuICAgIHRoaXMub2JzZXJ2aW5nID0gZmFsc2U7XG4gIH1cblxuICBTZXR0ZXJPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdID0gbmV3VmFsdWU7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLmdldHRlclZhbHVlID0gZnVuY3Rpb24gZ2V0dGVyVmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuY3VycmVudFZhbHVlO1xuICB9O1xuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5zZXR0ZXJWYWx1ZSA9IGZ1bmN0aW9uIHNldHRlclZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgdmFyIG9sZFZhbHVlID0gdGhpcy5jdXJyZW50VmFsdWU7XG5cbiAgICBpZiAob2xkVmFsdWUgIT09IG5ld1ZhbHVlKSB7XG4gICAgICBpZiAoIXRoaXMucXVldWVkKSB7XG4gICAgICAgIHRoaXMub2xkVmFsdWUgPSBvbGRWYWx1ZTtcbiAgICAgICAgdGhpcy5xdWV1ZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5jdXJyZW50VmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB9XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5vbGRWYWx1ZSA9IHRoaXMuY3VycmVudFZhbHVlO1xuXG4gICAgdGhpcy5xdWV1ZWQgPSBmYWxzZTtcblxuICAgIHRoaXMuY2FsbFN1YnNjcmliZXJzKG5ld1ZhbHVlLCBvbGRWYWx1ZSk7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICghdGhpcy5vYnNlcnZpbmcpIHtcbiAgICAgIHRoaXMuY29udmVydFByb3BlcnR5KCk7XG4gICAgfVxuICAgIHRoaXMuYWRkU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSk7XG4gIH07XG5cbiAgU2V0dGVyT2JzZXJ2ZXIucHJvdG90eXBlLnVuc3Vic2NyaWJlID0gZnVuY3Rpb24gdW5zdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICB0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIFNldHRlck9ic2VydmVyLnByb3RvdHlwZS5jb252ZXJ0UHJvcGVydHkgPSBmdW5jdGlvbiBjb252ZXJ0UHJvcGVydHkoKSB7XG4gICAgdGhpcy5vYnNlcnZpbmcgPSB0cnVlO1xuICAgIHRoaXMuY3VycmVudFZhbHVlID0gdGhpcy5vYmpbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICAgIHRoaXMuc2V0VmFsdWUgPSB0aGlzLnNldHRlclZhbHVlO1xuICAgIHRoaXMuZ2V0VmFsdWUgPSB0aGlzLmdldHRlclZhbHVlO1xuXG4gICAgaWYgKCFSZWZsZWN0LmRlZmluZVByb3BlcnR5KHRoaXMub2JqLCB0aGlzLnByb3BlcnR5TmFtZSwge1xuICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgZW51bWVyYWJsZTogdGhpcy5wcm9wZXJ0eU5hbWUgaW4gdGhpcy5vYmogPyB0aGlzLm9iai5wcm9wZXJ0eUlzRW51bWVyYWJsZSh0aGlzLnByb3BlcnR5TmFtZSkgOiB0cnVlLFxuICAgICAgZ2V0OiB0aGlzLmdldFZhbHVlLmJpbmQodGhpcyksXG4gICAgICBzZXQ6IHRoaXMuc2V0VmFsdWUuYmluZCh0aGlzKVxuICAgIH0pKSB7XG4gICAgICBsb2dnZXIud2FybignQ2Fubm90IG9ic2VydmUgcHJvcGVydHkgXFwnJyArIHRoaXMucHJvcGVydHlOYW1lICsgJ1xcJyBvZiBvYmplY3QnLCB0aGlzLm9iaik7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBTZXR0ZXJPYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzNyk7XG5cbmV4cG9ydCB2YXIgWExpbmtBdHRyaWJ1dGVPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gWExpbmtBdHRyaWJ1dGVPYnNlcnZlcihlbGVtZW50LCBwcm9wZXJ0eU5hbWUsIGF0dHJpYnV0ZU5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XG4gICAgdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7XG4gICAgdGhpcy5hdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZTtcbiAgfVxuXG4gIFhMaW5rQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsIHRoaXMuYXR0cmlidXRlTmFtZSk7XG4gIH07XG5cbiAgWExpbmtBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc2V0VmFsdWUgPSBmdW5jdGlvbiBzZXRWYWx1ZShuZXdWYWx1ZSkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnQuc2V0QXR0cmlidXRlTlMoJ2h0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsnLCB0aGlzLmF0dHJpYnV0ZU5hbWUsIG5ld1ZhbHVlKTtcbiAgfTtcblxuICBYTGlua0F0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdPYnNlcnZhdGlvbiBvZiBhIFwiJyArIHRoaXMuZWxlbWVudC5ub2RlTmFtZSArICdcIiBlbGVtZW50XFwncyBcIicgKyB0aGlzLnByb3BlcnR5TmFtZSArICdcIiBwcm9wZXJ0eSBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICB9O1xuXG4gIHJldHVybiBYTGlua0F0dHJpYnV0ZU9ic2VydmVyO1xufSgpO1xuXG5leHBvcnQgdmFyIGRhdGFBdHRyaWJ1dGVBY2Nlc3NvciA9IHtcbiAgZ2V0VmFsdWU6IGZ1bmN0aW9uIGdldFZhbHVlKG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgcmV0dXJuIG9iai5nZXRBdHRyaWJ1dGUocHJvcGVydHlOYW1lKTtcbiAgfSxcbiAgc2V0VmFsdWU6IGZ1bmN0aW9uIHNldFZhbHVlKHZhbHVlLCBvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICBvYmoucmVtb3ZlQXR0cmlidXRlKHByb3BlcnR5TmFtZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIG9iai5zZXRBdHRyaWJ1dGUocHJvcGVydHlOYW1lLCB2YWx1ZSk7XG4gICAgfVxuICB9XG59O1xuXG5leHBvcnQgdmFyIERhdGFBdHRyaWJ1dGVPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gRGF0YUF0dHJpYnV0ZU9ic2VydmVyKGVsZW1lbnQsIHByb3BlcnR5TmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgfVxuXG4gIERhdGFBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50LmdldEF0dHJpYnV0ZSh0aGlzLnByb3BlcnR5TmFtZSk7XG4gIH07XG5cbiAgRGF0YUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgaWYgKG5ld1ZhbHVlID09PSBudWxsIHx8IG5ld1ZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHRoaXMucHJvcGVydHlOYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZWxlbWVudC5zZXRBdHRyaWJ1dGUodGhpcy5wcm9wZXJ0eU5hbWUsIG5ld1ZhbHVlKTtcbiAgfTtcblxuICBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZSgpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09ic2VydmF0aW9uIG9mIGEgXCInICsgdGhpcy5lbGVtZW50Lm5vZGVOYW1lICsgJ1wiIGVsZW1lbnRcXCdzIFwiJyArIHRoaXMucHJvcGVydHlOYW1lICsgJ1wiIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQuJyk7XG4gIH07XG5cbiAgcmV0dXJuIERhdGFBdHRyaWJ1dGVPYnNlcnZlcjtcbn0oKTtcblxuZXhwb3J0IHZhciBTdHlsZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTdHlsZU9ic2VydmVyKGVsZW1lbnQsIHByb3BlcnR5TmFtZSkge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcblxuICAgIHRoaXMuc3R5bGVzID0gbnVsbDtcbiAgICB0aGlzLnZlcnNpb24gPSAwO1xuICB9XG5cbiAgU3R5bGVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5lbGVtZW50LnN0eWxlLmNzc1RleHQ7XG4gIH07XG5cbiAgU3R5bGVPYnNlcnZlci5wcm90b3R5cGUuX3NldFByb3BlcnR5ID0gZnVuY3Rpb24gX3NldFByb3BlcnR5KHN0eWxlLCB2YWx1ZSkge1xuICAgIHZhciBwcmlvcml0eSA9ICcnO1xuXG4gICAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlLmluZGV4T2YgPT09ICdmdW5jdGlvbicgJiYgdmFsdWUuaW5kZXhPZignIWltcG9ydGFudCcpICE9PSAtMSkge1xuICAgICAgcHJpb3JpdHkgPSAnaW1wb3J0YW50JztcbiAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgnIWltcG9ydGFudCcsICcnKTtcbiAgICB9XG4gICAgdGhpcy5lbGVtZW50LnN0eWxlLnNldFByb3BlcnR5KHN0eWxlLCB2YWx1ZSwgcHJpb3JpdHkpO1xuICB9O1xuXG4gIFN0eWxlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgc3R5bGVzID0gdGhpcy5zdHlsZXMgfHwge307XG4gICAgdmFyIHN0eWxlID0gdm9pZCAwO1xuICAgIHZhciB2ZXJzaW9uID0gdGhpcy52ZXJzaW9uO1xuXG4gICAgaWYgKG5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGlmIChuZXdWYWx1ZSBpbnN0YW5jZW9mIE9iamVjdCkge1xuICAgICAgICB2YXIgdmFsdWUgPSB2b2lkIDA7XG4gICAgICAgIGZvciAoc3R5bGUgaW4gbmV3VmFsdWUpIHtcbiAgICAgICAgICBpZiAobmV3VmFsdWUuaGFzT3duUHJvcGVydHkoc3R5bGUpKSB7XG4gICAgICAgICAgICB2YWx1ZSA9IG5ld1ZhbHVlW3N0eWxlXTtcbiAgICAgICAgICAgIHN0eWxlID0gc3R5bGUucmVwbGFjZSgvKFtBLVpdKS9nLCBmdW5jdGlvbiAobSkge1xuICAgICAgICAgICAgICByZXR1cm4gJy0nICsgbS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzdHlsZXNbc3R5bGVdID0gdmVyc2lvbjtcbiAgICAgICAgICAgIHRoaXMuX3NldFByb3BlcnR5KHN0eWxlLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKG5ld1ZhbHVlLmxlbmd0aCkge1xuICAgICAgICB2YXIgcnggPSAvXFxzKihbXFx3XFwtXSspXFxzKjpcXHMqKCg/Oig/OltcXHdcXC1dK1xcKFxccyooPzpcIig/OlxcXFxcInxbXlwiXSkqXCJ8Jyg/OlxcXFwnfFteJ10pKid8W1xcd1xcLV0rXFwoXFxzKig/Ol5cIig/OlxcXFxcInxbXlwiXSkqXCJ8Jyg/OlxcXFwnfFteJ10pKid8W15cXCldKilcXCksP3xbXlxcKV0qKVxcKSw/fFwiKD86XFxcXFwifFteXCJdKSpcInwnKD86XFxcXCd8W14nXSkqJ3xbXjtdKiksP1xccyopKyk7Py9nO1xuICAgICAgICB2YXIgcGFpciA9IHZvaWQgMDtcbiAgICAgICAgd2hpbGUgKChwYWlyID0gcnguZXhlYyhuZXdWYWx1ZSkpICE9PSBudWxsKSB7XG4gICAgICAgICAgc3R5bGUgPSBwYWlyWzFdO1xuICAgICAgICAgIGlmICghc3R5bGUpIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHN0eWxlc1tzdHlsZV0gPSB2ZXJzaW9uO1xuICAgICAgICAgIHRoaXMuX3NldFByb3BlcnR5KHN0eWxlLCBwYWlyWzJdKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc3R5bGVzID0gc3R5bGVzO1xuICAgIHRoaXMudmVyc2lvbiArPSAxO1xuXG4gICAgaWYgKHZlcnNpb24gPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB2ZXJzaW9uIC09IDE7XG4gICAgZm9yIChzdHlsZSBpbiBzdHlsZXMpIHtcbiAgICAgIGlmICghc3R5bGVzLmhhc093blByb3BlcnR5KHN0eWxlKSB8fCBzdHlsZXNbc3R5bGVdICE9PSB2ZXJzaW9uKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0aGlzLmVsZW1lbnQuc3R5bGUucmVtb3ZlUHJvcGVydHkoc3R5bGUpO1xuICAgIH1cbiAgfTtcblxuICBTdHlsZU9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdPYnNlcnZhdGlvbiBvZiBhIFwiJyArIHRoaXMuZWxlbWVudC5ub2RlTmFtZSArICdcIiBlbGVtZW50XFwncyBcIicgKyB0aGlzLnByb3BlcnR5TmFtZSArICdcIiBwcm9wZXJ0eSBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICB9O1xuXG4gIHJldHVybiBTdHlsZU9ic2VydmVyO1xufSgpO1xuXG5leHBvcnQgdmFyIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIgPSAoX2RlYzcgPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjNyhfY2xhc3M4ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyKGVsZW1lbnQsIHByb3BlcnR5TmFtZSwgaGFuZGxlcikge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLnByb3BlcnR5TmFtZSA9IHByb3BlcnR5TmFtZTtcbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdmaWxlcycpIHtcbiAgICAgIHRoaXMuc2V0VmFsdWUgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICB9XG4gIH1cblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLmVsZW1lbnRbdGhpcy5wcm9wZXJ0eU5hbWVdO1xuICB9O1xuXG4gIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlID09PSB1bmRlZmluZWQgfHwgbmV3VmFsdWUgPT09IG51bGwgPyAnJyA6IG5ld1ZhbHVlO1xuICAgIGlmICh0aGlzLmVsZW1lbnRbdGhpcy5wcm9wZXJ0eU5hbWVdICE9PSBuZXdWYWx1ZSkge1xuICAgICAgdGhpcy5lbGVtZW50W3RoaXMucHJvcGVydHlOYW1lXSA9IG5ld1ZhbHVlO1xuICAgICAgdGhpcy5ub3RpZnkoKTtcbiAgICB9XG4gIH07XG5cbiAgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUubm90aWZ5ID0gZnVuY3Rpb24gbm90aWZ5KCkge1xuICAgIHZhciBvbGRWYWx1ZSA9IHRoaXMub2xkVmFsdWU7XG4gICAgdmFyIG5ld1ZhbHVlID0gdGhpcy5nZXRWYWx1ZSgpO1xuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcblxuICAgIHRoaXMub2xkVmFsdWUgPSBuZXdWYWx1ZTtcbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS5oYW5kbGVFdmVudCA9IGZ1bmN0aW9uIGhhbmRsZUV2ZW50KCkge1xuICAgIHRoaXMubm90aWZ5KCk7XG4gIH07XG5cbiAgVmFsdWVBdHRyaWJ1dGVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKCF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLmdldFZhbHVlKCk7XG4gICAgICB0aGlzLmhhbmRsZXIuc3Vic2NyaWJlKHRoaXMuZWxlbWVudCwgdGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBWYWx1ZUF0dHJpYnV0ZU9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5oYW5kbGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXI7XG59KCkpIHx8IF9jbGFzczgpO1xuXG52YXIgY2hlY2tlZEFycmF5Q29udGV4dCA9ICdDaGVja2VkT2JzZXJ2ZXI6YXJyYXknO1xudmFyIGNoZWNrZWRWYWx1ZUNvbnRleHQgPSAnQ2hlY2tlZE9ic2VydmVyOnZhbHVlJztcblxuZXhwb3J0IHZhciBDaGVja2VkT2JzZXJ2ZXIgPSAoX2RlYzggPSBzdWJzY3JpYmVyQ29sbGVjdGlvbigpLCBfZGVjOChfY2xhc3M5ID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBDaGVja2VkT2JzZXJ2ZXIoZWxlbWVudCwgaGFuZGxlciwgb2JzZXJ2ZXJMb2NhdG9yKSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gIH1cblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLmdldFZhbHVlID0gZnVuY3Rpb24gZ2V0VmFsdWUoKSB7XG4gICAgcmV0dXJuIHRoaXMudmFsdWU7XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgaWYgKHRoaXMuaW5pdGlhbFN5bmMgJiYgdGhpcy52YWx1ZSA9PT0gbmV3VmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5hcnJheU9ic2VydmVyKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIudW5zdWJzY3JpYmUoY2hlY2tlZEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSBudWxsO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmVsZW1lbnQudHlwZSA9PT0gJ2NoZWNrYm94JyAmJiBBcnJheS5pc0FycmF5KG5ld1ZhbHVlKSkge1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyID0gdGhpcy5vYnNlcnZlckxvY2F0b3IuZ2V0QXJyYXlPYnNlcnZlcihuZXdWYWx1ZSk7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIuc3Vic2NyaWJlKGNoZWNrZWRBcnJheUNvbnRleHQsIHRoaXMpO1xuICAgIH1cblxuICAgIHRoaXMub2xkVmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB0aGlzLnN5bmNocm9uaXplRWxlbWVudCgpO1xuICAgIHRoaXMubm90aWZ5KCk7XG5cbiAgICBpZiAoIXRoaXMuaW5pdGlhbFN5bmMpIHtcbiAgICAgIHRoaXMuaW5pdGlhbFN5bmMgPSB0cnVlO1xuICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKHRoaXMpO1xuICAgIH1cbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKGNvbnRleHQsIHNwbGljZXMpIHtcbiAgICB0aGlzLnN5bmNocm9uaXplRWxlbWVudCgpO1xuXG4gICAgaWYgKCF0aGlzLnZhbHVlT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMudmFsdWVPYnNlcnZlciA9IHRoaXMuZWxlbWVudC5fX29ic2VydmVyc19fLm1vZGVsIHx8IHRoaXMuZWxlbWVudC5fX29ic2VydmVyc19fLnZhbHVlO1xuICAgICAgaWYgKHRoaXMudmFsdWVPYnNlcnZlcikge1xuICAgICAgICB0aGlzLnZhbHVlT2JzZXJ2ZXIuc3Vic2NyaWJlKGNoZWNrZWRWYWx1ZUNvbnRleHQsIHRoaXMpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLnN5bmNocm9uaXplRWxlbWVudCA9IGZ1bmN0aW9uIHN5bmNocm9uaXplRWxlbWVudCgpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgIHZhciBlbGVtZW50VmFsdWUgPSBlbGVtZW50Lmhhc093blByb3BlcnR5KCdtb2RlbCcpID8gZWxlbWVudC5tb2RlbCA6IGVsZW1lbnQudmFsdWU7XG4gICAgdmFyIGlzUmFkaW8gPSBlbGVtZW50LnR5cGUgPT09ICdyYWRpbyc7XG4gICAgdmFyIG1hdGNoZXIgPSBlbGVtZW50Lm1hdGNoZXIgfHwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhID09PSBiO1xuICAgIH07XG5cbiAgICBlbGVtZW50LmNoZWNrZWQgPSBpc1JhZGlvICYmICEhbWF0Y2hlcih2YWx1ZSwgZWxlbWVudFZhbHVlKSB8fCAhaXNSYWRpbyAmJiB2YWx1ZSA9PT0gdHJ1ZSB8fCAhaXNSYWRpbyAmJiBBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5maW5kSW5kZXgoZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgIHJldHVybiAhIW1hdGNoZXIoaXRlbSwgZWxlbWVudFZhbHVlKTtcbiAgICB9KSAhPT0gLTE7XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS5zeW5jaHJvbml6ZVZhbHVlID0gZnVuY3Rpb24gc3luY2hyb25pemVWYWx1ZSgpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50O1xuICAgIHZhciBlbGVtZW50VmFsdWUgPSBlbGVtZW50Lmhhc093blByb3BlcnR5KCdtb2RlbCcpID8gZWxlbWVudC5tb2RlbCA6IGVsZW1lbnQudmFsdWU7XG4gICAgdmFyIGluZGV4ID0gdm9pZCAwO1xuICAgIHZhciBtYXRjaGVyID0gZWxlbWVudC5tYXRjaGVyIHx8IGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICByZXR1cm4gYSA9PT0gYjtcbiAgICB9O1xuXG4gICAgaWYgKGVsZW1lbnQudHlwZSA9PT0gJ2NoZWNrYm94Jykge1xuICAgICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICAgIGluZGV4ID0gdmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgcmV0dXJuICEhbWF0Y2hlcihpdGVtLCBlbGVtZW50VmFsdWUpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGVsZW1lbnQuY2hlY2tlZCAmJiBpbmRleCA9PT0gLTEpIHtcbiAgICAgICAgICB2YWx1ZS5wdXNoKGVsZW1lbnRWYWx1ZSk7XG4gICAgICAgIH0gZWxzZSBpZiAoIWVsZW1lbnQuY2hlY2tlZCAmJiBpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICB2YWx1ZS5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICB2YWx1ZSA9IGVsZW1lbnQuY2hlY2tlZDtcbiAgICB9IGVsc2UgaWYgKGVsZW1lbnQuY2hlY2tlZCkge1xuICAgICAgdmFsdWUgPSBlbGVtZW50VmFsdWU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgdGhpcy5ub3RpZnkoKTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMudmFsdWU7XG5cbiAgICBpZiAobmV3VmFsdWUgPT09IG9sZFZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5jYWxsU3Vic2NyaWJlcnMobmV3VmFsdWUsIG9sZFZhbHVlKTtcbiAgfTtcblxuICBDaGVja2VkT2JzZXJ2ZXIucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoKSB7XG4gICAgdGhpcy5zeW5jaHJvbml6ZVZhbHVlKCk7XG4gIH07XG5cbiAgQ2hlY2tlZE9ic2VydmVyLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiBzdWJzY3JpYmUoY29udGV4dCwgY2FsbGFibGUpIHtcbiAgICBpZiAoIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5oYW5kbGVyLnN1YnNjcmliZSh0aGlzLmVsZW1lbnQsIHRoaXMpO1xuICAgIH1cbiAgICB0aGlzLmFkZFN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpO1xuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiB1bnN1YnNjcmliZShjb250ZXh0LCBjYWxsYWJsZSkge1xuICAgIGlmICh0aGlzLnJlbW92ZVN1YnNjcmliZXIoY29udGV4dCwgY2FsbGFibGUpICYmICF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlci5kaXNwb3NlKCk7XG4gICAgfVxuICB9O1xuXG4gIENoZWNrZWRPYnNlcnZlci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICh0aGlzLmFycmF5T2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlci51bnN1YnNjcmliZShjaGVja2VkQXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuICAgIGlmICh0aGlzLnZhbHVlT2JzZXJ2ZXIpIHtcbiAgICAgIHRoaXMudmFsdWVPYnNlcnZlci51bnN1YnNjcmliZShjaGVja2VkVmFsdWVDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENoZWNrZWRPYnNlcnZlcjtcbn0oKSkgfHwgX2NsYXNzOSk7XG5cbnZhciBzZWxlY3RBcnJheUNvbnRleHQgPSAnU2VsZWN0VmFsdWVPYnNlcnZlcjphcnJheSc7XG5cbmV4cG9ydCB2YXIgU2VsZWN0VmFsdWVPYnNlcnZlciA9IChfZGVjOSA9IHN1YnNjcmliZXJDb2xsZWN0aW9uKCksIF9kZWM5KF9jbGFzczEwID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBTZWxlY3RWYWx1ZU9ic2VydmVyKGVsZW1lbnQsIGhhbmRsZXIsIG9ic2VydmVyTG9jYXRvcikge1xuICAgIFxuXG4gICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcbiAgICB0aGlzLmhhbmRsZXIgPSBoYW5kbGVyO1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICB9XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuZ2V0VmFsdWUgPSBmdW5jdGlvbiBnZXRWYWx1ZSgpIHtcbiAgICByZXR1cm4gdGhpcy52YWx1ZTtcbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5zZXRWYWx1ZSA9IGZ1bmN0aW9uIHNldFZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgaWYgKG5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5lbGVtZW50Lm11bHRpcGxlICYmICFBcnJheS5pc0FycmF5KG5ld1ZhbHVlKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdPbmx5IG51bGwgb3IgQXJyYXkgaW5zdGFuY2VzIGNhbiBiZSBib3VuZCB0byBhIG11bHRpLXNlbGVjdC4nKTtcbiAgICB9XG4gICAgaWYgKHRoaXMudmFsdWUgPT09IG5ld1ZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYXJyYXlPYnNlcnZlcikge1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyLnVuc3Vic2NyaWJlKHNlbGVjdEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIgPSBudWxsO1xuICAgIH1cblxuICAgIGlmIChBcnJheS5pc0FycmF5KG5ld1ZhbHVlKSkge1xuICAgICAgdGhpcy5hcnJheU9ic2VydmVyID0gdGhpcy5vYnNlcnZlckxvY2F0b3IuZ2V0QXJyYXlPYnNlcnZlcihuZXdWYWx1ZSk7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIuc3Vic2NyaWJlKHNlbGVjdEFycmF5Q29udGV4dCwgdGhpcyk7XG4gICAgfVxuXG4gICAgdGhpcy5vbGRWYWx1ZSA9IHRoaXMudmFsdWU7XG4gICAgdGhpcy52YWx1ZSA9IG5ld1ZhbHVlO1xuICAgIHRoaXMuc3luY2hyb25pemVPcHRpb25zKCk7XG4gICAgdGhpcy5ub3RpZnkoKTtcblxuICAgIGlmICghdGhpcy5pbml0aWFsU3luYykge1xuICAgICAgdGhpcy5pbml0aWFsU3luYyA9IHRydWU7XG4gICAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2sodGhpcyk7XG4gICAgfVxuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLmNhbGwgPSBmdW5jdGlvbiBjYWxsKGNvbnRleHQsIHNwbGljZXMpIHtcbiAgICB0aGlzLnN5bmNocm9uaXplT3B0aW9ucygpO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLnN5bmNocm9uaXplT3B0aW9ucyA9IGZ1bmN0aW9uIHN5bmNocm9uaXplT3B0aW9ucygpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLnZhbHVlO1xuICAgIHZhciBpc0FycmF5ID0gdm9pZCAwO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgICBpc0FycmF5ID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZWxlbWVudC5vcHRpb25zO1xuICAgIHZhciBpID0gb3B0aW9ucy5sZW5ndGg7XG4gICAgdmFyIG1hdGNoZXIgPSB0aGlzLmVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgfTtcblxuICAgIHZhciBfbG9vcCA9IGZ1bmN0aW9uIF9sb29wKCkge1xuICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnMuaXRlbShpKTtcbiAgICAgIHZhciBvcHRpb25WYWx1ZSA9IG9wdGlvbi5oYXNPd25Qcm9wZXJ0eSgnbW9kZWwnKSA/IG9wdGlvbi5tb2RlbCA6IG9wdGlvbi52YWx1ZTtcbiAgICAgIGlmIChpc0FycmF5KSB7XG4gICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHZhbHVlLmZpbmRJbmRleChmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgIHJldHVybiAhIW1hdGNoZXIob3B0aW9uVmFsdWUsIGl0ZW0pO1xuICAgICAgICB9KSAhPT0gLTE7XG4gICAgICAgIHJldHVybiAnY29udGludWUnO1xuICAgICAgfVxuICAgICAgb3B0aW9uLnNlbGVjdGVkID0gISFtYXRjaGVyKG9wdGlvblZhbHVlLCB2YWx1ZSk7XG4gICAgfTtcblxuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIHZhciBfcmV0ID0gX2xvb3AoKTtcblxuICAgICAgaWYgKF9yZXQgPT09ICdjb250aW51ZScpIGNvbnRpbnVlO1xuICAgIH1cbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS5zeW5jaHJvbml6ZVZhbHVlID0gZnVuY3Rpb24gc3luY2hyb25pemVWYWx1ZSgpIHtcbiAgICB2YXIgX3RoaXMyMyA9IHRoaXM7XG5cbiAgICB2YXIgb3B0aW9ucyA9IHRoaXMuZWxlbWVudC5vcHRpb25zO1xuICAgIHZhciBjb3VudCA9IDA7XG4gICAgdmFyIHZhbHVlID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBvcHRpb25zLmxlbmd0aDsgaSA8IGlpOyBpKyspIHtcbiAgICAgIHZhciBfb3B0aW9uID0gb3B0aW9ucy5pdGVtKGkpO1xuICAgICAgaWYgKCFfb3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuICAgICAgdmFsdWUucHVzaChfb3B0aW9uLmhhc093blByb3BlcnR5KCdtb2RlbCcpID8gX29wdGlvbi5tb2RlbCA6IF9vcHRpb24udmFsdWUpO1xuICAgICAgY291bnQrKztcbiAgICB9XG5cbiAgICBpZiAodGhpcy5lbGVtZW50Lm11bHRpcGxlKSB7XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheSh0aGlzLnZhbHVlKSkge1xuICAgICAgICB2YXIgX3JldDIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgdmFyIG1hdGNoZXIgPSBfdGhpczIzLmVsZW1lbnQubWF0Y2hlciB8fCBmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgcmV0dXJuIGEgPT09IGI7XG4gICAgICAgICAgfTtcblxuICAgICAgICAgIHZhciBpID0gMDtcblxuICAgICAgICAgIHZhciBfbG9vcDIgPSBmdW5jdGlvbiBfbG9vcDIoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IF90aGlzMjMudmFsdWVbaV07XG4gICAgICAgICAgICBpZiAodmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGEsIGIpO1xuICAgICAgICAgICAgfSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgIF90aGlzMjMudmFsdWUuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICB3aGlsZSAoaSA8IF90aGlzMjMudmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICBfbG9vcDIoKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpID0gMDtcblxuICAgICAgICAgIHZhciBfbG9vcDMgPSBmdW5jdGlvbiBfbG9vcDMoKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHZhbHVlW2ldO1xuICAgICAgICAgICAgaWYgKF90aGlzMjMudmFsdWUuZmluZEluZGV4KGZ1bmN0aW9uIChiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBtYXRjaGVyKGEsIGIpO1xuICAgICAgICAgICAgfSkgPT09IC0xKSB7XG4gICAgICAgICAgICAgIF90aGlzMjMudmFsdWUucHVzaChhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGkrKztcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgd2hpbGUgKGkgPCB2YWx1ZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIF9sb29wMygpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgdjogdm9pZCAwXG4gICAgICAgICAgfTtcbiAgICAgICAgfSgpO1xuXG4gICAgICAgIGlmICgodHlwZW9mIF9yZXQyID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogX3R5cGVvZihfcmV0MikpID09PSBcIm9iamVjdFwiKSByZXR1cm4gX3JldDIudjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNvdW50ID09PSAwKSB7XG4gICAgICAgIHZhbHVlID0gbnVsbDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhbHVlID0gdmFsdWVbMF07XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlICE9PSB0aGlzLnZhbHVlKSB7XG4gICAgICB0aGlzLm9sZFZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICAgIHRoaXMubm90aWZ5KCk7XG4gICAgfVxuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uIG5vdGlmeSgpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSB0aGlzLm9sZFZhbHVlO1xuICAgIHZhciBuZXdWYWx1ZSA9IHRoaXMudmFsdWU7XG5cbiAgICB0aGlzLmNhbGxTdWJzY3JpYmVycyhuZXdWYWx1ZSwgb2xkVmFsdWUpO1xuICB9O1xuXG4gIFNlbGVjdFZhbHVlT2JzZXJ2ZXIucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoKSB7XG4gICAgdGhpcy5zeW5jaHJvbml6ZVZhbHVlKCk7XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKCF0aGlzLmhhc1N1YnNjcmliZXJzKCkpIHtcbiAgICAgIHRoaXMuaGFuZGxlci5zdWJzY3JpYmUodGhpcy5lbGVtZW50LCB0aGlzKTtcbiAgICB9XG4gICAgdGhpcy5hZGRTdWJzY3JpYmVyKGNvbnRleHQsIGNhbGxhYmxlKTtcbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNvbnRleHQsIGNhbGxhYmxlKSB7XG4gICAgaWYgKHRoaXMucmVtb3ZlU3Vic2NyaWJlcihjb250ZXh0LCBjYWxsYWJsZSkgJiYgIXRoaXMuaGFzU3Vic2NyaWJlcnMoKSkge1xuICAgICAgdGhpcy5oYW5kbGVyLmRpc3Bvc2UoKTtcbiAgICB9XG4gIH07XG5cbiAgU2VsZWN0VmFsdWVPYnNlcnZlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoKSB7XG4gICAgdmFyIF90aGlzMjQgPSB0aGlzO1xuXG4gICAgdGhpcy5kb21PYnNlcnZlciA9IERPTS5jcmVhdGVNdXRhdGlvbk9ic2VydmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgIF90aGlzMjQuc3luY2hyb25pemVPcHRpb25zKCk7XG4gICAgICBfdGhpczI0LnN5bmNocm9uaXplVmFsdWUoKTtcbiAgICB9KTtcbiAgICB0aGlzLmRvbU9ic2VydmVyLm9ic2VydmUodGhpcy5lbGVtZW50LCB7IGNoaWxkTGlzdDogdHJ1ZSwgc3VidHJlZTogdHJ1ZSwgY2hhcmFjdGVyRGF0YTogdHJ1ZSB9KTtcbiAgfTtcblxuICBTZWxlY3RWYWx1ZU9ic2VydmVyLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiB1bmJpbmQoKSB7XG4gICAgdGhpcy5kb21PYnNlcnZlci5kaXNjb25uZWN0KCk7XG4gICAgdGhpcy5kb21PYnNlcnZlciA9IG51bGw7XG5cbiAgICBpZiAodGhpcy5hcnJheU9ic2VydmVyKSB7XG4gICAgICB0aGlzLmFycmF5T2JzZXJ2ZXIudW5zdWJzY3JpYmUoc2VsZWN0QXJyYXlDb250ZXh0LCB0aGlzKTtcbiAgICAgIHRoaXMuYXJyYXlPYnNlcnZlciA9IG51bGw7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBTZWxlY3RWYWx1ZU9ic2VydmVyO1xufSgpKSB8fCBfY2xhc3MxMCk7XG5cbmV4cG9ydCB2YXIgQ2xhc3NPYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2xhc3NPYnNlcnZlcihlbGVtZW50KSB7XG4gICAgXG5cbiAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgIHRoaXMuZG9Ob3RDYWNoZSA9IHRydWU7XG4gICAgdGhpcy52YWx1ZSA9ICcnO1xuICAgIHRoaXMudmVyc2lvbiA9IDA7XG4gIH1cblxuICBDbGFzc09ic2VydmVyLnByb3RvdHlwZS5nZXRWYWx1ZSA9IGZ1bmN0aW9uIGdldFZhbHVlKCkge1xuICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICB9O1xuXG4gIENsYXNzT2JzZXJ2ZXIucHJvdG90eXBlLnNldFZhbHVlID0gZnVuY3Rpb24gc2V0VmFsdWUobmV3VmFsdWUpIHtcbiAgICB2YXIgbmFtZUluZGV4ID0gdGhpcy5uYW1lSW5kZXggfHwge307XG4gICAgdmFyIHZlcnNpb24gPSB0aGlzLnZlcnNpb247XG4gICAgdmFyIG5hbWVzID0gdm9pZCAwO1xuICAgIHZhciBuYW1lID0gdm9pZCAwO1xuXG4gICAgaWYgKG5ld1ZhbHVlICE9PSBudWxsICYmIG5ld1ZhbHVlICE9PSB1bmRlZmluZWQgJiYgbmV3VmFsdWUubGVuZ3RoKSB7XG4gICAgICBuYW1lcyA9IG5ld1ZhbHVlLnNwbGl0KC9cXHMrLyk7XG4gICAgICBmb3IgKHZhciBpID0gMCwgbGVuZ3RoID0gbmFtZXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgbmFtZSA9IG5hbWVzW2ldO1xuICAgICAgICBpZiAobmFtZSA9PT0gJycpIHtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICBuYW1lSW5kZXhbbmFtZV0gPSB2ZXJzaW9uO1xuICAgICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LmFkZChuYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLnZhbHVlID0gbmV3VmFsdWU7XG4gICAgdGhpcy5uYW1lSW5kZXggPSBuYW1lSW5kZXg7XG4gICAgdGhpcy52ZXJzaW9uICs9IDE7XG5cbiAgICBpZiAodmVyc2lvbiA9PT0gMCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHZlcnNpb24gLT0gMTtcbiAgICBmb3IgKG5hbWUgaW4gbmFtZUluZGV4KSB7XG4gICAgICBpZiAoIW5hbWVJbmRleC5oYXNPd25Qcm9wZXJ0eShuYW1lKSB8fCBuYW1lSW5kZXhbbmFtZV0gIT09IHZlcnNpb24pIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgICB0aGlzLmVsZW1lbnQuY2xhc3NMaXN0LnJlbW92ZShuYW1lKTtcbiAgICB9XG4gIH07XG5cbiAgQ2xhc3NPYnNlcnZlci5wcm90b3R5cGUuc3Vic2NyaWJlID0gZnVuY3Rpb24gc3Vic2NyaWJlKCkge1xuICAgIHRocm93IG5ldyBFcnJvcignT2JzZXJ2YXRpb24gb2YgYSBcIicgKyB0aGlzLmVsZW1lbnQubm9kZU5hbWUgKyAnXCIgZWxlbWVudFxcJ3MgXCJjbGFzc1wiIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQuJyk7XG4gIH07XG5cbiAgcmV0dXJuIENsYXNzT2JzZXJ2ZXI7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNEZWNsYXJlZERlcGVuZGVuY2llcyhkZXNjcmlwdG9yKSB7XG4gIHJldHVybiAhIShkZXNjcmlwdG9yICYmIGRlc2NyaXB0b3IuZ2V0ICYmIGRlc2NyaXB0b3IuZ2V0LmRlcGVuZGVuY2llcyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWNsYXJlUHJvcGVydHlEZXBlbmRlbmNpZXMoY3RvciwgcHJvcGVydHlOYW1lLCBkZXBlbmRlbmNpZXMpIHtcbiAgdmFyIGRlc2NyaXB0b3IgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGN0b3IucHJvdG90eXBlLCBwcm9wZXJ0eU5hbWUpO1xuICBkZXNjcmlwdG9yLmdldC5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjb21wdXRlZEZyb20oKSB7XG4gIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbiksIF9rZXkgPSAwOyBfa2V5IDwgX2xlbjsgX2tleSsrKSB7XG4gICAgcmVzdFtfa2V5XSA9IGFyZ3VtZW50c1tfa2V5XTtcbiAgfVxuXG4gIHJldHVybiBmdW5jdGlvbiAodGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IpIHtcbiAgICBkZXNjcmlwdG9yLmdldC5kZXBlbmRlbmNpZXMgPSByZXN0O1xuICAgIHJldHVybiBkZXNjcmlwdG9yO1xuICB9O1xufVxuXG5leHBvcnQgdmFyIENvbXB1dGVkRXhwcmVzc2lvbiA9IGZ1bmN0aW9uIChfRXhwcmVzc2lvbjE5KSB7XG4gIF9pbmhlcml0cyhDb21wdXRlZEV4cHJlc3Npb24sIF9FeHByZXNzaW9uMTkpO1xuXG4gIGZ1bmN0aW9uIENvbXB1dGVkRXhwcmVzc2lvbihuYW1lLCBkZXBlbmRlbmNpZXMpIHtcbiAgICBcblxuICAgIHZhciBfdGhpczI1ID0gX3Bvc3NpYmxlQ29uc3RydWN0b3JSZXR1cm4odGhpcywgX0V4cHJlc3Npb24xOS5jYWxsKHRoaXMpKTtcblxuICAgIF90aGlzMjUubmFtZSA9IG5hbWU7XG4gICAgX3RoaXMyNS5kZXBlbmRlbmNpZXMgPSBkZXBlbmRlbmNpZXM7XG4gICAgX3RoaXMyNS5pc0Fzc2lnbmFibGUgPSB0cnVlO1xuICAgIHJldHVybiBfdGhpczI1O1xuICB9XG5cbiAgQ29tcHV0ZWRFeHByZXNzaW9uLnByb3RvdHlwZS5ldmFsdWF0ZSA9IGZ1bmN0aW9uIGV2YWx1YXRlKHNjb3BlLCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICByZXR1cm4gc2NvcGUuYmluZGluZ0NvbnRleHRbdGhpcy5uYW1lXTtcbiAgfTtcblxuICBDb21wdXRlZEV4cHJlc3Npb24ucHJvdG90eXBlLmFzc2lnbiA9IGZ1bmN0aW9uIGFzc2lnbihzY29wZSwgdmFsdWUpIHtcbiAgICBzY29wZS5iaW5kaW5nQ29udGV4dFt0aGlzLm5hbWVdID0gdmFsdWU7XG4gIH07XG5cbiAgQ29tcHV0ZWRFeHByZXNzaW9uLnByb3RvdHlwZS5hY2NlcHQgPSBmdW5jdGlvbiBhY2NlcHQodmlzaXRvcikge1xuICAgIHRocm93IG5ldyBFcnJvcignbm90IGltcGxlbWVudGVkJyk7XG4gIH07XG5cbiAgQ29tcHV0ZWRFeHByZXNzaW9uLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gY29ubmVjdChiaW5kaW5nLCBzY29wZSkge1xuICAgIHZhciBkZXBlbmRlbmNpZXMgPSB0aGlzLmRlcGVuZGVuY2llcztcbiAgICB2YXIgaSA9IGRlcGVuZGVuY2llcy5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgZGVwZW5kZW5jaWVzW2ldLmNvbm5lY3QoYmluZGluZywgc2NvcGUpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ29tcHV0ZWRFeHByZXNzaW9uO1xufShFeHByZXNzaW9uKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUNvbXB1dGVkT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGRlc2NyaXB0b3IsIG9ic2VydmVyTG9jYXRvcikge1xuICB2YXIgZGVwZW5kZW5jaWVzID0gZGVzY3JpcHRvci5nZXQuZGVwZW5kZW5jaWVzO1xuICBpZiAoIShkZXBlbmRlbmNpZXMgaW5zdGFuY2VvZiBDb21wdXRlZEV4cHJlc3Npb24pKSB7XG4gICAgdmFyIGkgPSBkZXBlbmRlbmNpZXMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgIGRlcGVuZGVuY2llc1tpXSA9IG9ic2VydmVyTG9jYXRvci5wYXJzZXIucGFyc2UoZGVwZW5kZW5jaWVzW2ldKTtcbiAgICB9XG4gICAgZGVwZW5kZW5jaWVzID0gZGVzY3JpcHRvci5nZXQuZGVwZW5kZW5jaWVzID0gbmV3IENvbXB1dGVkRXhwcmVzc2lvbihwcm9wZXJ0eU5hbWUsIGRlcGVuZGVuY2llcyk7XG4gIH1cblxuICB2YXIgc2NvcGUgPSB7IGJpbmRpbmdDb250ZXh0OiBvYmosIG92ZXJyaWRlQ29udGV4dDogY3JlYXRlT3ZlcnJpZGVDb250ZXh0KG9iaikgfTtcbiAgcmV0dXJuIG5ldyBFeHByZXNzaW9uT2JzZXJ2ZXIoc2NvcGUsIGRlcGVuZGVuY2llcywgb2JzZXJ2ZXJMb2NhdG9yKTtcbn1cblxudmFyIHN2Z0VsZW1lbnRzID0gdm9pZCAwO1xudmFyIHN2Z1ByZXNlbnRhdGlvbkVsZW1lbnRzID0gdm9pZCAwO1xudmFyIHN2Z1ByZXNlbnRhdGlvbkF0dHJpYnV0ZXMgPSB2b2lkIDA7XG52YXIgc3ZnQW5hbHl6ZXIgPSB2b2lkIDA7XG5cbmlmICh0eXBlb2YgRkVBVFVSRV9OT19TVkcgPT09ICd1bmRlZmluZWQnKSB7XG4gIHN2Z0VsZW1lbnRzID0ge1xuICAgIGE6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RhcmdldCcsICd0cmFuc2Zvcm0nLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgYWx0R2x5cGg6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmb3JtYXQnLCAnZ2x5cGhSZWYnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGFsdEdseXBoRGVmOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGFsdEdseXBoSXRlbTogWydpZCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBhbmltYXRlOiBbJ2FjY3VtdWxhdGUnLCAnYWRkaXRpdmUnLCAnYXR0cmlidXRlTmFtZScsICdhdHRyaWJ1dGVUeXBlJywgJ2JlZ2luJywgJ2J5JywgJ2NhbGNNb2RlJywgJ2R1cicsICdlbmQnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmaWxsJywgJ2Zyb20nLCAnaWQnLCAna2V5U3BsaW5lcycsICdrZXlUaW1lcycsICdtYXgnLCAnbWluJywgJ29uYmVnaW4nLCAnb25lbmQnLCAnb25sb2FkJywgJ29ucmVwZWF0JywgJ3JlcGVhdENvdW50JywgJ3JlcGVhdER1cicsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyZXN0YXJ0JywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3ZhbHVlcycsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBhbmltYXRlQ29sb3I6IFsnYWNjdW11bGF0ZScsICdhZGRpdGl2ZScsICdhdHRyaWJ1dGVOYW1lJywgJ2F0dHJpYnV0ZVR5cGUnLCAnYmVnaW4nLCAnYnknLCAnY2FsY01vZGUnLCAnZHVyJywgJ2VuZCcsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2ZpbGwnLCAnZnJvbScsICdpZCcsICdrZXlTcGxpbmVzJywgJ2tleVRpbWVzJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndG8nLCAndmFsdWVzJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGFuaW1hdGVNb3Rpb246IFsnYWNjdW11bGF0ZScsICdhZGRpdGl2ZScsICdiZWdpbicsICdieScsICdjYWxjTW9kZScsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdmcm9tJywgJ2lkJywgJ2tleVBvaW50cycsICdrZXlTcGxpbmVzJywgJ2tleVRpbWVzJywgJ21heCcsICdtaW4nLCAnb25iZWdpbicsICdvbmVuZCcsICdvbmxvYWQnLCAnb25yZXBlYXQnLCAnb3JpZ2luJywgJ3BhdGgnLCAncmVwZWF0Q291bnQnLCAncmVwZWF0RHVyJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3Jlc3RhcnQnLCAncm90YXRlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3ZhbHVlcycsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBhbmltYXRlVHJhbnNmb3JtOiBbJ2FjY3VtdWxhdGUnLCAnYWRkaXRpdmUnLCAnYXR0cmlidXRlTmFtZScsICdhdHRyaWJ1dGVUeXBlJywgJ2JlZ2luJywgJ2J5JywgJ2NhbGNNb2RlJywgJ2R1cicsICdlbmQnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdmaWxsJywgJ2Zyb20nLCAnaWQnLCAna2V5U3BsaW5lcycsICdrZXlUaW1lcycsICdtYXgnLCAnbWluJywgJ29uYmVnaW4nLCAnb25lbmQnLCAnb25sb2FkJywgJ29ucmVwZWF0JywgJ3JlcGVhdENvdW50JywgJ3JlcGVhdER1cicsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyZXN0YXJ0JywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3R5cGUnLCAndmFsdWVzJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGNpcmNsZTogWydjbGFzcycsICdjeCcsICdjeScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncicsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgY2xpcFBhdGg6IFsnY2xhc3MnLCAnY2xpcFBhdGhVbml0cycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICAnY29sb3ItcHJvZmlsZSc6IFsnaWQnLCAnbG9jYWwnLCAnbmFtZScsICdyZW5kZXJpbmctaW50ZW50JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGN1cnNvcjogWydleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBkZWZzOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZGVzYzogWydjbGFzcycsICdpZCcsICdzdHlsZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBlbGxpcHNlOiBbJ2NsYXNzJywgJ2N4JywgJ2N5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyeCcsICdyeScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVCbGVuZDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnaW4yJywgJ21vZGUnLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZUNvbG9yTWF0cml4OiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdyZXN1bHQnLCAnc3R5bGUnLCAndHlwZScsICd2YWx1ZXMnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlQ29tcG9uZW50VHJhbnNmZXI6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVDb21wb3NpdGU6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ2luMicsICdrMScsICdrMicsICdrMycsICdrNCcsICdvcGVyYXRvcicsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlQ29udm9sdmVNYXRyaXg6IFsnYmlhcycsICdjbGFzcycsICdkaXZpc29yJywgJ2VkZ2VNb2RlJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdrZXJuZWxNYXRyaXgnLCAna2VybmVsVW5pdExlbmd0aCcsICdvcmRlcicsICdwcmVzZXJ2ZUFscGhhJywgJ3Jlc3VsdCcsICdzdHlsZScsICd0YXJnZXRYJywgJ3RhcmdldFknLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlRGlmZnVzZUxpZ2h0aW5nOiBbJ2NsYXNzJywgJ2RpZmZ1c2VDb25zdGFudCcsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAna2VybmVsVW5pdExlbmd0aCcsICdyZXN1bHQnLCAnc3R5bGUnLCAnc3VyZmFjZVNjYWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZURpc3BsYWNlbWVudE1hcDogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnaW4yJywgJ3Jlc3VsdCcsICdzY2FsZScsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3hDaGFubmVsU2VsZWN0b3InLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAneUNoYW5uZWxTZWxlY3RvciddLFxuICAgIGZlRGlzdGFudExpZ2h0OiBbJ2F6aW11dGgnLCAnZWxldmF0aW9uJywgJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGZlRmxvb2Q6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVGdW5jQTogWydhbXBsaXR1ZGUnLCAnZXhwb25lbnQnLCAnaWQnLCAnaW50ZXJjZXB0JywgJ29mZnNldCcsICdzbG9wZScsICd0YWJsZVZhbHVlcycsICd0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGZlRnVuY0I6IFsnYW1wbGl0dWRlJywgJ2V4cG9uZW50JywgJ2lkJywgJ2ludGVyY2VwdCcsICdvZmZzZXQnLCAnc2xvcGUnLCAndGFibGVWYWx1ZXMnLCAndHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBmZUZ1bmNHOiBbJ2FtcGxpdHVkZScsICdleHBvbmVudCcsICdpZCcsICdpbnRlcmNlcHQnLCAnb2Zmc2V0JywgJ3Nsb3BlJywgJ3RhYmxlVmFsdWVzJywgJ3R5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZmVGdW5jUjogWydhbXBsaXR1ZGUnLCAnZXhwb25lbnQnLCAnaWQnLCAnaW50ZXJjZXB0JywgJ29mZnNldCcsICdzbG9wZScsICd0YWJsZVZhbHVlcycsICd0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGZlR2F1c3NpYW5CbHVyOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdpbicsICdyZXN1bHQnLCAnc3RkRGV2aWF0aW9uJywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZUltYWdlOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ3ByZXNlcnZlQXNwZWN0UmF0aW8nLCAncmVzdWx0JywgJ3N0eWxlJywgJ3dpZHRoJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBmZU1lcmdlOiBbJ2NsYXNzJywgJ2hlaWdodCcsICdpZCcsICdyZXN1bHQnLCAnc3R5bGUnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGZlTWVyZ2VOb2RlOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGZlTW9ycGhvbG9neTogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAnb3BlcmF0b3InLCAncmFkaXVzJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVPZmZzZXQ6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVQb2ludExpZ2h0OiBbJ2lkJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAneiddLFxuICAgIGZlU3BlY3VsYXJMaWdodGluZzogWydjbGFzcycsICdoZWlnaHQnLCAnaWQnLCAnaW4nLCAna2VybmVsVW5pdExlbmd0aCcsICdyZXN1bHQnLCAnc3BlY3VsYXJDb25zdGFudCcsICdzcGVjdWxhckV4cG9uZW50JywgJ3N0eWxlJywgJ3N1cmZhY2VTY2FsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVTcG90TGlnaHQ6IFsnaWQnLCAnbGltaXRpbmdDb25lQW5nbGUnLCAncG9pbnRzQXRYJywgJ3BvaW50c0F0WScsICdwb2ludHNBdFonLCAnc3BlY3VsYXJFeHBvbmVudCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5JywgJ3onXSxcbiAgICBmZVRpbGU6IFsnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ2luJywgJ3Jlc3VsdCcsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmVUdXJidWxlbmNlOiBbJ2Jhc2VGcmVxdWVuY3knLCAnY2xhc3MnLCAnaGVpZ2h0JywgJ2lkJywgJ251bU9jdGF2ZXMnLCAncmVzdWx0JywgJ3NlZWQnLCAnc3RpdGNoVGlsZXMnLCAnc3R5bGUnLCAndHlwZScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZmlsdGVyOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsdGVyUmVzJywgJ2ZpbHRlclVuaXRzJywgJ2hlaWdodCcsICdpZCcsICdwcmltaXRpdmVVbml0cycsICdzdHlsZScsICd3aWR0aCcsICd4JywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZm9udDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hvcml6LWFkdi14JywgJ2hvcml6LW9yaWdpbi14JywgJ2hvcml6LW9yaWdpbi15JywgJ2lkJywgJ3N0eWxlJywgJ3ZlcnQtYWR2LXknLCAndmVydC1vcmlnaW4teCcsICd2ZXJ0LW9yaWdpbi15JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdmb250LWZhY2UnOiBbJ2FjY2VudC1oZWlnaHQnLCAnYWxwaGFiZXRpYycsICdhc2NlbnQnLCAnYmJveCcsICdjYXAtaGVpZ2h0JywgJ2Rlc2NlbnQnLCAnZm9udC1mYW1pbHknLCAnZm9udC1zaXplJywgJ2ZvbnQtc3RyZXRjaCcsICdmb250LXN0eWxlJywgJ2ZvbnQtdmFyaWFudCcsICdmb250LXdlaWdodCcsICdoYW5naW5nJywgJ2lkJywgJ2lkZW9ncmFwaGljJywgJ21hdGhlbWF0aWNhbCcsICdvdmVybGluZS1wb3NpdGlvbicsICdvdmVybGluZS10aGlja25lc3MnLCAncGFub3NlLTEnLCAnc2xvcGUnLCAnc3RlbWgnLCAnc3RlbXYnLCAnc3RyaWtldGhyb3VnaC1wb3NpdGlvbicsICdzdHJpa2V0aHJvdWdoLXRoaWNrbmVzcycsICd1bmRlcmxpbmUtcG9zaXRpb24nLCAndW5kZXJsaW5lLXRoaWNrbmVzcycsICd1bmljb2RlLXJhbmdlJywgJ3VuaXRzLXBlci1lbScsICd2LWFscGhhYmV0aWMnLCAndi1oYW5naW5nJywgJ3YtaWRlb2dyYXBoaWMnLCAndi1tYXRoZW1hdGljYWwnLCAnd2lkdGhzJywgJ3gtaGVpZ2h0JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdmb250LWZhY2UtZm9ybWF0JzogWydpZCcsICdzdHJpbmcnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgJ2ZvbnQtZmFjZS1uYW1lJzogWydpZCcsICduYW1lJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdmb250LWZhY2Utc3JjJzogWydpZCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICAnZm9udC1mYWNlLXVyaSc6IFsnaWQnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZm9yZWlnbk9iamVjdDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2hlaWdodCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd3aWR0aCcsICd4JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZScsICd5J10sXG4gICAgZzogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGdseXBoOiBbJ2FyYWJpYy1mb3JtJywgJ2NsYXNzJywgJ2QnLCAnZ2x5cGgtbmFtZScsICdob3Jpei1hZHYteCcsICdpZCcsICdsYW5nJywgJ29yaWVudGF0aW9uJywgJ3N0eWxlJywgJ3VuaWNvZGUnLCAndmVydC1hZHYteScsICd2ZXJ0LW9yaWdpbi14JywgJ3ZlcnQtb3JpZ2luLXknLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgZ2x5cGhSZWY6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZm9ybWF0JywgJ2dseXBoUmVmJywgJ2lkJywgJ3N0eWxlJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBoa2VybjogWydnMScsICdnMicsICdpZCcsICdrJywgJ3UxJywgJ3UyJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIGltYWdlOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIGxpbmU6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4MScsICd4MicsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneTEnLCAneTInXSxcbiAgICBsaW5lYXJHcmFkaWVudDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2dyYWRpZW50VHJhbnNmb3JtJywgJ2dyYWRpZW50VW5pdHMnLCAnaWQnLCAnc3ByZWFkTWV0aG9kJywgJ3N0eWxlJywgJ3gxJywgJ3gyJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3kxJywgJ3kyJ10sXG4gICAgbWFya2VyOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnbWFya2VySGVpZ2h0JywgJ21hcmtlclVuaXRzJywgJ21hcmtlcldpZHRoJywgJ29yaWVudCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3JlZlgnLCAncmVmWScsICdzdHlsZScsICd2aWV3Qm94JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIG1hc2s6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnbWFza0NvbnRlbnRVbml0cycsICdtYXNrVW5pdHMnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIG1ldGFkYXRhOiBbJ2lkJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgICdtaXNzaW5nLWdseXBoJzogWydjbGFzcycsICdkJywgJ2hvcml6LWFkdi14JywgJ2lkJywgJ3N0eWxlJywgJ3ZlcnQtYWR2LXknLCAndmVydC1vcmlnaW4teCcsICd2ZXJ0LW9yaWdpbi15JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIG1wYXRoOiBbJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgcGF0aDogWydjbGFzcycsICdkJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwYXRoTGVuZ3RoJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3N0eWxlJywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RyYW5zZm9ybScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnXSxcbiAgICBwYXR0ZXJuOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaGVpZ2h0JywgJ2lkJywgJ3BhdHRlcm5Db250ZW50VW5pdHMnLCAncGF0dGVyblRyYW5zZm9ybScsICdwYXR0ZXJuVW5pdHMnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd2aWV3Qm94JywgJ3dpZHRoJywgJ3gnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICBwb2x5Z29uOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwb2ludHMnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHBvbHlsaW5lOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdwb2ludHMnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHJhZGlhbEdyYWRpZW50OiBbJ2NsYXNzJywgJ2N4JywgJ2N5JywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZngnLCAnZnknLCAnZ3JhZGllbnRUcmFuc2Zvcm0nLCAnZ3JhZGllbnRVbml0cycsICdpZCcsICdyJywgJ3NwcmVhZE1ldGhvZCcsICdzdHlsZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHJlY3Q6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyeCcsICdyeScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAnd2lkdGgnLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHNjcmlwdDogWydleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ3R5cGUnLCAneGxpbms6YWN0dWF0ZScsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazpzaG93JywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgc2V0OiBbJ2F0dHJpYnV0ZU5hbWUnLCAnYXR0cmlidXRlVHlwZScsICdiZWdpbicsICdkdXInLCAnZW5kJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnZmlsbCcsICdpZCcsICdtYXgnLCAnbWluJywgJ29uYmVnaW4nLCAnb25lbmQnLCAnb25sb2FkJywgJ29ucmVwZWF0JywgJ3JlcGVhdENvdW50JywgJ3JlcGVhdER1cicsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyZXN0YXJ0JywgJ3N5c3RlbUxhbmd1YWdlJywgJ3RvJywgJ3hsaW5rOmFjdHVhdGUnLCAneGxpbms6YXJjcm9sZScsICd4bGluazpocmVmJywgJ3hsaW5rOnJvbGUnLCAneGxpbms6c2hvdycsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHN0b3A6IFsnY2xhc3MnLCAnaWQnLCAnb2Zmc2V0JywgJ3N0eWxlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHN0eWxlOiBbJ2lkJywgJ21lZGlhJywgJ3RpdGxlJywgJ3R5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ10sXG4gICAgc3ZnOiBbJ2Jhc2VQcm9maWxlJywgJ2NsYXNzJywgJ2NvbnRlbnRTY3JpcHRUeXBlJywgJ2NvbnRlbnRTdHlsZVR5cGUnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hYm9ydCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25lcnJvcicsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAnb25yZXNpemUnLCAnb25zY3JvbGwnLCAnb251bmxvYWQnLCAnb256b29tJywgJ3ByZXNlcnZlQXNwZWN0UmF0aW8nLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndmVyc2lvbicsICd2aWV3Qm94JywgJ3dpZHRoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knLCAnem9vbUFuZFBhbiddLFxuICAgIHN3aXRjaDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncmVxdWlyZWRFeHRlbnNpb25zJywgJ3JlcXVpcmVkRmVhdHVyZXMnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndHJhbnNmb3JtJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHN5bWJvbDogWydjbGFzcycsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ29uYWN0aXZhdGUnLCAnb25jbGljaycsICdvbmZvY3VzaW4nLCAnb25mb2N1c291dCcsICdvbmxvYWQnLCAnb25tb3VzZWRvd24nLCAnb25tb3VzZW1vdmUnLCAnb25tb3VzZW91dCcsICdvbm1vdXNlb3ZlcicsICdvbm1vdXNldXAnLCAncHJlc2VydmVBc3BlY3RSYXRpbycsICdzdHlsZScsICd2aWV3Qm94JywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHRleHQ6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd0cmFuc2Zvcm0nLCAneCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHRleHRQYXRoOiBbJ2NsYXNzJywgJ2V4dGVybmFsUmVzb3VyY2VzUmVxdWlyZWQnLCAnaWQnLCAnbGVuZ3RoQWRqdXN0JywgJ21ldGhvZCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3NwYWNpbmcnLCAnc3RhcnRPZmZzZXQnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd4bGluazphcmNyb2xlJywgJ3hsaW5rOmhyZWYnLCAneGxpbms6cm9sZScsICd4bGluazp0aXRsZScsICd4bGluazp0eXBlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHRpdGxlOiBbJ2NsYXNzJywgJ2lkJywgJ3N0eWxlJywgJ3htbDpiYXNlJywgJ3htbDpsYW5nJywgJ3htbDpzcGFjZSddLFxuICAgIHRyZWY6IFsnY2xhc3MnLCAnZHgnLCAnZHknLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdsZW5ndGhBZGp1c3QnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdyb3RhdGUnLCAnc3R5bGUnLCAnc3lzdGVtTGFuZ3VhZ2UnLCAndGV4dExlbmd0aCcsICd4JywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnRpdGxlJywgJ3hsaW5rOnR5cGUnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICB0c3BhbjogWydjbGFzcycsICdkeCcsICdkeScsICdleHRlcm5hbFJlc291cmNlc1JlcXVpcmVkJywgJ2lkJywgJ2xlbmd0aEFkanVzdCcsICdvbmFjdGl2YXRlJywgJ29uY2xpY2snLCAnb25mb2N1c2luJywgJ29uZm9jdXNvdXQnLCAnb25sb2FkJywgJ29ubW91c2Vkb3duJywgJ29ubW91c2Vtb3ZlJywgJ29ubW91c2VvdXQnLCAnb25tb3VzZW92ZXInLCAnb25tb3VzZXVwJywgJ3JlcXVpcmVkRXh0ZW5zaW9ucycsICdyZXF1aXJlZEZlYXR1cmVzJywgJ3JvdGF0ZScsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0ZXh0TGVuZ3RoJywgJ3gnLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJywgJ3knXSxcbiAgICB1c2U6IFsnY2xhc3MnLCAnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdoZWlnaHQnLCAnaWQnLCAnb25hY3RpdmF0ZScsICdvbmNsaWNrJywgJ29uZm9jdXNpbicsICdvbmZvY3Vzb3V0JywgJ29ubG9hZCcsICdvbm1vdXNlZG93bicsICdvbm1vdXNlbW92ZScsICdvbm1vdXNlb3V0JywgJ29ubW91c2VvdmVyJywgJ29ubW91c2V1cCcsICdyZXF1aXJlZEV4dGVuc2lvbnMnLCAncmVxdWlyZWRGZWF0dXJlcycsICdzdHlsZScsICdzeXN0ZW1MYW5ndWFnZScsICd0cmFuc2Zvcm0nLCAnd2lkdGgnLCAneCcsICd4bGluazphY3R1YXRlJywgJ3hsaW5rOmFyY3JvbGUnLCAneGxpbms6aHJlZicsICd4bGluazpyb2xlJywgJ3hsaW5rOnNob3cnLCAneGxpbms6dGl0bGUnLCAneGxpbms6dHlwZScsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAneSddLFxuICAgIHZpZXc6IFsnZXh0ZXJuYWxSZXNvdXJjZXNSZXF1aXJlZCcsICdpZCcsICdwcmVzZXJ2ZUFzcGVjdFJhdGlvJywgJ3ZpZXdCb3gnLCAndmlld1RhcmdldCcsICd4bWw6YmFzZScsICd4bWw6bGFuZycsICd4bWw6c3BhY2UnLCAnem9vbUFuZFBhbiddLFxuICAgIHZrZXJuOiBbJ2cxJywgJ2cyJywgJ2lkJywgJ2snLCAndTEnLCAndTInLCAneG1sOmJhc2UnLCAneG1sOmxhbmcnLCAneG1sOnNwYWNlJ11cbiAgfTtcblxuXG4gIHN2Z1ByZXNlbnRhdGlvbkVsZW1lbnRzID0ge1xuICAgICdhJzogdHJ1ZSxcbiAgICAnYWx0R2x5cGgnOiB0cnVlLFxuICAgICdhbmltYXRlJzogdHJ1ZSxcbiAgICAnYW5pbWF0ZUNvbG9yJzogdHJ1ZSxcbiAgICAnY2lyY2xlJzogdHJ1ZSxcbiAgICAnY2xpcFBhdGgnOiB0cnVlLFxuICAgICdkZWZzJzogdHJ1ZSxcbiAgICAnZWxsaXBzZSc6IHRydWUsXG4gICAgJ2ZlQmxlbmQnOiB0cnVlLFxuICAgICdmZUNvbG9yTWF0cml4JzogdHJ1ZSxcbiAgICAnZmVDb21wb25lbnRUcmFuc2Zlcic6IHRydWUsXG4gICAgJ2ZlQ29tcG9zaXRlJzogdHJ1ZSxcbiAgICAnZmVDb252b2x2ZU1hdHJpeCc6IHRydWUsXG4gICAgJ2ZlRGlmZnVzZUxpZ2h0aW5nJzogdHJ1ZSxcbiAgICAnZmVEaXNwbGFjZW1lbnRNYXAnOiB0cnVlLFxuICAgICdmZUZsb29kJzogdHJ1ZSxcbiAgICAnZmVHYXVzc2lhbkJsdXInOiB0cnVlLFxuICAgICdmZUltYWdlJzogdHJ1ZSxcbiAgICAnZmVNZXJnZSc6IHRydWUsXG4gICAgJ2ZlTW9ycGhvbG9neSc6IHRydWUsXG4gICAgJ2ZlT2Zmc2V0JzogdHJ1ZSxcbiAgICAnZmVTcGVjdWxhckxpZ2h0aW5nJzogdHJ1ZSxcbiAgICAnZmVUaWxlJzogdHJ1ZSxcbiAgICAnZmVUdXJidWxlbmNlJzogdHJ1ZSxcbiAgICAnZmlsdGVyJzogdHJ1ZSxcbiAgICAnZm9udCc6IHRydWUsXG4gICAgJ2ZvcmVpZ25PYmplY3QnOiB0cnVlLFxuICAgICdnJzogdHJ1ZSxcbiAgICAnZ2x5cGgnOiB0cnVlLFxuICAgICdnbHlwaFJlZic6IHRydWUsXG4gICAgJ2ltYWdlJzogdHJ1ZSxcbiAgICAnbGluZSc6IHRydWUsXG4gICAgJ2xpbmVhckdyYWRpZW50JzogdHJ1ZSxcbiAgICAnbWFya2VyJzogdHJ1ZSxcbiAgICAnbWFzayc6IHRydWUsXG4gICAgJ21pc3NpbmctZ2x5cGgnOiB0cnVlLFxuICAgICdwYXRoJzogdHJ1ZSxcbiAgICAncGF0dGVybic6IHRydWUsXG4gICAgJ3BvbHlnb24nOiB0cnVlLFxuICAgICdwb2x5bGluZSc6IHRydWUsXG4gICAgJ3JhZGlhbEdyYWRpZW50JzogdHJ1ZSxcbiAgICAncmVjdCc6IHRydWUsXG4gICAgJ3N0b3AnOiB0cnVlLFxuICAgICdzdmcnOiB0cnVlLFxuICAgICdzd2l0Y2gnOiB0cnVlLFxuICAgICdzeW1ib2wnOiB0cnVlLFxuICAgICd0ZXh0JzogdHJ1ZSxcbiAgICAndGV4dFBhdGgnOiB0cnVlLFxuICAgICd0cmVmJzogdHJ1ZSxcbiAgICAndHNwYW4nOiB0cnVlLFxuICAgICd1c2UnOiB0cnVlXG4gIH07XG5cbiAgc3ZnUHJlc2VudGF0aW9uQXR0cmlidXRlcyA9IHtcbiAgICAnYWxpZ25tZW50LWJhc2VsaW5lJzogdHJ1ZSxcbiAgICAnYmFzZWxpbmUtc2hpZnQnOiB0cnVlLFxuICAgICdjbGlwLXBhdGgnOiB0cnVlLFxuICAgICdjbGlwLXJ1bGUnOiB0cnVlLFxuICAgICdjbGlwJzogdHJ1ZSxcbiAgICAnY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzJzogdHJ1ZSxcbiAgICAnY29sb3ItaW50ZXJwb2xhdGlvbic6IHRydWUsXG4gICAgJ2NvbG9yLXByb2ZpbGUnOiB0cnVlLFxuICAgICdjb2xvci1yZW5kZXJpbmcnOiB0cnVlLFxuICAgICdjb2xvcic6IHRydWUsXG4gICAgJ2N1cnNvcic6IHRydWUsXG4gICAgJ2RpcmVjdGlvbic6IHRydWUsXG4gICAgJ2Rpc3BsYXknOiB0cnVlLFxuICAgICdkb21pbmFudC1iYXNlbGluZSc6IHRydWUsXG4gICAgJ2VuYWJsZS1iYWNrZ3JvdW5kJzogdHJ1ZSxcbiAgICAnZmlsbC1vcGFjaXR5JzogdHJ1ZSxcbiAgICAnZmlsbC1ydWxlJzogdHJ1ZSxcbiAgICAnZmlsbCc6IHRydWUsXG4gICAgJ2ZpbHRlcic6IHRydWUsXG4gICAgJ2Zsb29kLWNvbG9yJzogdHJ1ZSxcbiAgICAnZmxvb2Qtb3BhY2l0eSc6IHRydWUsXG4gICAgJ2ZvbnQtZmFtaWx5JzogdHJ1ZSxcbiAgICAnZm9udC1zaXplLWFkanVzdCc6IHRydWUsXG4gICAgJ2ZvbnQtc2l6ZSc6IHRydWUsXG4gICAgJ2ZvbnQtc3RyZXRjaCc6IHRydWUsXG4gICAgJ2ZvbnQtc3R5bGUnOiB0cnVlLFxuICAgICdmb250LXZhcmlhbnQnOiB0cnVlLFxuICAgICdmb250LXdlaWdodCc6IHRydWUsXG4gICAgJ2dseXBoLW9yaWVudGF0aW9uLWhvcml6b250YWwnOiB0cnVlLFxuICAgICdnbHlwaC1vcmllbnRhdGlvbi12ZXJ0aWNhbCc6IHRydWUsXG4gICAgJ2ltYWdlLXJlbmRlcmluZyc6IHRydWUsXG4gICAgJ2tlcm5pbmcnOiB0cnVlLFxuICAgICdsZXR0ZXItc3BhY2luZyc6IHRydWUsXG4gICAgJ2xpZ2h0aW5nLWNvbG9yJzogdHJ1ZSxcbiAgICAnbWFya2VyLWVuZCc6IHRydWUsXG4gICAgJ21hcmtlci1taWQnOiB0cnVlLFxuICAgICdtYXJrZXItc3RhcnQnOiB0cnVlLFxuICAgICdtYXNrJzogdHJ1ZSxcbiAgICAnb3BhY2l0eSc6IHRydWUsXG4gICAgJ292ZXJmbG93JzogdHJ1ZSxcbiAgICAncG9pbnRlci1ldmVudHMnOiB0cnVlLFxuICAgICdzaGFwZS1yZW5kZXJpbmcnOiB0cnVlLFxuICAgICdzdG9wLWNvbG9yJzogdHJ1ZSxcbiAgICAnc3RvcC1vcGFjaXR5JzogdHJ1ZSxcbiAgICAnc3Ryb2tlLWRhc2hhcnJheSc6IHRydWUsXG4gICAgJ3N0cm9rZS1kYXNob2Zmc2V0JzogdHJ1ZSxcbiAgICAnc3Ryb2tlLWxpbmVjYXAnOiB0cnVlLFxuICAgICdzdHJva2UtbGluZWpvaW4nOiB0cnVlLFxuICAgICdzdHJva2UtbWl0ZXJsaW1pdCc6IHRydWUsXG4gICAgJ3N0cm9rZS1vcGFjaXR5JzogdHJ1ZSxcbiAgICAnc3Ryb2tlLXdpZHRoJzogdHJ1ZSxcbiAgICAnc3Ryb2tlJzogdHJ1ZSxcbiAgICAndGV4dC1hbmNob3InOiB0cnVlLFxuICAgICd0ZXh0LWRlY29yYXRpb24nOiB0cnVlLFxuICAgICd0ZXh0LXJlbmRlcmluZyc6IHRydWUsXG4gICAgJ3VuaWNvZGUtYmlkaSc6IHRydWUsXG4gICAgJ3Zpc2liaWxpdHknOiB0cnVlLFxuICAgICd3b3JkLXNwYWNpbmcnOiB0cnVlLFxuICAgICd3cml0aW5nLW1vZGUnOiB0cnVlXG4gIH07XG5cbiAgdmFyIGNyZWF0ZUVsZW1lbnQgPSBmdW5jdGlvbiBjcmVhdGVFbGVtZW50KGh0bWwpIHtcbiAgICB2YXIgZGl2ID0gRE9NLmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGRpdi5pbm5lckhUTUwgPSBodG1sO1xuICAgIHJldHVybiBkaXYuZmlyc3RDaGlsZDtcbiAgfTtcblxuICBzdmdBbmFseXplciA9IGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBTVkdBbmFseXplcigpIHtcbiAgICAgIFxuXG4gICAgICBpZiAoY3JlYXRlRWxlbWVudCgnPHN2Zz48YWx0R2x5cGggLz48L3N2Zz4nKS5maXJzdEVsZW1lbnRDaGlsZC5ub2RlTmFtZSA9PT0gJ2FsdGdseXBoJyAmJiBlbGVtZW50cy5hbHRHbHlwaCkge1xuICAgICAgICBlbGVtZW50cy5hbHRnbHlwaCA9IGVsZW1lbnRzLmFsdEdseXBoO1xuICAgICAgICBkZWxldGUgZWxlbWVudHMuYWx0R2x5cGg7XG4gICAgICAgIGVsZW1lbnRzLmFsdGdseXBoZGVmID0gZWxlbWVudHMuYWx0R2x5cGhEZWY7XG4gICAgICAgIGRlbGV0ZSBlbGVtZW50cy5hbHRHbHlwaERlZjtcbiAgICAgICAgZWxlbWVudHMuYWx0Z2x5cGhpdGVtID0gZWxlbWVudHMuYWx0R2x5cGhJdGVtO1xuICAgICAgICBkZWxldGUgZWxlbWVudHMuYWx0R2x5cGhJdGVtO1xuICAgICAgICBlbGVtZW50cy5nbHlwaHJlZiA9IGVsZW1lbnRzLmdseXBoUmVmO1xuICAgICAgICBkZWxldGUgZWxlbWVudHMuZ2x5cGhSZWY7XG4gICAgICB9XG4gICAgfVxuXG4gICAgU1ZHQW5hbHl6ZXIucHJvdG90eXBlLmlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUgPSBmdW5jdGlvbiBpc1N0YW5kYXJkU3ZnQXR0cmlidXRlKG5vZGVOYW1lLCBhdHRyaWJ1dGVOYW1lKSB7XG4gICAgICByZXR1cm4gcHJlc2VudGF0aW9uRWxlbWVudHNbbm9kZU5hbWVdICYmIHByZXNlbnRhdGlvbkF0dHJpYnV0ZXNbYXR0cmlidXRlTmFtZV0gfHwgZWxlbWVudHNbbm9kZU5hbWVdICYmIGVsZW1lbnRzW25vZGVOYW1lXS5pbmRleE9mKGF0dHJpYnV0ZU5hbWUpICE9PSAtMTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIFNWR0FuYWx5emVyO1xuICB9KCk7XG59XG5cbmV4cG9ydCB2YXIgZWxlbWVudHMgPSBzdmdFbGVtZW50cztcbmV4cG9ydCB2YXIgcHJlc2VudGF0aW9uRWxlbWVudHMgPSBzdmdQcmVzZW50YXRpb25FbGVtZW50cztcbmV4cG9ydCB2YXIgcHJlc2VudGF0aW9uQXR0cmlidXRlcyA9IHN2Z1ByZXNlbnRhdGlvbkF0dHJpYnV0ZXM7XG5leHBvcnQgdmFyIFNWR0FuYWx5emVyID0gc3ZnQW5hbHl6ZXIgfHwgZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBfY2xhc3MxMSgpIHtcbiAgICBcbiAgfVxuXG4gIF9jbGFzczExLnByb3RvdHlwZS5pc1N0YW5kYXJkU3ZnQXR0cmlidXRlID0gZnVuY3Rpb24gaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZSgpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIF9jbGFzczExO1xufSgpO1xuXG5leHBvcnQgdmFyIE9ic2VydmVyTG9jYXRvciA9IChfdGVtcCA9IF9jbGFzczEyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBPYnNlcnZlckxvY2F0b3IodGFza1F1ZXVlLCBldmVudE1hbmFnZXIsIGRpcnR5Q2hlY2tlciwgc3ZnQW5hbHl6ZXIsIHBhcnNlcikge1xuICAgIFxuXG4gICAgdGhpcy50YXNrUXVldWUgPSB0YXNrUXVldWU7XG4gICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XG4gICAgdGhpcy5kaXJ0eUNoZWNrZXIgPSBkaXJ0eUNoZWNrZXI7XG4gICAgdGhpcy5zdmdBbmFseXplciA9IHN2Z0FuYWx5emVyO1xuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xuXG4gICAgdGhpcy5hZGFwdGVycyA9IFtdO1xuICAgIHRoaXMubG9nZ2VyID0gTG9nTWFuYWdlci5nZXRMb2dnZXIoJ29ic2VydmVyLWxvY2F0b3InKTtcbiAgfVxuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSkge1xuICAgIHZhciBvYnNlcnZlcnNMb29rdXAgPSBvYmouX19vYnNlcnZlcnNfXztcbiAgICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG5cbiAgICBpZiAob2JzZXJ2ZXJzTG9va3VwICYmIHByb3BlcnR5TmFtZSBpbiBvYnNlcnZlcnNMb29rdXApIHtcbiAgICAgIHJldHVybiBvYnNlcnZlcnNMb29rdXBbcHJvcGVydHlOYW1lXTtcbiAgICB9XG5cbiAgICBvYnNlcnZlciA9IHRoaXMuY3JlYXRlUHJvcGVydHlPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSk7XG5cbiAgICBpZiAoIW9ic2VydmVyLmRvTm90Q2FjaGUpIHtcbiAgICAgIGlmIChvYnNlcnZlcnNMb29rdXAgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBvYnNlcnZlcnNMb29rdXAgPSB0aGlzLmdldE9yQ3JlYXRlT2JzZXJ2ZXJzTG9va3VwKG9iaik7XG4gICAgICB9XG5cbiAgICAgIG9ic2VydmVyc0xvb2t1cFtwcm9wZXJ0eU5hbWVdID0gb2JzZXJ2ZXI7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9ic2VydmVyO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0T3JDcmVhdGVPYnNlcnZlcnNMb29rdXAgPSBmdW5jdGlvbiBnZXRPckNyZWF0ZU9ic2VydmVyc0xvb2t1cChvYmopIHtcbiAgICByZXR1cm4gb2JqLl9fb2JzZXJ2ZXJzX18gfHwgdGhpcy5jcmVhdGVPYnNlcnZlcnNMb29rdXAob2JqKTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmNyZWF0ZU9ic2VydmVyc0xvb2t1cCA9IGZ1bmN0aW9uIGNyZWF0ZU9ic2VydmVyc0xvb2t1cChvYmopIHtcbiAgICB2YXIgdmFsdWUgPSB7fTtcblxuICAgIGlmICghUmVmbGVjdC5kZWZpbmVQcm9wZXJ0eShvYmosICdfX29ic2VydmVyc19fJywge1xuICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICBjb25maWd1cmFibGU6IGZhbHNlLFxuICAgICAgd3JpdGFibGU6IGZhbHNlLFxuICAgICAgdmFsdWU6IHZhbHVlXG4gICAgfSkpIHtcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ0Nhbm5vdCBhZGQgb2JzZXJ2ZXJzIHRvIG9iamVjdCcsIG9iaik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuYWRkQWRhcHRlciA9IGZ1bmN0aW9uIGFkZEFkYXB0ZXIoYWRhcHRlcikge1xuICAgIHRoaXMuYWRhcHRlcnMucHVzaChhZGFwdGVyKTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldEFkYXB0ZXJPYnNlcnZlciA9IGZ1bmN0aW9uIGdldEFkYXB0ZXJPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvcikge1xuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHRoaXMuYWRhcHRlcnMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xuICAgICAgdmFyIGFkYXB0ZXIgPSB0aGlzLmFkYXB0ZXJzW2ldO1xuICAgICAgdmFyIG9ic2VydmVyID0gYWRhcHRlci5nZXRPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvcik7XG4gICAgICBpZiAob2JzZXJ2ZXIpIHtcbiAgICAgICAgcmV0dXJuIG9ic2VydmVyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmNyZWF0ZVByb3BlcnR5T2JzZXJ2ZXIgPSBmdW5jdGlvbiBjcmVhdGVQcm9wZXJ0eU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgdmFyIGRlc2NyaXB0b3IgPSB2b2lkIDA7XG4gICAgdmFyIGhhbmRsZXIgPSB2b2lkIDA7XG4gICAgdmFyIHhsaW5rUmVzdWx0ID0gdm9pZCAwO1xuXG4gICAgaWYgKCEob2JqIGluc3RhbmNlb2YgT2JqZWN0KSkge1xuICAgICAgcmV0dXJuIG5ldyBQcmltaXRpdmVPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSk7XG4gICAgfVxuXG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIERPTS5FbGVtZW50KSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnY2xhc3MnKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ2xhc3NPYnNlcnZlcihvYmopO1xuICAgICAgfVxuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3N0eWxlJyB8fCBwcm9wZXJ0eU5hbWUgPT09ICdjc3MnKSB7XG4gICAgICAgIHJldHVybiBuZXcgU3R5bGVPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSk7XG4gICAgICB9XG4gICAgICBoYW5kbGVyID0gdGhpcy5ldmVudE1hbmFnZXIuZ2V0RWxlbWVudEhhbmRsZXIob2JqLCBwcm9wZXJ0eU5hbWUpO1xuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3ZhbHVlJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0Jykge1xuICAgICAgICByZXR1cm4gbmV3IFNlbGVjdFZhbHVlT2JzZXJ2ZXIob2JqLCBoYW5kbGVyLCB0aGlzKTtcbiAgICAgIH1cbiAgICAgIGlmIChwcm9wZXJ0eU5hbWUgPT09ICdjaGVja2VkJyAmJiBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnaW5wdXQnKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ2hlY2tlZE9ic2VydmVyKG9iaiwgaGFuZGxlciwgdGhpcyk7XG4gICAgICB9XG4gICAgICBpZiAoaGFuZGxlcikge1xuICAgICAgICByZXR1cm4gbmV3IFZhbHVlQXR0cmlidXRlT2JzZXJ2ZXIob2JqLCBwcm9wZXJ0eU5hbWUsIGhhbmRsZXIpO1xuICAgICAgfVxuICAgICAgeGxpbmtSZXN1bHQgPSAvXnhsaW5rOiguKykkLy5leGVjKHByb3BlcnR5TmFtZSk7XG4gICAgICBpZiAoeGxpbmtSZXN1bHQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBYTGlua0F0dHJpYnV0ZU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCB4bGlua1Jlc3VsdFsxXSk7XG4gICAgICB9XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAncm9sZScgJiYgKG9iaiBpbnN0YW5jZW9mIERPTS5FbGVtZW50IHx8IG9iaiBpbnN0YW5jZW9mIERPTS5TVkdFbGVtZW50KSB8fCAvXlxcdys6fF5kYXRhLXxeYXJpYS0vLnRlc3QocHJvcGVydHlOYW1lKSB8fCBvYmogaW5zdGFuY2VvZiBET00uU1ZHRWxlbWVudCAmJiB0aGlzLnN2Z0FuYWx5emVyLmlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUob2JqLm5vZGVOYW1lLCBwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YUF0dHJpYnV0ZU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBkZXNjcmlwdG9yID0gT2JqZWN0LmdldFByb3BlcnR5RGVzY3JpcHRvcihvYmosIHByb3BlcnR5TmFtZSk7XG5cbiAgICBpZiAoaGFzRGVjbGFyZWREZXBlbmRlbmNpZXMoZGVzY3JpcHRvcikpIHtcbiAgICAgIHJldHVybiBjcmVhdGVDb21wdXRlZE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lLCBkZXNjcmlwdG9yLCB0aGlzKTtcbiAgICB9XG5cbiAgICBpZiAoZGVzY3JpcHRvcikge1xuICAgICAgdmFyIGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIgPSBkZXNjcmlwdG9yLmdldCB8fCBkZXNjcmlwdG9yLnNldDtcbiAgICAgIGlmIChleGlzdGluZ0dldHRlck9yU2V0dGVyKSB7XG4gICAgICAgIGlmIChleGlzdGluZ0dldHRlck9yU2V0dGVyLmdldE9ic2VydmVyKSB7XG4gICAgICAgICAgcmV0dXJuIGV4aXN0aW5nR2V0dGVyT3JTZXR0ZXIuZ2V0T2JzZXJ2ZXIob2JqKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBhZGFwdGVyT2JzZXJ2ZXIgPSB0aGlzLmdldEFkYXB0ZXJPYnNlcnZlcihvYmosIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvcik7XG4gICAgICAgIGlmIChhZGFwdGVyT2JzZXJ2ZXIpIHtcbiAgICAgICAgICByZXR1cm4gYWRhcHRlck9ic2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgRGlydHlDaGVja1Byb3BlcnR5KHRoaXMuZGlydHlDaGVja2VyLCBvYmosIHByb3BlcnR5TmFtZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnbGVuZ3RoJykge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBcnJheU9ic2VydmVyKG9iaikuZ2V0TGVuZ3RoT2JzZXJ2ZXIoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBEaXJ0eUNoZWNrUHJvcGVydHkodGhpcy5kaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIE1hcCkge1xuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3NpemUnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE1hcE9ic2VydmVyKG9iaikuZ2V0TGVuZ3RoT2JzZXJ2ZXIoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBEaXJ0eUNoZWNrUHJvcGVydHkodGhpcy5kaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3NpemUnKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldFNldE9ic2VydmVyKG9iaikuZ2V0TGVuZ3RoT2JzZXJ2ZXIoKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG5ldyBEaXJ0eUNoZWNrUHJvcGVydHkodGhpcy5kaXJ0eUNoZWNrZXIsIG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICB9XG5cbiAgICByZXR1cm4gbmV3IFNldHRlck9ic2VydmVyKHRoaXMudGFza1F1ZXVlLCBvYmosIHByb3BlcnR5TmFtZSk7XG4gIH07XG5cbiAgT2JzZXJ2ZXJMb2NhdG9yLnByb3RvdHlwZS5nZXRBY2Nlc3NvciA9IGZ1bmN0aW9uIGdldEFjY2Vzc29yKG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgaWYgKG9iaiBpbnN0YW5jZW9mIERPTS5FbGVtZW50KSB7XG4gICAgICBpZiAocHJvcGVydHlOYW1lID09PSAnY2xhc3MnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ3N0eWxlJyB8fCBwcm9wZXJ0eU5hbWUgPT09ICdjc3MnIHx8IHByb3BlcnR5TmFtZSA9PT0gJ3ZhbHVlJyAmJiAob2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyB8fCBvYmoudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09PSAnc2VsZWN0JykgfHwgcHJvcGVydHlOYW1lID09PSAnY2hlY2tlZCcgJiYgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyB8fCBwcm9wZXJ0eU5hbWUgPT09ICdtb2RlbCcgJiYgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2lucHV0JyB8fCAvXnhsaW5rOi4rJC8uZXhlYyhwcm9wZXJ0eU5hbWUpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgIH1cbiAgICAgIGlmICgvXlxcdys6fF5kYXRhLXxeYXJpYS0vLnRlc3QocHJvcGVydHlOYW1lKSB8fCBvYmogaW5zdGFuY2VvZiBET00uU1ZHRWxlbWVudCAmJiB0aGlzLnN2Z0FuYWx5emVyLmlzU3RhbmRhcmRTdmdBdHRyaWJ1dGUob2JqLm5vZGVOYW1lLCBwcm9wZXJ0eU5hbWUpIHx8IG9iai50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09ICdpbWcnICYmIHByb3BlcnR5TmFtZSA9PT0gJ3NyYycgfHwgb2JqLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2EnICYmIHByb3BlcnR5TmFtZSA9PT0gJ2hyZWYnKSB7XG4gICAgICAgIHJldHVybiBkYXRhQXR0cmlidXRlQWNjZXNzb3I7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwcm9wZXJ0eUFjY2Vzc29yO1xuICB9O1xuXG4gIE9ic2VydmVyTG9jYXRvci5wcm90b3R5cGUuZ2V0QXJyYXlPYnNlcnZlciA9IGZ1bmN0aW9uIGdldEFycmF5T2JzZXJ2ZXIoYXJyYXkpIHtcbiAgICByZXR1cm4gX2dldEFycmF5T2JzZXJ2ZXIodGhpcy50YXNrUXVldWUsIGFycmF5KTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldE1hcE9ic2VydmVyID0gZnVuY3Rpb24gZ2V0TWFwT2JzZXJ2ZXIobWFwKSB7XG4gICAgcmV0dXJuIF9nZXRNYXBPYnNlcnZlcih0aGlzLnRhc2tRdWV1ZSwgbWFwKTtcbiAgfTtcblxuICBPYnNlcnZlckxvY2F0b3IucHJvdG90eXBlLmdldFNldE9ic2VydmVyID0gZnVuY3Rpb24gZ2V0U2V0T2JzZXJ2ZXIoc2V0KSB7XG4gICAgcmV0dXJuIF9nZXRTZXRPYnNlcnZlcih0aGlzLnRhc2tRdWV1ZSwgc2V0KTtcbiAgfTtcblxuICByZXR1cm4gT2JzZXJ2ZXJMb2NhdG9yO1xufSgpLCBfY2xhc3MxMi5pbmplY3QgPSBbVGFza1F1ZXVlLCBFdmVudE1hbmFnZXIsIERpcnR5Q2hlY2tlciwgU1ZHQW5hbHl6ZXIsIFBhcnNlcl0sIF90ZW1wKTtcblxuZXhwb3J0IHZhciBPYmplY3RPYnNlcnZhdGlvbkFkYXB0ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE9iamVjdE9ic2VydmF0aW9uQWRhcHRlcigpIHtcbiAgICBcbiAgfVxuXG4gIE9iamVjdE9ic2VydmF0aW9uQWRhcHRlci5wcm90b3R5cGUuZ2V0T2JzZXJ2ZXIgPSBmdW5jdGlvbiBnZXRPYnNlcnZlcihvYmplY3QsIHByb3BlcnR5TmFtZSwgZGVzY3JpcHRvcikge1xuICAgIHRocm93IG5ldyBFcnJvcignQmluZGluZ0FkYXB0ZXJzIG11c3QgaW1wbGVtZW50IGdldE9ic2VydmVyKG9iamVjdCwgcHJvcGVydHlOYW1lKS4nKTtcbiAgfTtcblxuICByZXR1cm4gT2JqZWN0T2JzZXJ2YXRpb25BZGFwdGVyO1xufSgpO1xuXG5leHBvcnQgdmFyIEJpbmRpbmdFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBzb3VyY2VFeHByZXNzaW9uLCBtb2RlLCBsb29rdXBGdW5jdGlvbnMsIGF0dHJpYnV0ZSkge1xuICAgIFxuXG4gICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy5tb2RlID0gbW9kZTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgICB0aGlzLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTtcbiAgICB0aGlzLmRpc2NyZXRlID0gZmFsc2U7XG4gIH1cblxuICBCaW5kaW5nRXhwcmVzc2lvbi5wcm90b3R5cGUuY3JlYXRlQmluZGluZyA9IGZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmcodGFyZ2V0KSB7XG4gICAgcmV0dXJuIG5ldyBCaW5kaW5nKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5tb2RlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRpbmdFeHByZXNzaW9uO1xufSgpO1xuXG5leHBvcnQgdmFyIEJpbmRpbmcgPSAoX2RlYzEwID0gY29ubmVjdGFibGUoKSwgX2RlYzEwKF9jbGFzczEzID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nKG9ic2VydmVyTG9jYXRvciwgc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSwgbW9kZSwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcbiAgICB0aGlzLm1vZGUgPSBtb2RlO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgQmluZGluZy5wcm90b3R5cGUudXBkYXRlVGFyZ2V0ID0gZnVuY3Rpb24gdXBkYXRlVGFyZ2V0KHZhbHVlKSB7XG4gICAgdGhpcy50YXJnZXRPYnNlcnZlci5zZXRWYWx1ZSh2YWx1ZSwgdGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHkpO1xuICB9O1xuXG4gIEJpbmRpbmcucHJvdG90eXBlLnVwZGF0ZVNvdXJjZSA9IGZ1bmN0aW9uIHVwZGF0ZVNvdXJjZSh2YWx1ZSkge1xuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5hc3NpZ24odGhpcy5zb3VyY2UsIHZhbHVlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIGNhbGwoY29udGV4dCwgbmV3VmFsdWUsIG9sZFZhbHVlKSB7XG4gICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQgPT09IHNvdXJjZUNvbnRleHQpIHtcbiAgICAgIG9sZFZhbHVlID0gdGhpcy50YXJnZXRPYnNlcnZlci5nZXRWYWx1ZSh0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XG4gICAgICBuZXdWYWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgaWYgKG5ld1ZhbHVlICE9PSBvbGRWYWx1ZSkge1xuICAgICAgICB0aGlzLnVwZGF0ZVRhcmdldChuZXdWYWx1ZSk7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5tb2RlICE9PSBiaW5kaW5nTW9kZS5vbmVUaW1lKSB7XG4gICAgICAgIHRoaXMuX3ZlcnNpb24rKztcbiAgICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xuICAgICAgICB0aGlzLnVub2JzZXJ2ZShmYWxzZSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0ID09PSB0YXJnZXRDb250ZXh0KSB7XG4gICAgICBpZiAobmV3VmFsdWUgIT09IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpKSB7XG4gICAgICAgIHRoaXMudXBkYXRlU291cmNlKG5ld1ZhbHVlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbmV4cGVjdGVkIGNhbGwgY29udGV4dCAnICsgY29udGV4dCk7XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoc291cmNlKSB7XG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcblxuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCkge1xuICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQodGhpcywgc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuXG4gICAgdmFyIG1vZGUgPSB0aGlzLm1vZGU7XG4gICAgaWYgKCF0aGlzLnRhcmdldE9ic2VydmVyKSB7XG4gICAgICB2YXIgbWV0aG9kID0gbW9kZSA9PT0gYmluZGluZ01vZGUudHdvV2F5IHx8IG1vZGUgPT09IGJpbmRpbmdNb2RlLmZyb21WaWV3ID8gJ2dldE9ic2VydmVyJyA6ICdnZXRBY2Nlc3Nvcic7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyID0gdGhpcy5vYnNlcnZlckxvY2F0b3JbbWV0aG9kXSh0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XG4gICAgfVxuXG4gICAgaWYgKCdiaW5kJyBpbiB0aGlzLnRhcmdldE9ic2VydmVyKSB7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLmJpbmQoKTtcbiAgICB9XG4gICAgaWYgKHRoaXMubW9kZSAhPT0gYmluZGluZ01vZGUuZnJvbVZpZXcpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZShzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICAgIHRoaXMudXBkYXRlVGFyZ2V0KHZhbHVlKTtcbiAgICB9XG5cbiAgICBpZiAobW9kZSA9PT0gYmluZGluZ01vZGUub25lVGltZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSBpZiAobW9kZSA9PT0gYmluZGluZ01vZGUudG9WaWV3KSB7XG4gICAgICBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QodGhpcyk7XG4gICAgfSBlbHNlIGlmIChtb2RlID09PSBiaW5kaW5nTW9kZS50d29XYXkpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5jb25uZWN0KHRoaXMsIHNvdXJjZSk7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnN1YnNjcmliZSh0YXJnZXRDb250ZXh0LCB0aGlzKTtcbiAgICB9IGVsc2UgaWYgKG1vZGUgPT09IGJpbmRpbmdNb2RlLmZyb21WaWV3KSB7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnN1YnNjcmliZSh0YXJnZXRDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIGlmICgndW5iaW5kJyBpbiB0aGlzLnRhcmdldE9ic2VydmVyKSB7XG4gICAgICB0aGlzLnRhcmdldE9ic2VydmVyLnVuYmluZCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy50YXJnZXRPYnNlcnZlci51bnN1YnNjcmliZSkge1xuICAgICAgdGhpcy50YXJnZXRPYnNlcnZlci51bnN1YnNjcmliZSh0YXJnZXRDb250ZXh0LCB0aGlzKTtcbiAgICB9XG4gICAgdGhpcy51bm9ic2VydmUodHJ1ZSk7XG4gIH07XG5cbiAgQmluZGluZy5wcm90b3R5cGUuY29ubmVjdCA9IGZ1bmN0aW9uIGNvbm5lY3QoZXZhbHVhdGUpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoZXZhbHVhdGUpIHtcbiAgICAgIHZhciB2YWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgICAgdGhpcy51cGRhdGVUYXJnZXQodmFsdWUpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNvdXJjZSk7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRpbmc7XG59KCkpIHx8IF9jbGFzczEzKTtcblxuZXhwb3J0IHZhciBDYWxsRXhwcmVzc2lvbiA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ2FsbEV4cHJlc3Npb24ob2JzZXJ2ZXJMb2NhdG9yLCB0YXJnZXRQcm9wZXJ0eSwgc291cmNlRXhwcmVzc2lvbiwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcbiAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIENhbGxFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gY3JlYXRlQmluZGluZyh0YXJnZXQpIHtcbiAgICByZXR1cm4gbmV3IENhbGwodGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gIH07XG5cbiAgcmV0dXJuIENhbGxFeHByZXNzaW9uO1xufSgpO1xuXG5leHBvcnQgdmFyIENhbGwgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIENhbGwob2JzZXJ2ZXJMb2NhdG9yLCBzb3VyY2VFeHByZXNzaW9uLCB0YXJnZXQsIHRhcmdldFByb3BlcnR5LCBsb29rdXBGdW5jdGlvbnMpIHtcbiAgICBcblxuICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XG4gICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IG9ic2VydmVyTG9jYXRvci5nZXRPYnNlcnZlcih0YXJnZXQsIHRhcmdldFByb3BlcnR5KTtcbiAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcbiAgfVxuXG4gIENhbGwucHJvdG90eXBlLmNhbGxTb3VyY2UgPSBmdW5jdGlvbiBjYWxsU291cmNlKCRldmVudCkge1xuICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSB0aGlzLnNvdXJjZS5vdmVycmlkZUNvbnRleHQ7XG4gICAgT2JqZWN0LmFzc2lnbihvdmVycmlkZUNvbnRleHQsICRldmVudCk7XG4gICAgb3ZlcnJpZGVDb250ZXh0LiRldmVudCA9ICRldmVudDtcbiAgICB2YXIgbXVzdEV2YWx1YXRlID0gdHJ1ZTtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKTtcbiAgICBkZWxldGUgb3ZlcnJpZGVDb250ZXh0LiRldmVudDtcbiAgICBmb3IgKHZhciBwcm9wIGluICRldmVudCkge1xuICAgICAgZGVsZXRlIG92ZXJyaWRlQ29udGV4dFtwcm9wXTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICBDYWxsLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICB2YXIgX3RoaXMyNiA9IHRoaXM7XG5cbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCh0aGlzLCBzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgdGhpcy50YXJnZXRQcm9wZXJ0eS5zZXRWYWx1ZShmdW5jdGlvbiAoJGV2ZW50KSB7XG4gICAgICByZXR1cm4gX3RoaXMyNi5jYWxsU291cmNlKCRldmVudCk7XG4gICAgfSk7XG4gIH07XG5cbiAgQ2FsbC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHRoaXMudGFyZ2V0UHJvcGVydHkuc2V0VmFsdWUobnVsbCk7XG4gIH07XG5cbiAgcmV0dXJuIENhbGw7XG59KCk7XG5cbmV4cG9ydCB2YXIgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZSA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZShuYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5jb252ZW50aW9uID0gZnVuY3Rpb24gY29udmVudGlvbihuYW1lKSB7XG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoJ1ZhbHVlQ29udmVydGVyJykpIHtcbiAgICAgIHJldHVybiBuZXcgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZShjYW1lbENhc2UobmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGggLSAxNCkpKTtcbiAgICB9XG4gIH07XG5cbiAgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uIGluaXRpYWxpemUoY29udGFpbmVyLCB0YXJnZXQpIHtcbiAgICB0aGlzLmluc3RhbmNlID0gY29udGFpbmVyLmdldCh0YXJnZXQpO1xuICB9O1xuXG4gIFZhbHVlQ29udmVydGVyUmVzb3VyY2UucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gcmVnaXN0ZXIocmVnaXN0cnksIG5hbWUpIHtcbiAgICByZWdpc3RyeS5yZWdpc3RlclZhbHVlQ29udmVydGVyKG5hbWUgfHwgdGhpcy5uYW1lLCB0aGlzLmluc3RhbmNlKTtcbiAgfTtcblxuICBWYWx1ZUNvbnZlcnRlclJlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gbG9hZChjb250YWluZXIsIHRhcmdldCkge307XG5cbiAgcmV0dXJuIFZhbHVlQ29udmVydGVyUmVzb3VyY2U7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWx1ZUNvbnZlcnRlcihuYW1lT3JUYXJnZXQpIHtcbiAgaWYgKG5hbWVPclRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBuYW1lT3JUYXJnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgbmV3IFZhbHVlQ29udmVydGVyUmVzb3VyY2UobmFtZU9yVGFyZ2V0KSwgdGFyZ2V0KTtcbiAgICB9O1xuICB9XG5cbiAgbWV0YWRhdGEuZGVmaW5lKG1ldGFkYXRhLnJlc291cmNlLCBuZXcgVmFsdWVDb252ZXJ0ZXJSZXNvdXJjZSgpLCBuYW1lT3JUYXJnZXQpO1xufVxuXG5leHBvcnQgdmFyIEJpbmRpbmdCZWhhdmlvclJlc291cmNlID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZShuYW1lKSB7XG4gICAgXG5cbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UuY29udmVudGlvbiA9IGZ1bmN0aW9uIGNvbnZlbnRpb24obmFtZSkge1xuICAgIGlmIChuYW1lLmVuZHNXaXRoKCdCaW5kaW5nQmVoYXZpb3InKSkge1xuICAgICAgcmV0dXJuIG5ldyBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZShjYW1lbENhc2UobmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGggLSAxNSkpKTtcbiAgICB9XG4gIH07XG5cbiAgQmluZGluZ0JlaGF2aW9yUmVzb3VyY2UucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKGNvbnRhaW5lciwgdGFyZ2V0KSB7XG4gICAgdGhpcy5pbnN0YW5jZSA9IGNvbnRhaW5lci5nZXQodGFyZ2V0KTtcbiAgfTtcblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiByZWdpc3RlcihyZWdpc3RyeSwgbmFtZSkge1xuICAgIHJlZ2lzdHJ5LnJlZ2lzdGVyQmluZGluZ0JlaGF2aW9yKG5hbWUgfHwgdGhpcy5uYW1lLCB0aGlzLmluc3RhbmNlKTtcbiAgfTtcblxuICBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZS5wcm90b3R5cGUubG9hZCA9IGZ1bmN0aW9uIGxvYWQoY29udGFpbmVyLCB0YXJnZXQpIHt9O1xuXG4gIHJldHVybiBCaW5kaW5nQmVoYXZpb3JSZXNvdXJjZTtcbn0oKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGJpbmRpbmdCZWhhdmlvcihuYW1lT3JUYXJnZXQpIHtcbiAgaWYgKG5hbWVPclRhcmdldCA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBuYW1lT3JUYXJnZXQgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQpIHtcbiAgICAgIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKG5hbWVPclRhcmdldCksIHRhcmdldCk7XG4gICAgfTtcbiAgfVxuXG4gIG1ldGFkYXRhLmRlZmluZShtZXRhZGF0YS5yZXNvdXJjZSwgbmV3IEJpbmRpbmdCZWhhdmlvclJlc291cmNlKCksIG5hbWVPclRhcmdldCk7XG59XG5cbmV4cG9ydCB2YXIgTGlzdGVuZXJFeHByZXNzaW9uID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBMaXN0ZW5lckV4cHJlc3Npb24oZXZlbnRNYW5hZ2VyLCB0YXJnZXRFdmVudCwgc291cmNlRXhwcmVzc2lvbiwgZGVsZWdhdGlvblN0cmF0ZWd5LCBwcmV2ZW50RGVmYXVsdCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGV2ZW50TWFuYWdlcjtcbiAgICB0aGlzLnRhcmdldEV2ZW50ID0gdGFyZ2V0RXZlbnQ7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLmRlbGVnYXRpb25TdHJhdGVneSA9IGRlbGVnYXRpb25TdHJhdGVneTtcbiAgICB0aGlzLmRpc2NyZXRlID0gdHJ1ZTtcbiAgICB0aGlzLnByZXZlbnREZWZhdWx0ID0gcHJldmVudERlZmF1bHQ7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBMaXN0ZW5lckV4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiBjcmVhdGVCaW5kaW5nKHRhcmdldCkge1xuICAgIHJldHVybiBuZXcgTGlzdGVuZXIodGhpcy5ldmVudE1hbmFnZXIsIHRoaXMudGFyZ2V0RXZlbnQsIHRoaXMuZGVsZWdhdGlvblN0cmF0ZWd5LCB0aGlzLnNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgdGhpcy5wcmV2ZW50RGVmYXVsdCwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIHJldHVybiBMaXN0ZW5lckV4cHJlc3Npb247XG59KCk7XG5cbmV4cG9ydCB2YXIgTGlzdGVuZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIExpc3RlbmVyKGV2ZW50TWFuYWdlciwgdGFyZ2V0RXZlbnQsIGRlbGVnYXRpb25TdHJhdGVneSwgc291cmNlRXhwcmVzc2lvbiwgdGFyZ2V0LCBwcmV2ZW50RGVmYXVsdCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLmV2ZW50TWFuYWdlciA9IGV2ZW50TWFuYWdlcjtcbiAgICB0aGlzLnRhcmdldEV2ZW50ID0gdGFyZ2V0RXZlbnQ7XG4gICAgdGhpcy5kZWxlZ2F0aW9uU3RyYXRlZ3kgPSBkZWxlZ2F0aW9uU3RyYXRlZ3k7XG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDtcbiAgICB0aGlzLnByZXZlbnREZWZhdWx0ID0gcHJldmVudERlZmF1bHQ7XG4gICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XG4gIH1cblxuICBMaXN0ZW5lci5wcm90b3R5cGUuY2FsbFNvdXJjZSA9IGZ1bmN0aW9uIGNhbGxTb3VyY2UoZXZlbnQpIHtcbiAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gdGhpcy5zb3VyY2Uub3ZlcnJpZGVDb250ZXh0O1xuICAgIG92ZXJyaWRlQ29udGV4dC4kZXZlbnQgPSBldmVudDtcbiAgICB2YXIgbXVzdEV2YWx1YXRlID0gdHJ1ZTtcbiAgICB2YXIgcmVzdWx0ID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucywgbXVzdEV2YWx1YXRlKTtcbiAgICBkZWxldGUgb3ZlcnJpZGVDb250ZXh0LiRldmVudDtcbiAgICBpZiAocmVzdWx0ICE9PSB0cnVlICYmIHRoaXMucHJldmVudERlZmF1bHQpIHtcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgTGlzdGVuZXIucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gaGFuZGxlRXZlbnQoZXZlbnQpIHtcbiAgICB0aGlzLmNhbGxTb3VyY2UoZXZlbnQpO1xuICB9O1xuXG4gIExpc3RlbmVyLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gYmluZChzb3VyY2UpIHtcbiAgICBpZiAodGhpcy5pc0JvdW5kKSB7XG4gICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICB0aGlzLnVuYmluZCgpO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xuICAgIHRoaXMuc291cmNlID0gc291cmNlO1xuXG4gICAgaWYgKHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYmluZCh0aGlzLCBzb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgICB9XG4gICAgdGhpcy5faGFuZGxlciA9IHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0RXZlbnQsIHRoaXMsIHRoaXMuZGVsZWdhdGlvblN0cmF0ZWd5LCB0cnVlKTtcbiAgfTtcblxuICBMaXN0ZW5lci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gdW5iaW5kKCkge1xuICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICAgIHRoaXMuX2hhbmRsZXIuZGlzcG9zZSgpO1xuICAgIHRoaXMuX2hhbmRsZXIgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBMaXN0ZW5lcjtcbn0oKTtcblxuZnVuY3Rpb24gZ2V0QVUoZWxlbWVudCkge1xuICB2YXIgYXUgPSBlbGVtZW50LmF1O1xuXG4gIGlmIChhdSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBBdXJlbGlhIEFQSXMgYXJlIGRlZmluZWQgZm9yIHRoZSBlbGVtZW50OiBcIicgKyBlbGVtZW50LnRhZ05hbWUgKyAnXCIuJyk7XG4gIH1cblxuICByZXR1cm4gYXU7XG59XG5cbmV4cG9ydCB2YXIgTmFtZUV4cHJlc3Npb24gPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIE5hbWVFeHByZXNzaW9uKHNvdXJjZUV4cHJlc3Npb24sIGFwaU5hbWUsIGxvb2t1cEZ1bmN0aW9ucykge1xuICAgIFxuXG4gICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcbiAgICB0aGlzLmFwaU5hbWUgPSBhcGlOYW1lO1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICAgIHRoaXMuZGlzY3JldGUgPSB0cnVlO1xuICB9XG5cbiAgTmFtZUV4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiBjcmVhdGVCaW5kaW5nKHRhcmdldCkge1xuICAgIHJldHVybiBuZXcgTmFtZUJpbmRlcih0aGlzLnNvdXJjZUV4cHJlc3Npb24sIE5hbWVFeHByZXNzaW9uLmxvY2F0ZUFQSSh0YXJnZXQsIHRoaXMuYXBpTmFtZSksIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBOYW1lRXhwcmVzc2lvbi5sb2NhdGVBUEkgPSBmdW5jdGlvbiBsb2NhdGVBUEkoZWxlbWVudCwgYXBpTmFtZSkge1xuICAgIHN3aXRjaCAoYXBpTmFtZSkge1xuICAgICAgY2FzZSAnZWxlbWVudCc6XG4gICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgY2FzZSAnY29udHJvbGxlcic6XG4gICAgICAgIHJldHVybiBnZXRBVShlbGVtZW50KS5jb250cm9sbGVyO1xuICAgICAgY2FzZSAndmlldy1tb2RlbCc6XG4gICAgICAgIHJldHVybiBnZXRBVShlbGVtZW50KS5jb250cm9sbGVyLnZpZXdNb2RlbDtcbiAgICAgIGNhc2UgJ3ZpZXcnOlxuICAgICAgICByZXR1cm4gZ2V0QVUoZWxlbWVudCkuY29udHJvbGxlci52aWV3O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdmFyIHRhcmdldCA9IGdldEFVKGVsZW1lbnQpW2FwaU5hbWVdO1xuXG4gICAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQXR0ZW1wdGVkIHRvIHJlZmVyZW5jZSBcIicgKyBhcGlOYW1lICsgJ1wiLCBidXQgaXQgd2FzIG5vdCBmb3VuZCBhbW9uZ3N0IHRoZSB0YXJnZXRcXCdzIEFQSS4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0YXJnZXQudmlld01vZGVsO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gTmFtZUV4cHJlc3Npb247XG59KCk7XG5cbnZhciBOYW1lQmluZGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBOYW1lQmluZGVyKHNvdXJjZUV4cHJlc3Npb24sIHRhcmdldCwgbG9va3VwRnVuY3Rpb25zKSB7XG4gICAgXG5cbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xuICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xuICB9XG5cbiAgTmFtZUJpbmRlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIGJpbmQoc291cmNlKSB7XG4gICAgaWYgKHRoaXMuaXNCb3VuZCkge1xuICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdGhpcy51bmJpbmQoKTtcbiAgICB9XG4gICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcbiAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcbiAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbi5iaW5kKHRoaXMsIHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICAgIH1cbiAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYXNzaWduKHRoaXMuc291cmNlLCB0aGlzLnRhcmdldCwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIE5hbWVCaW5kZXIucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIHVuYmluZCgpIHtcbiAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcbiAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucykgPT09IHRoaXMudGFyZ2V0KSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uYXNzaWduKHRoaXMuc291cmNlLCBudWxsLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XG4gICAgfVxuICAgIGlmICh0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKSB7XG4gICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcbiAgICB9XG4gICAgdGhpcy5zb3VyY2UgPSBudWxsO1xuICB9O1xuXG4gIHJldHVybiBOYW1lQmluZGVyO1xufSgpO1xuXG52YXIgTG9va3VwRnVuY3Rpb25zID0ge1xuICBiaW5kaW5nQmVoYXZpb3JzOiBmdW5jdGlvbiBiaW5kaW5nQmVoYXZpb3JzKG5hbWUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgdmFsdWVDb252ZXJ0ZXJzOiBmdW5jdGlvbiB2YWx1ZUNvbnZlcnRlcnMobmFtZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG5leHBvcnQgdmFyIEJpbmRpbmdFbmdpbmUgPSAoX3RlbXAyID0gX2NsYXNzMTQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEJpbmRpbmdFbmdpbmUob2JzZXJ2ZXJMb2NhdG9yLCBwYXJzZXIpIHtcbiAgICBcblxuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xuICAgIHRoaXMucGFyc2VyID0gcGFyc2VyO1xuICB9XG5cbiAgQmluZGluZ0VuZ2luZS5wcm90b3R5cGUuY3JlYXRlQmluZGluZ0V4cHJlc3Npb24gPSBmdW5jdGlvbiBjcmVhdGVCaW5kaW5nRXhwcmVzc2lvbih0YXJnZXRQcm9wZXJ0eSwgc291cmNlRXhwcmVzc2lvbikge1xuICAgIHZhciBtb2RlID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiBiaW5kaW5nTW9kZS50b1ZpZXc7XG4gICAgdmFyIGxvb2t1cEZ1bmN0aW9ucyA9IGFyZ3VtZW50cy5sZW5ndGggPiAzICYmIGFyZ3VtZW50c1szXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzNdIDogTG9va3VwRnVuY3Rpb25zO1xuXG4gICAgcmV0dXJuIG5ldyBCaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHRoaXMucGFyc2VyLnBhcnNlKHNvdXJjZUV4cHJlc3Npb24pLCBtb2RlLCBsb29rdXBGdW5jdGlvbnMpO1xuICB9O1xuXG4gIEJpbmRpbmdFbmdpbmUucHJvdG90eXBlLnByb3BlcnR5T2JzZXJ2ZXIgPSBmdW5jdGlvbiBwcm9wZXJ0eU9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKSB7XG4gICAgdmFyIF90aGlzMjcgPSB0aGlzO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1YnNjcmliZTogZnVuY3Rpb24gc3Vic2NyaWJlKGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciBvYnNlcnZlciA9IF90aGlzMjcub2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKG9iaiwgcHJvcGVydHlOYW1lKTtcbiAgICAgICAgb2JzZXJ2ZXIuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLnVuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5jb2xsZWN0aW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbiBjb2xsZWN0aW9uT2JzZXJ2ZXIoY29sbGVjdGlvbikge1xuICAgIHZhciBfdGhpczI4ID0gdGhpcztcblxuICAgIHJldHVybiB7XG4gICAgICBzdWJzY3JpYmU6IGZ1bmN0aW9uIHN1YnNjcmliZShjYWxsYmFjaykge1xuICAgICAgICB2YXIgb2JzZXJ2ZXIgPSB2b2lkIDA7XG4gICAgICAgIGlmIChjb2xsZWN0aW9uIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICBvYnNlcnZlciA9IF90aGlzMjgub2JzZXJ2ZXJMb2NhdG9yLmdldEFycmF5T2JzZXJ2ZXIoY29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAoY29sbGVjdGlvbiBpbnN0YW5jZW9mIE1hcCkge1xuICAgICAgICAgIG9ic2VydmVyID0gX3RoaXMyOC5vYnNlcnZlckxvY2F0b3IuZ2V0TWFwT2JzZXJ2ZXIoY29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSBpZiAoY29sbGVjdGlvbiBpbnN0YW5jZW9mIFNldCkge1xuICAgICAgICAgIG9ic2VydmVyID0gX3RoaXMyOC5vYnNlcnZlckxvY2F0b3IuZ2V0U2V0T2JzZXJ2ZXIoY29sbGVjdGlvbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb2xsZWN0aW9uIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgQXJyYXksIE1hcCBvciBTZXQuJyk7XG4gICAgICAgIH1cbiAgICAgICAgb2JzZXJ2ZXIuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBkaXNwb3NlOiBmdW5jdGlvbiBkaXNwb3NlKCkge1xuICAgICAgICAgICAgcmV0dXJuIG9ic2VydmVyLnVuc3Vic2NyaWJlKGNhbGxiYWNrKTtcbiAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5leHByZXNzaW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbiBleHByZXNzaW9uT2JzZXJ2ZXIoYmluZGluZ0NvbnRleHQsIGV4cHJlc3Npb24pIHtcbiAgICB2YXIgc2NvcGUgPSB7IGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0OiBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQpIH07XG4gICAgcmV0dXJuIG5ldyBFeHByZXNzaW9uT2JzZXJ2ZXIoc2NvcGUsIHRoaXMucGFyc2VyLnBhcnNlKGV4cHJlc3Npb24pLCB0aGlzLm9ic2VydmVyTG9jYXRvciwgTG9va3VwRnVuY3Rpb25zKTtcbiAgfTtcblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5wYXJzZUV4cHJlc3Npb24gPSBmdW5jdGlvbiBwYXJzZUV4cHJlc3Npb24oZXhwcmVzc2lvbikge1xuICAgIHJldHVybiB0aGlzLnBhcnNlci5wYXJzZShleHByZXNzaW9uKTtcbiAgfTtcblxuICBCaW5kaW5nRW5naW5lLnByb3RvdHlwZS5yZWdpc3RlckFkYXB0ZXIgPSBmdW5jdGlvbiByZWdpc3RlckFkYXB0ZXIoYWRhcHRlcikge1xuICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLmFkZEFkYXB0ZXIoYWRhcHRlcik7XG4gIH07XG5cbiAgcmV0dXJuIEJpbmRpbmdFbmdpbmU7XG59KCksIF9jbGFzczE0LmluamVjdCA9IFtPYnNlcnZlckxvY2F0b3IsIFBhcnNlcl0sIF90ZW1wMik7XG5cbnZhciBzZXRQcm90byA9IFNldC5wcm90b3R5cGU7XG5cbmZ1bmN0aW9uIF9nZXRTZXRPYnNlcnZlcih0YXNrUXVldWUsIHNldCkge1xuICByZXR1cm4gTW9kaWZ5U2V0T2JzZXJ2ZXIuZm9yKHRhc2tRdWV1ZSwgc2V0KTtcbn1cblxudmFyIE1vZGlmeVNldE9ic2VydmVyID0gZnVuY3Rpb24gKF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTMpIHtcbiAgX2luaGVyaXRzKE1vZGlmeVNldE9ic2VydmVyLCBfTW9kaWZ5Q29sbGVjdGlvbk9ic2UzKTtcblxuICBmdW5jdGlvbiBNb2RpZnlTZXRPYnNlcnZlcih0YXNrUXVldWUsIHNldCkge1xuICAgIFxuXG4gICAgcmV0dXJuIF9wb3NzaWJsZUNvbnN0cnVjdG9yUmV0dXJuKHRoaXMsIF9Nb2RpZnlDb2xsZWN0aW9uT2JzZTMuY2FsbCh0aGlzLCB0YXNrUXVldWUsIHNldCkpO1xuICB9XG5cbiAgTW9kaWZ5U2V0T2JzZXJ2ZXIuZm9yID0gZnVuY3Rpb24gX2Zvcih0YXNrUXVldWUsIHNldCkge1xuICAgIGlmICghKCdfX3NldF9vYnNlcnZlcl9fJyBpbiBzZXQpKSB7XG4gICAgICBSZWZsZWN0LmRlZmluZVByb3BlcnR5KHNldCwgJ19fc2V0X29ic2VydmVyX18nLCB7XG4gICAgICAgIHZhbHVlOiBNb2RpZnlTZXRPYnNlcnZlci5jcmVhdGUodGFza1F1ZXVlLCBzZXQpLFxuICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSwgY29uZmlndXJhYmxlOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBzZXQuX19zZXRfb2JzZXJ2ZXJfXztcbiAgfTtcblxuICBNb2RpZnlTZXRPYnNlcnZlci5jcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUodGFza1F1ZXVlLCBzZXQpIHtcbiAgICB2YXIgb2JzZXJ2ZXIgPSBuZXcgTW9kaWZ5U2V0T2JzZXJ2ZXIodGFza1F1ZXVlLCBzZXQpO1xuXG4gICAgdmFyIHByb3RvID0gc2V0UHJvdG87XG4gICAgaWYgKHByb3RvLmFkZCAhPT0gc2V0LmFkZCB8fCBwcm90by5kZWxldGUgIT09IHNldC5kZWxldGUgfHwgcHJvdG8uY2xlYXIgIT09IHNldC5jbGVhcikge1xuICAgICAgcHJvdG8gPSB7XG4gICAgICAgIGFkZDogc2V0LmFkZCxcbiAgICAgICAgZGVsZXRlOiBzZXQuZGVsZXRlLFxuICAgICAgICBjbGVhcjogc2V0LmNsZWFyXG4gICAgICB9O1xuICAgIH1cblxuICAgIHNldC5hZGQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgdHlwZSA9ICdhZGQnO1xuICAgICAgdmFyIG9sZFNpemUgPSBzZXQuc2l6ZTtcbiAgICAgIHZhciBtZXRob2RDYWxsUmVzdWx0ID0gcHJvdG8uYWRkLmFwcGx5KHNldCwgYXJndW1lbnRzKTtcbiAgICAgIHZhciBoYXNWYWx1ZSA9IHNldC5zaXplID09PSBvbGRTaXplO1xuICAgICAgaWYgKCFoYXNWYWx1ZSkge1xuICAgICAgICBvYnNlcnZlci5hZGRDaGFuZ2VSZWNvcmQoe1xuICAgICAgICAgIHR5cGU6IHR5cGUsXG4gICAgICAgICAgb2JqZWN0OiBzZXQsXG4gICAgICAgICAgdmFsdWU6IEFycmF5LmZyb20oc2V0KS5wb3AoKVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICBzZXQuZGVsZXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIGhhc1ZhbHVlID0gc2V0Lmhhcyhhcmd1bWVudHNbMF0pO1xuICAgICAgdmFyIG1ldGhvZENhbGxSZXN1bHQgPSBwcm90by5kZWxldGUuYXBwbHkoc2V0LCBhcmd1bWVudHMpO1xuICAgICAgaWYgKGhhc1ZhbHVlKSB7XG4gICAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgICAgdHlwZTogJ2RlbGV0ZScsXG4gICAgICAgICAgb2JqZWN0OiBzZXQsXG4gICAgICAgICAgdmFsdWU6IGFyZ3VtZW50c1swXVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICBzZXQuY2xlYXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgbWV0aG9kQ2FsbFJlc3VsdCA9IHByb3RvLmNsZWFyLmFwcGx5KHNldCwgYXJndW1lbnRzKTtcbiAgICAgIG9ic2VydmVyLmFkZENoYW5nZVJlY29yZCh7XG4gICAgICAgIHR5cGU6ICdjbGVhcicsXG4gICAgICAgIG9iamVjdDogc2V0XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBtZXRob2RDYWxsUmVzdWx0O1xuICAgIH07XG5cbiAgICByZXR1cm4gb2JzZXJ2ZXI7XG4gIH07XG5cbiAgcmV0dXJuIE1vZGlmeVNldE9ic2VydmVyO1xufShNb2RpZnlDb2xsZWN0aW9uT2JzZXJ2ZXIpO1xuXG5leHBvcnQgZnVuY3Rpb24gb2JzZXJ2YWJsZSh0YXJnZXRPckNvbmZpZywga2V5LCBkZXNjcmlwdG9yKSB7XG4gIGZ1bmN0aW9uIGRlY28odGFyZ2V0LCBrZXksIGRlc2NyaXB0b3IsIGNvbmZpZykge1xuICAgIHZhciBpc0NsYXNzRGVjb3JhdG9yID0ga2V5ID09PSB1bmRlZmluZWQ7XG4gICAgaWYgKGlzQ2xhc3NEZWNvcmF0b3IpIHtcbiAgICAgIHRhcmdldCA9IHRhcmdldC5wcm90b3R5cGU7XG4gICAgICBrZXkgPSB0eXBlb2YgY29uZmlnID09PSAnc3RyaW5nJyA/IGNvbmZpZyA6IGNvbmZpZy5uYW1lO1xuICAgIH1cblxuICAgIHZhciBpbm5lclByb3BlcnR5TmFtZSA9ICdfJyArIGtleTtcbiAgICB2YXIgaW5uZXJQcm9wZXJ0eURlc2NyaXB0b3IgPSB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgfTtcblxuICAgIHZhciBjYWxsYmFja05hbWUgPSBjb25maWcgJiYgY29uZmlnLmNoYW5nZUhhbmRsZXIgfHwga2V5ICsgJ0NoYW5nZWQnO1xuXG4gICAgaWYgKGRlc2NyaXB0b3IpIHtcbiAgICAgIGlmICh0eXBlb2YgZGVzY3JpcHRvci5pbml0aWFsaXplciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBpbm5lclByb3BlcnR5RGVzY3JpcHRvci52YWx1ZSA9IGRlc2NyaXB0b3IuaW5pdGlhbGl6ZXIoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgZGVzY3JpcHRvciA9IHt9O1xuICAgIH1cblxuICAgIGlmICghKCdlbnVtZXJhYmxlJyBpbiBkZXNjcmlwdG9yKSkge1xuICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBkZWxldGUgZGVzY3JpcHRvci52YWx1ZTtcbiAgICBkZWxldGUgZGVzY3JpcHRvci53cml0YWJsZTtcbiAgICBkZWxldGUgZGVzY3JpcHRvci5pbml0aWFsaXplcjtcblxuICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBpbm5lclByb3BlcnR5TmFtZSwgaW5uZXJQcm9wZXJ0eURlc2NyaXB0b3IpO1xuXG4gICAgZGVzY3JpcHRvci5nZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gdGhpc1tpbm5lclByb3BlcnR5TmFtZV07XG4gICAgfTtcbiAgICBkZXNjcmlwdG9yLnNldCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgdmFyIG9sZFZhbHVlID0gdGhpc1tpbm5lclByb3BlcnR5TmFtZV07XG4gICAgICBpZiAobmV3VmFsdWUgPT09IG9sZFZhbHVlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdGhpc1tpbm5lclByb3BlcnR5TmFtZV0gPSBuZXdWYWx1ZTtcbiAgICAgIFJlZmxlY3QuZGVmaW5lUHJvcGVydHkodGhpcywgaW5uZXJQcm9wZXJ0eU5hbWUsIHsgZW51bWVyYWJsZTogZmFsc2UgfSk7XG5cbiAgICAgIGlmICh0aGlzW2NhbGxiYWNrTmFtZV0pIHtcbiAgICAgICAgdGhpc1tjYWxsYmFja05hbWVdKG5ld1ZhbHVlLCBvbGRWYWx1ZSwga2V5KTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZGVzY3JpcHRvci5nZXQuZGVwZW5kZW5jaWVzID0gW2lubmVyUHJvcGVydHlOYW1lXTtcblxuICAgIGlmIChpc0NsYXNzRGVjb3JhdG9yKSB7XG4gICAgICBSZWZsZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBkZXNjcmlwdG9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGRlc2NyaXB0b3I7XG4gICAgfVxuICB9XG5cbiAgaWYgKGtleSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICh0LCBrLCBkKSB7XG4gICAgICByZXR1cm4gZGVjbyh0LCBrLCBkLCB0YXJnZXRPckNvbmZpZyk7XG4gICAgfTtcbiAgfVxuICByZXR1cm4gZGVjbyh0YXJnZXRPckNvbmZpZywga2V5LCBkZXNjcmlwdG9yKTtcbn1cblxudmFyIHNpZ25hbHMgPSB7fTtcblxuZXhwb3J0IGZ1bmN0aW9uIGNvbm5lY3RCaW5kaW5nVG9TaWduYWwoYmluZGluZywgbmFtZSkge1xuICBpZiAoIXNpZ25hbHMuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICBzaWduYWxzW25hbWVdID0gMDtcbiAgfVxuICBiaW5kaW5nLm9ic2VydmVQcm9wZXJ0eShzaWduYWxzLCBuYW1lKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNpZ25hbEJpbmRpbmdzKG5hbWUpIHtcbiAgaWYgKHNpZ25hbHMuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICBzaWduYWxzW25hbWVdKys7XG4gIH1cbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1iaW5kaW5nL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1iaW5kaW5nLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLWJpbmRpbmdcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiXG5cbmltcG9ydCAqIGFzIExvZ01hbmFnZXIgZnJvbSAnYXVyZWxpYS1sb2dnaW5nJztcblxudmFyIGxvZ2dlciA9IExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdldmVudC1hZ2dyZWdhdG9yJyk7XG5cbnZhciBIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICBmdW5jdGlvbiBIYW5kbGVyKG1lc3NhZ2VUeXBlLCBjYWxsYmFjaykge1xuICAgIFxuXG4gICAgdGhpcy5tZXNzYWdlVHlwZSA9IG1lc3NhZ2VUeXBlO1xuICAgIHRoaXMuY2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgfVxuXG4gIEhhbmRsZXIucHJvdG90eXBlLmhhbmRsZSA9IGZ1bmN0aW9uIGhhbmRsZShtZXNzYWdlKSB7XG4gICAgaWYgKG1lc3NhZ2UgaW5zdGFuY2VvZiB0aGlzLm1lc3NhZ2VUeXBlKSB7XG4gICAgICB0aGlzLmNhbGxiYWNrLmNhbGwobnVsbCwgbWVzc2FnZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBIYW5kbGVyO1xufSgpO1xuXG5mdW5jdGlvbiBpbnZva2VDYWxsYmFjayhjYWxsYmFjaywgZGF0YSwgZXZlbnQpIHtcbiAgdHJ5IHtcbiAgICBjYWxsYmFjayhkYXRhLCBldmVudCk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2dnZXIuZXJyb3IoZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaW52b2tlSGFuZGxlcihoYW5kbGVyLCBkYXRhKSB7XG4gIHRyeSB7XG4gICAgaGFuZGxlci5oYW5kbGUoZGF0YSk7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBsb2dnZXIuZXJyb3IoZSk7XG4gIH1cbn1cblxuZXhwb3J0IHZhciBFdmVudEFnZ3JlZ2F0b3IgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEV2ZW50QWdncmVnYXRvcigpIHtcbiAgICBcblxuICAgIHRoaXMuZXZlbnRMb29rdXAgPSB7fTtcbiAgICB0aGlzLm1lc3NhZ2VIYW5kbGVycyA9IFtdO1xuICB9XG5cbiAgRXZlbnRBZ2dyZWdhdG9yLnByb3RvdHlwZS5wdWJsaXNoID0gZnVuY3Rpb24gcHVibGlzaChldmVudCwgZGF0YSkge1xuICAgIHZhciBzdWJzY3JpYmVycyA9IHZvaWQgMDtcbiAgICB2YXIgaSA9IHZvaWQgMDtcblxuICAgIGlmICghZXZlbnQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignRXZlbnQgd2FzIGludmFsaWQuJyk7XG4gICAgfVxuXG4gICAgaWYgKHR5cGVvZiBldmVudCA9PT0gJ3N0cmluZycpIHtcbiAgICAgIHN1YnNjcmliZXJzID0gdGhpcy5ldmVudExvb2t1cFtldmVudF07XG4gICAgICBpZiAoc3Vic2NyaWJlcnMpIHtcbiAgICAgICAgc3Vic2NyaWJlcnMgPSBzdWJzY3JpYmVycy5zbGljZSgpO1xuICAgICAgICBpID0gc3Vic2NyaWJlcnMubGVuZ3RoO1xuXG4gICAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgICBpbnZva2VDYWxsYmFjayhzdWJzY3JpYmVyc1tpXSwgZGF0YSwgZXZlbnQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN1YnNjcmliZXJzID0gdGhpcy5tZXNzYWdlSGFuZGxlcnMuc2xpY2UoKTtcbiAgICAgIGkgPSBzdWJzY3JpYmVycy5sZW5ndGg7XG5cbiAgICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgaW52b2tlSGFuZGxlcihzdWJzY3JpYmVyc1tpXSwgZXZlbnQpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBFdmVudEFnZ3JlZ2F0b3IucHJvdG90eXBlLnN1YnNjcmliZSA9IGZ1bmN0aW9uIHN1YnNjcmliZShldmVudCwgY2FsbGJhY2spIHtcbiAgICB2YXIgaGFuZGxlciA9IHZvaWQgMDtcbiAgICB2YXIgc3Vic2NyaWJlcnMgPSB2b2lkIDA7XG5cbiAgICBpZiAoIWV2ZW50KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0V2ZW50IGNoYW5uZWwvdHlwZSB3YXMgaW52YWxpZC4nKTtcbiAgICB9XG5cbiAgICBpZiAodHlwZW9mIGV2ZW50ID09PSAnc3RyaW5nJykge1xuICAgICAgaGFuZGxlciA9IGNhbGxiYWNrO1xuICAgICAgc3Vic2NyaWJlcnMgPSB0aGlzLmV2ZW50TG9va3VwW2V2ZW50XSB8fCAodGhpcy5ldmVudExvb2t1cFtldmVudF0gPSBbXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhbmRsZXIgPSBuZXcgSGFuZGxlcihldmVudCwgY2FsbGJhY2spO1xuICAgICAgc3Vic2NyaWJlcnMgPSB0aGlzLm1lc3NhZ2VIYW5kbGVycztcbiAgICB9XG5cbiAgICBzdWJzY3JpYmVycy5wdXNoKGhhbmRsZXIpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRpc3Bvc2U6IGZ1bmN0aW9uIGRpc3Bvc2UoKSB7XG4gICAgICAgIHZhciBpZHggPSBzdWJzY3JpYmVycy5pbmRleE9mKGhhbmRsZXIpO1xuICAgICAgICBpZiAoaWR4ICE9PSAtMSkge1xuICAgICAgICAgIHN1YnNjcmliZXJzLnNwbGljZShpZHgsIDEpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcbiAgfTtcblxuICBFdmVudEFnZ3JlZ2F0b3IucHJvdG90eXBlLnN1YnNjcmliZU9uY2UgPSBmdW5jdGlvbiBzdWJzY3JpYmVPbmNlKGV2ZW50LCBjYWxsYmFjaykge1xuICAgIHZhciBzdWIgPSB0aGlzLnN1YnNjcmliZShldmVudCwgZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHN1Yi5kaXNwb3NlKCk7XG4gICAgICByZXR1cm4gY2FsbGJhY2soYSwgYik7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gc3ViO1xuICB9O1xuXG4gIHJldHVybiBFdmVudEFnZ3JlZ2F0b3I7XG59KCk7XG5cbmV4cG9ydCBmdW5jdGlvbiBpbmNsdWRlRXZlbnRzSW4ob2JqKSB7XG4gIHZhciBlYSA9IG5ldyBFdmVudEFnZ3JlZ2F0b3IoKTtcblxuICBvYmouc3Vic2NyaWJlT25jZSA9IGZ1bmN0aW9uIChldmVudCwgY2FsbGJhY2spIHtcbiAgICByZXR1cm4gZWEuc3Vic2NyaWJlT25jZShldmVudCwgY2FsbGJhY2spO1xuICB9O1xuXG4gIG9iai5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZXZlbnQsIGNhbGxiYWNrKSB7XG4gICAgcmV0dXJuIGVhLnN1YnNjcmliZShldmVudCwgY2FsbGJhY2spO1xuICB9O1xuXG4gIG9iai5wdWJsaXNoID0gZnVuY3Rpb24gKGV2ZW50LCBkYXRhKSB7XG4gICAgZWEucHVibGlzaChldmVudCwgZGF0YSk7XG4gIH07XG5cbiAgcmV0dXJuIGVhO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY29uZmlndXJlKGNvbmZpZykge1xuICBjb25maWcuaW5zdGFuY2UoRXZlbnRBZ2dyZWdhdG9yLCBpbmNsdWRlRXZlbnRzSW4oY29uZmlnLmF1cmVsaWEpKTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLWV2ZW50LWFnZ3JlZ2F0b3Jcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiaW1wb3J0IHsgQ29udGFpbmVyIH0gZnJvbSAnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbic7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmV4cG9ydCAqIGZyb20gJ2F1cmVsaWEtYmluZGluZyc7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLW1ldGFkYXRhJztcbmltcG9ydCB7IEh0bWxCZWhhdmlvclJlc291cmNlLCBWaWV3RW5naW5lLCBCaW5kaW5nTGFuZ3VhZ2UsIFRlbXBsYXRpbmdFbmdpbmUsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24sIFZpZXdTbG90LCBWaWV3UmVzb3VyY2VzIH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcbmV4cG9ydCAqIGZyb20gJ2F1cmVsaWEtdGVtcGxhdGluZyc7XG5pbXBvcnQgeyBMb2FkZXIgfSBmcm9tICdhdXJlbGlhLWxvYWRlcic7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLWxvYWRlcic7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLXRhc2stcXVldWUnO1xuaW1wb3J0IHsgam9pbiwgcmVsYXRpdmVUb0ZpbGUgfSBmcm9tICdhdXJlbGlhLXBhdGgnO1xuZXhwb3J0ICogZnJvbSAnYXVyZWxpYS1wYXRoJztcbmltcG9ydCB7IERPTSwgUExBVEZPUk0gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5leHBvcnQgKiBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgKiBhcyBUaGVMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5leHBvcnQgeyBUaGVMb2dNYW5hZ2VyIGFzIExvZ01hbmFnZXIgfTtcblxudmFyIGxvZ2dlciA9IFRoZUxvZ01hbmFnZXIuZ2V0TG9nZ2VyKCdhdXJlbGlhJyk7XHJcbnZhciBleHRQYXR0ZXJuID0gL1xcLlteLy5dKyQvO1xyXG5mdW5jdGlvbiBydW5UYXNrcyhjb25maWcsIHRhc2tzKSB7XHJcbiAgICB2YXIgY3VycmVudDtcclxuICAgIHZhciBuZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGN1cnJlbnQgPSB0YXNrcy5zaGlmdCgpO1xyXG4gICAgICAgIGlmIChjdXJyZW50KSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY3VycmVudChjb25maWcpKS50aGVuKG5leHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIG5leHQoKTtcclxufVxyXG5mdW5jdGlvbiBsb2FkUGx1Z2luKGZ3Q29uZmlnLCBsb2FkZXIsIGluZm8pIHtcclxuICAgIGxvZ2dlci5kZWJ1ZyhcIkxvYWRpbmcgcGx1Z2luIFwiLmNvbmNhdChpbmZvLm1vZHVsZUlkLCBcIi5cIikpO1xyXG4gICAgaWYgKHR5cGVvZiBpbmZvLm1vZHVsZUlkID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGZ3Q29uZmlnLnJlc291cmNlc1JlbGF0aXZlVG8gPSBpbmZvLnJlc291cmNlc1JlbGF0aXZlVG87XHJcbiAgICAgICAgdmFyIGlkID0gaW5mby5tb2R1bGVJZDtcclxuICAgICAgICBpZiAoaW5mby5yZXNvdXJjZXNSZWxhdGl2ZVRvLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRlci5ub3JtYWxpemUoaW5mby5tb2R1bGVJZCwgaW5mby5yZXNvdXJjZXNSZWxhdGl2ZVRvWzFdKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG5vcm1hbGl6ZWRJZCkgeyByZXR1cm4gX2xvYWRQbHVnaW4obm9ybWFsaXplZElkKTsgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBfbG9hZFBsdWdpbihpZCk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0eXBlb2YgaW5mby5jb25maWd1cmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICBpZiAoZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMuaW5kZXhPZihpbmZvLmNvbmZpZ3VyZSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMucHVzaChpbmZvLmNvbmZpZ3VyZSk7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShpbmZvLmNvbmZpZ3VyZS5jYWxsKG51bGwsIGZ3Q29uZmlnLCBpbmZvLmNvbmZpZyB8fCB7fSkpO1xyXG4gICAgfVxyXG4gICAgdGhyb3cgbmV3IEVycm9yKGludmFsaWRDb25maWdNc2coaW5mby5tb2R1bGVJZCB8fCBpbmZvLmNvbmZpZ3VyZSwgJ3BsdWdpbicpKTtcclxuICAgIGZ1bmN0aW9uIF9sb2FkUGx1Z2luKG1vZHVsZUlkKSB7XHJcbiAgICAgICAgcmV0dXJuIGxvYWRlci5sb2FkTW9kdWxlKG1vZHVsZUlkKS50aGVuKGZ1bmN0aW9uIChtKSB7XHJcbiAgICAgICAgICAgIGlmICgnY29uZmlndXJlJyBpbiBtKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoZndDb25maWcuY29uZmlndXJlZFBsdWdpbnMuaW5kZXhPZihtLmNvbmZpZ3VyZSkgIT09IC0xKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShtLmNvbmZpZ3VyZShmd0NvbmZpZywgaW5mby5jb25maWcgfHwge30pKS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmd0NvbmZpZy5jb25maWd1cmVkUGx1Z2lucy5wdXNoKG0uY29uZmlndXJlKTtcclxuICAgICAgICAgICAgICAgICAgICBmd0NvbmZpZy5yZXNvdXJjZXNSZWxhdGl2ZVRvID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoXCJDb25maWd1cmVkIHBsdWdpbiBcIi5jb25jYXQoaW5mby5tb2R1bGVJZCwgXCIuXCIpKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZ3Q29uZmlnLnJlc291cmNlc1JlbGF0aXZlVG8gPSBudWxsO1xyXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoXCJMb2FkZWQgcGx1Z2luIFwiLmNvbmNhdChpbmZvLm1vZHVsZUlkLCBcIi5cIikpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGxvYWRSZXNvdXJjZXMoYXVyZWxpYSwgcmVzb3VyY2VzVG9Mb2FkLCBhcHBSZXNvdXJjZXMpIHtcclxuICAgIGlmIChPYmplY3Qua2V5cyhyZXNvdXJjZXNUb0xvYWQpLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuICAgIHZhciB2aWV3RW5naW5lID0gYXVyZWxpYS5jb250YWluZXIuZ2V0KFZpZXdFbmdpbmUpO1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKE9iamVjdC5rZXlzKHJlc291cmNlc1RvTG9hZCkubWFwKGZ1bmN0aW9uIChuKSB7IHJldHVybiBfbm9ybWFsaXplKHJlc291cmNlc1RvTG9hZFtuXSk7IH0pKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uIChsb2Fkcykge1xyXG4gICAgICAgIHZhciBuYW1lcyA9IFtdO1xyXG4gICAgICAgIHZhciBpbXBvcnRJZHMgPSBbXTtcclxuICAgICAgICBsb2Fkcy5mb3JFYWNoKGZ1bmN0aW9uIChsKSB7XHJcbiAgICAgICAgICAgIG5hbWVzLnB1c2godW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgaW1wb3J0SWRzLnB1c2gobC5pbXBvcnRJZCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdFbmdpbmUuaW1wb3J0Vmlld1Jlc291cmNlcyhpbXBvcnRJZHMsIG5hbWVzLCBhcHBSZXNvdXJjZXMpO1xyXG4gICAgfSk7XHJcbiAgICBmdW5jdGlvbiBfbm9ybWFsaXplKGxvYWQpIHtcclxuICAgICAgICB2YXIgbW9kdWxlSWQgPSBsb2FkLm1vZHVsZUlkO1xyXG4gICAgICAgIHZhciBleHQgPSBnZXRFeHQobW9kdWxlSWQpO1xyXG4gICAgICAgIGlmIChpc090aGVyUmVzb3VyY2UobW9kdWxlSWQpKSB7XHJcbiAgICAgICAgICAgIG1vZHVsZUlkID0gcmVtb3ZlRXh0KG1vZHVsZUlkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGF1cmVsaWEubG9hZGVyLm5vcm1hbGl6ZShtb2R1bGVJZCwgbG9hZC5yZWxhdGl2ZVRvKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAobm9ybWFsaXplZCkge1xyXG4gICAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogbG9hZC5tb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgIGltcG9ydElkOiBpc090aGVyUmVzb3VyY2UobG9hZC5tb2R1bGVJZCkgPyBhZGRPcmlnaW5hbEV4dChub3JtYWxpemVkLCBleHQpIDogbm9ybWFsaXplZFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gaXNPdGhlclJlc291cmNlKG5hbWUpIHtcclxuICAgICAgICB2YXIgZXh0ID0gZ2V0RXh0KG5hbWUpO1xyXG4gICAgICAgIGlmICghZXh0KVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgaWYgKGV4dCA9PT0gJycpXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICBpZiAoZXh0ID09PSAnLmpzJyB8fCBleHQgPT09ICcudHMnKVxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiByZW1vdmVFeHQobmFtZSkge1xyXG4gICAgICAgIHJldHVybiBuYW1lLnJlcGxhY2UoZXh0UGF0dGVybiwgJycpO1xyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gYWRkT3JpZ2luYWxFeHQobm9ybWFsaXplZCwgZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHJlbW92ZUV4dChub3JtYWxpemVkKSArICcuJyArIGV4dDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBnZXRFeHQobmFtZSkge1xyXG4gICAgdmFyIG1hdGNoID0gbmFtZS5tYXRjaChleHRQYXR0ZXJuKTtcclxuICAgIGlmIChtYXRjaCAmJiBtYXRjaC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgcmV0dXJuIChtYXRjaFswXS5zcGxpdCgnLicpKVsxXTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBsb2FkQmVoYXZpb3JzKGNvbmZpZykge1xyXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKGNvbmZpZy5iZWhhdmlvcnNUb0xvYWQubWFwKGZ1bmN0aW9uIChtKSB7IHJldHVybiBtLmxvYWQoY29uZmlnLmNvbnRhaW5lciwgbS50YXJnZXQpOyB9KSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29uZmlnLmJlaGF2aW9yc1RvTG9hZCA9IG51bGw7XHJcbiAgICB9KTtcclxufVxyXG5mdW5jdGlvbiBhc3NlcnRQcm9jZXNzZWQocGx1Z2lucykge1xyXG4gICAgaWYgKHBsdWdpbnMucHJvY2Vzc2VkKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGlzIGNvbmZpZyBpbnN0YW5jZSBoYXMgYWxyZWFkeSBiZWVuIGFwcGxpZWQuIFRvIGxvYWQgbW9yZSBwbHVnaW5zIG9yIGdsb2JhbCByZXNvdXJjZXMsIGNyZWF0ZSBhIG5ldyBGcmFtZXdvcmtDb25maWd1cmF0aW9uIGluc3RhbmNlLicpO1xyXG4gICAgfVxyXG59XHJcbmZ1bmN0aW9uIGludmFsaWRDb25maWdNc2coY2ZnLCB0eXBlKSB7XHJcbiAgICByZXR1cm4gXCJJbnZhbGlkIFwiLmNvbmNhdCh0eXBlLCBcIiBbXCIpLmNvbmNhdChjZmcsIFwiXSwgXCIpLmNvbmNhdCh0eXBlLCBcIiBtdXN0IGJlIHNwZWNpZmllZCBhcyBmdW5jdGlvbnMgb3IgcmVsYXRpdmUgbW9kdWxlIElEcy5cIik7XHJcbn1cclxudmFyIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRnJhbWV3b3JrQ29uZmlndXJhdGlvbihhdXJlbGlhKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB0aGlzLmF1cmVsaWEgPSBhdXJlbGlhO1xyXG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gYXVyZWxpYS5jb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5pbmZvID0gW107XHJcbiAgICAgICAgdGhpcy5wcm9jZXNzZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnByZVRhc2tzID0gW107XHJcbiAgICAgICAgdGhpcy5wb3N0VGFza3MgPSBbXTtcclxuICAgICAgICB0aGlzLmJlaGF2aW9yc1RvTG9hZCA9IFtdO1xyXG4gICAgICAgIHRoaXMuY29uZmlndXJlZFBsdWdpbnMgPSBbXTtcclxuICAgICAgICB0aGlzLnJlc291cmNlc1RvTG9hZCA9IHt9O1xyXG4gICAgICAgIHRoaXMucHJlVGFzayhmdW5jdGlvbiAoKSB7IHJldHVybiBhdXJlbGlhLmxvYWRlci5ub3JtYWxpemUoJ2F1cmVsaWEtYm9vdHN0cmFwcGVyJywgdW5kZWZpbmVkKVxyXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAobmFtZSkgeyByZXR1cm4gX3RoaXMuYm9vdHN0cmFwcGVyTmFtZSA9IG5hbWU7IH0pOyB9KTtcclxuICAgICAgICB0aGlzLnBvc3RUYXNrKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGxvYWRSZXNvdXJjZXMoYXVyZWxpYSwgX3RoaXMucmVzb3VyY2VzVG9Mb2FkLCBhdXJlbGlhLnJlc291cmNlcyk7IH0pO1xyXG4gICAgfVxyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuaW5zdGFuY2UgPSBmdW5jdGlvbiAodHlwZSwgaW5zdGFuY2UpIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKHR5cGUsIGluc3RhbmNlKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH07XHJcbiAgICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5zaW5nbGV0b24gPSBmdW5jdGlvbiAodHlwZSwgaW1wbGVtZW50YXRpb24pIHtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbih0eXBlLCBpbXBsZW1lbnRhdGlvbik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUudHJhbnNpZW50ID0gZnVuY3Rpb24gKHR5cGUsIGltcGxlbWVudGF0aW9uKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIucmVnaXN0ZXJUcmFuc2llbnQodHlwZSwgaW1wbGVtZW50YXRpb24pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnByZVRhc2sgPSBmdW5jdGlvbiAodGFzaykge1xyXG4gICAgICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcclxuICAgICAgICB0aGlzLnByZVRhc2tzLnB1c2godGFzayk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUucG9zdFRhc2sgPSBmdW5jdGlvbiAodGFzaykge1xyXG4gICAgICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcclxuICAgICAgICB0aGlzLnBvc3RUYXNrcy5wdXNoKHRhc2spO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmZlYXR1cmUgPSBmdW5jdGlvbiAocGx1Z2luLCBjb25maWcpIHtcclxuICAgICAgICBpZiAoY29uZmlnID09PSB2b2lkIDApIHsgY29uZmlnID0ge307IH1cclxuICAgICAgICBzd2l0Y2ggKHR5cGVvZiBwbHVnaW4pIHtcclxuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcclxuICAgICAgICAgICAgICAgIHZhciBoYXNJbmRleCA9IC9cXC9pbmRleCQvaS50ZXN0KHBsdWdpbik7XHJcbiAgICAgICAgICAgICAgICB2YXIgbW9kdWxlSWQgPSBoYXNJbmRleCB8fCBnZXRFeHQocGx1Z2luKSA/IHBsdWdpbiA6IHBsdWdpbiArICcvaW5kZXgnO1xyXG4gICAgICAgICAgICAgICAgdmFyIHJvb3QgPSBoYXNJbmRleCA/IHBsdWdpbi5zbGljZSgwLCAtNikgOiBwbHVnaW47XHJcbiAgICAgICAgICAgICAgICB0aGlzLmluZm8ucHVzaCh7IG1vZHVsZUlkOiBtb2R1bGVJZCwgcmVzb3VyY2VzUmVsYXRpdmVUbzogW3Jvb3QsICcnXSwgY29uZmlnOiBjb25maWcgfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSAnZnVuY3Rpb24nOlxyXG4gICAgICAgICAgICAgICAgdGhpcy5pbmZvLnB1c2goeyBjb25maWd1cmU6IHBsdWdpbiwgY29uZmlnOiBjb25maWcgfHwge30gfSk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbnZhbGlkQ29uZmlnTXNnKHBsdWdpbiwgJ2ZlYXR1cmUnKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmdsb2JhbFJlc291cmNlcyA9IGZ1bmN0aW9uIChyZXNvdXJjZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGFzc2VydFByb2Nlc3NlZCh0aGlzKTtcclxuICAgICAgICB2YXIgdG9BZGQgPSBBcnJheS5pc0FycmF5KHJlc291cmNlcykgPyByZXNvdXJjZXMgOiBhcmd1bWVudHM7XHJcbiAgICAgICAgdmFyIHJlc291cmNlO1xyXG4gICAgICAgIHZhciByZXNvdXJjZXNSZWxhdGl2ZVRvID0gdGhpcy5yZXNvdXJjZXNSZWxhdGl2ZVRvIHx8IFsnJywgJyddO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHRvQWRkLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgcmVzb3VyY2UgPSB0b0FkZFtpXTtcclxuICAgICAgICAgICAgc3dpdGNoICh0eXBlb2YgcmVzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHBhcmVudF8xID0gcmVzb3VyY2VzUmVsYXRpdmVUb1swXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgZ3JhbmRQYXJlbnQgPSByZXNvdXJjZXNSZWxhdGl2ZVRvWzFdO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lXzEgPSByZXNvdXJjZTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoKHJlc291cmNlLnN0YXJ0c1dpdGgoJy4vJykgfHwgcmVzb3VyY2Uuc3RhcnRzV2l0aCgnLi4vJykpICYmIHBhcmVudF8xICE9PSAnJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lXzEgPSBqb2luKHBhcmVudF8xLCByZXNvdXJjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVzb3VyY2VzVG9Mb2FkW25hbWVfMV0gPSB7IG1vZHVsZUlkOiBuYW1lXzEsIHJlbGF0aXZlVG86IGdyYW5kUGFyZW50IH07XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdmdW5jdGlvbic6XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG1ldGEgPSB0aGlzLmF1cmVsaWEucmVzb3VyY2VzLmF1dG9SZWdpc3Rlcih0aGlzLmNvbnRhaW5lciwgcmVzb3VyY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXRhIGluc3RhbmNlb2YgSHRtbEJlaGF2aW9yUmVzb3VyY2UgJiYgbWV0YS5lbGVtZW50TmFtZSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5iZWhhdmlvcnNUb0xvYWQucHVzaChtZXRhKSA9PT0gMSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5wb3N0VGFzayhmdW5jdGlvbiAoKSB7IHJldHVybiBsb2FkQmVoYXZpb3JzKF90aGlzKTsgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihpbnZhbGlkQ29uZmlnTXNnKHJlc291cmNlLCAncmVzb3VyY2UnKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZ2xvYmFsTmFtZSA9IGZ1bmN0aW9uIChyZXNvdXJjZVBhdGgsIG5ld05hbWUpIHtcclxuICAgICAgICBhc3NlcnRQcm9jZXNzZWQodGhpcyk7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXNUb0xvYWRbcmVzb3VyY2VQYXRoXSA9IHsgbW9kdWxlSWQ6IG5ld05hbWUsIHJlbGF0aXZlVG86ICcnIH07XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUucGx1Z2luID0gZnVuY3Rpb24gKHBsdWdpbiwgcGx1Z2luQ29uZmlnKSB7XHJcbiAgICAgICAgYXNzZXJ0UHJvY2Vzc2VkKHRoaXMpO1xyXG4gICAgICAgIHZhciBpbmZvO1xyXG4gICAgICAgIHN3aXRjaCAodHlwZW9mIHBsdWdpbikge1xyXG4gICAgICAgICAgICBjYXNlICdzdHJpbmcnOlxyXG4gICAgICAgICAgICAgICAgaW5mbyA9IHsgbW9kdWxlSWQ6IHBsdWdpbiwgcmVzb3VyY2VzUmVsYXRpdmVUbzogW3BsdWdpbiwgJyddLCBjb25maWc6IHBsdWdpbkNvbmZpZyB8fCB7fSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ2Z1bmN0aW9uJzpcclxuICAgICAgICAgICAgICAgIGluZm8gPSB7IGNvbmZpZ3VyZTogcGx1Z2luLCBjb25maWc6IHBsdWdpbkNvbmZpZyB8fCB7fSB9O1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoaW52YWxpZENvbmZpZ01zZyhwbHVnaW4sICdwbHVnaW4nKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaW5mby5wdXNoKGluZm8pO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLl9hZGROb3JtYWxpemVkUGx1Z2luID0gZnVuY3Rpb24gKG5hbWUsIGNvbmZpZykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHBsdWdpbiA9IHsgbW9kdWxlSWQ6IG5hbWUsIHJlc291cmNlc1JlbGF0aXZlVG86IFtuYW1lLCAnJ10sIGNvbmZpZzogY29uZmlnIHx8IHt9IH07XHJcbiAgICAgICAgdGhpcy5pbmZvLnB1c2gocGx1Z2luKTtcclxuICAgICAgICB0aGlzLnByZVRhc2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgcmVsYXRpdmVUbyA9IFtuYW1lLCBfdGhpcy5ib290c3RyYXBwZXJOYW1lXTtcclxuICAgICAgICAgICAgcGx1Z2luLm1vZHVsZUlkID0gbmFtZTtcclxuICAgICAgICAgICAgcGx1Z2luLnJlc291cmNlc1JlbGF0aXZlVG8gPSByZWxhdGl2ZVRvO1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZGVmYXVsdEJpbmRpbmdMYW5ndWFnZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fYWRkTm9ybWFsaXplZFBsdWdpbignYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcnKTtcclxuICAgIH07XHJcbiAgICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5yb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXInKTtcclxuICAgIH07XHJcbiAgICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5oaXN0b3J5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9hZGROb3JtYWxpemVkUGx1Z2luKCdhdXJlbGlhLWhpc3RvcnktYnJvd3NlcicpO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmRlZmF1bHRSZXNvdXJjZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMnKTtcclxuICAgIH07XHJcbiAgICBGcmFtZXdvcmtDb25maWd1cmF0aW9uLnByb3RvdHlwZS5ldmVudEFnZ3JlZ2F0b3IgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FkZE5vcm1hbGl6ZWRQbHVnaW4oJ2F1cmVsaWEtZXZlbnQtYWdncmVnYXRvcicpO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLmJhc2ljQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0QmluZGluZ0xhbmd1YWdlKCkuZGVmYXVsdFJlc291cmNlcygpLmV2ZW50QWdncmVnYXRvcigpO1xyXG4gICAgfTtcclxuICAgIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24ucHJvdG90eXBlLnN0YW5kYXJkQ29uZmlndXJhdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5iYXNpY0NvbmZpZ3VyYXRpb24oKS5oaXN0b3J5KCkucm91dGVyKCk7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuZGV2ZWxvcG1lbnRMb2dnaW5nID0gZnVuY3Rpb24gKGxldmVsKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgbG9nTGV2ZWwgPSBsZXZlbCA/IFRoZUxvZ01hbmFnZXIubG9nTGV2ZWxbbGV2ZWxdIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChsb2dMZXZlbCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIGxvZ0xldmVsID0gVGhlTG9nTWFuYWdlci5sb2dMZXZlbC5kZWJ1ZztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5wcmVUYXNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzLmF1cmVsaWEubG9hZGVyLm5vcm1hbGl6ZSgnYXVyZWxpYS1sb2dnaW5nLWNvbnNvbGUnLCBfdGhpcy5ib290c3RyYXBwZXJOYW1lKS50aGVuKGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuYXVyZWxpYS5sb2FkZXIubG9hZE1vZHVsZShuYW1lKS50aGVuKGZ1bmN0aW9uIChtKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgVGhlTG9nTWFuYWdlci5hZGRBcHBlbmRlcihuZXcgbS5Db25zb2xlQXBwZW5kZXIoKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgVGhlTG9nTWFuYWdlci5zZXRMZXZlbChsb2dMZXZlbCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9O1xyXG4gICAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbi5wcm90b3R5cGUuYXBwbHkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5wcm9jZXNzZWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcnVuVGFza3ModGhpcywgdGhpcy5wcmVUYXNrcykudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBsb2FkZXIgPSBfdGhpcy5hdXJlbGlhLmxvYWRlcjtcclxuICAgICAgICAgICAgdmFyIGluZm8gPSBfdGhpcy5pbmZvO1xyXG4gICAgICAgICAgICB2YXIgY3VycmVudDtcclxuICAgICAgICAgICAgdmFyIG5leHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50ID0gaW5mby5zaGlmdCgpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9hZFBsdWdpbihfdGhpcywgbG9hZGVyLCBjdXJyZW50KS50aGVuKG5leHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgX3RoaXMucHJvY2Vzc2VkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIF90aGlzLmNvbmZpZ3VyZWRQbHVnaW5zID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQoKS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIHJ1blRhc2tzKF90aGlzLCBfdGhpcy5wb3N0VGFza3MpOyB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gRnJhbWV3b3JrQ29uZmlndXJhdGlvbjtcclxufSgpKTtcblxuZnVuY3Rpb24gcHJldmVudEFjdGlvbmxlc3NGb3JtU3VibWl0KCkge1xyXG4gICAgRE9NLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldnQpIHtcclxuICAgICAgICB2YXIgdGFyZ2V0ID0gZXZ0LnRhcmdldDtcclxuICAgICAgICB2YXIgYWN0aW9uID0gdGFyZ2V0LmFjdGlvbjtcclxuICAgICAgICBpZiAodGFyZ2V0LnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2Zvcm0nICYmICFhY3Rpb24pIHtcclxuICAgICAgICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSwgZmFsc2UpO1xyXG59XHJcbnZhciBBdXJlbGlhID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEF1cmVsaWEobG9hZGVyLCBjb250YWluZXIsIHJlc291cmNlcykge1xyXG4gICAgICAgIHRoaXMubG9hZGVyID0gbG9hZGVyIHx8IG5ldyBQTEFURk9STS5Mb2FkZXIoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lciB8fCAobmV3IENvbnRhaW5lcigpKS5tYWtlR2xvYmFsKCk7XHJcbiAgICAgICAgdGhpcy5yZXNvdXJjZXMgPSByZXNvdXJjZXMgfHwgbmV3IFZpZXdSZXNvdXJjZXMoKTtcclxuICAgICAgICB0aGlzLnVzZSA9IG5ldyBGcmFtZXdvcmtDb25maWd1cmF0aW9uKHRoaXMpO1xyXG4gICAgICAgIHRoaXMubG9nZ2VyID0gVGhlTG9nTWFuYWdlci5nZXRMb2dnZXIoJ2F1cmVsaWEnKTtcclxuICAgICAgICB0aGlzLmhvc3RDb25maWd1cmVkID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5ob3N0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnVzZS5pbnN0YW5jZShBdXJlbGlhLCB0aGlzKTtcclxuICAgICAgICB0aGlzLnVzZS5pbnN0YW5jZShMb2FkZXIsIHRoaXMubG9hZGVyKTtcclxuICAgICAgICB0aGlzLnVzZS5pbnN0YW5jZShWaWV3UmVzb3VyY2VzLCB0aGlzLnJlc291cmNlcyk7XHJcbiAgICB9XHJcbiAgICBBdXJlbGlhLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLl9zdGFydGVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdGFydGVkO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxvZ2dlci5pbmZvKCdBdXJlbGlhIFN0YXJ0aW5nJyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N0YXJ0ZWQgPSB0aGlzLnVzZS5hcHBseSgpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBwcmV2ZW50QWN0aW9ubGVzc0Zvcm1TdWJtaXQoKTtcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5jb250YWluZXIuaGFzUmVzb2x2ZXIoQmluZGluZ0xhbmd1YWdlKSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSAnWW91IG11c3QgY29uZmlndXJlIEF1cmVsaWEgd2l0aCBhIEJpbmRpbmdMYW5ndWFnZSBpbXBsZW1lbnRhdGlvbi4nO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubG9nZ2VyLmVycm9yKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLmxvZ2dlci5pbmZvKCdBdXJlbGlhIFN0YXJ0ZWQnKTtcclxuICAgICAgICAgICAgdmFyIGV2dCA9IERPTS5jcmVhdGVDdXN0b21FdmVudCgnYXVyZWxpYS1zdGFydGVkJywgeyBidWJibGVzOiB0cnVlLCBjYW5jZWxhYmxlOiB0cnVlIH0pO1xyXG4gICAgICAgICAgICBET00uZGlzcGF0Y2hFdmVudChldnQpO1xyXG4gICAgICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgQXVyZWxpYS5wcm90b3R5cGUuZW5oYW5jZSA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgYXBwbGljYXRpb25Ib3N0KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAoYmluZGluZ0NvbnRleHQgPT09IHZvaWQgMCkgeyBiaW5kaW5nQ29udGV4dCA9IHt9OyB9XHJcbiAgICAgICAgaWYgKGFwcGxpY2F0aW9uSG9zdCA9PT0gdm9pZCAwKSB7IGFwcGxpY2F0aW9uSG9zdCA9IG51bGw7IH1cclxuICAgICAgICB0aGlzLl9jb25maWd1cmVIb3N0KGFwcGxpY2F0aW9uSG9zdCB8fCBET00ucXVlcnlTZWxlY3RvckFsbCgnYm9keScpWzBdKTtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHtcclxuICAgICAgICAgICAgdmFyIGVuZ2luZSA9IF90aGlzLmNvbnRhaW5lci5nZXQoVGVtcGxhdGluZ0VuZ2luZSk7XHJcbiAgICAgICAgICAgIF90aGlzLnJvb3QgPSBlbmdpbmUuZW5oYW5jZSh7IGNvbnRhaW5lcjogX3RoaXMuY29udGFpbmVyLCBlbGVtZW50OiBfdGhpcy5ob3N0LCByZXNvdXJjZXM6IF90aGlzLnJlc291cmNlcywgYmluZGluZ0NvbnRleHQ6IGJpbmRpbmdDb250ZXh0IH0pO1xyXG4gICAgICAgICAgICBfdGhpcy5yb290LmF0dGFjaGVkKCk7XHJcbiAgICAgICAgICAgIF90aGlzLl9vbkF1cmVsaWFDb21wb3NlZCgpO1xyXG4gICAgICAgICAgICByZXNvbHZlKF90aGlzKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBBdXJlbGlhLnByb3RvdHlwZS5zZXRSb290ID0gZnVuY3Rpb24gKHJvb3QsIGFwcGxpY2F0aW9uSG9zdCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHJvb3QgPT09IHZvaWQgMCkgeyByb290ID0gbnVsbDsgfVxyXG4gICAgICAgIGlmIChhcHBsaWNhdGlvbkhvc3QgPT09IHZvaWQgMCkgeyBhcHBsaWNhdGlvbkhvc3QgPSBudWxsOyB9XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0ge307XHJcbiAgICAgICAgaWYgKHRoaXMucm9vdCAmJiB0aGlzLnJvb3Qudmlld01vZGVsICYmIHRoaXMucm9vdC52aWV3TW9kZWwucm91dGVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm9vdC52aWV3TW9kZWwucm91dGVyLmRlYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgdGhpcy5yb290LnZpZXdNb2RlbC5yb3V0ZXIucmVzZXQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fY29uZmlndXJlSG9zdChhcHBsaWNhdGlvbkhvc3QpO1xyXG4gICAgICAgIHZhciBlbmdpbmUgPSB0aGlzLmNvbnRhaW5lci5nZXQoVGVtcGxhdGluZ0VuZ2luZSk7XHJcbiAgICAgICAgdmFyIHRyYW5zYWN0aW9uID0gdGhpcy5jb250YWluZXIuZ2V0KENvbXBvc2l0aW9uVHJhbnNhY3Rpb24pO1xyXG4gICAgICAgIGRlbGV0ZSB0cmFuc2FjdGlvbi5pbml0aWFsQ29tcG9zaXRpb247XHJcbiAgICAgICAgaWYgKCFyb290KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbmZpZ01vZHVsZUlkKSB7XHJcbiAgICAgICAgICAgICAgICByb290ID0gcmVsYXRpdmVUb0ZpbGUoJy4vYXBwJywgdGhpcy5jb25maWdNb2R1bGVJZCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByb290ID0gJ2FwcCc7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24udmlld01vZGVsID0gcm9vdDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5jb250YWluZXIgPSBpbnN0cnVjdGlvbi5jaGlsZENvbnRhaW5lciA9IHRoaXMuY29udGFpbmVyO1xyXG4gICAgICAgIGluc3RydWN0aW9uLnZpZXdTbG90ID0gdGhpcy5ob3N0U2xvdDtcclxuICAgICAgICBpbnN0cnVjdGlvbi5ob3N0ID0gdGhpcy5ob3N0O1xyXG4gICAgICAgIHJldHVybiBlbmdpbmUuY29tcG9zZShpbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAocikge1xyXG4gICAgICAgICAgICBfdGhpcy5yb290ID0gcjtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24udmlld1Nsb3QuYXR0YWNoZWQoKTtcclxuICAgICAgICAgICAgX3RoaXMuX29uQXVyZWxpYUNvbXBvc2VkKCk7XHJcbiAgICAgICAgICAgIHJldHVybiBfdGhpcztcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBBdXJlbGlhLnByb3RvdHlwZS5fY29uZmlndXJlSG9zdCA9IGZ1bmN0aW9uIChhcHBsaWNhdGlvbkhvc3QpIHtcclxuICAgICAgICBpZiAodGhpcy5ob3N0Q29uZmlndXJlZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGFwcGxpY2F0aW9uSG9zdCA9IGFwcGxpY2F0aW9uSG9zdCB8fCB0aGlzLmhvc3Q7XHJcbiAgICAgICAgaWYgKCFhcHBsaWNhdGlvbkhvc3QgfHwgdHlwZW9mIGFwcGxpY2F0aW9uSG9zdCA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgdGhpcy5ob3N0ID0gRE9NLmdldEVsZW1lbnRCeUlkKGFwcGxpY2F0aW9uSG9zdCB8fCAnYXBwbGljYXRpb25Ib3N0Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLmhvc3QgPSBhcHBsaWNhdGlvbkhvc3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5ob3N0KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTm8gYXBwbGljYXRpb25Ib3N0IHdhcyBzcGVjaWZpZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaG9zdENvbmZpZ3VyZWQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaG9zdC5hdXJlbGlhID0gdGhpcztcclxuICAgICAgICB0aGlzLmhvc3RTbG90ID0gbmV3IFZpZXdTbG90KHRoaXMuaG9zdCwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5ob3N0U2xvdC50cmFuc2Zvcm1DaGlsZE5vZGVzSW50b1ZpZXcoKTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lci5yZWdpc3Rlckluc3RhbmNlKERPTS5ib3VuZGFyeSwgdGhpcy5ob3N0KTtcclxuICAgIH07XHJcbiAgICBBdXJlbGlhLnByb3RvdHlwZS5fb25BdXJlbGlhQ29tcG9zZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV2dCA9IERPTS5jcmVhdGVDdXN0b21FdmVudCgnYXVyZWxpYS1jb21wb3NlZCcsIHsgYnViYmxlczogdHJ1ZSwgY2FuY2VsYWJsZTogdHJ1ZSB9KTtcclxuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIERPTS5kaXNwYXRjaEV2ZW50KGV2dCk7IH0sIDEpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBBdXJlbGlhO1xyXG59KCkpO1xuXG5leHBvcnQgeyBBdXJlbGlhLCBGcmFtZXdvcmtDb25maWd1cmF0aW9uIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJlbGlhLWZyYW1ld29yay5qcy5tYXBcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWZyYW1ld29yay9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtZnJhbWV3b3JrLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLWZyYW1ld29ya1xuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJpbXBvcnQgeyBIaXN0b3J5IH0gZnJvbSAnYXVyZWxpYS1oaXN0b3J5JztcbmltcG9ydCB7IERPTSwgUExBVEZPUk0gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cclxuTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlXHJcbnRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlXHJcbkxpY2Vuc2UgYXQgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXHJcblxyXG5USElTIENPREUgSVMgUFJPVklERUQgT04gQU4gKkFTIElTKiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXHJcbktJTkQsIEVJVEhFUiBFWFBSRVNTIE9SIElNUExJRUQsIElOQ0xVRElORyBXSVRIT1VUIExJTUlUQVRJT04gQU5ZIElNUExJRURcclxuV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIFRJVExFLCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSxcclxuTUVSQ0hBTlRBQkxJVFkgT1IgTk9OLUlORlJJTkdFTUVOVC5cclxuXHJcblNlZSB0aGUgQXBhY2hlIFZlcnNpb24gMi4wIExpY2Vuc2UgZm9yIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9uc1xyXG5hbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cblxudmFyIExpbmtIYW5kbGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIExpbmtIYW5kbGVyKCkge1xyXG4gICAgfVxyXG4gICAgTGlua0hhbmRsZXIucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24gKGhpc3RvcnkpIHsgfTtcclxuICAgIExpbmtIYW5kbGVyLnByb3RvdHlwZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKCkgeyB9O1xyXG4gICAgcmV0dXJuIExpbmtIYW5kbGVyO1xyXG59KCkpO1xyXG52YXIgRGVmYXVsdExpbmtIYW5kbGVyID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhEZWZhdWx0TGlua0hhbmRsZXIsIF9zdXBlcik7XHJcbiAgICBmdW5jdGlvbiBEZWZhdWx0TGlua0hhbmRsZXIoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5oYW5kbGVyID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgdmFyIF9hID0gRGVmYXVsdExpbmtIYW5kbGVyLmdldEV2ZW50SW5mbyhlKSwgc2hvdWxkSGFuZGxlRXZlbnQgPSBfYS5zaG91bGRIYW5kbGVFdmVudCwgaHJlZiA9IF9hLmhyZWY7XHJcbiAgICAgICAgICAgIGlmIChzaG91bGRIYW5kbGVFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuaGlzdG9yeS5uYXZpZ2F0ZShocmVmKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgRGVmYXVsdExpbmtIYW5kbGVyLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uIChoaXN0b3J5KSB7XHJcbiAgICAgICAgaWYgKGhpc3RvcnkuX2hhc1B1c2hTdGF0ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmhpc3RvcnkgPSBoaXN0b3J5O1xyXG4gICAgICAgICAgICBET00uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZXIsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBEZWZhdWx0TGlua0hhbmRsZXIucHJvdG90eXBlLmRlYWN0aXZhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgRE9NLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVyLCB0cnVlKTtcclxuICAgIH07XHJcbiAgICBEZWZhdWx0TGlua0hhbmRsZXIuZ2V0RXZlbnRJbmZvID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgdmFyICRldmVudCA9IGV2ZW50O1xyXG4gICAgICAgIHZhciBpbmZvID0ge1xyXG4gICAgICAgICAgICBzaG91bGRIYW5kbGVFdmVudDogZmFsc2UsXHJcbiAgICAgICAgICAgIGhyZWY6IG51bGwsXHJcbiAgICAgICAgICAgIGFuY2hvcjogbnVsbFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHRhcmdldCA9IERlZmF1bHRMaW5rSGFuZGxlci5maW5kQ2xvc2VzdEFuY2hvcigkZXZlbnQudGFyZ2V0KTtcclxuICAgICAgICBpZiAoIXRhcmdldCB8fCAhRGVmYXVsdExpbmtIYW5kbGVyLnRhcmdldElzVGhpc1dpbmRvdyh0YXJnZXQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaGFzQXR0cmlidXRlKHRhcmdldCwgJ2Rvd25sb2FkJylcclxuICAgICAgICAgICAgfHwgaGFzQXR0cmlidXRlKHRhcmdldCwgJ3JvdXRlci1pZ25vcmUnKVxyXG4gICAgICAgICAgICB8fCBoYXNBdHRyaWJ1dGUodGFyZ2V0LCAnZGF0YS1yb3V0ZXItaWdub3JlJykpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGluZm87XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgkZXZlbnQuYWx0S2V5IHx8ICRldmVudC5jdHJsS2V5IHx8ICRldmVudC5tZXRhS2V5IHx8ICRldmVudC5zaGlmdEtleSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaW5mbztcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGhyZWYgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCdocmVmJyk7XHJcbiAgICAgICAgaW5mby5hbmNob3IgPSB0YXJnZXQ7XHJcbiAgICAgICAgaW5mby5ocmVmID0gaHJlZjtcclxuICAgICAgICB2YXIgbGVmdEJ1dHRvbkNsaWNrZWQgPSAkZXZlbnQud2hpY2ggPT09IDE7XHJcbiAgICAgICAgdmFyIGlzUmVsYXRpdmUgPSBocmVmICYmICEoaHJlZi5jaGFyQXQoMCkgPT09ICcjJyB8fCAoL15bYS16XSs6L2kpLnRlc3QoaHJlZikpO1xyXG4gICAgICAgIGluZm8uc2hvdWxkSGFuZGxlRXZlbnQgPSBsZWZ0QnV0dG9uQ2xpY2tlZCAmJiBpc1JlbGF0aXZlO1xyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuICAgIERlZmF1bHRMaW5rSGFuZGxlci5maW5kQ2xvc2VzdEFuY2hvciA9IGZ1bmN0aW9uIChlbCkge1xyXG4gICAgICAgIHdoaWxlIChlbCkge1xyXG4gICAgICAgICAgICBpZiAoZWwudGFnTmFtZSA9PT0gJ0EnKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZWw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWwgPSBlbC5wYXJlbnROb2RlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBEZWZhdWx0TGlua0hhbmRsZXIudGFyZ2V0SXNUaGlzV2luZG93ID0gZnVuY3Rpb24gKHRhcmdldCkge1xyXG4gICAgICAgIHZhciB0YXJnZXRXaW5kb3cgPSB0YXJnZXQuZ2V0QXR0cmlidXRlKCd0YXJnZXQnKTtcclxuICAgICAgICB2YXIgd2luID0gUExBVEZPUk0uZ2xvYmFsO1xyXG4gICAgICAgIHJldHVybiAhdGFyZ2V0V2luZG93IHx8XHJcbiAgICAgICAgICAgIHRhcmdldFdpbmRvdyA9PT0gd2luLm5hbWUgfHxcclxuICAgICAgICAgICAgdGFyZ2V0V2luZG93ID09PSAnX3NlbGYnO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBEZWZhdWx0TGlua0hhbmRsZXI7XHJcbn0oTGlua0hhbmRsZXIpKTtcclxudmFyIGhhc0F0dHJpYnV0ZSA9IGZ1bmN0aW9uIChlbCwgYXR0cikgeyByZXR1cm4gZWwuaGFzQXR0cmlidXRlKGF0dHIpOyB9O1xuXG52YXIgQnJvd3Nlckhpc3RvcnkgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgX19leHRlbmRzKEJyb3dzZXJIaXN0b3J5LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gQnJvd3Nlckhpc3RvcnkobGlua0hhbmRsZXIpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIF90aGlzLl9jaGVja1VybENhbGxiYWNrID0gX3RoaXMuX2NoZWNrVXJsLmJpbmQoX3RoaXMpO1xyXG4gICAgICAgIF90aGlzLmxvY2F0aW9uID0gUExBVEZPUk0ubG9jYXRpb247XHJcbiAgICAgICAgX3RoaXMuaGlzdG9yeSA9IFBMQVRGT1JNLmhpc3Rvcnk7XHJcbiAgICAgICAgX3RoaXMubGlua0hhbmRsZXIgPSBsaW5rSGFuZGxlcjtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gICAgICAgIGlmICh0aGlzLl9pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0hpc3RvcnkgaGFzIGFscmVhZHkgYmVlbiBhY3RpdmF0ZWQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciAkaGlzdG9yeSA9IHRoaXMuaGlzdG9yeTtcclxuICAgICAgICB2YXIgd2FudHNQdXNoU3RhdGUgPSAhIW9wdGlvbnMucHVzaFN0YXRlO1xyXG4gICAgICAgIHRoaXMuX2lzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB2YXIgbm9ybWFsaXplZE9wdGlvbnMgPSB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB7IHJvb3Q6ICcvJyB9LCB0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgICAgIHZhciByb290VXJsID0gdGhpcy5yb290ID0gKCcvJyArIG5vcm1hbGl6ZWRPcHRpb25zLnJvb3QgKyAnLycpLnJlcGxhY2Uocm9vdFN0cmlwcGVyLCAnLycpO1xyXG4gICAgICAgIHZhciB3YW50c0hhc2hDaGFuZ2UgPSB0aGlzLl93YW50c0hhc2hDaGFuZ2UgPSBub3JtYWxpemVkT3B0aW9ucy5oYXNoQ2hhbmdlICE9PSBmYWxzZTtcclxuICAgICAgICB2YXIgaGFzUHVzaFN0YXRlID0gdGhpcy5faGFzUHVzaFN0YXRlID0gISEobm9ybWFsaXplZE9wdGlvbnMucHVzaFN0YXRlICYmICRoaXN0b3J5ICYmICRoaXN0b3J5LnB1c2hTdGF0ZSk7XHJcbiAgICAgICAgdmFyIGV2ZW50TmFtZTtcclxuICAgICAgICBpZiAoaGFzUHVzaFN0YXRlKSB7XHJcbiAgICAgICAgICAgIGV2ZW50TmFtZSA9ICdwb3BzdGF0ZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHdhbnRzSGFzaENoYW5nZSkge1xyXG4gICAgICAgICAgICBldmVudE5hbWUgPSAnaGFzaGNoYW5nZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFBMQVRGT1JNLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnROYW1lLCB0aGlzLl9jaGVja1VybENhbGxiYWNrKTtcclxuICAgICAgICBpZiAod2FudHNIYXNoQ2hhbmdlICYmIHdhbnRzUHVzaFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHZhciAkbG9jYXRpb24gPSB0aGlzLmxvY2F0aW9uO1xyXG4gICAgICAgICAgICB2YXIgYXRSb290ID0gJGxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoL1teXFwvXSQvLCAnJCYvJykgPT09IHJvb3RVcmw7XHJcbiAgICAgICAgICAgIGlmICghaGFzUHVzaFN0YXRlICYmICFhdFJvb3QpIHtcclxuICAgICAgICAgICAgICAgIHZhciBmcmFnbWVudCA9IHRoaXMuZnJhZ21lbnQgPSB0aGlzLl9nZXRGcmFnbWVudChudWxsLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5yZXBsYWNlKHJvb3RVcmwgKyAkbG9jYXRpb24uc2VhcmNoICsgJyMnICsgZnJhZ21lbnQpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaGFzUHVzaFN0YXRlICYmIGF0Um9vdCAmJiAkbG9jYXRpb24uaGFzaCkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEhhc2goKS5yZXBsYWNlKHJvdXRlU3RyaXBwZXIsICcnKTtcclxuICAgICAgICAgICAgICAgICRoaXN0b3J5LnJlcGxhY2VTdGF0ZSh7fSwgRE9NLnRpdGxlLCByb290VXJsICsgZnJhZ21lbnQgKyAkbG9jYXRpb24uc2VhcmNoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMuZnJhZ21lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEZyYWdtZW50KCcnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5saW5rSGFuZGxlci5hY3RpdmF0ZSh0aGlzKTtcclxuICAgICAgICBpZiAoIW5vcm1hbGl6ZWRPcHRpb25zLnNpbGVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZFVybCgnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5kZWFjdGl2YXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBoYW5kbGVyID0gdGhpcy5fY2hlY2tVcmxDYWxsYmFjaztcclxuICAgICAgICBQTEFURk9STS5yZW1vdmVFdmVudExpc3RlbmVyKCdwb3BzdGF0ZScsIGhhbmRsZXIpO1xyXG4gICAgICAgIFBMQVRGT1JNLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2hhc2hjaGFuZ2UnLCBoYW5kbGVyKTtcclxuICAgICAgICB0aGlzLl9pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubGlua0hhbmRsZXIuZGVhY3RpdmF0ZSgpO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5nZXRBYnNvbHV0ZVJvb3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyICRsb2NhdGlvbiA9IHRoaXMubG9jYXRpb247XHJcbiAgICAgICAgdmFyIG9yaWdpbiA9IGNyZWF0ZU9yaWdpbigkbG9jYXRpb24ucHJvdG9jb2wsICRsb2NhdGlvbi5ob3N0bmFtZSwgJGxvY2F0aW9uLnBvcnQpO1xyXG4gICAgICAgIHJldHVybiBcIlwiICsgb3JpZ2luICsgdGhpcy5yb290O1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5uYXZpZ2F0ZSA9IGZ1bmN0aW9uIChmcmFnbWVudCwgX2EpIHtcclxuICAgICAgICB2YXIgX2IgPSBfYSA9PT0gdm9pZCAwID8ge30gOiBfYSwgX2MgPSBfYi50cmlnZ2VyLCB0cmlnZ2VyID0gX2MgPT09IHZvaWQgMCA/IHRydWUgOiBfYywgX2QgPSBfYi5yZXBsYWNlLCByZXBsYWNlID0gX2QgPT09IHZvaWQgMCA/IGZhbHNlIDogX2Q7XHJcbiAgICAgICAgdmFyIGxvY2F0aW9uID0gdGhpcy5sb2NhdGlvbjtcclxuICAgICAgICBpZiAoZnJhZ21lbnQgJiYgYWJzb2x1dGVVcmwudGVzdChmcmFnbWVudCkpIHtcclxuICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9IGZyYWdtZW50O1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLl9pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZyYWdtZW50ID0gdGhpcy5fZ2V0RnJhZ21lbnQoZnJhZ21lbnQgfHwgJycpO1xyXG4gICAgICAgIGlmICh0aGlzLmZyYWdtZW50ID09PSBmcmFnbWVudCAmJiAhcmVwbGFjZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZnJhZ21lbnQgPSBmcmFnbWVudDtcclxuICAgICAgICB2YXIgdXJsID0gdGhpcy5yb290ICsgZnJhZ21lbnQ7XHJcbiAgICAgICAgaWYgKGZyYWdtZW50ID09PSAnJyAmJiB1cmwgIT09ICcvJykge1xyXG4gICAgICAgICAgICB1cmwgPSB1cmwuc2xpY2UoMCwgLTEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5faGFzUHVzaFN0YXRlKSB7XHJcbiAgICAgICAgICAgIHVybCA9IHVybC5yZXBsYWNlKCcvLycsICcvJyk7XHJcbiAgICAgICAgICAgIHRoaXMuaGlzdG9yeVtyZXBsYWNlID8gJ3JlcGxhY2VTdGF0ZScgOiAncHVzaFN0YXRlJ10oe30sIERPTS50aXRsZSwgdXJsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5fd2FudHNIYXNoQ2hhbmdlKSB7XHJcbiAgICAgICAgICAgIHVwZGF0ZUhhc2gobG9jYXRpb24sIGZyYWdtZW50LCByZXBsYWNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIGxvY2F0aW9uLmFzc2lnbih1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHJpZ2dlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fbG9hZFVybChmcmFnbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5uYXZpZ2F0ZUJhY2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy5oaXN0b3J5LmJhY2soKTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuc2V0VGl0bGUgPSBmdW5jdGlvbiAodGl0bGUpIHtcclxuICAgICAgICBET00udGl0bGUgPSB0aXRsZTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciAkaGlzdG9yeSA9IHRoaXMuaGlzdG9yeTtcclxuICAgICAgICB2YXIgc3RhdGUgPSBPYmplY3QuYXNzaWduKHt9LCAkaGlzdG9yeS5zdGF0ZSk7XHJcbiAgICAgICAgdmFyIF9hID0gdGhpcy5sb2NhdGlvbiwgcGF0aG5hbWUgPSBfYS5wYXRobmFtZSwgc2VhcmNoID0gX2Euc2VhcmNoLCBoYXNoID0gX2EuaGFzaDtcclxuICAgICAgICBzdGF0ZVtrZXldID0gdmFsdWU7XHJcbiAgICAgICAgJGhpc3RvcnkucmVwbGFjZVN0YXRlKHN0YXRlLCBudWxsLCBcIlwiICsgcGF0aG5hbWUgKyBzZWFyY2ggKyBoYXNoKTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuZ2V0U3RhdGUgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgdmFyIHN0YXRlID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5oaXN0b3J5LnN0YXRlKTtcclxuICAgICAgICByZXR1cm4gc3RhdGVba2V5XTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuZ2V0SGlzdG9yeUluZGV4ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBoaXN0b3J5SW5kZXggPSB0aGlzLmdldFN0YXRlKCdIaXN0b3J5SW5kZXgnKTtcclxuICAgICAgICBpZiAoaGlzdG9yeUluZGV4ID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgaGlzdG9yeUluZGV4ID0gdGhpcy5oaXN0b3J5Lmxlbmd0aCAtIDE7XHJcbiAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoJ0hpc3RvcnlJbmRleCcsIGhpc3RvcnlJbmRleCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBoaXN0b3J5SW5kZXg7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLmdvID0gZnVuY3Rpb24gKG1vdmVtZW50KSB7XHJcbiAgICAgICAgdGhpcy5oaXN0b3J5LmdvKG1vdmVtZW50KTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5wcm90b3R5cGUuX2dldEhhc2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYXRpb24uaGFzaC5zdWJzdHIoMSk7XHJcbiAgICB9O1xyXG4gICAgQnJvd3Nlckhpc3RvcnkucHJvdG90eXBlLl9nZXRGcmFnbWVudCA9IGZ1bmN0aW9uIChmcmFnbWVudCwgZm9yY2VQdXNoU3RhdGUpIHtcclxuICAgICAgICB2YXIgcm9vdFVybDtcclxuICAgICAgICBpZiAoIWZyYWdtZW50KSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLl9oYXNQdXNoU3RhdGUgfHwgIXRoaXMuX3dhbnRzSGFzaENoYW5nZSB8fCBmb3JjZVB1c2hTdGF0ZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uXzEgPSB0aGlzLmxvY2F0aW9uO1xyXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBsb2NhdGlvbl8xLnBhdGhuYW1lICsgbG9jYXRpb25fMS5zZWFyY2g7XHJcbiAgICAgICAgICAgICAgICByb290VXJsID0gdGhpcy5yb290LnJlcGxhY2UodHJhaWxpbmdTbGFzaCwgJycpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmcmFnbWVudC5pbmRleE9mKHJvb3RVcmwpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJhZ21lbnQgPSBmcmFnbWVudC5zdWJzdHIocm9vdFVybC5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZnJhZ21lbnQgPSB0aGlzLl9nZXRIYXNoKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICcvJyArIGZyYWdtZW50LnJlcGxhY2Uocm91dGVTdHJpcHBlciwgJycpO1xyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5fY2hlY2tVcmwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGN1cnJlbnQgPSB0aGlzLl9nZXRGcmFnbWVudCgnJyk7XHJcbiAgICAgICAgaWYgKGN1cnJlbnQgIT09IHRoaXMuZnJhZ21lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fbG9hZFVybCgnJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEJyb3dzZXJIaXN0b3J5LnByb3RvdHlwZS5fbG9hZFVybCA9IGZ1bmN0aW9uIChmcmFnbWVudE92ZXJyaWRlKSB7XHJcbiAgICAgICAgdmFyIGZyYWdtZW50ID0gdGhpcy5mcmFnbWVudCA9IHRoaXMuX2dldEZyYWdtZW50KGZyYWdtZW50T3ZlcnJpZGUpO1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMucm91dGVIYW5kbGVyID9cclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLnJvdXRlSGFuZGxlcihmcmFnbWVudCkgOlxyXG4gICAgICAgICAgICBmYWxzZTtcclxuICAgIH07XHJcbiAgICBCcm93c2VySGlzdG9yeS5pbmplY3QgPSBbTGlua0hhbmRsZXJdO1xyXG4gICAgcmV0dXJuIEJyb3dzZXJIaXN0b3J5O1xyXG59KEhpc3RvcnkpKTtcclxudmFyIHJvdXRlU3RyaXBwZXIgPSAvXiM/XFwvKnxcXHMrJC9nO1xyXG52YXIgcm9vdFN0cmlwcGVyID0gL15cXC8rfFxcLyskL2c7XHJcbnZhciB0cmFpbGluZ1NsYXNoID0gL1xcLyQvO1xyXG52YXIgYWJzb2x1dGVVcmwgPSAvXihbYS16XVthLXowLTkrXFwtLl0qOik/XFwvXFwvL2k7XHJcbmZ1bmN0aW9uIHVwZGF0ZUhhc2goJGxvY2F0aW9uLCBmcmFnbWVudCwgcmVwbGFjZSkge1xyXG4gICAgaWYgKHJlcGxhY2UpIHtcclxuICAgICAgICB2YXIgaHJlZiA9ICRsb2NhdGlvbi5ocmVmLnJlcGxhY2UoLyhqYXZhc2NyaXB0OnwjKS4qJC8sICcnKTtcclxuICAgICAgICAkbG9jYXRpb24ucmVwbGFjZShocmVmICsgJyMnICsgZnJhZ21lbnQpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgJGxvY2F0aW9uLmhhc2ggPSAnIycgKyBmcmFnbWVudDtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjcmVhdGVPcmlnaW4ocHJvdG9jb2wsIGhvc3RuYW1lLCBwb3J0KSB7XHJcbiAgICByZXR1cm4gcHJvdG9jb2wgKyBcIi8vXCIgKyBob3N0bmFtZSArIChwb3J0ID8gJzonICsgcG9ydCA6ICcnKTtcclxufVxuXG5mdW5jdGlvbiBjb25maWd1cmUoY29uZmlnKSB7XHJcbiAgICB2YXIgJGNvbmZpZyA9IGNvbmZpZztcclxuICAgICRjb25maWcuc2luZ2xldG9uKEhpc3RvcnksIEJyb3dzZXJIaXN0b3J5KTtcclxuICAgICRjb25maWcudHJhbnNpZW50KExpbmtIYW5kbGVyLCBEZWZhdWx0TGlua0hhbmRsZXIpO1xyXG59XG5cbmV4cG9ydCB7IEJyb3dzZXJIaXN0b3J5LCBEZWZhdWx0TGlua0hhbmRsZXIsIExpbmtIYW5kbGVyLCBjb25maWd1cmUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cmVsaWEtaGlzdG9yeS1icm93c2VyLmpzLm1hcFxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtaGlzdG9yeS1icm93c2VyL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1oaXN0b3J5LWJyb3dzZXIuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtaGlzdG9yeS1icm93c2VyXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsIlxuXG5leHBvcnQgdmFyIENvbnNvbGVBcHBlbmRlciA9IGZ1bmN0aW9uICgpIHtcbiAgZnVuY3Rpb24gQ29uc29sZUFwcGVuZGVyKCkge1xuICAgIFxuICB9XG5cbiAgQ29uc29sZUFwcGVuZGVyLnByb3RvdHlwZS5kZWJ1ZyA9IGZ1bmN0aW9uIGRlYnVnKGxvZ2dlcikge1xuICAgIHZhciBfY29uc29sZTtcblxuICAgIGZvciAodmFyIF9sZW4gPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbiA+IDEgPyBfbGVuIC0gMSA6IDApLCBfa2V5ID0gMTsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgcmVzdFtfa2V5IC0gMV0gPSBhcmd1bWVudHNbX2tleV07XG4gICAgfVxuXG4gICAgKF9jb25zb2xlID0gY29uc29sZSkuZGVidWcuYXBwbHkoX2NvbnNvbGUsIFtcIkRFQlVHIFtcIiArIGxvZ2dlci5pZCArIFwiXVwiXS5jb25jYXQocmVzdCkpO1xuICB9O1xuXG4gIENvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuaW5mbyA9IGZ1bmN0aW9uIGluZm8obG9nZ2VyKSB7XG4gICAgdmFyIF9jb25zb2xlMjtcblxuICAgIGZvciAodmFyIF9sZW4yID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4yID4gMSA/IF9sZW4yIC0gMSA6IDApLCBfa2V5MiA9IDE7IF9rZXkyIDwgX2xlbjI7IF9rZXkyKyspIHtcbiAgICAgIHJlc3RbX2tleTIgLSAxXSA9IGFyZ3VtZW50c1tfa2V5Ml07XG4gICAgfVxuXG4gICAgKF9jb25zb2xlMiA9IGNvbnNvbGUpLmluZm8uYXBwbHkoX2NvbnNvbGUyLCBbXCJJTkZPIFtcIiArIGxvZ2dlci5pZCArIFwiXVwiXS5jb25jYXQocmVzdCkpO1xuICB9O1xuXG4gIENvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUud2FybiA9IGZ1bmN0aW9uIHdhcm4obG9nZ2VyKSB7XG4gICAgdmFyIF9jb25zb2xlMztcblxuICAgIGZvciAodmFyIF9sZW4zID0gYXJndW1lbnRzLmxlbmd0aCwgcmVzdCA9IEFycmF5KF9sZW4zID4gMSA/IF9sZW4zIC0gMSA6IDApLCBfa2V5MyA9IDE7IF9rZXkzIDwgX2xlbjM7IF9rZXkzKyspIHtcbiAgICAgIHJlc3RbX2tleTMgLSAxXSA9IGFyZ3VtZW50c1tfa2V5M107XG4gICAgfVxuXG4gICAgKF9jb25zb2xlMyA9IGNvbnNvbGUpLndhcm4uYXBwbHkoX2NvbnNvbGUzLCBbXCJXQVJOIFtcIiArIGxvZ2dlci5pZCArIFwiXVwiXS5jb25jYXQocmVzdCkpO1xuICB9O1xuXG4gIENvbnNvbGVBcHBlbmRlci5wcm90b3R5cGUuZXJyb3IgPSBmdW5jdGlvbiBlcnJvcihsb2dnZXIpIHtcbiAgICB2YXIgX2NvbnNvbGU0O1xuXG4gICAgZm9yICh2YXIgX2xlbjQgPSBhcmd1bWVudHMubGVuZ3RoLCByZXN0ID0gQXJyYXkoX2xlbjQgPiAxID8gX2xlbjQgLSAxIDogMCksIF9rZXk0ID0gMTsgX2tleTQgPCBfbGVuNDsgX2tleTQrKykge1xuICAgICAgcmVzdFtfa2V5NCAtIDFdID0gYXJndW1lbnRzW19rZXk0XTtcbiAgICB9XG5cbiAgICAoX2NvbnNvbGU0ID0gY29uc29sZSkuZXJyb3IuYXBwbHkoX2NvbnNvbGU0LCBbXCJFUlJPUiBbXCIgKyBsb2dnZXIuaWQgKyBcIl1cIl0uY29uY2F0KHJlc3QpKTtcbiAgfTtcblxuICByZXR1cm4gQ29uc29sZUFwcGVuZGVyO1xufSgpO1xuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLWxvZ2dpbmctY29uc29sZS9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtbG9nZ2luZy1jb25zb2xlLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLWxvZ2dpbmctY29uc29sZVxuLy8gbW9kdWxlIGNodW5rcyA9IDEiLCJcblxuaW1wb3J0IHsgYnVpbGRRdWVyeVN0cmluZywgcGFyc2VRdWVyeVN0cmluZyB9IGZyb20gJ2F1cmVsaWEtcGF0aCc7XG5cbmV4cG9ydCB2YXIgU3RhdGUgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0YXRlKGNoYXJTcGVjKSB7XG4gICAgXG5cbiAgICB0aGlzLmNoYXJTcGVjID0gY2hhclNwZWM7XG4gICAgdGhpcy5uZXh0U3RhdGVzID0gW107XG4gIH1cblxuICBTdGF0ZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KGNoYXJTcGVjKSB7XG4gICAgZm9yICh2YXIgX2l0ZXJhdG9yID0gdGhpcy5uZXh0U3RhdGVzLCBfaXNBcnJheSA9IEFycmF5LmlzQXJyYXkoX2l0ZXJhdG9yKSwgX2kgPSAwLCBfaXRlcmF0b3IgPSBfaXNBcnJheSA/IF9pdGVyYXRvciA6IF9pdGVyYXRvcltTeW1ib2wuaXRlcmF0b3JdKCk7Oykge1xuICAgICAgdmFyIF9yZWY7XG5cbiAgICAgIGlmIChfaXNBcnJheSkge1xuICAgICAgICBpZiAoX2kgPj0gX2l0ZXJhdG9yLmxlbmd0aCkgYnJlYWs7XG4gICAgICAgIF9yZWYgPSBfaXRlcmF0b3JbX2krK107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBfaSA9IF9pdGVyYXRvci5uZXh0KCk7XG4gICAgICAgIGlmIChfaS5kb25lKSBicmVhaztcbiAgICAgICAgX3JlZiA9IF9pLnZhbHVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgY2hpbGQgPSBfcmVmO1xuXG4gICAgICB2YXIgaXNFcXVhbCA9IGNoaWxkLmNoYXJTcGVjLnZhbGlkQ2hhcnMgPT09IGNoYXJTcGVjLnZhbGlkQ2hhcnMgJiYgY2hpbGQuY2hhclNwZWMuaW52YWxpZENoYXJzID09PSBjaGFyU3BlYy5pbnZhbGlkQ2hhcnM7XG5cbiAgICAgIGlmIChpc0VxdWFsKSB7XG4gICAgICAgIHJldHVybiBjaGlsZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9O1xuXG4gIFN0YXRlLnByb3RvdHlwZS5wdXQgPSBmdW5jdGlvbiBwdXQoY2hhclNwZWMpIHtcbiAgICB2YXIgc3RhdGUgPSB0aGlzLmdldChjaGFyU3BlYyk7XG5cbiAgICBpZiAoc3RhdGUpIHtcbiAgICAgIHJldHVybiBzdGF0ZTtcbiAgICB9XG5cbiAgICBzdGF0ZSA9IG5ldyBTdGF0ZShjaGFyU3BlYyk7XG5cbiAgICB0aGlzLm5leHRTdGF0ZXMucHVzaChzdGF0ZSk7XG5cbiAgICBpZiAoY2hhclNwZWMucmVwZWF0KSB7XG4gICAgICBzdGF0ZS5uZXh0U3RhdGVzLnB1c2goc3RhdGUpO1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0ZTtcbiAgfTtcblxuICBTdGF0ZS5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiBtYXRjaChjaCkge1xuICAgIHZhciBuZXh0U3RhdGVzID0gdGhpcy5uZXh0U3RhdGVzO1xuICAgIHZhciByZXN1bHRzID0gW107XG5cbiAgICBmb3IgKHZhciBpID0gMCwgbCA9IG5leHRTdGF0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICB2YXIgY2hpbGQgPSBuZXh0U3RhdGVzW2ldO1xuICAgICAgdmFyIGNoYXJTcGVjID0gY2hpbGQuY2hhclNwZWM7XG5cbiAgICAgIGlmIChjaGFyU3BlYy52YWxpZENoYXJzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGNoYXJTcGVjLnZhbGlkQ2hhcnMuaW5kZXhPZihjaCkgIT09IC0xKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGNoaWxkKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChjaGFyU3BlYy5pbnZhbGlkQ2hhcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY2hhclNwZWMuaW52YWxpZENoYXJzLmluZGV4T2YoY2gpID09PSAtMSkge1xuICAgICAgICAgIHJlc3VsdHMucHVzaChjaGlsZCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gU3RhdGU7XG59KCk7XG5cbnZhciBzcGVjaWFscyA9IFsnLycsICcuJywgJyonLCAnKycsICc/JywgJ3wnLCAnKCcsICcpJywgJ1snLCAnXScsICd7JywgJ30nLCAnXFxcXCddO1xuXG52YXIgZXNjYXBlUmVnZXggPSBuZXcgUmVnRXhwKCcoXFxcXCcgKyBzcGVjaWFscy5qb2luKCd8XFxcXCcpICsgJyknLCAnZycpO1xuXG5leHBvcnQgdmFyIFN0YXRpY1NlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0YXRpY1NlZ21lbnQoc3RyaW5nLCBjYXNlU2Vuc2l0aXZlKSB7XG4gICAgXG5cbiAgICB0aGlzLnN0cmluZyA9IHN0cmluZztcbiAgICB0aGlzLmNhc2VTZW5zaXRpdmUgPSBjYXNlU2Vuc2l0aXZlO1xuICB9XG5cbiAgU3RhdGljU2VnbWVudC5wcm90b3R5cGUuZWFjaENoYXIgPSBmdW5jdGlvbiBlYWNoQ2hhcihjYWxsYmFjaykge1xuICAgIHZhciBzID0gdGhpcy5zdHJpbmc7XG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XG4gICAgICB2YXIgY2ggPSBzW2ldO1xuICAgICAgY2FsbGJhY2soeyB2YWxpZENoYXJzOiB0aGlzLmNhc2VTZW5zaXRpdmUgPyBjaCA6IGNoLnRvVXBwZXJDYXNlKCkgKyBjaC50b0xvd2VyQ2FzZSgpIH0pO1xuICAgIH1cbiAgfTtcblxuICBTdGF0aWNTZWdtZW50LnByb3RvdHlwZS5yZWdleCA9IGZ1bmN0aW9uIHJlZ2V4KCkge1xuICAgIHJldHVybiB0aGlzLnN0cmluZy5yZXBsYWNlKGVzY2FwZVJlZ2V4LCAnXFxcXCQxJyk7XG4gIH07XG5cbiAgU3RhdGljU2VnbWVudC5wcm90b3R5cGUuZ2VuZXJhdGUgPSBmdW5jdGlvbiBnZW5lcmF0ZSgpIHtcbiAgICByZXR1cm4gdGhpcy5zdHJpbmc7XG4gIH07XG5cbiAgcmV0dXJuIFN0YXRpY1NlZ21lbnQ7XG59KCk7XG5cbmV4cG9ydCB2YXIgRHluYW1pY1NlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIER5bmFtaWNTZWdtZW50KG5hbWUsIG9wdGlvbmFsKSB7XG4gICAgXG5cbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgIHRoaXMub3B0aW9uYWwgPSBvcHRpb25hbDtcbiAgfVxuXG4gIER5bmFtaWNTZWdtZW50LnByb3RvdHlwZS5lYWNoQ2hhciA9IGZ1bmN0aW9uIGVhY2hDaGFyKGNhbGxiYWNrKSB7XG4gICAgY2FsbGJhY2soeyBpbnZhbGlkQ2hhcnM6ICcvJywgcmVwZWF0OiB0cnVlIH0pO1xuICB9O1xuXG4gIER5bmFtaWNTZWdtZW50LnByb3RvdHlwZS5yZWdleCA9IGZ1bmN0aW9uIHJlZ2V4KCkge1xuICAgIHJldHVybiAnKFteL10rKSc7XG4gIH07XG5cbiAgRHluYW1pY1NlZ21lbnQucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUocGFyYW1zLCBjb25zdW1lZCkge1xuICAgIGNvbnN1bWVkW3RoaXMubmFtZV0gPSB0cnVlO1xuICAgIHJldHVybiBwYXJhbXNbdGhpcy5uYW1lXTtcbiAgfTtcblxuICByZXR1cm4gRHluYW1pY1NlZ21lbnQ7XG59KCk7XG5cbmV4cG9ydCB2YXIgU3RhclNlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFN0YXJTZWdtZW50KG5hbWUpIHtcbiAgICBcblxuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gIH1cblxuICBTdGFyU2VnbWVudC5wcm90b3R5cGUuZWFjaENoYXIgPSBmdW5jdGlvbiBlYWNoQ2hhcihjYWxsYmFjaykge1xuICAgIGNhbGxiYWNrKHsgaW52YWxpZENoYXJzOiAnJywgcmVwZWF0OiB0cnVlIH0pO1xuICB9O1xuXG4gIFN0YXJTZWdtZW50LnByb3RvdHlwZS5yZWdleCA9IGZ1bmN0aW9uIHJlZ2V4KCkge1xuICAgIHJldHVybiAnKC4rKSc7XG4gIH07XG5cbiAgU3RhclNlZ21lbnQucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUocGFyYW1zLCBjb25zdW1lZCkge1xuICAgIGNvbnN1bWVkW3RoaXMubmFtZV0gPSB0cnVlO1xuICAgIHJldHVybiBwYXJhbXNbdGhpcy5uYW1lXTtcbiAgfTtcblxuICByZXR1cm4gU3RhclNlZ21lbnQ7XG59KCk7XG5cbmV4cG9ydCB2YXIgRXBzaWxvblNlZ21lbnQgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIEVwc2lsb25TZWdtZW50KCkge1xuICAgIFxuICB9XG5cbiAgRXBzaWxvblNlZ21lbnQucHJvdG90eXBlLmVhY2hDaGFyID0gZnVuY3Rpb24gZWFjaENoYXIoKSB7fTtcblxuICBFcHNpbG9uU2VnbWVudC5wcm90b3R5cGUucmVnZXggPSBmdW5jdGlvbiByZWdleCgpIHtcbiAgICByZXR1cm4gJyc7XG4gIH07XG5cbiAgRXBzaWxvblNlZ21lbnQucHJvdG90eXBlLmdlbmVyYXRlID0gZnVuY3Rpb24gZ2VuZXJhdGUoKSB7XG4gICAgcmV0dXJuICcnO1xuICB9O1xuXG4gIHJldHVybiBFcHNpbG9uU2VnbWVudDtcbn0oKTtcblxuZXhwb3J0IHZhciBSb3V0ZVJlY29nbml6ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIGZ1bmN0aW9uIFJvdXRlUmVjb2duaXplcigpIHtcbiAgICBcblxuICAgIHRoaXMucm9vdFN0YXRlID0gbmV3IFN0YXRlKCk7XG4gICAgdGhpcy5uYW1lcyA9IHt9O1xuICAgIHRoaXMucm91dGVzID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5hZGQgPSBmdW5jdGlvbiBhZGQocm91dGUpIHtcbiAgICB2YXIgX3RoaXMgPSB0aGlzO1xuXG4gICAgaWYgKEFycmF5LmlzQXJyYXkocm91dGUpKSB7XG4gICAgICByb3V0ZS5mb3JFYWNoKGZ1bmN0aW9uIChyKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5hZGQocik7XG4gICAgICB9KTtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdmFyIGN1cnJlbnRTdGF0ZSA9IHRoaXMucm9vdFN0YXRlO1xuICAgIHZhciBza2lwcGFibGVTdGF0ZXMgPSBbXTtcbiAgICB2YXIgcmVnZXggPSAnXic7XG4gICAgdmFyIHR5cGVzID0geyBzdGF0aWNzOiAwLCBkeW5hbWljczogMCwgc3RhcnM6IDAgfTtcbiAgICB2YXIgbmFtZXMgPSBbXTtcbiAgICB2YXIgcm91dGVOYW1lID0gcm91dGUuaGFuZGxlci5uYW1lO1xuICAgIHZhciBpc0VtcHR5ID0gdHJ1ZTtcbiAgICB2YXIgc2VnbWVudHMgPSBwYXJzZShyb3V0ZS5wYXRoLCBuYW1lcywgdHlwZXMsIHJvdXRlLmNhc2VTZW5zaXRpdmUpO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xuICAgICAgdmFyIHNlZ21lbnQgPSBzZWdtZW50c1tpXTtcbiAgICAgIGlmIChzZWdtZW50IGluc3RhbmNlb2YgRXBzaWxvblNlZ21lbnQpIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIHZhciBfYWRkU2VnbWVudCA9IGFkZFNlZ21lbnQoY3VycmVudFN0YXRlLCBzZWdtZW50KSxcbiAgICAgICAgICBmaXJzdFN0YXRlID0gX2FkZFNlZ21lbnRbMF0sXG4gICAgICAgICAgbmV4dFN0YXRlID0gX2FkZFNlZ21lbnRbMV07XG5cbiAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHNraXBwYWJsZVN0YXRlcy5sZW5ndGg7IGogPCBqajsgaisrKSB7XG4gICAgICAgIHNraXBwYWJsZVN0YXRlc1tqXS5uZXh0U3RhdGVzLnB1c2goZmlyc3RTdGF0ZSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzZWdtZW50Lm9wdGlvbmFsKSB7XG4gICAgICAgIHNraXBwYWJsZVN0YXRlcy5wdXNoKG5leHRTdGF0ZSk7XG4gICAgICAgIHJlZ2V4ICs9ICcoPzovJyArIHNlZ21lbnQucmVnZXgoKSArICcpPyc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjdXJyZW50U3RhdGUgPSBuZXh0U3RhdGU7XG4gICAgICAgIHJlZ2V4ICs9ICcvJyArIHNlZ21lbnQucmVnZXgoKTtcbiAgICAgICAgc2tpcHBhYmxlU3RhdGVzLmxlbmd0aCA9IDA7XG4gICAgICAgIGlzRW1wdHkgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoaXNFbXB0eSkge1xuICAgICAgY3VycmVudFN0YXRlID0gY3VycmVudFN0YXRlLnB1dCh7IHZhbGlkQ2hhcnM6ICcvJyB9KTtcbiAgICAgIHJlZ2V4ICs9ICcvPyc7XG4gICAgfVxuXG4gICAgdmFyIGhhbmRsZXJzID0gW3sgaGFuZGxlcjogcm91dGUuaGFuZGxlciwgbmFtZXM6IG5hbWVzIH1dO1xuXG4gICAgdGhpcy5yb3V0ZXMuc2V0KHJvdXRlLmhhbmRsZXIsIHsgc2VnbWVudHM6IHNlZ21lbnRzLCBoYW5kbGVyczogaGFuZGxlcnMgfSk7XG4gICAgaWYgKHJvdXRlTmFtZSkge1xuICAgICAgdmFyIHJvdXRlTmFtZXMgPSBBcnJheS5pc0FycmF5KHJvdXRlTmFtZSkgPyByb3V0ZU5hbWUgOiBbcm91dGVOYW1lXTtcbiAgICAgIGZvciAodmFyIF9pMiA9IDA7IF9pMiA8IHJvdXRlTmFtZXMubGVuZ3RoOyBfaTIrKykge1xuICAgICAgICBpZiAoIShyb3V0ZU5hbWVzW19pMl0gaW4gdGhpcy5uYW1lcykpIHtcbiAgICAgICAgICB0aGlzLm5hbWVzW3JvdXRlTmFtZXNbX2kyXV0gPSB7IHNlZ21lbnRzOiBzZWdtZW50cywgaGFuZGxlcnM6IGhhbmRsZXJzIH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCBza2lwcGFibGVTdGF0ZXMubGVuZ3RoOyBfaTMrKykge1xuICAgICAgdmFyIHN0YXRlID0gc2tpcHBhYmxlU3RhdGVzW19pM107XG4gICAgICBzdGF0ZS5oYW5kbGVycyA9IGhhbmRsZXJzO1xuICAgICAgc3RhdGUucmVnZXggPSBuZXcgUmVnRXhwKHJlZ2V4ICsgJyQnLCByb3V0ZS5jYXNlU2Vuc2l0aXZlID8gJycgOiAnaScpO1xuICAgICAgc3RhdGUudHlwZXMgPSB0eXBlcztcbiAgICB9XG5cbiAgICBjdXJyZW50U3RhdGUuaGFuZGxlcnMgPSBoYW5kbGVycztcbiAgICBjdXJyZW50U3RhdGUucmVnZXggPSBuZXcgUmVnRXhwKHJlZ2V4ICsgJyQnLCByb3V0ZS5jYXNlU2Vuc2l0aXZlID8gJycgOiAnaScpO1xuICAgIGN1cnJlbnRTdGF0ZS50eXBlcyA9IHR5cGVzO1xuXG4gICAgcmV0dXJuIGN1cnJlbnRTdGF0ZTtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmdldFJvdXRlID0gZnVuY3Rpb24gZ2V0Um91dGUobmFtZU9yUm91dGUpIHtcbiAgICByZXR1cm4gdHlwZW9mIG5hbWVPclJvdXRlID09PSAnc3RyaW5nJyA/IHRoaXMubmFtZXNbbmFtZU9yUm91dGVdIDogdGhpcy5yb3V0ZXMuZ2V0KG5hbWVPclJvdXRlKTtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLmhhbmRsZXJzRm9yID0gZnVuY3Rpb24gaGFuZGxlcnNGb3IobmFtZU9yUm91dGUpIHtcbiAgICB2YXIgcm91dGUgPSB0aGlzLmdldFJvdXRlKG5hbWVPclJvdXRlKTtcbiAgICBpZiAoIXJvdXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZXJlIGlzIG5vIHJvdXRlIG5hbWVkICcgKyBuYW1lT3JSb3V0ZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFtdLmNvbmNhdChyb3V0ZS5oYW5kbGVycyk7XG4gIH07XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5oYXNSb3V0ZSA9IGZ1bmN0aW9uIGhhc1JvdXRlKG5hbWVPclJvdXRlKSB7XG4gICAgcmV0dXJuICEhdGhpcy5nZXRSb3V0ZShuYW1lT3JSb3V0ZSk7XG4gIH07XG5cbiAgUm91dGVSZWNvZ25pemVyLnByb3RvdHlwZS5nZW5lcmF0ZSA9IGZ1bmN0aW9uIGdlbmVyYXRlKG5hbWVPclJvdXRlLCBwYXJhbXMpIHtcbiAgICB2YXIgcm91dGUgPSB0aGlzLmdldFJvdXRlKG5hbWVPclJvdXRlKTtcbiAgICBpZiAoIXJvdXRlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZXJlIGlzIG5vIHJvdXRlIG5hbWVkICcgKyBuYW1lT3JSb3V0ZSk7XG4gICAgfVxuXG4gICAgdmFyIGhhbmRsZXIgPSByb3V0ZS5oYW5kbGVyc1swXS5oYW5kbGVyO1xuICAgIGlmIChoYW5kbGVyLmdlbmVyYXRpb25Vc2VzSHJlZikge1xuICAgICAgcmV0dXJuIGhhbmRsZXIuaHJlZjtcbiAgICB9XG5cbiAgICB2YXIgcm91dGVQYXJhbXMgPSBPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMpO1xuICAgIHZhciBzZWdtZW50cyA9IHJvdXRlLnNlZ21lbnRzO1xuICAgIHZhciBjb25zdW1lZCA9IHt9O1xuICAgIHZhciBvdXRwdXQgPSAnJztcblxuICAgIGZvciAodmFyIGkgPSAwLCBsID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICB2YXIgc2VnbWVudCA9IHNlZ21lbnRzW2ldO1xuXG4gICAgICBpZiAoc2VnbWVudCBpbnN0YW5jZW9mIEVwc2lsb25TZWdtZW50KSB7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB2YXIgc2VnbWVudFZhbHVlID0gc2VnbWVudC5nZW5lcmF0ZShyb3V0ZVBhcmFtcywgY29uc3VtZWQpO1xuICAgICAgaWYgKHNlZ21lbnRWYWx1ZSA9PT0gbnVsbCB8fCBzZWdtZW50VmFsdWUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoIXNlZ21lbnQub3B0aW9uYWwpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0EgdmFsdWUgaXMgcmVxdWlyZWQgZm9yIHJvdXRlIHBhcmFtZXRlciBcXCcnICsgc2VnbWVudC5uYW1lICsgJ1xcJyBpbiByb3V0ZSBcXCcnICsgbmFtZU9yUm91dGUgKyAnXFwnLicpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvdXRwdXQgKz0gJy8nO1xuICAgICAgICBvdXRwdXQgKz0gc2VnbWVudFZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChvdXRwdXQuY2hhckF0KDApICE9PSAnLycpIHtcbiAgICAgIG91dHB1dCA9ICcvJyArIG91dHB1dDtcbiAgICB9XG5cbiAgICBmb3IgKHZhciBwYXJhbSBpbiBjb25zdW1lZCkge1xuICAgICAgZGVsZXRlIHJvdXRlUGFyYW1zW3BhcmFtXTtcbiAgICB9XG5cbiAgICB2YXIgcXVlcnlTdHJpbmcgPSBidWlsZFF1ZXJ5U3RyaW5nKHJvdXRlUGFyYW1zKTtcbiAgICBvdXRwdXQgKz0gcXVlcnlTdHJpbmcgPyAnPycgKyBxdWVyeVN0cmluZyA6ICcnO1xuXG4gICAgcmV0dXJuIG91dHB1dDtcbiAgfTtcblxuICBSb3V0ZVJlY29nbml6ZXIucHJvdG90eXBlLnJlY29nbml6ZSA9IGZ1bmN0aW9uIHJlY29nbml6ZShwYXRoKSB7XG4gICAgdmFyIHN0YXRlcyA9IFt0aGlzLnJvb3RTdGF0ZV07XG4gICAgdmFyIHF1ZXJ5UGFyYW1zID0ge307XG4gICAgdmFyIGlzU2xhc2hEcm9wcGVkID0gZmFsc2U7XG4gICAgdmFyIG5vcm1hbGl6ZWRQYXRoID0gcGF0aDtcblxuICAgIHZhciBxdWVyeVN0YXJ0ID0gbm9ybWFsaXplZFBhdGguaW5kZXhPZignPycpO1xuICAgIGlmIChxdWVyeVN0YXJ0ICE9PSAtMSkge1xuICAgICAgdmFyIHF1ZXJ5U3RyaW5nID0gbm9ybWFsaXplZFBhdGguc3Vic3RyKHF1ZXJ5U3RhcnQgKyAxLCBub3JtYWxpemVkUGF0aC5sZW5ndGgpO1xuICAgICAgbm9ybWFsaXplZFBhdGggPSBub3JtYWxpemVkUGF0aC5zdWJzdHIoMCwgcXVlcnlTdGFydCk7XG4gICAgICBxdWVyeVBhcmFtcyA9IHBhcnNlUXVlcnlTdHJpbmcocXVlcnlTdHJpbmcpO1xuICAgIH1cblxuICAgIG5vcm1hbGl6ZWRQYXRoID0gZGVjb2RlVVJJKG5vcm1hbGl6ZWRQYXRoKTtcblxuICAgIGlmIChub3JtYWxpemVkUGF0aC5jaGFyQXQoMCkgIT09ICcvJykge1xuICAgICAgbm9ybWFsaXplZFBhdGggPSAnLycgKyBub3JtYWxpemVkUGF0aDtcbiAgICB9XG5cbiAgICB2YXIgcGF0aExlbiA9IG5vcm1hbGl6ZWRQYXRoLmxlbmd0aDtcbiAgICBpZiAocGF0aExlbiA+IDEgJiYgbm9ybWFsaXplZFBhdGguY2hhckF0KHBhdGhMZW4gLSAxKSA9PT0gJy8nKSB7XG4gICAgICBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZWRQYXRoLnN1YnN0cigwLCBwYXRoTGVuIC0gMSk7XG4gICAgICBpc1NsYXNoRHJvcHBlZCA9IHRydWU7XG4gICAgfVxuXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBub3JtYWxpemVkUGF0aC5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgIHN0YXRlcyA9IHJlY29nbml6ZUNoYXIoc3RhdGVzLCBub3JtYWxpemVkUGF0aC5jaGFyQXQoaSkpO1xuICAgICAgaWYgKCFzdGF0ZXMubGVuZ3RoKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzb2x1dGlvbnMgPSBbXTtcbiAgICBmb3IgKHZhciBfaTQgPSAwLCBfbCA9IHN0YXRlcy5sZW5ndGg7IF9pNCA8IF9sOyBfaTQrKykge1xuICAgICAgaWYgKHN0YXRlc1tfaTRdLmhhbmRsZXJzKSB7XG4gICAgICAgIHNvbHV0aW9ucy5wdXNoKHN0YXRlc1tfaTRdKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBzdGF0ZXMgPSBzb3J0U29sdXRpb25zKHNvbHV0aW9ucyk7XG5cbiAgICB2YXIgc3RhdGUgPSBzb2x1dGlvbnNbMF07XG4gICAgaWYgKHN0YXRlICYmIHN0YXRlLmhhbmRsZXJzKSB7XG4gICAgICBpZiAoaXNTbGFzaERyb3BwZWQgJiYgc3RhdGUucmVnZXguc291cmNlLnNsaWNlKC01KSA9PT0gJyguKykkJykge1xuICAgICAgICBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZWRQYXRoICsgJy8nO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmluZEhhbmRsZXIoc3RhdGUsIG5vcm1hbGl6ZWRQYXRoLCBxdWVyeVBhcmFtcyk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBSb3V0ZVJlY29nbml6ZXI7XG59KCk7XG5cbnZhciBSZWNvZ25pemVSZXN1bHRzID0gZnVuY3Rpb24gUmVjb2duaXplUmVzdWx0cyhxdWVyeVBhcmFtcykge1xuICBcblxuICB0aGlzLnNwbGljZSA9IEFycmF5LnByb3RvdHlwZS5zcGxpY2U7XG4gIHRoaXMuc2xpY2UgPSBBcnJheS5wcm90b3R5cGUuc2xpY2U7XG4gIHRoaXMucHVzaCA9IEFycmF5LnByb3RvdHlwZS5wdXNoO1xuICB0aGlzLmxlbmd0aCA9IDA7XG4gIHRoaXMucXVlcnlQYXJhbXMgPSBxdWVyeVBhcmFtcyB8fCB7fTtcbn07XG5cbmZ1bmN0aW9uIHBhcnNlKHJvdXRlLCBuYW1lcywgdHlwZXMsIGNhc2VTZW5zaXRpdmUpIHtcbiAgdmFyIG5vcm1hbGl6ZWRSb3V0ZSA9IHJvdXRlO1xuICBpZiAocm91dGUuY2hhckF0KDApID09PSAnLycpIHtcbiAgICBub3JtYWxpemVkUm91dGUgPSByb3V0ZS5zdWJzdHIoMSk7XG4gIH1cblxuICB2YXIgcmVzdWx0cyA9IFtdO1xuXG4gIHZhciBzcGxpdFJvdXRlID0gbm9ybWFsaXplZFJvdXRlLnNwbGl0KCcvJyk7XG4gIGZvciAodmFyIGkgPSAwLCBpaSA9IHNwbGl0Um91dGUubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xuICAgIHZhciBzZWdtZW50ID0gc3BsaXRSb3V0ZVtpXTtcblxuICAgIHZhciBtYXRjaCA9IHNlZ21lbnQubWF0Y2goL146KFteP10rKShcXD8pPyQvKTtcbiAgICBpZiAobWF0Y2gpIHtcbiAgICAgIHZhciBfbWF0Y2ggPSBtYXRjaCxcbiAgICAgICAgICBfbmFtZSA9IF9tYXRjaFsxXSxcbiAgICAgICAgICBvcHRpb25hbCA9IF9tYXRjaFsyXTtcblxuICAgICAgaWYgKF9uYW1lLmluZGV4T2YoJz0nKSAhPT0gLTEpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgJyArIF9uYW1lICsgJyBpbiByb3V0ZSAnICsgcm91dGUgKyAnIGhhcyBhIGRlZmF1bHQgdmFsdWUsIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQuJyk7XG4gICAgICB9XG4gICAgICByZXN1bHRzLnB1c2gobmV3IER5bmFtaWNTZWdtZW50KF9uYW1lLCAhIW9wdGlvbmFsKSk7XG4gICAgICBuYW1lcy5wdXNoKF9uYW1lKTtcbiAgICAgIHR5cGVzLmR5bmFtaWNzKys7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG5cbiAgICBtYXRjaCA9IHNlZ21lbnQubWF0Y2goL15cXCooLispJC8pO1xuICAgIGlmIChtYXRjaCkge1xuICAgICAgcmVzdWx0cy5wdXNoKG5ldyBTdGFyU2VnbWVudChtYXRjaFsxXSkpO1xuICAgICAgbmFtZXMucHVzaChtYXRjaFsxXSk7XG4gICAgICB0eXBlcy5zdGFycysrO1xuICAgIH0gZWxzZSBpZiAoc2VnbWVudCA9PT0gJycpIHtcbiAgICAgIHJlc3VsdHMucHVzaChuZXcgRXBzaWxvblNlZ21lbnQoKSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdHMucHVzaChuZXcgU3RhdGljU2VnbWVudChzZWdtZW50LCBjYXNlU2Vuc2l0aXZlKSk7XG4gICAgICB0eXBlcy5zdGF0aWNzKys7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdHM7XG59XG5cbmZ1bmN0aW9uIHNvcnRTb2x1dGlvbnMoc3RhdGVzKSB7XG4gIHJldHVybiBzdGF0ZXMuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmIChhLnR5cGVzLnN0YXJzICE9PSBiLnR5cGVzLnN0YXJzKSB7XG4gICAgICByZXR1cm4gYS50eXBlcy5zdGFycyAtIGIudHlwZXMuc3RhcnM7XG4gICAgfVxuXG4gICAgaWYgKGEudHlwZXMuc3RhcnMpIHtcbiAgICAgIGlmIChhLnR5cGVzLnN0YXRpY3MgIT09IGIudHlwZXMuc3RhdGljcykge1xuICAgICAgICByZXR1cm4gYi50eXBlcy5zdGF0aWNzIC0gYS50eXBlcy5zdGF0aWNzO1xuICAgICAgfVxuICAgICAgaWYgKGEudHlwZXMuZHluYW1pY3MgIT09IGIudHlwZXMuZHluYW1pY3MpIHtcbiAgICAgICAgcmV0dXJuIGIudHlwZXMuZHluYW1pY3MgLSBhLnR5cGVzLmR5bmFtaWNzO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhLnR5cGVzLmR5bmFtaWNzICE9PSBiLnR5cGVzLmR5bmFtaWNzKSB7XG4gICAgICByZXR1cm4gYS50eXBlcy5keW5hbWljcyAtIGIudHlwZXMuZHluYW1pY3M7XG4gICAgfVxuXG4gICAgaWYgKGEudHlwZXMuc3RhdGljcyAhPT0gYi50eXBlcy5zdGF0aWNzKSB7XG4gICAgICByZXR1cm4gYi50eXBlcy5zdGF0aWNzIC0gYS50eXBlcy5zdGF0aWNzO1xuICAgIH1cblxuICAgIHJldHVybiAwO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVjb2duaXplQ2hhcihzdGF0ZXMsIGNoKSB7XG4gIHZhciBuZXh0U3RhdGVzID0gW107XG5cbiAgZm9yICh2YXIgaSA9IDAsIGwgPSBzdGF0ZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgdmFyIHN0YXRlID0gc3RhdGVzW2ldO1xuICAgIG5leHRTdGF0ZXMucHVzaC5hcHBseShuZXh0U3RhdGVzLCBzdGF0ZS5tYXRjaChjaCkpO1xuICB9XG5cbiAgcmV0dXJuIG5leHRTdGF0ZXM7XG59XG5cbmZ1bmN0aW9uIGZpbmRIYW5kbGVyKHN0YXRlLCBwYXRoLCBxdWVyeVBhcmFtcykge1xuICB2YXIgaGFuZGxlcnMgPSBzdGF0ZS5oYW5kbGVycztcbiAgdmFyIHJlZ2V4ID0gc3RhdGUucmVnZXg7XG4gIHZhciBjYXB0dXJlcyA9IHBhdGgubWF0Y2gocmVnZXgpO1xuICB2YXIgY3VycmVudENhcHR1cmUgPSAxO1xuICB2YXIgcmVzdWx0ID0gbmV3IFJlY29nbml6ZVJlc3VsdHMocXVlcnlQYXJhbXMpO1xuXG4gIGZvciAodmFyIGkgPSAwLCBsID0gaGFuZGxlcnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgdmFyIF9oYW5kbGVyID0gaGFuZGxlcnNbaV07XG4gICAgdmFyIF9uYW1lcyA9IF9oYW5kbGVyLm5hbWVzO1xuICAgIHZhciBfcGFyYW1zID0ge307XG5cbiAgICBmb3IgKHZhciBqID0gMCwgbSA9IF9uYW1lcy5sZW5ndGg7IGogPCBtOyBqKyspIHtcbiAgICAgIF9wYXJhbXNbX25hbWVzW2pdXSA9IGNhcHR1cmVzW2N1cnJlbnRDYXB0dXJlKytdO1xuICAgIH1cblxuICAgIHJlc3VsdC5wdXNoKHsgaGFuZGxlcjogX2hhbmRsZXIuaGFuZGxlciwgcGFyYW1zOiBfcGFyYW1zLCBpc0R5bmFtaWM6ICEhX25hbWVzLmxlbmd0aCB9KTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGFkZFNlZ21lbnQoY3VycmVudFN0YXRlLCBzZWdtZW50KSB7XG4gIHZhciBmaXJzdFN0YXRlID0gY3VycmVudFN0YXRlLnB1dCh7IHZhbGlkQ2hhcnM6ICcvJyB9KTtcbiAgdmFyIG5leHRTdGF0ZSA9IGZpcnN0U3RhdGU7XG4gIHNlZ21lbnQuZWFjaENoYXIoZnVuY3Rpb24gKGNoKSB7XG4gICAgbmV4dFN0YXRlID0gbmV4dFN0YXRlLnB1dChjaCk7XG4gIH0pO1xuXG4gIHJldHVybiBbZmlyc3RTdGF0ZSwgbmV4dFN0YXRlXTtcbn1cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyL2Rpc3QvbmF0aXZlLW1vZHVsZXMvYXVyZWxpYS1yb3V0ZS1yZWNvZ25pemVyLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLXJvdXRlLXJlY29nbml6ZXJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiaW1wb3J0IHsgZ2V0TG9nZ2VyIH0gZnJvbSAnYXVyZWxpYS1sb2dnaW5nJztcbmltcG9ydCB7IENvbnRhaW5lciB9IGZyb20gJ2F1cmVsaWEtZGVwZW5kZW5jeS1pbmplY3Rpb24nO1xuaW1wb3J0IHsgSGlzdG9yeSB9IGZyb20gJ2F1cmVsaWEtaGlzdG9yeSc7XG5pbXBvcnQgeyBSb3V0ZVJlY29nbml6ZXIgfSBmcm9tICdhdXJlbGlhLXJvdXRlLXJlY29nbml6ZXInO1xuaW1wb3J0IHsgRXZlbnRBZ2dyZWdhdG9yIH0gZnJvbSAnYXVyZWxpYS1ldmVudC1hZ2dyZWdhdG9yJztcblxuLyoqXHJcbiAqIENsYXNzIHVzZWQgdG8gcmVwcmVzZW50IGFuIGluc3RydWN0aW9uIGR1cmluZyBhIG5hdmlnYXRpb24uXHJcbiAqL1xyXG5jbGFzcyBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ge1xyXG4gICAgY29uc3RydWN0b3IoaW5pdCkge1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEN1cnJlbnQgYnVpbHQgdmlld3BvcnQgcGxhbiBvZiB0aGlzIG5hdiBpbnN0cnVjdGlvblxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucGxhbiA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0ge307XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCBpbml0KTtcclxuICAgICAgICB0aGlzLnBhcmFtcyA9IHRoaXMucGFyYW1zIHx8IHt9O1xyXG4gICAgICAgIHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnMgPSB7fTtcclxuICAgICAgICBsZXQgYW5jZXN0b3JQYXJhbXMgPSBbXTtcclxuICAgICAgICBsZXQgY3VycmVudCA9IHRoaXM7XHJcbiAgICAgICAgZG8ge1xyXG4gICAgICAgICAgICBsZXQgY3VycmVudFBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIGN1cnJlbnQucGFyYW1zKTtcclxuICAgICAgICAgICAgaWYgKGN1cnJlbnQuY29uZmlnICYmIGN1cnJlbnQuY29uZmlnLmhhc0NoaWxkUm91dGVyKSB7XHJcbiAgICAgICAgICAgICAgICAvLyByZW1vdmUgdGhlIHBhcmFtIGZvciB0aGUgaW5qZWN0ZWQgY2hpbGQgcm91dGUgc2VnbWVudFxyXG4gICAgICAgICAgICAgICAgZGVsZXRlIGN1cnJlbnRQYXJhbXNbY3VycmVudC5nZXRXaWxkQ2FyZE5hbWUoKV07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYW5jZXN0b3JQYXJhbXMudW5zaGlmdChjdXJyZW50UGFyYW1zKTtcclxuICAgICAgICAgICAgY3VycmVudCA9IGN1cnJlbnQucGFyZW50SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgfSB3aGlsZSAoY3VycmVudCk7XHJcbiAgICAgICAgbGV0IGFsbFBhcmFtcyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMucXVlcnlQYXJhbXMsIC4uLmFuY2VzdG9yUGFyYW1zKTtcclxuICAgICAgICB0aGlzLmxpZmVjeWNsZUFyZ3MgPSBbYWxsUGFyYW1zLCB0aGlzLmNvbmZpZywgdGhpc107XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYW4gYXJyYXkgY29udGFpbmluZyB0aGlzIGluc3RydWN0aW9uIGFuZCBhbGwgY2hpbGQgaW5zdHJ1Y3Rpb25zIGZvciB0aGUgY3VycmVudCBuYXZpZ2F0aW9uLlxyXG4gICAgICovXHJcbiAgICBnZXRBbGxJbnN0cnVjdGlvbnMoKSB7XHJcbiAgICAgICAgbGV0IGluc3RydWN0aW9ucyA9IFt0aGlzXTtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbnMgPSB0aGlzLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiB2aWV3UG9ydEluc3RydWN0aW9ucykge1xyXG4gICAgICAgICAgICBsZXQgY2hpbGRJbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb25zW2tleV0uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIGlmIChjaGlsZEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaCguLi5jaGlsZEluc3RydWN0aW9uLmdldEFsbEluc3RydWN0aW9ucygpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb25zO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGFuIGFycmF5IGNvbnRhaW5pbmcgdGhlIGluc3RydWN0aW9uIGFuZCBhbGwgY2hpbGQgaW5zdHJ1Y3Rpb25zIGZvciB0aGUgcHJldmlvdXMgbmF2aWdhdGlvbi5cclxuICAgICAqIFByZXZpb3VzIGluc3RydWN0aW9ucyBhcmUgbm8gbG9uZ2VyIGF2YWlsYWJsZSBhZnRlciBuYXZpZ2F0aW9uIGNvbXBsZXRlcy5cclxuICAgICAqL1xyXG4gICAgZ2V0QWxsUHJldmlvdXNJbnN0cnVjdGlvbnMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0QWxsSW5zdHJ1Y3Rpb25zKCkubWFwKGMgPT4gYy5wcmV2aW91c0luc3RydWN0aW9uKS5maWx0ZXIoYyA9PiBjKTtcclxuICAgIH1cclxuICAgIGFkZFZpZXdQb3J0SW5zdHJ1Y3Rpb24obmFtZU9ySW5pdE9wdGlvbnMsIHN0cmF0ZWd5LCBtb2R1bGVJZCwgY29tcG9uZW50KSB7XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0TmFtZSA9IHR5cGVvZiBuYW1lT3JJbml0T3B0aW9ucyA9PT0gJ3N0cmluZycgPyBuYW1lT3JJbml0T3B0aW9ucyA6IG5hbWVPckluaXRPcHRpb25zLm5hbWU7XHJcbiAgICAgICAgY29uc3QgbGlmZWN5Y2xlQXJncyA9IHRoaXMubGlmZWN5Y2xlQXJncztcclxuICAgICAgICBjb25zdCBjb25maWcgPSBPYmplY3QuYXNzaWduKHt9LCBsaWZlY3ljbGVBcmdzWzFdLCB7IGN1cnJlbnRWaWV3UG9ydDogdmlld1BvcnROYW1lIH0pO1xyXG4gICAgICAgIGlmICh0eXBlb2YgbmFtZU9ySW5pdE9wdGlvbnMgPT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgICAgIHZpZXdQb3J0SW5zdHJ1Y3Rpb24gPSB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lT3JJbml0T3B0aW9ucyxcclxuICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiBzdHJhdGVneSxcclxuICAgICAgICAgICAgICAgIG1vZHVsZUlkOiBtb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogY29tcG9uZW50LFxyXG4gICAgICAgICAgICAgICAgY2hpbGRSb3V0ZXI6IGNvbXBvbmVudC5jaGlsZFJvdXRlcixcclxuICAgICAgICAgICAgICAgIGxpZmVjeWNsZUFyZ3M6IFtsaWZlY3ljbGVBcmdzWzBdLCBjb25maWcsIGxpZmVjeWNsZUFyZ3NbMl1dXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2aWV3UG9ydEluc3RydWN0aW9uID0ge1xyXG4gICAgICAgICAgICAgICAgbmFtZTogdmlld1BvcnROYW1lLFxyXG4gICAgICAgICAgICAgICAgc3RyYXRlZ3k6IG5hbWVPckluaXRPcHRpb25zLnN0cmF0ZWd5LFxyXG4gICAgICAgICAgICAgICAgY29tcG9uZW50OiBuYW1lT3JJbml0T3B0aW9ucy5jb21wb25lbnQsXHJcbiAgICAgICAgICAgICAgICBtb2R1bGVJZDogbmFtZU9ySW5pdE9wdGlvbnMubW9kdWxlSWQsXHJcbiAgICAgICAgICAgICAgICBjaGlsZFJvdXRlcjogbmFtZU9ySW5pdE9wdGlvbnMuY29tcG9uZW50LmNoaWxkUm91dGVyLFxyXG4gICAgICAgICAgICAgICAgbGlmZWN5Y2xlQXJnczogW2xpZmVjeWNsZUFyZ3NbMF0sIGNvbmZpZywgbGlmZWN5Y2xlQXJnc1syXV1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXSA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb247XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgdGhlIG5hbWUgb2YgdGhlIHJvdXRlIHBhdHRlcm4ncyB3aWxkY2FyZCBwYXJhbWV0ZXIsIGlmIGFwcGxpY2FibGUuXHJcbiAgICAgKi9cclxuICAgIGdldFdpbGRDYXJkTmFtZSgpIHtcclxuICAgICAgICAvLyB0b2RvOiBwb3RlbnRpYWwgaXNzdWUsIG9yIGF0IGxlYXN0IHVuc2FmZSB0eXBpbmdzXHJcbiAgICAgICAgbGV0IGNvbmZpZ1JvdXRlID0gdGhpcy5jb25maWcucm91dGU7XHJcbiAgICAgICAgbGV0IHdpbGRjYXJkSW5kZXggPSBjb25maWdSb3V0ZS5sYXN0SW5kZXhPZignKicpO1xyXG4gICAgICAgIHJldHVybiBjb25maWdSb3V0ZS5zdWJzdHIod2lsZGNhcmRJbmRleCArIDEpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIHRoZSBwYXRoIGFuZCBxdWVyeSBzdHJpbmcgY3JlYXRlZCBieSBmaWxsaW5nIHRoZSByb3V0ZVxyXG4gICAgICogcGF0dGVybidzIHdpbGRjYXJkIHBhcmFtZXRlciB3aXRoIHRoZSBtYXRjaGluZyBwYXJhbS5cclxuICAgICAqL1xyXG4gICAgZ2V0V2lsZGNhcmRQYXRoKCkge1xyXG4gICAgICAgIGxldCB3aWxkY2FyZE5hbWUgPSB0aGlzLmdldFdpbGRDYXJkTmFtZSgpO1xyXG4gICAgICAgIGxldCBwYXRoID0gdGhpcy5wYXJhbXNbd2lsZGNhcmROYW1lXSB8fCAnJztcclxuICAgICAgICBsZXQgcXVlcnlTdHJpbmcgPSB0aGlzLnF1ZXJ5U3RyaW5nO1xyXG4gICAgICAgIGlmIChxdWVyeVN0cmluZykge1xyXG4gICAgICAgICAgICBwYXRoICs9ICc/JyArIHF1ZXJ5U3RyaW5nO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcGF0aDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyB0aGUgaW5zdHJ1Y3Rpb24ncyBiYXNlIFVSTCwgYWNjb3VudGluZyBmb3Igd2lsZGNhcmQgcm91dGUgcGFyYW1ldGVycy5cclxuICAgICAqL1xyXG4gICAgZ2V0QmFzZVVybCgpIHtcclxuICAgICAgICBsZXQgJGVuY29kZVVSSSA9IGVuY29kZVVSSTtcclxuICAgICAgICBsZXQgZnJhZ21lbnQgPSBkZWNvZGVVUkkodGhpcy5mcmFnbWVudCk7XHJcbiAgICAgICAgaWYgKGZyYWdtZW50ID09PSAnJykge1xyXG4gICAgICAgICAgICBsZXQgbm9uRW1wdHlSb3V0ZSA9IHRoaXMucm91dGVyLnJvdXRlcy5maW5kKHJvdXRlID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiByb3V0ZS5uYW1lID09PSB0aGlzLmNvbmZpZy5uYW1lICYmXHJcbiAgICAgICAgICAgICAgICAgICAgcm91dGUucm91dGUgIT09ICcnO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgaWYgKG5vbkVtcHR5Um91dGUpIHtcclxuICAgICAgICAgICAgICAgIGZyYWdtZW50ID0gbm9uRW1wdHlSb3V0ZS5yb3V0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIXRoaXMucGFyYW1zKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkZW5jb2RlVVJJKGZyYWdtZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHdpbGRjYXJkTmFtZSA9IHRoaXMuZ2V0V2lsZENhcmROYW1lKCk7XHJcbiAgICAgICAgbGV0IHBhdGggPSB0aGlzLnBhcmFtc1t3aWxkY2FyZE5hbWVdIHx8ICcnO1xyXG4gICAgICAgIGlmICghcGF0aCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGVuY29kZVVSSShmcmFnbWVudCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAkZW5jb2RlVVJJKGZyYWdtZW50LnN1YnN0cigwLCBmcmFnbWVudC5sYXN0SW5kZXhPZihwYXRoKSkpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBGaW5hbGl6ZSBhIHZpZXdwb3J0IGluc3RydWN0aW9uXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgX2NvbW1pdENoYW5nZXMod2FpdFRvU3dhcCkge1xyXG4gICAgICAgIGxldCByb3V0ZXIgPSB0aGlzLnJvdXRlcjtcclxuICAgICAgICByb3V0ZXIuY3VycmVudEluc3RydWN0aW9uID0gdGhpcztcclxuICAgICAgICBjb25zdCBwcmV2aW91c0luc3RydWN0aW9uID0gdGhpcy5wcmV2aW91c0luc3RydWN0aW9uO1xyXG4gICAgICAgIGlmIChwcmV2aW91c0luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHByZXZpb3VzSW5zdHJ1Y3Rpb24uY29uZmlnLm5hdk1vZGVsLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY29uZmlnLm5hdk1vZGVsLmlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICByb3V0ZXIucmVmcmVzaE5hdmlnYXRpb24oKTtcclxuICAgICAgICBsZXQgbG9hZHMgPSBbXTtcclxuICAgICAgICBsZXQgZGVsYXlTd2FwcyA9IFtdO1xyXG4gICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9ucyA9IHRoaXMudmlld1BvcnRJbnN0cnVjdGlvbnM7XHJcbiAgICAgICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgICAgIGxldCB2aWV3UG9ydEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbnNbdmlld1BvcnROYW1lXTtcclxuICAgICAgICAgICAgbGV0IHZpZXdQb3J0ID0gcm91dGVyLnZpZXdQb3J0c1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgICAgICBpZiAoIXZpZXdQb3J0KSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZXJlIHdhcyBubyByb3V0ZXItdmlldyBmb3VuZCBpbiB0aGUgdmlldyBmb3IgJHt2aWV3UG9ydEluc3RydWN0aW9uLm1vZHVsZUlkfS5gKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgY2hpbGROYXZJbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIGlmICh2aWV3UG9ydEluc3RydWN0aW9uLnN0cmF0ZWd5ID09PSBcInJlcGxhY2VcIiAvKiBSZXBsYWNlICovKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGROYXZJbnN0cnVjdGlvbiAmJiBjaGlsZE5hdkluc3RydWN0aW9uLnBhcmVudENhdGNoSGFuZGxlcikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRzLnB1c2goY2hpbGROYXZJbnN0cnVjdGlvbi5fY29tbWl0Q2hhbmdlcyh3YWl0VG9Td2FwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAod2FpdFRvU3dhcCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBkZWxheVN3YXBzLnB1c2goeyB2aWV3UG9ydCwgdmlld1BvcnRJbnN0cnVjdGlvbiB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgbG9hZHMucHVzaCh2aWV3UG9ydFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucHJvY2Vzcyh2aWV3UG9ydEluc3RydWN0aW9uLCB3YWl0VG9Td2FwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoKSA9PiBjaGlsZE5hdkluc3RydWN0aW9uXHJcbiAgICAgICAgICAgICAgICAgICAgICAgID8gY2hpbGROYXZJbnN0cnVjdGlvbi5fY29tbWl0Q2hhbmdlcyh3YWl0VG9Td2FwKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFByb21pc2UucmVzb2x2ZSgpKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGROYXZJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvYWRzLnB1c2goY2hpbGROYXZJbnN0cnVjdGlvbi5fY29tbWl0Q2hhbmdlcyh3YWl0VG9Td2FwKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2VcclxuICAgICAgICAgICAgLmFsbChsb2FkcylcclxuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICBkZWxheVN3YXBzLmZvckVhY2goeCA9PiB4LnZpZXdQb3J0LnN3YXAoeC52aWV3UG9ydEluc3RydWN0aW9uKSk7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHBydW5lKHRoaXMpKTtcclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX3VwZGF0ZVRpdGxlKCkge1xyXG4gICAgICAgIGxldCByb3V0ZXIgPSB0aGlzLnJvdXRlcjtcclxuICAgICAgICBsZXQgdGl0bGUgPSB0aGlzLl9idWlsZFRpdGxlKHJvdXRlci50aXRsZVNlcGFyYXRvcik7XHJcbiAgICAgICAgaWYgKHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci5oaXN0b3J5LnNldFRpdGxlKHRpdGxlKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIF9idWlsZFRpdGxlKHNlcGFyYXRvciA9ICcgfCAnKSB7XHJcbiAgICAgICAgbGV0IHRpdGxlID0gJyc7XHJcbiAgICAgICAgbGV0IGNoaWxkVGl0bGVzID0gW107XHJcbiAgICAgICAgbGV0IG5hdk1vZGVsVGl0bGUgPSB0aGlzLmNvbmZpZy5uYXZNb2RlbC50aXRsZTtcclxuICAgICAgICBsZXQgaW5zdHJ1Y3Rpb25Sb3V0ZXIgPSB0aGlzLnJvdXRlcjtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbnMgPSB0aGlzLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGlmIChuYXZNb2RlbFRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRpdGxlID0gaW5zdHJ1Y3Rpb25Sb3V0ZXIudHJhbnNmb3JtVGl0bGUobmF2TW9kZWxUaXRsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IHZpZXdQb3J0TmFtZSBpbiB2aWV3UG9ydEluc3RydWN0aW9ucykge1xyXG4gICAgICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb25zW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgICAgIGxldCBjaGlsZF9uYXZfaW5zdHJ1Y3Rpb24gPSB2aWV3UG9ydEluc3RydWN0aW9uLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGRfbmF2X2luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgY2hpbGRUaXRsZSA9IGNoaWxkX25hdl9pbnN0cnVjdGlvbi5fYnVpbGRUaXRsZShzZXBhcmF0b3IpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkVGl0bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZFRpdGxlcy5wdXNoKGNoaWxkVGl0bGUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjaGlsZFRpdGxlcy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGl0bGUgPSBjaGlsZFRpdGxlcy5qb2luKHNlcGFyYXRvcikgKyAodGl0bGUgPyBzZXBhcmF0b3IgOiAnJykgKyB0aXRsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uUm91dGVyLnRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRpdGxlICs9ICh0aXRsZSA/IHNlcGFyYXRvciA6ICcnKSArIGluc3RydWN0aW9uUm91dGVyLnRyYW5zZm9ybVRpdGxlKGluc3RydWN0aW9uUm91dGVyLnRpdGxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRpdGxlO1xyXG4gICAgfVxyXG59XHJcbmNvbnN0IHBydW5lID0gKGluc3RydWN0aW9uKSA9PiB7XHJcbiAgICBpbnN0cnVjdGlvbi5wcmV2aW91c0luc3RydWN0aW9uID0gbnVsbDtcclxuICAgIGluc3RydWN0aW9uLnBsYW4gPSBudWxsO1xyXG59O1xuXG4vKipcclxuKiBDbGFzcyBmb3Igc3RvcmluZyBhbmQgaW50ZXJhY3Rpbmcgd2l0aCBhIHJvdXRlJ3MgbmF2aWdhdGlvbiBzZXR0aW5ncy5cclxuKi9cclxuY2xhc3MgTmF2TW9kZWwge1xyXG4gICAgY29uc3RydWN0b3Iocm91dGVyLCByZWxhdGl2ZUhyZWYpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAqIFRydWUgaWYgdGhpcyBuYXYgaXRlbSBpcyBjdXJyZW50bHkgYWN0aXZlLlxyXG4gICAgICAgICovXHJcbiAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICogVGhlIHRpdGxlLlxyXG4gICAgICAgICovXHJcbiAgICAgICAgdGhpcy50aXRsZSA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBUaGlzIG5hdiBpdGVtJ3MgYWJzb2x1dGUgaHJlZi5cclxuICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuaHJlZiA9IG51bGw7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgKiBUaGlzIG5hdiBpdGVtJ3MgcmVsYXRpdmUgaHJlZi5cclxuICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMucmVsYXRpdmVIcmVmID0gbnVsbDtcclxuICAgICAgICAvKipcclxuICAgICAgICAqIERhdGEgYXR0YWNoZWQgdG8gdGhlIHJvdXRlIGF0IGNvbmZpZ3VyYXRpb24gdGltZS5cclxuICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuc2V0dGluZ3MgPSB7fTtcclxuICAgICAgICAvKipcclxuICAgICAgICAqIFRoZSByb3V0ZSBjb25maWcuXHJcbiAgICAgICAgKi9cclxuICAgICAgICB0aGlzLmNvbmZpZyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XHJcbiAgICAgICAgdGhpcy5yZWxhdGl2ZUhyZWYgPSByZWxhdGl2ZUhyZWY7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICogU2V0cyB0aGUgcm91dGUncyB0aXRsZSBhbmQgdXBkYXRlcyBkb2N1bWVudC50aXRsZS5cclxuICAgICogIElmIHRoZSBhIG5hdmlnYXRpb24gaXMgaW4gcHJvZ3Jlc3MsIHRoZSBjaGFuZ2Ugd2lsbCBiZSBhcHBsaWVkXHJcbiAgICAqICB0byBkb2N1bWVudC50aXRsZSB3aGVuIHRoZSBuYXZpZ2F0aW9uIGNvbXBsZXRlcy5cclxuICAgICpcclxuICAgICogQHBhcmFtIHRpdGxlIFRoZSBuZXcgdGl0bGUuXHJcbiAgICAqL1xyXG4gICAgc2V0VGl0bGUodGl0bGUpIHtcclxuICAgICAgICB0aGlzLnRpdGxlID0gdGl0bGU7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBY3RpdmUpIHtcclxuICAgICAgICAgICAgdGhpcy5yb3V0ZXIudXBkYXRlVGl0bGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cblxuZnVuY3Rpb24gX25vcm1hbGl6ZUFic29sdXRlUGF0aChwYXRoLCBoYXNQdXNoU3RhdGUsIGFic29sdXRlID0gZmFsc2UpIHtcclxuICAgIGlmICghaGFzUHVzaFN0YXRlICYmIHBhdGhbMF0gIT09ICcjJykge1xyXG4gICAgICAgIHBhdGggPSAnIycgKyBwYXRoO1xyXG4gICAgfVxyXG4gICAgaWYgKGhhc1B1c2hTdGF0ZSAmJiBhYnNvbHV0ZSkge1xyXG4gICAgICAgIHBhdGggPSBwYXRoLnN1YnN0cmluZygxLCBwYXRoLmxlbmd0aCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcGF0aDtcclxufVxyXG5mdW5jdGlvbiBfY3JlYXRlUm9vdGVkUGF0aChmcmFnbWVudCwgYmFzZVVybCwgaGFzUHVzaFN0YXRlLCBhYnNvbHV0ZSkge1xyXG4gICAgaWYgKGlzQWJzb2x1dGVVcmwudGVzdChmcmFnbWVudCkpIHtcclxuICAgICAgICByZXR1cm4gZnJhZ21lbnQ7XHJcbiAgICB9XHJcbiAgICBsZXQgcGF0aCA9ICcnO1xyXG4gICAgaWYgKGJhc2VVcmwubGVuZ3RoICYmIGJhc2VVcmxbMF0gIT09ICcvJykge1xyXG4gICAgICAgIHBhdGggKz0gJy8nO1xyXG4gICAgfVxyXG4gICAgcGF0aCArPSBiYXNlVXJsO1xyXG4gICAgaWYgKCghcGF0aC5sZW5ndGggfHwgcGF0aFtwYXRoLmxlbmd0aCAtIDFdICE9PSAnLycpICYmIGZyYWdtZW50WzBdICE9PSAnLycpIHtcclxuICAgICAgICBwYXRoICs9ICcvJztcclxuICAgIH1cclxuICAgIGlmIChwYXRoLmxlbmd0aCAmJiBwYXRoW3BhdGgubGVuZ3RoIC0gMV0gPT09ICcvJyAmJiBmcmFnbWVudFswXSA9PT0gJy8nKSB7XHJcbiAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyaW5nKDAsIHBhdGgubGVuZ3RoIC0gMSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gX25vcm1hbGl6ZUFic29sdXRlUGF0aChwYXRoICsgZnJhZ21lbnQsIGhhc1B1c2hTdGF0ZSwgYWJzb2x1dGUpO1xyXG59XHJcbmZ1bmN0aW9uIF9yZXNvbHZlVXJsKGZyYWdtZW50LCBiYXNlVXJsLCBoYXNQdXNoU3RhdGUpIHtcclxuICAgIGlmIChpc1Jvb3RlZFBhdGgudGVzdChmcmFnbWVudCkpIHtcclxuICAgICAgICByZXR1cm4gX25vcm1hbGl6ZUFic29sdXRlUGF0aChmcmFnbWVudCwgaGFzUHVzaFN0YXRlKTtcclxuICAgIH1cclxuICAgIHJldHVybiBfY3JlYXRlUm9vdGVkUGF0aChmcmFnbWVudCwgYmFzZVVybCwgaGFzUHVzaFN0YXRlKTtcclxufVxyXG5mdW5jdGlvbiBfZW5zdXJlQXJyYXlXaXRoU2luZ2xlUm91dGVQZXJDb25maWcoY29uZmlnKSB7XHJcbiAgICBsZXQgcm91dGVDb25maWdzID0gW107XHJcbiAgICBpZiAoQXJyYXkuaXNBcnJheShjb25maWcucm91dGUpKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29uZmlnLnJvdXRlLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBPYmplY3QuYXNzaWduKHt9LCBjb25maWcpO1xyXG4gICAgICAgICAgICBjdXJyZW50LnJvdXRlID0gY29uZmlnLnJvdXRlW2ldO1xyXG4gICAgICAgICAgICByb3V0ZUNvbmZpZ3MucHVzaChjdXJyZW50KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByb3V0ZUNvbmZpZ3MucHVzaChPYmplY3QuYXNzaWduKHt9LCBjb25maWcpKTtcclxuICAgIH1cclxuICAgIHJldHVybiByb3V0ZUNvbmZpZ3M7XHJcbn1cclxuY29uc3QgaXNSb290ZWRQYXRoID0gL14jP1xcLy87XHJcbmNvbnN0IGlzQWJzb2x1dGVVcmwgPSAvXihbYS16XVthLXowLTkrXFwtLl0qOik/XFwvXFwvL2k7XG5cbi8qKlxyXG4gKiBDbGFzcyB1c2VkIHRvIGNvbmZpZ3VyZSBhIFtbUm91dGVyXV0gaW5zdGFuY2UuXHJcbiAqXHJcbiAqIEBjb25zdHJ1Y3RvclxyXG4gKi9cclxuY2xhc3MgUm91dGVyQ29uZmlndXJhdGlvbiB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLmluc3RydWN0aW9ucyA9IFtdO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIHRoaXMucGlwZWxpbmVTdGVwcyA9IFtdO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgc3RlcCB0byBiZSBydW4gZHVyaW5nIHRoZSBbW1JvdXRlcl1dJ3MgbmF2aWdhdGlvbiBwaXBlbGluZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcGlwZWxpbmUgc2xvdCB0byBpbnNlcnQgdGhlIHN0ZXAgaW50by5cclxuICAgICAqIEBwYXJhbSBzdGVwIFRoZSBwaXBlbGluZSBzdGVwLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBhZGRQaXBlbGluZVN0ZXAobmFtZSwgc3RlcCkge1xyXG4gICAgICAgIGlmIChzdGVwID09PSBudWxsIHx8IHN0ZXAgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BpcGVsaW5lIHN0ZXAgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnBpcGVsaW5lU3RlcHMucHVzaCh7IG5hbWUsIHN0ZXAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBzdGVwIHRvIGJlIHJ1biBkdXJpbmcgdGhlIFtbUm91dGVyXV0ncyBhdXRob3JpemUgcGlwZWxpbmUgc2xvdC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3RlcCBUaGUgcGlwZWxpbmUgc3RlcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgYWRkQXV0aG9yaXplU3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkUGlwZWxpbmVTdGVwKFwiYXV0aG9yaXplXCIgLyogQXV0aG9yaXplICovLCBzdGVwKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHN0ZXAgdG8gYmUgcnVuIGR1cmluZyB0aGUgW1tSb3V0ZXJdXSdzIHByZUFjdGl2YXRlIHBpcGVsaW5lIHNsb3QuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHN0ZXAgVGhlIHBpcGVsaW5lIHN0ZXAuXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIGFkZFByZUFjdGl2YXRlU3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkUGlwZWxpbmVTdGVwKFwicHJlQWN0aXZhdGVcIiAvKiBQcmVBY3RpdmF0ZSAqLywgc3RlcCk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEFkZHMgYSBzdGVwIHRvIGJlIHJ1biBkdXJpbmcgdGhlIFtbUm91dGVyXV0ncyBwcmVSZW5kZXIgcGlwZWxpbmUgc2xvdC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3RlcCBUaGUgcGlwZWxpbmUgc3RlcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgYWRkUHJlUmVuZGVyU3RlcChzdGVwKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkUGlwZWxpbmVTdGVwKFwicHJlUmVuZGVyXCIgLyogUHJlUmVuZGVyICovLCBzdGVwKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHN0ZXAgdG8gYmUgcnVuIGR1cmluZyB0aGUgW1tSb3V0ZXJdXSdzIHBvc3RSZW5kZXIgcGlwZWxpbmUgc2xvdC5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gc3RlcCBUaGUgcGlwZWxpbmUgc3RlcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgYWRkUG9zdFJlbmRlclN0ZXAoc3RlcCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLmFkZFBpcGVsaW5lU3RlcChcInBvc3RSZW5kZXJcIiAvKiBQb3N0UmVuZGVyICovLCBzdGVwKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ29uZmlndXJlcyBhIHJvdXRlIHRoYXQgd2lsbCBiZSB1c2VkIGlmIHRoZXJlIGlzIG5vIHByZXZpb3VzIGxvY2F0aW9uIGF2YWlsYWJsZSBvbiBuYXZpZ2F0aW9uIGNhbmNlbGxhdGlvbi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gZnJhZ21lbnQgVGhlIFVSTCBmcmFnbWVudCB0byB1c2UgYXMgdGhlIG5hdmlnYXRpb24gZGVzdGluYXRpb24uXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIGZhbGxiYWNrUm91dGUoZnJhZ21lbnQpIHtcclxuICAgICAgICB0aGlzLl9mYWxsYmFja1JvdXRlID0gZnJhZ21lbnQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE1hcHMgb25lIG9yIG1vcmUgcm91dGVzIHRvIGJlIHJlZ2lzdGVyZWQgd2l0aCB0aGUgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZSBUaGUgW1tSb3V0ZUNvbmZpZ11dIHRvIG1hcCwgb3IgYW4gYXJyYXkgb2YgW1tSb3V0ZUNvbmZpZ11dIHRvIG1hcC5cclxuICAgICAqIEBjaGFpbmFibGVcclxuICAgICAqL1xyXG4gICAgbWFwKHJvdXRlKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocm91dGUpKSB7XHJcbiAgICAgICAgICAgIHJvdXRlLmZvckVhY2gociA9PiB0aGlzLm1hcChyKSk7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5tYXBSb3V0ZShyb3V0ZSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZXMgZGVmYXVsdHMgdG8gdXNlIGZvciBhbnkgdmlldyBwb3J0cy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmlld1BvcnRDb25maWcgYSB2aWV3IHBvcnQgY29uZmlndXJhdGlvbiBvYmplY3QgdG8gdXNlIGFzIGFcclxuICAgICAqICBkZWZhdWx0LCBvZiB0aGUgZm9ybSB7IHZpZXdQb3J0TmFtZTogeyBtb2R1bGVJZCB9IH0uXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIHVzZVZpZXdQb3J0RGVmYXVsdHModmlld1BvcnRDb25maWcpIHtcclxuICAgICAgICB0aGlzLnZpZXdQb3J0RGVmYXVsdHMgPSB2aWV3UG9ydENvbmZpZztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTWFwcyBhIHNpbmdsZSByb3V0ZSB0byBiZSByZWdpc3RlcmVkIHdpdGggdGhlIHJvdXRlci5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcm91dGUgVGhlIFtbUm91dGVDb25maWddXSB0byBtYXAuXHJcbiAgICAgKiBAY2hhaW5hYmxlXHJcbiAgICAgKi9cclxuICAgIG1hcFJvdXRlKGNvbmZpZykge1xyXG4gICAgICAgIHRoaXMuaW5zdHJ1Y3Rpb25zLnB1c2gocm91dGVyID0+IHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlQ29uZmlncyA9IF9lbnN1cmVBcnJheVdpdGhTaW5nbGVSb3V0ZVBlckNvbmZpZyhjb25maWcpO1xyXG4gICAgICAgICAgICBsZXQgbmF2TW9kZWw7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHJvdXRlQ29uZmlncy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgcm91dGVDb25maWcgPSByb3V0ZUNvbmZpZ3NbaV07XHJcbiAgICAgICAgICAgICAgICByb3V0ZUNvbmZpZy5zZXR0aW5ncyA9IHJvdXRlQ29uZmlnLnNldHRpbmdzIHx8IHt9O1xyXG4gICAgICAgICAgICAgICAgaWYgKCFuYXZNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG5hdk1vZGVsID0gcm91dGVyLmNyZWF0ZU5hdk1vZGVsKHJvdXRlQ29uZmlnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJvdXRlci5hZGRSb3V0ZShyb3V0ZUNvbmZpZywgbmF2TW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBhbiB1bmtub3duIHJvdXRlIGhhbmRsZXIgdG8gYmUgcnVuIHdoZW4gdGhlIFVSTCBmcmFnbWVudCBkb2Vzbid0IG1hdGNoIGFueSByZWdpc3RlcmVkIHJvdXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29uZmlnIEEgc3RyaW5nIGNvbnRhaW5pbmcgYSBtb2R1bGVJZCB0byBsb2FkLCBvciBhIFtbUm91dGVDb25maWddXSwgb3IgYSBmdW5jdGlvbiB0aGF0IHRha2VzIHRoZVxyXG4gICAgICogIFtbTmF2aWdhdGlvbkluc3RydWN0aW9uXV0gYW5kIHNlbGVjdHMgYSBtb2R1bGVJZCB0byBsb2FkLlxyXG4gICAgICogQGNoYWluYWJsZVxyXG4gICAgICovXHJcbiAgICBtYXBVbmtub3duUm91dGVzKGNvbmZpZykge1xyXG4gICAgICAgIHRoaXMudW5rbm93blJvdXRlQ29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBcHBsaWVzIHRoZSBjdXJyZW50IGNvbmZpZ3VyYXRpb24gdG8gdGhlIHNwZWNpZmllZCBbW1JvdXRlcl1dLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZXIgVGhlIFtbUm91dGVyXV0gdG8gYXBwbHkgdGhlIGNvbmZpZ3VyYXRpb24gdG8uXHJcbiAgICAgKi9cclxuICAgIGV4cG9ydFRvUm91dGVyKHJvdXRlcikge1xyXG4gICAgICAgIGxldCBpbnN0cnVjdGlvbnMgPSB0aGlzLmluc3RydWN0aW9ucztcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbnN0cnVjdGlvbnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbnNbaV0ocm91dGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHsgdGl0bGUsIHRpdGxlU2VwYXJhdG9yLCB1bmtub3duUm91dGVDb25maWcsIF9mYWxsYmFja1JvdXRlLCB2aWV3UG9ydERlZmF1bHRzIH0gPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aXRsZSkge1xyXG4gICAgICAgICAgICByb3V0ZXIudGl0bGUgPSB0aXRsZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRpdGxlU2VwYXJhdG9yKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci50aXRsZVNlcGFyYXRvciA9IHRpdGxlU2VwYXJhdG9yO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodW5rbm93blJvdXRlQ29uZmlnKSB7XHJcbiAgICAgICAgICAgIHJvdXRlci5oYW5kbGVVbmtub3duUm91dGVzKHVua25vd25Sb3V0ZUNvbmZpZyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChfZmFsbGJhY2tSb3V0ZSkge1xyXG4gICAgICAgICAgICByb3V0ZXIuZmFsbGJhY2tSb3V0ZSA9IF9mYWxsYmFja1JvdXRlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmlld1BvcnREZWZhdWx0cykge1xyXG4gICAgICAgICAgICByb3V0ZXIudXNlVmlld1BvcnREZWZhdWx0cyh2aWV3UG9ydERlZmF1bHRzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbihyb3V0ZXIub3B0aW9ucywgdGhpcy5vcHRpb25zKTtcclxuICAgICAgICBsZXQgcGlwZWxpbmVTdGVwcyA9IHRoaXMucGlwZWxpbmVTdGVwcztcclxuICAgICAgICBsZXQgcGlwZWxpbmVTdGVwQ291bnQgPSBwaXBlbGluZVN0ZXBzLmxlbmd0aDtcclxuICAgICAgICBpZiAocGlwZWxpbmVTdGVwQ291bnQpIHtcclxuICAgICAgICAgICAgaWYgKCFyb3V0ZXIuaXNSb290KSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1BpcGVsaW5lIHN0ZXBzIGNhbiBvbmx5IGJlIGFkZGVkIHRvIHRoZSByb290IHJvdXRlcicpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBwaXBlbGluZVByb3ZpZGVyID0gcm91dGVyLnBpcGVsaW5lUHJvdmlkZXI7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBpcGVsaW5lU3RlcENvdW50OyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHsgbmFtZSwgc3RlcCB9ID0gcGlwZWxpbmVTdGVwc1tpXTtcclxuICAgICAgICAgICAgICAgIHBpcGVsaW5lUHJvdmlkZXIuYWRkU3RlcChuYW1lLCBzdGVwKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxuXG4vKipcclxuICogVGhlIHByaW1hcnkgY2xhc3MgcmVzcG9uc2libGUgZm9yIGhhbmRsaW5nIHJvdXRpbmcgYW5kIG5hdmlnYXRpb24uXHJcbiAqL1xyXG5jbGFzcyBSb3V0ZXIge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gY29udGFpbmVyIFRoZSBbW0NvbnRhaW5lcl1dIHRvIHVzZSB3aGVuIGNoaWxkIHJvdXRlcnMuXHJcbiAgICAgKiBAcGFyYW0gaGlzdG9yeSBUaGUgW1tIaXN0b3J5XV0gaW1wbGVtZW50YXRpb24gdG8gZGVsZWdhdGUgbmF2aWdhdGlvbiByZXF1ZXN0cyB0by5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyLCBoaXN0b3J5KSB7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogVGhlIHBhcmVudCByb3V0ZXIsIG9yIG51bGwgaWYgdGhpcyBpbnN0YW5jZSBpcyBub3QgYSBjaGlsZCByb3V0ZXIuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5wYXJlbnQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9IHt9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIFRoZSBkZWZhdWx0cyB1c2VkIHdoZW4gYSB2aWV3cG9ydCBsYWNrcyBzcGVjaWZpZWQgY29udGVudFxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMudmlld1BvcnREZWZhdWx0cyA9IHt9O1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEV4dGVuc2lvbiBwb2ludCB0byB0cmFuc2Zvcm0gdGhlIGRvY3VtZW50IHRpdGxlIGJlZm9yZSBpdCBpcyBidWlsdCBhbmQgZGlzcGxheWVkLlxyXG4gICAgICAgICAqIEJ5IGRlZmF1bHQsIGNoaWxkIHJvdXRlcnMgZGVsZWdhdGUgdG8gdGhlIHBhcmVudCByb3V0ZXIsIGFuZCB0aGUgYXBwIHJvdXRlclxyXG4gICAgICAgICAqIHJldHVybnMgdGhlIHRpdGxlIHVuY2hhbmdlZC5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLnRyYW5zZm9ybVRpdGxlID0gKHRpdGxlKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LnRyYW5zZm9ybVRpdGxlKHRpdGxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gdGl0bGU7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLmhpc3RvcnkgPSBoaXN0b3J5O1xyXG4gICAgICAgIHRoaXMucmVzZXQoKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRnVsbHkgcmVzZXRzIHRoZSByb3V0ZXIncyBpbnRlcm5hbCBzdGF0ZS4gUHJpbWFyaWx5IHVzZWQgaW50ZXJuYWxseSBieSB0aGUgZnJhbWV3b3JrIHdoZW4gbXVsdGlwbGUgY2FsbHMgdG8gc2V0Um9vdCBhcmUgbWFkZS5cclxuICAgICAqIFVzZSB3aXRoIGNhdXRpb24gKGFjdHVhbGx5LCBhdm9pZCB1c2luZyB0aGlzKS4gRG8gbm90IHVzZSB0aGlzIHRvIHNpbXBseSBjaGFuZ2UgeW91ciBuYXZpZ2F0aW9uIG1vZGVsLlxyXG4gICAgICovXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICB0aGlzLnZpZXdQb3J0cyA9IHt9O1xyXG4gICAgICAgIHRoaXMucm91dGVzID0gW107XHJcbiAgICAgICAgdGhpcy5iYXNlVXJsID0gJyc7XHJcbiAgICAgICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzTmF2aWdhdGluZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNFeHBsaWNpdE5hdmlnYXRpb24gPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzRXhwbGljaXROYXZpZ2F0aW9uQmFjayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nRmlyc3QgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmlzTmF2aWdhdGluZ05ldyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nUmVmcmVzaCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nRm9yd2FyZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nQmFjayA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY291bGREZWFjdGl2YXRlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gW107XHJcbiAgICAgICAgdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb24gPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlld1BvcnREZWZhdWx0cyA9IHt9O1xyXG4gICAgICAgIHRoaXMuX2ZhbGxiYWNrT3JkZXIgPSAxMDA7XHJcbiAgICAgICAgdGhpcy5fcmVjb2duaXplciA9IG5ldyBSb3V0ZVJlY29nbml6ZXIoKTtcclxuICAgICAgICB0aGlzLl9jaGlsZFJlY29nbml6ZXIgPSBuZXcgUm91dGVSZWNvZ25pemVyKCk7XHJcbiAgICAgICAgdGhpcy5fY29uZmlndXJlZFByb21pc2UgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcclxuICAgICAgICAgICAgdGhpcy5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlID0gcmVzb2x2ZTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2V0cyBhIHZhbHVlIGluZGljYXRpbmcgd2hldGhlciBvciBub3QgdGhpcyBbW1JvdXRlcl1dIGlzIHRoZSByb290IGluIHRoZSByb3V0ZXIgdHJlZS4gSS5lLiwgaXQgaGFzIG5vIHBhcmVudC5cclxuICAgICAqL1xyXG4gICAgZ2V0IGlzUm9vdCgpIHtcclxuICAgICAgICByZXR1cm4gIXRoaXMucGFyZW50O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlcnMgYSB2aWV3UG9ydCB0byBiZSB1c2VkIGFzIGEgcmVuZGVyaW5nIHRhcmdldCBmb3IgYWN0aXZhdGVkIHJvdXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gdmlld1BvcnQgVGhlIHZpZXdQb3J0LlxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHZpZXdQb3J0LiAnZGVmYXVsdCcgaWYgdW5zcGVjaWZpZWQuXHJcbiAgICAgKi9cclxuICAgIHJlZ2lzdGVyVmlld1BvcnQodmlld1BvcnQsIG5hbWUpIHtcclxuICAgICAgICBuYW1lID0gbmFtZSB8fCAnZGVmYXVsdCc7XHJcbiAgICAgICAgdGhpcy52aWV3UG9ydHNbbmFtZV0gPSB2aWV3UG9ydDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIFByb21pc2UgdGhhdCByZXNvbHZlcyB3aGVuIHRoZSByb3V0ZXIgaXMgY29uZmlndXJlZC5cclxuICAgICAqL1xyXG4gICAgZW5zdXJlQ29uZmlndXJlZCgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5fY29uZmlndXJlZFByb21pc2U7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZXMgdGhlIHJvdXRlci5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2tPckNvbmZpZyBUaGUgW1tSb3V0ZXJDb25maWd1cmF0aW9uXV0gb3IgYSBjYWxsYmFjayB0aGF0IHRha2VzIGEgW1tSb3V0ZXJDb25maWd1cmF0aW9uXV0uXHJcbiAgICAgKi9cclxuICAgIGNvbmZpZ3VyZShjYWxsYmFja09yQ29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSB0cnVlO1xyXG4gICAgICAgIGxldCByZXN1bHQgPSBjYWxsYmFja09yQ29uZmlnO1xyXG4gICAgICAgIGxldCBjb25maWc7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBjYWxsYmFja09yQ29uZmlnID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGNvbmZpZyA9IG5ldyBSb3V0ZXJDb25maWd1cmF0aW9uKCk7XHJcbiAgICAgICAgICAgIHJlc3VsdCA9IGNhbGxiYWNrT3JDb25maWcoY29uZmlnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2VcclxuICAgICAgICAgICAgLnJlc29sdmUocmVzdWx0KVxyXG4gICAgICAgICAgICAudGhlbigoYykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoYyAmJiBjLmV4cG9ydFRvUm91dGVyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25maWcgPSBjO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbmZpZy5leHBvcnRUb1JvdXRlcih0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5pc0NvbmZpZ3VyZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLl9yZXNvbHZlQ29uZmlndXJlZFByb21pc2UoKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTmF2aWdhdGVzIHRvIGEgbmV3IGxvY2F0aW9uLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBmcmFnbWVudCBUaGUgVVJMIGZyYWdtZW50IHRvIHVzZSBhcyB0aGUgbmF2aWdhdGlvbiBkZXN0aW5hdGlvbi5cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBuYXZpZ2F0aW9uIG9wdGlvbnMuXHJcbiAgICAgKi9cclxuICAgIG5hdmlnYXRlKGZyYWdtZW50LCBvcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQ29uZmlndXJlZCAmJiB0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJlbnQubmF2aWdhdGUoZnJhZ21lbnQsIG9wdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzRXhwbGljaXROYXZpZ2F0aW9uID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gdGhpcy5oaXN0b3J5Lm5hdmlnYXRlKF9yZXNvbHZlVXJsKGZyYWdtZW50LCB0aGlzLmJhc2VVcmwsIHRoaXMuaGlzdG9yeS5faGFzUHVzaFN0YXRlKSwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE5hdmlnYXRlcyB0byBhIG5ldyBsb2NhdGlvbiBjb3JyZXNwb25kaW5nIHRvIHRoZSByb3V0ZSBhbmQgcGFyYW1zIHNwZWNpZmllZC4gRXF1aXZhbGxlbnQgdG8gW1tSb3V0ZXIuZ2VuZXJhdGVdXSBmb2xsb3dlZFxyXG4gICAgICogYnkgW1tSb3V0ZXIubmF2aWdhdGVdXS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcm91dGUgVGhlIG5hbWUgb2YgdGhlIHJvdXRlIHRvIHVzZSB3aGVuIGdlbmVyYXRpbmcgdGhlIG5hdmlnYXRpb24gbG9jYXRpb24uXHJcbiAgICAgKiBAcGFyYW0gcGFyYW1zIFRoZSByb3V0ZSBwYXJhbWV0ZXJzIHRvIGJlIHVzZWQgd2hlbiBwb3B1bGF0aW5nIHRoZSByb3V0ZSBwYXR0ZXJuLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG5hdmlnYXRpb24gb3B0aW9ucy5cclxuICAgICAqL1xyXG4gICAgbmF2aWdhdGVUb1JvdXRlKHJvdXRlLCBwYXJhbXMsIG9wdGlvbnMpIHtcclxuICAgICAgICBsZXQgcGF0aCA9IHRoaXMuZ2VuZXJhdGUocm91dGUsIHBhcmFtcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMubmF2aWdhdGUocGF0aCwgb3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIE5hdmlnYXRlcyBiYWNrIHRvIHRoZSBtb3N0IHJlY2VudCBsb2NhdGlvbiBpbiBoaXN0b3J5LlxyXG4gICAgICovXHJcbiAgICBuYXZpZ2F0ZUJhY2soKSB7XHJcbiAgICAgICAgdGhpcy5pc0V4cGxpY2l0TmF2aWdhdGlvbkJhY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaGlzdG9yeS5uYXZpZ2F0ZUJhY2soKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ3JlYXRlcyBhIGNoaWxkIHJvdXRlciBvZiB0aGUgY3VycmVudCByb3V0ZXIuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGNvbnRhaW5lciBUaGUgW1tDb250YWluZXJdXSB0byBwcm92aWRlIHRvIHRoZSBjaGlsZCByb3V0ZXIuIFVzZXMgdGhlIGN1cnJlbnQgW1tSb3V0ZXJdXSdzIFtbQ29udGFpbmVyXV0gaWYgdW5zcGVjaWZpZWQuXHJcbiAgICAgKiBAcmV0dXJucyB7Um91dGVyfSBUaGUgbmV3IGNoaWxkIFJvdXRlci5cclxuICAgICAqL1xyXG4gICAgY3JlYXRlQ2hpbGQoY29udGFpbmVyKSB7XHJcbiAgICAgICAgbGV0IGNoaWxkUm91dGVyID0gbmV3IFJvdXRlcihjb250YWluZXIgfHwgdGhpcy5jb250YWluZXIuY3JlYXRlQ2hpbGQoKSwgdGhpcy5oaXN0b3J5KTtcclxuICAgICAgICBjaGlsZFJvdXRlci5wYXJlbnQgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiBjaGlsZFJvdXRlcjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogR2VuZXJhdGVzIGEgVVJMIGZyYWdtZW50IG1hdGNoaW5nIHRoZSBzcGVjaWZpZWQgcm91dGUgcGF0dGVybi5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcm91dGUgd2hvc2UgcGF0dGVybiBzaG91bGQgYmUgdXNlZCB0byBnZW5lcmF0ZSB0aGUgZnJhZ21lbnQuXHJcbiAgICAgKiBAcGFyYW0gcGFyYW1zIFRoZSByb3V0ZSBwYXJhbXMgdG8gYmUgdXNlZCB0byBwb3B1bGF0ZSB0aGUgcm91dGUgcGF0dGVybi5cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIElmIG9wdGlvbnMuYWJzb2x1dGUgPSB0cnVlLCB0aGVuIGFic29sdXRlIHVybCB3aWxsIGJlIGdlbmVyYXRlZDsgb3RoZXJ3aXNlLCBpdCB3aWxsIGJlIHJlbGF0aXZlIHVybC5cclxuICAgICAqIEByZXR1cm5zIHtzdHJpbmd9IEEgc3RyaW5nIGNvbnRhaW5pbmcgdGhlIGdlbmVyYXRlZCBVUkwgZnJhZ21lbnQuXHJcbiAgICAgKi9cclxuICAgIGdlbmVyYXRlKG5hbWVPclJvdXRlLCBwYXJhbXMgPSB7fSwgb3B0aW9ucyA9IHt9KSB7XHJcbiAgICAgICAgLy8gQSBjaGlsZCByZWNvZ25pemVyIGdlbmVyYXRlcyByb3V0ZXMgZm9yIHBvdGVudGlhbCBjaGlsZCByb3V0ZXMuIEFueSBwb3RlbnRpYWwgY2hpbGQgcm91dGUgaXMgYWRkZWRcclxuICAgICAgICAvLyB0byB0aGUgY2hpbGRSb3V0ZSBwcm9wZXJ0eSBvZiBwYXJhbXMgZm9yIHRoZSBjaGlsZFJvdXRlciB0byByZWNvZ25pemUuIFdoZW4gZ2VuZXJhdGluZyByb3V0ZXMsIHdlXHJcbiAgICAgICAgLy8gdXNlIHRoZSBjaGlsZFJlY29nbml6ZXIgd2hlbiBjaGlsZFJvdXRlIHBhcmFtcyBhcmUgYXZhaWxhYmxlIHRvIGdlbmVyYXRlIGEgY2hpbGQgcm91dGVyIGVuYWJsZWQgcm91dGUuXHJcbiAgICAgICAgbGV0IHJlY29nbml6ZXIgPSAnY2hpbGRSb3V0ZScgaW4gcGFyYW1zID8gdGhpcy5fY2hpbGRSZWNvZ25pemVyIDogdGhpcy5fcmVjb2duaXplcjtcclxuICAgICAgICBsZXQgaGFzUm91dGUgPSByZWNvZ25pemVyLmhhc1JvdXRlKG5hbWVPclJvdXRlKTtcclxuICAgICAgICBpZiAoIWhhc1JvdXRlKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGFyZW50LmdlbmVyYXRlKG5hbWVPclJvdXRlLCBwYXJhbXMsIG9wdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQSByb3V0ZSB3aXRoIG5hbWUgJyR7bmFtZU9yUm91dGV9JyBjb3VsZCBub3QgYmUgZm91bmQuIENoZWNrIHRoYXQgXFxgbmFtZTogJyR7bmFtZU9yUm91dGV9J1xcYCB3YXMgc3BlY2lmaWVkIGluIHRoZSByb3V0ZSdzIGNvbmZpZy5gKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IHBhdGggPSByZWNvZ25pemVyLmdlbmVyYXRlKG5hbWVPclJvdXRlLCBwYXJhbXMpO1xyXG4gICAgICAgIGxldCByb290ZWRQYXRoID0gX2NyZWF0ZVJvb3RlZFBhdGgocGF0aCwgdGhpcy5iYXNlVXJsLCB0aGlzLmhpc3RvcnkuX2hhc1B1c2hTdGF0ZSwgb3B0aW9ucy5hYnNvbHV0ZSk7XHJcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMuYWJzb2x1dGUgPyBgJHt0aGlzLmhpc3RvcnkuZ2V0QWJzb2x1dGVSb290KCl9JHtyb290ZWRQYXRofWAgOiByb290ZWRQYXRoO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGVzIGEgW1tOYXZNb2RlbF1dIGZvciB0aGUgc3BlY2lmaWVkIHJvdXRlIGNvbmZpZy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29uZmlnIFRoZSByb3V0ZSBjb25maWcuXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZU5hdk1vZGVsKGNvbmZpZykge1xyXG4gICAgICAgIGxldCBuYXZNb2RlbCA9IG5ldyBOYXZNb2RlbCh0aGlzLCAnaHJlZicgaW4gY29uZmlnXHJcbiAgICAgICAgICAgID8gY29uZmlnLmhyZWZcclxuICAgICAgICAgICAgLy8gcG90ZW50aWFsIGVycm9yIHdoZW4gY29uZmlnLnJvdXRlIGlzIGEgc3RyaW5nW10gP1xyXG4gICAgICAgICAgICA6IGNvbmZpZy5yb3V0ZSk7XHJcbiAgICAgICAgbmF2TW9kZWwudGl0bGUgPSBjb25maWcudGl0bGU7XHJcbiAgICAgICAgbmF2TW9kZWwub3JkZXIgPSBjb25maWcubmF2O1xyXG4gICAgICAgIG5hdk1vZGVsLmhyZWYgPSBjb25maWcuaHJlZjtcclxuICAgICAgICBuYXZNb2RlbC5zZXR0aW5ncyA9IGNvbmZpZy5zZXR0aW5ncztcclxuICAgICAgICBuYXZNb2RlbC5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgcmV0dXJuIG5hdk1vZGVsO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlcnMgYSBuZXcgcm91dGUgd2l0aCB0aGUgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBjb25maWcgVGhlIFtbUm91dGVDb25maWddXS5cclxuICAgICAqIEBwYXJhbSBuYXZNb2RlbCBUaGUgW1tOYXZNb2RlbF1dIHRvIHVzZSBmb3IgdGhlIHJvdXRlLiBNYXkgYmUgb21pdHRlZCBmb3Igc2luZ2xlLXBhdHRlcm4gcm91dGVzLlxyXG4gICAgICovXHJcbiAgICBhZGRSb3V0ZShjb25maWcsIG5hdk1vZGVsKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29uZmlnLnJvdXRlKSkge1xyXG4gICAgICAgICAgICBsZXQgcm91dGVDb25maWdzID0gX2Vuc3VyZUFycmF5V2l0aFNpbmdsZVJvdXRlUGVyQ29uZmlnKGNvbmZpZyk7XHJcbiAgICAgICAgICAgIC8vIHRoZSBmb2xsb3dpbmcgaXMgd3JvbmcuIHRvZG86IGZpeCB0aGlzIGFmdGVyIFRTIHJlZmFjdG9yaW5nIHJlbGVhc2VcclxuICAgICAgICAgICAgcm91dGVDb25maWdzLmZvckVhY2godGhpcy5hZGRSb3V0ZS5iaW5kKHRoaXMpKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YWxpZGF0ZVJvdXRlQ29uZmlnKGNvbmZpZyk7XHJcbiAgICAgICAgaWYgKCEoJ3ZpZXdQb3J0cycgaW4gY29uZmlnKSAmJiAhY29uZmlnLm5hdmlnYXRpb25TdHJhdGVneSkge1xyXG4gICAgICAgICAgICBjb25maWcudmlld1BvcnRzID0ge1xyXG4gICAgICAgICAgICAgICAgJ2RlZmF1bHQnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSWQ6IGNvbmZpZy5tb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgICAgICB2aWV3OiBjb25maWcudmlld1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW5hdk1vZGVsKSB7XHJcbiAgICAgICAgICAgIG5hdk1vZGVsID0gdGhpcy5jcmVhdGVOYXZNb2RlbChjb25maWcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJvdXRlcy5wdXNoKGNvbmZpZyk7XHJcbiAgICAgICAgbGV0IHBhdGggPSBjb25maWcucm91dGU7XHJcbiAgICAgICAgaWYgKHBhdGguY2hhckF0KDApID09PSAnLycpIHtcclxuICAgICAgICAgICAgcGF0aCA9IHBhdGguc3Vic3RyKDEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgY2FzZVNlbnNpdGl2ZSA9IGNvbmZpZy5jYXNlU2Vuc2l0aXZlID09PSB0cnVlO1xyXG4gICAgICAgIGxldCBzdGF0ZSA9IHRoaXMuX3JlY29nbml6ZXIuYWRkKHtcclxuICAgICAgICAgICAgcGF0aDogcGF0aCxcclxuICAgICAgICAgICAgaGFuZGxlcjogY29uZmlnLFxyXG4gICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHBhdGgpIHtcclxuICAgICAgICAgICAgbGV0IHNldHRpbmdzID0gY29uZmlnLnNldHRpbmdzO1xyXG4gICAgICAgICAgICBkZWxldGUgY29uZmlnLnNldHRpbmdzO1xyXG4gICAgICAgICAgICBsZXQgd2l0aENoaWxkID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShjb25maWcpKTtcclxuICAgICAgICAgICAgY29uZmlnLnNldHRpbmdzID0gc2V0dGluZ3M7XHJcbiAgICAgICAgICAgIHdpdGhDaGlsZC5yb3V0ZSA9IGAke3BhdGh9LypjaGlsZFJvdXRlYDtcclxuICAgICAgICAgICAgd2l0aENoaWxkLmhhc0NoaWxkUm91dGVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgdGhpcy5fY2hpbGRSZWNvZ25pemVyLmFkZCh7XHJcbiAgICAgICAgICAgICAgICBwYXRoOiB3aXRoQ2hpbGQucm91dGUsXHJcbiAgICAgICAgICAgICAgICBoYW5kbGVyOiB3aXRoQ2hpbGQsXHJcbiAgICAgICAgICAgICAgICBjYXNlU2Vuc2l0aXZlOiBjYXNlU2Vuc2l0aXZlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB3aXRoQ2hpbGQubmF2TW9kZWwgPSBuYXZNb2RlbDtcclxuICAgICAgICAgICAgd2l0aENoaWxkLnNldHRpbmdzID0gY29uZmlnLnNldHRpbmdzO1xyXG4gICAgICAgICAgICB3aXRoQ2hpbGQubmF2aWdhdGlvblN0cmF0ZWd5ID0gY29uZmlnLm5hdmlnYXRpb25TdHJhdGVneTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uZmlnLm5hdk1vZGVsID0gbmF2TW9kZWw7XHJcbiAgICAgICAgbGV0IG5hdmlnYXRpb24gPSB0aGlzLm5hdmlnYXRpb247XHJcbiAgICAgICAgaWYgKChuYXZNb2RlbC5vcmRlciB8fCBuYXZNb2RlbC5vcmRlciA9PT0gMCkgJiYgbmF2aWdhdGlvbi5pbmRleE9mKG5hdk1vZGVsKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgaWYgKCghbmF2TW9kZWwuaHJlZiAmJiBuYXZNb2RlbC5ocmVmICE9PSAnJykgJiYgKHN0YXRlLnR5cGVzLmR5bmFtaWNzIHx8IHN0YXRlLnR5cGVzLnN0YXJzKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIHJvdXRlIGNvbmZpZyBmb3IgXCInICsgY29uZmlnLnJvdXRlICsgJ1wiIDogZHluYW1pYyByb3V0ZXMgbXVzdCBzcGVjaWZ5IGFuIFwiaHJlZjpcIiB0byBiZSBpbmNsdWRlZCBpbiB0aGUgbmF2aWdhdGlvbiBtb2RlbC4nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mIG5hdk1vZGVsLm9yZGVyICE9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICAgICAgbmF2TW9kZWwub3JkZXIgPSArK3RoaXMuX2ZhbGxiYWNrT3JkZXI7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbmF2aWdhdGlvbi5wdXNoKG5hdk1vZGVsKTtcclxuICAgICAgICAgICAgLy8gdGhpcyBpcyBhIHBvdGVudGlhbCBlcnJvciAvIGluY29uc2lzdGVuY3kgYmV0d2VlbiBicm93c2Vyc1xyXG4gICAgICAgICAgICAvL1xyXG4gICAgICAgICAgICAvLyBNRE46IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0FycmF5L3NvcnRcclxuICAgICAgICAgICAgLy8gSWYgY29tcGFyZUZ1bmN0aW9uKGEsIGIpIHJldHVybnMgMCwgbGVhdmUgYSBhbmQgYiB1bmNoYW5nZWQgd2l0aCByZXNwZWN0IHRvIGVhY2ggb3RoZXIsXHJcbiAgICAgICAgICAgIC8vIGJ1dCBzb3J0ZWQgd2l0aCByZXNwZWN0IHRvIGFsbCBkaWZmZXJlbnQgZWxlbWVudHMuXHJcbiAgICAgICAgICAgIC8vIE5vdGU6IHRoZSBFQ01Bc2NyaXB0IHN0YW5kYXJkIGRvZXMgbm90IGd1YXJhbnRlZSB0aGlzIGJlaGF2aW91cixcclxuICAgICAgICAgICAgLy8gYW5kIHRodXMgbm90IGFsbCBicm93c2VycyAoZS5nLiBNb3ppbGxhIHZlcnNpb25zIGRhdGluZyBiYWNrIHRvIGF0IGxlYXN0IDIwMDMpIHJlc3BlY3QgdGhpcy5cclxuICAgICAgICAgICAgbmF2aWdhdGlvbi5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBHZXRzIGEgdmFsdWUgaW5kaWNhdGluZyB3aGV0aGVyIG9yIG5vdCB0aGlzIFtbUm91dGVyXV0gb3Igb25lIG9mIGl0cyBhbmNlc3RvcnMgaGFzIGEgcm91dGUgcmVnaXN0ZXJlZCB3aXRoIHRoZSBzcGVjaWZpZWQgbmFtZS5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gbmFtZSBUaGUgbmFtZSBvZiB0aGUgcm91dGUgdG8gY2hlY2suXHJcbiAgICAgKi9cclxuICAgIGhhc1JvdXRlKG5hbWUpIHtcclxuICAgICAgICByZXR1cm4gISEodGhpcy5fcmVjb2duaXplci5oYXNSb3V0ZShuYW1lKSB8fCB0aGlzLnBhcmVudCAmJiB0aGlzLnBhcmVudC5oYXNSb3V0ZShuYW1lKSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEdldHMgYSB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgb3Igbm90IHRoaXMgW1tSb3V0ZXJdXSBoYXMgYSByb3V0ZSByZWdpc3RlcmVkIHdpdGggdGhlIHNwZWNpZmllZCBuYW1lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBuYW1lIFRoZSBuYW1lIG9mIHRoZSByb3V0ZSB0byBjaGVjay5cclxuICAgICAqL1xyXG4gICAgaGFzT3duUm91dGUobmFtZSkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9yZWNvZ25pemVyLmhhc1JvdXRlKG5hbWUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZWdpc3RlciBhIGhhbmRsZXIgdG8gdXNlIHdoZW4gdGhlIGluY29taW5nIFVSTCBmcmFnbWVudCBkb2Vzbid0IG1hdGNoIGFueSByZWdpc3RlcmVkIHJvdXRlcy5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gY29uZmlnIFRoZSBtb2R1bGVJZCwgb3IgYSBmdW5jdGlvbiB0aGF0IHNlbGVjdHMgdGhlIG1vZHVsZUlkLCBvciBhIFtbUm91dGVDb25maWddXS5cclxuICAgICAqL1xyXG4gICAgaGFuZGxlVW5rbm93blJvdXRlcyhjb25maWcpIHtcclxuICAgICAgICBpZiAoIWNvbmZpZykge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgdW5rbm93biByb3V0ZSBoYW5kbGVyJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY2F0Y2hBbGxIYW5kbGVyID0gaW5zdHJ1Y3Rpb24gPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAgICAgLl9jcmVhdGVSb3V0ZUNvbmZpZyhjb25maWcsIGluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oYyA9PiB7XHJcbiAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5jb25maWcgPSBjO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBVcGRhdGVzIHRoZSBkb2N1bWVudCB0aXRsZSB1c2luZyB0aGUgY3VycmVudCBuYXZpZ2F0aW9uIGluc3RydWN0aW9uLlxyXG4gICAgICovXHJcbiAgICB1cGRhdGVUaXRsZSgpIHtcclxuICAgICAgICBsZXQgcGFyZW50Um91dGVyID0gdGhpcy5wYXJlbnQ7XHJcbiAgICAgICAgaWYgKHBhcmVudFJvdXRlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gcGFyZW50Um91dGVyLnVwZGF0ZVRpdGxlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBjdXJyZW50SW5zdHJ1Y3Rpb24gPSB0aGlzLmN1cnJlbnRJbnN0cnVjdGlvbjtcclxuICAgICAgICBpZiAoY3VycmVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRJbnN0cnVjdGlvbi5fdXBkYXRlVGl0bGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogVXBkYXRlcyB0aGUgbmF2aWdhdGlvbiByb3V0ZXMgd2l0aCBocmVmcyByZWxhdGl2ZSB0byB0aGUgY3VycmVudCBsb2NhdGlvbi5cclxuICAgICAqIE5vdGU6IFRoaXMgbWV0aG9kIHdpbGwgbGlrZWx5IG1vdmUgdG8gYSBwbHVnaW4gaW4gYSBmdXR1cmUgcmVsZWFzZS5cclxuICAgICAqL1xyXG4gICAgcmVmcmVzaE5hdmlnYXRpb24oKSB7XHJcbiAgICAgICAgbGV0IG5hdiA9IHRoaXMubmF2aWdhdGlvbjtcclxuICAgICAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gbmF2Lmxlbmd0aDsgaSA8IGxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50ID0gbmF2W2ldO1xyXG4gICAgICAgICAgICBpZiAoIWN1cnJlbnQuY29uZmlnLmhyZWYpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuaHJlZiA9IF9jcmVhdGVSb290ZWRQYXRoKGN1cnJlbnQucmVsYXRpdmVIcmVmLCB0aGlzLmJhc2VVcmwsIHRoaXMuaGlzdG9yeS5faGFzUHVzaFN0YXRlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQuaHJlZiA9IF9ub3JtYWxpemVBYnNvbHV0ZVBhdGgoY3VycmVudC5jb25maWcuaHJlZiwgdGhpcy5oaXN0b3J5Ll9oYXNQdXNoU3RhdGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBTZXRzIHRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gZm9yIHRoZSB2aWV3IHBvcnRzLiBUaGlzIHNwZWNpZmllcyBob3cgdG9cclxuICAgICAqICBwb3B1bGF0ZSBhIHZpZXcgcG9ydCBmb3Igd2hpY2ggbm8gbW9kdWxlIGlzIHNwZWNpZmllZC4gVGhlIGRlZmF1bHQgaXNcclxuICAgICAqICBhbiBlbXB0eSB2aWV3L3ZpZXctbW9kZWwgcGFpci5cclxuICAgICAqL1xyXG4gICAgdXNlVmlld1BvcnREZWZhdWx0cygkdmlld1BvcnREZWZhdWx0cykge1xyXG4gICAgICAgIC8vIGEgd29ya2Fyb3VuZCB0byBoYXZlIHN0cm9uZyB0eXBpbmdzIHdoaWxlIG5vdCByZXF1aXJpbmcgdG8gZXhwb3NlIGludGVyZmFjZSBWaWV3UG9ydEluc3RydWN0aW9uXHJcbiAgICAgICAgbGV0IHZpZXdQb3J0RGVmYXVsdHMgPSAkdmlld1BvcnREZWZhdWx0cztcclxuICAgICAgICBmb3IgKGxldCB2aWV3UG9ydE5hbWUgaW4gdmlld1BvcnREZWZhdWx0cykge1xyXG4gICAgICAgICAgICBsZXQgdmlld1BvcnRDb25maWcgPSB2aWV3UG9ydERlZmF1bHRzW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgICAgIHRoaXMudmlld1BvcnREZWZhdWx0c1t2aWV3UG9ydE5hbWVdID0ge1xyXG4gICAgICAgICAgICAgICAgbW9kdWxlSWQ6IHZpZXdQb3J0Q29uZmlnLm1vZHVsZUlkXHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfcmVmcmVzaEJhc2VVcmwoKSB7XHJcbiAgICAgICAgbGV0IHBhcmVudFJvdXRlciA9IHRoaXMucGFyZW50O1xyXG4gICAgICAgIGlmIChwYXJlbnRSb3V0ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5iYXNlVXJsID0gZ2VuZXJhdGVCYXNlVXJsKHBhcmVudFJvdXRlciwgcGFyZW50Um91dGVyLmN1cnJlbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKHVybCA9ICcnLCBwYXJlbnRJbnN0cnVjdGlvbiA9IG51bGwpIHtcclxuICAgICAgICBsZXQgZnJhZ21lbnQgPSB1cmw7XHJcbiAgICAgICAgbGV0IHF1ZXJ5U3RyaW5nID0gJyc7XHJcbiAgICAgICAgbGV0IHF1ZXJ5SW5kZXggPSB1cmwuaW5kZXhPZignPycpO1xyXG4gICAgICAgIGlmIChxdWVyeUluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgICBmcmFnbWVudCA9IHVybC5zdWJzdHIoMCwgcXVlcnlJbmRleCk7XHJcbiAgICAgICAgICAgIHF1ZXJ5U3RyaW5nID0gdXJsLnN1YnN0cihxdWVyeUluZGV4ICsgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB1cmxSZWNvZ25pemF0aW9uUmVzdWx0cyA9IHRoaXMuX3JlY29nbml6ZXIucmVjb2duaXplKHVybCk7XHJcbiAgICAgICAgaWYgKCF1cmxSZWNvZ25pemF0aW9uUmVzdWx0cyB8fCAhdXJsUmVjb2duaXphdGlvblJlc3VsdHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHVybFJlY29nbml6YXRpb25SZXN1bHRzID0gdGhpcy5fY2hpbGRSZWNvZ25pemVyLnJlY29nbml6ZSh1cmwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgaW5zdHJ1Y3Rpb25Jbml0ID0ge1xyXG4gICAgICAgICAgICBmcmFnbWVudCxcclxuICAgICAgICAgICAgcXVlcnlTdHJpbmcsXHJcbiAgICAgICAgICAgIGNvbmZpZzogbnVsbCxcclxuICAgICAgICAgICAgcGFyZW50SW5zdHJ1Y3Rpb24sXHJcbiAgICAgICAgICAgIHByZXZpb3VzSW5zdHJ1Y3Rpb246IHRoaXMuY3VycmVudEluc3RydWN0aW9uLFxyXG4gICAgICAgICAgICByb3V0ZXI6IHRoaXMsXHJcbiAgICAgICAgICAgIG9wdGlvbnM6IHtcclxuICAgICAgICAgICAgICAgIGNvbXBhcmVRdWVyeVBhcmFtczogdGhpcy5vcHRpb25zLmNvbXBhcmVRdWVyeVBhcmFtc1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBsZXQgcmVzdWx0O1xyXG4gICAgICAgIGlmICh1cmxSZWNvZ25pemF0aW9uUmVzdWx0cyAmJiB1cmxSZWNvZ25pemF0aW9uUmVzdWx0cy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGZpcnN0ID0gdXJsUmVjb2duaXphdGlvblJlc3VsdHNbMF07XHJcbiAgICAgICAgICAgIGxldCBpbnN0cnVjdGlvbiA9IG5ldyBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24oT2JqZWN0LmFzc2lnbih7fSwgaW5zdHJ1Y3Rpb25Jbml0LCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IGZpcnN0LnBhcmFtcyxcclxuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zOiBmaXJzdC5xdWVyeVBhcmFtcyB8fCB1cmxSZWNvZ25pemF0aW9uUmVzdWx0cy5xdWVyeVBhcmFtcyxcclxuICAgICAgICAgICAgICAgIGNvbmZpZzogZmlyc3QuY29uZmlnIHx8IGZpcnN0LmhhbmRsZXJcclxuICAgICAgICAgICAgfSkpO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mIGZpcnN0LmhhbmRsZXIgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWx1YXRlTmF2aWdhdGlvblN0cmF0ZWd5KGluc3RydWN0aW9uLCBmaXJzdC5oYW5kbGVyLCBmaXJzdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoZmlyc3QuaGFuZGxlciAmJiB0eXBlb2YgZmlyc3QuaGFuZGxlci5uYXZpZ2F0aW9uU3RyYXRlZ3kgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGV2YWx1YXRlTmF2aWdhdGlvblN0cmF0ZWd5KGluc3RydWN0aW9uLCBmaXJzdC5oYW5kbGVyLm5hdmlnYXRpb25TdHJhdGVneSwgZmlyc3QuaGFuZGxlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBQcm9taXNlLnJlc29sdmUoaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuY2F0Y2hBbGxIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIGxldCBpbnN0cnVjdGlvbiA9IG5ldyBOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24oT2JqZWN0LmFzc2lnbih7fSwgaW5zdHJ1Y3Rpb25Jbml0LCB7XHJcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHsgcGF0aDogZnJhZ21lbnQgfSxcclxuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zOiB1cmxSZWNvZ25pemF0aW9uUmVzdWx0cyA/IHVybFJlY29nbml6YXRpb25SZXN1bHRzLnF1ZXJ5UGFyYW1zIDoge30sXHJcbiAgICAgICAgICAgICAgICBjb25maWc6IG51bGwgLy8gY29uZmlnIHdpbGwgYmUgY3JlYXRlZCBieSB0aGUgY2F0Y2hBbGxIYW5kbGVyXHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gZXZhbHVhdGVOYXZpZ2F0aW9uU3RyYXRlZ3koaW5zdHJ1Y3Rpb24sIHRoaXMuY2F0Y2hBbGxIYW5kbGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5wYXJlbnQpIHtcclxuICAgICAgICAgICAgbGV0IHJvdXRlciA9IHRoaXMuX3BhcmVudENhdGNoQWxsSGFuZGxlcih0aGlzLnBhcmVudCk7XHJcbiAgICAgICAgICAgIGlmIChyb3V0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGxldCBuZXdQYXJlbnRJbnN0cnVjdGlvbiA9IHRoaXMuX2ZpbmRQYXJlbnRJbnN0cnVjdGlvbkZyb21Sb3V0ZXIocm91dGVyLCBwYXJlbnRJbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICBsZXQgaW5zdHJ1Y3Rpb24gPSBuZXcgTmF2aWdhdGlvbkluc3RydWN0aW9uKE9iamVjdC5hc3NpZ24oe30sIGluc3RydWN0aW9uSW5pdCwge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcmFtczogeyBwYXRoOiBmcmFnbWVudCB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zOiB1cmxSZWNvZ25pemF0aW9uUmVzdWx0cyA/IHVybFJlY29nbml6YXRpb25SZXN1bHRzLnF1ZXJ5UGFyYW1zIDoge30sXHJcbiAgICAgICAgICAgICAgICAgICAgcm91dGVyOiByb3V0ZXIsXHJcbiAgICAgICAgICAgICAgICAgICAgcGFyZW50SW5zdHJ1Y3Rpb246IG5ld1BhcmVudEluc3RydWN0aW9uLFxyXG4gICAgICAgICAgICAgICAgICAgIHBhcmVudENhdGNoSGFuZGxlcjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICBjb25maWc6IG51bGwgLy8gY29uZmlnIHdpbGwgYmUgY3JlYXRlZCBieSB0aGUgY2hhaW5lZCBwYXJlbnQgY2F0Y2hBbGxIYW5kbGVyXHJcbiAgICAgICAgICAgICAgICB9KSk7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneShpbnN0cnVjdGlvbiwgcm91dGVyLmNhdGNoQWxsSGFuZGxlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlc3VsdCAmJiBwYXJlbnRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmJhc2VVcmwgPSBnZW5lcmF0ZUJhc2VVcmwodGhpcy5wYXJlbnQsIHBhcmVudEluc3RydWN0aW9uKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdCB8fCBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoYFJvdXRlIG5vdCBmb3VuZDogJHt1cmx9YCkpO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfZmluZFBhcmVudEluc3RydWN0aW9uRnJvbVJvdXRlcihyb3V0ZXIsIGluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgaWYgKGluc3RydWN0aW9uLnJvdXRlciA9PT0gcm91dGVyKSB7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uLmZyYWdtZW50ID0gcm91dGVyLmJhc2VVcmw7IC8vIG5lZWQgdG8gY2hhbmdlIHRoZSBmcmFnbWVudCBpbiBjYXNlIG9mIGEgcmVkaXJlY3QgaW5zdGVhZCBvZiBtb2R1bGVJZFxyXG4gICAgICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGluc3RydWN0aW9uLnBhcmVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5kUGFyZW50SW5zdHJ1Y3Rpb25Gcm9tUm91dGVyKHJvdXRlciwgaW5zdHJ1Y3Rpb24ucGFyZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG4gICAgLyoqQGludGVybmFsICovXHJcbiAgICBfcGFyZW50Q2F0Y2hBbGxIYW5kbGVyKHJvdXRlcikge1xyXG4gICAgICAgIGlmIChyb3V0ZXIuY2F0Y2hBbGxIYW5kbGVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByb3V0ZXI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHJvdXRlci5wYXJlbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3BhcmVudENhdGNoQWxsSGFuZGxlcihyb3V0ZXIucGFyZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBAaW50ZXJuYWxcclxuICAgICAqL1xyXG4gICAgX2NyZWF0ZVJvdXRlQ29uZmlnKGNvbmZpZywgaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZVxyXG4gICAgICAgICAgICAucmVzb2x2ZShjb25maWcpXHJcbiAgICAgICAgICAgIC50aGVuKChjKSA9PiB7XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYyA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IG1vZHVsZUlkOiBjIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIGMgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjKGluc3RydWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gYztcclxuICAgICAgICB9KVxyXG4gICAgICAgICAgICAvLyB0eXBpbmcgaGVyZSBjb3VsZCBiZSBlaXRoZXIgUm91dGVDb25maWcgb3IgUmVkaXJlY3RDb25maWdcclxuICAgICAgICAgICAgLy8gYnV0IHRlbXBvcmFyaWx5IHRyZWF0IGJvdGggYXMgUm91dGVDb25maWdcclxuICAgICAgICAgICAgLy8gdG9kbzogaW1wcm92ZSB0eXBpbmdzIHByZWNpc2lvblxyXG4gICAgICAgICAgICAudGhlbigoYykgPT4gdHlwZW9mIGMgPT09ICdzdHJpbmcnID8geyBtb2R1bGVJZDogYyB9IDogYylcclxuICAgICAgICAgICAgLnRoZW4oKGMpID0+IHtcclxuICAgICAgICAgICAgYy5yb3V0ZSA9IGluc3RydWN0aW9uLnBhcmFtcy5wYXRoO1xyXG4gICAgICAgICAgICB2YWxpZGF0ZVJvdXRlQ29uZmlnKGMpO1xyXG4gICAgICAgICAgICBpZiAoIWMubmF2TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIGMubmF2TW9kZWwgPSB0aGlzLmNyZWF0ZU5hdk1vZGVsKGMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcbi8qIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nICovXHJcbmNvbnN0IGdlbmVyYXRlQmFzZVVybCA9IChyb3V0ZXIsIGluc3RydWN0aW9uKSA9PiB7XHJcbiAgICByZXR1cm4gYCR7cm91dGVyLmJhc2VVcmwgfHwgJyd9JHtpbnN0cnVjdGlvbi5nZXRCYXNlVXJsKCkgfHwgJyd9YDtcclxufTtcclxuLyogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmcgKi9cclxuY29uc3QgdmFsaWRhdGVSb3V0ZUNvbmZpZyA9IChjb25maWcpID0+IHtcclxuICAgIGlmICh0eXBlb2YgY29uZmlnICE9PSAnb2JqZWN0Jykge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCBSb3V0ZSBDb25maWcnKTtcclxuICAgIH1cclxuICAgIGlmICh0eXBlb2YgY29uZmlnLnJvdXRlICE9PSAnc3RyaW5nJykge1xyXG4gICAgICAgIGxldCBuYW1lID0gY29uZmlnLm5hbWUgfHwgJyhubyBuYW1lKSc7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFJvdXRlIENvbmZpZyBmb3IgXCInICsgbmFtZSArICdcIjogWW91IG11c3Qgc3BlY2lmeSBhIFwicm91dGU6XCIgcGF0dGVybi4nKTtcclxuICAgIH1cclxuICAgIGlmICghKCdyZWRpcmVjdCcgaW4gY29uZmlnIHx8IGNvbmZpZy5tb2R1bGVJZCB8fCBjb25maWcubmF2aWdhdGlvblN0cmF0ZWd5IHx8IGNvbmZpZy52aWV3UG9ydHMpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIFJvdXRlIENvbmZpZyBmb3IgXCInICsgY29uZmlnLnJvdXRlICsgJ1wiOiBZb3UgbXVzdCBzcGVjaWZ5IGEgXCJtb2R1bGVJZDpcIiwgXCJyZWRpcmVjdDpcIiwgXCJuYXZpZ2F0aW9uU3RyYXRlZ3k6XCIsIG9yIFwidmlld1BvcnRzOlwiLicpO1xyXG4gICAgfVxyXG59O1xyXG4vKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jb25zdCBldmFsdWF0ZU5hdmlnYXRpb25TdHJhdGVneSA9IChpbnN0cnVjdGlvbiwgZXZhbHVhdG9yLCBjb250ZXh0KSA9PiB7XHJcbiAgICByZXR1cm4gUHJvbWlzZVxyXG4gICAgICAgIC5yZXNvbHZlKGV2YWx1YXRvci5jYWxsKGNvbnRleHQsIGluc3RydWN0aW9uKSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgaWYgKCEoJ3ZpZXdQb3J0cycgaW4gaW5zdHJ1Y3Rpb24uY29uZmlnKSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5jb25maWcudmlld1BvcnRzID0ge1xyXG4gICAgICAgICAgICAgICAgJ2RlZmF1bHQnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgbW9kdWxlSWQ6IGluc3RydWN0aW9uLmNvbmZpZy5tb2R1bGVJZFxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9KTtcclxufTtcblxuLyoqQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmcgKi9cclxuY29uc3QgY3JlYXRlTmV4dEZuID0gKGluc3RydWN0aW9uLCBzdGVwcykgPT4ge1xyXG4gICAgbGV0IGluZGV4ID0gLTE7XHJcbiAgICBjb25zdCBuZXh0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluZGV4Kys7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc3RlcHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50U3RlcCA9IHN0ZXBzW2luZGV4XTtcclxuICAgICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50U3RlcChpbnN0cnVjdGlvbiwgbmV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LnJlamVjdChlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5leHQuY29tcGxldGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgbmV4dC5jb21wbGV0ZSA9IGNyZWF0ZUNvbXBsZXRpb25IYW5kbGVyKG5leHQsIFwiY29tcGxldGVkXCIgLyogQ29tcGxldGVkICovKTtcclxuICAgIG5leHQuY2FuY2VsID0gY3JlYXRlQ29tcGxldGlvbkhhbmRsZXIobmV4dCwgXCJjYW5jZWxlZFwiIC8qIENhbmNlbGVkICovKTtcclxuICAgIG5leHQucmVqZWN0ID0gY3JlYXRlQ29tcGxldGlvbkhhbmRsZXIobmV4dCwgXCJyZWplY3RlZFwiIC8qIFJlamVjdGVkICovKTtcclxuICAgIHJldHVybiBuZXh0O1xyXG59O1xyXG4vKipAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyAqL1xyXG5jb25zdCBjcmVhdGVDb21wbGV0aW9uSGFuZGxlciA9IChuZXh0LCBzdGF0dXMpID0+IHtcclxuICAgIHJldHVybiAob3V0cHV0KSA9PiBQcm9taXNlXHJcbiAgICAgICAgLnJlc29sdmUoe1xyXG4gICAgICAgIHN0YXR1cyxcclxuICAgICAgICBvdXRwdXQsXHJcbiAgICAgICAgY29tcGxldGVkOiBzdGF0dXMgPT09IFwiY29tcGxldGVkXCIgLyogQ29tcGxldGVkICovXHJcbiAgICB9KTtcclxufTtcblxuLyoqXHJcbiAqIFRoZSBjbGFzcyByZXNwb25zaWJsZSBmb3IgbWFuYWdpbmcgYW5kIHByb2Nlc3NpbmcgdGhlIG5hdmlnYXRpb24gcGlwZWxpbmUuXHJcbiAqL1xyXG5jbGFzcyBQaXBlbGluZSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBUaGUgcGlwZWxpbmUgc3RlcHMuIEFuZCBzdGVwcyBhZGRlZCB2aWEgYWRkU3RlcCB3aWxsIGJlIGNvbnZlcnRlZCB0byBhIGZ1bmN0aW9uXHJcbiAgICAgICAgICogVGhlIGFjdHVhbHkgcnVubmluZyBmdW5jdGlvbnMgd2l0aCBjb3JyZWN0IHN0ZXAgY29udGV4dHMgb2YgdGhpcyBwaXBlbGluZVxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuc3RlcHMgPSBbXTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQWRkcyBhIHN0ZXAgdG8gdGhlIHBpcGVsaW5lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBzdGVwIFRoZSBwaXBlbGluZSBzdGVwLlxyXG4gICAgICovXHJcbiAgICBhZGRTdGVwKHN0ZXApIHtcclxuICAgICAgICBsZXQgcnVuO1xyXG4gICAgICAgIGlmICh0eXBlb2Ygc3RlcCA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICBydW4gPSBzdGVwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh0eXBlb2Ygc3RlcC5nZXRTdGVwcyA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgICAgICAvLyBnZXRTdGVwcyBpcyB0byBlbmFibGUgc3VwcG9ydCBvcGVuIHNsb3RzXHJcbiAgICAgICAgICAgIC8vIHdoZXJlIGRldnMgY2FuIGFkZCBtdWx0aXBsZSBzdGVwcyBpbnRvIHRoZSBzYW1lIHNsb3QgbmFtZVxyXG4gICAgICAgICAgICBsZXQgc3RlcHMgPSBzdGVwLmdldFN0ZXBzKCk7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gc3RlcHMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmFkZFN0ZXAoc3RlcHNbaV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgcnVuID0gc3RlcC5ydW4uYmluZChzdGVwKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zdGVwcy5wdXNoKHJ1bik7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJ1bnMgdGhlIHBpcGVsaW5lLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBpbnN0cnVjdGlvbiBUaGUgbmF2aWdhdGlvbiBpbnN0cnVjdGlvbiB0byBwcm9jZXNzLlxyXG4gICAgICovXHJcbiAgICBydW4oaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICBjb25zdCBuZXh0Rm4gPSBjcmVhdGVOZXh0Rm4oaW5zdHJ1Y3Rpb24sIHRoaXMuc3RlcHMpO1xyXG4gICAgICAgIHJldHVybiBuZXh0Rm4oKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuKiBEZXRlcm1pbmVzIGlmIHRoZSBwcm92aWRlZCBvYmplY3QgaXMgYSBuYXZpZ2F0aW9uIGNvbW1hbmQuXHJcbiogQSBuYXZpZ2F0aW9uIGNvbW1hbmQgaXMgYW55dGhpbmcgd2l0aCBhIG5hdmlnYXRlIG1ldGhvZC5cclxuKlxyXG4qIEBwYXJhbSBvYmogVGhlIG9iamVjdCB0byBjaGVjay5cclxuKi9cclxuZnVuY3Rpb24gaXNOYXZpZ2F0aW9uQ29tbWFuZChvYmopIHtcclxuICAgIHJldHVybiBvYmogJiYgdHlwZW9mIG9iai5uYXZpZ2F0ZSA9PT0gJ2Z1bmN0aW9uJztcclxufVxyXG4vKipcclxuKiBVc2VkIGR1cmluZyB0aGUgYWN0aXZhdGlvbiBsaWZlY3ljbGUgdG8gY2F1c2UgYSByZWRpcmVjdC5cclxuKi9cclxuY2xhc3MgUmVkaXJlY3Qge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gdXJsIFRoZSBVUkwgZnJhZ21lbnQgdG8gdXNlIGFzIHRoZSBuYXZpZ2F0aW9uIGRlc3RpbmF0aW9uLlxyXG4gICAgICogQHBhcmFtIG9wdGlvbnMgVGhlIG5hdmlnYXRpb24gb3B0aW9ucy5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IodXJsLCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLnVybCA9IHVybDtcclxuICAgICAgICB0aGlzLm9wdGlvbnMgPSBPYmplY3QuYXNzaWduKHsgdHJpZ2dlcjogdHJ1ZSwgcmVwbGFjZTogdHJ1ZSB9LCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLnNob3VsZENvbnRpbnVlUHJvY2Vzc2luZyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgYnkgdGhlIGFjdGl2YXRpb24gc3lzdGVtIHRvIHNldCB0aGUgY2hpbGQgcm91dGVyLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSByb3V0ZXIgVGhlIHJvdXRlci5cclxuICAgICAqL1xyXG4gICAgc2V0Um91dGVyKHJvdXRlcikge1xyXG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDYWxsZWQgYnkgdGhlIG5hdmlnYXRpb24gcGlwZWxpbmUgdG8gbmF2aWdhdGUuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIGFwcFJvdXRlciBUaGUgcm91dGVyIHRvIGJlIHJlZGlyZWN0ZWQuXHJcbiAgICAgKi9cclxuICAgIG5hdmlnYXRlKGFwcFJvdXRlcikge1xyXG4gICAgICAgIGxldCBuYXZpZ2F0aW5nUm91dGVyID0gdGhpcy5vcHRpb25zLnVzZUFwcFJvdXRlciA/IGFwcFJvdXRlciA6ICh0aGlzLnJvdXRlciB8fCBhcHBSb3V0ZXIpO1xyXG4gICAgICAgIG5hdmlnYXRpbmdSb3V0ZXIubmF2aWdhdGUodGhpcy51cmwsIHRoaXMub3B0aW9ucyk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIFVzZWQgZHVyaW5nIHRoZSBhY3RpdmF0aW9uIGxpZmVjeWNsZSB0byBjYXVzZSBhIHJlZGlyZWN0IHRvIGEgbmFtZWQgcm91dGUuXHJcbiAqL1xyXG5jbGFzcyBSZWRpcmVjdFRvUm91dGUge1xyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gcm91dGUgVGhlIG5hbWUgb2YgdGhlIHJvdXRlLlxyXG4gICAgICogQHBhcmFtIHBhcmFtcyBUaGUgcGFyYW1ldGVycyB0byBiZSBzZW50IHRvIHRoZSBhY3RpdmF0aW9uIG1ldGhvZC5cclxuICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIHRvIHVzZSBmb3IgbmF2aWdhdGlvbi5cclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3Iocm91dGUsIHBhcmFtcyA9IHt9LCBvcHRpb25zID0ge30pIHtcclxuICAgICAgICB0aGlzLnJvdXRlID0gcm91dGU7XHJcbiAgICAgICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IHRyaWdnZXI6IHRydWUsIHJlcGxhY2U6IHRydWUgfSwgb3B0aW9ucyk7XHJcbiAgICAgICAgdGhpcy5zaG91bGRDb250aW51ZVByb2Nlc3NpbmcgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIGJ5IHRoZSBhY3RpdmF0aW9uIHN5c3RlbSB0byBzZXQgdGhlIGNoaWxkIHJvdXRlci5cclxuICAgICAqXHJcbiAgICAgKiBAcGFyYW0gcm91dGVyIFRoZSByb3V0ZXIuXHJcbiAgICAgKi9cclxuICAgIHNldFJvdXRlcihyb3V0ZXIpIHtcclxuICAgICAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogQ2FsbGVkIGJ5IHRoZSBuYXZpZ2F0aW9uIHBpcGVsaW5lIHRvIG5hdmlnYXRlLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSBhcHBSb3V0ZXIgVGhlIHJvdXRlciB0byBiZSByZWRpcmVjdGVkLlxyXG4gICAgICovXHJcbiAgICBuYXZpZ2F0ZShhcHBSb3V0ZXIpIHtcclxuICAgICAgICBsZXQgbmF2aWdhdGluZ1JvdXRlciA9IHRoaXMub3B0aW9ucy51c2VBcHBSb3V0ZXIgPyBhcHBSb3V0ZXIgOiAodGhpcy5yb3V0ZXIgfHwgYXBwUm91dGVyKTtcclxuICAgICAgICBuYXZpZ2F0aW5nUm91dGVyLm5hdmlnYXRlVG9Sb3V0ZSh0aGlzLnJvdXRlLCB0aGlzLnBhcmFtcywgdGhpcy5vcHRpb25zKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmZ1bmN0aW9uIF9idWlsZE5hdmlnYXRpb25QbGFuKGluc3RydWN0aW9uLCBmb3JjZUxpZmVjeWNsZU1pbmltdW0pIHtcclxuICAgIGxldCBjb25maWcgPSBpbnN0cnVjdGlvbi5jb25maWc7XHJcbiAgICBpZiAoJ3JlZGlyZWN0JyBpbiBjb25maWcpIHtcclxuICAgICAgICByZXR1cm4gYnVpbGRSZWRpcmVjdFBsYW4oaW5zdHJ1Y3Rpb24pO1xyXG4gICAgfVxyXG4gICAgY29uc3QgcHJldkluc3RydWN0aW9uID0gaW5zdHJ1Y3Rpb24ucHJldmlvdXNJbnN0cnVjdGlvbjtcclxuICAgIGNvbnN0IGRlZmF1bHRWaWV3UG9ydENvbmZpZ3MgPSBpbnN0cnVjdGlvbi5yb3V0ZXIudmlld1BvcnREZWZhdWx0cztcclxuICAgIGlmIChwcmV2SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gYnVpbGRUcmFuc2l0aW9uUGxhbnMoaW5zdHJ1Y3Rpb24sIHByZXZJbnN0cnVjdGlvbiwgZGVmYXVsdFZpZXdQb3J0Q29uZmlncywgZm9yY2VMaWZlY3ljbGVNaW5pbXVtKTtcclxuICAgIH1cclxuICAgIC8vIGZpcnN0IG5hdmlnYXRpb24sIG9ubHkgbmVlZCB0byBwcmVwYXJlIGEgZmV3IGluZm9ybWF0aW9uIGZvciBlYWNoIHZpZXdwb3J0IHBsYW5cclxuICAgIGNvbnN0IHZpZXdQb3J0UGxhbnMgPSB7fTtcclxuICAgIGxldCB2aWV3UG9ydENvbmZpZ3MgPSBjb25maWcudmlld1BvcnRzO1xyXG4gICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHZpZXdQb3J0Q29uZmlncykge1xyXG4gICAgICAgIGxldCB2aWV3UG9ydENvbmZpZyA9IHZpZXdQb3J0Q29uZmlnc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIGlmICh2aWV3UG9ydENvbmZpZy5tb2R1bGVJZCA9PT0gbnVsbCAmJiB2aWV3UG9ydE5hbWUgaW4gZGVmYXVsdFZpZXdQb3J0Q29uZmlncykge1xyXG4gICAgICAgICAgICB2aWV3UG9ydENvbmZpZyA9IGRlZmF1bHRWaWV3UG9ydENvbmZpZ3Nbdmlld1BvcnROYW1lXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmlld1BvcnRQbGFuc1t2aWV3UG9ydE5hbWVdID0ge1xyXG4gICAgICAgICAgICBuYW1lOiB2aWV3UG9ydE5hbWUsXHJcbiAgICAgICAgICAgIHN0cmF0ZWd5OiBcInJlcGxhY2VcIiAvKiBSZXBsYWNlICovLFxyXG4gICAgICAgICAgICBjb25maWc6IHZpZXdQb3J0Q29uZmlnXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodmlld1BvcnRQbGFucyk7XHJcbn1cclxuLyoqXHJcbiAqIEJ1aWxkIHJlZGlyZWN0IHBsYW4gYmFzZWQgb24gY29uZmlnIG9mIGEgbmF2aWdhdGlvbiBpbnN0cnVjdGlvblxyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgYnVpbGRSZWRpcmVjdFBsYW4gPSAoaW5zdHJ1Y3Rpb24pID0+IHtcclxuICAgIGNvbnN0IGNvbmZpZyA9IGluc3RydWN0aW9uLmNvbmZpZztcclxuICAgIGNvbnN0IHJvdXRlciA9IGluc3RydWN0aW9uLnJvdXRlcjtcclxuICAgIHJldHVybiByb3V0ZXJcclxuICAgICAgICAuX2NyZWF0ZU5hdmlnYXRpb25JbnN0cnVjdGlvbihjb25maWcucmVkaXJlY3QpXHJcbiAgICAgICAgLnRoZW4ocmVkaXJlY3RJbnN0cnVjdGlvbiA9PiB7XHJcbiAgICAgICAgY29uc3QgcGFyYW1zID0ge307XHJcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxJbnN0cnVjdGlvblBhcmFtcyA9IGluc3RydWN0aW9uLnBhcmFtcztcclxuICAgICAgICBjb25zdCByZWRpcmVjdEluc3RydWN0aW9uUGFyYW1zID0gcmVkaXJlY3RJbnN0cnVjdGlvbi5wYXJhbXM7XHJcbiAgICAgICAgZm9yIChsZXQga2V5IGluIHJlZGlyZWN0SW5zdHJ1Y3Rpb25QYXJhbXMpIHtcclxuICAgICAgICAgICAgLy8gSWYgdGhlIHBhcmFtIG9uIHRoZSByZWRpcmVjdCBwb2ludHMgdG8gYW5vdGhlciBwYXJhbSwgZS5nLiB7IHJvdXRlOiBmaXJzdC86dGhpcywgcmVkaXJlY3Q6IHNlY29uZC86dGhpcyB9XHJcbiAgICAgICAgICAgIGxldCB2YWwgPSByZWRpcmVjdEluc3RydWN0aW9uUGFyYW1zW2tleV07XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsID09PSAnc3RyaW5nJyAmJiB2YWxbMF0gPT09ICc6Jykge1xyXG4gICAgICAgICAgICAgICAgdmFsID0gdmFsLnNsaWNlKDEpO1xyXG4gICAgICAgICAgICAgICAgLy8gQW5kIGlmIHRoYXQgcGFyYW0gaXMgZm91bmQgb24gdGhlIG9yaWdpbmFsIGluc3RydWN0aW9uIHRoZW4gdXNlIGl0XHJcbiAgICAgICAgICAgICAgICBpZiAodmFsIGluIG9yaWdpbmFsSW5zdHJ1Y3Rpb25QYXJhbXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBwYXJhbXNba2V5XSA9IG9yaWdpbmFsSW5zdHJ1Y3Rpb25QYXJhbXNbdmFsXTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHBhcmFtc1trZXldID0gcmVkaXJlY3RJbnN0cnVjdGlvblBhcmFtc1trZXldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCByZWRpcmVjdExvY2F0aW9uID0gcm91dGVyLmdlbmVyYXRlKHJlZGlyZWN0SW5zdHJ1Y3Rpb24uY29uZmlnLCBwYXJhbXMsIGluc3RydWN0aW9uLm9wdGlvbnMpO1xyXG4gICAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIGNoaWxkIHJvdXRlc1xyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiBvcmlnaW5hbEluc3RydWN0aW9uUGFyYW1zKSB7XHJcbiAgICAgICAgICAgIHJlZGlyZWN0TG9jYXRpb24gPSByZWRpcmVjdExvY2F0aW9uLnJlcGxhY2UoYDoke2tleX1gLCBvcmlnaW5hbEluc3RydWN0aW9uUGFyYW1zW2tleV0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgcXVlcnlTdHJpbmcgPSBpbnN0cnVjdGlvbi5xdWVyeVN0cmluZztcclxuICAgICAgICBpZiAocXVlcnlTdHJpbmcpIHtcclxuICAgICAgICAgICAgcmVkaXJlY3RMb2NhdGlvbiArPSAnPycgKyBxdWVyeVN0cmluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgUmVkaXJlY3QocmVkaXJlY3RMb2NhdGlvbikpO1xyXG4gICAgfSk7XHJcbn07XHJcbi8qKlxyXG4gKiBAcGFyYW0gdmlld1BvcnRQbGFucyB0aGUgUGxhbiByZWNvcmQgdGhhdCBob2xkcyBpbmZvcm1hdGlvbiBhYm91dCBidWlsdCBwbGFuc1xyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgYnVpbGRUcmFuc2l0aW9uUGxhbnMgPSAoY3VycmVudEluc3RydWN0aW9uLCBwcmV2aW91c0luc3RydWN0aW9uLCBkZWZhdWx0Vmlld1BvcnRDb25maWdzLCBmb3JjZUxpZmVjeWNsZU1pbmltdW0pID0+IHtcclxuICAgIGxldCB2aWV3UG9ydFBsYW5zID0ge307XHJcbiAgICBsZXQgbmV3SW5zdHJ1Y3Rpb25Db25maWcgPSBjdXJyZW50SW5zdHJ1Y3Rpb24uY29uZmlnO1xyXG4gICAgbGV0IGhhc05ld1BhcmFtcyA9IGhhc0RpZmZlcmVudFBhcmFtZXRlclZhbHVlcyhwcmV2aW91c0luc3RydWN0aW9uLCBjdXJyZW50SW5zdHJ1Y3Rpb24pO1xyXG4gICAgbGV0IHBlbmRpbmcgPSBbXTtcclxuICAgIGxldCBwcmV2aW91c1ZpZXdQb3J0SW5zdHJ1Y3Rpb25zID0gcHJldmlvdXNJbnN0cnVjdGlvbi52aWV3UG9ydEluc3RydWN0aW9ucztcclxuICAgIGZvciAobGV0IHZpZXdQb3J0TmFtZSBpbiBwcmV2aW91c1ZpZXdQb3J0SW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgY29uc3QgcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24gPSBwcmV2aW91c1ZpZXdQb3J0SW5zdHJ1Y3Rpb25zW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgY29uc3QgcHJldlZpZXdQb3J0Q29tcG9uZW50ID0gcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24uY29tcG9uZW50O1xyXG4gICAgICAgIGNvbnN0IG5ld0luc3RydWN0aW9uVmlld1BvcnRDb25maWdzID0gbmV3SW5zdHJ1Y3Rpb25Db25maWcudmlld1BvcnRzO1xyXG4gICAgICAgIC8vIGlmIHRoaXMgaXMgaW52b2tlZCBvbiBhIHZpZXdwb3J0IHdpdGhvdXQgYW55IGNoYW5nZXMsIGJhc2VkIG9uIG5ldyB1cmwsXHJcbiAgICAgICAgLy8gbmV3Vmlld1BvcnRDb25maWcgd2lsbCBiZSB0aGUgZXhpc3Rpbmcgdmlld3BvcnQgaW5zdHJ1Y3Rpb25cclxuICAgICAgICBsZXQgbmV4dFZpZXdQb3J0Q29uZmlnID0gdmlld1BvcnROYW1lIGluIG5ld0luc3RydWN0aW9uVmlld1BvcnRDb25maWdzXHJcbiAgICAgICAgICAgID8gbmV3SW5zdHJ1Y3Rpb25WaWV3UG9ydENvbmZpZ3Nbdmlld1BvcnROYW1lXVxyXG4gICAgICAgICAgICA6IHByZXZWaWV3UG9ydEluc3RydWN0aW9uO1xyXG4gICAgICAgIGlmIChuZXh0Vmlld1BvcnRDb25maWcubW9kdWxlSWQgPT09IG51bGwgJiYgdmlld1BvcnROYW1lIGluIGRlZmF1bHRWaWV3UG9ydENvbmZpZ3MpIHtcclxuICAgICAgICAgICAgbmV4dFZpZXdQb3J0Q29uZmlnID0gZGVmYXVsdFZpZXdQb3J0Q29uZmlnc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB2aWV3UG9ydEFjdGl2YXRpb25TdHJhdGVneSA9IGRldGVybWluZUFjdGl2YXRpb25TdHJhdGVneShjdXJyZW50SW5zdHJ1Y3Rpb24sIHByZXZWaWV3UG9ydEluc3RydWN0aW9uLCBuZXh0Vmlld1BvcnRDb25maWcsIGhhc05ld1BhcmFtcywgZm9yY2VMaWZlY3ljbGVNaW5pbXVtKTtcclxuICAgICAgICBjb25zdCB2aWV3UG9ydFBsYW4gPSB2aWV3UG9ydFBsYW5zW3ZpZXdQb3J0TmFtZV0gPSB7XHJcbiAgICAgICAgICAgIG5hbWU6IHZpZXdQb3J0TmFtZSxcclxuICAgICAgICAgICAgLy8gVmlld1BvcnRJbnN0cnVjdGlvbiBjYW4gcXVhY2sgbGlrZSBhIFJvdXRlQ29uZmlnXHJcbiAgICAgICAgICAgIGNvbmZpZzogbmV4dFZpZXdQb3J0Q29uZmlnLFxyXG4gICAgICAgICAgICBwcmV2Q29tcG9uZW50OiBwcmV2Vmlld1BvcnRDb21wb25lbnQsXHJcbiAgICAgICAgICAgIHByZXZNb2R1bGVJZDogcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24ubW9kdWxlSWQsXHJcbiAgICAgICAgICAgIHN0cmF0ZWd5OiB2aWV3UG9ydEFjdGl2YXRpb25TdHJhdGVneVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gcmVjdXJzaXZlbHkgYnVpbGQgbmF2IHBsYW5zIGZvciBhbGwgZXhpc3RpbmcgY2hpbGQgcm91dGVycy92aWV3cG9ydHMgb2YgdGhpcyB2aWV3cG9ydFxyXG4gICAgICAgIC8vIHRoaXMgaXMgcG9zc2libGUgYmVjYXVzZSBleGlzdGluZyBjaGlsZCB2aWV3cG9ydHMgYW5kIHJvdXRlcnMgYWxyZWFkeSBoYXZlIG5lY2Vzc2FyeSBpbmZvcm1hdGlvblxyXG4gICAgICAgIC8vIHRvIHByb2Nlc3MgdGhlIHdpbGRjYXJkIHBhdGggZnJvbSBwYXJlbnQgaW5zdHJ1Y3Rpb25cclxuICAgICAgICBpZiAodmlld1BvcnRBY3RpdmF0aW9uU3RyYXRlZ3kgIT09IFwicmVwbGFjZVwiIC8qIFJlcGxhY2UgKi8gJiYgcHJldlZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGRSb3V0ZXIpIHtcclxuICAgICAgICAgICAgY29uc3QgcGF0aCA9IGN1cnJlbnRJbnN0cnVjdGlvbi5nZXRXaWxkY2FyZFBhdGgoKTtcclxuICAgICAgICAgICAgY29uc3QgdGFzayA9IHByZXZWaWV3UG9ydEluc3RydWN0aW9uXHJcbiAgICAgICAgICAgICAgICAuY2hpbGRSb3V0ZXJcclxuICAgICAgICAgICAgICAgIC5fY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKHBhdGgsIGN1cnJlbnRJbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgICAgIC50aGVuKChjaGlsZEluc3RydWN0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBjaGlsZEluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9idWlsZE5hdmlnYXRpb25QbGFuKGNoaWxkSW5zdHJ1Y3Rpb24sIFxyXG4gICAgICAgICAgICAgICAgLy8gaXMgaXQgc2FmZSB0byBhc3N1bWUgdmlld1BvcnRQbGFuIGhhcyBub3QgYmVlbiBjaGFuZ2VkIGZyb20gcHJldmlvdXMgYXNzaWdubWVudD9cclxuICAgICAgICAgICAgICAgIC8vIGlmIHNvLCBjYW4ganVzdCB1c2UgbG9jYWwgdmFyaWFibGUgdmlld1BvcnRQbGFuU3RyYXRlZ3lcclxuICAgICAgICAgICAgICAgIC8vIHRoZXJlIGNvdWxkIGJlIHVzZXIgY29kZSBtb2RpZnlpbmcgdmlld3BvcnQgcGxhbiBkdXJpbmcgX2NyZWF0ZU5hdmlnYXRpb25JbnN0cnVjdGlvbj9cclxuICAgICAgICAgICAgICAgIHZpZXdQb3J0UGxhbi5zdHJhdGVneSA9PT0gXCJpbnZva2UtbGlmZWN5Y2xlXCIgLyogSW52b2tlTGlmZWN5Y2xlICovKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGNoaWxkUGxhbiA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNoaWxkUGxhbiBpbnN0YW5jZW9mIFJlZGlyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChjaGlsZFBsYW4pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjaGlsZEluc3RydWN0aW9uLnBsYW4gPSBjaGlsZFBsYW47XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIGJsdWViaXJkID9cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcGVuZGluZy5wdXNoKHRhc2spO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBQcm9taXNlLmFsbChwZW5kaW5nKS50aGVuKCgpID0+IHZpZXdQb3J0UGxhbnMpO1xyXG59O1xyXG4vKipcclxuICogQHBhcmFtIG5ld1ZpZXdQb3J0Q29uZmlnIGlmIHRoaXMgaXMgaW52b2tlZCBvbiBhIHZpZXdwb3J0IHdpdGhvdXQgYW55IGNoYW5nZXMsIGJhc2VkIG9uIG5ldyB1cmwsIG5ld1ZpZXdQb3J0Q29uZmlnIHdpbGwgYmUgdGhlIGV4aXN0aW5nIHZpZXdwb3J0IGluc3RydWN0aW9uXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBkZXRlcm1pbmVBY3RpdmF0aW9uU3RyYXRlZ3kgPSAoY3VycmVudE5hdkluc3RydWN0aW9uLCBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbiwgbmV3Vmlld1BvcnRDb25maWcsIFxyXG4vLyBpbmRpY2F0ZXMgd2hldGhlciB0aGVyZSBpcyBkaWZmZXJlbmNlIGJldHdlZW4gb2xkIGFuZCBuZXcgdXJsIHBhcmFtc1xyXG5oYXNOZXdQYXJhbXMsIGZvcmNlTGlmZWN5Y2xlTWluaW11bSkgPT4ge1xyXG4gICAgbGV0IG5ld0luc3RydWN0aW9uQ29uZmlnID0gY3VycmVudE5hdkluc3RydWN0aW9uLmNvbmZpZztcclxuICAgIGxldCBwcmV2Vmlld1BvcnRWaWV3TW9kZWwgPSBwcmV2Vmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQudmlld01vZGVsO1xyXG4gICAgbGV0IHZpZXdQb3J0UGxhblN0cmF0ZWd5O1xyXG4gICAgaWYgKHByZXZWaWV3UG9ydEluc3RydWN0aW9uLm1vZHVsZUlkICE9PSBuZXdWaWV3UG9ydENvbmZpZy5tb2R1bGVJZCkge1xyXG4gICAgICAgIHZpZXdQb3J0UGxhblN0cmF0ZWd5ID0gXCJyZXBsYWNlXCIgLyogUmVwbGFjZSAqLztcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKCdkZXRlcm1pbmVBY3RpdmF0aW9uU3RyYXRlZ3knIGluIHByZXZWaWV3UG9ydFZpZXdNb2RlbCkge1xyXG4gICAgICAgIHZpZXdQb3J0UGxhblN0cmF0ZWd5ID0gcHJldlZpZXdQb3J0Vmlld01vZGVsLmRldGVybWluZUFjdGl2YXRpb25TdHJhdGVneSguLi5jdXJyZW50TmF2SW5zdHJ1Y3Rpb24ubGlmZWN5Y2xlQXJncyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChuZXdJbnN0cnVjdGlvbkNvbmZpZy5hY3RpdmF0aW9uU3RyYXRlZ3kpIHtcclxuICAgICAgICB2aWV3UG9ydFBsYW5TdHJhdGVneSA9IG5ld0luc3RydWN0aW9uQ29uZmlnLmFjdGl2YXRpb25TdHJhdGVneTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGhhc05ld1BhcmFtcyB8fCBmb3JjZUxpZmVjeWNsZU1pbmltdW0pIHtcclxuICAgICAgICB2aWV3UG9ydFBsYW5TdHJhdGVneSA9IFwiaW52b2tlLWxpZmVjeWNsZVwiIC8qIEludm9rZUxpZmVjeWNsZSAqLztcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHZpZXdQb3J0UGxhblN0cmF0ZWd5ID0gXCJuby1jaGFuZ2VcIiAvKiBOb0NoYW5nZSAqLztcclxuICAgIH1cclxuICAgIHJldHVybiB2aWV3UG9ydFBsYW5TdHJhdGVneTtcclxufTtcclxuLyoqQGludGVybmFsIGV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmcgKi9cclxuY29uc3QgaGFzRGlmZmVyZW50UGFyYW1ldGVyVmFsdWVzID0gKHByZXYsIG5leHQpID0+IHtcclxuICAgIGxldCBwcmV2UGFyYW1zID0gcHJldi5wYXJhbXM7XHJcbiAgICBsZXQgbmV4dFBhcmFtcyA9IG5leHQucGFyYW1zO1xyXG4gICAgbGV0IG5leHRXaWxkQ2FyZE5hbWUgPSBuZXh0LmNvbmZpZy5oYXNDaGlsZFJvdXRlciA/IG5leHQuZ2V0V2lsZENhcmROYW1lKCkgOiBudWxsO1xyXG4gICAgZm9yIChsZXQga2V5IGluIG5leHRQYXJhbXMpIHtcclxuICAgICAgICBpZiAoa2V5ID09PSBuZXh0V2lsZENhcmROYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJldlBhcmFtc1trZXldICE9PSBuZXh0UGFyYW1zW2tleV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZm9yIChsZXQga2V5IGluIHByZXZQYXJhbXMpIHtcclxuICAgICAgICBpZiAoa2V5ID09PSBuZXh0V2lsZENhcmROYW1lKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocHJldlBhcmFtc1trZXldICE9PSBuZXh0UGFyYW1zW2tleV0pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgaWYgKCFuZXh0Lm9wdGlvbnMuY29tcGFyZVF1ZXJ5UGFyYW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gICAgbGV0IHByZXZRdWVyeVBhcmFtcyA9IHByZXYucXVlcnlQYXJhbXM7XHJcbiAgICBsZXQgbmV4dFF1ZXJ5UGFyYW1zID0gbmV4dC5xdWVyeVBhcmFtcztcclxuICAgIGZvciAobGV0IGtleSBpbiBuZXh0UXVlcnlQYXJhbXMpIHtcclxuICAgICAgICBpZiAocHJldlF1ZXJ5UGFyYW1zW2tleV0gIT09IG5leHRRdWVyeVBhcmFtc1trZXldKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGZvciAobGV0IGtleSBpbiBwcmV2UXVlcnlQYXJhbXMpIHtcclxuICAgICAgICBpZiAocHJldlF1ZXJ5UGFyYW1zW2tleV0gIT09IG5leHRRdWVyeVBhcmFtc1trZXldKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufTtcblxuLyoqXHJcbiAqIFRyYW5zZm9ybSBhIG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb24gaW50byB2aWV3cG9ydCBwbGFuIHJlY29yZCBvYmplY3QsXHJcbiAqIG9yIGEgcmVkaXJlY3QgcmVxdWVzdCBpZiB1c2VyIHZpZXdtb2RlbCBkZW1hbmRzXHJcbiAqL1xyXG5jbGFzcyBCdWlsZE5hdmlnYXRpb25QbGFuU3RlcCB7XHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIF9idWlsZE5hdmlnYXRpb25QbGFuKG5hdmlnYXRpb25JbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgLnRoZW4ocGxhbiA9PiB7XHJcbiAgICAgICAgICAgIGlmIChwbGFuIGluc3RhbmNlb2YgUmVkaXJlY3QpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChwbGFuKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbiA9IHBsYW47XHJcbiAgICAgICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKG5leHQuY2FuY2VsKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQGludGVybmFsIEV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGxvYWROZXdSb3V0ZSA9IChyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uKSA9PiB7XHJcbiAgICBsZXQgbG9hZGluZ1BsYW5zID0gZGV0ZXJtaW5lTG9hZGluZ1BsYW5zKG5hdmlnYXRpb25JbnN0cnVjdGlvbik7XHJcbiAgICBsZXQgbG9hZFByb21pc2VzID0gbG9hZGluZ1BsYW5zLm1hcCgobG9hZGluZ1BsYW4pID0+IGxvYWRSb3V0ZShyb3V0ZUxvYWRlciwgbG9hZGluZ1BsYW4ubmF2aWdhdGlvbkluc3RydWN0aW9uLCBsb2FkaW5nUGxhbi52aWV3UG9ydFBsYW4pKTtcclxuICAgIHJldHVybiBQcm9taXNlLmFsbChsb2FkUHJvbWlzZXMpO1xyXG59O1xyXG4vKipcclxuICogQGludGVybmFsIEV4cG9ydGVkIGZvciB1bml0IHRlc3RpbmdcclxuICovXHJcbmNvbnN0IGRldGVybWluZUxvYWRpbmdQbGFucyA9IChuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGxvYWRpbmdQbGFucyA9IFtdKSA9PiB7XHJcbiAgICBsZXQgdmlld1BvcnRQbGFucyA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuO1xyXG4gICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHZpZXdQb3J0UGxhbnMpIHtcclxuICAgICAgICBsZXQgdmlld1BvcnRQbGFuID0gdmlld1BvcnRQbGFuc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIGxldCBjaGlsZE5hdkluc3RydWN0aW9uID0gdmlld1BvcnRQbGFuLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uO1xyXG4gICAgICAgIGlmICh2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IFwicmVwbGFjZVwiIC8qIFJlcGxhY2UgKi8pIHtcclxuICAgICAgICAgICAgbG9hZGluZ1BsYW5zLnB1c2goeyB2aWV3UG9ydFBsYW4sIG5hdmlnYXRpb25JbnN0cnVjdGlvbiB9KTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkTmF2SW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIGRldGVybWluZUxvYWRpbmdQbGFucyhjaGlsZE5hdkluc3RydWN0aW9uLCBsb2FkaW5nUGxhbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5hZGRWaWV3UG9ydEluc3RydWN0aW9uKHtcclxuICAgICAgICAgICAgICAgIG5hbWU6IHZpZXdQb3J0TmFtZSxcclxuICAgICAgICAgICAgICAgIHN0cmF0ZWd5OiB2aWV3UG9ydFBsYW4uc3RyYXRlZ3ksXHJcbiAgICAgICAgICAgICAgICBtb2R1bGVJZDogdmlld1BvcnRQbGFuLnByZXZNb2R1bGVJZCxcclxuICAgICAgICAgICAgICAgIGNvbXBvbmVudDogdmlld1BvcnRQbGFuLnByZXZDb21wb25lbnRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZE5hdkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3UG9ydEluc3RydWN0aW9uLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uID0gY2hpbGROYXZJbnN0cnVjdGlvbjtcclxuICAgICAgICAgICAgICAgIGRldGVybWluZUxvYWRpbmdQbGFucyhjaGlsZE5hdkluc3RydWN0aW9uLCBsb2FkaW5nUGxhbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxvYWRpbmdQbGFucztcclxufTtcclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBFeHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBsb2FkUm91dGUgPSAocm91dGVMb2FkZXIsIG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgdmlld1BvcnRQbGFuKSA9PiB7XHJcbiAgICBsZXQgcGxhbkNvbmZpZyA9IHZpZXdQb3J0UGxhbi5jb25maWc7XHJcbiAgICBsZXQgbW9kdWxlSWQgPSBwbGFuQ29uZmlnID8gcGxhbkNvbmZpZy5tb2R1bGVJZCA6IG51bGw7XHJcbiAgICByZXR1cm4gbG9hZENvbXBvbmVudChyb3V0ZUxvYWRlciwgbmF2aWdhdGlvbkluc3RydWN0aW9uLCBwbGFuQ29uZmlnKVxyXG4gICAgICAgIC50aGVuKChjb21wb25lbnQpID0+IHtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5hZGRWaWV3UG9ydEluc3RydWN0aW9uKHtcclxuICAgICAgICAgICAgbmFtZTogdmlld1BvcnRQbGFuLm5hbWUsXHJcbiAgICAgICAgICAgIHN0cmF0ZWd5OiB2aWV3UG9ydFBsYW4uc3RyYXRlZ3ksXHJcbiAgICAgICAgICAgIG1vZHVsZUlkOiBtb2R1bGVJZCxcclxuICAgICAgICAgICAgY29tcG9uZW50OiBjb21wb25lbnRcclxuICAgICAgICB9KTtcclxuICAgICAgICBsZXQgY2hpbGRSb3V0ZXIgPSBjb21wb25lbnQuY2hpbGRSb3V0ZXI7XHJcbiAgICAgICAgaWYgKGNoaWxkUm91dGVyKSB7XHJcbiAgICAgICAgICAgIGxldCBwYXRoID0gbmF2aWdhdGlvbkluc3RydWN0aW9uLmdldFdpbGRjYXJkUGF0aCgpO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRSb3V0ZXJcclxuICAgICAgICAgICAgICAgIC5fY3JlYXRlTmF2aWdhdGlvbkluc3RydWN0aW9uKHBhdGgsIG5hdmlnYXRpb25JbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgICAgIC50aGVuKChjaGlsZEluc3RydWN0aW9uKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBjaGlsZEluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9idWlsZE5hdmlnYXRpb25QbGFuKGNoaWxkSW5zdHJ1Y3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oKGNoaWxkUGxhbikgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZFBsYW4gaW5zdGFuY2VvZiBSZWRpcmVjdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoY2hpbGRQbGFuKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGRJbnN0cnVjdGlvbi5wbGFuID0gY2hpbGRQbGFuO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24gPSBjaGlsZEluc3RydWN0aW9uO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBsb2FkTmV3Um91dGUocm91dGVMb2FkZXIsIGNoaWxkSW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB0cyBjb21wbGFpbnMgd2l0aG91dCB0aGlzLCB0aG91Z2ggdGhleSBhcmUgc2FtZVxyXG4gICAgICAgIHJldHVybiB2b2lkIDA7XHJcbiAgICB9KTtcclxufTtcclxuLyoqXHJcbiAqIExvYWQgYSByb3V0ZWQtY29tcG9uZW50IGJhc2VkIG9uIG5hdmlnYXRpb24gaW5zdHJ1Y3Rpb24gYW5kIHJvdXRlIGNvbmZpZ1xyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZyBvbmx5XHJcbiAqL1xyXG5jb25zdCBsb2FkQ29tcG9uZW50ID0gKHJvdXRlTG9hZGVyLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIGNvbmZpZykgPT4ge1xyXG4gICAgbGV0IHJvdXRlciA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5yb3V0ZXI7XHJcbiAgICBsZXQgbGlmZWN5Y2xlQXJncyA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5saWZlY3ljbGVBcmdzO1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpXHJcbiAgICAgICAgLnRoZW4oKCkgPT4gcm91dGVMb2FkZXIubG9hZFJvdXRlKHJvdXRlciwgY29uZmlnLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pKVxyXG4gICAgICAgIC50aGVuKFxyXG4gICAgLyoqXHJcbiAgICAgKiBAcGFyYW0gY29tcG9uZW50IGFuIG9iamVjdCBjYXJyeWluZyBpbmZvcm1hdGlvbiBhYm91dCBsb2FkZWQgcm91dGVcclxuICAgICAqIHR5cGljYWxseSBjb250YWlucyBpbmZvcm1hdGlvbiBhYm91dCB2aWV3IG1vZGVsLCBjaGlsZENvbnRhaW5lciwgdmlldyBhbmQgcm91dGVyXHJcbiAgICAgKi9cclxuICAgIChjb21wb25lbnQpID0+IHtcclxuICAgICAgICBsZXQgeyB2aWV3TW9kZWwsIGNoaWxkQ29udGFpbmVyIH0gPSBjb21wb25lbnQ7XHJcbiAgICAgICAgY29tcG9uZW50LnJvdXRlciA9IHJvdXRlcjtcclxuICAgICAgICBjb21wb25lbnQuY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIGlmICgnY29uZmlndXJlUm91dGVyJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgbGV0IGNoaWxkUm91dGVyID0gY2hpbGRDb250YWluZXIuZ2V0Q2hpbGRSb3V0ZXIoKTtcclxuICAgICAgICAgICAgY29tcG9uZW50LmNoaWxkUm91dGVyID0gY2hpbGRSb3V0ZXI7XHJcbiAgICAgICAgICAgIHJldHVybiBjaGlsZFJvdXRlclxyXG4gICAgICAgICAgICAgICAgLmNvbmZpZ3VyZShjID0+IHZpZXdNb2RlbC5jb25maWd1cmVSb3V0ZXIoYywgY2hpbGRSb3V0ZXIsIGxpZmVjeWNsZUFyZ3NbMF0sIGxpZmVjeWNsZUFyZ3NbMV0sIGxpZmVjeWNsZUFyZ3NbMl0pKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oKCkgPT4gY29tcG9uZW50KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGNvbXBvbmVudDtcclxuICAgIH0pO1xyXG59O1xuXG4vKipcclxuICogQWJzdHJhY3QgY2xhc3MgdGhhdCBpcyByZXNwb25zaWJsZSBmb3IgbG9hZGluZyB2aWV3IC8gdmlldyBtb2RlbCBmcm9tIGEgcm91dGUgY29uZmlnXHJcbiAqIFRoZSBkZWZhdWx0IGltcGxlbWVudGF0aW9uIGNhbiBiZSBmb3VuZCBpbiBgYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlcmBcclxuICovXHJcbmNsYXNzIFJvdXRlTG9hZGVyIHtcclxuICAgIC8qKlxyXG4gICAgICogTG9hZCBhIHJvdXRlIGNvbmZpZyBiYXNlZCBvbiBpdHMgdmlld21vZGVsIC8gdmlldyBjb25maWd1cmF0aW9uXHJcbiAgICAgKi9cclxuICAgIC8vIHJldHVybiB0eXBpbmc6IHJldHVybiB0eXBpbmdzIHVzZWQgdG8gYmUgbmV2ZXJcclxuICAgIC8vIGFzIGl0IHdhcyBhIHRocm93LiBDaGFuZ2luZyBpdCB0byBQcm9taXNlPGFueT4gc2hvdWxkIG5vdCBjYXVzZSBhbnkgaXNzdWVzXHJcbiAgICBsb2FkUm91dGUocm91dGVyLCBjb25maWcsIG5hdmlnYXRpb25JbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignUm91dGUgbG9hZGVycyBtdXN0IGltcGxlbWVudCBcImxvYWRSb3V0ZShyb3V0ZXIsIGNvbmZpZywgbmF2aWdhdGlvbkluc3RydWN0aW9uKVwiLicpO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBBIHBpcGVsaW5lIHN0ZXAgcmVzcG9uc2libGUgZm9yIGxvYWRpbmcgYSByb3V0ZSBjb25maWcgb2YgYSBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAqL1xyXG5jbGFzcyBMb2FkUm91dGVTdGVwIHtcclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgc3RhdGljIGluamVjdCgpIHsgcmV0dXJuIFtSb3V0ZUxvYWRlcl07IH1cclxuICAgIGNvbnN0cnVjdG9yKHJvdXRlTG9hZGVyKSB7XHJcbiAgICAgICAgdGhpcy5yb3V0ZUxvYWRlciA9IHJvdXRlTG9hZGVyO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSdW4gdGhlIGludGVybmFsIHRvIGxvYWQgcm91dGUgY29uZmlnIG9mIGEgbmF2aWdhdGlvbiBpbnN0cnVjdGlvbiB0byBwcmVwYXJlIGZvciBuZXh0IHN0ZXBzIGluIHRoZSBwaXBlbGluZVxyXG4gICAgICovXHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIGxvYWROZXdSb3V0ZSh0aGlzLnJvdXRlTG9hZGVyLCBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pXHJcbiAgICAgICAgICAgIC50aGVuKG5leHQsIG5leHQuY2FuY2VsKTtcclxuICAgIH1cclxufVxuXG4vKipcclxuICogQSBwaXBlbGluZSBzdGVwIGZvciBpbnN0cnVjdGluZyBhIHBpZXBsaW5lIHRvIGNvbW1pdCBjaGFuZ2VzIG9uIGEgbmF2aWdhdGlvbiBpbnN0cnVjdGlvblxyXG4gKi9cclxuY2xhc3MgQ29tbWl0Q2hhbmdlc1N0ZXAge1xyXG4gICAgcnVuKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb25cclxuICAgICAgICAgICAgLl9jb21taXRDaGFuZ2VzKC8qd2FpdCB0byBzd2FwPyovIHRydWUpXHJcbiAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgbmF2aWdhdGlvbkluc3RydWN0aW9uLl91cGRhdGVUaXRsZSgpO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XG5cbi8qKlxyXG4gKiBBbiBvcHRpb25hbCBpbnRlcmZhY2UgZGVzY3JpYmluZyB0aGUgYXZhaWxhYmxlIGFjdGl2YXRpb24gc3RyYXRlZ2llcy5cclxuICogQGludGVybmFsIFVzZWQgaW50ZXJuYWxseS5cclxuICovXHJcbnZhciBJbnRlcm5hbEFjdGl2YXRpb25TdHJhdGVneTtcclxuKGZ1bmN0aW9uIChJbnRlcm5hbEFjdGl2YXRpb25TdHJhdGVneSkge1xyXG4gICAgLyoqXHJcbiAgICAgKiBSZXVzZSB0aGUgZXhpc3RpbmcgdmlldyBtb2RlbCwgd2l0aG91dCBpbnZva2luZyBSb3V0ZXIgbGlmZWN5Y2xlIGhvb2tzLlxyXG4gICAgICovXHJcbiAgICBJbnRlcm5hbEFjdGl2YXRpb25TdHJhdGVneVtcIk5vQ2hhbmdlXCJdID0gXCJuby1jaGFuZ2VcIjtcclxuICAgIC8qKlxyXG4gICAgICogUmV1c2UgdGhlIGV4aXN0aW5nIHZpZXcgbW9kZWwsIGludm9raW5nIFJvdXRlciBsaWZlY3ljbGUgaG9va3MuXHJcbiAgICAgKi9cclxuICAgIEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5W1wiSW52b2tlTGlmZWN5Y2xlXCJdID0gXCJpbnZva2UtbGlmZWN5Y2xlXCI7XHJcbiAgICAvKipcclxuICAgICAqIFJlcGxhY2UgdGhlIGV4aXN0aW5nIHZpZXcgbW9kZWwsIGludm9raW5nIFJvdXRlciBsaWZlY3ljbGUgaG9va3MuXHJcbiAgICAgKi9cclxuICAgIEludGVybmFsQWN0aXZhdGlvblN0cmF0ZWd5W1wiUmVwbGFjZVwiXSA9IFwicmVwbGFjZVwiO1xyXG59KShJbnRlcm5hbEFjdGl2YXRpb25TdHJhdGVneSB8fCAoSW50ZXJuYWxBY3RpdmF0aW9uU3RyYXRlZ3kgPSB7fSkpO1xyXG4vKipcclxuICogVGhlIHN0cmF0ZWd5IHRvIHVzZSB3aGVuIGFjdGl2YXRpbmcgbW9kdWxlcyBkdXJpbmcgbmF2aWdhdGlvbi5cclxuICovXHJcbi8vIGtlcHQgZm9yIGNvbXBhdCByZWFzb25cclxuY29uc3QgYWN0aXZhdGlvblN0cmF0ZWd5ID0ge1xyXG4gICAgbm9DaGFuZ2U6IFwibm8tY2hhbmdlXCIgLyogTm9DaGFuZ2UgKi8sXHJcbiAgICBpbnZva2VMaWZlY3ljbGU6IFwiaW52b2tlLWxpZmVjeWNsZVwiIC8qIEludm9rZUxpZmVjeWNsZSAqLyxcclxuICAgIHJlcGxhY2U6IFwicmVwbGFjZVwiIC8qIFJlcGxhY2UgKi9cclxufTtcblxuLyoqXHJcbiAqIFJlY3Vyc2l2ZWx5IGZpbmQgbGlzdCBvZiBkZWFjdGl2YXRlLWFibGUgdmlldyBtb2RlbHNcclxuICogYW5kIGludm9rZSB0aGUgZWl0aGVyICdjYW5EZWFjdGl2YXRlJyBvciAnZGVhY3RpdmF0ZScgb24gZWFjaFxyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgcHJvY2Vzc0RlYWN0aXZhdGFibGUgPSAobmF2aWdhdGlvbkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUsIG5leHQsIGlnbm9yZVJlc3VsdCkgPT4ge1xyXG4gICAgbGV0IHBsYW4gPSBuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24ucGxhbjtcclxuICAgIGxldCBpbmZvcyA9IGZpbmREZWFjdGl2YXRhYmxlKHBsYW4sIGNhbGxiYWNrTmFtZSk7XHJcbiAgICBsZXQgaSA9IGluZm9zLmxlbmd0aDsgLy8gcXVlcnkgZnJvbSBpbnNpZGUgb3V0XHJcbiAgICBmdW5jdGlvbiBpbnNwZWN0KHZhbCkge1xyXG4gICAgICAgIGlmIChpZ25vcmVSZXN1bHQgfHwgc2hvdWxkQ29udGludWUodmFsKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlcmF0ZSgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV4dC5jYW5jZWwodmFsKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIGl0ZXJhdGUoKSB7XHJcbiAgICAgICAgaWYgKGktLSkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHZpZXdNb2RlbCA9IGluZm9zW2ldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHJlc3VsdCA9IHZpZXdNb2RlbFtjYWxsYmFja05hbWVdKG5hdmlnYXRpb25JbnN0cnVjdGlvbik7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc1BvdGVudGlhbChyZXN1bHQsIGluc3BlY3QsIG5leHQuY2FuY2VsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgbmF2aWdhdGlvbkluc3RydWN0aW9uLnJvdXRlci5jb3VsZERlYWN0aXZhdGUgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaXRlcmF0ZSgpO1xyXG59O1xyXG4vKipcclxuICogUmVjdXJzaXZlbHkgZmluZCBhbmQgcmV0dXJucyBhIGxpc3Qgb2YgZGVhY3RpdmF0ZS1hYmxlIHZpZXcgbW9kZWxzXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBmaW5kRGVhY3RpdmF0YWJsZSA9IChwbGFuLCBjYWxsYmFja05hbWUsIGxpc3QgPSBbXSkgPT4ge1xyXG4gICAgZm9yIChsZXQgdmlld1BvcnROYW1lIGluIHBsYW4pIHtcclxuICAgICAgICBsZXQgdmlld1BvcnRQbGFuID0gcGxhblt2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIGxldCBwcmV2Q29tcG9uZW50ID0gdmlld1BvcnRQbGFuLnByZXZDb21wb25lbnQ7XHJcbiAgICAgICAgaWYgKCh2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5pbnZva2VMaWZlY3ljbGUgfHwgdmlld1BvcnRQbGFuLnN0cmF0ZWd5ID09PSBhY3RpdmF0aW9uU3RyYXRlZ3kucmVwbGFjZSlcclxuICAgICAgICAgICAgJiYgcHJldkNvbXBvbmVudCkge1xyXG4gICAgICAgICAgICBsZXQgdmlld01vZGVsID0gcHJldkNvbXBvbmVudC52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFja05hbWUgaW4gdmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgICAgICBsaXN0LnB1c2godmlld01vZGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodmlld1BvcnRQbGFuLnN0cmF0ZWd5ID09PSBhY3RpdmF0aW9uU3RyYXRlZ3kucmVwbGFjZSAmJiBwcmV2Q29tcG9uZW50KSB7XHJcbiAgICAgICAgICAgIGFkZFByZXZpb3VzRGVhY3RpdmF0YWJsZShwcmV2Q29tcG9uZW50LCBjYWxsYmFja05hbWUsIGxpc3QpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmICh2aWV3UG9ydFBsYW4uY2hpbGROYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICAgICAgZmluZERlYWN0aXZhdGFibGUodmlld1BvcnRQbGFuLmNoaWxkTmF2aWdhdGlvbkluc3RydWN0aW9uLnBsYW4sIGNhbGxiYWNrTmFtZSwgbGlzdCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGxpc3Q7XHJcbn07XHJcbi8qKlxyXG4gKiBAaW50ZXJuYWwgZXhwb3J0ZWQgZm9yIHVuaXQgdGVzdGluZ1xyXG4gKi9cclxuY29uc3QgYWRkUHJldmlvdXNEZWFjdGl2YXRhYmxlID0gKGNvbXBvbmVudCwgY2FsbGJhY2tOYW1lLCBsaXN0KSA9PiB7XHJcbiAgICBsZXQgY2hpbGRSb3V0ZXIgPSBjb21wb25lbnQuY2hpbGRSb3V0ZXI7XHJcbiAgICBpZiAoY2hpbGRSb3V0ZXIgJiYgY2hpbGRSb3V0ZXIuY3VycmVudEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0SW5zdHJ1Y3Rpb25zID0gY2hpbGRSb3V0ZXIuY3VycmVudEluc3RydWN0aW9uLnZpZXdQb3J0SW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgIGZvciAobGV0IHZpZXdQb3J0TmFtZSBpbiB2aWV3UG9ydEluc3RydWN0aW9ucykge1xyXG4gICAgICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbiA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb25zW3ZpZXdQb3J0TmFtZV07XHJcbiAgICAgICAgICAgIGxldCBwcmV2Q29tcG9uZW50ID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XHJcbiAgICAgICAgICAgIGxldCBwcmV2Vmlld01vZGVsID0gcHJldkNvbXBvbmVudC52aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIGlmIChjYWxsYmFja05hbWUgaW4gcHJldlZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgbGlzdC5wdXNoKHByZXZWaWV3TW9kZWwpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGFkZFByZXZpb3VzRGVhY3RpdmF0YWJsZShwcmV2Q29tcG9uZW50LCBjYWxsYmFja05hbWUsIGxpc3QpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufTtcclxuLyoqXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBwcm9jZXNzQWN0aXZhdGFibGUgPSAobmF2aWdhdGlvbkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUsIG5leHQsIGlnbm9yZVJlc3VsdCkgPT4ge1xyXG4gICAgbGV0IGluZm9zID0gZmluZEFjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgY2FsbGJhY2tOYW1lKTtcclxuICAgIGxldCBsZW5ndGggPSBpbmZvcy5sZW5ndGg7XHJcbiAgICBsZXQgaSA9IC0xOyAvLyBxdWVyeSBmcm9tIHRvcCBkb3duXHJcbiAgICBmdW5jdGlvbiBpbnNwZWN0KHZhbCwgcm91dGVyKSB7XHJcbiAgICAgICAgaWYgKGlnbm9yZVJlc3VsdCB8fCBzaG91bGRDb250aW51ZSh2YWwsIHJvdXRlcikpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGl0ZXJhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5leHQuY2FuY2VsKHZhbCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBpdGVyYXRlKCkge1xyXG4gICAgICAgIGkrKztcclxuICAgICAgICBpZiAoaSA8IGxlbmd0aCkge1xyXG4gICAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnQgPSBpbmZvc1tpXTtcclxuICAgICAgICAgICAgICAgIGxldCByZXN1bHQgPSBjdXJyZW50LnZpZXdNb2RlbFtjYWxsYmFja05hbWVdKC4uLmN1cnJlbnQubGlmZWN5Y2xlQXJncyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvY2Vzc1BvdGVudGlhbChyZXN1bHQsICh2YWwpID0+IGluc3BlY3QodmFsLCBjdXJyZW50LnJvdXRlciksIG5leHQuY2FuY2VsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBuZXh0LmNhbmNlbChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgIH1cclxuICAgIHJldHVybiBpdGVyYXRlKCk7XHJcbn07XHJcbi8qKlxyXG4gKiBGaW5kIGxpc3Qgb2YgYWN0aXZhdGFibGUgdmlldyBtb2RlbCBhbmQgYWRkIHRvIGxpc3QgKDNyZCBwYXJhbWV0ZXIpXHJcbiAqIEBpbnRlcm5hbCBleHBvcnRlZCBmb3IgdW5pdCB0ZXN0aW5nXHJcbiAqL1xyXG5jb25zdCBmaW5kQWN0aXZhdGFibGUgPSAobmF2aWdhdGlvbkluc3RydWN0aW9uLCBjYWxsYmFja05hbWUsIGxpc3QgPSBbXSwgcm91dGVyKSA9PiB7XHJcbiAgICBsZXQgcGxhbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi5wbGFuO1xyXG4gICAgT2JqZWN0XHJcbiAgICAgICAgLmtleXMocGxhbilcclxuICAgICAgICAuZm9yRWFjaCgodmlld1BvcnROYW1lKSA9PiB7XHJcbiAgICAgICAgbGV0IHZpZXdQb3J0UGxhbiA9IHBsYW5bdmlld1BvcnROYW1lXTtcclxuICAgICAgICBsZXQgdmlld1BvcnRJbnN0cnVjdGlvbiA9IG5hdmlnYXRpb25JbnN0cnVjdGlvbi52aWV3UG9ydEluc3RydWN0aW9uc1t2aWV3UG9ydE5hbWVdO1xyXG4gICAgICAgIGxldCB2aWV3UG9ydENvbXBvbmVudCA9IHZpZXdQb3J0SW5zdHJ1Y3Rpb24uY29tcG9uZW50O1xyXG4gICAgICAgIGxldCB2aWV3TW9kZWwgPSB2aWV3UG9ydENvbXBvbmVudC52aWV3TW9kZWw7XHJcbiAgICAgICAgaWYgKCh2aWV3UG9ydFBsYW4uc3RyYXRlZ3kgPT09IGFjdGl2YXRpb25TdHJhdGVneS5pbnZva2VMaWZlY3ljbGVcclxuICAgICAgICAgICAgfHwgdmlld1BvcnRQbGFuLnN0cmF0ZWd5ID09PSBhY3RpdmF0aW9uU3RyYXRlZ3kucmVwbGFjZSlcclxuICAgICAgICAgICAgJiYgY2FsbGJhY2tOYW1lIGluIHZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICBsaXN0LnB1c2goe1xyXG4gICAgICAgICAgICAgICAgdmlld01vZGVsLFxyXG4gICAgICAgICAgICAgICAgbGlmZWN5Y2xlQXJnczogdmlld1BvcnRJbnN0cnVjdGlvbi5saWZlY3ljbGVBcmdzLFxyXG4gICAgICAgICAgICAgICAgcm91dGVyXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgY2hpbGROYXZJbnN0cnVjdGlvbiA9IHZpZXdQb3J0UGxhbi5jaGlsZE5hdmlnYXRpb25JbnN0cnVjdGlvbjtcclxuICAgICAgICBpZiAoY2hpbGROYXZJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICBmaW5kQWN0aXZhdGFibGUoY2hpbGROYXZJbnN0cnVjdGlvbiwgY2FsbGJhY2tOYW1lLCBsaXN0LCB2aWV3UG9ydENvbXBvbmVudC5jaGlsZFJvdXRlciB8fCByb3V0ZXIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIGxpc3Q7XHJcbn07XHJcbmNvbnN0IHNob3VsZENvbnRpbnVlID0gKG91dHB1dCwgcm91dGVyKSA9PiB7XHJcbiAgICBpZiAob3V0cHV0IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBpZiAoaXNOYXZpZ2F0aW9uQ29tbWFuZChvdXRwdXQpKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBvdXRwdXQuc2V0Um91dGVyID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIG91dHB1dC5zZXRSb3V0ZXIocm91dGVyKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuICEhb3V0cHV0LnNob3VsZENvbnRpbnVlUHJvY2Vzc2luZztcclxuICAgIH1cclxuICAgIGlmIChvdXRwdXQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG91dHB1dDtcclxufTtcclxuLyoqXHJcbiAqIHdyYXBzIGEgc3Vic2NyaXB0aW9uLCBhbGxvd2luZyB1bnN1YnNjcmliZSBjYWxscyBldmVuIGlmXHJcbiAqIHRoZSBmaXJzdCB2YWx1ZSBjb21lcyBzeW5jaHJvbm91c2x5XHJcbiAqL1xyXG5jbGFzcyBTYWZlU3Vic2NyaXB0aW9uIHtcclxuICAgIGNvbnN0cnVjdG9yKHN1YnNjcmlwdGlvbkZ1bmMpIHtcclxuICAgICAgICB0aGlzLl9zdWJzY3JpYmVkID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLl9zdWJzY3JpcHRpb24gPSBzdWJzY3JpcHRpb25GdW5jKHRoaXMpO1xyXG4gICAgICAgIGlmICghdGhpcy5fc3Vic2NyaWJlZCkge1xyXG4gICAgICAgICAgICB0aGlzLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgZ2V0IHN1YnNjcmliZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3N1YnNjcmliZWQ7XHJcbiAgICB9XHJcbiAgICB1bnN1YnNjcmliZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5fc3Vic2NyaWJlZCAmJiB0aGlzLl9zdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5fc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX3N1YnNjcmliZWQgPSBmYWxzZTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQSBmdW5jdGlvbiB0byBwcm9jZXNzIHJldHVybiB2YWx1ZSBmcm9tIGBhY3RpdmF0ZWAvYGNhbkFjdGl2YXRlYCBzdGVwc1xyXG4gKiBTdXBwb3J0cyBvYnNlcnZhYmxlL3Byb21pc2VcclxuICpcclxuICogRm9yIG9ic2VydmFibGUsIHJlc29sdmUgYXQgZmlyc3QgbmV4dCgpIG9yIG9uIGNvbXBsZXRlKClcclxuICovXHJcbmNvbnN0IHByb2Nlc3NQb3RlbnRpYWwgPSAob2JqLCByZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgIC8vIGlmIHByb21pc2UgbGlrZVxyXG4gICAgaWYgKG9iaiAmJiB0eXBlb2Ygb2JqLnRoZW4gPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG9iaikudGhlbihyZXNvbHZlKS5jYXRjaChyZWplY3QpO1xyXG4gICAgfVxyXG4gICAgLy8gaWYgb2JzZXJ2YWJsZVxyXG4gICAgaWYgKG9iaiAmJiB0eXBlb2Ygb2JqLnN1YnNjcmliZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIGxldCBvYnMgPSBvYmo7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTYWZlU3Vic2NyaXB0aW9uKHN1YiA9PiBvYnMuc3Vic2NyaWJlKHtcclxuICAgICAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3Vic2NyaWJlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUob2JqKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZXJyb3IoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzdWIuc3Vic2NyaWJlZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHN1Yi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGNvbXBsZXRlKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHN1Yi5zdWJzY3JpYmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgc3ViLnVuc3Vic2NyaWJlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShvYmopO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSkpO1xyXG4gICAgfVxyXG4gICAgLy8gZWxzZSBqdXN0IHJlc29sdmVcclxuICAgIHRyeSB7XHJcbiAgICAgICAgcmV0dXJuIHJlc29sdmUob2JqKTtcclxuICAgIH1cclxuICAgIGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xyXG4gICAgfVxyXG59O1xuXG4vKipcclxuICogQSBwaXBlbGluZSBzdGVwIHJlc3BvbnNpYmxlIGZvciBmaW5kaW5nIGFuZCBhY3RpdmF0aW5nIG1ldGhvZCBgY2FuRGVhY3RpdmF0ZWAgb24gYSB2aWV3IG1vZGVsIG9mIGEgcm91dGVcclxuICovXHJcbmNsYXNzIENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAge1xyXG4gICAgcnVuKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgbmV4dCkge1xyXG4gICAgICAgIHJldHVybiBwcm9jZXNzRGVhY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sICdjYW5EZWFjdGl2YXRlJywgbmV4dCk7XHJcbiAgICB9XHJcbn1cclxuLyoqXHJcbiAqIEEgcGlwZWxpbmUgc3RlcCByZXNwb25zaWJsZSBmb3IgZmluZGluZyBhbmQgYWN0aXZhdGluZyBtZXRob2QgYGNhbkFjdGl2YXRlYCBvbiBhIHZpZXcgbW9kZWwgb2YgYSByb3V0ZVxyXG4gKi9cclxuY2xhc3MgQ2FuQWN0aXZhdGVOZXh0U3RlcCB7XHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NBY3RpdmF0YWJsZShuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sICdjYW5BY3RpdmF0ZScsIG5leHQpO1xyXG4gICAgfVxyXG59XHJcbi8qKlxyXG4gKiBBIHBpcGVsaW5lIHN0ZXAgcmVzcG9uc2libGUgZm9yIGZpbmRpbmcgYW5kIGFjdGl2YXRpbmcgbWV0aG9kIGBkZWFjdGl2YXRlYCBvbiBhIHZpZXcgbW9kZWwgb2YgYSByb3V0ZVxyXG4gKi9cclxuY2xhc3MgRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCB7XHJcbiAgICBydW4obmF2aWdhdGlvbkluc3RydWN0aW9uLCBuZXh0KSB7XHJcbiAgICAgICAgcmV0dXJuIHByb2Nlc3NEZWFjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgJ2RlYWN0aXZhdGUnLCBuZXh0LCB0cnVlKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQSBwaXBlbGluZSBzdGVwIHJlc3BvbnNpYmxlIGZvciBmaW5kaW5nIGFuZCBhY3RpdmF0aW5nIG1ldGhvZCBgYWN0aXZhdGVgIG9uIGEgdmlldyBtb2RlbCBvZiBhIHJvdXRlXHJcbiAqL1xyXG5jbGFzcyBBY3RpdmF0ZU5leHRTdGVwIHtcclxuICAgIHJ1bihuYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24sIG5leHQpIHtcclxuICAgICAgICByZXR1cm4gcHJvY2Vzc0FjdGl2YXRhYmxlKG5hdmlnYXRpb25JbnN0cnVjdGlvbiwgJ2FjdGl2YXRlJywgbmV4dCwgdHJ1ZSk7XHJcbiAgICB9XHJcbn1cblxuLyoqXHJcbiAqIEEgbXVsdGktc2xvdHMgUGlwZWxpbmUgUGxhY2Vob2xkZXIgU3RlcCBmb3IgaG9va2luZyBpbnRvIGEgcGlwZWxpbmUgZXhlY3V0aW9uXHJcbiAqL1xyXG5jbGFzcyBQaXBlbGluZVNsb3Qge1xyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyLCBuYW1lLCBhbGlhcykge1xyXG4gICAgICAgIHRoaXMuc3RlcHMgPSBbXTtcclxuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcclxuICAgICAgICB0aGlzLnNsb3ROYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnNsb3RBbGlhcyA9IGFsaWFzO1xyXG4gICAgfVxyXG4gICAgZ2V0U3RlcHMoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RlcHMubWFwKHggPT4gdGhpcy5jb250YWluZXIuZ2V0KHgpKTtcclxuICAgIH1cclxufVxyXG4vKipcclxuICogQ2xhc3MgcmVzcG9uc2libGUgZm9yIGNyZWF0aW5nIHRoZSBuYXZpZ2F0aW9uIHBpcGVsaW5lLlxyXG4gKi9cclxuY2xhc3MgUGlwZWxpbmVQcm92aWRlciB7XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBpbmplY3QoKSB7IHJldHVybiBbQ29udGFpbmVyXTsgfVxyXG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5zdGVwcyA9IFtcclxuICAgICAgICAgICAgQnVpbGROYXZpZ2F0aW9uUGxhblN0ZXAsXHJcbiAgICAgICAgICAgIENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXAsXHJcbiAgICAgICAgICAgIExvYWRSb3V0ZVN0ZXAsXHJcbiAgICAgICAgICAgIGNyZWF0ZVBpcGVsaW5lU2xvdChjb250YWluZXIsIFwiYXV0aG9yaXplXCIgLyogQXV0aG9yaXplICovKSxcclxuICAgICAgICAgICAgQ2FuQWN0aXZhdGVOZXh0U3RlcCxcclxuICAgICAgICAgICAgY3JlYXRlUGlwZWxpbmVTbG90KGNvbnRhaW5lciwgXCJwcmVBY3RpdmF0ZVwiIC8qIFByZUFjdGl2YXRlICovLCAnbW9kZWxiaW5kJyksXHJcbiAgICAgICAgICAgIC8vIE5PVEU6IGFwcCBzdGF0ZSBjaGFuZ2VzIHN0YXJ0IGJlbG93IC0gcG9pbnQgb2Ygbm8gcmV0dXJuXHJcbiAgICAgICAgICAgIERlYWN0aXZhdGVQcmV2aW91c1N0ZXAsXHJcbiAgICAgICAgICAgIEFjdGl2YXRlTmV4dFN0ZXAsXHJcbiAgICAgICAgICAgIGNyZWF0ZVBpcGVsaW5lU2xvdChjb250YWluZXIsIFwicHJlUmVuZGVyXCIgLyogUHJlUmVuZGVyICovLCAncHJlY29tbWl0JyksXHJcbiAgICAgICAgICAgIENvbW1pdENoYW5nZXNTdGVwLFxyXG4gICAgICAgICAgICBjcmVhdGVQaXBlbGluZVNsb3QoY29udGFpbmVyLCBcInBvc3RSZW5kZXJcIiAvKiBQb3N0UmVuZGVyICovLCAncG9zdGNvbXBsZXRlJylcclxuICAgICAgICBdO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDcmVhdGUgdGhlIG5hdmlnYXRpb24gcGlwZWxpbmUuXHJcbiAgICAgKi9cclxuICAgIGNyZWF0ZVBpcGVsaW5lKHVzZUNhbkRlYWN0aXZhdGVTdGVwID0gdHJ1ZSkge1xyXG4gICAgICAgIGxldCBwaXBlbGluZSA9IG5ldyBQaXBlbGluZSgpO1xyXG4gICAgICAgIHRoaXMuc3RlcHMuZm9yRWFjaChzdGVwID0+IHtcclxuICAgICAgICAgICAgaWYgKHVzZUNhbkRlYWN0aXZhdGVTdGVwIHx8IHN0ZXAgIT09IENhbkRlYWN0aXZhdGVQcmV2aW91c1N0ZXApIHtcclxuICAgICAgICAgICAgICAgIHBpcGVsaW5lLmFkZFN0ZXAodGhpcy5jb250YWluZXIuZ2V0KHN0ZXApKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybiBwaXBlbGluZTtcclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX2ZpbmRTdGVwKG5hbWUpIHtcclxuICAgICAgICAvLyBTdGVwcyB0aGF0IGFyZSBub3QgUGlwZWxpbmVTbG90cyBhcmUgY29uc3RydWN0b3IgZnVuY3Rpb25zLCBhbmQgdGhleSB3aWxsIGF1dG9tYXRpY2FsbHkgZmFpbC4gUHJvYmFibHkuXHJcbiAgICAgICAgcmV0dXJuIHRoaXMuc3RlcHMuZmluZCh4ID0+IHguc2xvdE5hbWUgPT09IG5hbWUgfHwgeC5zbG90QWxpYXMgPT09IG5hbWUpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBZGRzIGEgc3RlcCBpbnRvIHRoZSBwaXBlbGluZSBhdCBhIGtub3duIHNsb3QgbG9jYXRpb24uXHJcbiAgICAgKi9cclxuICAgIGFkZFN0ZXAobmFtZSwgc3RlcCkge1xyXG4gICAgICAgIGxldCBmb3VuZCA9IHRoaXMuX2ZpbmRTdGVwKG5hbWUpO1xyXG4gICAgICAgIGlmIChmb3VuZCkge1xyXG4gICAgICAgICAgICBsZXQgc2xvdFN0ZXBzID0gZm91bmQuc3RlcHM7XHJcbiAgICAgICAgICAgIC8vIHByZXZlbnQgZHVwbGljYXRlc1xyXG4gICAgICAgICAgICBpZiAoIXNsb3RTdGVwcy5pbmNsdWRlcyhzdGVwKSkge1xyXG4gICAgICAgICAgICAgICAgc2xvdFN0ZXBzLnB1c2goc3RlcCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBwaXBlbGluZSBzbG90IG5hbWU6ICR7bmFtZX0uYCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBSZW1vdmVzIGEgc3RlcCBmcm9tIGEgc2xvdCBpbiB0aGUgcGlwZWxpbmVcclxuICAgICAqL1xyXG4gICAgcmVtb3ZlU3RlcChuYW1lLCBzdGVwKSB7XHJcbiAgICAgICAgbGV0IHNsb3QgPSB0aGlzLl9maW5kU3RlcChuYW1lKTtcclxuICAgICAgICBpZiAoc2xvdCkge1xyXG4gICAgICAgICAgICBsZXQgc2xvdFN0ZXBzID0gc2xvdC5zdGVwcztcclxuICAgICAgICAgICAgc2xvdFN0ZXBzLnNwbGljZShzbG90U3RlcHMuaW5kZXhPZihzdGVwKSwgMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBDbGVhcnMgYWxsIHN0ZXBzIGZyb20gYSBzbG90IGluIHRoZSBwaXBlbGluZVxyXG4gICAgICogQGludGVybmFsXHJcbiAgICAgKi9cclxuICAgIF9jbGVhclN0ZXBzKG5hbWUgPSAnJykge1xyXG4gICAgICAgIGxldCBzbG90ID0gdGhpcy5fZmluZFN0ZXAobmFtZSk7XHJcbiAgICAgICAgaWYgKHNsb3QpIHtcclxuICAgICAgICAgICAgc2xvdC5zdGVwcyA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogUmVzZXRzIGFsbCBwaXBlbGluZSBzbG90c1xyXG4gICAgICovXHJcbiAgICByZXNldCgpIHtcclxuICAgICAgICB0aGlzLl9jbGVhclN0ZXBzKFwiYXV0aG9yaXplXCIgLyogQXV0aG9yaXplICovKTtcclxuICAgICAgICB0aGlzLl9jbGVhclN0ZXBzKFwicHJlQWN0aXZhdGVcIiAvKiBQcmVBY3RpdmF0ZSAqLyk7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJTdGVwcyhcInByZVJlbmRlclwiIC8qIFByZVJlbmRlciAqLyk7XHJcbiAgICAgICAgdGhpcy5fY2xlYXJTdGVwcyhcInBvc3RSZW5kZXJcIiAvKiBQb3N0UmVuZGVyICovKTtcclxuICAgIH1cclxufVxyXG4vKipAaW50ZXJuYWwgKi9cclxuY29uc3QgY3JlYXRlUGlwZWxpbmVTbG90ID0gKGNvbnRhaW5lciwgbmFtZSwgYWxpYXMpID0+IHtcclxuICAgIHJldHVybiBuZXcgUGlwZWxpbmVTbG90KGNvbnRhaW5lciwgbmFtZSwgYWxpYXMpO1xyXG59O1xuXG5jb25zdCBsb2dnZXIgPSBnZXRMb2dnZXIoJ2FwcC1yb3V0ZXInKTtcclxuLyoqXHJcbiAqIFRoZSBtYWluIGFwcGxpY2F0aW9uIHJvdXRlci5cclxuICovXHJcbmNsYXNzIEFwcFJvdXRlciBleHRlbmRzIFJvdXRlciB7XHJcbiAgICAvKipAaW50ZXJuYWwgKi9cclxuICAgIHN0YXRpYyBpbmplY3QoKSB7IHJldHVybiBbQ29udGFpbmVyLCBIaXN0b3J5LCBQaXBlbGluZVByb3ZpZGVyLCBFdmVudEFnZ3JlZ2F0b3JdOyB9XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIsIGhpc3RvcnksIHBpcGVsaW5lUHJvdmlkZXIsIGV2ZW50cykge1xyXG4gICAgICAgIHN1cGVyKGNvbnRhaW5lciwgaGlzdG9yeSk7IC8vIE5vdGUgdGhlIHN1cGVyIHdpbGwgY2FsbCByZXNldCBpbnRlcm5hbGx5LlxyXG4gICAgICAgIHRoaXMucGlwZWxpbmVQcm92aWRlciA9IHBpcGVsaW5lUHJvdmlkZXI7XHJcbiAgICAgICAgdGhpcy5ldmVudHMgPSBldmVudHM7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIEZ1bGx5IHJlc2V0cyB0aGUgcm91dGVyJ3MgaW50ZXJuYWwgc3RhdGUuIFByaW1hcmlseSB1c2VkIGludGVybmFsbHkgYnkgdGhlIGZyYW1ld29yayB3aGVuIG11bHRpcGxlIGNhbGxzIHRvIHNldFJvb3QgYXJlIG1hZGUuXHJcbiAgICAgKiBVc2Ugd2l0aCBjYXV0aW9uIChhY3R1YWxseSwgYXZvaWQgdXNpbmcgdGhpcykuIERvIG5vdCB1c2UgdGhpcyB0byBzaW1wbHkgY2hhbmdlIHlvdXIgbmF2aWdhdGlvbiBtb2RlbC5cclxuICAgICAqL1xyXG4gICAgcmVzZXQoKSB7XHJcbiAgICAgICAgc3VwZXIucmVzZXQoKTtcclxuICAgICAgICB0aGlzLm1heEluc3RydWN0aW9uQ291bnQgPSAxMDtcclxuICAgICAgICBpZiAoIXRoaXMuX3F1ZXVlKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9xdWV1ZS5sZW5ndGggPSAwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogTG9hZHMgdGhlIHNwZWNpZmllZCBVUkwuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtIHVybCBUaGUgVVJMIGZyYWdtZW50IHRvIGxvYWQuXHJcbiAgICAgKi9cclxuICAgIGxvYWRVcmwodXJsKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXNcclxuICAgICAgICAgICAgLl9jcmVhdGVOYXZpZ2F0aW9uSW5zdHJ1Y3Rpb24odXJsKVxyXG4gICAgICAgICAgICAudGhlbihpbnN0cnVjdGlvbiA9PiB0aGlzLl9xdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uKSlcclxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGVycm9yKTtcclxuICAgICAgICAgICAgcmVzdG9yZVByZXZpb3VzTG9jYXRpb24odGhpcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIFJlZ2lzdGVycyBhIHZpZXdQb3J0IHRvIGJlIHVzZWQgYXMgYSByZW5kZXJpbmcgdGFyZ2V0IGZvciBhY3RpdmF0ZWQgcm91dGVzLlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB2aWV3UG9ydCBUaGUgdmlld1BvcnQuIFRoaXMgaXMgdHlwaWNhbGx5IGEgPHJvdXRlci12aWV3Lz4gZWxlbWVudCBpbiBBdXJlbGlhIGRlZmF1bHQgaW1wbFxyXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgb2YgdGhlIHZpZXdQb3J0LiAnZGVmYXVsdCcgaWYgdW5zcGVjaWZpZWQuXHJcbiAgICAgKi9cclxuICAgIHJlZ2lzdGVyVmlld1BvcnQodmlld1BvcnQsIG5hbWUpIHtcclxuICAgICAgICAvLyBoYXZpbmcgc3Ryb25nIHR5cGluZyB3aXRob3V0IGNoYW5naW5nIHB1YmxpYyBBUElcclxuICAgICAgICBjb25zdCAkdmlld1BvcnQgPSB2aWV3UG9ydDtcclxuICAgICAgICBzdXBlci5yZWdpc3RlclZpZXdQb3J0KCR2aWV3UG9ydCwgbmFtZSk7XHJcbiAgICAgICAgLy8gYmVzaWRlIGFkZGluZyB2aWV3cG9ydCB0byB0aGUgcmVnaXN0cnkgb2YgdGhpcyBpbnN0YW5jZVxyXG4gICAgICAgIC8vIEFwcFJvdXRlciBhbHNvIGNvbmZpZ3VyZSByb3V0aW5nL2hpc3RvcnkgdG8gc3RhcnQgcm91dGluZyBmdW5jdGlvbmFsaXR5XHJcbiAgICAgICAgLy8gVGhlcmUgYXJlIHNpdHVhdGlvbiB3aGVyZSB0aGVyZSBhcmUgbW9yZSB0aGFuIDEgPHJvdXRlci12aWV3Lz4gZWxlbWVudCBhdCByb290IHZpZXdcclxuICAgICAgICAvLyBpbiB0aGF0IGNhc2UsIHN0aWxsIG9ubHkgYWN0aXZhdGUgb25jZSB2aWEgdGhlIGZvbGxvd2luZyBndWFyZFxyXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICBjb25zdCB2aWV3TW9kZWwgPSB0aGlzLl9maW5kVmlld01vZGVsKCR2aWV3UG9ydCk7XHJcbiAgICAgICAgICAgIGlmICgnY29uZmlndXJlUm91dGVyJyBpbiB2aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBtb3JlIHRoYW4gb25lIDxyb3V0ZXItdmlldy8+IGVsZW1lbnQgYXQgcm9vdCB2aWV3XHJcbiAgICAgICAgICAgICAgICAvLyB1c2UgdGhpcyBmbGFnIHRvIGd1YXJkIGFnYWluc3QgY29uZmlndXJlIG1ldGhvZCBiZWluZyBpbnZva2VkIG11bHRpcGxlIHRpbWVzXHJcbiAgICAgICAgICAgICAgICAvLyB0aGlzIGZsYWcgaXMgc2V0IGluc2lkZSBtZXRob2QgY29uZmlndXJlXHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNDb25maWd1cmVkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVwbGFjZSB0aGUgcmVhbCByZXNvbHZlIHdpdGggYSBub29wIHRvIGd1YXJhbnRlZSB0aGF0IGFueSBhY3Rpb24gaW4gYmFzZSBjbGFzcyBSb3V0ZXJcclxuICAgICAgICAgICAgICAgICAgICAvLyB3b24ndCByZXNvbHZlIHRoZSBjb25maWd1cmVQcm9taXNlIHByZW1hdHVyZWx5XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlID0gdGhpcy5fcmVzb2x2ZUNvbmZpZ3VyZWRQcm9taXNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3Jlc29sdmVDb25maWd1cmVkUHJvbWlzZSA9ICgpID0+IHsgfTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAuY29uZmlndXJlKGNvbmZpZyA9PiBQcm9taXNlXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZXNvbHZlKHZpZXdNb2RlbC5jb25maWd1cmVSb3V0ZXIoY29uZmlnLCB0aGlzKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYW4gaXNzdWUgd2l0aCBjb25maWd1cmUgaW50ZXJmYWNlLiBTaG91bGQgYmUgZml4ZWQgdGhlcmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdG9kbzogZml4IHRoaXMgdmlhIGNvbmZpZ3VyZSBpbnRlcmZhY2UgaW4gcm91dGVyXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IGNvbmZpZykpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5hY3RpdmF0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlQ29uZmlndXJlZFByb21pc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuYWN0aXZhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICAvLyB3aGVuIGEgdmlld3BvcnQgaXMgYWRkZWQgZHluYW1pY2FsbHkgdG8gYSByb290IHZpZXcgdGhhdCBpcyBhbHJlYWR5IGFjdGl2YXRlZFxyXG4gICAgICAgIC8vIGp1c3QgcHJvY2VzcyB0aGUgbmF2aWdhdGlvbiBpbnN0cnVjdGlvblxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG4gICAgLyoqXHJcbiAgICAgKiBBY3RpdmF0ZXMgdGhlIHJvdXRlci4gVGhpcyBpbnN0cnVjdHMgdGhlIHJvdXRlciB0byBiZWdpbiBsaXN0ZW5pbmcgZm9yIGhpc3RvcnkgY2hhbmdlcyBhbmQgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbnMuXHJcbiAgICAgKlxyXG4gICAgICogQHBhcmFtcyBvcHRpb25zIFRoZSBzZXQgb2Ygb3B0aW9ucyB0byBhY3RpdmF0ZSB0aGUgcm91dGVyIHdpdGguXHJcbiAgICAgKi9cclxuICAgIGFjdGl2YXRlKG9wdGlvbnMpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgIC8vIHJvdXRlIGhhbmRsZXIgcHJvcGVydHkgaXMgcmVzcG9uc2libGUgZm9yIGhhbmRsaW5nIHVybCBjaGFuZ2VcclxuICAgICAgICAvLyB0aGUgaW50ZXJmYWNlIG9mIGF1cmVsaWEtaGlzdG9yeSBpc24ndCBjbGVhciBvbiB0aGlzIHBlcnNwZWN0aXZlXHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gT2JqZWN0LmFzc2lnbih7IHJvdXRlSGFuZGxlcjogdGhpcy5sb2FkVXJsLmJpbmQodGhpcykgfSwgdGhpcy5vcHRpb25zLCBvcHRpb25zKTtcclxuICAgICAgICB0aGlzLmhpc3RvcnkuYWN0aXZhdGUodGhpcy5vcHRpb25zKTtcclxuICAgICAgICB0aGlzLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oKTtcclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICogRGVhY3RpdmF0ZXMgdGhlIHJvdXRlci5cclxuICAgICAqL1xyXG4gICAgZGVhY3RpdmF0ZSgpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5oaXN0b3J5LmRlYWN0aXZhdGUoKTtcclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX3F1ZXVlSW5zdHJ1Y3Rpb24oaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24ucmVzb2x2ZSA9IHJlc29sdmU7XHJcbiAgICAgICAgICAgIHRoaXMuX3F1ZXVlLnVuc2hpZnQoaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICB0aGlzLl9kZXF1ZXVlSW5zdHJ1Y3Rpb24oKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX2RlcXVldWVJbnN0cnVjdGlvbihpbnN0cnVjdGlvbkNvdW50ID0gMCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuaXNOYXZpZ2F0aW5nICYmICFpbnN0cnVjdGlvbkNvdW50KSB7XHJcbiAgICAgICAgICAgICAgICAvLyB0cyBjb21wbGFpbnMgYWJvdXQgaW5jb25zaXN0ZW50IHJldHVybnMgd2l0aG91dCB2b2lkIDBcclxuICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGluc3RydWN0aW9uID0gdGhpcy5fcXVldWUuc2hpZnQoKTtcclxuICAgICAgICAgICAgdGhpcy5fcXVldWUubGVuZ3RoID0gMDtcclxuICAgICAgICAgICAgaWYgKCFpbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy8gdHMgY29tcGxhaW5zIGFib3V0IGluY29uc2lzdGVudCByZXR1cm5zIHdpdGhvdXQgdm9pZCAwXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nID0gdHJ1ZTtcclxuICAgICAgICAgICAgbGV0IG5hdnRyYWNrZXIgPSB0aGlzLmhpc3RvcnkuZ2V0U3RhdGUoJ05hdmlnYXRpb25UcmFja2VyJyk7XHJcbiAgICAgICAgICAgIGxldCBjdXJyZW50TmF2VHJhY2tlciA9IHRoaXMuY3VycmVudE5hdmlnYXRpb25UcmFja2VyO1xyXG4gICAgICAgICAgICBpZiAoIW5hdnRyYWNrZXIgJiYgIWN1cnJlbnROYXZUcmFja2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTmF2aWdhdGluZ0ZpcnN0ID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nTmV3ID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmICghbmF2dHJhY2tlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdOZXcgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKCFjdXJyZW50TmF2VHJhY2tlcikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5pc05hdmlnYXRpbmdSZWZyZXNoID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50TmF2VHJhY2tlciA8IG5hdnRyYWNrZXIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuaXNOYXZpZ2F0aW5nRm9yd2FyZCA9IHRydWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoY3VycmVudE5hdlRyYWNrZXIgPiBuYXZ0cmFja2VyKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmlzTmF2aWdhdGluZ0JhY2sgPSB0cnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICghbmF2dHJhY2tlcikge1xyXG4gICAgICAgICAgICAgICAgbmF2dHJhY2tlciA9IERhdGUubm93KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmhpc3Rvcnkuc2V0U3RhdGUoJ05hdmlnYXRpb25UcmFja2VyJywgbmF2dHJhY2tlcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5jdXJyZW50TmF2aWdhdGlvblRyYWNrZXIgPSBuYXZ0cmFja2VyO1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbi5wcmV2aW91c0luc3RydWN0aW9uID0gdGhpcy5jdXJyZW50SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIGxldCBtYXhJbnN0cnVjdGlvbkNvdW50ID0gdGhpcy5tYXhJbnN0cnVjdGlvbkNvdW50O1xyXG4gICAgICAgICAgICBpZiAoIWluc3RydWN0aW9uQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuZXZlbnRzLnB1Ymxpc2goXCJyb3V0ZXI6bmF2aWdhdGlvbjpwcm9jZXNzaW5nXCIgLyogUHJvY2Vzc2luZyAqLywgeyBpbnN0cnVjdGlvbiB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChpbnN0cnVjdGlvbkNvdW50ID09PSBtYXhJbnN0cnVjdGlvbkNvdW50IC0gMSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGAke2luc3RydWN0aW9uQ291bnQgKyAxfSBuYXZpZ2F0aW9uIGluc3RydWN0aW9ucyBoYXZlIGJlZW4gYXR0ZW1wdGVkIHdpdGhvdXQgc3VjY2Vzcy4gUmVzdG9yaW5nIGxhc3Qga25vd24gZ29vZCBsb2NhdGlvbi5gKTtcclxuICAgICAgICAgICAgICAgIHJlc3RvcmVQcmV2aW91c0xvY2F0aW9uKHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2RlcXVldWVJbnN0cnVjdGlvbihpbnN0cnVjdGlvbkNvdW50ICsgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoaW5zdHJ1Y3Rpb25Db3VudCA+IG1heEluc3RydWN0aW9uQ291bnQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWF4aW11bSBuYXZpZ2F0aW9uIGF0dGVtcHRzIGV4Y2VlZGVkLiBHaXZpbmcgdXAuJyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IHBpcGVsaW5lID0gdGhpcy5waXBlbGluZVByb3ZpZGVyLmNyZWF0ZVBpcGVsaW5lKCF0aGlzLmNvdWxkRGVhY3RpdmF0ZSk7XHJcbiAgICAgICAgICAgIHJldHVybiBwaXBlbGluZVxyXG4gICAgICAgICAgICAgICAgLnJ1bihpbnN0cnVjdGlvbilcclxuICAgICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiBwcm9jZXNzUmVzdWx0KGluc3RydWN0aW9uLCByZXN1bHQsIGluc3RydWN0aW9uQ291bnQsIHRoaXMpKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7IG91dHB1dDogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yIDogbmV3IEVycm9yKGVycm9yKSB9O1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHJlc29sdmVJbnN0cnVjdGlvbihpbnN0cnVjdGlvbiwgcmVzdWx0LCAhIWluc3RydWN0aW9uQ291bnQsIHRoaXMpKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIC8qKkBpbnRlcm5hbCAqL1xyXG4gICAgX2ZpbmRWaWV3TW9kZWwodmlld1BvcnQpIHtcclxuICAgICAgICBpZiAodGhpcy5jb250YWluZXIudmlld01vZGVsKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnRhaW5lci52aWV3TW9kZWw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh2aWV3UG9ydC5jb250YWluZXIpIHtcclxuICAgICAgICAgICAgbGV0IGNvbnRhaW5lciA9IHZpZXdQb3J0LmNvbnRhaW5lcjtcclxuICAgICAgICAgICAgd2hpbGUgKGNvbnRhaW5lcikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNvbnRhaW5lci52aWV3TW9kZWwpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbnRhaW5lci52aWV3TW9kZWwgPSBjb250YWluZXIudmlld01vZGVsO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb250YWluZXIudmlld01vZGVsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyID0gY29udGFpbmVyLnBhcmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG59XHJcbmNvbnN0IHByb2Nlc3NSZXN1bHQgPSAoaW5zdHJ1Y3Rpb24sIHJlc3VsdCwgaW5zdHJ1Y3Rpb25Db3VudCwgcm91dGVyKSA9PiB7XHJcbiAgICBpZiAoIShyZXN1bHQgJiYgJ2NvbXBsZXRlZCcgaW4gcmVzdWx0ICYmICdvdXRwdXQnIGluIHJlc3VsdCkpIHtcclxuICAgICAgICByZXN1bHQgPSByZXN1bHQgfHwge307XHJcbiAgICAgICAgcmVzdWx0Lm91dHB1dCA9IG5ldyBFcnJvcihgRXhwZWN0ZWQgcm91dGVyIHBpcGVsaW5lIHRvIHJldHVybiBhIG5hdmlnYXRpb24gcmVzdWx0LCBidXQgZ290IFske0pTT04uc3RyaW5naWZ5KHJlc3VsdCl9XSBpbnN0ZWFkLmApO1xyXG4gICAgfVxyXG4gICAgbGV0IGZpbmFsUmVzdWx0ID0gbnVsbDtcclxuICAgIGxldCBuYXZpZ2F0aW9uQ29tbWFuZFJlc3VsdCA9IG51bGw7XHJcbiAgICBpZiAoaXNOYXZpZ2F0aW9uQ29tbWFuZChyZXN1bHQub3V0cHV0KSkge1xyXG4gICAgICAgIG5hdmlnYXRpb25Db21tYW5kUmVzdWx0ID0gcmVzdWx0Lm91dHB1dC5uYXZpZ2F0ZShyb3V0ZXIpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZmluYWxSZXN1bHQgPSByZXN1bHQ7XHJcbiAgICAgICAgaWYgKCFyZXN1bHQuY29tcGxldGVkKSB7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQub3V0cHV0IGluc3RhbmNlb2YgRXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihyZXN1bHQub3V0cHV0LnRvU3RyaW5nKCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc3RvcmVQcmV2aW91c0xvY2F0aW9uKHJvdXRlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuYXZpZ2F0aW9uQ29tbWFuZFJlc3VsdClcclxuICAgICAgICAudGhlbihfID0+IHJvdXRlci5fZGVxdWV1ZUluc3RydWN0aW9uKGluc3RydWN0aW9uQ291bnQgKyAxKSlcclxuICAgICAgICAudGhlbihpbm5lclJlc3VsdCA9PiBmaW5hbFJlc3VsdCB8fCBpbm5lclJlc3VsdCB8fCByZXN1bHQpO1xyXG59O1xyXG5jb25zdCByZXNvbHZlSW5zdHJ1Y3Rpb24gPSAoaW5zdHJ1Y3Rpb24sIHJlc3VsdCwgaXNJbm5lckluc3RydWN0aW9uLCByb3V0ZXIpID0+IHtcclxuICAgIGluc3RydWN0aW9uLnJlc29sdmUocmVzdWx0KTtcclxuICAgIGxldCBldmVudEFnZ3JlZ2F0b3IgPSByb3V0ZXIuZXZlbnRzO1xyXG4gICAgbGV0IGV2ZW50QXJncyA9IHsgaW5zdHJ1Y3Rpb24sIHJlc3VsdCB9O1xyXG4gICAgaWYgKCFpc0lubmVySW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICByb3V0ZXIuaXNOYXZpZ2F0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzRXhwbGljaXROYXZpZ2F0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzRXhwbGljaXROYXZpZ2F0aW9uQmFjayA9IGZhbHNlO1xyXG4gICAgICAgIHJvdXRlci5pc05hdmlnYXRpbmdGaXJzdCA9IGZhbHNlO1xyXG4gICAgICAgIHJvdXRlci5pc05hdmlnYXRpbmdOZXcgPSBmYWxzZTtcclxuICAgICAgICByb3V0ZXIuaXNOYXZpZ2F0aW5nUmVmcmVzaCA9IGZhbHNlO1xyXG4gICAgICAgIHJvdXRlci5pc05hdmlnYXRpbmdGb3J3YXJkID0gZmFsc2U7XHJcbiAgICAgICAgcm91dGVyLmlzTmF2aWdhdGluZ0JhY2sgPSBmYWxzZTtcclxuICAgICAgICByb3V0ZXIuY291bGREZWFjdGl2YXRlID0gZmFsc2U7XHJcbiAgICAgICAgbGV0IGV2ZW50TmFtZTtcclxuICAgICAgICBpZiAocmVzdWx0Lm91dHB1dCBpbnN0YW5jZW9mIEVycm9yKSB7XHJcbiAgICAgICAgICAgIGV2ZW50TmFtZSA9IFwicm91dGVyOm5hdmlnYXRpb246ZXJyb3JcIiAvKiBFcnJvciAqLztcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoIXJlc3VsdC5jb21wbGV0ZWQpIHtcclxuICAgICAgICAgICAgZXZlbnROYW1lID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjpjYW5jZWxlZFwiIC8qIENhbmNlbGVkICovO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgbGV0IHF1ZXJ5U3RyaW5nID0gaW5zdHJ1Y3Rpb24ucXVlcnlTdHJpbmcgPyAoJz8nICsgaW5zdHJ1Y3Rpb24ucXVlcnlTdHJpbmcpIDogJyc7XHJcbiAgICAgICAgICAgIHJvdXRlci5oaXN0b3J5LnByZXZpb3VzTG9jYXRpb24gPSBpbnN0cnVjdGlvbi5mcmFnbWVudCArIHF1ZXJ5U3RyaW5nO1xyXG4gICAgICAgICAgICBldmVudE5hbWUgPSBcInJvdXRlcjpuYXZpZ2F0aW9uOnN1Y2Nlc3NcIiAvKiBTdWNjZXNzICovO1xyXG4gICAgICAgIH1cclxuICAgICAgICBldmVudEFnZ3JlZ2F0b3IucHVibGlzaChldmVudE5hbWUsIGV2ZW50QXJncyk7XHJcbiAgICAgICAgZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goXCJyb3V0ZXI6bmF2aWdhdGlvbjpjb21wbGV0ZVwiIC8qIENvbXBsZXRlICovLCBldmVudEFyZ3MpO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgZXZlbnRBZ2dyZWdhdG9yLnB1Ymxpc2goXCJyb3V0ZXI6bmF2aWdhdGlvbjpjaGlsZDpjb21wbGV0ZVwiIC8qIENoaWxkQ29tcGxldGUgKi8sIGV2ZW50QXJncyk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG59O1xyXG5jb25zdCByZXN0b3JlUHJldmlvdXNMb2NhdGlvbiA9IChyb3V0ZXIpID0+IHtcclxuICAgIGxldCBwcmV2aW91c0xvY2F0aW9uID0gcm91dGVyLmhpc3RvcnkucHJldmlvdXNMb2NhdGlvbjtcclxuICAgIGlmIChwcmV2aW91c0xvY2F0aW9uKSB7XHJcbiAgICAgICAgcm91dGVyLm5hdmlnYXRlKHByZXZpb3VzTG9jYXRpb24sIHsgdHJpZ2dlcjogZmFsc2UsIHJlcGxhY2U6IHRydWUgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmIChyb3V0ZXIuZmFsbGJhY2tSb3V0ZSkge1xyXG4gICAgICAgIHJvdXRlci5uYXZpZ2F0ZShyb3V0ZXIuZmFsbGJhY2tSb3V0ZSwgeyB0cmlnZ2VyOiB0cnVlLCByZXBsYWNlOiB0cnVlIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdSb3V0ZXIgbmF2aWdhdGlvbiBmYWlsZWQsIGFuZCBubyBwcmV2aW91cyBsb2NhdGlvbiBvciBmYWxsYmFja1JvdXRlIGNvdWxkIGJlIHJlc3RvcmVkLicpO1xyXG4gICAgfVxyXG59O1xuXG4vKipcclxuKiBUaGUgc3RhdHVzIG9mIGEgUGlwZWxpbmUuXHJcbiovXHJcbnZhciBQaXBlbGluZVN0YXR1cztcclxuKGZ1bmN0aW9uIChQaXBlbGluZVN0YXR1cykge1xyXG4gICAgUGlwZWxpbmVTdGF0dXNbXCJDb21wbGV0ZWRcIl0gPSBcImNvbXBsZXRlZFwiO1xyXG4gICAgUGlwZWxpbmVTdGF0dXNbXCJDYW5jZWxlZFwiXSA9IFwiY2FuY2VsZWRcIjtcclxuICAgIFBpcGVsaW5lU3RhdHVzW1wiUmVqZWN0ZWRcIl0gPSBcInJlamVjdGVkXCI7XHJcbiAgICBQaXBlbGluZVN0YXR1c1tcIlJ1bm5pbmdcIl0gPSBcInJ1bm5pbmdcIjtcclxufSkoUGlwZWxpbmVTdGF0dXMgfHwgKFBpcGVsaW5lU3RhdHVzID0ge30pKTtcblxuLyoqXHJcbiAqIEEgbGlzdCBvZiBrbm93biByb3V0ZXIgZXZlbnRzIHVzZWQgYnkgdGhlIEF1cmVsaWEgcm91dGVyXHJcbiAqIHRvIHNpZ25hbCB0aGUgcGlwZWxpbmUgaGFzIGNvbWUgdG8gYSBjZXJ0YWluIHN0YXRlXHJcbiAqL1xyXG4vLyBjb25zdCBlbnVtIGlzIHByZXNlcnZlZCBpbiB0c2NvbmZpZ1xyXG52YXIgUm91dGVyRXZlbnQ7XHJcbihmdW5jdGlvbiAoUm91dGVyRXZlbnQpIHtcclxuICAgIFJvdXRlckV2ZW50W1wiUHJvY2Vzc2luZ1wiXSA9IFwicm91dGVyOm5hdmlnYXRpb246cHJvY2Vzc2luZ1wiO1xyXG4gICAgUm91dGVyRXZlbnRbXCJFcnJvclwiXSA9IFwicm91dGVyOm5hdmlnYXRpb246ZXJyb3JcIjtcclxuICAgIFJvdXRlckV2ZW50W1wiQ2FuY2VsZWRcIl0gPSBcInJvdXRlcjpuYXZpZ2F0aW9uOmNhbmNlbGVkXCI7XHJcbiAgICBSb3V0ZXJFdmVudFtcIkNvbXBsZXRlXCJdID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjpjb21wbGV0ZVwiO1xyXG4gICAgUm91dGVyRXZlbnRbXCJTdWNjZXNzXCJdID0gXCJyb3V0ZXI6bmF2aWdhdGlvbjpzdWNjZXNzXCI7XHJcbiAgICBSb3V0ZXJFdmVudFtcIkNoaWxkQ29tcGxldGVcIl0gPSBcInJvdXRlcjpuYXZpZ2F0aW9uOmNoaWxkOmNvbXBsZXRlXCI7XHJcbn0pKFJvdXRlckV2ZW50IHx8IChSb3V0ZXJFdmVudCA9IHt9KSk7XG5cbi8qKlxyXG4gKiBBdmFpbGFibGUgcGlwZWxpbmUgc2xvdCBuYW1lcyB0byBpbnNlcnQgaW50ZXJjZXB0b3IgaW50byByb3V0ZXIgcGlwZWxpbmVcclxuICovXHJcbi8vIGNvbnN0IGVudW0gaXMgcHJlc2VydmVkIGluIHRzY29uZmlnXHJcbnZhciBQaXBlbGluZVNsb3ROYW1lO1xyXG4oZnVuY3Rpb24gKFBpcGVsaW5lU2xvdE5hbWUpIHtcclxuICAgIC8qKlxyXG4gICAgICogQXV0aG9yaXphdGlvbiBzbG90LiBJbnZva2VkIGVhcmx5IGluIHRoZSBwaXBlbGluZSxcclxuICAgICAqIGJlZm9yZSBgY2FuQWN0aXZhdGVgIGhvb2sgb2YgaW5jb21pbmcgcm91dGVcclxuICAgICAqL1xyXG4gICAgUGlwZWxpbmVTbG90TmFtZVtcIkF1dGhvcml6ZVwiXSA9IFwiYXV0aG9yaXplXCI7XHJcbiAgICAvKipcclxuICAgICAqIFByZS1hY3RpdmF0aW9uIHNsb3QuIEludm9rZWQgZWFybHkgaW4gdGhlIHBpcGVsaW5lLFxyXG4gICAgICogSW52b2tlZCB0aW1pbmc6XHJcbiAgICAgKiAgIC0gYWZ0ZXIgQXV0aG9yaXphdGlvbiBzbG90XHJcbiAgICAgKiAgIC0gYWZ0ZXIgY2FuQWN0aXZhdGUgaG9vayBvbiBuZXcgdmlldyBtb2RlbFxyXG4gICAgICogICAtIGJlZm9yZSBkZWFjdGl2YXRlIGhvb2sgb24gb2xkIHZpZXcgbW9kZWxcclxuICAgICAqICAgLSBiZWZvcmUgYWN0aXZhdGUgaG9vayBvbiBuZXcgdmlldyBtb2RlbFxyXG4gICAgICovXHJcbiAgICBQaXBlbGluZVNsb3ROYW1lW1wiUHJlQWN0aXZhdGVcIl0gPSBcInByZUFjdGl2YXRlXCI7XHJcbiAgICAvKipcclxuICAgICAqIFByZS1yZW5kZXIgc2xvdC4gSW52b2tlZCBsYXRlciBpbiB0aGUgcGlwZWxpbmVcclxuICAgICAqIEludm9rY2F0aW9uIHRpbWluZzpcclxuICAgICAqICAgLSBhZnRlciBhY3RpdmF0ZSBob29rIG9uIG5ldyB2aWV3IG1vZGVsXHJcbiAgICAgKiAgIC0gYmVmb3JlIGNvbW1pdCBzdGVwIG9uIG5ldyBuYXZpZ2F0aW9uIGluc3RydWN0aW9uXHJcbiAgICAgKi9cclxuICAgIFBpcGVsaW5lU2xvdE5hbWVbXCJQcmVSZW5kZXJcIl0gPSBcInByZVJlbmRlclwiO1xyXG4gICAgLyoqXHJcbiAgICAgKiBQb3N0LXJlbmRlciBzbG90LiBJbnZva2VkIGxhc3QgaW4gdGhlIHBpcGVsaW5lXHJcbiAgICAgKi9cclxuICAgIFBpcGVsaW5lU2xvdE5hbWVbXCJQb3N0UmVuZGVyXCJdID0gXCJwb3N0UmVuZGVyXCI7XHJcbn0pKFBpcGVsaW5lU2xvdE5hbWUgfHwgKFBpcGVsaW5lU2xvdE5hbWUgPSB7fSkpO1xuXG5leHBvcnQgeyBBY3RpdmF0ZU5leHRTdGVwLCBBcHBSb3V0ZXIsIEJ1aWxkTmF2aWdhdGlvblBsYW5TdGVwLCBDYW5BY3RpdmF0ZU5leHRTdGVwLCBDYW5EZWFjdGl2YXRlUHJldmlvdXNTdGVwLCBDb21taXRDaGFuZ2VzU3RlcCwgRGVhY3RpdmF0ZVByZXZpb3VzU3RlcCwgTG9hZFJvdXRlU3RlcCwgTmF2TW9kZWwsIE5hdmlnYXRpb25JbnN0cnVjdGlvbiwgUGlwZWxpbmUsIFBpcGVsaW5lUHJvdmlkZXIsIFBpcGVsaW5lU2xvdE5hbWUsIFBpcGVsaW5lU3RhdHVzLCBSZWRpcmVjdCwgUmVkaXJlY3RUb1JvdXRlLCBSb3V0ZUxvYWRlciwgUm91dGVyLCBSb3V0ZXJDb25maWd1cmF0aW9uLCBSb3V0ZXJFdmVudCwgYWN0aXZhdGlvblN0cmF0ZWd5LCBpc05hdmlnYXRpb25Db21tYW5kIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJlbGlhLXJvdXRlci5qcy5tYXBcblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vIC4vfi9hdXJlbGlhLXJvdXRlci9kaXN0L2VzMjAxNS9hdXJlbGlhLXJvdXRlci5qc1xuLy8gbW9kdWxlIGlkID0gYXVyZWxpYS1yb3V0ZXJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiaW1wb3J0IHsgQmVoYXZpb3JJbnN0cnVjdGlvbiwgQmluZGluZ0xhbmd1YWdlIH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcbmltcG9ydCB7IGNhbWVsQ2FzZSwgU1ZHQW5hbHl6ZXIsIGJpbmRpbmdNb2RlLCBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QsIGNvbm5lY3RhYmxlLCBzb3VyY2VDb250ZXh0LCBCaW5kaW5nRXhwcmVzc2lvbiwgTGlzdGVuZXJFeHByZXNzaW9uLCBkZWxlZ2F0aW9uU3RyYXRlZ3ksIENhbGxFeHByZXNzaW9uLCBQYXJzZXIsIE9ic2VydmVyTG9jYXRvciwgRXZlbnRNYW5hZ2VyLCBOYW1lRXhwcmVzc2lvbiwgTGl0ZXJhbFN0cmluZyB9IGZyb20gJ2F1cmVsaWEtYmluZGluZyc7XG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoYi5oYXNPd25Qcm9wZXJ0eShwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG4gICAgZnVuY3Rpb24gX18oKSB7IHRoaXMuY29uc3RydWN0b3IgPSBkOyB9XHJcbiAgICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9fZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcclxuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XHJcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xyXG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcclxuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XHJcbn1cblxudmFyIEF0dHJpYnV0ZU1hcCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBBdHRyaWJ1dGVNYXAoc3ZnKSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5hbGxFbGVtZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5zdmcgPSBzdmc7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnYWNjZXNza2V5JywgJ2FjY2Vzc0tleScpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ2NvbnRlbnRlZGl0YWJsZScsICdjb250ZW50RWRpdGFibGUnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCd0YWJpbmRleCcsICd0YWJJbmRleCcpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3RleHRjb250ZW50JywgJ3RleHRDb250ZW50Jyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlclVuaXZlcnNhbCgnaW5uZXJodG1sJywgJ2lubmVySFRNTCcpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXJVbml2ZXJzYWwoJ3Njcm9sbHRvcCcsICdzY3JvbGxUb3AnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdzY3JvbGxsZWZ0JywgJ3Njcm9sbExlZnQnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyVW5pdmVyc2FsKCdyZWFkb25seScsICdyZWFkT25seScpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoJ2xhYmVsJywgJ2ZvcicsICdodG1sRm9yJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcignaW1nJywgJ3VzZW1hcCcsICd1c2VNYXAnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdtYXhsZW5ndGgnLCAnbWF4TGVuZ3RoJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnbWlubGVuZ3RoJywgJ21pbkxlbmd0aCcpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ2Zvcm1hY3Rpb24nLCAnZm9ybUFjdGlvbicpO1xyXG4gICAgICAgIHRoaXMucmVnaXN0ZXIoJ2lucHV0JywgJ2Zvcm1lbmN0eXBlJywgJ2Zvcm1FbmNUeXBlJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybW1ldGhvZCcsICdmb3JtTWV0aG9kJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcignaW5wdXQnLCAnZm9ybW5vdmFsaWRhdGUnLCAnZm9ybU5vVmFsaWRhdGUnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCdpbnB1dCcsICdmb3JtdGFyZ2V0JywgJ2Zvcm1UYXJnZXQnKTtcclxuICAgICAgICB0aGlzLnJlZ2lzdGVyKCd0ZXh0YXJlYScsICdtYXhsZW5ndGgnLCAnbWF4TGVuZ3RoJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcigndGQnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcigndGQnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcigndGgnLCAncm93c3BhbicsICdyb3dTcGFuJyk7XHJcbiAgICAgICAgdGhpcy5yZWdpc3RlcigndGgnLCAnY29sc3BhbicsICdjb2xTcGFuJyk7XHJcbiAgICB9XHJcbiAgICBBdHRyaWJ1dGVNYXAucHJvdG90eXBlLnJlZ2lzdGVyID0gZnVuY3Rpb24gKGVsZW1lbnROYW1lLCBhdHRyaWJ1dGVOYW1lLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICBlbGVtZW50TmFtZSA9IGVsZW1lbnROYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgICAgYXR0cmlidXRlTmFtZSA9IGF0dHJpYnV0ZU5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICB2YXIgZWxlbWVudCA9IHRoaXMuZWxlbWVudHNbZWxlbWVudE5hbWVdID0gKHRoaXMuZWxlbWVudHNbZWxlbWVudE5hbWVdIHx8IE9iamVjdC5jcmVhdGUobnVsbCkpO1xyXG4gICAgICAgIGVsZW1lbnRbYXR0cmlidXRlTmFtZV0gPSBwcm9wZXJ0eU5hbWU7XHJcbiAgICB9O1xyXG4gICAgQXR0cmlidXRlTWFwLnByb3RvdHlwZS5yZWdpc3RlclVuaXZlcnNhbCA9IGZ1bmN0aW9uIChhdHRyaWJ1dGVOYW1lLCBwcm9wZXJ0eU5hbWUpIHtcclxuICAgICAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHRoaXMuYWxsRWxlbWVudHNbYXR0cmlidXRlTmFtZV0gPSBwcm9wZXJ0eU5hbWU7XHJcbiAgICB9O1xyXG4gICAgQXR0cmlidXRlTWFwLnByb3RvdHlwZS5tYXAgPSBmdW5jdGlvbiAoZWxlbWVudE5hbWUsIGF0dHJpYnV0ZU5hbWUpIHtcclxuICAgICAgICBpZiAodGhpcy5zdmcuaXNTdGFuZGFyZFN2Z0F0dHJpYnV0ZShlbGVtZW50TmFtZSwgYXR0cmlidXRlTmFtZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZU5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsZW1lbnROYW1lID0gZWxlbWVudE5hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIHZhciBlbGVtZW50ID0gdGhpcy5lbGVtZW50c1tlbGVtZW50TmFtZV07XHJcbiAgICAgICAgaWYgKGVsZW1lbnQgIT09IHVuZGVmaW5lZCAmJiBhdHRyaWJ1dGVOYW1lIGluIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGVsZW1lbnRbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhdHRyaWJ1dGVOYW1lIGluIHRoaXMuYWxsRWxlbWVudHMpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWxsRWxlbWVudHNbYXR0cmlidXRlTmFtZV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICgvKD86XmRhdGEtKXwoPzpeYXJpYS0pfDovLnRlc3QoYXR0cmlidXRlTmFtZSkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGF0dHJpYnV0ZU5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBjYW1lbENhc2UoYXR0cmlidXRlTmFtZSk7XHJcbiAgICB9O1xyXG4gICAgQXR0cmlidXRlTWFwLmluamVjdCA9IFtTVkdBbmFseXplcl07XHJcbiAgICByZXR1cm4gQXR0cmlidXRlTWFwO1xyXG59KCkpO1xuXG52YXIgSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbihvYnNlcnZlckxvY2F0b3IsIHRhcmdldFByb3BlcnR5LCBwYXJ0cywgbW9kZSwgbG9va3VwRnVuY3Rpb25zLCBhdHRyaWJ1dGUpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcclxuICAgICAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XHJcbiAgICAgICAgdGhpcy5wYXJ0cyA9IHBhcnRzO1xyXG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XHJcbiAgICAgICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGUgPSB0aGlzLmF0dHJUb1JlbW92ZSA9IGF0dHJpYnV0ZTtcclxuICAgICAgICB0aGlzLmRpc2NyZXRlID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICBJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiAodGFyZ2V0KSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFydHMubGVuZ3RoID09PSAzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0YXJnZXQsIHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnBhcnRzWzFdLCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zLCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLnBhcnRzWzBdLCB0aGlzLnBhcnRzWzJdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5wYXJ0cywgdGFyZ2V0LCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uO1xyXG59KCkpO1xyXG5mdW5jdGlvbiB2YWxpZGF0ZVRhcmdldCh0YXJnZXQsIHByb3BlcnR5TmFtZSkge1xyXG4gICAgaWYgKHByb3BlcnR5TmFtZSA9PT0gJ3N0eWxlJykge1xyXG4gICAgICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nLWJpbmRpbmcnKVxyXG4gICAgICAgICAgICAuaW5mbygnSW50ZXJuZXQgRXhwbG9yZXIgZG9lcyBub3Qgc3VwcG9ydCBpbnRlcnBvbGF0aW9uIGluIFwic3R5bGVcIiBhdHRyaWJ1dGVzLiAgVXNlIHRoZSBzdHlsZSBhdHRyaWJ1dGVcXCdzIGFsaWFzLCBcImNzc1wiIGluc3RlYWQuJyk7XHJcbiAgICB9XHJcbiAgICBlbHNlIGlmICh0YXJnZXQucGFyZW50RWxlbWVudCAmJiB0YXJnZXQucGFyZW50RWxlbWVudC5ub2RlTmFtZSA9PT0gJ1RFWFRBUkVBJyAmJiBwcm9wZXJ0eU5hbWUgPT09ICd0ZXh0Q29udGVudCcpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludGVycG9sYXRpb24gYmluZGluZyBjYW5ub3QgYmUgdXNlZCBpbiB0aGUgY29udGVudCBvZiBhIHRleHRhcmVhIGVsZW1lbnQuICBVc2UgPHRleHRhcmVhIHZhbHVlLmJpbmQ9XCJleHByZXNzaW9uXCI+PC90ZXh0YXJlYT4gaW5zdGVhZC4nKTtcclxuICAgIH1cclxufVxyXG52YXIgSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSW50ZXJwb2xhdGlvbkJpbmRpbmcob2JzZXJ2ZXJMb2NhdG9yLCBwYXJ0cywgdGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSwgbW9kZSwgbG9va3VwRnVuY3Rpb25zKSB7XHJcbiAgICAgICAgdmFsaWRhdGVUYXJnZXQodGFyZ2V0LCB0YXJnZXRQcm9wZXJ0eSk7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XHJcbiAgICAgICAgdGhpcy5wYXJ0cyA9IHBhcnRzO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xyXG4gICAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcclxuICAgICAgICB0aGlzLnRhcmdldEFjY2Vzc29yID0gb2JzZXJ2ZXJMb2NhdG9yLmdldEFjY2Vzc29yKHRhcmdldCwgdGFyZ2V0UHJvcGVydHkpO1xyXG4gICAgICAgIHRoaXMubW9kZSA9IG1vZGU7XHJcbiAgICAgICAgdGhpcy5sb29rdXBGdW5jdGlvbnMgPSBsb29rdXBGdW5jdGlvbnM7XHJcbiAgICB9XHJcbiAgICBJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAnJztcclxuICAgICAgICAgICAgdmFyIHBhcnRzID0gdGhpcy5wYXJ0cztcclxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gcGFydHMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgdmFsdWUgKz0gKGkgJSAyID09PSAwID8gcGFydHNbaV0gOiB0aGlzW1wiY2hpbGRCaW5kaW5nXCIuY29uY2F0KGkpXS52YWx1ZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy50YXJnZXRBY2Nlc3Nvci5zZXRWYWx1ZSh2YWx1ZSwgdGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0UHJvcGVydHkpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUudXBkYXRlT25lVGltZUJpbmRpbmdzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxLCBpaSA9IHRoaXMucGFydHMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikge1xyXG4gICAgICAgICAgICB2YXIgY2hpbGQgPSB0aGlzW1wiY2hpbGRCaW5kaW5nXCIuY29uY2F0KGkpXTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLm1vZGUgPT09IGJpbmRpbmdNb2RlLm9uZVRpbWUpIHtcclxuICAgICAgICAgICAgICAgIGNoaWxkLmNhbGwoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChzb3VyY2UpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNvdXJjZSA9PT0gc291cmNlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgdmFyIHBhcnRzID0gdGhpcy5wYXJ0cztcclxuICAgICAgICBmb3IgKHZhciBpID0gMSwgaWkgPSBwYXJ0cy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7XHJcbiAgICAgICAgICAgIHZhciBiaW5kaW5nID0gbmV3IENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcodGhpcywgdGhpcy5vYnNlcnZlckxvY2F0b3IsIHBhcnRzW2ldLCB0aGlzLm1vZGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICAgICAgYmluZGluZy5iaW5kKHNvdXJjZSk7XHJcbiAgICAgICAgICAgIHRoaXNbXCJjaGlsZEJpbmRpbmdcIi5jb25jYXQoaSldID0gYmluZGluZztcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pc0JvdW5kID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmludGVycG9sYXRlKCk7XHJcbiAgICB9O1xyXG4gICAgSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcclxuICAgICAgICB2YXIgcGFydHMgPSB0aGlzLnBhcnRzO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAxLCBpaSA9IHBhcnRzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHtcclxuICAgICAgICAgICAgdmFyIG5hbWVfMSA9IFwiY2hpbGRCaW5kaW5nXCIuY29uY2F0KGkpO1xyXG4gICAgICAgICAgICB0aGlzW25hbWVfMV0udW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBJbnRlcnBvbGF0aW9uQmluZGluZztcclxufSgpKTtcclxudmFyIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0YXJnZXQsIG9ic2VydmVyTG9jYXRvciwgc291cmNlRXhwcmVzc2lvbiwgbW9kZSwgbG9va3VwRnVuY3Rpb25zLCB0YXJnZXRQcm9wZXJ0eSwgbGVmdCwgcmlnaHQpIHtcclxuICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgSW50ZXJwb2xhdGlvbkJpbmRpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5wYXJlbnQgPSB0YXJnZXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2YWxpZGF0ZVRhcmdldCh0YXJnZXQsIHRhcmdldFByb3BlcnR5KTtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7XHJcbiAgICAgICAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcclxuICAgICAgICAgICAgdGhpcy50YXJnZXRBY2Nlc3NvciA9IG9ic2VydmVyTG9jYXRvci5nZXRBY2Nlc3Nvcih0YXJnZXQsIHRhcmdldFByb3BlcnR5KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XHJcbiAgICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uID0gc291cmNlRXhwcmVzc2lvbjtcclxuICAgICAgICB0aGlzLm1vZGUgPSBtb2RlO1xyXG4gICAgICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xyXG4gICAgICAgIHRoaXMubGVmdCA9IGxlZnQ7XHJcbiAgICAgICAgdGhpcy5yaWdodCA9IHJpZ2h0O1xyXG4gICAgfVxyXG4gICAgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUudXBkYXRlVGFyZ2V0ID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdmFsdWUgPSB2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkID8gJycgOiB2YWx1ZS50b1N0cmluZygpO1xyXG4gICAgICAgIGlmICh2YWx1ZSAhPT0gdGhpcy52YWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnBhcmVudCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wYXJlbnQuaW50ZXJwb2xhdGUoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGFyZ2V0QWNjZXNzb3Iuc2V0VmFsdWUodGhpcy5sZWZ0ICsgdmFsdWUgKyB0aGlzLnJpZ2h0LCB0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmF3VmFsdWUgPSB0aGlzLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zb3VyY2UsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICB0aGlzLnVwZGF0ZVRhcmdldCh0aGlzLnJhd1ZhbHVlKTtcclxuICAgICAgICBpZiAodGhpcy5tb2RlICE9PSBiaW5kaW5nTW9kZS5vbmVUaW1lKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3ZlcnNpb24rKztcclxuICAgICAgICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5yYXdWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLm9ic2VydmVBcnJheSh0aGlzLnJhd1ZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVub2JzZXJ2ZShmYWxzZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoc291cmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgdmFyIHNvdXJjZUV4cHJlc3Npb24gPSB0aGlzLnNvdXJjZUV4cHJlc3Npb247XHJcbiAgICAgICAgaWYgKHNvdXJjZUV4cHJlc3Npb24uYmluZCkge1xyXG4gICAgICAgICAgICBzb3VyY2VFeHByZXNzaW9uLmJpbmQodGhpcywgc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmF3VmFsdWUgPSBzb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgIHRoaXMudXBkYXRlVGFyZ2V0KHRoaXMucmF3VmFsdWUpO1xyXG4gICAgICAgIGlmICh0aGlzLm1vZGUgPT09IGJpbmRpbmdNb2RlLm9uZVdheSkge1xyXG4gICAgICAgICAgICBlbnF1ZXVlQmluZGluZ0Nvbm5lY3QodGhpcyk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHZhciBzb3VyY2VFeHByZXNzaW9uID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uO1xyXG4gICAgICAgIGlmIChzb3VyY2VFeHByZXNzaW9uLnVuYmluZCkge1xyXG4gICAgICAgICAgICBzb3VyY2VFeHByZXNzaW9uLnVuYmluZCh0aGlzLCB0aGlzLnNvdXJjZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnZhbHVlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnJhd1ZhbHVlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnVub2JzZXJ2ZSh0cnVlKTtcclxuICAgIH07XHJcbiAgICBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKGV2YWx1YXRlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZXZhbHVhdGUpIHtcclxuICAgICAgICAgICAgdGhpcy5yYXdWYWx1ZSA9IHRoaXMuc291cmNlRXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNvdXJjZSwgdGhpcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZVRhcmdldCh0aGlzLnJhd1ZhbHVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmNvbm5lY3QodGhpcywgdGhpcy5zb3VyY2UpO1xyXG4gICAgICAgIGlmICh0aGlzLnJhd1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgdGhpcy5vYnNlcnZlQXJyYXkodGhpcy5yYXdWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENoaWxkSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjb25uZWN0YWJsZSgpXHJcbiAgICBdLCBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nKTtcclxuICAgIHJldHVybiBDaGlsZEludGVycG9sYXRpb25CaW5kaW5nO1xyXG59KCkpO1xuXG52YXIgTGV0RXhwcmVzc2lvbiA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBMZXRFeHByZXNzaW9uKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHNvdXJjZUV4cHJlc3Npb24sIGxvb2t1cEZ1bmN0aW9ucywgdG9CaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMub2JzZXJ2ZXJMb2NhdG9yID0gb2JzZXJ2ZXJMb2NhdG9yO1xyXG4gICAgICAgIHRoaXMuc291cmNlRXhwcmVzc2lvbiA9IHNvdXJjZUV4cHJlc3Npb247XHJcbiAgICAgICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xyXG4gICAgICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xyXG4gICAgICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XHJcbiAgICB9XHJcbiAgICBMZXRFeHByZXNzaW9uLnByb3RvdHlwZS5jcmVhdGVCaW5kaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBuZXcgTGV0QmluZGluZyh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5zb3VyY2VFeHByZXNzaW9uLCB0aGlzLnRhcmdldFByb3BlcnR5LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucywgdGhpcy50b0JpbmRpbmdDb250ZXh0KTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTGV0RXhwcmVzc2lvbjtcclxufSgpKTtcclxudmFyIExldEJpbmRpbmcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTGV0QmluZGluZyhvYnNlcnZlckxvY2F0b3IsIHNvdXJjZUV4cHJlc3Npb24sIHRhcmdldFByb3BlcnR5LCBsb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcclxuICAgICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24gPSBzb3VyY2VFeHByZXNzaW9uO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0UHJvcGVydHkgPSB0YXJnZXRQcm9wZXJ0eTtcclxuICAgICAgICB0aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IGxvb2t1cEZ1bmN0aW9ucztcclxuICAgICAgICB0aGlzLnNvdXJjZSA9IG51bGw7XHJcbiAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XHJcbiAgICB9XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS51cGRhdGVUYXJnZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XHJcbiAgICAgICAgdGhpcy50YXJnZXRbdGhpcy50YXJnZXRQcm9wZXJ0eV0gPSB2YWx1ZTtcclxuICAgIH07XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKGNvbnRleHQpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjb250ZXh0ID09PSBzb3VyY2VDb250ZXh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlVGFyZ2V0KCk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVW5leHBlY3RlZCBjYWxsIGNvbnRleHQgXCIuY29uY2F0KGNvbnRleHQpKTtcclxuICAgIH07XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKHNvdXJjZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc291cmNlID09PSBzb3VyY2UpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnVuYmluZCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuc291cmNlID0gc291cmNlO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy50b0JpbmRpbmdDb250ZXh0ID8gc291cmNlLmJpbmRpbmdDb250ZXh0IDogc291cmNlLm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQpIHtcclxuICAgICAgICAgICAgdGhpcy5zb3VyY2VFeHByZXNzaW9uLmJpbmQodGhpcywgc291cmNlLCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVucXVldWVCaW5kaW5nQ29ubmVjdCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmlzQm91bmQpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlzQm91bmQgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5zb3VyY2VFeHByZXNzaW9uLnVuYmluZCkge1xyXG4gICAgICAgICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24udW5iaW5kKHRoaXMsIHRoaXMuc291cmNlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudGFyZ2V0ID0gbnVsbDtcclxuICAgICAgICB0aGlzLnVub2JzZXJ2ZSh0cnVlKTtcclxuICAgIH07XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS51bm9ic2VydmUgPSBmdW5jdGlvbiAoYXJnMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTWV0aG9kIG5vdCBpbXBsZW1lbnRlZC4nKTtcclxuICAgIH07XHJcbiAgICBMZXRCaW5kaW5nLnByb3RvdHlwZS5jb25uZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0JvdW5kKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGRhdGVUYXJnZXQoKTtcclxuICAgICAgICB0aGlzLnNvdXJjZUV4cHJlc3Npb24uY29ubmVjdCh0aGlzLCB0aGlzLnNvdXJjZSk7XHJcbiAgICB9O1xyXG4gICAgTGV0QmluZGluZyA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGNvbm5lY3RhYmxlKClcclxuICAgIF0sIExldEJpbmRpbmcpO1xyXG4gICAgcmV0dXJuIExldEJpbmRpbmc7XHJcbn0oKSk7XG5cbnZhciBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24gPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHBhcnRzLCBsb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcclxuICAgICAgICB0aGlzLnRhcmdldFByb3BlcnR5ID0gdGFyZ2V0UHJvcGVydHk7XHJcbiAgICAgICAgdGhpcy5wYXJ0cyA9IHBhcnRzO1xyXG4gICAgICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xyXG4gICAgICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XHJcbiAgICB9XHJcbiAgICBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24ucHJvdG90eXBlLmNyZWF0ZUJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMZXRJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgdGhpcy5wYXJ0cywgdGhpcy5sb29rdXBGdW5jdGlvbnMsIHRoaXMudG9CaW5kaW5nQ29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIExldEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbjtcclxufSgpKTtcclxudmFyIExldEludGVycG9sYXRpb25CaW5kaW5nID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIExldEludGVycG9sYXRpb25CaW5kaW5nKG9ic2VydmVyTG9jYXRvciwgdGFyZ2V0UHJvcGVydHksIHBhcnRzLCBsb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcclxuICAgICAgICB0aGlzLnBhcnRzID0gcGFydHM7XHJcbiAgICAgICAgdGhpcy50YXJnZXRQcm9wZXJ0eSA9IHRhcmdldFByb3BlcnR5O1xyXG4gICAgICAgIHRoaXMubG9va3VwRnVuY3Rpb25zID0gbG9va3VwRnVuY3Rpb25zO1xyXG4gICAgICAgIHRoaXMudG9CaW5kaW5nQ29udGV4dCA9IHRvQmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgdGhpcy50YXJnZXQgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoc291cmNlKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zb3VyY2UgPT09IHNvdXJjZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XHJcbiAgICAgICAgdGhpcy50YXJnZXQgPSB0aGlzLnRvQmluZGluZ0NvbnRleHQgPyBzb3VyY2UuYmluZGluZ0NvbnRleHQgOiBzb3VyY2Uub3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIHRoaXMuaW50ZXJwb2xhdGlvbkJpbmRpbmcgPSB0aGlzLmNyZWF0ZUludGVycG9sYXRpb25CaW5kaW5nKCk7XHJcbiAgICAgICAgdGhpcy5pbnRlcnBvbGF0aW9uQmluZGluZy5iaW5kKHNvdXJjZSk7XHJcbiAgICB9O1xyXG4gICAgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAoIXRoaXMuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaXNCb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuc291cmNlID0gbnVsbDtcclxuICAgICAgICB0aGlzLnRhcmdldCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5pbnRlcnBvbGF0aW9uQmluZGluZy51bmJpbmQoKTtcclxuICAgICAgICB0aGlzLmludGVycG9sYXRpb25CaW5kaW5nID0gbnVsbDtcclxuICAgIH07XHJcbiAgICBMZXRJbnRlcnBvbGF0aW9uQmluZGluZy5wcm90b3R5cGUuY3JlYXRlSW50ZXJwb2xhdGlvbkJpbmRpbmcgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMucGFydHMubGVuZ3RoID09PSAzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZyh0aGlzLnRhcmdldCwgdGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMucGFydHNbMV0sIGJpbmRpbmdNb2RlLnRvVmlldywgdGhpcy5sb29rdXBGdW5jdGlvbnMsIHRoaXMudGFyZ2V0UHJvcGVydHksIHRoaXMucGFydHNbMF0sIHRoaXMucGFydHNbMl0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IEludGVycG9sYXRpb25CaW5kaW5nKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLnBhcnRzLCB0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRQcm9wZXJ0eSwgYmluZGluZ01vZGUudG9WaWV3LCB0aGlzLmxvb2t1cEZ1bmN0aW9ucyk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIExldEludGVycG9sYXRpb25CaW5kaW5nO1xyXG59KCkpO1xuXG52YXIgU3ludGF4SW50ZXJwcmV0ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU3ludGF4SW50ZXJwcmV0ZXIocGFyc2VyLCBvYnNlcnZlckxvY2F0b3IsIGV2ZW50TWFuYWdlciwgYXR0cmlidXRlTWFwKSB7XHJcbiAgICAgICAgdGhpcy5wYXJzZXIgPSBwYXJzZXI7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XHJcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSBldmVudE1hbmFnZXI7XHJcbiAgICAgICAgdGhpcy5hdHRyaWJ1dGVNYXAgPSBhdHRyaWJ1dGVNYXA7XHJcbiAgICB9XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuaW50ZXJwcmV0ID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xyXG4gICAgICAgIGlmIChpbmZvLmNvbW1hbmQgaW4gdGhpcykge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpc1tpbmZvLmNvbW1hbmRdKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVVua25vd25Db21tYW5kKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCk7XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLmhhbmRsZVVua25vd25Db21tYW5kID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xyXG4gICAgICAgIExvZ01hbmFnZXIuZ2V0TG9nZ2VyKCd0ZW1wbGF0aW5nLWJpbmRpbmcnKS53YXJuKCdVbmtub3duIGJpbmRpbmcgY29tbWFuZC4nLCBpbmZvKTtcclxuICAgICAgICByZXR1cm4gZXhpc3RpbmdJbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuZGV0ZXJtaW5lRGVmYXVsdEJpbmRpbmdNb2RlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGF0dHJOYW1lLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHRhZ05hbWUgPSBlbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcclxuICAgICAgICBpZiAodGFnTmFtZSA9PT0gJ2lucHV0JyAmJiAoYXR0ck5hbWUgPT09ICd2YWx1ZScgfHwgYXR0ck5hbWUgPT09ICdmaWxlcycpICYmIGVsZW1lbnQudHlwZSAhPT0gJ2NoZWNrYm94JyAmJiBlbGVtZW50LnR5cGUgIT09ICdyYWRpbydcclxuICAgICAgICAgICAgfHwgdGFnTmFtZSA9PT0gJ2lucHV0JyAmJiBhdHRyTmFtZSA9PT0gJ2NoZWNrZWQnICYmIChlbGVtZW50LnR5cGUgPT09ICdjaGVja2JveCcgfHwgZWxlbWVudC50eXBlID09PSAncmFkaW8nKVxyXG4gICAgICAgICAgICB8fCAodGFnTmFtZSA9PT0gJ3RleHRhcmVhJyB8fCB0YWdOYW1lID09PSAnc2VsZWN0JykgJiYgYXR0ck5hbWUgPT09ICd2YWx1ZSdcclxuICAgICAgICAgICAgfHwgKGF0dHJOYW1lID09PSAndGV4dGNvbnRlbnQnIHx8IGF0dHJOYW1lID09PSAnaW5uZXJodG1sJykgJiYgZWxlbWVudC5jb250ZW50RWRpdGFibGUgPT09ICd0cnVlJ1xyXG4gICAgICAgICAgICB8fCBhdHRyTmFtZSA9PT0gJ3Njcm9sbHRvcCdcclxuICAgICAgICAgICAgfHwgYXR0ck5hbWUgPT09ICdzY3JvbGxsZWZ0Jykge1xyXG4gICAgICAgICAgICByZXR1cm4gYmluZGluZ01vZGUudHdvV2F5O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY29udGV4dFxyXG4gICAgICAgICAgICAmJiBhdHRyTmFtZSBpbiBjb250ZXh0LmF0dHJpYnV0ZXNcclxuICAgICAgICAgICAgJiYgY29udGV4dC5hdHRyaWJ1dGVzW2F0dHJOYW1lXVxyXG4gICAgICAgICAgICAmJiBjb250ZXh0LmF0dHJpYnV0ZXNbYXR0ck5hbWVdLmRlZmF1bHRCaW5kaW5nTW9kZSA+PSBiaW5kaW5nTW9kZS5vbmVUaW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjb250ZXh0LmF0dHJpYnV0ZXNbYXR0ck5hbWVdLmRlZmF1bHRCaW5kaW5nTW9kZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGJpbmRpbmdNb2RlLnRvVmlldztcclxuICAgIH07XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24sIGNvbnRleHQpIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSBleGlzdGluZ0luc3RydWN0aW9uIHx8IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uYXR0cmlidXRlKGluZm8uYXR0ck5hbWUpO1xyXG4gICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0gPSBuZXcgQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50LnRhZ05hbWUsIGluZm8uYXR0ck5hbWUpLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlID09PSB1bmRlZmluZWQgfHwgaW5mby5kZWZhdWx0QmluZGluZ01vZGUgPT09IG51bGxcclxuICAgICAgICAgICAgPyB0aGlzLmRldGVybWluZURlZmF1bHRCaW5kaW5nTW9kZShlbGVtZW50LCBpbmZvLmF0dHJOYW1lLCBjb250ZXh0KVxyXG4gICAgICAgICAgICA6IGluZm8uZGVmYXVsdEJpbmRpbmdNb2RlLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLnRyaWdnZXIgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvKSB7XHJcbiAgICAgICAgcmV0dXJuIG5ldyBMaXN0ZW5lckV4cHJlc3Npb24odGhpcy5ldmVudE1hbmFnZXIsIGluZm8uYXR0ck5hbWUsIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgZGVsZWdhdGlvblN0cmF0ZWd5Lm5vbmUsIHRydWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5jYXB0dXJlID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbykge1xyXG4gICAgICAgIHJldHVybiBuZXcgTGlzdGVuZXJFeHByZXNzaW9uKHRoaXMuZXZlbnRNYW5hZ2VyLCBpbmZvLmF0dHJOYW1lLCB0aGlzLnBhcnNlci5wYXJzZShpbmZvLmF0dHJWYWx1ZSksIGRlbGVnYXRpb25TdHJhdGVneS5jYXB0dXJpbmcsIHRydWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5kZWxlZ2F0ZSA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8pIHtcclxuICAgICAgICByZXR1cm4gbmV3IExpc3RlbmVyRXhwcmVzc2lvbih0aGlzLmV2ZW50TWFuYWdlciwgaW5mby5hdHRyTmFtZSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBkZWxlZ2F0aW9uU3RyYXRlZ3kuYnViYmxpbmcsIHRydWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgfTtcclxuICAgIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZS5jYWxsID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBDYWxsRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgaW5mby5hdHRyTmFtZSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlLm9wdGlvbnMgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICB2YXIgYXR0clZhbHVlID0gaW5mby5hdHRyVmFsdWU7XHJcbiAgICAgICAgdmFyIGxhbmd1YWdlID0gdGhpcy5sYW5ndWFnZTtcclxuICAgICAgICB2YXIgbmFtZSA9IG51bGw7XHJcbiAgICAgICAgdmFyIHRhcmdldCA9ICcnO1xyXG4gICAgICAgIHZhciBjdXJyZW50O1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgaW5TdHJpbmcgPSBmYWxzZTtcclxuICAgICAgICB2YXIgaW5Fc2NhcGUgPSBmYWxzZTtcclxuICAgICAgICB2YXIgZm91bmROYW1lID0gZmFsc2U7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSBhdHRyVmFsdWUubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBjdXJyZW50ID0gYXR0clZhbHVlW2ldO1xyXG4gICAgICAgICAgICBpZiAoY3VycmVudCA9PT0gJzsnICYmICFpblN0cmluZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKCFmb3VuZE5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lID0gdGhpcy5fZ2V0UHJpbWFyeVByb3BlcnR5TmFtZShyZXNvdXJjZXMsIGNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5mbyA9IGxhbmd1YWdlLmluc3BlY3RBdHRyaWJ1dGUocmVzb3VyY2VzLCAnPycsIG5hbWUsIHRhcmdldC50cmltKCkpO1xyXG4gICAgICAgICAgICAgICAgbGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBpbnN0cnVjdGlvbiwgY29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIWluc3RydWN0aW9uLmF0dHJpYnV0ZXNbaW5mby5hdHRyTmFtZV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gaW5mby5hdHRyVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAnJztcclxuICAgICAgICAgICAgICAgIG5hbWUgPSBudWxsO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYgKGN1cnJlbnQgPT09ICc6JyAmJiBuYW1lID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICBmb3VuZE5hbWUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgbmFtZSA9IHRhcmdldC50cmltKCk7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmIChjdXJyZW50ID09PSAnXFxcXCcpIHtcclxuICAgICAgICAgICAgICAgIHRhcmdldCArPSBjdXJyZW50O1xyXG4gICAgICAgICAgICAgICAgaW5Fc2NhcGUgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXQgKz0gY3VycmVudDtcclxuICAgICAgICAgICAgICAgIGlmIChuYW1lICE9PSBudWxsICYmIGluRXNjYXBlID09PSBmYWxzZSAmJiBjdXJyZW50ID09PSAnXFwnJykge1xyXG4gICAgICAgICAgICAgICAgICAgIGluU3RyaW5nID0gIWluU3RyaW5nO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluRXNjYXBlID0gZmFsc2U7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghZm91bmROYW1lKSB7XHJcbiAgICAgICAgICAgIG5hbWUgPSB0aGlzLl9nZXRQcmltYXJ5UHJvcGVydHlOYW1lKHJlc291cmNlcywgY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChuYW1lICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGluZm8gPSBsYW5ndWFnZS5pbnNwZWN0QXR0cmlidXRlKHJlc291cmNlcywgJz8nLCBuYW1lLCB0YXJnZXQudHJpbSgpKTtcclxuICAgICAgICAgICAgbGFuZ3VhZ2UuY3JlYXRlQXR0cmlidXRlSW5zdHJ1Y3Rpb24ocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBpbnN0cnVjdGlvbiwgY29udGV4dCk7XHJcbiAgICAgICAgICAgIGlmICghaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSkge1xyXG4gICAgICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IGluZm8uYXR0clZhbHVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUuX2dldFByaW1hcnlQcm9wZXJ0eU5hbWUgPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBjb250ZXh0KSB7XHJcbiAgICAgICAgdmFyIHR5cGUgPSByZXNvdXJjZXMuZ2V0QXR0cmlidXRlKGNvbnRleHQuYXR0cmlidXRlTmFtZSk7XHJcbiAgICAgICAgaWYgKHR5cGUgJiYgdHlwZS5wcmltYXJ5UHJvcGVydHkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHR5cGUucHJpbWFyeVByb3BlcnR5LmF0dHJpYnV0ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWydmb3InXSA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnQsIGluZm8sIGV4aXN0aW5nSW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICB2YXIgcGFydHM7XHJcbiAgICAgICAgdmFyIGtleVZhbHVlO1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgYXR0clZhbHVlO1xyXG4gICAgICAgIHZhciBpc0Rlc3RydWN0dXJpbmc7XHJcbiAgICAgICAgYXR0clZhbHVlID0gaW5mby5hdHRyVmFsdWU7XHJcbiAgICAgICAgaXNEZXN0cnVjdHVyaW5nID0gYXR0clZhbHVlLm1hdGNoKC9eICpbW10uK1tcXF1dLyk7XHJcbiAgICAgICAgcGFydHMgPSBpc0Rlc3RydWN0dXJpbmcgPyBhdHRyVmFsdWUuc3BsaXQoJ29mICcpIDogYXR0clZhbHVlLnNwbGl0KCcgb2YgJyk7XHJcbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCAhPT0gMikge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0luY29ycmVjdCBzeW50YXggZm9yIFwiZm9yXCIuIFRoZSBmb3JtIGlzOiBcIiRsb2NhbCBvZiAkaXRlbXNcIiBvciBcIlska2V5LCAkdmFsdWVdIG9mICRpdGVtc1wiLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgaWYgKGlzRGVzdHJ1Y3R1cmluZykge1xyXG4gICAgICAgICAgICBrZXlWYWx1ZSA9IHBhcnRzWzBdLnJlcGxhY2UoL1tbXFxdXS9nLCAnJykucmVwbGFjZSgvLC9nLCAnICcpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCkuc3BsaXQoJyAnKTtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcy5rZXkgPSBrZXlWYWx1ZVswXTtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcy52YWx1ZSA9IGtleVZhbHVlWzFdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlcy5sb2NhbCA9IHBhcnRzWzBdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzLml0ZW1zID0gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCAnaXRlbXMnLCB0aGlzLnBhcnNlci5wYXJzZShwYXJ0c1sxXSksIGJpbmRpbmdNb2RlLnRvVmlldywgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucyk7XHJcbiAgICAgICAgcmV0dXJuIGluc3RydWN0aW9uO1xyXG4gICAgfTtcclxuICAgIFN5bnRheEludGVycHJldGVyLnByb3RvdHlwZVsndHdvLXdheSddID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBCaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgYmluZGluZ01vZGUudHdvV2F5LCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIucHJvdG90eXBlWyd0by12aWV3J10gPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLmF0dHJpYnV0ZU1hcC5tYXAoZWxlbWVudC50YWdOYW1lLCBpbmZvLmF0dHJOYW1lKSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBiaW5kaW5nTW9kZS50b1ZpZXcsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGVbJ2Zyb20tdmlldyddID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgaW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbikge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUoaW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24uYXR0cmlidXRlc1tpbmZvLmF0dHJOYW1lXSA9IG5ldyBCaW5kaW5nRXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgdGhpcy5hdHRyaWJ1dGVNYXAubWFwKGVsZW1lbnQudGFnTmFtZSwgaW5mby5hdHRyTmFtZSksIHRoaXMucGFyc2VyLnBhcnNlKGluZm8uYXR0clZhbHVlKSwgYmluZGluZ01vZGUuZnJvbVZpZXcsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGVbJ29uZS10aW1lJ10gPSBmdW5jdGlvbiAocmVzb3VyY2VzLCBlbGVtZW50LCBpbmZvLCBleGlzdGluZ0luc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0gZXhpc3RpbmdJbnN0cnVjdGlvbiB8fCBCZWhhdmlvckluc3RydWN0aW9uLmF0dHJpYnV0ZShpbmZvLmF0dHJOYW1lKTtcclxuICAgICAgICBpbnN0cnVjdGlvbi5hdHRyaWJ1dGVzW2luZm8uYXR0ck5hbWVdID0gbmV3IEJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCB0aGlzLmF0dHJpYnV0ZU1hcC5tYXAoZWxlbWVudC50YWdOYW1lLCBpbmZvLmF0dHJOYW1lKSwgdGhpcy5wYXJzZXIucGFyc2UoaW5mby5hdHRyVmFsdWUpLCBiaW5kaW5nTW9kZS5vbmVUaW1lLCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICByZXR1cm4gaW5zdHJ1Y3Rpb247XHJcbiAgICB9O1xyXG4gICAgU3ludGF4SW50ZXJwcmV0ZXIuaW5qZWN0ID0gW1BhcnNlciwgT2JzZXJ2ZXJMb2NhdG9yLCBFdmVudE1hbmFnZXIsIEF0dHJpYnV0ZU1hcF07XHJcbiAgICByZXR1cm4gU3ludGF4SW50ZXJwcmV0ZXI7XHJcbn0oKSk7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUsICdvbmUtd2F5JywgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihTeW50YXhJbnRlcnByZXRlci5wcm90b3R5cGUsICd0by12aWV3JykpO1xuXG52YXIgaW5mbyA9IHt9O1xyXG52YXIgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UocGFyc2VyLCBvYnNlcnZlckxvY2F0b3IsIHN5bnRheEludGVycHJldGVyLCBhdHRyaWJ1dGVNYXApIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSBfc3VwZXIuY2FsbCh0aGlzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnBhcnNlciA9IHBhcnNlcjtcclxuICAgICAgICBfdGhpcy5vYnNlcnZlckxvY2F0b3IgPSBvYnNlcnZlckxvY2F0b3I7XHJcbiAgICAgICAgX3RoaXMuc3ludGF4SW50ZXJwcmV0ZXIgPSBzeW50YXhJbnRlcnByZXRlcjtcclxuICAgICAgICBfdGhpcy5lbXB0eVN0cmluZ0V4cHJlc3Npb24gPSBfdGhpcy5wYXJzZXIucGFyc2UoJ1xcJ1xcJycpO1xyXG4gICAgICAgIHN5bnRheEludGVycHJldGVyLmxhbmd1YWdlID0gX3RoaXM7XHJcbiAgICAgICAgX3RoaXMuYXR0cmlidXRlTWFwID0gYXR0cmlidXRlTWFwO1xyXG4gICAgICAgIF90aGlzLnRvQmluZGluZ0NvbnRleHRBdHRyID0gJ3RvLWJpbmRpbmctY29udGV4dCc7XHJcbiAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgfVxyXG4gICAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuaW5zcGVjdEF0dHJpYnV0ZSA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGVsZW1lbnROYW1lLCBhdHRyTmFtZSwgYXR0clZhbHVlKSB7XHJcbiAgICAgICAgdmFyIHBhcnRzID0gYXR0ck5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICBpbmZvLmRlZmF1bHRCaW5kaW5nTW9kZSA9IG51bGw7XHJcbiAgICAgICAgaWYgKHBhcnRzLmxlbmd0aCA9PT0gMikge1xyXG4gICAgICAgICAgICBpbmZvLmF0dHJOYW1lID0gcGFydHNbMF0udHJpbSgpO1xyXG4gICAgICAgICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgaW5mby5jb21tYW5kID0gcGFydHNbMV0udHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAoaW5mby5jb21tYW5kID09PSAncmVmJykge1xyXG4gICAgICAgICAgICAgICAgaW5mby5leHByZXNzaW9uID0gbmV3IE5hbWVFeHByZXNzaW9uKHRoaXMucGFyc2VyLnBhcnNlKGF0dHJWYWx1ZSksIGluZm8uYXR0ck5hbWUsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgaW5mby5jb21tYW5kID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIGluZm8uYXR0ck5hbWUgPSAncmVmJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGluZm8uZXhwcmVzc2lvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAoYXR0ck5hbWUgPT09ICdyZWYnKSB7XHJcbiAgICAgICAgICAgIGluZm8uYXR0ck5hbWUgPSBhdHRyTmFtZTtcclxuICAgICAgICAgICAgaW5mby5hdHRyVmFsdWUgPSBhdHRyVmFsdWU7XHJcbiAgICAgICAgICAgIGluZm8uY29tbWFuZCA9IG51bGw7XHJcbiAgICAgICAgICAgIGluZm8uZXhwcmVzc2lvbiA9IG5ldyBOYW1lRXhwcmVzc2lvbih0aGlzLnBhcnNlci5wYXJzZShhdHRyVmFsdWUpLCAnZWxlbWVudCcsIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgaW5mby5hdHRyTmFtZSA9IGF0dHJOYW1lO1xyXG4gICAgICAgICAgICBpbmZvLmF0dHJWYWx1ZSA9IGF0dHJWYWx1ZTtcclxuICAgICAgICAgICAgaW5mby5jb21tYW5kID0gbnVsbDtcclxuICAgICAgICAgICAgdmFyIGludGVycG9sYXRpb25QYXJ0cyA9IHRoaXMucGFyc2VJbnRlcnBvbGF0aW9uKHJlc291cmNlcywgYXR0clZhbHVlKTtcclxuICAgICAgICAgICAgaWYgKGludGVycG9sYXRpb25QYXJ0cyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgaW5mby5leHByZXNzaW9uID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGluZm8uZXhwcmVzc2lvbiA9IG5ldyBJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIHRoaXMuYXR0cmlidXRlTWFwLm1hcChlbGVtZW50TmFtZSwgYXR0ck5hbWUpLCBpbnRlcnBvbGF0aW9uUGFydHMsIGJpbmRpbmdNb2RlLnRvVmlldywgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbmZvO1xyXG4gICAgfTtcclxuICAgIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UucHJvdG90eXBlLmNyZWF0ZUF0dHJpYnV0ZUluc3RydWN0aW9uID0gZnVuY3Rpb24gKHJlc291cmNlcywgZWxlbWVudCwgdGhlSW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCkge1xyXG4gICAgICAgIHZhciBpbnN0cnVjdGlvbjtcclxuICAgICAgICBpZiAodGhlSW5mby5leHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIGlmICh0aGVJbmZvLmF0dHJOYW1lID09PSAncmVmJykge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoZUluZm8uZXhwcmVzc2lvbjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IGV4aXN0aW5nSW5zdHJ1Y3Rpb24gfHwgQmVoYXZpb3JJbnN0cnVjdGlvbi5hdHRyaWJ1dGUodGhlSW5mby5hdHRyTmFtZSk7XHJcbiAgICAgICAgICAgIGluc3RydWN0aW9uLmF0dHJpYnV0ZXNbdGhlSW5mby5hdHRyTmFtZV0gPSB0aGVJbmZvLmV4cHJlc3Npb247XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoZUluZm8uY29tbWFuZCkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvbiA9IHRoaXMuc3ludGF4SW50ZXJwcmV0ZXIuaW50ZXJwcmV0KHJlc291cmNlcywgZWxlbWVudCwgdGhlSW5mbywgZXhpc3RpbmdJbnN0cnVjdGlvbiwgY29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBpbnN0cnVjdGlvbjtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5jcmVhdGVMZXRFeHByZXNzaW9ucyA9IGZ1bmN0aW9uIChyZXNvdXJjZXMsIGxldEVsZW1lbnQpIHtcclxuICAgICAgICB2YXIgZXhwcmVzc2lvbnMgPSBbXTtcclxuICAgICAgICB2YXIgYXR0cmlidXRlcyA9IGxldEVsZW1lbnQuYXR0cmlidXRlcztcclxuICAgICAgICB2YXIgYXR0cjtcclxuICAgICAgICB2YXIgcGFydHM7XHJcbiAgICAgICAgdmFyIGF0dHJOYW1lO1xyXG4gICAgICAgIHZhciBhdHRyVmFsdWU7XHJcbiAgICAgICAgdmFyIGNvbW1hbmQ7XHJcbiAgICAgICAgdmFyIHRvQmluZGluZ0NvbnRleHRBdHRyID0gdGhpcy50b0JpbmRpbmdDb250ZXh0QXR0cjtcclxuICAgICAgICB2YXIgdG9CaW5kaW5nQ29udGV4dCA9IGxldEVsZW1lbnQuaGFzQXR0cmlidXRlKHRvQmluZGluZ0NvbnRleHRBdHRyKTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBhdHRyaWJ1dGVzLmxlbmd0aDsgaWkgPiBpOyArK2kpIHtcclxuICAgICAgICAgICAgYXR0ciA9IGF0dHJpYnV0ZXNbaV07XHJcbiAgICAgICAgICAgIGF0dHJOYW1lID0gYXR0ci5uYW1lO1xyXG4gICAgICAgICAgICBhdHRyVmFsdWUgPSBhdHRyLm5vZGVWYWx1ZTtcclxuICAgICAgICAgICAgcGFydHMgPSBhdHRyTmFtZS5zcGxpdCgnLicpO1xyXG4gICAgICAgICAgICBpZiAoYXR0ck5hbWUgPT09IHRvQmluZGluZ0NvbnRleHRBdHRyKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoID09PSAyKSB7XHJcbiAgICAgICAgICAgICAgICBjb21tYW5kID0gcGFydHNbMV07XHJcbiAgICAgICAgICAgICAgICBpZiAoY29tbWFuZCAhPT0gJ2JpbmQnKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgTG9nTWFuYWdlci5nZXRMb2dnZXIoJ3RlbXBsYXRpbmctYmluZGluZy1sYW5ndWFnZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC53YXJuKFwiRGV0ZWN0ZWQgaW52YWxpZCBsZXQgY29tbWFuZC4gRXhwZWN0ZWQgXFxcIlwiLmNvbmNhdChwYXJ0c1swXSwgXCIuYmluZFxcXCIsIGdpdmVuIFxcXCJcIikuY29uY2F0KGF0dHJOYW1lLCBcIlxcXCJcIikpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChuZXcgTGV0RXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgY2FtZWxDYXNlKHBhcnRzWzBdKSwgdGhpcy5wYXJzZXIucGFyc2UoYXR0clZhbHVlKSwgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgdG9CaW5kaW5nQ29udGV4dCkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgYXR0ck5hbWUgPSBjYW1lbENhc2UoYXR0ck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgcGFydHMgPSB0aGlzLnBhcnNlSW50ZXJwb2xhdGlvbihyZXNvdXJjZXMsIGF0dHJWYWx1ZSk7XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBMb2dNYW5hZ2VyLmdldExvZ2dlcigndGVtcGxhdGluZy1iaW5kaW5nLWxhbmd1YWdlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLndhcm4oXCJEZXRlY3RlZCBzdHJpbmcgbGl0ZXJhbCBpbiBsZXQgYmluZGluZ3MuIERpZCB5b3UgbWVhbiBcXFwiXCIuY29uY2F0KGF0dHJOYW1lLCBcIi5iaW5kPVwiKS5jb25jYXQoYXR0clZhbHVlLCBcIlxcXCIgb3IgXFxcIlwiKS5jb25jYXQoYXR0ck5hbWUsIFwiPSR7XCIpLmNvbmNhdChhdHRyVmFsdWUsIFwifVxcXCIgP1wiKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocGFydHMpIHtcclxuICAgICAgICAgICAgICAgICAgICBleHByZXNzaW9ucy5wdXNoKG5ldyBMZXRJbnRlcnBvbGF0aW9uQmluZGluZ0V4cHJlc3Npb24odGhpcy5vYnNlcnZlckxvY2F0b3IsIGF0dHJOYW1lLCBwYXJ0cywgcmVzb3VyY2VzLmxvb2t1cEZ1bmN0aW9ucywgdG9CaW5kaW5nQ29udGV4dCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMucHVzaChuZXcgTGV0RXhwcmVzc2lvbih0aGlzLm9ic2VydmVyTG9jYXRvciwgYXR0ck5hbWUsIG5ldyBMaXRlcmFsU3RyaW5nKGF0dHJWYWx1ZSksIHJlc291cmNlcy5sb29rdXBGdW5jdGlvbnMsIHRvQmluZGluZ0NvbnRleHQpKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbnM7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5wcm90b3R5cGUuaW5zcGVjdFRleHRDb250ZW50ID0gZnVuY3Rpb24gKHJlc291cmNlcywgdmFsdWUpIHtcclxuICAgICAgICB2YXIgcGFydHMgPSB0aGlzLnBhcnNlSW50ZXJwb2xhdGlvbihyZXNvdXJjZXMsIHZhbHVlKTtcclxuICAgICAgICBpZiAocGFydHMgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgSW50ZXJwb2xhdGlvbkJpbmRpbmdFeHByZXNzaW9uKHRoaXMub2JzZXJ2ZXJMb2NhdG9yLCAndGV4dENvbnRlbnQnLCBwYXJ0cywgYmluZGluZ01vZGUudG9WaWV3LCByZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zLCAndGV4dENvbnRlbnQnKTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlLnByb3RvdHlwZS5wYXJzZUludGVycG9sYXRpb24gPSBmdW5jdGlvbiAocmVzb3VyY2VzLCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBpID0gdmFsdWUuaW5kZXhPZignJHsnLCAwKTtcclxuICAgICAgICB2YXIgaWkgPSB2YWx1ZS5sZW5ndGg7XHJcbiAgICAgICAgdmFyIGNoYXI7XHJcbiAgICAgICAgdmFyIHBvcyA9IDA7XHJcbiAgICAgICAgdmFyIG9wZW4gPSAwO1xyXG4gICAgICAgIHZhciBxdW90ZSA9IG51bGw7XHJcbiAgICAgICAgdmFyIGludGVycG9sYXRpb25TdGFydDtcclxuICAgICAgICB2YXIgcGFydHM7XHJcbiAgICAgICAgdmFyIHBhcnRJbmRleCA9IDA7XHJcbiAgICAgICAgd2hpbGUgKGkgPj0gMCAmJiBpIDwgaWkgLSAyKSB7XHJcbiAgICAgICAgICAgIG9wZW4gPSAxO1xyXG4gICAgICAgICAgICBpbnRlcnBvbGF0aW9uU3RhcnQgPSBpO1xyXG4gICAgICAgICAgICBpICs9IDI7XHJcbiAgICAgICAgICAgIGRvIHtcclxuICAgICAgICAgICAgICAgIGNoYXIgPSB2YWx1ZVtpXTtcclxuICAgICAgICAgICAgICAgIGkrKztcclxuICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSBcIidcIiB8fCBjaGFyID09PSAnXCInKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHF1b3RlID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1b3RlID0gY2hhcjtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocXVvdGUgPT09IGNoYXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcXVvdGUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSAnXFxcXCcpIHtcclxuICAgICAgICAgICAgICAgICAgICBpKys7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAocXVvdGUgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChjaGFyID09PSAneycpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcGVuKys7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmIChjaGFyID09PSAnfScpIHtcclxuICAgICAgICAgICAgICAgICAgICBvcGVuLS07XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gd2hpbGUgKG9wZW4gPiAwICYmIGkgPCBpaSk7XHJcbiAgICAgICAgICAgIGlmIChvcGVuID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICBwYXJ0cyA9IHBhcnRzIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlW2ludGVycG9sYXRpb25TdGFydCAtIDFdID09PSAnXFxcXCcgJiYgdmFsdWVbaW50ZXJwb2xhdGlvblN0YXJ0IC0gMl0gIT09ICdcXFxcJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB2YWx1ZS5zdWJzdHJpbmcocG9zLCBpbnRlcnBvbGF0aW9uU3RhcnQgLSAxKSArIHZhbHVlLnN1YnN0cmluZyhpbnRlcnBvbGF0aW9uU3RhcnQsIGkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB0aGlzLmVtcHR5U3RyaW5nRXhwcmVzc2lvbjtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB2YWx1ZS5zdWJzdHJpbmcocG9zLCBpbnRlcnBvbGF0aW9uU3RhcnQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRJbmRleCsrO1xyXG4gICAgICAgICAgICAgICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB0aGlzLnBhcnNlci5wYXJzZSh2YWx1ZS5zdWJzdHJpbmcoaW50ZXJwb2xhdGlvblN0YXJ0ICsgMiwgaSAtIDEpKTtcclxuICAgICAgICAgICAgICAgICAgICBwYXJ0SW5kZXgrKztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHBvcyA9IGk7XHJcbiAgICAgICAgICAgICAgICBpID0gdmFsdWUuaW5kZXhPZignJHsnLCBpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChwYXJ0SW5kZXggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHBhcnRzW3BhcnRJbmRleF0gPSB2YWx1ZS5zdWJzdHIocG9zKTtcclxuICAgICAgICByZXR1cm4gcGFydHM7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ0JpbmRpbmdMYW5ndWFnZS5pbmplY3QgPSBbUGFyc2VyLCBPYnNlcnZlckxvY2F0b3IsIFN5bnRheEludGVycHJldGVyLCBBdHRyaWJ1dGVNYXBdO1xyXG4gICAgcmV0dXJuIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2U7XHJcbn0oQmluZGluZ0xhbmd1YWdlKSk7XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcclxuICAgIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJTaW5nbGV0b24oQmluZGluZ0xhbmd1YWdlLCBUZW1wbGF0aW5nQmluZGluZ0xhbmd1YWdlKTtcclxuICAgIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJBbGlhcyhCaW5kaW5nTGFuZ3VhZ2UsIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UpO1xyXG59XG5cbmV4cG9ydCB7IEF0dHJpYnV0ZU1hcCwgQ2hpbGRJbnRlcnBvbGF0aW9uQmluZGluZywgSW50ZXJwb2xhdGlvbkJpbmRpbmcsIEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbiwgTGV0QmluZGluZywgTGV0RXhwcmVzc2lvbiwgTGV0SW50ZXJwb2xhdGlvbkJpbmRpbmcsIExldEludGVycG9sYXRpb25CaW5kaW5nRXhwcmVzc2lvbiwgU3ludGF4SW50ZXJwcmV0ZXIsIFRlbXBsYXRpbmdCaW5kaW5nTGFuZ3VhZ2UsIGNvbmZpZ3VyZSB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcuanMubWFwXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmcvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmctYmluZGluZy5qc1xuLy8gbW9kdWxlIGlkID0gYXVyZWxpYS10ZW1wbGF0aW5nLWJpbmRpbmdcbi8vIG1vZHVsZSBjaHVua3MgPSAxIiwiaW1wb3J0IHsgQ29udGFpbmVyLCBpbmplY3QsIE9wdGlvbmFsIH0gZnJvbSAnYXVyZWxpYS1kZXBlbmRlbmN5LWluamVjdGlvbic7XG5pbXBvcnQgeyBET00sIEZFQVRVUkUgfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgeyBUYXNrUXVldWUgfSBmcm9tICdhdXJlbGlhLXRhc2stcXVldWUnO1xuaW1wb3J0IHsgYmluZGFibGUsIG5vVmlldywgY3VzdG9tRWxlbWVudCwgQ29tcG9zaXRpb25FbmdpbmUsIFZpZXdTbG90LCBWaWV3UmVzb3VyY2VzLCBjdXN0b21BdHRyaWJ1dGUsIHRlbXBsYXRlQ29udHJvbGxlciwgQm91bmRWaWV3RmFjdG9yeSwgVGFyZ2V0SW5zdHJ1Y3Rpb24sIEFuaW1hdG9yLCByZXNvdXJjZSwgdXNlVmlldywgdXNlU2hhZG93RE9NLCBWaWV3RW5naW5lIH0gZnJvbSAnYXVyZWxpYS10ZW1wbGF0aW5nJztcbmltcG9ydCB7IGNyZWF0ZU92ZXJyaWRlQ29udGV4dCwgYmluZGluZ01vZGUsIEJpbmRpbmdCZWhhdmlvciwgVmFsdWVDb252ZXJ0ZXIsIHNvdXJjZUNvbnRleHQsIG1lcmdlU3BsaWNlLCBPYnNlcnZlckxvY2F0b3IsIHZhbHVlQ29udmVydGVyLCBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIsIGJpbmRpbmdCZWhhdmlvciwgdGFyZ2V0Q29udGV4dCwgRXZlbnRTdWJzY3JpYmVyIH0gZnJvbSAnYXVyZWxpYS1iaW5kaW5nJztcbmltcG9ydCB7IExvYWRlciB9IGZyb20gJ2F1cmVsaWEtbG9hZGVyJztcbmltcG9ydCB7IHJlbGF0aXZlVG9GaWxlIH0gZnJvbSAnYXVyZWxpYS1wYXRoJztcbmltcG9ydCB7IG1peGluIH0gZnJvbSAnYXVyZWxpYS1tZXRhZGF0YSc7XG5pbXBvcnQgeyBnZXRMb2dnZXIgfSBmcm9tICdhdXJlbGlhLWxvZ2dpbmcnO1xuXG4vKiEgKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcclxuQ29weXJpZ2h0IChjKSBNaWNyb3NvZnQgQ29ycG9yYXRpb24uXHJcblxyXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcclxucHVycG9zZSB3aXRoIG9yIHdpdGhvdXQgZmVlIGlzIGhlcmVieSBncmFudGVkLlxyXG5cclxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxyXG5SRUdBUkQgVE8gVEhJUyBTT0ZUV0FSRSBJTkNMVURJTkcgQUxMIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFlcclxuQU5EIEZJVE5FU1MuIElOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1IgQkUgTElBQkxFIEZPUiBBTlkgU1BFQ0lBTCwgRElSRUNULFxyXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cclxuTE9TUyBPRiBVU0UsIERBVEEgT1IgUFJPRklUUywgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIE5FR0xJR0VOQ0UgT1JcclxuT1RIRVIgVE9SVElPVVMgQUNUSU9OLCBBUklTSU5HIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFIFVTRSBPUlxyXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxyXG4qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiAqL1xyXG4vKiBnbG9iYWwgUmVmbGVjdCwgUHJvbWlzZSAqL1xyXG5cclxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XHJcbiAgICBleHRlbmRTdGF0aWNzID0gT2JqZWN0LnNldFByb3RvdHlwZU9mIHx8XHJcbiAgICAgICAgKHsgX19wcm90b19fOiBbXSB9IGluc3RhbmNlb2YgQXJyYXkgJiYgZnVuY3Rpb24gKGQsIGIpIHsgZC5fX3Byb3RvX18gPSBiOyB9KSB8fFxyXG4gICAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XHJcbiAgICByZXR1cm4gZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxufTtcclxuXHJcbmZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XHJcbiAgICBpZiAodHlwZW9mIGIgIT09IFwiZnVuY3Rpb25cIiAmJiBiICE9PSBudWxsKVxyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDbGFzcyBleHRlbmRzIHZhbHVlIFwiICsgU3RyaW5nKGIpICsgXCIgaXMgbm90IGEgY29uc3RydWN0b3Igb3IgbnVsbFwiKTtcclxuICAgIGV4dGVuZFN0YXRpY3MoZCwgYik7XHJcbiAgICBmdW5jdGlvbiBfXygpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGQ7IH1cclxuICAgIGQucHJvdG90eXBlID0gYiA9PT0gbnVsbCA/IE9iamVjdC5jcmVhdGUoYikgOiAoX18ucHJvdG90eXBlID0gYi5wcm90b3R5cGUsIG5ldyBfXygpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xyXG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcclxuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XHJcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xyXG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcclxufVxuXG52YXIgQWN0aXZhdGlvblN0cmF0ZWd5O1xyXG4oZnVuY3Rpb24gKEFjdGl2YXRpb25TdHJhdGVneSkge1xyXG4gICAgQWN0aXZhdGlvblN0cmF0ZWd5W1wiSW52b2tlTGlmZWN5Y2xlXCJdID0gXCJpbnZva2UtbGlmZWN5Y2xlXCI7XHJcbiAgICBBY3RpdmF0aW9uU3RyYXRlZ3lbXCJSZXBsYWNlXCJdID0gXCJyZXBsYWNlXCI7XHJcbn0pKEFjdGl2YXRpb25TdHJhdGVneSB8fCAoQWN0aXZhdGlvblN0cmF0ZWd5ID0ge30pKTtcclxudmFyIENvbXBvc2UgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQ29tcG9zZShlbGVtZW50LCBjb250YWluZXIsIGNvbXBvc2l0aW9uRW5naW5lLCB2aWV3U2xvdCwgdmlld1Jlc291cmNlcywgdGFza1F1ZXVlKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmF0aW9uU3RyYXRlZ3kgPSBBY3RpdmF0aW9uU3RyYXRlZ3kuSW52b2tlTGlmZWN5Y2xlO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy5jb21wb3NpdGlvbkVuZ2luZSA9IGNvbXBvc2l0aW9uRW5naW5lO1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcclxuICAgICAgICB0aGlzLnZpZXdSZXNvdXJjZXMgPSB2aWV3UmVzb3VyY2VzO1xyXG4gICAgICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xyXG4gICAgICAgIHRoaXMuY3VycmVudENvbnRyb2xsZXIgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuY3VycmVudFZpZXdNb2RlbCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIH1cclxuICAgIENvbXBvc2UuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbRE9NLkVsZW1lbnQsIENvbnRhaW5lciwgQ29tcG9zaXRpb25FbmdpbmUsIFZpZXdTbG90LCBWaWV3UmVzb3VyY2VzLCBUYXNrUXVldWVdO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAob3duaW5nVmlldykge1xyXG4gICAgICAgIHRoaXMub3duaW5nVmlldyA9IG93bmluZ1ZpZXc7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIHRoaXMub3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIHZhciBjaGFuZ2VzID0gdGhpcy5jaGFuZ2VzO1xyXG4gICAgICAgIGNoYW5nZXMudmlldyA9IHRoaXMudmlldztcclxuICAgICAgICBjaGFuZ2VzLnZpZXdNb2RlbCA9IHRoaXMudmlld01vZGVsO1xyXG4gICAgICAgIGNoYW5nZXMubW9kZWwgPSB0aGlzLm1vZGVsO1xyXG4gICAgICAgIGlmICghdGhpcy5wZW5kaW5nVGFzaykge1xyXG4gICAgICAgICAgICBwcm9jZXNzQ2hhbmdlcyh0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zZS5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHZhciByZXR1cm5Ub0NhY2hlID0gdHJ1ZTtcclxuICAgICAgICB2YXIgc2tpcEFuaW1hdGlvbiA9IHRydWU7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdC5yZW1vdmVBbGwocmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbik7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zZS5wcm90b3R5cGUubW9kZWxDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIHRoaXMuY2hhbmdlcy5tb2RlbCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIHJlcXVlc3RVcGRhdGUodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgQ29tcG9zZS5wcm90b3R5cGUudmlld0NoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VzLnZpZXcgPSBuZXdWYWx1ZTtcclxuICAgICAgICByZXF1ZXN0VXBkYXRlKHRoaXMpO1xyXG4gICAgfTtcclxuICAgIENvbXBvc2UucHJvdG90eXBlLnZpZXdNb2RlbENoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgdGhpcy5jaGFuZ2VzLnZpZXdNb2RlbCA9IG5ld1ZhbHVlO1xyXG4gICAgICAgIHJlcXVlc3RVcGRhdGUodGhpcyk7XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIENvbXBvc2UucHJvdG90eXBlLCBcIm1vZGVsXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgQ29tcG9zZS5wcm90b3R5cGUsIFwidmlld1wiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIENvbXBvc2UucHJvdG90eXBlLCBcInZpZXdNb2RlbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIENvbXBvc2UucHJvdG90eXBlLCBcImFjdGl2YXRpb25TdHJhdGVneVwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIENvbXBvc2UucHJvdG90eXBlLCBcInN3YXBPcmRlclwiLCB2b2lkIDApO1xyXG4gICAgQ29tcG9zZSA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIG5vVmlldyxcclxuICAgICAgICBjdXN0b21FbGVtZW50KCdjb21wb3NlJylcclxuICAgIF0sIENvbXBvc2UpO1xyXG4gICAgcmV0dXJuIENvbXBvc2U7XHJcbn0oKSk7XHJcbmZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7XHJcbiAgICBmb3IgKHZhciBfIGluIG9iaikge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiB0cnVlO1xyXG59XHJcbmZ1bmN0aW9uIHRyeUFjdGl2YXRlVmlld01vZGVsKHZtLCBtb2RlbCkge1xyXG4gICAgaWYgKHZtICYmIHR5cGVvZiB2bS5hY3RpdmF0ZSA9PT0gJ2Z1bmN0aW9uJykge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodm0uYWN0aXZhdGUobW9kZWwpKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjcmVhdGVJbnN0cnVjdGlvbihjb21wb3NlciwgaW5zdHJ1Y3Rpb24pIHtcclxuICAgIHJldHVybiBPYmplY3QuYXNzaWduKGluc3RydWN0aW9uLCB7XHJcbiAgICAgICAgYmluZGluZ0NvbnRleHQ6IGNvbXBvc2VyLmJpbmRpbmdDb250ZXh0LFxyXG4gICAgICAgIG92ZXJyaWRlQ29udGV4dDogY29tcG9zZXIub3ZlcnJpZGVDb250ZXh0LFxyXG4gICAgICAgIG93bmluZ1ZpZXc6IGNvbXBvc2VyLm93bmluZ1ZpZXcsXHJcbiAgICAgICAgY29udGFpbmVyOiBjb21wb3Nlci5jb250YWluZXIsXHJcbiAgICAgICAgdmlld1Nsb3Q6IGNvbXBvc2VyLnZpZXdTbG90LFxyXG4gICAgICAgIHZpZXdSZXNvdXJjZXM6IGNvbXBvc2VyLnZpZXdSZXNvdXJjZXMsXHJcbiAgICAgICAgY3VycmVudENvbnRyb2xsZXI6IGNvbXBvc2VyLmN1cnJlbnRDb250cm9sbGVyLFxyXG4gICAgICAgIGhvc3Q6IGNvbXBvc2VyLmVsZW1lbnQsXHJcbiAgICAgICAgc3dhcE9yZGVyOiBjb21wb3Nlci5zd2FwT3JkZXJcclxuICAgIH0pO1xyXG59XHJcbmZ1bmN0aW9uIHByb2Nlc3NDaGFuZ2VzKGNvbXBvc2VyKSB7XHJcbiAgICB2YXIgY2hhbmdlcyA9IGNvbXBvc2VyLmNoYW5nZXM7XHJcbiAgICBjb21wb3Nlci5jaGFuZ2VzID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcclxuICAgIGlmIChuZWVkc1JlSW5pdGlhbGl6YXRpb24oY29tcG9zZXIsIGNoYW5nZXMpKSB7XHJcbiAgICAgICAgdmFyIGluc3RydWN0aW9uID0ge1xyXG4gICAgICAgICAgICB2aWV3OiBjb21wb3Nlci52aWV3LFxyXG4gICAgICAgICAgICB2aWV3TW9kZWw6IGNvbXBvc2VyLmN1cnJlbnRWaWV3TW9kZWwgfHwgY29tcG9zZXIudmlld01vZGVsLFxyXG4gICAgICAgICAgICBtb2RlbDogY29tcG9zZXIubW9kZWxcclxuICAgICAgICB9O1xyXG4gICAgICAgIGluc3RydWN0aW9uID0gT2JqZWN0LmFzc2lnbihpbnN0cnVjdGlvbiwgY2hhbmdlcyk7XHJcbiAgICAgICAgaW5zdHJ1Y3Rpb24gPSBjcmVhdGVJbnN0cnVjdGlvbihjb21wb3NlciwgaW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgIGNvbXBvc2VyLnBlbmRpbmdUYXNrID0gY29tcG9zZXIuY29tcG9zaXRpb25FbmdpbmUuY29tcG9zZShpbnN0cnVjdGlvbikudGhlbihmdW5jdGlvbiAoY29udHJvbGxlcikge1xyXG4gICAgICAgICAgICBjb21wb3Nlci5jdXJyZW50Q29udHJvbGxlciA9IGNvbnRyb2xsZXI7XHJcbiAgICAgICAgICAgIGNvbXBvc2VyLmN1cnJlbnRWaWV3TW9kZWwgPSBjb250cm9sbGVyID8gY29udHJvbGxlci52aWV3TW9kZWwgOiBudWxsO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgY29tcG9zZXIucGVuZGluZ1Rhc2sgPSB0cnlBY3RpdmF0ZVZpZXdNb2RlbChjb21wb3Nlci5jdXJyZW50Vmlld01vZGVsLCBjaGFuZ2VzLm1vZGVsKTtcclxuICAgICAgICBpZiAoIWNvbXBvc2VyLnBlbmRpbmdUYXNrKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb21wb3Nlci5wZW5kaW5nVGFzayA9IGNvbXBvc2VyLnBlbmRpbmdUYXNrXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGNvbXBsZXRlQ29tcG9zaXRpb25UYXNrKGNvbXBvc2VyKTtcclxuICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICBjb21wbGV0ZUNvbXBvc2l0aW9uVGFzayhjb21wb3Nlcik7XHJcbiAgICAgICAgdGhyb3cgcmVhc29uO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gY29tcGxldGVDb21wb3NpdGlvblRhc2soY29tcG9zZXIpIHtcclxuICAgIGNvbXBvc2VyLnBlbmRpbmdUYXNrID0gbnVsbDtcclxuICAgIGlmICghaXNFbXB0eShjb21wb3Nlci5jaGFuZ2VzKSkge1xyXG4gICAgICAgIHByb2Nlc3NDaGFuZ2VzKGNvbXBvc2VyKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiByZXF1ZXN0VXBkYXRlKGNvbXBvc2VyKSB7XHJcbiAgICBpZiAoY29tcG9zZXIucGVuZGluZ1Rhc2sgfHwgY29tcG9zZXIudXBkYXRlUmVxdWVzdGVkKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgY29tcG9zZXIudXBkYXRlUmVxdWVzdGVkID0gdHJ1ZTtcclxuICAgIGNvbXBvc2VyLnRhc2tRdWV1ZS5xdWV1ZU1pY3JvVGFzayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgY29tcG9zZXIudXBkYXRlUmVxdWVzdGVkID0gZmFsc2U7XHJcbiAgICAgICAgcHJvY2Vzc0NoYW5nZXMoY29tcG9zZXIpO1xyXG4gICAgfSk7XHJcbn1cclxuZnVuY3Rpb24gbmVlZHNSZUluaXRpYWxpemF0aW9uKGNvbXBvc2VyLCBjaGFuZ2VzKSB7XHJcbiAgICB2YXIgYWN0aXZhdGlvblN0cmF0ZWd5ID0gY29tcG9zZXIuYWN0aXZhdGlvblN0cmF0ZWd5O1xyXG4gICAgdmFyIHZtID0gY29tcG9zZXIuY3VycmVudFZpZXdNb2RlbDtcclxuICAgIGlmICh2bSAmJiB0eXBlb2Ygdm0uZGV0ZXJtaW5lQWN0aXZhdGlvblN0cmF0ZWd5ID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgYWN0aXZhdGlvblN0cmF0ZWd5ID0gdm0uZGV0ZXJtaW5lQWN0aXZhdGlvblN0cmF0ZWd5KCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gJ3ZpZXcnIGluIGNoYW5nZXNcclxuICAgICAgICB8fCAndmlld01vZGVsJyBpbiBjaGFuZ2VzXHJcbiAgICAgICAgfHwgYWN0aXZhdGlvblN0cmF0ZWd5ID09PSBBY3RpdmF0aW9uU3RyYXRlZ3kuUmVwbGFjZTtcclxufVxuXG52YXIgSWZDb3JlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIElmQ29yZSh2aWV3RmFjdG9yeSwgdmlld1Nsb3QpIHtcclxuICAgICAgICB0aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xyXG4gICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5iaW5kaW5nQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuY2FjaGUgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgSWZDb3JlLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB0aGlzLmJpbmRpbmdDb250ZXh0ID0gYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQ7XHJcbiAgICB9O1xyXG4gICAgSWZDb3JlLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMudmlldyA9PT0gbnVsbCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlldy51bmJpbmQoKTtcclxuICAgICAgICBpZiAoIXRoaXMudmlld0ZhY3RvcnkuaXNDYWNoaW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuc2hvd2luZykge1xyXG4gICAgICAgICAgICB0aGlzLnNob3dpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgdGhpcy52aWV3U2xvdC5yZW1vdmUodGhpcy52aWV3LCB0cnVlLCB0cnVlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldy5yZXR1cm5Ub0NhY2hlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlldyA9IG51bGw7XHJcbiAgICB9O1xyXG4gICAgSWZDb3JlLnByb3RvdHlwZS5fc2hvdyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5zaG93aW5nKSB7XHJcbiAgICAgICAgICAgIGlmICghdGhpcy52aWV3LmlzQm91bmQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudmlldy5iaW5kKHRoaXMuYmluZGluZ0NvbnRleHQsIHRoaXMub3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLnZpZXcgPT09IG51bGwpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3ID0gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF0aGlzLnZpZXcuaXNCb3VuZCkge1xyXG4gICAgICAgICAgICB0aGlzLnZpZXcuYmluZCh0aGlzLmJpbmRpbmdDb250ZXh0LCB0aGlzLm92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2hvd2luZyA9IHRydWU7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3QuYWRkKHRoaXMudmlldyk7XHJcbiAgICB9O1xyXG4gICAgSWZDb3JlLnByb3RvdHlwZS5faGlkZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICghdGhpcy5zaG93aW5nKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5zaG93aW5nID0gZmFsc2U7XHJcbiAgICAgICAgdmFyIHJlbW92ZWQgPSB0aGlzLnZpZXdTbG90LnJlbW92ZSh0aGlzLnZpZXcpO1xyXG4gICAgICAgIGlmIChyZW1vdmVkIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVtb3ZlZC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIF90aGlzLl91bmJpbmRWaWV3KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl91bmJpbmRWaWV3KCk7XHJcbiAgICB9O1xyXG4gICAgSWZDb3JlLnByb3RvdHlwZS5fdW5iaW5kVmlldyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgY2FjaGUgPSB0aGlzLmNhY2hlID09PSAnZmFsc2UnID8gZmFsc2UgOiAhIXRoaXMuY2FjaGU7XHJcbiAgICAgICAgdGhpcy52aWV3LnVuYmluZCgpO1xyXG4gICAgICAgIGlmICghY2FjaGUpIHtcclxuICAgICAgICAgICAgdGhpcy52aWV3ID0gbnVsbDtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIElmQ29yZTtcclxufSgpKTtcblxudmFyIElmID0gKGZ1bmN0aW9uIChfc3VwZXIpIHtcclxuICAgIF9fZXh0ZW5kcyhJZiwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIElmKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IF9zdXBlciAhPT0gbnVsbCAmJiBfc3VwZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLmNhY2hlID0gdHJ1ZTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBJZi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgX3N1cGVyLnByb3RvdHlwZS5iaW5kLmNhbGwodGhpcywgYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgaWYgKHRoaXMuY29uZGl0aW9uKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3Nob3coKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2hpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSWYucHJvdG90eXBlLmNvbmRpdGlvbkNoYW5nZWQgPSBmdW5jdGlvbiAobmV3VmFsdWUpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGUobmV3VmFsdWUpO1xyXG4gICAgfTtcclxuICAgIElmLnByb3RvdHlwZS5fdXBkYXRlID0gZnVuY3Rpb24gKHNob3cpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGlmICh0aGlzLmFuaW1hdGluZykge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBwcm9taXNlO1xyXG4gICAgICAgIGlmICh0aGlzLmVsc2VWbSkge1xyXG4gICAgICAgICAgICBwcm9taXNlID0gc2hvdyA/IHRoaXMuX3N3YXAodGhpcy5lbHNlVm0sIHRoaXMpIDogdGhpcy5fc3dhcCh0aGlzLCB0aGlzLmVsc2VWbSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBwcm9taXNlID0gc2hvdyA/IHRoaXMuX3Nob3coKSA6IHRoaXMuX2hpZGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHByb21pc2UpIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRpbmcgPSB0cnVlO1xyXG4gICAgICAgICAgICBwcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuYW5pbWF0aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBpZiAoX3RoaXMuY29uZGl0aW9uICE9PSBfdGhpcy5zaG93aW5nKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3VwZGF0ZShfdGhpcy5jb25kaXRpb24pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSWYucHJvdG90eXBlLl9zd2FwID0gZnVuY3Rpb24gKHJlbW92ZSwgYWRkKSB7XHJcbiAgICAgICAgc3dpdGNoICh0aGlzLnN3YXBPcmRlcikge1xyXG4gICAgICAgICAgICBjYXNlICdiZWZvcmUnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShhZGQuX3Nob3coKSkudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiByZW1vdmUuX2hpZGUoKTsgfSk7XHJcbiAgICAgICAgICAgIGNhc2UgJ3dpdGgnOlxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtyZW1vdmUuX2hpZGUoKSwgYWRkLl9zaG93KCldKTtcclxuICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgIHZhciBwcm9taXNlID0gcmVtb3ZlLl9oaWRlKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcHJvbWlzZSA/IHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7IHJldHVybiBhZGQuX3Nob3coKTsgfSkgOiBhZGQuX3Nob3coKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGUoeyBwcmltYXJ5UHJvcGVydHk6IHRydWUgfSlcclxuICAgIF0sIElmLnByb3RvdHlwZSwgXCJjb25kaXRpb25cIiwgdm9pZCAwKTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBJZi5wcm90b3R5cGUsIFwic3dhcE9yZGVyXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgSWYucHJvdG90eXBlLCBcImNhY2hlXCIsIHZvaWQgMCk7XHJcbiAgICBJZiA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgnaWYnKSxcclxuICAgICAgICB0ZW1wbGF0ZUNvbnRyb2xsZXIsXHJcbiAgICAgICAgaW5qZWN0KEJvdW5kVmlld0ZhY3RvcnksIFZpZXdTbG90KVxyXG4gICAgXSwgSWYpO1xyXG4gICAgcmV0dXJuIElmO1xyXG59KElmQ29yZSkpO1xuXG52YXIgRWxzZSA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoRWxzZSwgX3N1cGVyKTtcclxuICAgIGZ1bmN0aW9uIEVsc2Uodmlld0ZhY3RvcnksIHZpZXdTbG90KSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywgdmlld0ZhY3RvcnksIHZpZXdTbG90KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLl9yZWdpc3RlckluSWYoKTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBFbHNlLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICBfc3VwZXIucHJvdG90eXBlLmJpbmQuY2FsbCh0aGlzLCBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICBpZiAodGhpcy5pZlZtLmNvbmRpdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLl9oaWRlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9zaG93KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEVsc2UucHJvdG90eXBlLl9yZWdpc3RlckluSWYgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIHByZXZpb3VzID0gdGhpcy52aWV3U2xvdC5hbmNob3IucHJldmlvdXNTaWJsaW5nO1xyXG4gICAgICAgIHdoaWxlIChwcmV2aW91cyAmJiAhcHJldmlvdXMuYXUpIHtcclxuICAgICAgICAgICAgcHJldmlvdXMgPSBwcmV2aW91cy5wcmV2aW91c1NpYmxpbmc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghcHJldmlvdXMgfHwgIXByZXZpb3VzLmF1LmlmKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGZpbmQgbWF0Y2hpbmcgSWYgZm9yIEVsc2UgY3VzdG9tIGF0dHJpYnV0ZS5cIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuaWZWbSA9IHByZXZpb3VzLmF1LmlmLnZpZXdNb2RlbDtcclxuICAgICAgICB0aGlzLmlmVm0uZWxzZVZtID0gdGhpcztcclxuICAgIH07XHJcbiAgICBFbHNlID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY3VzdG9tQXR0cmlidXRlKCdlbHNlJyksXHJcbiAgICAgICAgdGVtcGxhdGVDb250cm9sbGVyLFxyXG4gICAgICAgIGluamVjdChCb3VuZFZpZXdGYWN0b3J5LCBWaWV3U2xvdClcclxuICAgIF0sIEVsc2UpO1xyXG4gICAgcmV0dXJuIEVsc2U7XHJcbn0oSWZDb3JlKSk7XG5cbnZhciBXaXRoID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFdpdGgodmlld0ZhY3RvcnksIHZpZXdTbG90KSB7XHJcbiAgICAgICAgdGhpcy52aWV3RmFjdG9yeSA9IHZpZXdGYWN0b3J5O1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QgPSB2aWV3U2xvdDtcclxuICAgICAgICB0aGlzLnBhcmVudE92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gbnVsbDtcclxuICAgIH1cclxuICAgIFdpdGgucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMucGFyZW50T3ZlcnJpZGVDb250ZXh0ID0gb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkKHRoaXMudmFsdWUpO1xyXG4gICAgfTtcclxuICAgIFdpdGgucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVPdmVycmlkZUNvbnRleHQobmV3VmFsdWUsIHRoaXMucGFyZW50T3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMudmlldztcclxuICAgICAgICBpZiAoIXZpZXcpIHtcclxuICAgICAgICAgICAgdmlldyA9IHRoaXMudmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKCk7XHJcbiAgICAgICAgICAgIHZpZXcuYmluZChuZXdWYWx1ZSwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICAgICAgdGhpcy52aWV3U2xvdC5hZGQodmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB2aWV3LmJpbmQobmV3VmFsdWUsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFdpdGgucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMudmlldztcclxuICAgICAgICB0aGlzLnBhcmVudE92ZXJyaWRlQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgaWYgKHZpZXcpIHtcclxuICAgICAgICAgICAgdmlldy51bmJpbmQoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgV2l0aCA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgnd2l0aCcpLFxyXG4gICAgICAgIHRlbXBsYXRlQ29udHJvbGxlcixcclxuICAgICAgICBpbmplY3QoQm91bmRWaWV3RmFjdG9yeSwgVmlld1Nsb3QpXHJcbiAgICBdLCBXaXRoKTtcclxuICAgIHJldHVybiBXaXRoO1xyXG59KCkpO1xuXG52YXIgb25lVGltZSA9IGJpbmRpbmdNb2RlLm9uZVRpbWU7XHJcbmZ1bmN0aW9uIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHModmlld3MsIHN0YXJ0SW5kZXgpIHtcclxuICAgIHZhciBsZW5ndGggPSB2aWV3cy5sZW5ndGg7XHJcbiAgICBpZiAoc3RhcnRJbmRleCA+IDApIHtcclxuICAgICAgICBzdGFydEluZGV4ID0gc3RhcnRJbmRleCAtIDE7XHJcbiAgICB9XHJcbiAgICBmb3IgKDsgc3RhcnRJbmRleCA8IGxlbmd0aDsgKytzdGFydEluZGV4KSB7XHJcbiAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0KHZpZXdzW3N0YXJ0SW5kZXhdLm92ZXJyaWRlQ29udGV4dCwgc3RhcnRJbmRleCwgbGVuZ3RoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgZGF0YSwgaW5kZXgsIGxlbmd0aCwga2V5KSB7XHJcbiAgICB2YXIgYmluZGluZ0NvbnRleHQgPSB7fTtcclxuICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVPdmVycmlkZUNvbnRleHQoYmluZGluZ0NvbnRleHQsIHJlcGVhdC5zY29wZS5vdmVycmlkZUNvbnRleHQpO1xyXG4gICAgaWYgKHR5cGVvZiBrZXkgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LmtleV0gPSBrZXk7XHJcbiAgICAgICAgYmluZGluZ0NvbnRleHRbcmVwZWF0LnZhbHVlXSA9IGRhdGE7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICBiaW5kaW5nQ29udGV4dFtyZXBlYXQubG9jYWxdID0gZGF0YTtcclxuICAgIH1cclxuICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dChvdmVycmlkZUNvbnRleHQsIGluZGV4LCBsZW5ndGgpO1xyXG4gICAgcmV0dXJuIG92ZXJyaWRlQ29udGV4dDtcclxufVxyXG5mdW5jdGlvbiB1cGRhdGVPdmVycmlkZUNvbnRleHQob3ZlcnJpZGVDb250ZXh0LCBpbmRleCwgbGVuZ3RoKSB7XHJcbiAgICB2YXIgZmlyc3QgPSAoaW5kZXggPT09IDApO1xyXG4gICAgdmFyIGxhc3QgPSAoaW5kZXggPT09IGxlbmd0aCAtIDEpO1xyXG4gICAgdmFyIGV2ZW4gPSBpbmRleCAlIDIgPT09IDA7XHJcbiAgICBvdmVycmlkZUNvbnRleHQuJGluZGV4ID0gaW5kZXg7XHJcbiAgICBvdmVycmlkZUNvbnRleHQuJGZpcnN0ID0gZmlyc3Q7XHJcbiAgICBvdmVycmlkZUNvbnRleHQuJGxhc3QgPSBsYXN0O1xyXG4gICAgb3ZlcnJpZGVDb250ZXh0LiRtaWRkbGUgPSAhKGZpcnN0IHx8IGxhc3QpO1xyXG4gICAgb3ZlcnJpZGVDb250ZXh0LiRvZGQgPSAhZXZlbjtcclxuICAgIG92ZXJyaWRlQ29udGV4dC4kZXZlbiA9IGV2ZW47XHJcbn1cclxuZnVuY3Rpb24gZ2V0SXRlbXNTb3VyY2VFeHByZXNzaW9uKGluc3RydWN0aW9uLCBhdHRyTmFtZSkge1xyXG4gICAgcmV0dXJuIGluc3RydWN0aW9uLmJlaGF2aW9ySW5zdHJ1Y3Rpb25zXHJcbiAgICAgICAgLmZpbHRlcihmdW5jdGlvbiAoYmkpIHsgcmV0dXJuIGJpLm9yaWdpbmFsQXR0ck5hbWUgPT09IGF0dHJOYW1lOyB9KVswXVxyXG4gICAgICAgIC5hdHRyaWJ1dGVzXHJcbiAgICAgICAgLml0ZW1zXHJcbiAgICAgICAgLnNvdXJjZUV4cHJlc3Npb247XHJcbn1cclxuZnVuY3Rpb24gdW53cmFwRXhwcmVzc2lvbihleHByZXNzaW9uKSB7XHJcbiAgICB2YXIgdW53cmFwcGVkID0gZmFsc2U7XHJcbiAgICB3aGlsZSAoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEJpbmRpbmdCZWhhdmlvcikge1xyXG4gICAgICAgIGV4cHJlc3Npb24gPSBleHByZXNzaW9uLmV4cHJlc3Npb247XHJcbiAgICB9XHJcbiAgICB3aGlsZSAoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIFZhbHVlQ29udmVydGVyKSB7XHJcbiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXhwcmVzc2lvbjtcclxuICAgICAgICB1bndyYXBwZWQgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHVud3JhcHBlZCA/IGV4cHJlc3Npb24gOiBudWxsO1xyXG59XHJcbmZ1bmN0aW9uIGlzT25lVGltZShleHByZXNzaW9uKSB7XHJcbiAgICB3aGlsZSAoZXhwcmVzc2lvbiBpbnN0YW5jZW9mIEJpbmRpbmdCZWhhdmlvcikge1xyXG4gICAgICAgIGlmIChleHByZXNzaW9uLm5hbWUgPT09ICdvbmVUaW1lJykge1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZXhwcmVzc2lvbiA9IGV4cHJlc3Npb24uZXhwcmVzc2lvbjtcclxuICAgIH1cclxuICAgIHJldHVybiBmYWxzZTtcclxufVxyXG5mdW5jdGlvbiB1cGRhdGVPbmVUaW1lQmluZGluZyhiaW5kaW5nKSB7XHJcbiAgICBpZiAoYmluZGluZy5jYWxsICYmIGJpbmRpbmcubW9kZSA9PT0gb25lVGltZSkge1xyXG4gICAgICAgIGJpbmRpbmcuY2FsbChzb3VyY2VDb250ZXh0KTtcclxuICAgIH1cclxuICAgIGVsc2UgaWYgKGJpbmRpbmcudXBkYXRlT25lVGltZUJpbmRpbmdzKSB7XHJcbiAgICAgICAgYmluZGluZy51cGRhdGVPbmVUaW1lQmluZGluZ3MoKTtcclxuICAgIH1cclxufVxyXG5mdW5jdGlvbiBpbmRleE9mKGFycmF5LCBpdGVtLCBtYXRjaGVyLCBzdGFydEluZGV4KSB7XHJcbiAgICBpZiAoIW1hdGNoZXIpIHtcclxuICAgICAgICByZXR1cm4gYXJyYXkuaW5kZXhPZihpdGVtKTtcclxuICAgIH1cclxuICAgIHZhciBsZW5ndGggPSBhcnJheS5sZW5ndGg7XHJcbiAgICBmb3IgKHZhciBpbmRleCA9IHN0YXJ0SW5kZXggfHwgMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICBpZiAobWF0Y2hlcihhcnJheVtpbmRleF0sIGl0ZW0pKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbmRleDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gLTE7XHJcbn1cblxudmFyIEFycmF5UmVwZWF0U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQXJyYXlSZXBlYXRTdHJhdGVneSgpIHtcclxuICAgIH1cclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmdldENvbGxlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uIChvYnNlcnZlckxvY2F0b3IsIGl0ZW1zKSB7XHJcbiAgICAgICAgcmV0dXJuIG9ic2VydmVyTG9jYXRvci5nZXRBcnJheU9ic2VydmVyKGl0ZW1zKTtcclxuICAgIH07XHJcbiAgICBBcnJheVJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyICRyZXBlYXQgPSByZXBlYXQ7XHJcbiAgICAgICAgdmFyIGl0ZW1zTGVuZ3RoID0gaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgIGlmICghaXRlbXMgfHwgaXRlbXNMZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgJHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhJHJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBjaGlsZHJlbiA9ICRyZXBlYXQudmlld3MoKTtcclxuICAgICAgICB2YXIgdmlld3NMZW5ndGggPSBjaGlsZHJlbi5sZW5ndGg7XHJcbiAgICAgICAgaWYgKHZpZXdzTGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3N0YW5kYXJkUHJvY2Vzc0luc3RhbmNlQ2hhbmdlZCgkcmVwZWF0LCBpdGVtcyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCRyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZHJlblNuYXBzaG90ID0gY2hpbGRyZW4uc2xpY2UoMCk7XHJcbiAgICAgICAgICAgIHZhciBpdGVtTmFtZUluQmluZGluZ0NvbnRleHQgPSAkcmVwZWF0LmxvY2FsO1xyXG4gICAgICAgICAgICB2YXIgbWF0Y2hlcl8xID0gJHJlcGVhdC5tYXRjaGVyKCk7XHJcbiAgICAgICAgICAgIHZhciBpdGVtc1ByZXZpb3VzbHlJblZpZXdzXzEgPSBbXTtcclxuICAgICAgICAgICAgdmFyIHZpZXdzVG9SZW1vdmUgPSBbXTtcclxuICAgICAgICAgICAgZm9yICh2YXIgaW5kZXggPSAwOyBpbmRleCA8IHZpZXdzTGVuZ3RoOyBpbmRleCsrKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgdmlldyA9IGNoaWxkcmVuU25hcHNob3RbaW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9sZEl0ZW0gPSB2aWV3LmJpbmRpbmdDb250ZXh0W2l0ZW1OYW1lSW5CaW5kaW5nQ29udGV4dF07XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXhPZihpdGVtcywgb2xkSXRlbSwgbWF0Y2hlcl8xKSA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3c1RvUmVtb3ZlLnB1c2godmlldyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBpdGVtc1ByZXZpb3VzbHlJblZpZXdzXzEucHVzaChvbGRJdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgdXBkYXRlVmlld3MgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgIHZhciByZW1vdmVQcm9taXNlID0gdm9pZCAwO1xyXG4gICAgICAgICAgICBpZiAoaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJlbW92ZVByb21pc2UgPSAkcmVwZWF0LnJlbW92ZVZpZXdzKHZpZXdzVG9SZW1vdmUsIHRydWUsICEkcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVWaWV3cyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpbmRleCA9IDA7IGluZGV4IDwgaXRlbXNMZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSBpdGVtc1tpbmRleF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBpbmRleE9mVmlldyA9IGluZGV4T2YoaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xLCBpdGVtLCBtYXRjaGVyXzEsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZpZXcgPSB2b2lkIDA7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleE9mVmlldyA9PT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KCRyZXBlYXQsIGl0ZW1zW2luZGV4XSwgaW5kZXgsIGl0ZW1zTGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBlYXQuaW5zZXJ0VmlldyhpbmRleCwgb3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xLnNwbGljZShpbmRleCwgMCwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChpbmRleE9mVmlldyA9PT0gaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZpZXcgPSBjaGlsZHJlbltpbmRleE9mVmlld107XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1ByZXZpb3VzbHlJblZpZXdzXzFbaW5kZXhPZlZpZXddID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldyA9IGNoaWxkcmVuW2luZGV4T2ZWaWV3XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyZXBlYXQubW92ZVZpZXcoaW5kZXhPZlZpZXcsIGluZGV4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1zUHJldmlvdXNseUluVmlld3NfMS5zcGxpY2UoaW5kZXhPZlZpZXcsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbXNQcmV2aW91c2x5SW5WaWV3c18xLnNwbGljZShpbmRleCwgMCwgdW5kZWZpbmVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0KHZpZXcub3ZlcnJpZGVDb250ZXh0LCBpbmRleCwgaXRlbXNMZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLl9pblBsYWNlUHJvY2Vzc0l0ZW1zKCRyZXBlYXQsIGl0ZW1zKTtcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVQcm9taXNlID0gJHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhJHJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlVmlld3MgPSBmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5fc3RhbmRhcmRQcm9jZXNzSW5zdGFuY2VDaGFuZ2VkKCRyZXBlYXQsIGl0ZW1zKTsgfTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAocmVtb3ZlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgICAgIHJlbW92ZVByb21pc2UudGhlbih1cGRhdGVWaWV3cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVWaWV3cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLl9pblBsYWNlUHJvY2Vzc0l0ZW1zKCRyZXBlYXQsIGl0ZW1zKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQXJyYXlSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX3N0YW5kYXJkUHJvY2Vzc0luc3RhbmNlQ2hhbmdlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gaXRlbXMubGVuZ3RoOyBpIDwgaWk7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIGl0ZW1zW2ldLCBpLCBpaSk7XHJcbiAgICAgICAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgQXJyYXlSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX2luUGxhY2VQcm9jZXNzSXRlbXMgPSBmdW5jdGlvbiAocmVwZWF0LCBpdGVtcykge1xyXG4gICAgICAgIHZhciBpdGVtc0xlbmd0aCA9IGl0ZW1zLmxlbmd0aDtcclxuICAgICAgICB2YXIgdmlld3NMZW5ndGggPSByZXBlYXQudmlld0NvdW50KCk7XHJcbiAgICAgICAgd2hpbGUgKHZpZXdzTGVuZ3RoID4gaXRlbXNMZW5ndGgpIHtcclxuICAgICAgICAgICAgdmlld3NMZW5ndGgtLTtcclxuICAgICAgICAgICAgcmVwZWF0LnJlbW92ZVZpZXcodmlld3NMZW5ndGgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGxvY2FsID0gcmVwZWF0LmxvY2FsO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlld3NMZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICB2YXIgdmlldyA9IHJlcGVhdC52aWV3KGkpO1xyXG4gICAgICAgICAgICB2YXIgbGFzdCA9IGkgPT09IGl0ZW1zTGVuZ3RoIC0gMTtcclxuICAgICAgICAgICAgdmFyIG1pZGRsZSA9IGkgIT09IDAgJiYgIWxhc3Q7XHJcbiAgICAgICAgICAgIHZhciBiaW5kaW5nQ29udGV4dCA9IHZpZXcuYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQgPSB2aWV3Lm92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICAgICAgaWYgKGJpbmRpbmdDb250ZXh0W2xvY2FsXSA9PT0gaXRlbXNbaV1cclxuICAgICAgICAgICAgICAgICYmIG92ZXJyaWRlQ29udGV4dC4kbWlkZGxlID09PSBtaWRkbGVcclxuICAgICAgICAgICAgICAgICYmIG92ZXJyaWRlQ29udGV4dC4kbGFzdCA9PT0gbGFzdCkge1xyXG4gICAgICAgICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgYmluZGluZ0NvbnRleHRbbG9jYWxdID0gaXRlbXNbaV07XHJcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dC4kbWlkZGxlID0gbWlkZGxlO1xyXG4gICAgICAgICAgICBvdmVycmlkZUNvbnRleHQuJGxhc3QgPSBsYXN0O1xyXG4gICAgICAgICAgICByZXBlYXQudXBkYXRlQmluZGluZ3Modmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAodmFyIGkgPSB2aWV3c0xlbmd0aDsgaSA8IGl0ZW1zTGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCBpdGVtc1tpXSwgaSwgaXRlbXNMZW5ndGgpO1xyXG4gICAgICAgICAgICByZXBlYXQuYWRkVmlldyhvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlTXV0YXRlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIGFycmF5LCBzcGxpY2VzKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAocmVwZWF0Ll9fcXVldWVkU3BsaWNlcykge1xyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzcGxpY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBfYSA9IHNwbGljZXNbaV0sIGluZGV4ID0gX2EuaW5kZXgsIHJlbW92ZWQgPSBfYS5yZW1vdmVkLCBhZGRlZENvdW50ID0gX2EuYWRkZWRDb3VudDtcclxuICAgICAgICAgICAgICAgIG1lcmdlU3BsaWNlKHJlcGVhdC5fX3F1ZXVlZFNwbGljZXMsIGluZGV4LCByZW1vdmVkLCBhZGRlZENvdW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXBlYXQuX19hcnJheSA9IGFycmF5LnNsaWNlKDApO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBtYXliZVByb21pc2UgPSB0aGlzLl9ydW5TcGxpY2VzKHJlcGVhdCwgYXJyYXkuc2xpY2UoMCksIHNwbGljZXMpO1xyXG4gICAgICAgIGlmIChtYXliZVByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgIHZhciBxdWV1ZWRTcGxpY2VzXzEgPSByZXBlYXQuX19xdWV1ZWRTcGxpY2VzID0gW107XHJcbiAgICAgICAgICAgIHZhciBydW5RdWV1ZWRTcGxpY2VzXzEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXF1ZXVlZFNwbGljZXNfMS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQuX19xdWV1ZWRTcGxpY2VzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdC5fX2FycmF5ID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHZhciBuZXh0UHJvbWlzZSA9IF90aGlzLl9ydW5TcGxpY2VzKHJlcGVhdCwgcmVwZWF0Ll9fYXJyYXksIHF1ZXVlZFNwbGljZXNfMSkgfHwgUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgICAgICAgICAgICBxdWV1ZWRTcGxpY2VzXzEgPSByZXBlYXQuX19xdWV1ZWRTcGxpY2VzID0gW107XHJcbiAgICAgICAgICAgICAgICBuZXh0UHJvbWlzZS50aGVuKHJ1blF1ZXVlZFNwbGljZXNfMSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIG1heWJlUHJvbWlzZS50aGVuKHJ1blF1ZXVlZFNwbGljZXNfMSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9ydW5TcGxpY2VzID0gZnVuY3Rpb24gKHJlcGVhdCwgYXJyYXksIHNwbGljZXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZW1vdmVEZWx0YSA9IDA7XHJcbiAgICAgICAgdmFyIHJtUHJvbWlzZXMgPSBbXTtcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgaWkgPSBzcGxpY2VzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgdmFyIHNwbGljZSA9IHNwbGljZXNbaV07XHJcbiAgICAgICAgICAgIHZhciByZW1vdmVkID0gc3BsaWNlLnJlbW92ZWQ7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGogPSAwLCBqaiA9IHJlbW92ZWQubGVuZ3RoOyBqIDwgamo7ICsraikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHZpZXdPclByb21pc2UgPSByZXBlYXQucmVtb3ZlVmlldyhzcGxpY2UuaW5kZXggKyByZW1vdmVEZWx0YSArIHJtUHJvbWlzZXMubGVuZ3RoLCB0cnVlKTtcclxuICAgICAgICAgICAgICAgIGlmICh2aWV3T3JQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaCh2aWV3T3JQcm9taXNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZW1vdmVEZWx0YSAtPSBzcGxpY2UuYWRkZWRDb3VudDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJtUHJvbWlzZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocm1Qcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc3BsaWNlSW5kZXhMb3cgPSBfdGhpcy5faGFuZGxlQWRkZWRTcGxpY2VzKHJlcGVhdCwgYXJyYXksIHNwbGljZXMpO1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgc3BsaWNlSW5kZXhMb3cpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIHNwbGljZUluZGV4TG93ID0gdGhpcy5faGFuZGxlQWRkZWRTcGxpY2VzKHJlcGVhdCwgYXJyYXksIHNwbGljZXMpO1xyXG4gICAgICAgIHVwZGF0ZU92ZXJyaWRlQ29udGV4dHMocmVwZWF0LnZpZXdzKCksIHNwbGljZUluZGV4TG93KTtcclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIEFycmF5UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9oYW5kbGVBZGRlZFNwbGljZXMgPSBmdW5jdGlvbiAocmVwZWF0LCBhcnJheSwgc3BsaWNlcykge1xyXG4gICAgICAgIHZhciBzcGxpY2VJbmRleDtcclxuICAgICAgICB2YXIgc3BsaWNlSW5kZXhMb3c7XHJcbiAgICAgICAgdmFyIGFycmF5TGVuZ3RoID0gYXJyYXkubGVuZ3RoO1xyXG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IHNwbGljZXMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICB2YXIgc3BsaWNlID0gc3BsaWNlc1tpXTtcclxuICAgICAgICAgICAgdmFyIGFkZEluZGV4ID0gc3BsaWNlSW5kZXggPSBzcGxpY2UuaW5kZXg7XHJcbiAgICAgICAgICAgIHZhciBlbmQgPSBzcGxpY2UuaW5kZXggKyBzcGxpY2UuYWRkZWRDb3VudDtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBzcGxpY2VJbmRleExvdyA9PT0gJ3VuZGVmaW5lZCcgfHwgc3BsaWNlSW5kZXhMb3cgPT09IG51bGwgfHwgc3BsaWNlSW5kZXhMb3cgPiBzcGxpY2UuaW5kZXgpIHtcclxuICAgICAgICAgICAgICAgIHNwbGljZUluZGV4TG93ID0gc3BsaWNlSW5kZXg7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZm9yICg7IGFkZEluZGV4IDwgZW5kOyArK2FkZEluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIGFycmF5W2FkZEluZGV4XSwgYWRkSW5kZXgsIGFycmF5TGVuZ3RoKTtcclxuICAgICAgICAgICAgICAgIHJlcGVhdC5pbnNlcnRWaWV3KGFkZEluZGV4LCBvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHNwbGljZUluZGV4TG93O1xyXG4gICAgfTtcclxuICAgIHJldHVybiBBcnJheVJlcGVhdFN0cmF0ZWd5O1xyXG59KCkpO1xuXG52YXIgTWFwUmVwZWF0U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTWFwUmVwZWF0U3RyYXRlZ3koKSB7XHJcbiAgICB9XHJcbiAgICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gKG9ic2VydmVyTG9jYXRvciwgaXRlbXMpIHtcclxuICAgICAgICByZXR1cm4gb2JzZXJ2ZXJMb2NhdG9yLmdldE1hcE9ic2VydmVyKGl0ZW1zKTtcclxuICAgIH07XHJcbiAgICBNYXBSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gKHJlcGVhdCwgaXRlbXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZW1vdmVQcm9taXNlID0gcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICBpZiAocmVtb3ZlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgcmVtb3ZlUHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKTsgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgTWFwUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcclxuICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIHZhbHVlLCBpbmRleCwgaXRlbXMuc2l6ZSwga2V5KTtcclxuICAgICAgICAgICAgcmVwZWF0LmFkZFZpZXcob3ZlcnJpZGVDb250ZXh0LmJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgICAgICArK2luZGV4O1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIE1hcFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZU11dGF0ZWQgPSBmdW5jdGlvbiAocmVwZWF0LCBtYXAsIHJlY29yZHMpIHtcclxuICAgICAgICB2YXIga2V5O1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIHZhciByZW1vdmVJbmRleDtcclxuICAgICAgICB2YXIgYWRkSW5kZXg7XHJcbiAgICAgICAgdmFyIHJlY29yZDtcclxuICAgICAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xyXG4gICAgICAgIHZhciB2aWV3T3JQcm9taXNlO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcmVjb3Jkcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHJlY29yZCA9IHJlY29yZHNbaV07XHJcbiAgICAgICAgICAgIGtleSA9IHJlY29yZC5rZXk7XHJcbiAgICAgICAgICAgIHN3aXRjaCAocmVjb3JkLnR5cGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgJ3VwZGF0ZSc6XHJcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlSW5kZXggPSB0aGlzLl9nZXRWaWV3SW5kZXhCeUtleShyZXBlYXQsIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld09yUHJvbWlzZSA9IHJlcGVhdC5yZW1vdmVWaWV3KHJlbW92ZUluZGV4LCB0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZpZXdPclByb21pc2UgaW5zdGFuY2VvZiBQcm9taXNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJtUHJvbWlzZXMucHVzaCh2aWV3T3JQcm9taXNlKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVDb250ZXh0ID0gY3JlYXRlRnVsbE92ZXJyaWRlQ29udGV4dChyZXBlYXQsIG1hcC5nZXQoa2V5KSwgcmVtb3ZlSW5kZXgsIG1hcC5zaXplLCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdC5pbnNlcnRWaWV3KHJlbW92ZUluZGV4LCBvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhZGQnOlxyXG4gICAgICAgICAgICAgICAgICAgIGFkZEluZGV4ID0gcmVwZWF0LnZpZXdDb3VudCgpIDw9IG1hcC5zaXplIC0gMSA/IHJlcGVhdC52aWV3Q291bnQoKSA6IG1hcC5zaXplIC0gMTtcclxuICAgICAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgbWFwLmdldChrZXkpLCBhZGRJbmRleCwgbWFwLnNpemUsIGtleSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0Lmluc2VydFZpZXcobWFwLnNpemUgLSAxLCBvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkZWxldGUnOlxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWNvcmQub2xkVmFsdWUgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4ID0gdGhpcy5fZ2V0Vmlld0luZGV4QnlLZXkocmVwZWF0LCBrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZpZXdPclByb21pc2UgPSByZXBlYXQucmVtb3ZlVmlldyhyZW1vdmVJbmRleCwgdHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2aWV3T3JQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBybVByb21pc2VzLnB1c2godmlld09yUHJvbWlzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnY2xlYXInOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdC5yZW1vdmVBbGxWaWV3cyh0cnVlLCAhcmVwZWF0LnZpZXdzUmVxdWlyZUxpZmVjeWNsZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChybVByb21pc2VzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgUHJvbWlzZS5hbGwocm1Qcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVPdmVycmlkZUNvbnRleHRzKHJlcGVhdC52aWV3cygpLCAwKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB1cGRhdGVPdmVycmlkZUNvbnRleHRzKHJlcGVhdC52aWV3cygpLCAwKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgTWFwUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9nZXRWaWV3SW5kZXhCeUtleSA9IGZ1bmN0aW9uIChyZXBlYXQsIGtleSkge1xyXG4gICAgICAgIHZhciBpO1xyXG4gICAgICAgIHZhciBpaTtcclxuICAgICAgICB2YXIgY2hpbGQ7XHJcbiAgICAgICAgZm9yIChpID0gMCwgaWkgPSByZXBlYXQudmlld0NvdW50KCk7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIGNoaWxkID0gcmVwZWF0LnZpZXcoaSk7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5iaW5kaW5nQ29udGV4dFtyZXBlYXQua2V5XSA9PT0ga2V5KSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBNYXBSZXBlYXRTdHJhdGVneTtcclxufSgpKTtcblxudmFyIE51bGxSZXBlYXRTdHJhdGVneSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBOdWxsUmVwZWF0U3RyYXRlZ3koKSB7XHJcbiAgICB9XHJcbiAgICBOdWxsUmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlQ2hhbmdlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUpO1xyXG4gICAgfTtcclxuICAgIE51bGxSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gKG9ic2VydmVyTG9jYXRvciwgaXRlbXMpIHtcclxuICAgIH07XHJcbiAgICByZXR1cm4gTnVsbFJlcGVhdFN0cmF0ZWd5O1xyXG59KCkpO1xuXG52YXIgTnVtYmVyUmVwZWF0U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gTnVtYmVyUmVwZWF0U3RyYXRlZ3koKSB7XHJcbiAgICB9XHJcbiAgICBOdW1iZXJSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIE51bWJlclJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5pbnN0YW5jZUNoYW5nZWQgPSBmdW5jdGlvbiAocmVwZWF0LCB2YWx1ZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHJlbW92ZVByb21pc2UgPSByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgIGlmIChyZW1vdmVQcm9taXNlIGluc3RhbmNlb2YgUHJvbWlzZSkge1xyXG4gICAgICAgICAgICByZW1vdmVQcm9taXNlLnRoZW4oZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zKHJlcGVhdCwgdmFsdWUpOyB9KTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIHZhbHVlKTtcclxuICAgIH07XHJcbiAgICBOdW1iZXJSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuX3N0YW5kYXJkUHJvY2Vzc0l0ZW1zID0gZnVuY3Rpb24gKHJlcGVhdCwgdmFsdWUpIHtcclxuICAgICAgICB2YXIgY2hpbGRyZW5MZW5ndGggPSByZXBlYXQudmlld0NvdW50KCk7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBvdmVycmlkZUNvbnRleHQ7XHJcbiAgICAgICAgdmFyIHZpZXdzVG9SZW1vdmU7XHJcbiAgICAgICAgdmFsdWUgPSBNYXRoLmZsb29yKHZhbHVlKTtcclxuICAgICAgICB2aWV3c1RvUmVtb3ZlID0gY2hpbGRyZW5MZW5ndGggLSB2YWx1ZTtcclxuICAgICAgICBpZiAodmlld3NUb1JlbW92ZSA+IDApIHtcclxuICAgICAgICAgICAgaWYgKHZpZXdzVG9SZW1vdmUgPiBjaGlsZHJlbkxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgdmlld3NUb1JlbW92ZSA9IGNoaWxkcmVuTGVuZ3RoO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGZvciAoaSA9IDAsIGlpID0gdmlld3NUb1JlbW92ZTsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHJlcGVhdC5yZW1vdmVWaWV3KGNoaWxkcmVuTGVuZ3RoIC0gKGkgKyAxKSwgdHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChpID0gY2hpbGRyZW5MZW5ndGgsIGlpID0gdmFsdWU7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCBpLCBpLCBpaSk7XHJcbiAgICAgICAgICAgIHJlcGVhdC5hZGRWaWV3KG92ZXJyaWRlQ29udGV4dC5iaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgMCk7XHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIE51bWJlclJlcGVhdFN0cmF0ZWd5O1xyXG59KCkpO1xuXG52YXIgU2V0UmVwZWF0U3RyYXRlZ3kgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2V0UmVwZWF0U3RyYXRlZ3koKSB7XHJcbiAgICB9XHJcbiAgICBTZXRSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuZ2V0Q29sbGVjdGlvbk9ic2VydmVyID0gZnVuY3Rpb24gKG9ic2VydmVyTG9jYXRvciwgaXRlbXMpIHtcclxuICAgICAgICByZXR1cm4gb2JzZXJ2ZXJMb2NhdG9yLmdldFNldE9ic2VydmVyKGl0ZW1zKTtcclxuICAgIH07XHJcbiAgICBTZXRSZXBlYXRTdHJhdGVneS5wcm90b3R5cGUuaW5zdGFuY2VDaGFuZ2VkID0gZnVuY3Rpb24gKHJlcGVhdCwgaXRlbXMpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHZhciByZW1vdmVQcm9taXNlID0gcmVwZWF0LnJlbW92ZUFsbFZpZXdzKHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICBpZiAocmVtb3ZlUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgcmVtb3ZlUHJvbWlzZS50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuIF90aGlzLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyhyZXBlYXQsIGl0ZW1zKTsgfSk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fc3RhbmRhcmRQcm9jZXNzSXRlbXMocmVwZWF0LCBpdGVtcyk7XHJcbiAgICB9O1xyXG4gICAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLl9zdGFuZGFyZFByb2Nlc3NJdGVtcyA9IGZ1bmN0aW9uIChyZXBlYXQsIGl0ZW1zKSB7XHJcbiAgICAgICAgdmFyIGluZGV4ID0gMDtcclxuICAgICAgICB2YXIgb3ZlcnJpZGVDb250ZXh0O1xyXG4gICAgICAgIGl0ZW1zLmZvckVhY2goZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgICAgIG92ZXJyaWRlQ29udGV4dCA9IGNyZWF0ZUZ1bGxPdmVycmlkZUNvbnRleHQocmVwZWF0LCB2YWx1ZSwgaW5kZXgsIGl0ZW1zLnNpemUpO1xyXG4gICAgICAgICAgICByZXBlYXQuYWRkVmlldyhvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICsraW5kZXg7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgU2V0UmVwZWF0U3RyYXRlZ3kucHJvdG90eXBlLmluc3RhbmNlTXV0YXRlZCA9IGZ1bmN0aW9uIChyZXBlYXQsIHNldCwgcmVjb3Jkcykge1xyXG4gICAgICAgIHZhciB2YWx1ZTtcclxuICAgICAgICB2YXIgaTtcclxuICAgICAgICB2YXIgaWk7XHJcbiAgICAgICAgdmFyIG92ZXJyaWRlQ29udGV4dDtcclxuICAgICAgICB2YXIgcmVtb3ZlSW5kZXg7XHJcbiAgICAgICAgdmFyIHJlY29yZDtcclxuICAgICAgICB2YXIgcm1Qcm9taXNlcyA9IFtdO1xyXG4gICAgICAgIHZhciB2aWV3T3JQcm9taXNlO1xyXG4gICAgICAgIGZvciAoaSA9IDAsIGlpID0gcmVjb3Jkcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgICAgIHJlY29yZCA9IHJlY29yZHNbaV07XHJcbiAgICAgICAgICAgIHZhbHVlID0gcmVjb3JkLnZhbHVlO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHJlY29yZC50eXBlKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdhZGQnOlxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBzaXplID0gTWF0aC5tYXgoc2V0LnNpemUgLSAxLCAwKTtcclxuICAgICAgICAgICAgICAgICAgICBvdmVycmlkZUNvbnRleHQgPSBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0KHJlcGVhdCwgdmFsdWUsIHNpemUsIHNldC5zaXplKTtcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQuaW5zZXJ0VmlldyhzaXplLCBvdmVycmlkZUNvbnRleHQuYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICBjYXNlICdkZWxldGUnOlxyXG4gICAgICAgICAgICAgICAgICAgIHJlbW92ZUluZGV4ID0gdGhpcy5fZ2V0Vmlld0luZGV4QnlWYWx1ZShyZXBlYXQsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICB2aWV3T3JQcm9taXNlID0gcmVwZWF0LnJlbW92ZVZpZXcocmVtb3ZlSW5kZXgsIHRydWUsICFyZXBlYXQudmlld3NSZXF1aXJlTGlmZWN5Y2xlKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodmlld09yUHJvbWlzZSBpbnN0YW5jZW9mIFByb21pc2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcm1Qcm9taXNlcy5wdXNoKHZpZXdPclByb21pc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgJ2NsZWFyJzpcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQucmVtb3ZlQWxsVmlld3ModHJ1ZSwgIXJlcGVhdC52aWV3c1JlcXVpcmVMaWZlY3ljbGUpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocm1Qcm9taXNlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIFByb21pc2UuYWxsKHJtUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgMCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdXBkYXRlT3ZlcnJpZGVDb250ZXh0cyhyZXBlYXQudmlld3MoKSwgMCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFNldFJlcGVhdFN0cmF0ZWd5LnByb3RvdHlwZS5fZ2V0Vmlld0luZGV4QnlWYWx1ZSA9IGZ1bmN0aW9uIChyZXBlYXQsIHZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGk7XHJcbiAgICAgICAgdmFyIGlpO1xyXG4gICAgICAgIHZhciBjaGlsZDtcclxuICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlcGVhdC52aWV3Q291bnQoKTsgaSA8IGlpOyArK2kpIHtcclxuICAgICAgICAgICAgY2hpbGQgPSByZXBlYXQudmlldyhpKTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmJpbmRpbmdDb250ZXh0W3JlcGVhdC5sb2NhbF0gPT09IHZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBTZXRSZXBlYXRTdHJhdGVneTtcclxufSgpKTtcblxudmFyIFJlcGVhdFN0cmF0ZWd5TG9jYXRvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSZXBlYXRTdHJhdGVneUxvY2F0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5tYXRjaGVycyA9IFtdO1xyXG4gICAgICAgIHRoaXMuc3RyYXRlZ2llcyA9IFtdO1xyXG4gICAgICAgIHRoaXMuYWRkU3RyYXRlZ3koZnVuY3Rpb24gKGl0ZW1zKSB7IHJldHVybiBpdGVtcyA9PT0gbnVsbCB8fCBpdGVtcyA9PT0gdW5kZWZpbmVkOyB9LCBuZXcgTnVsbFJlcGVhdFN0cmF0ZWd5KCkpO1xyXG4gICAgICAgIHRoaXMuYWRkU3RyYXRlZ3koZnVuY3Rpb24gKGl0ZW1zKSB7IHJldHVybiBpdGVtcyBpbnN0YW5jZW9mIEFycmF5OyB9LCBuZXcgQXJyYXlSZXBlYXRTdHJhdGVneSgpKTtcclxuICAgICAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykgeyByZXR1cm4gaXRlbXMgaW5zdGFuY2VvZiBNYXA7IH0sIG5ldyBNYXBSZXBlYXRTdHJhdGVneSgpKTtcclxuICAgICAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykgeyByZXR1cm4gaXRlbXMgaW5zdGFuY2VvZiBTZXQ7IH0sIG5ldyBTZXRSZXBlYXRTdHJhdGVneSgpKTtcclxuICAgICAgICB0aGlzLmFkZFN0cmF0ZWd5KGZ1bmN0aW9uIChpdGVtcykgeyByZXR1cm4gdHlwZW9mIGl0ZW1zID09PSAnbnVtYmVyJzsgfSwgbmV3IE51bWJlclJlcGVhdFN0cmF0ZWd5KCkpO1xyXG4gICAgfVxyXG4gICAgUmVwZWF0U3RyYXRlZ3lMb2NhdG9yLnByb3RvdHlwZS5hZGRTdHJhdGVneSA9IGZ1bmN0aW9uIChtYXRjaGVyLCBzdHJhdGVneSkge1xyXG4gICAgICAgIHRoaXMubWF0Y2hlcnMucHVzaChtYXRjaGVyKTtcclxuICAgICAgICB0aGlzLnN0cmF0ZWdpZXMucHVzaChzdHJhdGVneSk7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0U3RyYXRlZ3lMb2NhdG9yLnByb3RvdHlwZS5nZXRTdHJhdGVneSA9IGZ1bmN0aW9uIChpdGVtcykge1xyXG4gICAgICAgIHZhciBtYXRjaGVycyA9IHRoaXMubWF0Y2hlcnM7XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGlpID0gbWF0Y2hlcnMubGVuZ3RoOyBpIDwgaWk7ICsraSkge1xyXG4gICAgICAgICAgICBpZiAobWF0Y2hlcnNbaV0oaXRlbXMpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5zdHJhdGVnaWVzW2ldO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSZXBlYXRTdHJhdGVneUxvY2F0b3I7XHJcbn0oKSk7XG5cbnZhciBsaWZlY3ljbGVPcHRpb25hbEJlaGF2aW9ycyA9IFsnZm9jdXMnLCAnaWYnLCAnZWxzZScsICdyZXBlYXQnLCAnc2hvdycsICdoaWRlJywgJ3dpdGgnXTtcclxuZnVuY3Rpb24gYmVoYXZpb3JSZXF1aXJlc0xpZmVjeWNsZShpbnN0cnVjdGlvbikge1xyXG4gICAgdmFyIHQgPSBpbnN0cnVjdGlvbi50eXBlO1xyXG4gICAgdmFyIG5hbWUgPSB0LmVsZW1lbnROYW1lICE9PSBudWxsID8gdC5lbGVtZW50TmFtZSA6IHQuYXR0cmlidXRlTmFtZTtcclxuICAgIHJldHVybiBsaWZlY3ljbGVPcHRpb25hbEJlaGF2aW9ycy5pbmRleE9mKG5hbWUpID09PSAtMSAmJiAodC5oYW5kbGVzQXR0YWNoZWQgfHwgdC5oYW5kbGVzQmluZCB8fCB0LmhhbmRsZXNDcmVhdGVkIHx8IHQuaGFuZGxlc0RldGFjaGVkIHx8IHQuaGFuZGxlc1VuYmluZClcclxuICAgICAgICB8fCB0LnZpZXdGYWN0b3J5ICYmIHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh0LnZpZXdGYWN0b3J5KVxyXG4gICAgICAgIHx8IGluc3RydWN0aW9uLnZpZXdGYWN0b3J5ICYmIHZpZXdzUmVxdWlyZUxpZmVjeWNsZShpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSk7XHJcbn1cclxuZnVuY3Rpb24gdGFyZ2V0UmVxdWlyZXNMaWZlY3ljbGUoaW5zdHJ1Y3Rpb24pIHtcclxuICAgIHZhciBiZWhhdmlvcnMgPSBpbnN0cnVjdGlvbi5iZWhhdmlvckluc3RydWN0aW9ucztcclxuICAgIGlmIChiZWhhdmlvcnMpIHtcclxuICAgICAgICB2YXIgaSA9IGJlaGF2aW9ycy5sZW5ndGg7XHJcbiAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICBpZiAoYmVoYXZpb3JSZXF1aXJlc0xpZmVjeWNsZShiZWhhdmlvcnNbaV0pKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBpbnN0cnVjdGlvbi52aWV3RmFjdG9yeSAmJiB2aWV3c1JlcXVpcmVMaWZlY3ljbGUoaW5zdHJ1Y3Rpb24udmlld0ZhY3RvcnkpO1xyXG59XHJcbmZ1bmN0aW9uIHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh2aWV3RmFjdG9yeSkge1xyXG4gICAgaWYgKCdfdmlld3NSZXF1aXJlTGlmZWN5Y2xlJyBpbiB2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgIHJldHVybiB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlO1xyXG4gICAgfVxyXG4gICAgdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IGZhbHNlO1xyXG4gICAgaWYgKHZpZXdGYWN0b3J5LnZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgdmlld0ZhY3RvcnkuX3ZpZXdzUmVxdWlyZUxpZmVjeWNsZSA9IHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh2aWV3RmFjdG9yeS52aWV3RmFjdG9yeSk7XHJcbiAgICAgICAgcmV0dXJuIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGU7XHJcbiAgICB9XHJcbiAgICBpZiAodmlld0ZhY3RvcnkudGVtcGxhdGUucXVlcnlTZWxlY3RvcignLmF1LWFuaW1hdGUnKSkge1xyXG4gICAgICAgIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSB0cnVlO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG4gICAgZm9yICh2YXIgaWQgaW4gdmlld0ZhY3RvcnkuaW5zdHJ1Y3Rpb25zKSB7XHJcbiAgICAgICAgaWYgKHRhcmdldFJlcXVpcmVzTGlmZWN5Y2xlKHZpZXdGYWN0b3J5Lmluc3RydWN0aW9uc1tpZF0pKSB7XHJcbiAgICAgICAgICAgIHZpZXdGYWN0b3J5Ll92aWV3c1JlcXVpcmVMaWZlY3ljbGUgPSB0cnVlO1xyXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICB2aWV3RmFjdG9yeS5fdmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gZmFsc2U7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbn1cblxudmFyIEFic3RyYWN0UmVwZWF0ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQWJzdHJhY3RSZXBlYXRlcihvcHRpb25zKSB7XHJcbiAgICAgICAgT2JqZWN0LmFzc2lnbih0aGlzLCB7XHJcbiAgICAgICAgICAgIGxvY2FsOiAnaXRlbXMnLFxyXG4gICAgICAgICAgICB2aWV3c1JlcXVpcmVMaWZlY3ljbGU6IHRydWVcclxuICAgICAgICB9LCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnZpZXdDb3VudCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGB2aWV3Q291bnRgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUudmlld3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgdmlld3NgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUudmlldyA9IGZ1bmN0aW9uIChpbmRleCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHZpZXdgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUubWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGBtYXRjaGVyYCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLmFkZFZpZXcgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYGFkZFZpZXdgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUuaW5zZXJ0VmlldyA9IGZ1bmN0aW9uIChpbmRleCwgYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYGluc2VydFZpZXdgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUubW92ZVZpZXcgPSBmdW5jdGlvbiAoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdWJjbGFzcyBtdXN0IGltcGxlbWVudCBgbW92ZVZpZXdgJyk7XHJcbiAgICB9O1xyXG4gICAgQWJzdHJhY3RSZXBlYXRlci5wcm90b3R5cGUucmVtb3ZlQWxsVmlld3MgPSBmdW5jdGlvbiAocmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignc3ViY2xhc3MgbXVzdCBpbXBsZW1lbnQgYHJlbW92ZUFsbFZpZXdzYCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnJlbW92ZVZpZXdzID0gZnVuY3Rpb24gKHZpZXdzVG9SZW1vdmUsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGByZW1vdmVWaWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnJlbW92ZVZpZXcgPSBmdW5jdGlvbiAoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGByZW1vdmVWaWV3YCcpO1xyXG4gICAgfTtcclxuICAgIEFic3RyYWN0UmVwZWF0ZXIucHJvdG90eXBlLnVwZGF0ZUJpbmRpbmdzID0gZnVuY3Rpb24gKHZpZXcpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3N1YmNsYXNzIG11c3QgaW1wbGVtZW50IGB1cGRhdGVCaW5kaW5nc2AnKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gQWJzdHJhY3RSZXBlYXRlcjtcclxufSgpKTtcblxudmFyIG1hdGNoZXJFeHRyYWN0aW9uTWFya2VyID0gJ19fbWFya2VyX2V4dHJhY3RlZF9fJztcclxudmFyIFJlcGVhdCA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoUmVwZWF0LCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gUmVwZWF0KHZpZXdGYWN0b3J5LCBpbnN0cnVjdGlvbiwgdmlld1Nsb3QsIHZpZXdSZXNvdXJjZXMsIG9ic2VydmVyTG9jYXRvciwgc3RyYXRlZ3lMb2NhdG9yKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcywge1xyXG4gICAgICAgICAgICBsb2NhbDogJ2l0ZW0nLFxyXG4gICAgICAgICAgICB2aWV3c1JlcXVpcmVMaWZlY3ljbGU6IHZpZXdzUmVxdWlyZUxpZmVjeWNsZSh2aWV3RmFjdG9yeSlcclxuICAgICAgICB9KSB8fCB0aGlzO1xyXG4gICAgICAgIF90aGlzLnZpZXdGYWN0b3J5ID0gdmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgX3RoaXMuaW5zdHJ1Y3Rpb24gPSBpbnN0cnVjdGlvbjtcclxuICAgICAgICBfdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xyXG4gICAgICAgIF90aGlzLmxvb2t1cEZ1bmN0aW9ucyA9IHZpZXdSZXNvdXJjZXMubG9va3VwRnVuY3Rpb25zO1xyXG4gICAgICAgIF90aGlzLm9ic2VydmVyTG9jYXRvciA9IG9ic2VydmVyTG9jYXRvcjtcclxuICAgICAgICBfdGhpcy5rZXkgPSAna2V5JztcclxuICAgICAgICBfdGhpcy52YWx1ZSA9ICd2YWx1ZSc7XHJcbiAgICAgICAgX3RoaXMuc3RyYXRlZ3lMb2NhdG9yID0gc3RyYXRlZ3lMb2NhdG9yO1xyXG4gICAgICAgIF90aGlzLmlnbm9yZU11dGF0aW9uID0gZmFsc2U7XHJcbiAgICAgICAgX3RoaXMuc291cmNlRXhwcmVzc2lvbiA9IGdldEl0ZW1zU291cmNlRXhwcmVzc2lvbihfdGhpcy5pbnN0cnVjdGlvbiwgJ3JlcGVhdC5mb3InKTtcclxuICAgICAgICBfdGhpcy5pc09uZVRpbWUgPSBpc09uZVRpbWUoX3RoaXMuc291cmNlRXhwcmVzc2lvbik7XHJcbiAgICAgICAgX3RoaXMudmlld3NSZXF1aXJlTGlmZWN5Y2xlID0gdmlld3NSZXF1aXJlTGlmZWN5Y2xlKHZpZXdGYWN0b3J5KTtcclxuICAgICAgICByZXR1cm4gX3RoaXM7XHJcbiAgICB9XHJcbiAgICBSZXBlYXRfMSA9IFJlcGVhdDtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuY2FsbCA9IGZ1bmN0aW9uIChjb250ZXh0LCBjaGFuZ2VzKSB7XHJcbiAgICAgICAgdGhpc1tjb250ZXh0XSh0aGlzLml0ZW1zLCBjaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMuc2NvcGUgPSB7IGJpbmRpbmdDb250ZXh0OiBiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0OiBvdmVycmlkZUNvbnRleHQgfTtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb24gPSB0aGlzLmluc3RydWN0aW9uO1xyXG4gICAgICAgIGlmICghKG1hdGNoZXJFeHRyYWN0aW9uTWFya2VyIGluIGluc3RydWN0aW9uKSkge1xyXG4gICAgICAgICAgICBpbnN0cnVjdGlvblttYXRjaGVyRXh0cmFjdGlvbk1hcmtlcl0gPSB0aGlzLl9jYXB0dXJlQW5kUmVtb3ZlTWF0Y2hlckJpbmRpbmcoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5tYXRjaGVyQmluZGluZyA9IGluc3RydWN0aW9uW21hdGNoZXJFeHRyYWN0aW9uTWFya2VyXTtcclxuICAgICAgICB0aGlzLml0ZW1zQ2hhbmdlZCgpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuc2NvcGUgPSBudWxsO1xyXG4gICAgICAgIHRoaXMuaXRlbXMgPSBudWxsO1xyXG4gICAgICAgIHRoaXMubWF0Y2hlckJpbmRpbmcgPSBudWxsO1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QucmVtb3ZlQWxsKHRydWUsIHRydWUpO1xyXG4gICAgICAgIHRoaXMuX3Vuc3Vic2NyaWJlQ29sbGVjdGlvbigpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuX3Vuc3Vic2NyaWJlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIudW5zdWJzY3JpYmUodGhpcy5jYWxsQ29udGV4dCwgdGhpcyk7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyID0gbnVsbDtcclxuICAgICAgICAgICAgdGhpcy5jYWxsQ29udGV4dCA9IG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuaXRlbXNDaGFuZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fdW5zdWJzY3JpYmVDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgaWYgKCF0aGlzLnNjb3BlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5pdGVtcztcclxuICAgICAgICB0aGlzLnN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVneUxvY2F0b3IuZ2V0U3RyYXRlZ3koaXRlbXMpO1xyXG4gICAgICAgIGlmICghdGhpcy5zdHJhdGVneSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWx1ZSBmb3IgJ1wiLmNvbmNhdCh0aGlzLnNvdXJjZUV4cHJlc3Npb24sIFwiJyBpcyBub24tcmVwZWF0YWJsZVwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdGhpcy5pc09uZVRpbWUgJiYgIXRoaXMuX29ic2VydmVJbm5lckNvbGxlY3Rpb24oKSkge1xyXG4gICAgICAgICAgICB0aGlzLl9vYnNlcnZlQ29sbGVjdGlvbigpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmlnbm9yZU11dGF0aW9uID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnN0cmF0ZWd5Lmluc3RhbmNlQ2hhbmdlZCh0aGlzLCBpdGVtcyk7XHJcbiAgICAgICAgdGhpcy5vYnNlcnZlckxvY2F0b3IudGFza1F1ZXVlLnF1ZXVlTWljcm9UYXNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgX3RoaXMuaWdub3JlTXV0YXRpb24gPSBmYWxzZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLl9nZXRJbm5lckNvbGxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGV4cHJlc3Npb24gPSB1bndyYXBFeHByZXNzaW9uKHRoaXMuc291cmNlRXhwcmVzc2lvbik7XHJcbiAgICAgICAgaWYgKCFleHByZXNzaW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZXhwcmVzc2lvbi5ldmFsdWF0ZSh0aGlzLnNjb3BlLCBudWxsKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLmhhbmRsZUNvbGxlY3Rpb25NdXRhdGVkID0gZnVuY3Rpb24gKGNvbGxlY3Rpb24sIGNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoIXRoaXMuY29sbGVjdGlvbk9ic2VydmVyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaWdub3JlTXV0YXRpb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnN0cmF0ZWd5Lmluc3RhbmNlTXV0YXRlZCh0aGlzLCBjb2xsZWN0aW9uLCBjaGFuZ2VzKTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLmhhbmRsZUlubmVyQ29sbGVjdGlvbk11dGF0ZWQgPSBmdW5jdGlvbiAoY29sbGVjdGlvbiwgY2hhbmdlcykge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNvbGxlY3Rpb25PYnNlcnZlcikge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmlnbm9yZU11dGF0aW9uKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5pZ25vcmVNdXRhdGlvbiA9IHRydWU7XHJcbiAgICAgICAgdmFyIG5ld0l0ZW1zID0gdGhpcy5zb3VyY2VFeHByZXNzaW9uLmV2YWx1YXRlKHRoaXMuc2NvcGUsIHRoaXMubG9va3VwRnVuY3Rpb25zKTtcclxuICAgICAgICB0aGlzLm9ic2VydmVyTG9jYXRvci50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkgeyByZXR1cm4gX3RoaXMuaWdub3JlTXV0YXRpb24gPSBmYWxzZTsgfSk7XHJcbiAgICAgICAgaWYgKG5ld0l0ZW1zID09PSB0aGlzLml0ZW1zKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaXRlbXNDaGFuZ2VkKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLml0ZW1zID0gbmV3SXRlbXM7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuX29ic2VydmVJbm5lckNvbGxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIGl0ZW1zID0gdGhpcy5fZ2V0SW5uZXJDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgdmFyIHN0cmF0ZWd5ID0gdGhpcy5zdHJhdGVneUxvY2F0b3IuZ2V0U3RyYXRlZ3koaXRlbXMpO1xyXG4gICAgICAgIGlmICghc3RyYXRlZ3kpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNvbGxlY3Rpb25PYnNlcnZlciA9IHN0cmF0ZWd5LmdldENvbGxlY3Rpb25PYnNlcnZlcih0aGlzLm9ic2VydmVyTG9jYXRvciwgaXRlbXMpO1xyXG4gICAgICAgIGlmICghdGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhbGxDb250ZXh0ID0gJ2hhbmRsZUlubmVyQ29sbGVjdGlvbk11dGF0ZWQnO1xyXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyLnN1YnNjcmliZSh0aGlzLmNhbGxDb250ZXh0LCB0aGlzKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH07XHJcbiAgICBSZXBlYXQucHJvdG90eXBlLl9vYnNlcnZlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgaXRlbXMgPSB0aGlzLml0ZW1zO1xyXG4gICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyID0gdGhpcy5zdHJhdGVneS5nZXRDb2xsZWN0aW9uT2JzZXJ2ZXIodGhpcy5vYnNlcnZlckxvY2F0b3IsIGl0ZW1zKTtcclxuICAgICAgICBpZiAodGhpcy5jb2xsZWN0aW9uT2JzZXJ2ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5jYWxsQ29udGV4dCA9ICdoYW5kbGVDb2xsZWN0aW9uTXV0YXRlZCc7XHJcbiAgICAgICAgICAgIHRoaXMuY29sbGVjdGlvbk9ic2VydmVyLnN1YnNjcmliZSh0aGlzLmNhbGxDb250ZXh0LCB0aGlzKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5fY2FwdHVyZUFuZFJlbW92ZU1hdGNoZXJCaW5kaW5nID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB2aWV3RmFjdG9yeSA9IHRoaXMudmlld0ZhY3Rvcnkudmlld0ZhY3Rvcnk7XHJcbiAgICAgICAgaWYgKHZpZXdGYWN0b3J5KSB7XHJcbiAgICAgICAgICAgIHZhciB0ZW1wbGF0ZSA9IHZpZXdGYWN0b3J5LnRlbXBsYXRlO1xyXG4gICAgICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25zID0gdmlld0ZhY3RvcnkuaW5zdHJ1Y3Rpb25zO1xyXG4gICAgICAgICAgICBpZiAoUmVwZWF0XzEudXNlSW5uZXJNYXRjaGVyKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZXh0cmFjdE1hdGNoZXJCaW5kaW5nRXhwcmVzc2lvbihpbnN0cnVjdGlvbnMpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChnZXRDaGlsZHJlbkNvdW50KHRlbXBsYXRlKSA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHJlcGVhdGVkRWxlbWVudCA9IGdldEZpcnN0RWxlbWVudENoaWxkKHRlbXBsYXRlKTtcclxuICAgICAgICAgICAgaWYgKCFyZXBlYXRlZEVsZW1lbnQuaGFzQXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgcmVwZWF0ZWRFbGVtZW50VGFyZ2V0SWQgPSByZXBlYXRlZEVsZW1lbnQuZ2V0QXR0cmlidXRlKCdhdS10YXJnZXQtaWQnKTtcclxuICAgICAgICAgICAgcmV0dXJuIGV4dHJhY3RNYXRjaGVyQmluZGluZ0V4cHJlc3Npb24oaW5zdHJ1Y3Rpb25zLCByZXBlYXRlZEVsZW1lbnRUYXJnZXRJZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS52aWV3Q291bnQgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnZpZXdTbG90LmNoaWxkcmVuLmxlbmd0aDsgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUudmlld3MgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLnZpZXdTbG90LmNoaWxkcmVuOyB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS52aWV3ID0gZnVuY3Rpb24gKGluZGV4KSB7IHJldHVybiB0aGlzLnZpZXdTbG90LmNoaWxkcmVuW2luZGV4XTsgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUubWF0Y2hlciA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgbWF0Y2hlckJpbmRpbmcgPSB0aGlzLm1hdGNoZXJCaW5kaW5nO1xyXG4gICAgICAgIHJldHVybiBtYXRjaGVyQmluZGluZ1xyXG4gICAgICAgICAgICA/IG1hdGNoZXJCaW5kaW5nLnNvdXJjZUV4cHJlc3Npb24uZXZhbHVhdGUodGhpcy5zY29wZSwgbWF0Y2hlckJpbmRpbmcubG9va3VwRnVuY3Rpb25zKVxyXG4gICAgICAgICAgICA6IG51bGw7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5hZGRWaWV3ID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICB2YXIgdmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKCk7XHJcbiAgICAgICAgdmlldy5iaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgICAgIHRoaXMudmlld1Nsb3QuYWRkKHZpZXcpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUuaW5zZXJ0VmlldyA9IGZ1bmN0aW9uIChpbmRleCwgYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCkge1xyXG4gICAgICAgIHZhciB2aWV3ID0gdGhpcy52aWV3RmFjdG9yeS5jcmVhdGUoKTtcclxuICAgICAgICB2aWV3LmJpbmQoYmluZGluZ0NvbnRleHQsIG92ZXJyaWRlQ29udGV4dCk7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdC5pbnNlcnQoaW5kZXgsIHZpZXcpO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUubW92ZVZpZXcgPSBmdW5jdGlvbiAoc291cmNlSW5kZXgsIHRhcmdldEluZGV4KSB7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdC5tb3ZlKHNvdXJjZUluZGV4LCB0YXJnZXRJbmRleCk7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5yZW1vdmVBbGxWaWV3cyA9IGZ1bmN0aW9uIChyZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlQWxsKHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUucmVtb3ZlVmlld3MgPSBmdW5jdGlvbiAodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbikge1xyXG4gICAgICAgIHJldHVybiB0aGlzLnZpZXdTbG90LnJlbW92ZU1hbnkodmlld3NUb1JlbW92ZSwgcmV0dXJuVG9DYWNoZSwgc2tpcEFuaW1hdGlvbik7XHJcbiAgICB9O1xyXG4gICAgUmVwZWF0LnByb3RvdHlwZS5yZW1vdmVWaWV3ID0gZnVuY3Rpb24gKGluZGV4LCByZXR1cm5Ub0NhY2hlLCBza2lwQW5pbWF0aW9uKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudmlld1Nsb3QucmVtb3ZlQXQoaW5kZXgsIHJldHVyblRvQ2FjaGUsIHNraXBBbmltYXRpb24pO1xyXG4gICAgfTtcclxuICAgIFJlcGVhdC5wcm90b3R5cGUudXBkYXRlQmluZGluZ3MgPSBmdW5jdGlvbiAodmlldykge1xyXG4gICAgICAgIHZhciAkdmlldyA9IHZpZXc7XHJcbiAgICAgICAgdmFyIGogPSAkdmlldy5iaW5kaW5ncy5sZW5ndGg7XHJcbiAgICAgICAgd2hpbGUgKGotLSkge1xyXG4gICAgICAgICAgICB1cGRhdGVPbmVUaW1lQmluZGluZygkdmlldy5iaW5kaW5nc1tqXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGogPSAkdmlldy5jb250cm9sbGVycy5sZW5ndGg7XHJcbiAgICAgICAgd2hpbGUgKGotLSkge1xyXG4gICAgICAgICAgICB2YXIgayA9ICR2aWV3LmNvbnRyb2xsZXJzW2pdLmJvdW5kUHJvcGVydGllcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHdoaWxlIChrLS0pIHtcclxuICAgICAgICAgICAgICAgIHZhciBiaW5kaW5nID0gJHZpZXcuY29udHJvbGxlcnNbal0uYm91bmRQcm9wZXJ0aWVzW2tdLmJpbmRpbmc7XHJcbiAgICAgICAgICAgICAgICB1cGRhdGVPbmVUaW1lQmluZGluZyhiaW5kaW5nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICB2YXIgUmVwZWF0XzE7XHJcbiAgICBSZXBlYXQudXNlSW5uZXJNYXRjaGVyID0gdHJ1ZTtcclxuICAgIF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRhYmxlXHJcbiAgICBdLCBSZXBlYXQucHJvdG90eXBlLCBcIml0ZW1zXCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgUmVwZWF0LnByb3RvdHlwZSwgXCJsb2NhbFwiLCB2b2lkIDApO1xyXG4gICAgX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGFibGVcclxuICAgIF0sIFJlcGVhdC5wcm90b3R5cGUsIFwia2V5XCIsIHZvaWQgMCk7XHJcbiAgICBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kYWJsZVxyXG4gICAgXSwgUmVwZWF0LnByb3RvdHlwZSwgXCJ2YWx1ZVwiLCB2b2lkIDApO1xyXG4gICAgUmVwZWF0ID0gUmVwZWF0XzEgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ3JlcGVhdCcpLFxyXG4gICAgICAgIHRlbXBsYXRlQ29udHJvbGxlcixcclxuICAgICAgICBpbmplY3QoQm91bmRWaWV3RmFjdG9yeSwgVGFyZ2V0SW5zdHJ1Y3Rpb24sIFZpZXdTbG90LCBWaWV3UmVzb3VyY2VzLCBPYnNlcnZlckxvY2F0b3IsIFJlcGVhdFN0cmF0ZWd5TG9jYXRvcilcclxuICAgIF0sIFJlcGVhdCk7XHJcbiAgICByZXR1cm4gUmVwZWF0O1xyXG59KEFic3RyYWN0UmVwZWF0ZXIpKTtcclxudmFyIGV4dHJhY3RNYXRjaGVyQmluZGluZ0V4cHJlc3Npb24gPSBmdW5jdGlvbiAoaW5zdHJ1Y3Rpb25zLCB0YXJnZXRlZEVsZW1lbnRJZCkge1xyXG4gICAgdmFyIGluc3RydWN0aW9uSWRzID0gT2JqZWN0LmtleXMoaW5zdHJ1Y3Rpb25zKTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5zdHJ1Y3Rpb25JZHMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICB2YXIgaW5zdHJ1Y3Rpb25JZCA9IGluc3RydWN0aW9uSWRzW2ldO1xyXG4gICAgICAgIGlmICh0YXJnZXRlZEVsZW1lbnRJZCAhPT0gdW5kZWZpbmVkICYmIGluc3RydWN0aW9uSWQgIT09IHRhcmdldGVkRWxlbWVudElkKSB7XHJcbiAgICAgICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgZXhwcmVzc2lvbnMgPSBpbnN0cnVjdGlvbnNbaW5zdHJ1Y3Rpb25JZF0uZXhwcmVzc2lvbnM7XHJcbiAgICAgICAgaWYgKGV4cHJlc3Npb25zKSB7XHJcbiAgICAgICAgICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCBleHByZXNzaW9ucy5sZW5ndGg7IGlpKyspIHtcclxuICAgICAgICAgICAgICAgIGlmIChleHByZXNzaW9uc1tpaV0udGFyZ2V0UHJvcGVydHkgPT09ICdtYXRjaGVyJykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtYXRjaGVyQmluZGluZ0V4cHJlc3Npb24gPSBleHByZXNzaW9uc1tpaV07XHJcbiAgICAgICAgICAgICAgICAgICAgZXhwcmVzc2lvbnMuc3BsaWNlKGlpLCAxKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWF0Y2hlckJpbmRpbmdFeHByZXNzaW9uO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG52YXIgZ2V0Q2hpbGRyZW5Db3VudCA9IGZ1bmN0aW9uIChlbCkge1xyXG4gICAgdmFyIGNoaWxkTm9kZXMgPSBlbC5jaGlsZE5vZGVzO1xyXG4gICAgdmFyIGNvdW50ID0gMDtcclxuICAgIGZvciAodmFyIGkgPSAwLCBpaSA9IGNoaWxkTm9kZXMubGVuZ3RoOyBpaSA+IGk7ICsraSkge1xyXG4gICAgICAgIGlmIChjaGlsZE5vZGVzW2ldLm5vZGVUeXBlID09PSAxKSB7XHJcbiAgICAgICAgICAgICsrY291bnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNvdW50O1xyXG59O1xyXG52YXIgZ2V0Rmlyc3RFbGVtZW50Q2hpbGQgPSBmdW5jdGlvbiAoZWwpIHtcclxuICAgIHZhciBmaXJzdENoaWxkID0gZWwuZmlyc3RDaGlsZDtcclxuICAgIHdoaWxlIChmaXJzdENoaWxkICE9PSBudWxsKSB7XHJcbiAgICAgICAgaWYgKGZpcnN0Q2hpbGQubm9kZVR5cGUgPT09IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZpcnN0Q2hpbGQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZpcnN0Q2hpbGQgPSBmaXJzdENoaWxkLm5leHRTaWJsaW5nO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbn07XG5cbnZhciBhdXJlbGlhSGlkZUNsYXNzTmFtZSA9ICdhdXJlbGlhLWhpZGUnO1xyXG52YXIgYXVyZWxpYUhpZGVDbGFzcyA9IFwiLlwiLmNvbmNhdChhdXJlbGlhSGlkZUNsYXNzTmFtZSwgXCIgeyBkaXNwbGF5Om5vbmUgIWltcG9ydGFudDsgfVwiKTtcclxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0SGVhZCgpIHtcclxuICAgIERPTS5pbmplY3RTdHlsZXMoYXVyZWxpYUhpZGVDbGFzcyk7XHJcbn1cclxuZnVuY3Rpb24gaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkoZG9tQm91bmRhcnkpIHtcclxuICAgIGlmIChGRUFUVVJFLnNoYWRvd0RPTSAmJiBkb21Cb3VuZGFyeSAmJiAhZG9tQm91bmRhcnkuaGFzQXVyZWxpYUhpZGVTdHlsZSkge1xyXG4gICAgICAgIGRvbUJvdW5kYXJ5Lmhhc0F1cmVsaWFIaWRlU3R5bGUgPSB0cnVlO1xyXG4gICAgICAgIERPTS5pbmplY3RTdHlsZXMoYXVyZWxpYUhpZGVDbGFzcywgZG9tQm91bmRhcnkpO1xyXG4gICAgfVxyXG59XG5cbnZhciBTaG93ID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNob3coZWxlbWVudCwgYW5pbWF0b3IsIGRvbUJvdW5kYXJ5KSB7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWxlbWVudDtcclxuICAgICAgICB0aGlzLmFuaW1hdG9yID0gYW5pbWF0b3I7XHJcbiAgICAgICAgdGhpcy5kb21Cb3VuZGFyeSA9IGRvbUJvdW5kYXJ5O1xyXG4gICAgfVxyXG4gICAgU2hvdy5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtET00uRWxlbWVudCwgQW5pbWF0b3IsIE9wdGlvbmFsLm9mKERPTS5ib3VuZGFyeSwgdHJ1ZSldO1xyXG4gICAgfTtcclxuICAgIFNob3cucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaW5qZWN0QXVyZWxpYUhpZGVTdHlsZUF0Qm91bmRhcnkodGhpcy5kb21Cb3VuZGFyeSk7XHJcbiAgICB9O1xyXG4gICAgU2hvdy5wcm90b3R5cGUudmFsdWVDaGFuZ2VkID0gZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XHJcbiAgICAgICAgdmFyIGVsZW1lbnQgPSB0aGlzLmVsZW1lbnQ7XHJcbiAgICAgICAgdmFyIGFuaW1hdG9yID0gdGhpcy5hbmltYXRvcjtcclxuICAgICAgICBpZiAobmV3VmFsdWUpIHtcclxuICAgICAgICAgICAgYW5pbWF0b3IucmVtb3ZlQ2xhc3MoZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgYW5pbWF0b3IuYWRkQ2xhc3MoZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBTaG93LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZWQodGhpcy52YWx1ZSk7XHJcbiAgICB9O1xyXG4gICAgU2hvdyA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGN1c3RvbUF0dHJpYnV0ZSgnc2hvdycpXHJcbiAgICBdLCBTaG93KTtcclxuICAgIHJldHVybiBTaG93O1xyXG59KCkpO1xuXG52YXIgSGlkZSA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBIaWRlKGVsZW1lbnQsIGFuaW1hdG9yLCBkb21Cb3VuZGFyeSkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5hbmltYXRvciA9IGFuaW1hdG9yO1xyXG4gICAgICAgIHRoaXMuZG9tQm91bmRhcnkgPSBkb21Cb3VuZGFyeTtcclxuICAgIH1cclxuICAgIEhpZGUuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbRE9NLkVsZW1lbnQsIEFuaW1hdG9yLCBPcHRpb25hbC5vZihET00uYm91bmRhcnksIHRydWUpXTtcclxuICAgIH07XHJcbiAgICBIaWRlLnByb3RvdHlwZS5jcmVhdGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGluamVjdEF1cmVsaWFIaWRlU3R5bGVBdEJvdW5kYXJ5KHRoaXMuZG9tQm91bmRhcnkpO1xyXG4gICAgfTtcclxuICAgIEhpZGUucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xyXG4gICAgICAgIGlmIChuZXdWYWx1ZSkge1xyXG4gICAgICAgICAgICB0aGlzLmFuaW1hdG9yLmFkZENsYXNzKHRoaXMuZWxlbWVudCwgYXVyZWxpYUhpZGVDbGFzc05hbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5hbmltYXRvci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQsIGF1cmVsaWFIaWRlQ2xhc3NOYW1lKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgSGlkZS5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCkge1xyXG4gICAgICAgIHRoaXMudmFsdWVDaGFuZ2VkKHRoaXMudmFsdWUpO1xyXG4gICAgfTtcclxuICAgIEhpZGUucHJvdG90eXBlLnZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZXRob2Qgbm90IGltcGxlbWVudGVkLicpO1xyXG4gICAgfTtcclxuICAgIEhpZGUgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ2hpZGUnKVxyXG4gICAgXSwgSGlkZSk7XHJcbiAgICByZXR1cm4gSGlkZTtcclxufSgpKTtcblxudmFyIEhUTUxTYW5pdGl6ZXIgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gSFRNTFNhbml0aXplcigpIHtcclxuICAgIH1cclxuICAgIEhUTUxTYW5pdGl6ZXIucHJvdG90eXBlLnNhbml0aXplID0gZnVuY3Rpb24gKGlucHV0KSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVG8gcHJvdGVjdCB0aGUgYXBwbGljYXRpb24gYWdhaW5zdCBhIHdpZGUgdmFyaWV0eSBvZiBzb3BoaXN0aWNhdGVkIFhTUyBhdHRhY2tzLlxcblBsZWFzZSBzZWUgaHR0cHM6Ly9hdXJlbGlhLmlvL2RvY3MvYmluZGluZy9iYXNpY3MjZWxlbWVudC1jb250ZW50IGZvciBpbnN0cnVjdGlvbnMgb24gaG93IHRvIHVzZSBhIHNlY3VyZSBzb2x1dGlvbiBsaWtlIERPTVB1cmlmeSBvciBzYW5pdGl6ZS1odG1sLlwiKTtcclxuICAgIH07XHJcbiAgICByZXR1cm4gSFRNTFNhbml0aXplcjtcclxufSgpKTtcblxudmFyIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyKHNhbml0aXplcikge1xyXG4gICAgICAgIHRoaXMuc2FuaXRpemVyID0gc2FuaXRpemVyO1xyXG4gICAgfVxyXG4gICAgU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIucHJvdG90eXBlLnRvVmlldyA9IGZ1bmN0aW9uICh1bnRydXN0ZWRNYXJrdXApIHtcclxuICAgICAgICBpZiAodW50cnVzdGVkTWFya3VwID09PSBudWxsIHx8IHVudHJ1c3RlZE1hcmt1cCA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5zYW5pdGl6ZXIuc2FuaXRpemUodW50cnVzdGVkTWFya3VwKTtcclxuICAgIH07XHJcbiAgICBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIHZhbHVlQ29udmVydGVyKCdzYW5pdGl6ZUhUTUwnKSxcclxuICAgICAgICBpbmplY3QoSFRNTFNhbml0aXplcilcclxuICAgIF0sIFNhbml0aXplSFRNTFZhbHVlQ29udmVydGVyKTtcclxuICAgIHJldHVybiBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlcjtcclxufSgpKTtcblxudmFyIFJlcGxhY2VhYmxlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJlcGxhY2VhYmxlKHZpZXdGYWN0b3J5LCB2aWV3U2xvdCkge1xyXG4gICAgICAgIHRoaXMudmlld0ZhY3RvcnkgPSB2aWV3RmFjdG9yeTtcclxuICAgICAgICB0aGlzLnZpZXdTbG90ID0gdmlld1Nsb3Q7XHJcbiAgICAgICAgdGhpcy52aWV3ID0gbnVsbDtcclxuICAgIH1cclxuICAgIFJlcGxhY2VhYmxlLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpIHtcclxuICAgICAgICBpZiAodGhpcy52aWV3ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmlldyA9IHRoaXMudmlld0ZhY3RvcnkuY3JlYXRlKCk7XHJcbiAgICAgICAgICAgIHRoaXMudmlld1Nsb3QuYWRkKHRoaXMudmlldyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlldy5iaW5kKGJpbmRpbmdDb250ZXh0LCBvdmVycmlkZUNvbnRleHQpO1xyXG4gICAgfTtcclxuICAgIFJlcGxhY2VhYmxlLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy52aWV3LnVuYmluZCgpO1xyXG4gICAgfTtcclxuICAgIFJlcGxhY2VhYmxlID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgY3VzdG9tQXR0cmlidXRlKCdyZXBsYWNlYWJsZScpLFxyXG4gICAgICAgIHRlbXBsYXRlQ29udHJvbGxlcixcclxuICAgICAgICBpbmplY3QoQm91bmRWaWV3RmFjdG9yeSwgVmlld1Nsb3QpXHJcbiAgICBdLCBSZXBsYWNlYWJsZSk7XHJcbiAgICByZXR1cm4gUmVwbGFjZWFibGU7XHJcbn0oKSk7XG5cbnZhciBGb2N1cyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBGb2N1cyhlbGVtZW50LCB0YXNrUXVldWUpIHtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMudGFza1F1ZXVlID0gdGFza1F1ZXVlO1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMubmVlZHNBcHBseSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgRm9jdXMuaW5qZWN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBbRE9NLkVsZW1lbnQsIFRhc2tRdWV1ZV07XHJcbiAgICB9O1xyXG4gICAgRm9jdXMucHJvdG90eXBlLnZhbHVlQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZiAodGhpcy5pc0F0dGFjaGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICB0aGlzLm5lZWRzQXBwbHkgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBGb2N1cy5wcm90b3R5cGUuX2FwcGx5ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgaWYgKHRoaXMudmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy50YXNrUXVldWUucXVldWVNaWNyb1Rhc2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLnZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuZWxlbWVudC5mb2N1cygpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuZWxlbWVudC5ibHVyKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIEZvY3VzLnByb3RvdHlwZS5hdHRhY2hlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzQXR0YWNoZWQgPSB0cnVlO1xyXG4gICAgICAgIGlmICh0aGlzLm5lZWRzQXBwbHkpIHtcclxuICAgICAgICAgICAgdGhpcy5uZWVkc0FwcGx5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHRoaXMuX2FwcGx5KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcyk7XHJcbiAgICB9O1xyXG4gICAgRm9jdXMucHJvdG90eXBlLmRldGFjaGVkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoaXMuaXNBdHRhY2hlZCA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdmb2N1cycsIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCdibHVyJywgdGhpcyk7XHJcbiAgICB9O1xyXG4gICAgRm9jdXMucHJvdG90eXBlLmhhbmRsZUV2ZW50ID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBpZiAoZS50eXBlID09PSAnZm9jdXMnKSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChET00uYWN0aXZlRWxlbWVudCAhPT0gdGhpcy5lbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMudmFsdWUgPSBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRm9jdXMgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBjdXN0b21BdHRyaWJ1dGUoJ2ZvY3VzJywgYmluZGluZ01vZGUudHdvV2F5KVxyXG4gICAgXSwgRm9jdXMpO1xyXG4gICAgcmV0dXJuIEZvY3VzO1xyXG59KCkpO1xuXG52YXIgY3NzVXJsTWF0Y2hlciA9IC91cmxcXCgoPyFbJ1wiXWRhdGEpKFteKV0rKVxcKS9naTtcclxuZnVuY3Rpb24gZml4dXBDU1NVcmxzKGFkZHJlc3MsIGNzcykge1xyXG4gICAgaWYgKHR5cGVvZiBjc3MgIT09ICdzdHJpbmcnKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIGxvYWRpbmcgcmVxdWlyZWQgQ1NTIGZpbGU6IFwiLmNvbmNhdChhZGRyZXNzKSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY3NzLnJlcGxhY2UoY3NzVXJsTWF0Y2hlciwgZnVuY3Rpb24gKG1hdGNoLCBwMSkge1xyXG4gICAgICAgIHZhciBxdW90ZSA9IHAxLmNoYXJBdCgwKTtcclxuICAgICAgICBpZiAocXVvdGUgPT09ICdcXCcnIHx8IHF1b3RlID09PSAnXCInKSB7XHJcbiAgICAgICAgICAgIHAxID0gcDEuc3Vic3RyKDEsIHAxLmxlbmd0aCAtIDIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gJ3VybChcXCcnICsgcmVsYXRpdmVUb0ZpbGUocDEsIGFkZHJlc3MpICsgJ1xcJyknO1xyXG4gICAgfSk7XHJcbn1cclxudmFyIENTU1Jlc291cmNlID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIENTU1Jlc291cmNlKGFkZHJlc3MpIHtcclxuICAgICAgICB0aGlzLmFkZHJlc3MgPSBhZGRyZXNzO1xyXG4gICAgICAgIHRoaXMuX3Njb3BlZCA9IG51bGw7XHJcbiAgICAgICAgdGhpcy5fZ2xvYmFsID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5fYWxyZWFkeUdsb2JhbGx5SW5qZWN0ZWQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIENTU1Jlc291cmNlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24gKGNvbnRhaW5lciwgVGFyZ2V0KSB7XHJcbiAgICAgICAgdGhpcy5fc2NvcGVkID0gbmV3IFRhcmdldCh0aGlzKTtcclxuICAgIH07XHJcbiAgICBDU1NSZXNvdXJjZS5wcm90b3R5cGUucmVnaXN0ZXIgPSBmdW5jdGlvbiAocmVnaXN0cnksIG5hbWUpIHtcclxuICAgICAgICBpZiAobmFtZSA9PT0gJ3Njb3BlZCcpIHtcclxuICAgICAgICAgICAgcmVnaXN0cnkucmVnaXN0ZXJWaWV3RW5naW5lSG9va3ModGhpcy5fc2NvcGVkKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHRoaXMuX2dsb2JhbCA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIENTU1Jlc291cmNlLnByb3RvdHlwZS5sb2FkID0gZnVuY3Rpb24gKGNvbnRhaW5lcikge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgcmV0dXJuIGNvbnRhaW5lci5nZXQoTG9hZGVyKVxyXG4gICAgICAgICAgICAubG9hZFRleHQodGhpcy5hZGRyZXNzKVxyXG4gICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKCkgeyByZXR1cm4gbnVsbDsgfSlcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRleHQpIHtcclxuICAgICAgICAgICAgdGV4dCA9IGZpeHVwQ1NTVXJscyhfdGhpcy5hZGRyZXNzLCB0ZXh0KTtcclxuICAgICAgICAgICAgX3RoaXMuX3Njb3BlZC5jc3MgPSB0ZXh0O1xyXG4gICAgICAgICAgICBpZiAoX3RoaXMuX2dsb2JhbCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuX2FscmVhZHlHbG9iYWxseUluamVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIERPTS5pbmplY3RTdHlsZXModGV4dCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIF90aGlzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBDU1NSZXNvdXJjZTtcclxufSgpKTtcclxudmFyIENTU1ZpZXdFbmdpbmVIb29rcyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBDU1NWaWV3RW5naW5lSG9va3Mob3duZXIpIHtcclxuICAgICAgICB0aGlzLm93bmVyID0gb3duZXI7XHJcbiAgICAgICAgdGhpcy5jc3MgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgQ1NTVmlld0VuZ2luZUhvb2tzLnByb3RvdHlwZS5iZWZvcmVDb21waWxlID0gZnVuY3Rpb24gKGNvbnRlbnQsIHJlc291cmNlcywgaW5zdHJ1Y3Rpb24pIHtcclxuICAgICAgICBpZiAoaW5zdHJ1Y3Rpb24udGFyZ2V0U2hhZG93RE9NKSB7XHJcbiAgICAgICAgICAgIERPTS5pbmplY3RTdHlsZXModGhpcy5jc3MsIGNvbnRlbnQsIHRydWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIGlmIChGRUFUVVJFLnNjb3BlZENTUykge1xyXG4gICAgICAgICAgICB2YXIgc3R5bGVOb2RlID0gRE9NLmluamVjdFN0eWxlcyh0aGlzLmNzcywgY29udGVudCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgIHN0eWxlTm9kZS5zZXRBdHRyaWJ1dGUoJ3Njb3BlZCcsICdzY29wZWQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodGhpcy5fZ2xvYmFsICYmICF0aGlzLm93bmVyLl9hbHJlYWR5R2xvYmFsbHlJbmplY3RlZCkge1xyXG4gICAgICAgICAgICBET00uaW5qZWN0U3R5bGVzKHRoaXMuY3NzKTtcclxuICAgICAgICAgICAgdGhpcy5vd25lci5fYWxyZWFkeUdsb2JhbGx5SW5qZWN0ZWQgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICByZXR1cm4gQ1NTVmlld0VuZ2luZUhvb2tzO1xyXG59KCkpO1xyXG5mdW5jdGlvbiBfY3JlYXRlQ1NTUmVzb3VyY2UoYWRkcmVzcykge1xyXG4gICAgdmFyIFZpZXdDU1MgPSAoZnVuY3Rpb24gKF9zdXBlcikge1xyXG4gICAgICAgIF9fZXh0ZW5kcyhWaWV3Q1NTLCBfc3VwZXIpO1xyXG4gICAgICAgIGZ1bmN0aW9uIFZpZXdDU1MoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBfc3VwZXIgIT09IG51bGwgJiYgX3N1cGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfHwgdGhpcztcclxuICAgICAgICB9XHJcbiAgICAgICAgVmlld0NTUyA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgICAgICByZXNvdXJjZShuZXcgQ1NTUmVzb3VyY2UoYWRkcmVzcykpXHJcbiAgICAgICAgXSwgVmlld0NTUyk7XHJcbiAgICAgICAgcmV0dXJuIFZpZXdDU1M7XHJcbiAgICB9KENTU1ZpZXdFbmdpbmVIb29rcykpO1xyXG4gICAgcmV0dXJuIFZpZXdDU1M7XHJcbn1cblxudmFyIEF0dHJCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gQXR0ckJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgIH1cclxuICAgIEF0dHJCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICAgICAgYmluZGluZy50YXJnZXRPYnNlcnZlciA9IG5ldyBEYXRhQXR0cmlidXRlT2JzZXJ2ZXIoYmluZGluZy50YXJnZXQsIGJpbmRpbmcudGFyZ2V0UHJvcGVydHkpO1xyXG4gICAgfTtcclxuICAgIEF0dHJCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UpIHtcclxuICAgIH07XHJcbiAgICBBdHRyQmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdhdHRyJylcclxuICAgIF0sIEF0dHJCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIEF0dHJCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XG5cbnZhciBtb2RlQmluZGluZ0JlaGF2aW9yID0ge1xyXG4gICAgYmluZDogZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSwgbG9va3VwRnVuY3Rpb25zKSB7XHJcbiAgICAgICAgYmluZGluZy5vcmlnaW5hbE1vZGUgPSBiaW5kaW5nLm1vZGU7XHJcbiAgICAgICAgYmluZGluZy5tb2RlID0gdGhpcy5tb2RlO1xyXG4gICAgfSxcclxuICAgIHVuYmluZDogZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIGJpbmRpbmcubW9kZSA9IGJpbmRpbmcub3JpZ2luYWxNb2RlO1xyXG4gICAgICAgIGJpbmRpbmcub3JpZ2luYWxNb2RlID0gbnVsbDtcclxuICAgIH1cclxufTtcclxudmFyIE9uZVRpbWVCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gT25lVGltZUJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgICAgICB0aGlzLm1vZGUgPSBiaW5kaW5nTW9kZS5vbmVUaW1lO1xyXG4gICAgfVxyXG4gICAgT25lVGltZUJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIG1peGluKG1vZGVCaW5kaW5nQmVoYXZpb3IpLFxyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcignb25lVGltZScpXHJcbiAgICBdLCBPbmVUaW1lQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBPbmVUaW1lQmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xyXG52YXIgT25lV2F5QmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIE9uZVdheUJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgICAgICB0aGlzLm1vZGUgPSBiaW5kaW5nTW9kZS50b1ZpZXc7XHJcbiAgICB9XHJcbiAgICBPbmVXYXlCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBtaXhpbihtb2RlQmluZGluZ0JlaGF2aW9yKSxcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ29uZVdheScpXHJcbiAgICBdLCBPbmVXYXlCaW5kaW5nQmVoYXZpb3IpO1xyXG4gICAgcmV0dXJuIE9uZVdheUJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcclxudmFyIFRvVmlld0JpbmRpbmdCZWhhdmlvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBUb1ZpZXdCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICAgICAgdGhpcy5tb2RlID0gYmluZGluZ01vZGUudG9WaWV3O1xyXG4gICAgfVxyXG4gICAgVG9WaWV3QmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgbWl4aW4obW9kZUJpbmRpbmdCZWhhdmlvciksXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCd0b1ZpZXcnKVxyXG4gICAgXSwgVG9WaWV3QmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBUb1ZpZXdCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XHJcbnZhciBGcm9tVmlld0JpbmRpbmdCZWhhdmlvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBGcm9tVmlld0JpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgICAgICB0aGlzLm1vZGUgPSBiaW5kaW5nTW9kZS5mcm9tVmlldztcclxuICAgIH1cclxuICAgIEZyb21WaWV3QmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgbWl4aW4obW9kZUJpbmRpbmdCZWhhdmlvciksXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdmcm9tVmlldycpXHJcbiAgICBdLCBGcm9tVmlld0JpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gRnJvbVZpZXdCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XHJcbnZhciBUd29XYXlCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVHdvV2F5QmluZGluZ0JlaGF2aW9yKCkge1xyXG4gICAgICAgIHRoaXMubW9kZSA9IGJpbmRpbmdNb2RlLnR3b1dheTtcclxuICAgIH1cclxuICAgIFR3b1dheUJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIG1peGluKG1vZGVCaW5kaW5nQmVoYXZpb3IpLFxyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcigndHdvV2F5JylcclxuICAgIF0sIFR3b1dheUJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gVHdvV2F5QmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xuXG5mdW5jdGlvbiB0aHJvdHRsZShuZXdWYWx1ZSkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHZhciBzdGF0ZSA9IHRoaXMudGhyb3R0bGVTdGF0ZTtcclxuICAgIHZhciBlbGFwc2VkID0gK25ldyBEYXRlKCkgLSBzdGF0ZS5sYXN0O1xyXG4gICAgaWYgKGVsYXBzZWQgPj0gc3RhdGUuZGVsYXkpIHtcclxuICAgICAgICBjbGVhclRpbWVvdXQoc3RhdGUudGltZW91dElkKTtcclxuICAgICAgICBzdGF0ZS50aW1lb3V0SWQgPSBudWxsO1xyXG4gICAgICAgIHN0YXRlLmxhc3QgPSArbmV3IERhdGUoKTtcclxuICAgICAgICB0aGlzLnRocm90dGxlZE1ldGhvZChuZXdWYWx1ZSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgc3RhdGUubmV3VmFsdWUgPSBuZXdWYWx1ZTtcclxuICAgIGlmIChzdGF0ZS50aW1lb3V0SWQgPT09IG51bGwpIHtcclxuICAgICAgICBzdGF0ZS50aW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc3RhdGUudGltZW91dElkID0gbnVsbDtcclxuICAgICAgICAgICAgc3RhdGUubGFzdCA9ICtuZXcgRGF0ZSgpO1xyXG4gICAgICAgICAgICBfdGhpcy50aHJvdHRsZWRNZXRob2Qoc3RhdGUubmV3VmFsdWUpO1xyXG4gICAgICAgIH0sIHN0YXRlLmRlbGF5IC0gZWxhcHNlZCk7XHJcbiAgICB9XHJcbn1cclxudmFyIFRocm90dGxlQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFRocm90dGxlQmluZGluZ0JlaGF2aW9yKCkge1xyXG4gICAgfVxyXG4gICAgVGhyb3R0bGVCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlLCBkZWxheSkge1xyXG4gICAgICAgIGlmIChkZWxheSA9PT0gdm9pZCAwKSB7IGRlbGF5ID0gMjAwOyB9XHJcbiAgICAgICAgdmFyIG1ldGhvZFRvVGhyb3R0bGUgPSAndXBkYXRlVGFyZ2V0JztcclxuICAgICAgICBpZiAoYmluZGluZy5jYWxsU291cmNlKSB7XHJcbiAgICAgICAgICAgIG1ldGhvZFRvVGhyb3R0bGUgPSAnY2FsbFNvdXJjZSc7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGJpbmRpbmcudXBkYXRlU291cmNlICYmIGJpbmRpbmcubW9kZSA9PT0gYmluZGluZ01vZGUudHdvV2F5KSB7XHJcbiAgICAgICAgICAgIG1ldGhvZFRvVGhyb3R0bGUgPSAndXBkYXRlU291cmNlJztcclxuICAgICAgICB9XHJcbiAgICAgICAgYmluZGluZy50aHJvdHRsZWRNZXRob2QgPSBiaW5kaW5nW21ldGhvZFRvVGhyb3R0bGVdO1xyXG4gICAgICAgIGJpbmRpbmcudGhyb3R0bGVkTWV0aG9kLm9yaWdpbmFsTmFtZSA9IG1ldGhvZFRvVGhyb3R0bGU7XHJcbiAgICAgICAgYmluZGluZ1ttZXRob2RUb1Rocm90dGxlXSA9IHRocm90dGxlO1xyXG4gICAgICAgIGJpbmRpbmcudGhyb3R0bGVTdGF0ZSA9IHtcclxuICAgICAgICAgICAgZGVsYXk6IGRlbGF5LFxyXG4gICAgICAgICAgICBsYXN0OiAwLFxyXG4gICAgICAgICAgICB0aW1lb3V0SWQ6IG51bGxcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuICAgIFRocm90dGxlQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICAgICAgdmFyIG1ldGhvZFRvUmVzdG9yZSA9IGJpbmRpbmcudGhyb3R0bGVkTWV0aG9kLm9yaWdpbmFsTmFtZTtcclxuICAgICAgICBiaW5kaW5nW21ldGhvZFRvUmVzdG9yZV0gPSBiaW5kaW5nLnRocm90dGxlZE1ldGhvZDtcclxuICAgICAgICBiaW5kaW5nLnRocm90dGxlZE1ldGhvZCA9IG51bGw7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KGJpbmRpbmcudGhyb3R0bGVTdGF0ZS50aW1lb3V0SWQpO1xyXG4gICAgICAgIGJpbmRpbmcudGhyb3R0bGVTdGF0ZSA9IG51bGw7XHJcbiAgICB9O1xyXG4gICAgVGhyb3R0bGVCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ3Rocm90dGxlJylcclxuICAgIF0sIFRocm90dGxlQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBUaHJvdHRsZUJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcblxudmFyIHVuc2V0ID0ge307XHJcbmZ1bmN0aW9uIGRlYm91bmNlQ2FsbFNvdXJjZShldmVudCkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHZhciBzdGF0ZSA9IHRoaXMuZGVib3VuY2VTdGF0ZTtcclxuICAgIGNsZWFyVGltZW91dChzdGF0ZS50aW1lb3V0SWQpO1xyXG4gICAgc3RhdGUudGltZW91dElkID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBfdGhpcy5kZWJvdW5jZWRNZXRob2QoZXZlbnQpOyB9LCBzdGF0ZS5kZWxheSk7XHJcbn1cclxuZnVuY3Rpb24gZGVib3VuY2VDYWxsKGNvbnRleHQsIG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgIHZhciBzdGF0ZSA9IHRoaXMuZGVib3VuY2VTdGF0ZTtcclxuICAgIGNsZWFyVGltZW91dChzdGF0ZS50aW1lb3V0SWQpO1xyXG4gICAgaWYgKGNvbnRleHQgIT09IHN0YXRlLmNhbGxDb250ZXh0VG9EZWJvdW5jZSkge1xyXG4gICAgICAgIHN0YXRlLm9sZFZhbHVlID0gdW5zZXQ7XHJcbiAgICAgICAgdGhpcy5kZWJvdW5jZWRNZXRob2QoY29udGV4dCwgbmV3VmFsdWUsIG9sZFZhbHVlKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoc3RhdGUub2xkVmFsdWUgPT09IHVuc2V0KSB7XHJcbiAgICAgICAgc3RhdGUub2xkVmFsdWUgPSBvbGRWYWx1ZTtcclxuICAgIH1cclxuICAgIHN0YXRlLnRpbWVvdXRJZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfb2xkVmFsdWUgPSBzdGF0ZS5vbGRWYWx1ZTtcclxuICAgICAgICBzdGF0ZS5vbGRWYWx1ZSA9IHVuc2V0O1xyXG4gICAgICAgIF90aGlzLmRlYm91bmNlZE1ldGhvZChjb250ZXh0LCBuZXdWYWx1ZSwgX29sZFZhbHVlKTtcclxuICAgIH0sIHN0YXRlLmRlbGF5KTtcclxufVxyXG52YXIgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICB9XHJcbiAgICBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nLCBzb3VyY2UsIGRlbGF5KSB7XHJcbiAgICAgICAgaWYgKGRlbGF5ID09PSB2b2lkIDApIHsgZGVsYXkgPSAyMDA7IH1cclxuICAgICAgICB2YXIgaXNDYWxsU291cmNlID0gYmluZGluZy5jYWxsU291cmNlICE9PSB1bmRlZmluZWQ7XHJcbiAgICAgICAgdmFyIG1ldGhvZFRvRGVib3VuY2UgPSBpc0NhbGxTb3VyY2UgPyAnY2FsbFNvdXJjZScgOiAnY2FsbCc7XHJcbiAgICAgICAgdmFyIGRlYm91bmNlciA9IGlzQ2FsbFNvdXJjZSA/IGRlYm91bmNlQ2FsbFNvdXJjZSA6IGRlYm91bmNlQ2FsbDtcclxuICAgICAgICB2YXIgbW9kZSA9IGJpbmRpbmcubW9kZTtcclxuICAgICAgICB2YXIgY2FsbENvbnRleHRUb0RlYm91bmNlID0gbW9kZSA9PT0gYmluZGluZ01vZGUudHdvV2F5IHx8IG1vZGUgPT09IGJpbmRpbmdNb2RlLmZyb21WaWV3ID8gdGFyZ2V0Q29udGV4dCA6IHNvdXJjZUNvbnRleHQ7XHJcbiAgICAgICAgYmluZGluZy5kZWJvdW5jZWRNZXRob2QgPSBiaW5kaW5nW21ldGhvZFRvRGVib3VuY2VdO1xyXG4gICAgICAgIGJpbmRpbmcuZGVib3VuY2VkTWV0aG9kLm9yaWdpbmFsTmFtZSA9IG1ldGhvZFRvRGVib3VuY2U7XHJcbiAgICAgICAgYmluZGluZ1ttZXRob2RUb0RlYm91bmNlXSA9IGRlYm91bmNlcjtcclxuICAgICAgICBiaW5kaW5nLmRlYm91bmNlU3RhdGUgPSB7XHJcbiAgICAgICAgICAgIGNhbGxDb250ZXh0VG9EZWJvdW5jZTogY2FsbENvbnRleHRUb0RlYm91bmNlLFxyXG4gICAgICAgICAgICBkZWxheTogZGVsYXksXHJcbiAgICAgICAgICAgIHRpbWVvdXRJZDogMCxcclxuICAgICAgICAgICAgb2xkVmFsdWU6IHVuc2V0XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbiAgICBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciBtZXRob2RUb1Jlc3RvcmUgPSBiaW5kaW5nLmRlYm91bmNlZE1ldGhvZC5vcmlnaW5hbE5hbWU7XHJcbiAgICAgICAgYmluZGluZ1ttZXRob2RUb1Jlc3RvcmVdID0gYmluZGluZy5kZWJvdW5jZWRNZXRob2Q7XHJcbiAgICAgICAgYmluZGluZy5kZWJvdW5jZWRNZXRob2QgPSBudWxsO1xyXG4gICAgICAgIGNsZWFyVGltZW91dChiaW5kaW5nLmRlYm91bmNlU3RhdGUudGltZW91dElkKTtcclxuICAgICAgICBiaW5kaW5nLmRlYm91bmNlU3RhdGUgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIERlYm91bmNlQmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdkZWJvdW5jZScpXHJcbiAgICBdLCBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gRGVib3VuY2VCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIGZpbmRPcmlnaW5hbEV2ZW50VGFyZ2V0KGV2ZW50KSB7XHJcbiAgICByZXR1cm4gKGV2ZW50LnBhdGggJiYgZXZlbnQucGF0aFswXSkgfHwgKGV2ZW50LmRlZXBQYXRoICYmIGV2ZW50LmRlZXBQYXRoWzBdKSB8fCBldmVudC50YXJnZXQ7XHJcbn1cclxuZnVuY3Rpb24gaGFuZGxlU2VsZkV2ZW50KGV2ZW50KSB7XHJcbiAgICB2YXIgdGFyZ2V0ID0gZmluZE9yaWdpbmFsRXZlbnRUYXJnZXQoZXZlbnQpO1xyXG4gICAgaWYgKHRoaXMudGFyZ2V0ICE9PSB0YXJnZXQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB0aGlzLnNlbGZFdmVudENhbGxTb3VyY2UoZXZlbnQpO1xyXG59XHJcbnZhciBTZWxmQmluZGluZ0JlaGF2aW9yID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFNlbGZCaW5kaW5nQmVoYXZpb3IoKSB7XHJcbiAgICB9XHJcbiAgICBTZWxmQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIGlmICghYmluZGluZy5jYWxsU291cmNlIHx8ICFiaW5kaW5nLnRhcmdldEV2ZW50KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignU2VsZiBiaW5kaW5nIGJlaGF2aW9yIG9ubHkgc3VwcG9ydHMgZXZlbnQuJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGJpbmRpbmcuc2VsZkV2ZW50Q2FsbFNvdXJjZSA9IGJpbmRpbmcuY2FsbFNvdXJjZTtcclxuICAgICAgICBiaW5kaW5nLmNhbGxTb3VyY2UgPSBoYW5kbGVTZWxmRXZlbnQ7XHJcbiAgICB9O1xyXG4gICAgU2VsZkJpbmRpbmdCZWhhdmlvci5wcm90b3R5cGUudW5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIGJpbmRpbmcuY2FsbFNvdXJjZSA9IGJpbmRpbmcuc2VsZkV2ZW50Q2FsbFNvdXJjZTtcclxuICAgICAgICBiaW5kaW5nLnNlbGZFdmVudENhbGxTb3VyY2UgPSBudWxsO1xyXG4gICAgfTtcclxuICAgIFNlbGZCaW5kaW5nQmVoYXZpb3IgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICBiaW5kaW5nQmVoYXZpb3IoJ3NlbGYnKVxyXG4gICAgXSwgU2VsZkJpbmRpbmdCZWhhdmlvcik7XHJcbiAgICByZXR1cm4gU2VsZkJpbmRpbmdCZWhhdmlvcjtcclxufSgpKTtcblxudmFyIEJpbmRpbmdTaWduYWxlciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBCaW5kaW5nU2lnbmFsZXIoKSB7XHJcbiAgICAgICAgdGhpcy5zaWduYWxzID0ge307XHJcbiAgICB9XHJcbiAgICBCaW5kaW5nU2lnbmFsZXIucHJvdG90eXBlLnNpZ25hbCA9IGZ1bmN0aW9uIChuYW1lKSB7XHJcbiAgICAgICAgdmFyIGJpbmRpbmdzID0gdGhpcy5zaWduYWxzW25hbWVdO1xyXG4gICAgICAgIGlmICghYmluZGluZ3MpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgaSA9IGJpbmRpbmdzLmxlbmd0aDtcclxuICAgICAgICB3aGlsZSAoaS0tKSB7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzW2ldLmNhbGwoc291cmNlQ29udGV4dCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIHJldHVybiBCaW5kaW5nU2lnbmFsZXI7XHJcbn0oKSk7XG5cbnZhciBTaWduYWxCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gU2lnbmFsQmluZGluZ0JlaGF2aW9yKGJpbmRpbmdTaWduYWxlcikge1xyXG4gICAgICAgIHRoaXMuc2lnbmFscyA9IGJpbmRpbmdTaWduYWxlci5zaWduYWxzO1xyXG4gICAgfVxyXG4gICAgU2lnbmFsQmluZGluZ0JlaGF2aW9yLmluamVjdCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIFtCaW5kaW5nU2lnbmFsZXJdOyB9O1xyXG4gICAgU2lnbmFsQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmcsIHNvdXJjZSkge1xyXG4gICAgICAgIHZhciBuYW1lcyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMjsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIG5hbWVzW19pIC0gMl0gPSBhcmd1bWVudHNbX2ldO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWJpbmRpbmcudXBkYXRlVGFyZ2V0KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBwcm9wZXJ0eSBiaW5kaW5ncyBhbmQgc3RyaW5nIGludGVycG9sYXRpb24gYmluZGluZ3MgY2FuIGJlIHNpZ25hbGVkLiAgVHJpZ2dlciwgZGVsZWdhdGUgYW5kIGNhbGwgYmluZGluZ3MgY2Fubm90IGJlIHNpZ25hbGVkLicpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgc2lnbmFscyA9IHRoaXMuc2lnbmFscztcclxuICAgICAgICBpZiAobmFtZXMubGVuZ3RoID09PSAxKSB7XHJcbiAgICAgICAgICAgIHZhciBuYW1lXzEgPSBuYW1lc1swXTtcclxuICAgICAgICAgICAgdmFyIGJpbmRpbmdzID0gc2lnbmFsc1tuYW1lXzFdIHx8IChzaWduYWxzW25hbWVfMV0gPSBbXSk7XHJcbiAgICAgICAgICAgIGJpbmRpbmdzLnB1c2goYmluZGluZyk7XHJcbiAgICAgICAgICAgIGJpbmRpbmcuc2lnbmFsTmFtZSA9IG5hbWVfMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAobmFtZXMubGVuZ3RoID4gMSkge1xyXG4gICAgICAgICAgICB2YXIgaSA9IG5hbWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG5hbWVfMiA9IG5hbWVzW2ldO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpbmRpbmdzID0gc2lnbmFsc1tuYW1lXzJdIHx8IChzaWduYWxzW25hbWVfMl0gPSBbXSk7XHJcbiAgICAgICAgICAgICAgICBiaW5kaW5ncy5wdXNoKGJpbmRpbmcpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJpbmRpbmcuc2lnbmFsTmFtZSA9IG5hbWVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdTaWduYWwgbmFtZSBpcyByZXF1aXJlZC4nKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2lnbmFsQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICAgICAgdmFyIHNpZ25hbHMgPSB0aGlzLnNpZ25hbHM7XHJcbiAgICAgICAgdmFyIG5hbWUgPSBiaW5kaW5nLnNpZ25hbE5hbWU7XHJcbiAgICAgICAgYmluZGluZy5zaWduYWxOYW1lID0gbnVsbDtcclxuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShuYW1lKSkge1xyXG4gICAgICAgICAgICB2YXIgbmFtZXMgPSBuYW1lO1xyXG4gICAgICAgICAgICB2YXIgaSA9IG5hbWVzLmxlbmd0aDtcclxuICAgICAgICAgICAgd2hpbGUgKGktLSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG4gPSBuYW1lc1tpXTtcclxuICAgICAgICAgICAgICAgIHZhciBiaW5kaW5ncyA9IHNpZ25hbHNbbl07XHJcbiAgICAgICAgICAgICAgICBiaW5kaW5ncy5zcGxpY2UoYmluZGluZ3MuaW5kZXhPZihiaW5kaW5nKSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIHZhciBiaW5kaW5ncyA9IHNpZ25hbHNbbmFtZV07XHJcbiAgICAgICAgICAgIGJpbmRpbmdzLnNwbGljZShiaW5kaW5ncy5pbmRleE9mKGJpbmRpbmcpLCAxKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgU2lnbmFsQmluZGluZ0JlaGF2aW9yID0gX19kZWNvcmF0ZShbXHJcbiAgICAgICAgYmluZGluZ0JlaGF2aW9yKCdzaWduYWwnKVxyXG4gICAgXSwgU2lnbmFsQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBTaWduYWxCaW5kaW5nQmVoYXZpb3I7XHJcbn0oKSk7XG5cbnZhciBldmVudE5hbWVzUmVxdWlyZWQgPSAnVGhlIHVwZGF0ZVRyaWdnZXIgYmluZGluZyBiZWhhdmlvciByZXF1aXJlcyBhdCBsZWFzdCBvbmUgZXZlbnQgbmFtZSBhcmd1bWVudDogZWcgPGlucHV0IHZhbHVlLmJpbmQ9XCJmaXJzdE5hbWUgJiB1cGRhdGVUcmlnZ2VyOlxcJ2JsdXJcXCdcIj4nO1xyXG52YXIgbm90QXBwbGljYWJsZU1lc3NhZ2UgPSAnVGhlIHVwZGF0ZVRyaWdnZXIgYmluZGluZyBiZWhhdmlvciBjYW4gb25seSBiZSBhcHBsaWVkIHRvIHR3by13YXkvIGZyb20tdmlldyBiaW5kaW5ncyBvbiBpbnB1dC9zZWxlY3QgZWxlbWVudHMuJztcclxudmFyIFVwZGF0ZVRyaWdnZXJCaW5kaW5nQmVoYXZpb3IgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvcigpIHtcclxuICAgIH1cclxuICAgIFVwZGF0ZVRyaWdnZXJCaW5kaW5nQmVoYXZpb3IucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICAgICAgdmFyIGV2ZW50cyA9IFtdO1xyXG4gICAgICAgIGZvciAodmFyIF9pID0gMjsgX2kgPCBhcmd1bWVudHMubGVuZ3RoOyBfaSsrKSB7XHJcbiAgICAgICAgICAgIGV2ZW50c1tfaSAtIDJdID0gYXJndW1lbnRzW19pXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGV2ZW50cy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGV2ZW50TmFtZXNSZXF1aXJlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChiaW5kaW5nLm1vZGUgIT09IGJpbmRpbmdNb2RlLnR3b1dheSAmJiBiaW5kaW5nLm1vZGUgIT09IGJpbmRpbmdNb2RlLmZyb21WaWV3KSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihub3RBcHBsaWNhYmxlTWVzc2FnZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciB0YXJnZXRPYnNlcnZlciA9IGJpbmRpbmcub2JzZXJ2ZXJMb2NhdG9yLmdldE9ic2VydmVyKGJpbmRpbmcudGFyZ2V0LCBiaW5kaW5nLnRhcmdldFByb3BlcnR5KTtcclxuICAgICAgICBpZiAoIXRhcmdldE9ic2VydmVyLmhhbmRsZXIpIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKG5vdEFwcGxpY2FibGVNZXNzYWdlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgYmluZGluZy50YXJnZXRPYnNlcnZlciA9IHRhcmdldE9ic2VydmVyO1xyXG4gICAgICAgIHRhcmdldE9ic2VydmVyLm9yaWdpbmFsSGFuZGxlciA9IGJpbmRpbmcudGFyZ2V0T2JzZXJ2ZXIuaGFuZGxlcjtcclxuICAgICAgICB2YXIgaGFuZGxlciA9IG5ldyBFdmVudFN1YnNjcmliZXIoZXZlbnRzKTtcclxuICAgICAgICB0YXJnZXRPYnNlcnZlci5oYW5kbGVyID0gaGFuZGxlcjtcclxuICAgIH07XHJcbiAgICBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yLnByb3RvdHlwZS51bmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZywgc291cmNlKSB7XHJcbiAgICAgICAgdmFyIHRhcmdldE9ic2VydmVyID0gYmluZGluZy50YXJnZXRPYnNlcnZlcjtcclxuICAgICAgICB0YXJnZXRPYnNlcnZlci5oYW5kbGVyLmRpc3Bvc2UoKTtcclxuICAgICAgICB0YXJnZXRPYnNlcnZlci5oYW5kbGVyID0gdGFyZ2V0T2JzZXJ2ZXIub3JpZ2luYWxIYW5kbGVyO1xyXG4gICAgICAgIHRhcmdldE9ic2VydmVyLm9yaWdpbmFsSGFuZGxlciA9IG51bGw7XHJcbiAgICB9O1xyXG4gICAgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciA9IF9fZGVjb3JhdGUoW1xyXG4gICAgICAgIGJpbmRpbmdCZWhhdmlvcigndXBkYXRlVHJpZ2dlcicpXHJcbiAgICBdLCBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIHJldHVybiBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yO1xyXG59KCkpO1xuXG5mdW5jdGlvbiBfY3JlYXRlRHluYW1pY0VsZW1lbnQoX2EpIHtcclxuICAgIHZhciBuYW1lID0gX2EubmFtZSwgdmlld1VybCA9IF9hLnZpZXdVcmwsIGJpbmRhYmxlTmFtZXMgPSBfYS5iaW5kYWJsZU5hbWVzLCB1c2VTaGFkb3dET01tb2RlID0gX2EudXNlU2hhZG93RE9NbW9kZTtcclxuICAgIHZhciBEeW5hbWljRWxlbWVudCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gRHluYW1pY0VsZW1lbnQoKSB7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIER5bmFtaWNFbGVtZW50LnByb3RvdHlwZS5iaW5kID0gZnVuY3Rpb24gKGJpbmRpbmdDb250ZXh0KSB7XHJcbiAgICAgICAgICAgIHRoaXMuJHBhcmVudCA9IGJpbmRpbmdDb250ZXh0O1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgRHluYW1pY0VsZW1lbnQgPSBfX2RlY29yYXRlKFtcclxuICAgICAgICAgICAgY3VzdG9tRWxlbWVudChuYW1lKSxcclxuICAgICAgICAgICAgdXNlVmlldyh2aWV3VXJsKVxyXG4gICAgICAgIF0sIER5bmFtaWNFbGVtZW50KTtcclxuICAgICAgICByZXR1cm4gRHluYW1pY0VsZW1lbnQ7XHJcbiAgICB9KCkpO1xyXG4gICAgZm9yICh2YXIgaSA9IDAsIGlpID0gYmluZGFibGVOYW1lcy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7XHJcbiAgICAgICAgYmluZGFibGUoYmluZGFibGVOYW1lc1tpXSkoRHluYW1pY0VsZW1lbnQpO1xyXG4gICAgfVxyXG4gICAgc3dpdGNoICh1c2VTaGFkb3dET01tb2RlKSB7XHJcbiAgICAgICAgY2FzZSAnb3Blbic6XHJcbiAgICAgICAgICAgIHVzZVNoYWRvd0RPTSh7IG1vZGU6ICdvcGVuJyB9KShEeW5hbWljRWxlbWVudCk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgJ2Nsb3NlZCc6XHJcbiAgICAgICAgICAgIHVzZVNoYWRvd0RPTSh7IG1vZGU6ICdjbG9zZWQnIH0pKER5bmFtaWNFbGVtZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSAnJzpcclxuICAgICAgICAgICAgdXNlU2hhZG93RE9NKER5bmFtaWNFbGVtZW50KTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgY2FzZSBudWxsOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0OlxyXG4gICAgICAgICAgICBnZXRMb2dnZXIoJ2F1cmVsaWEtaHRtbC1vbmx5LWVsZW1lbnQnKVxyXG4gICAgICAgICAgICAgICAgLndhcm4oXCJFeHBlY3RlZCAndXNlLXNoYWRvdy1kb20nIHZhbHVlIHRvIGJlIFxcXCJjbG9zZVxcXCIsIFxcXCJvcGVuXFxcIiBvciBcXFwiXFxcIiwgcmVjZWl2ZWQgXCIuY29uY2F0KHVzZVNoYWRvd0RPTW1vZGUpKTtcclxuICAgICAgICAgICAgYnJlYWs7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gRHluYW1pY0VsZW1lbnQ7XHJcbn1cblxuZnVuY3Rpb24gZ2V0RWxlbWVudE5hbWUoYWRkcmVzcykge1xyXG4gICAgcmV0dXJuIC8oW15cXC9eXFw/XSspXFwuaHRtbC9pLmV4ZWMoYWRkcmVzcylbMV0udG9Mb3dlckNhc2UoKTtcclxufVxyXG5mdW5jdGlvbiBjb25maWd1cmUkMShjb25maWcpIHtcclxuICAgIHZhciB2aWV3RW5naW5lID0gY29uZmlnLmNvbnRhaW5lci5nZXQoVmlld0VuZ2luZSk7XHJcbiAgICB2YXIgbG9hZGVyID0gY29uZmlnLmF1cmVsaWEubG9hZGVyO1xyXG4gICAgdmlld0VuZ2luZS5hZGRSZXNvdXJjZVBsdWdpbignLmh0bWwnLCB7XHJcbiAgICAgICAgJ2ZldGNoJzogZnVuY3Rpb24gKHZpZXdVcmwpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGxvYWRlci5sb2FkVGVtcGxhdGUodmlld1VybCkudGhlbihmdW5jdGlvbiAocmVnaXN0cnlFbnRyeSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIF9hO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJpbmRhYmxlTmFtZXMgPSByZWdpc3RyeUVudHJ5LnRlbXBsYXRlLmdldEF0dHJpYnV0ZSgnYmluZGFibGUnKTtcclxuICAgICAgICAgICAgICAgIHZhciB1c2VTaGFkb3dET01tb2RlID0gcmVnaXN0cnlFbnRyeS50ZW1wbGF0ZS5nZXRBdHRyaWJ1dGUoJ3VzZS1zaGFkb3ctZG9tJyk7XHJcbiAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IGdldEVsZW1lbnROYW1lKHZpZXdVcmwpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGJpbmRhYmxlTmFtZXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBiaW5kYWJsZU5hbWVzID0gYmluZGFibGVOYW1lcy5zcGxpdCgnLCcpLm1hcChmdW5jdGlvbiAoeCkgeyByZXR1cm4geC50cmltKCk7IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlZ2lzdHJ5RW50cnkudGVtcGxhdGUucmVtb3ZlQXR0cmlidXRlKCdiaW5kYWJsZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYmluZGFibGVOYW1lcyA9IFtdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIF9hID0ge30sIF9hW25hbWVdID0gX2NyZWF0ZUR5bmFtaWNFbGVtZW50KHsgbmFtZTogbmFtZSwgdmlld1VybDogdmlld1VybCwgYmluZGFibGVOYW1lczogYmluZGFibGVOYW1lcywgdXNlU2hhZG93RE9NbW9kZTogdXNlU2hhZG93RE9NbW9kZSB9KSwgX2E7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG59XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcclxuICAgIGluamVjdEF1cmVsaWFIaWRlU3R5bGVBdEhlYWQoKTtcclxuICAgIGNvbmZpZy5nbG9iYWxSZXNvdXJjZXMoQ29tcG9zZSwgSWYsIEVsc2UsIFdpdGgsIFJlcGVhdCwgU2hvdywgSGlkZSwgUmVwbGFjZWFibGUsIEZvY3VzLCBTYW5pdGl6ZUhUTUxWYWx1ZUNvbnZlcnRlciwgT25lVGltZUJpbmRpbmdCZWhhdmlvciwgT25lV2F5QmluZGluZ0JlaGF2aW9yLCBUb1ZpZXdCaW5kaW5nQmVoYXZpb3IsIEZyb21WaWV3QmluZGluZ0JlaGF2aW9yLCBUd29XYXlCaW5kaW5nQmVoYXZpb3IsIFRocm90dGxlQmluZGluZ0JlaGF2aW9yLCBEZWJvdW5jZUJpbmRpbmdCZWhhdmlvciwgU2VsZkJpbmRpbmdCZWhhdmlvciwgU2lnbmFsQmluZGluZ0JlaGF2aW9yLCBVcGRhdGVUcmlnZ2VyQmluZGluZ0JlaGF2aW9yLCBBdHRyQmluZGluZ0JlaGF2aW9yKTtcclxuICAgIGNvbmZpZ3VyZSQxKGNvbmZpZyk7XHJcbiAgICB2YXIgdmlld0VuZ2luZSA9IGNvbmZpZy5jb250YWluZXIuZ2V0KFZpZXdFbmdpbmUpO1xyXG4gICAgdmFyIHN0eWxlUmVzb3VyY2VQbHVnaW4gPSB7XHJcbiAgICAgICAgZmV0Y2g6IGZ1bmN0aW9uIChhZGRyZXNzKSB7XHJcbiAgICAgICAgICAgIHZhciBfYTtcclxuICAgICAgICAgICAgcmV0dXJuIF9hID0ge30sIF9hW2FkZHJlc3NdID0gX2NyZWF0ZUNTU1Jlc291cmNlKGFkZHJlc3MpLCBfYTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgWycuY3NzJywgJy5sZXNzJywgJy5zYXNzJywgJy5zY3NzJywgJy5zdHlsJ10uZm9yRWFjaChmdW5jdGlvbiAoZXh0KSB7IHJldHVybiB2aWV3RW5naW5lLmFkZFJlc291cmNlUGx1Z2luKGV4dCwgc3R5bGVSZXNvdXJjZVBsdWdpbik7IH0pO1xyXG59XG5cbmV4cG9ydCB7IEFic3RyYWN0UmVwZWF0ZXIsIEFycmF5UmVwZWF0U3RyYXRlZ3ksIEF0dHJCaW5kaW5nQmVoYXZpb3IsIEJpbmRpbmdTaWduYWxlciwgQ29tcG9zZSwgRGVib3VuY2VCaW5kaW5nQmVoYXZpb3IsIEVsc2UsIEZvY3VzLCBGcm9tVmlld0JpbmRpbmdCZWhhdmlvciwgSFRNTFNhbml0aXplciwgSGlkZSwgSWYsIE1hcFJlcGVhdFN0cmF0ZWd5LCBOdWxsUmVwZWF0U3RyYXRlZ3ksIE51bWJlclJlcGVhdFN0cmF0ZWd5LCBPbmVUaW1lQmluZGluZ0JlaGF2aW9yLCBPbmVXYXlCaW5kaW5nQmVoYXZpb3IsIFJlcGVhdCwgUmVwZWF0U3RyYXRlZ3lMb2NhdG9yLCBSZXBsYWNlYWJsZSwgU2FuaXRpemVIVE1MVmFsdWVDb252ZXJ0ZXIsIFNlbGZCaW5kaW5nQmVoYXZpb3IsIFNldFJlcGVhdFN0cmF0ZWd5LCBTaG93LCBTaWduYWxCaW5kaW5nQmVoYXZpb3IsIFRocm90dGxlQmluZGluZ0JlaGF2aW9yLCBUb1ZpZXdCaW5kaW5nQmVoYXZpb3IsIFR3b1dheUJpbmRpbmdCZWhhdmlvciwgVXBkYXRlVHJpZ2dlckJpbmRpbmdCZWhhdmlvciwgV2l0aCwgY29uZmlndXJlLCBjcmVhdGVGdWxsT3ZlcnJpZGVDb250ZXh0LCBnZXRJdGVtc1NvdXJjZUV4cHJlc3Npb24sIGlzT25lVGltZSwgdW53cmFwRXhwcmVzc2lvbiwgdXBkYXRlT25lVGltZUJpbmRpbmcsIHVwZGF0ZU92ZXJyaWRlQ29udGV4dCwgdmlld3NSZXF1aXJlTGlmZWN5Y2xlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzLmpzLm1hcFxuXG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9+L2F1cmVsaWEtdGVtcGxhdGluZy1yZXNvdXJjZXMvZGlzdC9uYXRpdmUtbW9kdWxlcy9hdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzLmpzXG4vLyBtb2R1bGUgaWQgPSBhdXJlbGlhLXRlbXBsYXRpbmctcmVzb3VyY2VzXG4vLyBtb2R1bGUgY2h1bmtzID0gMSIsImltcG9ydCB7IFJvdXRlciwgUm91dGVMb2FkZXIsIEFwcFJvdXRlciB9IGZyb20gJ2F1cmVsaWEtcm91dGVyJztcbmltcG9ydCB7IE9yaWdpbiB9IGZyb20gJ2F1cmVsaWEtbWV0YWRhdGEnO1xuaW1wb3J0IHsgcmVsYXRpdmVUb0ZpbGUgfSBmcm9tICdhdXJlbGlhLXBhdGgnO1xuaW1wb3J0IHsgQmVoYXZpb3JJbnN0cnVjdGlvbiwgU2hhZG93RE9NLCBWaWV3U2xvdCwgVmlld0xvY2F0b3IsIENvbXBvc2l0aW9uVHJhbnNhY3Rpb24sIENvbXBvc2l0aW9uRW5naW5lLCBTd2FwU3RyYXRlZ2llcywgaW5saW5lVmlldywgY3VzdG9tRWxlbWVudCwgdXNlVmlldyB9IGZyb20gJ2F1cmVsaWEtdGVtcGxhdGluZyc7XG5pbXBvcnQgeyBDb250YWluZXIgfSBmcm9tICdhdXJlbGlhLWRlcGVuZGVuY3ktaW5qZWN0aW9uJztcbmltcG9ydCB7IGNyZWF0ZU92ZXJyaWRlQ29udGV4dCB9IGZyb20gJ2F1cmVsaWEtYmluZGluZyc7XG5pbXBvcnQgeyBET00gfSBmcm9tICdhdXJlbGlhLXBhbCc7XG5pbXBvcnQgKiBhcyBMb2dNYW5hZ2VyIGZyb20gJ2F1cmVsaWEtbG9nZ2luZyc7XG5cbi8qISAqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKlxyXG5Db3B5cmlnaHQgKGMpIE1pY3Jvc29mdCBDb3Jwb3JhdGlvbi5cclxuXHJcblBlcm1pc3Npb24gdG8gdXNlLCBjb3B5LCBtb2RpZnksIGFuZC9vciBkaXN0cmlidXRlIHRoaXMgc29mdHdhcmUgZm9yIGFueVxyXG5wdXJwb3NlIHdpdGggb3Igd2l0aG91dCBmZWUgaXMgaGVyZWJ5IGdyYW50ZWQuXHJcblxyXG5USEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiIEFORCBUSEUgQVVUSE9SIERJU0NMQUlNUyBBTEwgV0FSUkFOVElFUyBXSVRIXHJcblJFR0FSRCBUTyBUSElTIFNPRlRXQVJFIElOQ0xVRElORyBBTEwgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWVxyXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXHJcbklORElSRUNULCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgT1IgQU5ZIERBTUFHRVMgV0hBVFNPRVZFUiBSRVNVTFRJTkcgRlJPTVxyXG5MT1NTIE9GIFVTRSwgREFUQSBPUiBQUk9GSVRTLCBXSEVUSEVSIElOIEFOIEFDVElPTiBPRiBDT05UUkFDVCwgTkVHTElHRU5DRSBPUlxyXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXHJcblBFUkZPUk1BTkNFIE9GIFRISVMgU09GVFdBUkUuXHJcbioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqICovXHJcbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlICovXHJcblxyXG52YXIgZXh0ZW5kU3RhdGljcyA9IGZ1bmN0aW9uKGQsIGIpIHtcclxuICAgIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcclxuICAgICAgICAoeyBfX3Byb3RvX186IFtdIH0gaW5zdGFuY2VvZiBBcnJheSAmJiBmdW5jdGlvbiAoZCwgYikgeyBkLl9fcHJvdG9fXyA9IGI7IH0pIHx8XHJcbiAgICAgICAgZnVuY3Rpb24gKGQsIGIpIHsgZm9yICh2YXIgcCBpbiBiKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGIsIHApKSBkW3BdID0gYltwXTsgfTtcclxuICAgIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xyXG59O1xyXG5cclxuZnVuY3Rpb24gX19leHRlbmRzKGQsIGIpIHtcclxuICAgIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNsYXNzIGV4dGVuZHMgdmFsdWUgXCIgKyBTdHJpbmcoYikgKyBcIiBpcyBub3QgYSBjb25zdHJ1Y3RvciBvciBudWxsXCIpO1xyXG4gICAgZXh0ZW5kU3RhdGljcyhkLCBiKTtcclxuICAgIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxyXG4gICAgZC5wcm90b3R5cGUgPSBiID09PSBudWxsID8gT2JqZWN0LmNyZWF0ZShiKSA6IChfXy5wcm90b3R5cGUgPSBiLnByb3RvdHlwZSwgbmV3IF9fKCkpO1xyXG59XG5cbnZhciBFbXB0eUxheW91dFZpZXdNb2RlbCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBFbXB0eUxheW91dFZpZXdNb2RlbCgpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBFbXB0eUxheW91dFZpZXdNb2RlbDtcclxufSgpKTtcclxudmFyIFJvdXRlclZpZXcgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gUm91dGVyVmlldyhlbGVtZW50LCBjb250YWluZXIsIHZpZXdTbG90LCByb3V0ZXIsIHZpZXdMb2NhdG9yLCBjb21wb3NpdGlvblRyYW5zYWN0aW9uLCBjb21wb3NpdGlvbkVuZ2luZSkge1xyXG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsZW1lbnQ7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XHJcbiAgICAgICAgdGhpcy52aWV3U2xvdCA9IHZpZXdTbG90O1xyXG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xyXG4gICAgICAgIHRoaXMudmlld0xvY2F0b3IgPSB2aWV3TG9jYXRvcjtcclxuICAgICAgICB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb24gPSBjb21wb3NpdGlvblRyYW5zYWN0aW9uO1xyXG4gICAgICAgIHRoaXMuY29tcG9zaXRpb25FbmdpbmUgPSBjb21wb3NpdGlvbkVuZ2luZTtcclxuICAgICAgICB0aGlzLnJvdXRlci5yZWdpc3RlclZpZXdQb3J0KHRoaXMsIHRoaXMuZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ25hbWUnKSk7XHJcbiAgICAgICAgaWYgKCEoJ2luaXRpYWxDb21wb3NpdGlvbicgaW4gY29tcG9zaXRpb25UcmFuc2FjdGlvbikpIHtcclxuICAgICAgICAgICAgY29tcG9zaXRpb25UcmFuc2FjdGlvbi5pbml0aWFsQ29tcG9zaXRpb24gPSB0cnVlO1xyXG4gICAgICAgICAgICB0aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllciA9IGNvbXBvc2l0aW9uVHJhbnNhY3Rpb24uZW5saXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgUm91dGVyVmlldy5pbmplY3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFtET00uRWxlbWVudCwgQ29udGFpbmVyLCBWaWV3U2xvdCwgUm91dGVyLCBWaWV3TG9jYXRvciwgQ29tcG9zaXRpb25UcmFuc2FjdGlvbiwgQ29tcG9zaXRpb25FbmdpbmVdO1xyXG4gICAgfTtcclxuICAgIFJvdXRlclZpZXcucHJvdG90eXBlLmNyZWF0ZWQgPSBmdW5jdGlvbiAob3duaW5nVmlldykge1xyXG4gICAgICAgIHRoaXMub3duaW5nVmlldyA9IG93bmluZ1ZpZXc7XHJcbiAgICB9O1xyXG4gICAgUm91dGVyVmlldy5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uIChiaW5kaW5nQ29udGV4dCwgb3ZlcnJpZGVDb250ZXh0KSB7XHJcbiAgICAgICAgdGhpcy5jb250YWluZXIudmlld01vZGVsID0gYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgdGhpcy5vdmVycmlkZUNvbnRleHQgPSBvdmVycmlkZUNvbnRleHQ7XHJcbiAgICB9O1xyXG4gICAgUm91dGVyVmlldy5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uICgkdmlld1BvcnRJbnN0cnVjdGlvbiwgd2FpdFRvU3dhcCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIHZpZXdQb3J0SW5zdHJ1Y3Rpb24gPSAkdmlld1BvcnRJbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgY29tcG9uZW50ID0gdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQ7XHJcbiAgICAgICAgdmFyIGNoaWxkQ29udGFpbmVyID0gY29tcG9uZW50LmNoaWxkQ29udGFpbmVyO1xyXG4gICAgICAgIHZhciB2aWV3TW9kZWwgPSBjb21wb25lbnQudmlld01vZGVsO1xyXG4gICAgICAgIHZhciB2aWV3TW9kZWxSZXNvdXJjZSA9IGNvbXBvbmVudC52aWV3TW9kZWxSZXNvdXJjZTtcclxuICAgICAgICB2YXIgbWV0YWRhdGEgPSB2aWV3TW9kZWxSZXNvdXJjZS5tZXRhZGF0YTtcclxuICAgICAgICB2YXIgY29uZmlnID0gY29tcG9uZW50LnJvdXRlci5jdXJyZW50SW5zdHJ1Y3Rpb24uY29uZmlnO1xyXG4gICAgICAgIHZhciB2aWV3UG9ydENvbmZpZyA9IGNvbmZpZy52aWV3UG9ydHMgPyAoY29uZmlnLnZpZXdQb3J0c1t2aWV3UG9ydEluc3RydWN0aW9uLm5hbWVdIHx8IHt9KSA6IHt9O1xyXG4gICAgICAgIGNoaWxkQ29udGFpbmVyLmdldChSb3V0ZXJWaWV3TG9jYXRvcikuX25vdGlmeSh0aGlzKTtcclxuICAgICAgICB2YXIgbGF5b3V0SW5zdHJ1Y3Rpb24gPSB7XHJcbiAgICAgICAgICAgIHZpZXdNb2RlbDogdmlld1BvcnRDb25maWcubGF5b3V0Vmlld01vZGVsIHx8IGNvbmZpZy5sYXlvdXRWaWV3TW9kZWwgfHwgdGhpcy5sYXlvdXRWaWV3TW9kZWwsXHJcbiAgICAgICAgICAgIHZpZXc6IHZpZXdQb3J0Q29uZmlnLmxheW91dFZpZXcgfHwgY29uZmlnLmxheW91dFZpZXcgfHwgdGhpcy5sYXlvdXRWaWV3LFxyXG4gICAgICAgICAgICBtb2RlbDogdmlld1BvcnRDb25maWcubGF5b3V0TW9kZWwgfHwgY29uZmlnLmxheW91dE1vZGVsIHx8IHRoaXMubGF5b3V0TW9kZWwsXHJcbiAgICAgICAgICAgIHJvdXRlcjogdmlld1BvcnRJbnN0cnVjdGlvbi5jb21wb25lbnQucm91dGVyLFxyXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lcjogY2hpbGRDb250YWluZXIsXHJcbiAgICAgICAgICAgIHZpZXdTbG90OiB0aGlzLnZpZXdTbG90XHJcbiAgICAgICAgfTtcclxuICAgICAgICB2YXIgdmlld1N0cmF0ZWd5ID0gdGhpcy52aWV3TG9jYXRvci5nZXRWaWV3U3RyYXRlZ3koY29tcG9uZW50LnZpZXcgfHwgdmlld01vZGVsKTtcclxuICAgICAgICBpZiAodmlld1N0cmF0ZWd5ICYmIGNvbXBvbmVudC52aWV3KSB7XHJcbiAgICAgICAgICAgIHZpZXdTdHJhdGVneS5tYWtlUmVsYXRpdmVUbyhPcmlnaW4uZ2V0KGNvbXBvbmVudC5yb3V0ZXIuY29udGFpbmVyLnZpZXdNb2RlbC5jb25zdHJ1Y3RvcikubW9kdWxlSWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbWV0YWRhdGFcclxuICAgICAgICAgICAgLmxvYWQoY2hpbGRDb250YWluZXIsIHZpZXdNb2RlbFJlc291cmNlLnZhbHVlLCBudWxsLCB2aWV3U3RyYXRlZ3ksIHRydWUpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh2aWV3RmFjdG9yeSkge1xyXG4gICAgICAgICAgICBpZiAoIV90aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Ob3RpZmllcikge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gX3RoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbi50cnlDYXB0dXJlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGxheW91dEluc3RydWN0aW9uLnZpZXdNb2RlbCB8fCBsYXlvdXRJbnN0cnVjdGlvbi52aWV3KSB7XHJcbiAgICAgICAgICAgICAgICB2aWV3UG9ydEluc3RydWN0aW9uLmxheW91dEluc3RydWN0aW9uID0gbGF5b3V0SW5zdHJ1Y3Rpb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIHZpZXdQb3J0Q29tcG9uZW50QmVoYXZpb3JJbnN0cnVjdGlvbiA9IEJlaGF2aW9ySW5zdHJ1Y3Rpb24uZHluYW1pYyhfdGhpcy5lbGVtZW50LCB2aWV3TW9kZWwsIHZpZXdGYWN0b3J5KTtcclxuICAgICAgICAgICAgdmlld1BvcnRJbnN0cnVjdGlvbi5jb250cm9sbGVyID0gbWV0YWRhdGEuY3JlYXRlKGNoaWxkQ29udGFpbmVyLCB2aWV3UG9ydENvbXBvbmVudEJlaGF2aW9ySW5zdHJ1Y3Rpb24pO1xyXG4gICAgICAgICAgICBpZiAod2FpdFRvU3dhcCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgX3RoaXMuc3dhcCh2aWV3UG9ydEluc3RydWN0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBSb3V0ZXJWaWV3LnByb3RvdHlwZS5zd2FwID0gZnVuY3Rpb24gKCR2aWV3UG9ydEluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICB2YXIgdmlld1BvcnRJbnN0cnVjdGlvbiA9ICR2aWV3UG9ydEluc3RydWN0aW9uO1xyXG4gICAgICAgIHZhciB2aWV3UG9ydENvbnRyb2xsZXIgPSB2aWV3UG9ydEluc3RydWN0aW9uLmNvbnRyb2xsZXI7XHJcbiAgICAgICAgdmFyIGxheW91dEluc3RydWN0aW9uID0gdmlld1BvcnRJbnN0cnVjdGlvbi5sYXlvdXRJbnN0cnVjdGlvbjtcclxuICAgICAgICB2YXIgcHJldmlvdXNWaWV3ID0gdGhpcy52aWV3O1xyXG4gICAgICAgIHZhciB3b3JrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgc3dhcFN0cmF0ZWd5ID0gU3dhcFN0cmF0ZWdpZXNbX3RoaXMuc3dhcE9yZGVyXSB8fCBTd2FwU3RyYXRlZ2llcy5hZnRlcjtcclxuICAgICAgICAgICAgdmFyIHZpZXdTbG90ID0gX3RoaXMudmlld1Nsb3Q7XHJcbiAgICAgICAgICAgIHN3YXBTdHJhdGVneSh2aWV3U2xvdCwgcHJldmlvdXNWaWV3LCBmdW5jdGlvbiAoKSB7IHJldHVybiBQcm9taXNlLnJlc29sdmUodmlld1Nsb3QuYWRkKF90aGlzLnZpZXcpKTsgfSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5fbm90aWZ5KCk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdmFyIHJlYWR5ID0gZnVuY3Rpb24gKG93bmluZ1ZpZXdfb3JfbGF5b3V0Vmlldykge1xyXG4gICAgICAgICAgICB2aWV3UG9ydENvbnRyb2xsZXIuYXV0b21hdGUoX3RoaXMub3ZlcnJpZGVDb250ZXh0LCBvd25pbmdWaWV3X29yX2xheW91dFZpZXcpO1xyXG4gICAgICAgICAgICB2YXIgdHJhbnNhY3Rpb25Pd25lclNoaXBUb2tlbiA9IF90aGlzLmNvbXBvc2l0aW9uVHJhbnNhY3Rpb25Pd25lcnNoaXBUb2tlbjtcclxuICAgICAgICAgICAgaWYgKHRyYW5zYWN0aW9uT3duZXJTaGlwVG9rZW4pIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2FjdGlvbk93bmVyU2hpcFRva2VuXHJcbiAgICAgICAgICAgICAgICAgICAgLndhaXRGb3JDb21wb3NpdGlvbkNvbXBsZXRlKClcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuY29tcG9zaXRpb25UcmFuc2FjdGlvbk93bmVyc2hpcFRva2VuID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gd29yaygpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHdvcmsoKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChsYXlvdXRJbnN0cnVjdGlvbikge1xyXG4gICAgICAgICAgICBpZiAoIWxheW91dEluc3RydWN0aW9uLnZpZXdNb2RlbCkge1xyXG4gICAgICAgICAgICAgICAgbGF5b3V0SW5zdHJ1Y3Rpb24udmlld01vZGVsID0gbmV3IEVtcHR5TGF5b3V0Vmlld01vZGVsKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9zaXRpb25FbmdpbmVcclxuICAgICAgICAgICAgICAgIC5jcmVhdGVDb250cm9sbGVyKGxheW91dEluc3RydWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGxheW91dENvbnRyb2xsZXIpIHtcclxuICAgICAgICAgICAgICAgIHZhciBsYXlvdXRWaWV3ID0gbGF5b3V0Q29udHJvbGxlci52aWV3O1xyXG4gICAgICAgICAgICAgICAgU2hhZG93RE9NLmRpc3RyaWJ1dGVWaWV3KHZpZXdQb3J0Q29udHJvbGxlci52aWV3LCBsYXlvdXRDb250cm9sbGVyLnNsb3RzIHx8IGxheW91dFZpZXcuc2xvdHMpO1xyXG4gICAgICAgICAgICAgICAgbGF5b3V0Q29udHJvbGxlci5hdXRvbWF0ZShjcmVhdGVPdmVycmlkZUNvbnRleHQobGF5b3V0SW5zdHJ1Y3Rpb24udmlld01vZGVsKSwgX3RoaXMub3duaW5nVmlldyk7XHJcbiAgICAgICAgICAgICAgICBsYXlvdXRWaWV3LmNoaWxkcmVuLnB1c2godmlld1BvcnRDb250cm9sbGVyLnZpZXcpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxheW91dFZpZXcgfHwgbGF5b3V0Q29udHJvbGxlcjtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChuZXdWaWV3KSB7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy52aWV3ID0gbmV3VmlldztcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWFkeShuZXdWaWV3KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMudmlldyA9IHZpZXdQb3J0Q29udHJvbGxlci52aWV3O1xyXG4gICAgICAgIHJldHVybiByZWFkeSh0aGlzLm93bmluZ1ZpZXcpO1xyXG4gICAgfTtcclxuICAgIFJvdXRlclZpZXcucHJvdG90eXBlLl9ub3RpZnkgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIG5vdGlmaWVyID0gdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXI7XHJcbiAgICAgICAgaWYgKG5vdGlmaWVyKSB7XHJcbiAgICAgICAgICAgIG5vdGlmaWVyLmRvbmUoKTtcclxuICAgICAgICAgICAgdGhpcy5jb21wb3NpdGlvblRyYW5zYWN0aW9uTm90aWZpZXIgPSBudWxsO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBSb3V0ZXJWaWV3LiR2aWV3ID0gbnVsbDtcclxuICAgIFJvdXRlclZpZXcuJHJlc291cmNlID0ge1xyXG4gICAgICAgIG5hbWU6ICdyb3V0ZXItdmlldycsXHJcbiAgICAgICAgYmluZGFibGVzOiBbJ3N3YXBPcmRlcicsICdsYXlvdXRWaWV3JywgJ2xheW91dFZpZXdNb2RlbCcsICdsYXlvdXRNb2RlbCcsICdpbmhlcml0LWJpbmRpbmctY29udGV4dCddXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIFJvdXRlclZpZXc7XHJcbn0oKSk7XHJcbnZhciBSb3V0ZXJWaWV3TG9jYXRvciA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICBmdW5jdGlvbiBSb3V0ZXJWaWV3TG9jYXRvcigpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMucHJvbWlzZSA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7IHJldHVybiBfdGhpcy5yZXNvbHZlID0gcmVzb2x2ZTsgfSk7XHJcbiAgICB9XHJcbiAgICBSb3V0ZXJWaWV3TG9jYXRvci5wcm90b3R5cGUuZmluZE5lYXJlc3QgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvbWlzZTtcclxuICAgIH07XHJcbiAgICBSb3V0ZXJWaWV3TG9jYXRvci5wcm90b3R5cGUuX25vdGlmeSA9IGZ1bmN0aW9uIChyb3V0ZXJWaWV3KSB7XHJcbiAgICAgICAgdGhpcy5yZXNvbHZlKHJvdXRlclZpZXcpO1xyXG4gICAgfTtcclxuICAgIHJldHVybiBSb3V0ZXJWaWV3TG9jYXRvcjtcclxufSgpKTtcblxudmFyIEVtcHR5Q2xhc3MgPSAoZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gRW1wdHlDbGFzcygpIHtcclxuICAgIH1cclxuICAgIHJldHVybiBFbXB0eUNsYXNzO1xyXG59KCkpO1xyXG5pbmxpbmVWaWV3KCc8dGVtcGxhdGU+PC90ZW1wbGF0ZT4nKShFbXB0eUNsYXNzKTtcclxudmFyIFRlbXBsYXRpbmdSb3V0ZUxvYWRlciA9IChmdW5jdGlvbiAoX3N1cGVyKSB7XHJcbiAgICBfX2V4dGVuZHMoVGVtcGxhdGluZ1JvdXRlTG9hZGVyLCBfc3VwZXIpO1xyXG4gICAgZnVuY3Rpb24gVGVtcGxhdGluZ1JvdXRlTG9hZGVyKGNvbXBvc2l0aW9uRW5naW5lKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gX3N1cGVyLmNhbGwodGhpcykgfHwgdGhpcztcclxuICAgICAgICBfdGhpcy5jb21wb3NpdGlvbkVuZ2luZSA9IGNvbXBvc2l0aW9uRW5naW5lO1xyXG4gICAgICAgIHJldHVybiBfdGhpcztcclxuICAgIH1cclxuICAgIFRlbXBsYXRpbmdSb3V0ZUxvYWRlci5wcm90b3R5cGUucmVzb2x2ZVZpZXdNb2RlbCA9IGZ1bmN0aW9uIChyb3V0ZXIsIGNvbmZpZykge1xyXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgICAgIHZhciB2aWV3TW9kZWw7XHJcbiAgICAgICAgICAgIGlmICgnbW9kdWxlSWQnIGluIGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1vZHVsZUlkID0gY29uZmlnLm1vZHVsZUlkO1xyXG4gICAgICAgICAgICAgICAgaWYgKG1vZHVsZUlkID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsID0gRW1wdHlDbGFzcztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG1vZHVsZUlkID0gcmVsYXRpdmVUb0ZpbGUobW9kdWxlSWQsIE9yaWdpbi5nZXQocm91dGVyLmNvbnRhaW5lci52aWV3TW9kZWwuY29uc3RydWN0b3IpLm1vZHVsZUlkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoL1xcLmh0bWwvaS50ZXN0KG1vZHVsZUlkKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3TW9kZWwgPSBjcmVhdGVEeW5hbWljQ2xhc3MobW9kdWxlSWQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmlld01vZGVsID0gbW9kdWxlSWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUodmlld01vZGVsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZWplY3QobmV3IEVycm9yKCdJbnZhbGlkIHJvdXRlIGNvbmZpZy4gTm8gXCJtb2R1bGVJZFwiIGZvdW5kLicpKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nUm91dGVMb2FkZXIucHJvdG90eXBlLmNyZWF0ZUNoaWxkQ29udGFpbmVyID0gZnVuY3Rpb24gKHJvdXRlcikge1xyXG4gICAgICAgIHZhciBjaGlsZENvbnRhaW5lciA9IHJvdXRlci5jb250YWluZXIuY3JlYXRlQ2hpbGQoKTtcclxuICAgICAgICBjaGlsZENvbnRhaW5lci5yZWdpc3RlclNpbmdsZXRvbihSb3V0ZXJWaWV3TG9jYXRvcik7XHJcbiAgICAgICAgY2hpbGRDb250YWluZXIuZ2V0Q2hpbGRSb3V0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBjaGlsZFJvdXRlcjtcclxuICAgICAgICAgICAgY2hpbGRDb250YWluZXIucmVnaXN0ZXJIYW5kbGVyKFJvdXRlciwgZnVuY3Rpb24gKCkgeyByZXR1cm4gY2hpbGRSb3V0ZXIgfHwgKGNoaWxkUm91dGVyID0gcm91dGVyLmNyZWF0ZUNoaWxkKGNoaWxkQ29udGFpbmVyKSk7IH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gY2hpbGRDb250YWluZXIuZ2V0KFJvdXRlcik7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gY2hpbGRDb250YWluZXI7XHJcbiAgICB9O1xyXG4gICAgVGVtcGxhdGluZ1JvdXRlTG9hZGVyLnByb3RvdHlwZS5sb2FkUm91dGUgPSBmdW5jdGlvbiAocm91dGVyLCBjb25maWcsIG5hdkluc3RydWN0aW9uKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICByZXR1cm4gdGhpc1xyXG4gICAgICAgICAgICAucmVzb2x2ZVZpZXdNb2RlbChyb3V0ZXIsIGNvbmZpZylcclxuICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHZpZXdNb2RlbCkgeyByZXR1cm4gX3RoaXMuY29tcG9zaXRpb25FbmdpbmUuZW5zdXJlVmlld01vZGVsKHtcclxuICAgICAgICAgICAgdmlld01vZGVsOiB2aWV3TW9kZWwsXHJcbiAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyOiBfdGhpcy5jcmVhdGVDaGlsZENvbnRhaW5lcihyb3V0ZXIpLFxyXG4gICAgICAgICAgICB2aWV3OiBjb25maWcudmlldyB8fCBjb25maWcudmlld1N0cmF0ZWd5LFxyXG4gICAgICAgICAgICByb3V0ZXI6IHJvdXRlclxyXG4gICAgICAgIH0pOyB9KTtcclxuICAgIH07XHJcbiAgICBUZW1wbGF0aW5nUm91dGVMb2FkZXIuaW5qZWN0ID0gW0NvbXBvc2l0aW9uRW5naW5lXTtcclxuICAgIHJldHVybiBUZW1wbGF0aW5nUm91dGVMb2FkZXI7XHJcbn0oUm91dGVMb2FkZXIpKTtcclxuZnVuY3Rpb24gY3JlYXRlRHluYW1pY0NsYXNzKG1vZHVsZUlkKSB7XHJcbiAgICB2YXIgbmFtZSA9IC8oW15cXC9eXFw/XSspXFwuaHRtbC9pLmV4ZWMobW9kdWxlSWQpWzFdO1xyXG4gICAgdmFyIER5bmFtaWNDbGFzcyA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gRHluYW1pY0NsYXNzKCkge1xyXG4gICAgICAgIH1cclxuICAgICAgICBEeW5hbWljQ2xhc3MucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbiAoYmluZGluZ0NvbnRleHQpIHtcclxuICAgICAgICAgICAgdGhpcy4kcGFyZW50ID0gYmluZGluZ0NvbnRleHQ7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gRHluYW1pY0NsYXNzO1xyXG4gICAgfSgpKTtcclxuICAgIGN1c3RvbUVsZW1lbnQobmFtZSkoRHluYW1pY0NsYXNzKTtcclxuICAgIHVzZVZpZXcobW9kdWxlSWQpKER5bmFtaWNDbGFzcyk7XHJcbiAgICByZXR1cm4gRHluYW1pY0NsYXNzO1xyXG59XG5cbnZhciBsb2dnZXIgPSBMb2dNYW5hZ2VyLmdldExvZ2dlcigncm91dGUtaHJlZicpO1xyXG52YXIgUm91dGVIcmVmID0gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIFJvdXRlSHJlZihyb3V0ZXIsIGVsZW1lbnQpIHtcclxuICAgICAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcclxuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xyXG4gICAgICAgIHRoaXMuYXR0cmlidXRlID0gJ2hyZWYnO1xyXG4gICAgfVxyXG4gICAgUm91dGVIcmVmLmluamVjdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gW1JvdXRlciwgRE9NLkVsZW1lbnRdO1xyXG4gICAgfTtcclxuICAgIFJvdXRlSHJlZi5wcm90b3R5cGUuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLnByb2Nlc3NDaGFuZ2UoKTtcclxuICAgIH07XHJcbiAgICBSb3V0ZUhyZWYucHJvdG90eXBlLnVuYmluZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLmlzQWN0aXZlID0gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgUm91dGVIcmVmLnByb3RvdHlwZS5hdHRyaWJ1dGVDaGFuZ2VkID0gZnVuY3Rpb24gKHZhbHVlLCBwcmV2aW91cykge1xyXG4gICAgICAgIGlmIChwcmV2aW91cykge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKHByZXZpb3VzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc0NoYW5nZSgpO1xyXG4gICAgfTtcclxuICAgIFJvdXRlSHJlZi5wcm90b3R5cGUucHJvY2Vzc0NoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHJldHVybiB0aGlzLnJvdXRlclxyXG4gICAgICAgICAgICAuZW5zdXJlQ29uZmlndXJlZCgpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKCFfdGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIGVsZW1lbnQgPSBfdGhpcy5lbGVtZW50O1xyXG4gICAgICAgICAgICB2YXIgaHJlZiA9IF90aGlzLnJvdXRlci5nZW5lcmF0ZShfdGhpcy5yb3V0ZSwgX3RoaXMucGFyYW1zKTtcclxuICAgICAgICAgICAgaWYgKGVsZW1lbnQuYXUuY29udHJvbGxlcikge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5hdS5jb250cm9sbGVyLnZpZXdNb2RlbFtfdGhpcy5hdHRyaWJ1dGVdID0gaHJlZjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKF90aGlzLmF0dHJpYnV0ZSwgaHJlZik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKHJlYXNvbik7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgUm91dGVIcmVmLiRyZXNvdXJjZSA9IHtcclxuICAgICAgICB0eXBlOiAnYXR0cmlidXRlJyxcclxuICAgICAgICBuYW1lOiAncm91dGUtaHJlZicsXHJcbiAgICAgICAgYmluZGFibGVzOiBbXHJcbiAgICAgICAgICAgIHsgbmFtZTogJ3JvdXRlJywgY2hhbmdlSGFuZGxlcjogJ3Byb2Nlc3NDaGFuZ2UnLCBwcmltYXJ5UHJvcGVydHk6IHRydWUgfSxcclxuICAgICAgICAgICAgeyBuYW1lOiAncGFyYW1zJywgY2hhbmdlSGFuZGxlcjogJ3Byb2Nlc3NDaGFuZ2UnIH0sXHJcbiAgICAgICAgICAgICdhdHRyaWJ1dGUnXHJcbiAgICAgICAgXVxyXG4gICAgfTtcclxuICAgIHJldHVybiBSb3V0ZUhyZWY7XHJcbn0oKSk7XG5cbmZ1bmN0aW9uIGNvbmZpZ3VyZShjb25maWcpIHtcclxuICAgIGNvbmZpZ1xyXG4gICAgICAgIC5zaW5nbGV0b24oUm91dGVMb2FkZXIsIFRlbXBsYXRpbmdSb3V0ZUxvYWRlcilcclxuICAgICAgICAuc2luZ2xldG9uKFJvdXRlciwgQXBwUm91dGVyKVxyXG4gICAgICAgIC5nbG9iYWxSZXNvdXJjZXMoUm91dGVyVmlldywgUm91dGVIcmVmKTtcclxuICAgIGNvbmZpZy5jb250YWluZXIucmVnaXN0ZXJBbGlhcyhSb3V0ZXIsIEFwcFJvdXRlcik7XHJcbn1cblxuZXhwb3J0IHsgUm91dGVIcmVmLCBSb3V0ZXJWaWV3LCBSb3V0ZXJWaWV3TG9jYXRvciwgVGVtcGxhdGluZ1JvdXRlTG9hZGVyLCBjb25maWd1cmUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWF1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIuanMubWFwXG5cblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL34vYXVyZWxpYS10ZW1wbGF0aW5nLXJvdXRlci9kaXN0L25hdGl2ZS1tb2R1bGVzL2F1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXIuanNcbi8vIG1vZHVsZSBpZCA9IGF1cmVsaWEtdGVtcGxhdGluZy1yb3V0ZXJcbi8vIG1vZHVsZSBjaHVua3MgPSAxIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUM1cUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztBQzdMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDckRBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNwMUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUMvTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUM5a0xBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDM0lBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNwb0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7QUN6U0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDM2ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDL3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7O0FDeHhCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7O0FDaDlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OyIsInNvdXJjZVJvb3QiOiIifQ==